'use strict'; 
"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['powerbiportal.explore.bundle.min.js'] || {};
marker.startEval = Date.now();
var __extends=this&&this.__extends||(function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}})(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},__assign.apply(this,arguments)},__decorate=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return i([e,t])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,o&&(a=2&r[0]?o.return:r[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],o=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},powerbi;!(function(e){var t;!(function(t){function r(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x,S,b,E){var _=t.CustomerAction(c,p,d,f,v,m,h,g,y,C,x,S,b,E),w=q(_.info,{rank:r,type:i,insightType:n,commonColumnCount:o,commonHighlightFilterCount:a,commonQueryFilterCount:s,relevanceScore:l,source:u});return{name:t.InsightsViewInsightInFocusEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({rank:w.rank,type:w.type,insightType:w.insightType,commonColumnCount:w.commonColumnCount,commonHighlightFilterCount:w.commonHighlightFilterCount,commonQueryFilterCount:w.commonQueryFilterCount,relevanceScore:w.relevanceScore,source:w.source},null,_.formatted())},info:w,loggers:t.InsightsViewInsightInFocusLoggers}}function i(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x,S){var b=t.CustomerAction(l,u,c,p,d,f,v,m,h,g,y,C,x,S),E=q(b.info,{insightCount:r,entryPoint:i,contentProviderId:n,hashedModelId:o,isScoped:a,telemetryId:s});return{name:t.InsightsShowInsightsEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({insightCount:E.insightCount,entryPoint:E.entryPoint,contentProviderId:E.contentProviderId,hashedModelId:E.hashedModelId,isScoped:E.isScoped,telemetryId:E.telemetryId},null,b.formatted())},info:E,loggers:t.InsightsShowInsightsLoggers}}function n(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x,S){var b=t.CustomerAction(l,u,c,p,d,f,v,m,h,g,y,C,x,S),E=q(b.info,{rank:r,type:i,insightType:n,pinEntryPoint:o,source:a,relevanceScore:s});return{name:t.InsightsPinInsightEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({rank:E.rank,type:E.type,insightType:E.insightType,pinEntryPoint:E.pinEntryPoint,source:E.source,relevanceScore:E.relevanceScore},null,b.formatted())},info:E,loggers:t.InsightsPinInsightLoggers}}function o(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x,S,b,E){var _=t.CustomerAction(c,p,d,f,v,m,h,g,y,C,x,S,b,E),w=q(_.info,{insightCount:r,source:i,errorType:n,telemetryId:o,sourceOfError:a,isCancelled1:s,analysisType:l,embedType:u});return{name:t.InsightsGetInsightsEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({insightCount:w.insightCount,source:w.source,errorType:w.errorType,telemetryId:w.telemetryId,sourceOfError:w.sourceOfError,isCancelled1:w.isCancelled1,analysisType:w.analysisType,embedType:w.embedType},null,_.formatted())},info:w,loggers:t.InsightsGetInsightsLoggers}}function a(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x){var S=t.CustomerAction(s,l,u,c,p,d,f,v,m,h,g,y,C,x),b=q(S.info,{feedback:r,columns:i,filters:n,highlights:o,source:a});return{name:t.InsightsFeedbackEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({feedback:b.feedback,columns:b.columns,filters:b.filters,highlights:b.highlights,source:b.source},null,S.formatted())},info:b,loggers:t.InsightsFeedbackLoggers}}function s(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g){var y=t.CustomerAction(n,o,a,s,l,u,c,p,d,f,v,m,h,g),C=q(y.info,{pagesInReport:r,totalVisuals:i});return{name:t.InsightsExploreInsightSessionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({pagesInReport:C.pagesInReport,totalVisuals:C.totalVisuals},null,y.formatted())},info:C,loggers:t.InsightsExploreInsightSessionLoggers}}function l(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x,S,b,E,_){var w=t.CustomerAction(p,d,f,v,m,h,g,y,C,x,S,b,E,_),V=q(w.info,{analysisType:r,numberOfInsights:i,source:n,pagesInReport:o,totalVisuals:a,averageVisualsPerPage:s,telemetryId:l,requestIndex:u,analysisStatus:c});return{name:t.InsightsExploreInsightRequestEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({analysisType:V.analysisType,numberOfInsights:V.numberOfInsights,source:V.source,pagesInReport:V.pagesInReport,totalVisuals:V.totalVisuals,averageVisualsPerPage:V.averageVisualsPerPage,telemetryId:V.telemetryId,requestIndex:V.requestIndex,analysisStatus:V.analysisStatus},null,w.formatted())},info:V,loggers:t.InsightsExploreInsightRequestLoggers}}function u(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y){var C=t.CustomerAction(o,a,s,l,u,c,p,d,f,v,m,h,g,y),x=q(C.info,{visualType:r,displayType:i,visualName:n});return{name:t.EXToggleVisualDisplayEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({visualType:x.visualType,displayType:x.displayType,visualName:x.visualName},null,C.formatted())},info:x,loggers:t.EXToggleVisualDisplayLoggers}}function c(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=t.Verbose(i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=q(g.info,{fromCache:r});return{name:t.EXGetExplorationEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({fromCache:y.fromCache},null,g.formatted())},info:y,loggers:t.EXGetExplorationLoggers}}function p(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C){var x=t.Verbose(a,s,l,u,c,p,d,f,v,m,h,g,y,C),S=q(x.info,{explorationVersion:r,length:i,upgraderCount:n,sectionCount:o});return{name:t.EXDeserializeExplorationEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({explorationVersion:S.explorationVersion,length:S.length,upgraderCount:S.upgraderCount,sectionCount:S.sectionCount},null,x.formatted())},info:S,loggers:t.EXDeserializeExplorationLoggers}}function d(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x,S,b,E,_,w,V,F,P,T,N,D,R,I,j,O,M,A,k,z,B,L,G,H,Q,W,X,K,J,Y){var $=t.CustomerAction(M,A,k,z,B,L,G,H,Q,W,X,K,J,Y),Z=q($.info,{reportGuid:r,originalReportGuid:i,appGuid:n,isDirectQuery:o,isCancelled1:a,isOnPrem:s,source:l,isUsageMetrics:u,groupObjectId:c,visualTypesAndCounts:p,tags:d,isReadonlyGroup:f,permissions:v,scrubUserInfo:m,isB2B:h,enterpriseCapacitySkuTier:g,bookmarkObjectId:y,datasetHost:C,modelId:x,dataCacheMode:S,improvedFilterExperienceState:b,capacityObjectId:E,dbName:_,serviceAppObjectId:w,queryCachingState:V,isBuiltOnSharedDataset:F,datasetEndorsement:P,originalGroupObjectId:T,useMaxParallelQueryData:N,datasetWorkspaceObjectId:D,embedInfo:R,synchronous:I,sectionGuid:j,sectionIndex:O});return{name:t.EXOpenExplorationEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({reportGuid:Z.reportGuid,originalReportGuid:Z.originalReportGuid,appGuid:Z.appGuid,isDirectQuery:Z.isDirectQuery,isCancelled1:Z.isCancelled1,isOnPrem:Z.isOnPrem,source:Z.source,visualTypesAndCounts:Z.visualTypesAndCounts,permissions:Z.permissions,datasetHost:Z.datasetHost,modelId:Z.modelId,dataCacheMode:Z.dataCacheMode,improvedFilterExperienceState:Z.improvedFilterExperienceState,capacityObjectId:Z.capacityObjectId,dbName:Z.dbName,serviceAppObjectId:Z.serviceAppObjectId,queryCachingState:Z.queryCachingState,isBuiltOnSharedDataset:Z.isBuiltOnSharedDataset,datasetEndorsement:Z.datasetEndorsement,originalGroupObjectId:Z.originalGroupObjectId,datasetWorkspaceObjectId:Z.datasetWorkspaceObjectId,embedInfo:Z.embedInfo,sectionGuid:Z.sectionGuid,sectionIndex:Z.sectionIndex},{isUsageMetrics:Z.isUsageMetrics,groupObjectId:Z.groupObjectId,tags:Z.tags,isReadonlyGroup:Z.isReadonlyGroup,scrubUserInfo:Z.scrubUserInfo,isB2B:Z.isB2B,enterpriseCapacitySkuTier:Z.enterpriseCapacitySkuTier,bookmarkObjectId:Z.bookmarkObjectId,useMaxParallelQueryData:Z.useMaxParallelQueryData,synchronous:Z.synchronous},$.formatted())},info:Z,loggers:t.EXOpenExplorationLoggers,shouldLogStartEnd:!0}}function f(r,i,n,o,a,s,l,u,c,p,d,f,v,m){var h=t.Verbose(r,i,n,o,a,s,l,u,c,p,d,f,v,m),g=q(h.info,{});return{name:t.EXExplorationStateApplyImpactEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:g,loggers:t.EXExplorationStateApplyImpactLoggers}}function v(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g){var y=t.CustomerAction(n,o,a,s,l,u,c,p,d,f,v,m,h,g),C=q(y.info,{index:r,canvasLayout:i});return{name:t.EXSwitchSectionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({index:C.index,canvasLayout:C.canvasLayout},null,y.formatted())},info:C,loggers:t.EXSwitchSectionLoggers}}function m(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=t.Verbose(i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=q(g.info,{code:r});return{name:t.EXVisualQueryGeneratorWarningEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({code:y.code},null,g.formatted())},info:y,loggers:t.EXVisualQueryGeneratorWarningLoggers}}function h(r,i,n){var o={code:r,debugInfo:i,message:n};return{name:t.EXVisualQueryGeneratorErrorEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({code:o.code,debugInfo:o.debugInfo,message:o.message},null)},info:o,loggers:t.EXVisualQueryGeneratorErrorLoggers}}function g(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x,S,b,E,_,w,V){var F=t.CustomerAction(f,v,m,h,g,y,C,x,S,b,E,_,w,V),P=q(F.info,{action:r,editor:i,dataType:n,groupCount:o,totalGroupCount:a,groupedValues:s,groupedValuesMin:l,groupedValuesMax:u,ungroupedValues:c,isOtherEnabled:p,hasGroupOnKeys:d});return{name:t.EXGroupsGroupsActionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({action:P.action,editor:P.editor,dataType:P.dataType,groupCount:P.groupCount,totalGroupCount:P.totalGroupCount,groupedValues:P.groupedValues,groupedValuesMin:P.groupedValuesMin,groupedValuesMax:P.groupedValuesMax,ungroupedValues:P.ungroupedValues,isOtherEnabled:P.isOtherEnabled,hasGroupOnKeys:P.hasGroupOnKeys},null,F.formatted())},info:P,loggers:t.EXGroupsGroupsActionLoggers}}function y(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x){var S=t.CustomerAction(s,l,u,c,p,d,f,v,m,h,g,y,C,x),b=q(S.info,{action:r,editor:i,sourceDataType:n,binSize:o,binUnit:a});return{name:t.EXGroupsBinBySizeActionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({action:b.action,editor:b.editor,sourceDataType:b.sourceDataType,binSize:b.binSize,binUnit:b.binUnit},null,S.formatted())},info:b,loggers:t.EXGroupsBinBySizeActionLoggers}}function C(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x,S){var b=t.CustomerAction(l,u,c,p,d,f,v,m,h,g,y,C,x,S),E=q(b.info,{action:r,editor:i,sourceDataType:n,binCount:o,min:a,max:s});return{name:t.EXGroupsBinByCountActionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({action:E.action,editor:E.editor,sourceDataType:E.sourceDataType,binCount:E.binCount,min:E.min,max:E.max},null,b.formatted())},info:E,loggers:t.EXGroupsBinByCountActionLoggers}}function x(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y,C,x){var S=t.CustomerAction(s,l,u,c,p,d,f,v,m,h,g,y,C,x),b=q(S.info,{visualType:r,role:i,sourceRole:n,action:o,groupType:a});return{name:t.EXGroupsUsageEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({visualType:b.visualType,role:b.role,sourceRole:b.sourceRole,action:b.action,groupType:b.groupType},null,S.formatted())},info:b,loggers:t.EXGroupsUsageLoggers}}function S(r,i,n,o){var a={errorType:r,action:i,groupType:n,message:o};return{name:t.EXGroupsErrorEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({errorType:a.errorType,action:a.action,groupType:a.groupType,message:a.message},null)},info:a,loggers:t.EXGroupsErrorLoggers}}function b(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=t.CustomerAction(i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=q(g.info,{operation:r});return{name:t.EXModelChangeEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({operation:y.operation},null,g.formatted())},info:y,loggers:t.EXModelChangeLoggers}}function E(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g){var y=t.CustomerAction(n,o,a,s,l,u,c,p,d,f,v,m,h,g),C=q(y.info,{message:r,actionId:i});return{name:t.EXMeasuresEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({message:C.message,actionId:C.actionId},null,y.formatted())},info:C,loggers:t.EXMeasuresLoggers}}function _(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g){var y=t.CustomerAction(n,o,a,s,l,u,c,p,d,f,v,m,h,g),C=q(y.info,{sourceType:r,targetType:i});return{name:t.EXReportMeasureDataTypeChangeEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({sourceType:C.sourceType,targetType:C.targetType},null,y.formatted())},info:C,loggers:t.EXReportMeasureDataTypeChangeLoggers}}function w(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g){var y=t.CustomerAction(n,o,a,s,l,u,c,p,d,f,v,m,h,g),C=q(y.info,{sourceType:r,targetType:i});return{name:t.EXReportMeasureDataCategoryChangeEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({sourceType:C.sourceType,targetType:C.targetType},null,y.formatted())},info:C,loggers:t.EXReportMeasureDataCategoryChangeLoggers}}function V(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g,y){var C=t.CustomerAction(o,a,s,l,u,c,p,d,f,v,m,h,g,y),x=q(C.info,{dataType:r,sourceTypes:i,targetTypes:n});return{name:t.EXReportMeasureMoveRoleKindEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({dataType:x.dataType,sourceTypes:x.sourceTypes,targetTypes:x.targetTypes},null,C.formatted())},info:x,loggers:t.EXReportMeasureMoveRoleKindLoggers}}function F(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=t.CustomerAction(i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=q(g.info,{daxTemplateName:r});return{name:t.EXQuickCalcMeasureEditedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({daxTemplateName:y.daxTemplateName},null,g.formatted())},info:y,loggers:t.EXQuickCalcMeasureEditedLoggers}}function P(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=t.CustomerAction(i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=q(g.info,{daxTemplateName:r});return{name:t.EXQuickCalcMeasureDeletedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({daxTemplateName:y.daxTemplateName},null,g.formatted())},info:y,loggers:t.EXQuickCalcMeasureDeletedLoggers}}function T(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g){var y=t.Verbose(n,o,a,s,l,u,c,p,d,f,v,m,h,g),C=q(y.info,{visualType:r,fixedRoleByProjectionCount:i});return{name:t.EXVisualDrillableRoleActiveItemsFixedEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({visualType:C.visualType,fixedRoleByProjectionCount:C.fixedRoleByProjectionCount},null,y.formatted())},info:C,loggers:t.EXVisualDrillableRoleActiveItemsFixedLoggers}}function N(r,i){var n=t.ErrorWithStackTrace(r,i),o=q(n.info,{});return{name:t.PersistentStateSerializationErrorEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,n.formatted())},info:o,loggers:t.PersistentStateSerializationErrorLoggers}}function D(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h,g){var y=t.CustomerAction(n,o,a,s,l,u,c,p,d,f,v,m,h,g),C=q(y.info,{errorType:r,count:i});return{name:t.PodSerializationErrorFixedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({errorType:C.errorType,count:C.count},null,y.formatted())},info:C,loggers:t.PodSerializationErrorFixedLoggers}}function R(r,i,n,o,a){var s=t.ErrorWithStackTrace(o,a),l=q(s.info,{type:r,errorCode:i,details:n});return{name:t.SerializationErrorEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({type:l.type,errorCode:l.errorCode,details:l.details},null,s.formatted())},info:l,loggers:t.SerializationErrorLoggers}}function I(r,i,n,o,a,s,l,u,c,p,d,f,v,m){var h=t.Verbose(r,i,n,o,a,s,l,u,c,p,d,f,v,m),g=q(h.info,{});return{name:t.EXEmptyVisualContainerConfigEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:g,loggers:t.EXEmptyVisualContainerConfigLoggers}}function j(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=t.CustomerAction(i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=q(g.info,{sameReport:r});return{name:t.ClipboardServicePasteEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({sameReport:y.sameReport},null,g.formatted())},info:y,loggers:t.ClipboardServicePasteLoggers}}function O(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=t.CustomerAction(i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=q(g.info,{dataVersion:r});return{name:t.ClipboardServiceUnsupportedVersionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({dataVersion:y.dataVersion},null,g.formatted())},info:y,loggers:t.ClipboardServiceUnsupportedVersionLoggers}}function M(r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=t.Verbose(i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=q(g.info,{constructorNames:r});return{name:t.EXLoopingSQExprEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({constructorNames:y.constructorNames},null,g.formatted())},info:y,loggers:t.EXLoopingSQExprLoggers}}function A(r,i,n,o,a,s,l,u,c,p,d,f,v,m){var h=t.Verbose(r,i,n,o,a,s,l,u,c,p,d,f,v,m),g=q(h.info,{});return{name:t.EXGetLinguisticSchemaEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:g,loggers:t.EXGetLinguisticSchemaLoggers}}function k(r,i,n,o,a,s,l,u,c,p,d,f,v,m){var h=t.Verbose(r,i,n,o,a,s,l,u,c,p,d,f,v,m),g=q(h.info,{});return{name:t.EXGetAutoRefreshAdminConfigEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:g,loggers:t.EXGetAutoRefreshAdminConfigLoggers}}function z(r,i,n,o,a,s,l,u,c,p,d,f,v,m){var h=t.Verbose(r,i,n,o,a,s,l,u,c,p,d,f,v,m),g=q(h.info,{});return{name:t.EXGetChangeDetectionAdminConfigEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:g,loggers:t.EXGetChangeDetectionAdminConfigLoggers}}function B(r){var i={message:r};return{name:t.EXAnchorTimeUndefinedEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:U(),formatted:function(){return e.extendFormatted({message:i.message},null)},info:i,loggers:t.EXAnchorTimeUndefinedLoggers}}var U,L=jsCommon.Utility,q=jsCommon.UnionExtensions.mergeUnionType,G=e.telemetry.EventFactories;U=L?L.generateGuid:Function.prototype;var H;!(function(e){e.Normal="Normal",e.EmailSubscription="EmailSubscription",e.ReportInvitation="ReportInvitation",e.SubscribeOthers="SubscribeOthers",e.SmartAlerts="SmartAlerts",e.Commenting="Commenting",e.Invalid="Invalid"})(H=t.OpenExplorationSource||(t.OpenExplorationSource={})),t.InsightsViewInsightInFocusEventName="PBI.Insights.ViewInsightInFocus",t.InsightsViewInsightInFocus=r,G[t.InsightsViewInsightInFocusEventName]=function(r){return e.telemetryEventFactory(t.InsightsViewInsightInFocusEventName,r,t.InsightsViewInsightInFocusLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.InsightsShowInsightsEventName="PBI.Insights.ShowInsights",t.InsightsShowInsights=i,G[t.InsightsShowInsightsEventName]=function(r){return e.telemetryEventFactory(t.InsightsShowInsightsEventName,r,t.InsightsShowInsightsLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.InsightsPinInsightEventName="PBI.Insights.PinInsight",t.InsightsPinInsight=n,G[t.InsightsPinInsightEventName]=function(r){return e.telemetryEventFactory(t.InsightsPinInsightEventName,r,t.InsightsPinInsightLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.InsightsGetInsightsEventName="PBI.Insights.GetInsights",t.InsightsGetInsights=o,G[t.InsightsGetInsightsEventName]=function(r){return e.telemetryEventFactory(t.InsightsGetInsightsEventName,r,t.InsightsGetInsightsLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.InsightsFeedbackEventName="PBI.Insights.Feedback",t.InsightsFeedback=a,G[t.InsightsFeedbackEventName]=function(r){return e.telemetryEventFactory(t.InsightsFeedbackEventName,r,t.InsightsFeedbackLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.InsightsExploreInsightSessionEventName="PBI.Insights.Explore.InsightSession",t.InsightsExploreInsightSession=s,G[t.InsightsExploreInsightSessionEventName]=function(r){return e.telemetryEventFactory(t.InsightsExploreInsightSessionEventName,r,t.InsightsExploreInsightSessionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.InsightsExploreInsightRequestEventName="PBI.Insights.Explore.InsightRequest",t.InsightsExploreInsightRequest=l,G[t.InsightsExploreInsightRequestEventName]=function(r){return e.telemetryEventFactory(t.InsightsExploreInsightRequestEventName,r,t.InsightsExploreInsightRequestLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXToggleVisualDisplayEventName="PBI.EX.ToggleVisualDisplay",t.EXToggleVisualDisplay=u,G[t.EXToggleVisualDisplayEventName]=function(r){return e.telemetryEventFactory(t.EXToggleVisualDisplayEventName,r,t.EXToggleVisualDisplayLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXGetExplorationEventName="PBI.EX.GetExploration",t.EXGetExploration=c,G[t.EXGetExplorationEventName]=function(r){return e.telemetryEventFactory(t.EXGetExplorationEventName,r,t.EXGetExplorationLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXDeserializeExplorationEventName="PBI.EX.DeserializeExploration",t.EXDeserializeExploration=p,G[t.EXDeserializeExplorationEventName]=function(r){return e.telemetryEventFactory(t.EXDeserializeExplorationEventName,r,t.EXDeserializeExplorationLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXOpenExplorationEventName="PBI.EX.OpenExploration",t.EXOpenExploration=d,G[t.EXOpenExplorationEventName]=function(r){return e.telemetryEventFactory(t.EXOpenExplorationEventName,r,t.EXOpenExplorationLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isUsageMetrics","groupObjectId","tags","isReadonlyGroup","scrubUserInfo","isB2B","enterpriseCapacitySkuTier","bookmarkObjectId","useMaxParallelQueryData","synchronous"])},t.EXExplorationStateApplyImpactEventName="PBI.EX.ExplorationStateApplyImpact",t.EXExplorationStateApplyImpact=f,G[t.EXExplorationStateApplyImpactEventName]=function(r){return e.telemetryEventFactory(t.EXExplorationStateApplyImpactEventName,r,t.EXExplorationStateApplyImpactLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXSwitchSectionEventName="PBI.EX.SwitchSection",t.EXSwitchSection=v,G[t.EXSwitchSectionEventName]=function(r){return e.telemetryEventFactory(t.EXSwitchSectionEventName,r,t.EXSwitchSectionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXVisualQueryGeneratorWarningEventName="PBI.EX.VisualQueryGeneratorWarning",t.EXVisualQueryGeneratorWarning=m,G[t.EXVisualQueryGeneratorWarningEventName]=function(r){return e.telemetryEventFactory(t.EXVisualQueryGeneratorWarningEventName,r,t.EXVisualQueryGeneratorWarningLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXVisualQueryGeneratorErrorEventName="PBI.EX.VisualQueryGeneratorError",t.EXVisualQueryGeneratorError=h,G[t.EXVisualQueryGeneratorErrorEventName]=function(r){return e.telemetryEventFactory(t.EXVisualQueryGeneratorErrorEventName,r,t.EXVisualQueryGeneratorErrorLoggers,void 0,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null)},t.EXGroupsGroupsActionEventName="PBI.EX.Groups.GroupsAction",t.EXGroupsGroupsAction=g,G[t.EXGroupsGroupsActionEventName]=function(r){return e.telemetryEventFactory(t.EXGroupsGroupsActionEventName,r,t.EXGroupsGroupsActionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXGroupsBinBySizeActionEventName="PBI.EX.Groups.BinBySizeAction",t.EXGroupsBinBySizeAction=y,G[t.EXGroupsBinBySizeActionEventName]=function(r){return e.telemetryEventFactory(t.EXGroupsBinBySizeActionEventName,r,t.EXGroupsBinBySizeActionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXGroupsBinByCountActionEventName="PBI.EX.Groups.BinByCountAction",t.EXGroupsBinByCountAction=C,G[t.EXGroupsBinByCountActionEventName]=function(r){return e.telemetryEventFactory(t.EXGroupsBinByCountActionEventName,r,t.EXGroupsBinByCountActionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXGroupsUsageEventName="PBI.EX.Groups.Usage",t.EXGroupsUsage=x,G[t.EXGroupsUsageEventName]=function(r){return e.telemetryEventFactory(t.EXGroupsUsageEventName,r,t.EXGroupsUsageLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXGroupsErrorEventName="PBI.EX.Groups.Error",t.EXGroupsError=S,G[t.EXGroupsErrorEventName]=function(r){return e.telemetryEventFactory(t.EXGroupsErrorEventName,r,t.EXGroupsErrorLoggers,void 0,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null)},t.EXModelChangeEventName="PBI.EX.ModelChange",t.EXModelChange=b,G[t.EXModelChangeEventName]=function(r){return e.telemetryEventFactory(t.EXModelChangeEventName,r,t.EXModelChangeLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXMeasuresEventName="PBI.EX.Measures",t.EXMeasures=E,G[t.EXMeasuresEventName]=function(r){return e.telemetryEventFactory(t.EXMeasuresEventName,r,t.EXMeasuresLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXReportMeasureDataTypeChangeEventName="PBI.EX.ReportMeasureDataTypeChange",t.EXReportMeasureDataTypeChange=_,G[t.EXReportMeasureDataTypeChangeEventName]=function(r){return e.telemetryEventFactory(t.EXReportMeasureDataTypeChangeEventName,r,t.EXReportMeasureDataTypeChangeLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXReportMeasureDataCategoryChangeEventName="PBI.EX.ReportMeasureDataCategoryChange",t.EXReportMeasureDataCategoryChange=w,G[t.EXReportMeasureDataCategoryChangeEventName]=function(r){return e.telemetryEventFactory(t.EXReportMeasureDataCategoryChangeEventName,r,t.EXReportMeasureDataCategoryChangeLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXReportMeasureMoveRoleKindEventName="PBI.EX.ReportMeasureMoveRoleKind",t.EXReportMeasureMoveRoleKind=V,G[t.EXReportMeasureMoveRoleKindEventName]=function(r){return e.telemetryEventFactory(t.EXReportMeasureMoveRoleKindEventName,r,t.EXReportMeasureMoveRoleKindLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXQuickCalcMeasureEditedEventName="PBI.EX.QuickCalcMeasureEdited",t.EXQuickCalcMeasureEdited=F,G[t.EXQuickCalcMeasureEditedEventName]=function(r){return e.telemetryEventFactory(t.EXQuickCalcMeasureEditedEventName,r,t.EXQuickCalcMeasureEditedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXQuickCalcMeasureDeletedEventName="PBI.EX.QuickCalcMeasureDeleted",t.EXQuickCalcMeasureDeleted=P,G[t.EXQuickCalcMeasureDeletedEventName]=function(r){return e.telemetryEventFactory(t.EXQuickCalcMeasureDeletedEventName,r,t.EXQuickCalcMeasureDeletedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXVisualDrillableRoleActiveItemsFixedEventName="PBI.EX.VisualDrillableRoleActiveItemsFixed",t.EXVisualDrillableRoleActiveItemsFixed=T,G[t.EXVisualDrillableRoleActiveItemsFixedEventName]=function(r){return e.telemetryEventFactory(t.EXVisualDrillableRoleActiveItemsFixedEventName,r,t.EXVisualDrillableRoleActiveItemsFixedLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.PersistentStateSerializationErrorEventName="PBI.PersistentState.SerializationError",t.PersistentStateSerializationError=N,G[t.PersistentStateSerializationErrorEventName]=function(r){return e.telemetryEventFactory(t.PersistentStateSerializationErrorEventName,r,t.PersistentStateSerializationErrorLoggers,t.ErrorWithStackTraceEventName,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null)},t.PodSerializationErrorFixedEventName="PBI.Pod.SerializationErrorFixed",t.PodSerializationErrorFixed=D,G[t.PodSerializationErrorFixedEventName]=function(r){return e.telemetryEventFactory(t.PodSerializationErrorFixedEventName,r,t.PodSerializationErrorFixedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.SerializationErrorEventName="PBI.SerializationError",t.SerializationError=R,G[t.SerializationErrorEventName]=function(r){return e.telemetryEventFactory(t.SerializationErrorEventName,r,t.SerializationErrorLoggers,t.ErrorWithStackTraceEventName,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null);
},t.EXEmptyVisualContainerConfigEventName="PBI.EX.EmptyVisualContainerConfig",t.EXEmptyVisualContainerConfig=I,G[t.EXEmptyVisualContainerConfigEventName]=function(r){return e.telemetryEventFactory(t.EXEmptyVisualContainerConfigEventName,r,t.EXEmptyVisualContainerConfigLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.ClipboardServicePasteEventName="PBI.ClipboardService.Paste",t.ClipboardServicePaste=j,G[t.ClipboardServicePasteEventName]=function(r){return e.telemetryEventFactory(t.ClipboardServicePasteEventName,r,t.ClipboardServicePasteLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.ClipboardServiceUnsupportedVersionEventName="PBI.ClipboardService.UnsupportedVersion",t.ClipboardServiceUnsupportedVersion=O,G[t.ClipboardServiceUnsupportedVersionEventName]=function(r){return e.telemetryEventFactory(t.ClipboardServiceUnsupportedVersionEventName,r,t.ClipboardServiceUnsupportedVersionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXLoopingSQExprEventName="PBI.EX.LoopingSQExpr",t.EXLoopingSQExpr=M,G[t.EXLoopingSQExprEventName]=function(r){return e.telemetryEventFactory(t.EXLoopingSQExprEventName,r,t.EXLoopingSQExprLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXGetLinguisticSchemaEventName="PBI.EX.GetLinguisticSchema",t.EXGetLinguisticSchema=A,G[t.EXGetLinguisticSchemaEventName]=function(r){return e.telemetryEventFactory(t.EXGetLinguisticSchemaEventName,r,t.EXGetLinguisticSchemaLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXGetAutoRefreshAdminConfigEventName="PBI.EX.GetAutoRefreshAdminConfig",t.EXGetAutoRefreshAdminConfig=k,G[t.EXGetAutoRefreshAdminConfigEventName]=function(r){return e.telemetryEventFactory(t.EXGetAutoRefreshAdminConfigEventName,r,t.EXGetAutoRefreshAdminConfigLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXGetChangeDetectionAdminConfigEventName="PBI.EX.GetChangeDetectionAdminConfig",t.EXGetChangeDetectionAdminConfig=z,G[t.EXGetChangeDetectionAdminConfigEventName]=function(r){return e.telemetryEventFactory(t.EXGetChangeDetectionAdminConfigEventName,r,t.EXGetChangeDetectionAdminConfigLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXAnchorTimeUndefinedEventName="PBI.EX.AnchorTimeUndefined",t.EXAnchorTimeUndefined=B,G[t.EXAnchorTimeUndefinedEventName]=function(r){return e.telemetryEventFactory(t.EXAnchorTimeUndefinedEventName,r,t.EXAnchorTimeUndefinedLoggers,void 0,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null)}})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return void 0!==e.children}function r(e){return!t(e)}e.isBookmarkGroup=t,e.isStateBookmark=r})(t=e.Bookmark||(e.Bookmark={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return void 0===e&&(e=[]),o.extendWithName(o.extendWithId(e))}function n(r){var i=t.constants.DefaultSchemaName,n=r.capacityObjectId&&void 0===r.queryCachingState?void 0:2===r.queryCachingState,o=r.datasetHost;return{type:e.common.constants.dsrDataReaderType,id:r.id,name:i,dsr:{schemaName:i,vsName:r.vsName,dbName:r.dbName,modelId:r.id,isQueryCachingEnabled:n,lastRefreshTime:r.lastRefreshTime,isLimitedParallelQueryModel:o===e.common.contracts.DatasetHost.ASOnPrem}}}var o=jsCommon.ArrayExtensions,a=e.data.DataReaderUtils;r.createDataSourceArray=i,r.dataSourceForModel=n;var s;!(function(e){function t(e){return _.includes(Object.keys(e),"extends")}function r(e,t){if(!_.isEmpty(e)){var r,i=a.findSchemas(t);return r=_.isEmpty(i)?e:_.filter(e,(function(e){return _.includes(i,e.name)})),n(r)}}function i(e,r){if(!_.isEmpty(e)){var i=a.findSchemas(r);return _.isEmpty(i)?_.filter(e,(function(e){return!t(e)})):_.chain(e).filter((function(e){return _.includes(i,e.name)})).map((function(r){return t(r)?_.find(e,(function(e){return e.name===r.extends})):r})).uniq().value()}}function n(e){return _.map(e,(function(e){return e[a.readerType(e)]}))}e.isExtension=t,e.referenced=r,e.queried=i,e.dataReaderDataSources=n})(s=r.DataSource||(r.DataSource={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,i,n,a){var u=t.constants,c={},d={useNewFilterPaneExperience:!0,allowChangeFilterTypes:!0};return n.featureSwitches.newVisualContainerHeader&&(d.useStylableVisualContainerHeader=!0),n.featureSwitches.exportDataMode&&(d.exportDataMode=1),null!=a?s.setValue(c,{objectName:"section",propertyName:"verticalAlignment"},null,l.text(a)):s.setValue(c,{objectName:"section",propertyName:"verticalAlignment"},null,l.text(p.top)),{themeCollection:{baseTheme:t.util.ThemeUtils.getCurrentBaseThemeMetadata(n)},id:0,width:u.ExploreCanvasConstants.DefaultCanvasWidth,height:u.ExploreCanvasConstants.DefaultCanvasHeight,dataSources:r.createDataSourceArray(),sections:o.extendWithId([{id:0,name:"ReportSection",displayName:e,visualContainers:i,visualContainerGroups:i.slice(),filters:[],size:{displayOption:1,width:u.ExploreCanvasConstants.DefaultWidescreenWidth,height:u.ExploreCanvasConstants.DefaultWidescreenHeight}}]),settings:_.isEmpty(d)?void 0:d,objects:c}}var n,o=jsCommon.ArrayExtensions,a=e.data.createDisplayNameGetter,s=e.data.DataViewObjectDefinitions,l=e.data.SQExprBuilder;!(function(e){e[e.Unspecified=0]="Unspecified",e[e.QnaSuggestQuestions=1]="QnaSuggestQuestions"})(n=r.LinguisticSchemaSyncVersion||(r.LinguisticSchemaSyncVersion={})),r.createDefaultExploration=i;var u;!(function(t){t.CDM="CDM",t.APR="APR",t.Type=e.createEnumType([{value:t.APR,displayName:function(e){return e.get("PageRefresh_APR")}},{value:t.CDM,displayName:function(e){return e.get("ChangeDetection")}}])})(u=r.AutoPageRefreshOption||(r.AutoPageRefreshOption={}));var c;!(function(e){e[e.Top=0]="Top",e[e.Middle=1]="Middle"})(c=r.SectionAlignmentOption||(r.SectionAlignmentOption={}));var p;!(function(t){t.top="Top",t.middle="Middle",t.Type=e.createEnumType([{value:t.top,displayName:function(e){return e.get("Top")}},{value:t.middle,displayName:function(e){return e.get("Middle")}}])})(p=r.SectionAlignmentPosition||(r.SectionAlignmentPosition={})),r.ExplorationObjectDescriptors={outspacePane:{displayName:a("Exploration_FilterPane"),properties:{expanded:{type:{bool:!0}},visible:{type:{bool:!0}}}},section:{displayName:a("PagePropertyPane_PageAlignment"),properties:{verticalAlignment:{type:{enumeration:p.Type}}}}};var d=(function(){function e(e){"string"==typeof e?this.originalExplorationJSON=e:this.originalExploration=e}return e.prototype.value=function(){return!this.originalExploration&&this.originalExplorationJSON&&(this.originalExploration=jsCommon.JsonExtensions.tryParseJSON(this.originalExplorationJSON),this.originalExplorationJSON=void 0),this.originalExploration},e.Empty=new e,e})();r.OriginalExploration=d})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.ObjectType="filter",e.CommonObjectDescriptors={general:{properties:{requireSingleSelect:{type:{bool:!0}}}}}})(t=e.FilterContainer||(e.FilterContainer={}));var r;!(function(e){e[e.Categorical=0]="Categorical",e[e.Range=1]="Range",e[e.Advanced=2]="Advanced",e[e.Passthrough=3]="Passthrough",e[e.Visual=4]="Visual",e[e.TopN=5]="TopN",e[e.Include=6]="Include",e[e.Exclude=7]="Exclude",e[e.RelativeDate=8]="RelativeDate",e[e.Tuple=9]="Tuple",e[e.RelativeTime=10]="RelativeTime"})(r=e.FilterType||(e.FilterType={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Self=1]="Self",e[e.Slicer=2]="Slicer"})(t=e.CollectedFilterSource||(e.CollectedFilterSource={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.createDisplayNameGetter;!(function(e){function r(e){return _.filter(e,(function(e){return!e.transient}))}e.objectDescriptors={background:{displayName:i("PagePropertyPane_PageBackground"),properties:{color:{displayName:i("PagePropertyPane_PageBackgroundColor"),type:{fill:{solid:{color:!0}}}},image:{type:{image:{}}},transparency:{displayName:i("Transparency"),type:{numeric:!0}}}},displayArea:{displayName:i("PagePropertyPane_PageAlignment"),properties:{verticalAlignment:{displayName:i("PagePropertyPane_PageVerticalAlignment"),type:{enumeration:t.SectionAlignmentPosition.Type}}}},outspace:{displayName:i("PagePropertyPane_Outspace"),properties:{color:{displayName:i("PagePropertyPane_PageBackgroundColor"),type:{fill:{solid:{color:!0}}}},image:{type:{image:{}}},transparency:{displayName:i("Transparency"),type:{numeric:!0}}}},outspacePane:{displayName:i("Exploration_FilterPane"),properties:{backgroundColor:{displayName:i("PagePropertyPane_OutspacePane_BackgroundColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_OutspacePane_BackgroundColorTooltip")},transparency:{displayName:i("Transparency"),type:{numeric:!0},description:i("PagePropertyPane_OutspacePane_BackgroundTransparencyTooltip")},foregroundColor:{displayName:i("PagePropertyPane_OutspacePane_ForegroundColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_OutspacePane_ForegroundColorTooltip")},titleSize:{displayName:i("Visual_AxisTitleTextSize"),type:{integer:!0},description:i("PagePropertyPane_OutspacePane_TitleSizeTooltip")},searchTextSize:{displayName:i("PagePropertyPane_OutspacePane_SearchTextSize"),type:{integer:!0},description:i("PagePropertyPane_OutspacePane_SearchTextSizeTooltip")},headerSize:{displayName:i("PagePropertyPane_OutspacePane_HeaderSize"),type:{integer:!0},description:i("PagePropertyPane_OutspacePane_HeaderSizeTooltip")},fontFamily:{displayName:i("Visual_FontFamily"),type:{formatting:{fontFamily:!0}},description:i("PagePropertyPane_OutspacePane_FontFamilyTooltip")},border:{displayName:i("Visual_Border"),type:{bool:!0},description:i("PagePropertyPane_OutspacePane_LeftBorderTooltip")},borderColor:{displayName:i("PagePropertyPane_FilterCards_BorderColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_OutspacePane_BorderColorTooltip")},inputBoxColor:{displayName:i("PagePropertyPane_FilterCards_InputBoxColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_OutspacePane_InputBoxColorTooltip")},width:{displayName:i("PagePropertyPane_PageSizeWidth"),type:{integer:!0}}}},filterCard:{displayName:i("PagePropertyPane_FilterCards"),properties:{backgroundColor:{displayName:i("PagePropertyPane_OutspacePane_BackgroundColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_FilterCards_BackgroundColorTooltip")},transparency:{displayName:i("Transparency"),type:{integer:!0},description:i("PagePropertyPane_FilterCards_BackgroundTransparencyTooltip")},border:{displayName:i("Visual_Border"),type:{bool:!0},description:i("PagePropertyPane_FilterCards_BorderTooltip")},borderColor:{displayName:i("PagePropertyPane_FilterCards_BorderColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_FilterCards_BorderColorTooltip")},foregroundColor:{displayName:i("PagePropertyPane_OutspacePane_ForegroundColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_FilterCards_ForegroundColorTooltip")},textSize:{displayName:i("Visual_TextSize"),type:{integer:!0},description:i("PagePropertyPane_FilterCards_TextSizeTooltip")},fontFamily:{displayName:i("Visual_FontFamily"),type:{formatting:{fontFamily:!0}},description:i("PagePropertyPane_FilterCards_FontFamilyTooltip")},inputBoxColor:{displayName:i("PagePropertyPane_FilterCards_InputBoxColor"),type:{fill:{solid:{color:!0}}},description:i("PagePropertyPane_FilterCards_InputBoxColorTooltip")}}},pageRefresh:{displayName:i("PageRefresh"),properties:{show:{displayName:i("Show"),type:{bool:!0}},refreshType:{displayName:i("AutoPageRefreshType"),type:{enumeration:t.AutoPageRefreshOption.Type}},duration:{displayName:i("Duration"),type:{duration:!0}}}}},e.filterTransient=r})(r=t.Section||(t.Section={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.SnapshotReportType="Report";var t;!(function(e){e[e.Static=0]="Static",e[e.Interactive=1]="Interactive"})(t=e.EmbedType||(e.EmbedType={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r){return n(!1,r&&r.visibleOnly,e,t)}function i(e){return o(e)?s.isHidden(e):t.VisualContainer.isHidden(e.config.singleVisual)}function n(e,t,r,a){for(var s=0,l=r;s<l.length;s++){var u=l[s],c=e||i(u);t&&c||(a(u,c),o(u)&&n(c,t,u.children,a))}}function o(e){return!!e.children}function a(e){return!e.children}var s,l=e.data.createDisplayNameGetter;!(function(e){function t(e){return e.isHidden}function r(e,t){e.isHidden=t}function i(e,t){e.displayName=t}e.objectType="visualContainerGroup",e.objectDescriptors={background:{displayName:l("Visual_Background"),properties:{show:{displayName:l("Visual_Show"),type:{bool:!0}},color:{displayName:l("Visual_Background_Color"),description:l("VisualGroup_Background_ColorDescription"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:l("Transparency"),description:l("Visual_Background_TransparencyDescription"),type:{numeric:!0}}}},general:{displayName:l("Visual_General_Properties"),properties:{x:{displayName:l("Visual_General_Properties_X_Coordinate"),type:{numeric:!0}},y:{displayName:l("Visual_General_Properties_Y_Coordinate"),type:{numeric:!0}},width:{displayName:l("Visual_General_Properties_Width"),type:{numeric:!0}},height:{displayName:l("Visual_General_Properties_Height"),type:{numeric:!0}},altText:{displayName:l("Visual_General_Properties_Description"),placeHolderText:l("Visual_General_Properties_Description_Placeholder"),type:{formatting:{altText:!0}}}}}},e.isHidden=t,e.setHidden=r,e.setDisplayName=i})(s=t.VisualContainerGroup||(t.VisualContainerGroup={})),t.traverseVisualContainerGroups=r,t.isVisualContainerGroup=o,t.isVisualContainer=a})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.createDisplayNameGetter,n=e.data.DataViewObjectDefinitions;!(function(r){function i(e){return e.type||t.VisualLink.Back}r.Back="Back",r.Bookmark="Bookmark",r.Drillthrough="Drillthrough",r.PageNavigation="PageNavigation",r.Qna="Qna",r.WebUrl="WebUrl",r.Type=e.createEnumType([{value:r.Back,displayName:function(e){return e.get("Generic_Back")}},{value:r.Bookmark,displayName:function(e){return e.get("Generic_Bookmark")}},{value:r.Drillthrough,displayName:function(e){return e.get("Drillthrough_Preview")}},{value:r.PageNavigation,displayName:function(e){return e.get("PageNavigation")}},{value:r.Qna,displayName:function(e){return e.get("Generic_Qna")}},{value:r.WebUrl,displayName:function(e){return e.get("Web_Url")}}]),r.getType=i,r.BookmarkNone="",r.SectionNone=""})(r=t.VisualLink||(t.VisualLink={}));var o;!(function(t){function r(e){return e.type}t.Default="Default",t.Canvas="Canvas",t.Type=e.createEnumType([{value:t.Default,displayName:function(e){return e.get("Default")}},{value:t.Canvas,displayName:function(e){return e.get("ReportPage")}}]),t.getType=r,t.SectionAuto="___AUTO___"})(o=t.VisualTooltip||(t.VisualTooltip={}));var a;!(function(e){e.NoSection="none"})(a=t.VisualHeaderTooltip||(t.VisualHeaderTooltip={}));var s;!(function(e){function t(e,t){return void 0===t&&(t=!1),!!e&&(e.show===!1||void 0===e.show&&t)}e.isHidden=t})(s=t.VisualTitle||(t.VisualTitle={}));var l;!(function(e){function t(e,t){if(e){var r=t.serializeVisualContainer(e);return t.deserializeCanvasItem(r,!0)}}function n(e){return!!e.display&&"hidden"===e.display.mode}function a(e,t){t?e.display={mode:"hidden"}:e.display=void 0}e.EmptyConfig={singleVisual:{visualType:"uninitializedVisual"}},jsCommon.FreezeUtility.deepFreeze(e.EmptyConfig),e.CommonObjectDescriptors={title:{displayName:i("Visual_Title"),description:i("Visual_TitleDescription"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},text:{displayName:i("Visual_Title_Text"),description:i("Visual_Title_TextDescription"),type:{text:!0},suppressFormatPainterCopy:!0},titleWrap:{displayName:i("Visual_Word_Wrap"),type:{bool:!0}},fontColor:{displayName:i("Visual_FontColor"),description:i("Visual_Title_FontColorDescription"),type:{fill:{solid:{color:!0}}}},background:{displayName:i("Background_Color"),description:i("Visual_Title_BackgroundColorDescription"),type:{fill:{solid:{color:{nullable:!0}}}}},alignment:{displayName:i("Visual_Title_Alignment"),description:i("Visual_Title_AlignmentDescription"),type:{formatting:{alignment:!0}}},fontSize:{displayName:i("Visual_TextSize"),description:i("Visual_Title_TextSizeDescription"),type:{formatting:{fontSize:!0}}},fontFamily:{displayName:i("Visual_FontFamily"),type:{formatting:{fontFamily:!0}}}}},background:{displayName:i("Visual_Background"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},color:{displayName:i("Visual_Background_Color"),description:i("Visual_Background_ColorDescription"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:i("Transparency"),description:i("Visual_Background_TransparencyDescription"),type:{numeric:!0}}}},lockAspect:{displayName:i("Visual_BasicShape_LockAspect"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}}}},general:{displayName:i("Visual_General_Properties"),properties:{x:{displayName:i("Visual_General_Properties_X_Coordinate"),type:{numeric:!0}},y:{displayName:i("Visual_General_Properties_Y_Coordinate"),type:{numeric:!0}},width:{displayName:i("Visual_General_Properties_Width"),type:{numeric:!0}},height:{displayName:i("Visual_General_Properties_Height"),type:{numeric:!0}},altText:{displayName:i("Visual_General_Properties_Description"),placeHolderText:i("Visual_General_Properties_Description_Placeholder"),type:{formatting:{altText:!0}}},allowBinnedLineSample:{displayName:i("Visual_General_HighDensitySampling"),description:i("Visual_General_HighDensitySamplingDescription"),type:{bool:!0}},allowOverlappingPointsSample:{displayName:i("Visual_General_HighDensitySampling"),description:i("Visual_General_HighDensitySamplingDescription"),type:{bool:!0}}}},border:{displayName:i("Visual_Border"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},color:{displayName:i("Visual_Border_Color"),type:{fill:{solid:{color:!0}}}},radius:{displayName:i("Visual_Radius"),type:{numeric:!0}}}},visualLink:{displayName:i("Visual_VisualLink"),suppressFormatPainterCopy:!0,properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},type:{displayName:i("Type"),description:i("Visual_VisualLink_Type_Description"),type:{enumeration:r.Type}},bookmark:{displayName:i("Generic_Bookmark"),description:i("Visual_VisualLink_Bookmark_Description"),type:{reference:{bookmark:!0}}},disabledTooltip:{displayName:i("Disabled_Tooltip"),type:{text:!0}},drillthroughSection:{displayName:i("Destination"),type:{reference:{section:!0}}},enabledTooltip:{displayName:i("Enabled_Tooltip"),type:{text:!0}},navigationSection:{displayName:i("Destination"),type:{reference:{section:!0}}},tooltip:{displayName:i("Tooltip"),description:i("Visual_VisualLink_Tooltip_Description"),type:{text:!0}},webUrl:{displayName:i("Web_Url"),type:{misc:{webUrl:!0}}}}},visualTooltip:{displayName:i("Tooltip"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},type:{displayName:i("Type"),description:i("Visual_Tooltip_Type_Description"),type:{enumeration:o.Type}},section:{displayName:i("Page"),description:i("Visual_Tooltip_Section_Description"),type:{reference:{section:!0}}},titleFontColor:{displayName:i("Visual_Label_FontColor"),description:i("Visual_Tooltip_Title_FontColorDescription"),type:{fill:{solid:{color:!0}}}},valueFontColor:{displayName:i("Visual_Value_FontColor"),description:i("Visual_Tooltip_Value_FontColorDescription"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:i("Visual_TextSize"),description:i("Visual_Tooltip_TextSizeDescription"),type:{formatting:{fontSize:!0}}},fontFamily:{displayName:i("Visual_FontFamily"),description:i("Visual_Tooltip_FontFamilyDescription"),type:{formatting:{fontFamily:!0}}},background:{displayName:i("Background_Color"),description:i("Visual_Tooltip_BackgroundColorDescription"),type:{fill:{solid:{color:{nullable:!0}}}}},transparency:{displayName:i("Transparency"),description:i("Visual_Tooltip_BackgroundTransparencyDescription"),type:{numeric:!0}}}},stylePreset:{displayName:i("Visual_Table_StylePreset_SliceTitle"),properties:{name:{displayName:i("Visual_Table_StylePreset_SliceTitle"),type:{formatting:{stylePreset:!0}}}}},visualHeader:{displayName:i("Visual_Header"),description:i("VisualHeader_Toggle_Description"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},background:{displayName:i("Background_Color"),description:i("VisualHeader_Background_ColorDescription"),type:{fill:{solid:{color:!0}}}},border:{displayName:i("Visual_Border"),description:i("Visual_Border"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:i("Transparency"),description:i("VisualHeader_Background_TransparencyDescription"),type:{numeric:!0}},foreground:{displayName:i("VisualHeader_Foreground_Color"),description:i("VisualHeader_Foreground_ColorDescription"),type:{fill:{solid:{color:!0}}}},showVisualInformationButton:{displayName:i("VisualHeader_ShowVisualInformationButton"),description:i("VisualHeader_ShowVisualInformationButton_Description"),type:{bool:!0}},showVisualWarningButton:{displayName:i("VisualHeader_ShowVisualWarningButton"),description:i("VisualHeader_ShowVisualWarningButton_Description"),type:{bool:!0}},showVisualErrorButton:{displayName:i("VisualHeader_ShowVisualErrorButton"),description:i("VisualHeader_ShowVisualErrorButton_Description"),type:{bool:!0}},showDrillRoleSelector:{displayName:i("VisualHeader_ShowDrillRoleSelector"),description:i("VisualHeader_ShowDrillRoleSelector_Description"),type:{bool:!0}},showDrillUpButton:{displayName:i("VisualHeader_ShowDrillUpButton"),description:i("VisualHeader_ShowDrillUpButton_Description"),type:{bool:!0}},showDrillToggleButton:{displayName:i("VisualHeader_ShowDrillToggleButton"),description:i("VisualHeader_ShowDrillToggleButton_Description"),type:{bool:!0}},showDrillDownLevelButton:{displayName:i("VisualHeader_ShowDrillDownLevelButton"),description:i("VisualHeader_ShowDrillDownLevelButton_Description"),type:{bool:!0}},showDrillDownExpandButton:{displayName:i("VisualHeader_ShowDrillDownExpandButton"),description:i("VisualHeader_ShowDrillDownExpandButton_Description"),type:{bool:!0}},showPinButton:{displayName:i("VisualHeader_ShowPinButton"),description:i("VisualHeader_ShowPinButton_Description"),type:{bool:!0}},showFilterRestatementButton:{displayName:i("VisualHeader_ShowFilterRestatementButton"),description:i("VisualHeader_ShowFilterRestatementButton_Description"),type:{bool:!0}},showFocusModeButton:{displayName:i("VisualHeader_ShowFocusModeButton"),description:i("VisualHeader_ShowFocusModeButton_Description"),type:{bool:!0}},showCopyVisualImageButton:{displayName:i("VisualHeader_ShowCopyVisualImageButton"),description:i("VisualHeader_ShowCopyVisualImageButton_Description"),type:{bool:!0}},showSeeDataLayoutToggleButton:{displayName:i("VisualHeader_ShowSeeDataLayoutToggleButton"),description:i("VisualHeader_ShowSeeDataLayoutToggleButton_Description"),type:{bool:!0}},showOptionsMenu:{displayName:i("VisualHeader_ShowOptionsMenu"),description:i("VisualHeader_ShowOptionsMenu_Description"),type:{bool:!0}},showCommentButton:{displayName:i("VisualHeader_ShowCommentButton"),description:i("VisualHeader_ShowCommentButton_Description"),type:{bool:!0}},showTooltipButton:{displayName:i("VisualHeader_ShowVisualHeaderTooltip"),description:i("VisualHeader_ShowVisualHeaderTooltip_Description"),type:{bool:!0}},showPersonalizeVisualButton:{displayName:i("VisualHeader_ShowPersonalizeVisualButton"),description:i("VisualHeader_ShowPersonalizeVisualButton_Description"),type:{bool:!0}}}},visualHeaderTooltip:{displayName:i("VisualHeaderTooltip"),properties:{section:{displayName:i("ReportPage"),description:i("Visual_Tooltip_Section_Description"),type:{reference:{section:!0}}},text:{displayName:i("VisualHeaderTooltip_Text"),description:i("VisualHeaderTooltip_Text_Description"),type:{text:!0}},titleFontColor:{displayName:i("Generic_Color"),description:i("VisualHeaderTooltip_FontColorDescription"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:i("Visual_TextSize"),description:i("Visual_Tooltip_TextSizeDescription"),type:{formatting:{fontSize:!0}}},fontFamily:{displayName:i("Visual_FontFamily"),description:i("Visual_Tooltip_FontFamilyDescription"),type:{formatting:{fontFamily:!0}}},background:{displayName:i("Background_Color"),description:i("Visual_Tooltip_BackgroundColorDescription"),type:{fill:{solid:{color:{nullable:!0}}}}},transparency:{displayName:i("Transparency"),description:i("Visual_Tooltip_BackgroundTransparencyDescription"),type:{numeric:!0}}}}},e.clone=t,e.isHidden=n,e.setHidden=a})(l=t.VisualContainer||(t.VisualContainer={}));var u;!(function(e){function t(e){if(e){var t={visualType:e.visualType};e.syncGroup&&(t.syncGroup=_.cloneDeep(e.syncGroup)),e.columnProperties&&(t.columnProperties=_.cloneDeep(e.columnProperties)),e.query&&(t.query=e.query.clone()),e.queryOptions&&(t.queryOptions=_.cloneDeep(e.queryOptions)),e.objects&&(t.objects=n.clone(e.objects)),e.vcObjects&&(t.vcObjects=n.clone(e.vcObjects)),e.hasDefaultSort&&(t.hasDefaultSort=e.hasDefaultSort);var r=e.conversionSourceContext;return r&&(t.conversionSourceContext={visualType:r.visualType,query:r.query&&r.query.clone(),syncGroup:r.syncGroup}),e.display&&(t.display=_.cloneDeep(e.display)),t}}function r(e,t){if(!e||!e.getCurrentVisual)return t.resolve();var r=e.getCurrentVisual();return r?r.enumerateObjectRepetitionAsync?r.enumerateObjectRepetitionAsync():r.enumerateObjectRepetition?t.resolve(r.enumerateObjectRepetition()):t.resolve():t.resolve()}e.clone=t,e.enumerateObjectRepetition=r})(u=t.SingleVisualConfig||(t.SingleVisualConfig={}));var c;!(function(e){function t(e){if(e.visualContainer)return e.visualContainer.config.singleVisual.visualType}e.getVisualType=t})(c=t.PinData||(t.PinData={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){switch(e){case 0:return"Default";case 1:return"DataFilter";case 2:return"HighlightFilter";case 3:return"NoFilter"}}e.toString=t})(t=e.VisualRelationshipFilterActionUtil||(e.VisualRelationshipFilterActionUtil={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=jsCommon.ArrayExtensions,i=e.data.ExpansionState,n=e.data.transforms.plugins.KMeansClustering,o=e.data.ProjectionUtils,a=e.data.QueryProjectionCollection,s=e.data.QueryProjectionsByRole,l=e.data.SemanticQuery,u=e.data.transforms.plugins.SpatialClustering,c=e.data.SQExpr,p=e.data.SQExprBuilder,d=(function(){function e(e,t,r){this.defn=e,this.projections=t,this.expansionStates=r||[];for(var i in t)_.isEmpty(t[i].activeProjectionRefs)||this.ensureActiveItems(i)}return e.prototype.ensureExpansionState=function(e,t,r){var n=i.findExpansionState(this.expansionStates,e);if(!n){n=new i(e,t,r);var o=this.getRolesUniqueProjectionRefs(e),a=this.getRolesUniqueActiveProjectionsRefs(e);n.updateLevels(o,a.length),this.expansionStates.push(n)}return n},e.prototype.add=function(e,t,r){var i=r&&r.exprName,n=r&&r.index,o=this.defn.selectNameOf(e);o||(o=this.addSelect(e,i));var s=this.getRoleProjections(t);s||(s=[],this.projections[t]=new a(s));var l={queryRef:o},u=0;return null==n||n>s.length?(s.push(l),u=s.length-1):(s.splice(n,0,l),this.addNewQueryRefToActiveProjectionRefsIfNeeded(t,o,n),u=n),this.updateExpansionStates(t,(function(e,t){return e.addLevel(o,t+u)})),u},e.prototype.removeExpr=function(t,r,i){if(r){for(var n=this.defn.select(),o=!1,a=n.length-1;a>=0;--a){var s=n[a].expr;if(e.areEqualIgnoringAggregate(s,t,i)){if(!this.removeAllProjectionsForExpr(s))return!1;o=!0}}return o}return this.removeAllProjectionsForExpr(t)},e.prototype.getQueryRef=function(e,t){var r=this.getRoleProjections(e);if(r&&!(t>=r.length))return r[t].queryRef},e.prototype.removeProjection=function(e,t){var r=this.getQueryRef(e,t);if(!r)return!1;var i=this.defn.select().withName(r);if(!i)return!1;var n=i.expr,o=this.getRoleProjections(e);o.splice(t,1);var a=this.projections[e].activeProjectionRefs;return _.pull(a,r),_.isEmpty(o)?delete this.projections[e]:a&&0===a.length&&a.push(o[Math.max(0,t-1)].queryRef),this.updateExpansionStates(e,(function(e,r){return e.removeLevel(r+t)})),this.isUsed(r)||this.removeExpr(n,!1),!0},e.prototype.moveProjection=function(e,t,r,i){if(t===r)return!1;var n=this.getRoleProjections(e);if(!n||r+i>n.length)return!1;if(t<0||r<0)return!1;var o=this.projections[e].activeProjectionRefs,a=n.splice(t,i);n.splice.apply(n,[r,0].concat(a));var s=r;if(r>t&&(s+=i),o)if(s<o.length){var l=_.take(n,r+1);this.projections[e].activeProjectionRefs=_.map(l,(function(e){return e.queryRef}))}else if(t<o.length){for(var u=0,c=a;u<c.length;u++){var p=c[u];_.pull(o,p.queryRef)}0===o.length&&o.push(n[0].queryRef)}return this.updateExpansionStates(e,(function(e,n){return e.moveLevels(n+t,n+r,i)})),!0},e.prototype.setAggregate=function(e,t,r){return this.updateExpression(e,t,(function(e){return p.setAggregate(e,r)}))},e.prototype.removeAggregate=function(e,t,r){return this.updateExpression(e,t,(function(e){return p.removeAggregate(e,r)}))},e.prototype.setPercentOfGrandTotal=function(e,t){return this.updateExpression(e,t,(function(e){return p.setPercentOfGrandTotal(e)}))},e.prototype.removePercentOfGrandTotal=function(e,t){return this.updateExpression(e,t,(function(e){return p.removePercentOfGrandTotal(e)}))},e.prototype.setPercentOfRoleTotal=function(e,t,r){return this.updateExpression(t,r,(function(t){return p.setPercentOfRoleTotal(t,e)}))},e.prototype.removePercentOfRoleTotal=function(e,t){return this.updateExpression(e,t,(function(e){return p.removePercentOfRoleTotal(e)}))},e.prototype.orderBy=function(e){this.defn=this.defn.orderBy(e)},e.prototype.removeOrderBy=function(e){this.defn=this.defn.removeOrderBy(e)},e.prototype.removeUnusedOrderBy=function(){for(var e=this.defn,t=e.orderBy(),r=0,i=t;r<i.length;r++){var n=i[r],o=n.expr;e.selectNameOf(o)||(this.defn=e.removeOrderBy(o))}},e.prototype.addTransform=function(e,t,r){for(var i={},o=this.defn.transforms(),a=0,s=o;a<s.length;a++){i[s[a].name]=!0}var l=jsCommon.StringExtensions.findUniqueName(i,e.name),c={algorithm:e.name,name:l,input:{parameters:t},output:void 0};this.defn=this.defn.transforms(o.concat([c]));for(var d=(e.name===n.name||e.name===u.name)&&r.grouping&&r.grouping.cluster,f=0,v=e.outputRoles;f<v.length;f++){var m=v[f],h=m.name;d&&(h=r.grouping.cluster.clusteringRole),this.add(p.transformOutputRoleRef(m.algorithmRole),h,{exprName:m.columnName?m.columnName:m.algorithmRole})}return l},e.prototype.removeTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(e){return e.name===t}));if(r){for(var i=0,n=e.outputRoles;i<n.length;i++){var o=n[i];this.removeExpr(p.transformOutputRoleRef(o.algorithmRole),!1)}this.defn=this.defn.removeTransform(r)}},e.prototype.updateTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(t){return t.name===e}));r&&(r.input.parameters=t)},e.prototype.clone=function(){return new e(this.defn,s.clone(this.projections),i.clone(this.expansionStates))},e.prototype.equals=function(e){return!!l.equals(this.defn,e.defn)&&(_.isEqual(this.projections,e.projections)&&_.isEqual(this.expansionStates,e.expansionStates));
},e.prototype.ensureDrillableRoles=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this.ensureActiveItems(n)&&t.push(n)}return t},e.prototype.ensureActiveItems=function(e){var t=this.projections[e];if(t){var r=t.all();return _.isEmpty(r)||t.activeProjectionRefs?void 0:(t.activeProjectionRefs=[r[0].queryRef],!0)}},e.prototype.toggleShowAll=function(e){var t=this.projections[e];t&&(t.showAll=!t.showAll)},e.prototype.hasShowAll=function(){return!_.isEmpty(this.projections)&&_.some(this.projections,(function(e){return e.showAll}))},e.prototype.roleContainsExpr=function(e,t){var r=this.projections[e],i=r&&r.all();if(_.isEmpty(i))return!1;for(var n=this.defn.select(),o=0,a=n;o<a.length;o++)for(var s=a[o],l=0,u=i;l<u.length;l++){var p=u[l];if(p.queryRef===s.name&&c.equals(t,s.expr))return!0}return!1},e.prototype.getRoleNameForExpr=function(e){var t=this.projections;for(var r in t){var i=this.tryGetExprs(r);if(i&&i.length>0)for(var n=0,o=i;n<o.length;n++){var a=o[n];if(c.equals(e,a))return r}}},e.prototype.tryGetExpr=function(e,t){var r=this.getRoleProjections(e);if(r){var i=r[t];return o.tryGetExprByProjection(this.defn,i)}},e.prototype.tryGetExprs=function(e){return o.tryGetExprs(this.defn,this.projections,e)},e.prototype.getUniqueQueryRefs=function(){var e=_.values(this.projections);return _.chain(e).map((function(e){return e.all()})).flatten(!0).map((function(e){return e.queryRef})).uniq().value()},e.prototype.currentDrillMode=function(e){var t=this.getRoleProjections(e);if(!_.isEmpty(t)){var r=this.projections[e];if(r){var i=r.activeProjectionRefs;if(!_.isEmpty(i)){if(i.length>1)return 2;if(i[0]!==t[0].queryRef)return 3}}}},e.prototype.addSelect=function(e,t){var r=this.defn;this.defn=r=r.addSelect(e,t);var i=r.select(),n=i.length-1;return i[n].name},e.prototype.updateExpansionStates=function(e,t){if(!_.isEmpty(this.expansionStates)){_.remove(this.expansionStates,(function(e){return!e.supportsMerge}));var r=i.findExpansionStateForRole(this.expansionStates,e);if(r){var n=_.takeWhile(r.roles,(function(t){return t!==e}));t(r,this.getRolesUniqueActiveProjectionsRefs(n).length);var o=r.getVisibleDescendentsDepth(r.root,-1);this.setActiveProjections(r.roles,o)}}},e.prototype.removeAllProjectionsForExpr=function(e){var t=this.defn,r=t.selectNameOf(e);if(!r)return!1;_.remove(this.expansionStates,(function(e){return!e.supportsMerge}));var n=this.projections,o=function(e){for(var t=i.findExpansionStateForRole(a.expansionStates,e),o=n[e].all(),s=t&&_.takeWhile(t.roles,(function(t){return t!==e})),l=s&&a.getRolesUniqueActiveProjectionsRefs(s).length,u=o.length-1;u>=0;u--){if(o[u].queryRef===r){o.splice(u,1);var c=n[e].activeProjectionRefs;_.pull(c,r),c&&_.isEmpty(c)&&!_.isEmpty(o)&&c.push(o[Math.max(0,u-1)].queryRef),t&&t.removeLevel(l+u)}}if(0===o.length)delete n[e];else if(t){var p=t.getVisibleDescendentsDepth(t.root,-1);a.setActiveProjections(t.roles,p)}},a=this;for(var s in n)o(s);return this.defn=t.removeSelect(e).removeOrderBy(e),!0},e.prototype.updateExpression=function(e,t,i){var n=this.getRoleProjections(e);if(!n||t>=n.length)return!1;var o=n[t],a=this.defn,s=o.queryRef,l=a.select(),u=r.indexWithName(l,s),c=l[u].expr,p=i(c),d=a.selectNameOf(p);return d?(o.queryRef=d,this.isUsed(s)||(this.defn=a.removeSelect(c)),!0):(this.getUsageCount(s)>1?o.queryRef=this.addSelect(p):this.defn=a.setSelectAt(u,p),!0)},e.prototype.isUsed=function(e){return this.getUsageCount(e)>0},e.prototype.getUsageCount=function(e){var t=0,r=this.projections;for(var i in r){var n=r[i].all();t+=_.filter(n,(function(t){return t.queryRef===e})).length}return t},e.prototype.getRoleProjections=function(e){var t=s.getRole(this.projections,e);if(t)return t.all()},e.prototype.addNewQueryRefToActiveProjectionRefsIfNeeded=function(e,t,r){var i=this.getRoleProjections(e),n=this.projections[e].activeProjectionRefs;n&&(n.length>1&&r<n.length?n.splice(r,0,t):1===n.length&&0===r&&i.length>1&&i[1].queryRef===n[0]&&n.splice(0,1,t))},e.prototype.getRolesProjectionRefs=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],o=this.projections[n];if(o){var a=_.map(o.all(),(function(e){return e.queryRef}));t.push.apply(t,a)}}return t},e.prototype.getRolesUniqueProjectionRefs=function(e){return _.uniq(this.getRolesProjectionRefs(e))},e.prototype.resetExpansionStates=function(){this.expansionStates=[]},e.prototype.getRolesActiveProjectionsRefs=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],o=this.projections[n],a=o&&o.all(),s=a&&o.activeProjectionRefs;if(s&&(t.push.apply(t,s),a.length!==s.length&&_.uniqBy(a,(function(e){return e.queryRef})).length!==_.uniq(s).length))break}return t},e.prototype.getRolesUniqueActiveProjectionsRefs=function(e){return _.uniq(this.getRolesActiveProjectionsRefs(e))},e.areEqualIgnoringAggregate=function(e,t,r){return c.equals(p.removeAggregate(e,r),p.removeAggregate(t,r))},e.prototype.setActiveProjections=function(e,t){var r=this.projections,n=i.findExpansionState(this.expansionStates,e);n&&n.pinLevels(t);for(var o=0,a=e;o<a.length;o++){var s=a[o];if(t>0){var l=r[s]&&r[s].all(),u=_.uniqBy(l,(function(e){return e.queryRef})),c=u.length,p=void 0;p=t>=c?u:_.take(u,t),r[s].activeProjectionRefs=_.map(p,(function(e){return e.queryRef})),t-=p.length}else r[s]&&(r[s].activeProjectionRefs=[])}},e})();t.VisualQuery=d})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.CurrentExplorationVersion="5.9"})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=jsCommon.ArrayExtensions,n=e.data.dsr;!(function(e){function t(e,t){return e.modelExtensions&&e.modelExtensions.withName(t)}function r(e,r){var i=t(e,r);if(!i)throw new Error("Unable to find expected model extension: "+r);return i}function o(e,t,r){e.modelExtensions||(e.modelExtensions=i.createWithName());var n=e.modelExtensions.withName(t);return n||(n=a(t,r),e.modelExtensions.push(n)),n}function a(e,t){return{name:e,extends:t,entities:i.createWithName()}}function s(e,t,r){return c(o(e,t,n.DefaultSchemaName),r)}function l(e,t){return e.entities.withName(t)}function u(e,t,i){var n=r(e,t),o=l(n,i);if(!o)throw new Error("Unable to find expected entity: "+i);return o}function c(e,t){e.entities||(e.entities=i.createWithName());var r=e.entities.withName(t);return r||(r={name:t,extends:t,measures:i.createWithName()},e.entities.push(r)),r}function p(e,t){if(e.measures||(e.measures=i.createWithName()),e.measures.withName(t.name))throw new Error("Measure "+t.name+" already exists and cannot be added");e.measures.push(t)}function d(e,t,r,i){return v(u(e,t,r),i)}function f(e,t){return e.measures.withName(t)}function v(e,t){var r=f(e,t);if(!r)throw new Error("Unable to find expected measure:"+t);return r}function m(e,t,r,i){var n=u(e,t,r),o=v(n,i),a=n.measures.indexOf(o);n.measures.splice(a,1),0===n.measures.length&&(delete n.measures,x(e,t,n))}function h(e,t,r){null===r||void 0===r?y(e,t):g(e,t,r)}function g(e,t,r){e.annotations||(e.annotations=i.createWithName());var n=e.annotations.withName(t);n?n.value=r:(n={name:t,value:r},e.annotations.push(n))}function y(e,t){var r=e.annotations&&e.annotations.withName(t);if(r){var i=e.annotations.indexOf(r);e.annotations.splice(i,1),e.annotations&&0===e.annotations.length&&delete e.annotations}}function C(e,t){var r=e.annotations&&e.annotations.withName(t);if(r)return r.value}function x(e,t,i){if(!b(i)){var n=r(e,t),o=n.entities.indexOf(i);n.entities.splice(o,1),0===n.entities.length&&(delete n.entities,S(e,n))}}function S(e,t){if(!b(t)){var r=e.modelExtensions.indexOf(t);e.modelExtensions.splice(r,1),0===e.modelExtensions.length&&delete e.modelExtensions}}function b(e){var t=Object.keys(e),r=_.chain(t).filter((function(e){return"name"!==e&&"extends"!==e})).filter((function(t){return!(_.isArray(e[t])&&_.isEmpty(e[t]))})).value();return _.some(r)}function E(e){if(e){var t={Version:0,Name:e.name,Extends:e.extends};return e.entities&&(t.Entities=_.map(e.entities,(function(e){return w(e)}))),t}}function w(e){var t={Extends:e.extends,Name:e.name};return e.measures&&(t.Measures=_.map(e.measures,(function(e){return V(e)}))),t}function V(e){var t=e.dataType;return 6!==t&&9!==t||(t=7),{Name:e.name,Expression:e.expression,DataType:t}}e.getOptionalModelExtension=t,e.getExpectedModelExtension=r,e.getOrCreateModelExtension=o,e.createModelExtension=a,e.ensureEntityExists=s,e.findEntity=l,e.getExpectedEntity=u,e.getOrCreateExtendingEntity=c,e.addMeasure=p,e.getExpectedMeasure=d,e.findMeasureFromEntity=f,e.removeMeasure=m,e.setAnnotation=h,e.getAnnotationValue=C,e.toQueryExtensionSchema=E})(r=t.ModelExtensionUtils||(t.ModelExtensionUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(e){this.modelExtension=e,this.visited={}}return t.prototype.visitReference=function(t){if(t.schema===this.modelExtension.name){var r=e.ModelExtensionUtils.findEntity(this.modelExtension,t.entity);if(r){var i=e.ModelExtensionUtils.findMeasureFromEntity(r,t.name);if(i){var n=this.toVisitedKey(t);if(!this.visited[n]){this.visitMeasure(this.modelExtension,r,i),this.visited[n]=!0;for(var o=0,a=i.references.measures;o<a.length;o++){var s=a[o];this.visitReference(s)}}}}}},t.prototype.visitMeasure=function(e,t,r){},t.prototype.toVisitedKey=function(e){return JSON.stringify(e)},t})();e.ModelExtensionDependencyVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.visualHost.utils.ResourcePackageUtils;!(function(e){function t(e,t,r){return i.newSharedResourceItem(e,t,r)}function r(e,t,r){var o=n(e);return i.ensureResourcePackage(o,t,r)}function n(e){var t=e.resourcePackages;return t||(t=[],e.resourcePackages=t),t}function o(e,t){if(!_.isEmpty(t)&&!_.isEmpty(e))for(var r=0,n=t;r<n.length;r++){var o=n[r],a=i.findResourcePackage(e,o.type,o.name);if(a){o.id=a.id;for(var s=0,l=o.items;s<l.length;s++){var u=l[s],c=i.findItemInPackage(a,u.name);c&&(u.id=c.id)}}}}e.newSharedResourceItem=t,e.ensureResourcePackageType=r,e.ensureResourcePackages=n,e.synchronizePackageIds=o})(r=t.ResourcePackageUtils||(t.ResourcePackageUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(t,r,i){t[e.ExplorationDataReaderType]={name:"exploration",extends:"dsr",queryExtensionProvider:e.createExplorationQueryExtensionProvider(),schemaReader:function(){return e.createConceptualSchemaReader(r,i)}}}function r(e){var t=_.find(e,(function(e){return"exploration"===e.type}));if(t)return t.exploration}e.ExplorationDataReaderType="exploration",e.registerExplorationDataReaderExtension=t,e.getExplorationDataReaderDataSource=r})(t=e.dataReaderPlugins||(e.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(){return i}function i(e){return function(t,r,i){var o={query:t,extensions:void 0,queryRewrites:r};if(1!==e.length)return i?i(t,r):o;var a=e[0],s=a.getModelExtensions();if(_.isEmpty(s))return i?i(t,r):o;var l=n.toQueryExtensionSchema(u.build(t,s.withName(a.schemaName)));return i?i(t,r,l):{query:t,queryRewrites:r,extensions:l}}}var n=e.explore.util.ModelExtensionUtils,o=e.explore.util.ModelExtensionDependencyVisitor,a=e.data.SQExpr,s=e.data.SQExprRewriter;t.createExplorationQueryExtensionProvider=r;var l=(function(e){function t(t){var r=e.call(this)||this;return r.dependencyVisitor=t,r}return __extends(t,e),t.prototype.visitMeasureRef=function(e){return a.isEntity(e.source)&&this.dependencyVisitor.visitReference({schema:e.source.schema,entity:e.source.entity,name:e.ref}),e},t})(s),u=(function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.build=function(e,r){var i=new t(r);return e.rewrite(new l(i)),i.result},t.prototype.visitMeasure=function(e,t,r){this.result=this.result||n.createModelExtension(e.name,e.extends);var i=n.getOrCreateExtendingEntity(this.result,t.name);n.findMeasureFromEntity(i,r.name)||n.addMeasure(i,r)},t})(o)})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=jsCommon.ArrayExtensions,n=e.data.ConceptualSchema;!(function(t){function r(e,t,r){var o=new n;return o.name=e,o.extends=t,o.capabilities={canEdit:r,discourageQueryAggregateUsage:!1,isExtendable:!1,normalizedFiveStateKpiRange:!1,supportsMedian:!1,supportsPercentile:!1,supportsScopedEval:!1,supportsStringMinMax:!1,supportsMultiTableTupleFilters:!1,supportsTimeIntelligenceQuickMeasures:!1,supportsCalculatedColumns:!1,supportsGrouping:!1,limitMultiColumnFiltersToQueryGroupColumns:!1,supportsBinnedLineSample:!1,supportsOverlappingPointsSample:!1,supportsQna:!1,insights:{},supportsFastRefresh:!1,supportsSubqueryRegrouping:!1,supportsTopNPerLevel:!1,supportsExtensionColumns:!1},o.entities=i.createWithName(),o}function o(t,n){var o=r(t.name,t.extends,n);if(!t.entities)return o;for(var a=0,s=t.entities;a<s.length;a++){var l=s[a],u={name:l.name,extends:l.extends,displayName:l.name,properties:i.createWithName(),hierarchies:i.createWithName(),displayFolders:i.createWithName(),capabilities:{canRefresh:!1,canEditSource:!1,canRename:!1,canDelete:!1,canEditStorageMode:!1,supportsClustering:!1,supportsBinByCount:!1,limitOnNumberOfGroups:null,dataView:null},source:{}};if(o.entities.push(u),l.measures)for(var c=0,p=l.measures;c<p.length;c++){var d=p[c],f={name:d.name,displayName:d.name,type:e.ValueType.fromPrimitiveTypeAndCategory(d.dataType,d.dataCategory),kind:1,hidden:d.hidden,errorMessage:d.errorMessage,queryable:d.errorMessage?1:0,format:d.formatInformation&&d.formatInformation.formatString,measure:{},canDelete:o.capabilities.canEdit,description:d.description};d.measureTemplate&&(f.measure.template={name:d.measureTemplate.daxTemplateName}),u.properties.push(f)}}return o}t.createExtensionSchema=r,t.convertModelExtension=o})(r=t.ExplorationConceptualSchemaFactory||(t.ExplorationConceptualSchemaFactory={}))})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return void 0===t&&(t=!1),new n(e,t)}var i=e.data.FederatedConceptualSchema;t.createConceptualSchemaReader=r;var n=(function(){function e(e,t){this.promiseFactory=e,this.canEditSchemas=t}return e.prototype.execute=function(e){var r=e.dataSources;if(!r||r.length>1)return this.promiseFactory.reject(null);var i=r[0],n=i.exploration;if(!n)return this.promiseFactory.reject(null);var o=[],a=n.getModelExtensions();if(_.isEmpty(a))o.push(t.ExplorationConceptualSchemaFactory.createExtensionSchema(i.name,i.extends,this.canEditSchemas));else for(var s=0,l=a;s<l.length;s++){var u=l[s];o.push(t.ExplorationConceptualSchemaFactory.convertModelExtension(u,this.canEditSchemas))}return this.promiseFactory.resolve({data:{extensionSchemas:o}})},e.prototype.transform=function(e){for(var t=e.data,r={schemas:{}},n=0,o=t.extensionSchemas;n<o.length;n++){var a=o[n];r.schemas[a.name]=a}return{schema:new i(r)}},e})()})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return new i(e,t)}t.createAutoRefreshAdminConfigProxy=r;var i=(function(){function t(e,t){this.httpService=e,this.telemetryService=t}return t.prototype.getAPRConfig=function(t){var r=this.telemetryService.startEvent(e.telemetry.EXGetAutoRefreshAdminConfig),i=this.httpService.powerbiRequestOptions(r.event,"GetAutoRefreshAdminConfig");return this.httpService.get("metadata/models/"+t+"/autoRefreshConfig?autoRefresh=true",i)},t.prototype.getCDMConfig=function(t){var r=this.telemetryService.startEvent(e.telemetry.EXGetChangeDetectionAdminConfig),i=this.httpService.powerbiRequestOptions(r.event,"GetAutoRefreshAdminConfig");return this.httpService.get("metadata/models/"+t+"/autoRefreshConfig?autoRefresh=false",i)},t})()})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i=r(e,t);return{added:i.added,updated:i.updated,removed:i.removed,page:t,originalPage:e}}function r(e,t){for(var r=[],i=[],n=e.visualContainers.slice(),o=0,a=t.visualContainers;o<a.length;o++){var s=a[o];if(void 0===s.id)r.push(s);else{var l=jsCommon.ArrayExtensions.findWithId(n,s.id);if(l){var u=n.indexOf(l);n.splice(u,1),jsCommon.JsonComparer.equals(l,s)||i.push(s)}else r.push(s)}}return{added:r,updated:i,removed:n}}function i(e,r){for(var i=[],n=[],o=e.slice(),a=0,s=r.length;a<s;a++){var l=r[a];if(void 0===l.id)i.push(l);else{var u=jsCommon.ArrayExtensions.findWithId(o,l.id);if(u){var c=o.indexOf(u);o.splice(c,1);var p=(e.indexOf(u),t(u,l));n.push(p)}else i.push(l)}}return{added:i,updated:n,removed:o}}function n(e,t){for(var r=[],i=[],n=t||[],o=e?e.slice():[],a=0,s=n;a<s.length;a++){var l=s[a];if(void 0===l.id)r.push(l);else{var u=l.id,c=_.findIndex(o,(function(e){return e.id===u}));c>=0?(i.push({updatedPod:l,originalPod:o[c]}),o.splice(c,1)):r.push(l)}}return{added:r,removed:o,updated:i}}function o(e,t){return{pages:i(e.sections,t.sections),pods:n(e.pods,t.pods)}}e.diff=o})(t=e.ExplorationDiffer||(e.ExplorationDiffer={}))})(t=e.proxies||(e.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,o,a){return new f(e,t,r,i,n,o,a)}var n,o=e.telemetry.EXDeserializeExplorationEventName,a=e.telemetry.EXGetExplorationEventName,s=e.fillTelemetryEvent,l=e.MonitorWith,u=e.explore.util.ResourcePackageUtils;!(function(e){var t;!(function(e){e.Bookmark="Bookmark",e.Back="Back",e.Qna="Qna"})(t=e.VisualLink||(e.VisualLink={}));var r;!(function(e){e.Canvas="Canvas",e.Default="Default"})(r=e.VisualTooltip||(e.VisualTooltip={}))})(n=r.wireContracts||(r.wireContracts={})),r.createExplorationProxy=i,r.saveExplorationSerializationOptions={withData:!0,excludeHighContrastTheme:!0,forSave:!0};var c="_",p="[0-9]+",d=18e5,f=(function(){function i(e,t,r,i,n,o,a){this.promiseFactory=e,this.httpService=t,this.serializer=r,this.telemetryService=i,this.featureSwitchService=n,this.cache={},this.resourcePackageCopyService=o,this.uriPrefix=a||"explore/"}return i.prototype.get=function(t){var r=this,n=this.featureSwitchService&&this.featureSwitchService.featureSwitches&&this.featureSwitchService.featureSwitches.telemetryV2,o=this.telemetryService,l=o.startEvent(e.telemetry.EXGetExploration,!1),u=t.sectionId,c=t.id,p=t.model,d=t.bookmarkGuid;if(t.allowCache){var f=this.getExplorationFromCache(c,u,p,d);if(f)return n&&s(a,{fromCache:!0}),l.event.info.fromCache=!0,l.resolve(),f}var v=n?new e.PbiDeferred:this.promiseFactory.defer(),m=this.uriPrefix+"reports/"+c+"/exploration";_.isNumber(u)&&(m+="/sections/"+u),_.isEmpty(d)||(m+="?bookmarkGuid="+d);var h=i.getCacheKey(c,u,d);this.cache[h.fullKey]={promise:v.promise};var g=this.httpService.powerbiRequestOptions(l.event,"GetExploration");return g.responseType="text",this.httpService.get(m,g).then((function(e){var t=e.data,i=jsCommon.JsonExtensions.tryParseJSON(t);l.resolve(),r.onSuccess(i,v,t,p,h)}),(function(t){l.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),r.onError(__assign({},t,{data:void 0}),c,v,h)})),v.promise},i.prototype.save=function(e,t,r,i){return this.saveInternal(e,t,r,!1,i)},i.prototype.saveWithoutGroupIdHeader=function(e,t,r){return this.saveInternal(e,t,r,!0)},i.prototype.saveInternal=function(e,t,n,o,a){var s=this,l=this.promiseFactory.defer();return this.copyResourcePackages(t).then((function(){var u=i.getCacheKey(n),c=s.serializer.serializeExploration(t,r.saveExplorationSerializationOptions),p=s.serializer.stringifyExplorationConfigs(c),d=s.cloneExplorationShallowForSave(p);if(null==t.id){var f=s.uriPrefix+"explorations/?reportid="+n;s.httpService.put(f,p,s.httpService.powerbiRequestOptions(null,"SaveExploration")).then((function(e){return s.onSuccess(e.data,l,JSON.stringify(e.data),null,u)}),(function(e){return s.onError(e,n,l,u)}))}else{var v=r.ExplorationDiffer.diff(e,p);s.explorationUpdateDiff(v,t.id,t,d,p,o,a).then((function(){l.resolve({wireContractJSON:JSON.stringify(p),exploration:t}),s.updateExplorationCache(u,c)}),(function(e){l.reject(e)}))}})),l.promise},i.prototype.copyResourcePackages=function(e){var t=[];if(e.resourcePackages)for(var r=e.report&&e.report.folderId,i=function(i,o){var a=i;t.push(n.resourcePackageCopyService.copyResourcePackageIfNeeded(e.resourcePackages[a].id,r,null).then((function(t){null!=t&&(e.resourcePackages[a]=t)})))},n=this,o=0,a=e.resourcePackages.length;o<a;o++)i(o,a);return this.promiseFactory.all(t)},i.prototype.getModelsAndExploration=function(e,t,r){var i=this,n=this.promiseFactory.defer(),o=this.uriPrefix+"reports/"+e+"/modelsAndExploration?preferReadOnlySession="+t;return r&&(o+="&bookmarkGuid="+r),this.httpService.get(o,this.httpService.powerbiRequestOptions(null,"GetModelsAndExploration")).then((function(e){var t=e.data.models;i.featureSwitchService.registerFeatureSwitches(e.data.featureSwitches),i.serializer.ensureInitialized().then((function(){var r=i.serializer.deserializeExploration(i.serializer.parseExplorationConfigs(e.data.exploration),[],!0,t);n.resolve({exploration:r,models:t,featureSwitches:e.data.featureSwitches})}))}),(function(e){n.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),n.promise},i.prototype.cloneExplorationShallowForSave=function(e){return{id:e.id,reportId:e.reportId,config:e.config,filters:e.filters,layoutOptimization:e.layoutOptimization,sections:void 0,resourcePackages:_.cloneDeep(e.resourcePackages)}},i.prototype.explorationUpdateDiff=function(e,r,i,n,o,a,s){var l=this,c=this.promiseFactory.defer(),p={};p.exploration=n;var d=-1,f=-1,v=-1,m={},h={},g={};p.addedPods=e.pods.added.map((function(e){return e.id=f--,g[e.name]=e.id,e})),p.deletedPods=e.pods.removed.map((function(e){return e.id})),p.updatedPods=e.pods.updated.reduce((function(e,t){return jsCommon.JsonComparer.equals(t.originalPod,t.updatedPod)||e.push(t.updatedPod),e}),[]),p.addedPages=e.pages.added.map((function(e){if(e.id=d--,m[e.name]=e.id,e.visualContainers)for(var t=0,r=e.visualContainers;t<r.length;t++){var i=r[t];i.id=v--;var n=JSON.parse(i.config);h[l.concatenatePageAndVisualContainerNames(e.name,n.name)]=i.id}return e})),p.deletedPages=e.pages.removed.map((function(e){return e.id})),p.updatedPages=e.pages.updated.reduce((function(e,t){for(var r=0,i=t.added;r<i.length;r++){var n=i[r];n.id=v--;var o=JSON.parse(n.config);h[l.concatenatePageAndVisualContainerNames(t.page.name,o.name)]=n.id}var a=l.getUpdatedPageProperty(t);return _.isEmpty(a.addedVisualContainers)&&_.isEmpty(a.updatedVisualContainers)&&_.isEmpty(a.deletedVisualContainers)&&_.isEmpty(a.pageProperty)||e.push(a),e}),[]);var y,C=this.uriPrefix+"explorations/savereport/"+r;if(a){var x={dismissGroupObjectId:!0};y=this.httpService.powerbiRequestOptions(null,"explorationUpdateDiff",x)}else y=this.getRequestOptionsWithGroupId(s);return this.httpService.post(C,p,y).then((function(e){var r=e&&e.data,n=r&&r.addedPodIds,a=r&&r.addedSectionIds,s=r&&r.addedVisualContainerIds,p=r&&r.exploration&&r.exploration.resourcePackages;if(p&&u.synchronizePackageIds(l.serializer.deserializeResourcePackages(p),u.ensureResourcePackages(i)),i.pods&&n)for(var d=0,f=i.pods.length;d<f;d++){var v=i.pods[d],y=_.find(n,{oldId:g[v.name]});if(y){var C=o.pods[d];v.id=C.id=y.id}}var x=t.contracts.Section.filterTransient(i.sections),S=o.sections;if(x)for(var d=0,f=x.length;d<f;d++){var b=x[d],E=S[d],y=_.find(a,{oldId:m[b.name]});y&&(b.id=E.id=y.id);var w=E.visualContainers;s&&l.updateDiffForContainerIds(b,w,s,h)}c.resolve(i)}),(function(e){return c.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),c.promise},i.prototype.updateDiffForContainerIds=function(t,r,i,n){for(var o=0,a=r;o<a.length;o++){var s=a[o],l=JSON.parse(s.config),u=_.find(i,{oldId:n[this.concatenatePageAndVisualContainerNames(t.name,l.name)]});if(u){e.ItemGroupingManager.find(l.name,t.visualContainerGroups).id=s.id=u.id}}},i.prototype.concatenatePageAndVisualContainerNames=function(e,t){return e+"/"+t},i.prototype.getRequestOptionsWithGroupId=function(e,t,r){if(e){var i={groupObjectIdOverride:e};return this.httpService.powerbiRequestOptions(t,r,i)}return this.httpService.powerbiRequestOptions(t,r)},i.prototype.saveAs=function(e,t,i,n,o,a,s){var l=this,u=this.promiseFactory.defer();return this.copyResourcePackages(e).then((function(){var c=l.serializer.stringifyExplorationConfigs(l.serializer.serializeExploration(e,r.saveExplorationSerializationOptions)),p=e.reportId;c.reportId=void 0,c.report=void 0;var d={modelIds:[i],exploration:c,packageId:a?0:n,folderId:o,sourceReportId:p};t=encodeURIComponent(t);var f=l.uriPrefix+"explorations/?name="+t;a&&(f+="&personalizedreport=true");var v=l.getRequestOptionsWithGroupId(s,void 0,"saveExplorationAs");l.httpService.put(f,d,v).then((function(e){return l.onSuccess(e.data,u,JSON.stringify(e.data),void 0,void 0)}),(function(e){return l.onError(e,i,u)}))})),u.promise},i.prototype.saveVisualContainerQueries=function(e,t){var r=this.uriPrefix+"explorations/"+e+"/cache";return this.httpService.post(r,t,this.httpService.powerbiRequestOptions(null,"SaveVisualContainerQueries"))},i.prototype.getUpdatedPageProperty=function(e){var t={pageId:e.page.id};t.addedVisualContainers=e.added,t.updatedVisualContainers=e.updated,t.deletedVisualContainers=e.removed.map((function(e){return e.id}));var r=this.shallowCloneSection(e.originalPage),i=this.shallowCloneSection(e.page);return jsCommon.JsonComparer.equals(r,i)||(t.pageProperty=i),t},i.prototype.shallowCloneSection=function(e){return{config:e.config,displayName:e.displayName,displayOption:e.displayOption,filters:e.filters,height:e.height,id:e.id,name:e.name,objectId:e.objectId,ordinal:e.ordinal,transient:e.transient,visualContainers:void 0,width:e.width}},i.prototype.getExplorationFromCache=function(e,t,r,i){var n=this.findMatch(e,t,i);if(n){var o=n.result;if(o.promise)return o.promise;if(o.data){if(null!=t&&!_.some(o.data.sections,(function(e){return e.id===t})))return;var a=this.promiseFactory.defer(),s=[];return a.resolve({wireContractJSON:JSON.stringify(this.serializer.stringifyExplorationConfigs(o.data)),exploration:this.serializer.deserializeExploration(o.data,s,!0,r)}),a.promise}}},i.prototype.findMatch=function(e,t,r){var n=i.getCacheKey(e,t,r),o=this.cache[n.fullKey];if(o||null!=r||(n=i.getCacheKey(e),o=this.cache[n.fullKey]),o)return{key:n,result:o}},i.prototype.updateExplorationCache=function(e,t){var r=this;if(e){if(!t)return void delete this.cache[e.fullKey];var i=this.cache[e.fullKey];if(i?(i.promise&&delete i.promise,i.data=t):this.cache[e.fullKey]={data:t,promise:null},e.part&&!this.cache[e.part.reportKey]){var n=_.clone(t);n.activeWebBookmark&&delete n.activeWebBookmark,this.cache[e.part.reportKey]={data:n,promise:null}}e.allSectionKey&&_.forOwn(this.cache,(function(t,i){i!==e.fullKey&&null!=i.match(new RegExp("^"+e.fullKey))&&delete r.cache[i]})),this.cacheExpirationTimerId&&clearTimeout(this.cacheExpirationTimerId),this.cacheExpirationTimerId=setTimeout((function(){r.clearCache()}),d)}},i.prototype.clearCache=function(){this.cache={}},i.prototype.logDeserializationErrorsTelemetryEvents=function(r,i){if(_.find(i,(function(e){return 0===e.errorType}))){var n=r.config;this.telemetryService.logEvent(e.telemetry.NewerExplorationVersion,n.version.toString(),t.services.upgrade.CurrentExplorationVersion.toString())}},i.prototype.onSuccess=function(e,t,r,i,n){var o=[],a=this.deserializeExploration(e,r,o,i),s=a&&a.explorationWireContract,l=a&&a.explorationContract,u={wireContractJSON:r,exploration:l};e.report&&(u.modelId=e.report.modelId,u.reportGuid=e.report.objectId),t.resolve(u),this.logDeserializationErrorsTelemetryEvents(s,o),this.updateExplorationCache(n,s)},i.prototype.deserializeExploration=function(t,r,i,n){var a,l=this.featureSwitchService&&this.featureSwitchService.featureSwitches&&this.featureSwitchService.featureSwitches.telemetryV2;t&&t.sections&&(a=t.sections.length);var u=this.telemetryService.startEvent(e.telemetry.EXDeserializeExploration,void 0,r.length,0,a),c=this.serializer.parseExplorationConfigs(t);u.event.info.explorationVersion=c.config.version,l&&s(o,{explorationVersion:c.config.version,length:r.length});var p={upgraderCount:0},d=this.serializer.deserializeExploration(c,i,!0,n,p);return u.event.info.upgraderCount=p.upgraderCount,u.resolve(),l&&s(o,{upgraderCount:p.upgraderCount}),{explorationContract:d,explorationWireContract:c}},i.prototype.onError=function(e,t,r,i){r.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{}),this.updateExplorationCache(i,null)},i.getCacheKey=function(e,t,r){var i;if(i=null!=t?""+e+c+t:""+e+c+p,r){var n=_.cloneDeep(i);return i+=""+c+r,{fullKey:i,allSectionKey:null==t,part:{reportKey:n}}}return{fullKey:i,allSectionKey:null==t}},__decorate([l(a)],i.prototype,"get",null),__decorate([l(o)],i.prototype,"deserializeExploration",null),i})()})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,n,l,u,c){var p,d=t&&t.clientError;if(d&&d.ignorable)return"IgnorableClientError";var f=t&&t.serviceError,v=f&&f.errorCode,m=c&&c.datasetHost,h="PowerBI",g=null;if(f&&(g=f.message&&f.message.replace(/\s/g," "),d=new e.ServiceErrorToClientError(f)),v===e.PBI_DatasourceNotFound&&(m===a.Dedicated||m===a.ASAzure)){var y,C;switch(m){case a.Dedicated:p="ServiceError_CapacityPausedTitle",y=u.get(p),C=u.get("ServiceError_CapacityPausedMessage");break;case a.ASAzure:p="ServiceError_DataSourceConnectGeneralErrorTitle",y=u.get(p),C=u.get("ServiceError_ASAzure_DatasourceNotFoundMessage")}return r.error(C,l,{title:y,requestId:t&&t.requestId,displayableErrorInfo:[{errorInfoKey:u.get("ServiceError_CapacityId"),errorInfoValue:c.capacityObjectId}],source:d.source}),p}if(v===e.PBI_DatabaseDoesNotExistOrUserDoesNotHavePermission){var x,S;if(m===a.ASOnPrem||m===a.ASAzure){switch(m){case a.ASOnPrem:p="ServiceError_ASOnPremDataSourceConnectErrorMessage",x=u.get("ServiceError_DataSourceConnectGeneralErrorTitle"),S=u.get(p);break;case a.ASAzure:p="ServiceError_ASAzure_AdomdErrorMessage",x=u.get("ServiceError_DataSourceConnectGeneralErrorTitle"),S=u.get(p)}return r.error(S,l,{title:x,requestId:t&&t.requestId,source:d&&d.source}),p}}if(i(v,m))return p="ServiceError_ASAzure_AdomdErrorMessage",r.error(u.get(p),l,{title:u.get("ServiceError_DataSourceConnectGeneralErrorTitle"),requestId:t&&t.requestId,source:d.source}),p;if(o(v,m))return p="ServiceError_CapacityOverloadedMessage",r.error(u.get(p),l,{title:u.get("ExplorationContainer_FailedToLoadReport"),requestId:t&&t.requestId,displayableErrorInfo:[{errorInfoKey:u.get("ServiceError_CapacityId"),errorInfoValue:c.capacityObjectId}],source:d.source}),p;if(v===e.RS_OrphanedModel){var b,E;return p="ServiceError_OrphanedModel",b=u.get("ServiceError_OrphanedModelKey"),E=u.get(p),r.error(E,l,{title:b,requestId:t&&t.requestId,source:d&&d.source,customErrorDialogHelperText:" "}),p}var _;d&&(_=s.GetErrorDetailsFromClientError(d),h=d.source);var w=_&&_.displayableErrorInfo||[],V=w.shift(),F=V&&V.errorInfoValue||_&&_.message,P={requestId:t&&t.requestId,displayableErrorInfo:w,errorDetails:g,source:_?_.source:null},T=V&&V.errorInfoKey;return T&&(P.title=T),r.error(F||n,l,P),_&&_.resourceKey}function i(e,t){return n(e)&&t===a.ASAzure}function n(t){return t===e.PBI_AdomdErrorResponseExternal||t===e.PBI_AdomdErrorResponseSystem||t===e.PBI_AdomdErrorResponseUser}function o(t,r){return r===a.Dedicated&&(t===e.PBI_ConnectionThrottledDueToCapacityOverload||t===e.PBI_MaximumAllowableMemoryReached);
}var a=e.common.contracts.DatasetHost,s=e.helpers.PowerBIServiceExceptionErrorHelper;t.handleConceptualSchemaError=r})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=e.drilldown;return null!=t?t.roles:[]}function r(e,t,r){var i=e.defn.select().withName(t);return i?{expr:i.expr,roleName:r}:void 0}function i(e,t,r){if(t){var i;switch(r){case 1:i=a(e,t);break;case 0:var s=t;if(s.expr){var l=jsCommon.ArrayExtensions.ensureArray(s.expr);i=[];for(var u=0,c=l;u<c.length;u++){var p=c[u];i.push(o(e,p))}}else i=n(e,t);break;default:return void debug.assertNever(r)}return _.compact(i)}}function n(e,t){for(var i=[],n=t.count||1,o=t.role,a=e.projections[o].all(),s=t.index+n-1,l=n-1;l>=0;l--,s--)i.push(r(e,a[s].queryRef,o));return i}function o(e,t){var r=e.defn.selectNameOf(t);return{expr:t,roleName:s(e.projections,r)}}function a(e,t){var i=[],n=e.projections,o=t.sourceCount,a=t.sourceIndex,s=t.sourceRole,l=t.targetRole;if(n[l]){var u=n[l].all(),c=t.targetIndex;c>=a&&s===l&&(c+=o);for(var p=c,d=u.length;p<d;p++)i.push(r(e,u[p].queryRef,l))}if(n[s])for(var f=n[s].all(),p=o-1;p>=0;p--)i.push(r(e,f[a+p].queryRef,s));return i}function s(e,t){for(var r in e){var i=e[r].all();if(_.findIndex(i,(function(e){return e.queryRef===t}))>=0)return r}}e.getDrillableRoles=t,e.getDrillFilterRemovalInfoList=i})(t=e.DrillUtils||(e.DrillUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e,t,r){t.visitExploration(e),p(e.filters,t);var n=e.bookmarks;if(!_.isEmpty(n))for(var a=0,s=n;a<s.length;a++){var l=s[a];i(l,e.sections,r,t)}var u=e.sections;if(!_.isEmpty(u))for(var c=0,d=u;c<d.length;c++){var f=d[c];o(f,t,r)}m(e.pods,t)}function i(e,t,r,o){if(o.visitBookmark(e),h.isBookmarkGroup(e))for(var a=0,s=e.children;a<s.length;a++){var l=s[a];i(l,t,r,o)}else n(e.explorationState,t,r,o.explorationStateVisitor)}function n(e,t,r,i){e&&(d(e.filters,i),_.forOwn(e.sections,(function(e,n){a(e,_.find(t,(function(e){return e.name===n})),r,i)})))}function o(e,t,r){t.visitSection(e),p(e.filters,t),v(e.linkFields,t);var i=e.visualContainers;if(!_.isEmpty(i))for(var n=0,o=i.length;n<o;n++)s(i[n],t.visualContainerVisitor,r)}function a(e,t,r,i){if(e&&t){i.visitSectionState(e),d(e.filters,i);var n=i.visualContainerStateVisitor,o=t.visualContainers;_.forOwn(e.visualContainers,(function(e,t){l(e,_.find(o,(function(e){return e.name===t})),r,n)}))}}function s(r,i,n){var o;if(i.visitVisualContainer(r),r.config&&(o=r.config.singleVisual)){i.visitSingleVisualConfig(o);var a=o.query;a&&i.visitQuery(a);var s=function(e,t){t&&i.visitDataViewObjects(e,t),f(e,i)},l=o.objects;if(l){var u=void 0,c=t.VisualContainerUtils.getVisualCapabilities(r,n);c&&(u=c.objects),s(l,u)}var d=o.vcObjects;if(d){var u=e.contracts.VisualContainer.CommonObjectDescriptors;s(d,u);var v=o.vcObjects.visualLink;v&&i.visitVisualLinks(v)}}p(r.filters,i)}function l(e,t,r,i){e&&t&&(i.visitVisualContainerState(e),d(e.filters,i),u(e.highlight,i),c(e&&e.singleVisual,t,r,i))}function u(e,t){if(e){if(!_.isEmpty(e.selection))for(var r=0,i=e.selection;r<i.length;r++){var n=i[r];t.visitSelectorsByColumn(n)}e.filterExpressionMetadata&&t.visitFilterExpressionMetadata(e.filterExpressionMetadata)}}function c(e,r,i,n){if(e){n.visitSingleVisualState(e);var o=e.orderBy;o&&n.visitOrderByStates(o);var a=e.objects;if(a){var s=t.VisualContainerUtils.getVisualCapabilities(r,i);if(s){var l=s.objects;l&&n.visitDataViewObjectDefinitionUpdates(a,l)}var u=a.merge;u&&f(u,n);var c=a.remove;if(!_.isEmpty(c))for(var p=0,d=c;p<d.length;p++){var v=d[p],m=v.selector;m&&n.visitSelector(m)}}var h=e.activeProjections;h&&n.visitActiveProjectionStates(h)}}function p(e,t){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r];t.visitFilterContainer(n)}}function d(e,t){if(e){var r=e.nameIdentifiedMerges;_.forOwn(r,(function(e){t.visitFilterContainer(e)}));var i=e.exprIdentifiedMerges;if(!_.isEmpty(i))for(var n=0,o=i;n<o.length;n++){var a=o[n];t.visitFilterContainer(a)}}}function f(e,t){_.forOwn(e,(function(e){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r],o=n.selector;o&&t.visitSelector(o)}}))}function v(e,t){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r];t.visitLinkField(n)}}function m(e,t){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r];t.visitPod(n)}}var h=e.contracts.Bookmark;t.traverseExploration=r,t.traverseVisualContainer=s})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.visitVisualContainer=function(e){},e.prototype.visitSingleVisualConfig=function(e){},e.prototype.visitQuery=function(e){},e.prototype.visitDataViewObjects=function(e,t){},e.prototype.visitSelector=function(e){},e.prototype.visitFilterContainer=function(e){},e.prototype.visitVisualLinks=function(e){},e})();e.DefaultVisualContainerVisitor=t;var r=(function(t){function r(e){var r=t.call(this)||this;return r.rewriters=e,r}return __extends(r,t),r.prototype.visitSingleVisualConfig=function(t){t.cachedFilterDisplayItems&&e.rewriteDisplayNameIdentityPairs(t.cachedFilterDisplayItems,this.rewriters)},r.prototype.visitQuery=function(e){if(e.defn)for(var t=this.rewriters,r=0,i=t;r<i.length;r++){var n=i[r];e=n.rewriteQuery(e)}},r.prototype.visitDataViewObjects=function(t,r){e.rewriteFilterOutput(t,r,this.rewriters),e.rewriteDataBoundPropertyDefinitions(t,r,this.rewriters)},r.prototype.visitFilterContainer=function(t){e.rewriteFilterContainer(t,this.rewriters)},r.prototype.visitVisualLinks=function(t){for(var r=0,i=t;r<i.length;r++){var n=i[r];e.rewriteVisualLink(n,this.rewriters)}},r.prototype.visitSelector=function(t){var r=e.rewriteDataRepetitionSelectors(t.data,this.rewriters);r!==t.data&&(t.data=r)},r})(t);e.VisualContainerRewriter=r})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.DictionaryExtensions,r=(function(){function e(){}return e.prototype.visitActiveProjectionStates=function(e){},e.prototype.visitDataViewObjectDefinitionUpdates=function(e,t){},e.prototype.visitFilterContainer=function(e){},e.prototype.visitOrderByStates=function(e){},e.prototype.visitSelector=function(e){},e.prototype.visitSelectorsByColumn=function(e){},e.prototype.visitSingleVisualState=function(e){},e.prototype.visitVisualContainerState=function(e){},e.prototype.visitFilterExpressionMetadata=function(e){},e})();e.DefaultVisualContainerStateVisitor=r;var i=(function(r){function i(e){var t=r.call(this)||this;return t.rewriters=e,t}return __extends(i,r),i.prototype.visitActiveProjectionStates=function(t){var r=this;_.forOwn(t,(function(i,n){var o=i.map((function(t){return e.rewriteExpr(t,r.rewriters)}));t[n]=o}))},i.prototype.visitFilterContainer=function(t){e.rewriteFilterContainerState(t,this.rewriters)},i.prototype.visitDataViewObjectDefinitionUpdates=function(t,r){var i=t.merge;i&&(e.rewriteFilterOutput(i,r,this.rewriters),e.rewriteDataBoundPropertyDefinitions(i,r,this.rewriters))},i.prototype.visitOrderByStates=function(t){for(var r=0,i=t;r<i.length;r++){var n=i[r];n.expr=e.rewriteExpr(n.expr,this.rewriters)}},i.prototype.visitSelector=function(t){var r=e.rewriteDataRepetitionSelectors(t.data,this.rewriters);r!==t.data&&(t.data=r)},i.prototype.visitSelectorsByColumn=function(r){var i=this,n=t.rewriteDictionary(r.dataMap,(function(t,r){return e.rewriteDataRepetitionSelectors(r,i.rewriters)}));n!==r.dataMap&&(r.dataMap=n)},i.prototype.visitFilterExpressionMetadata=function(t){e.rewriteFilterExpressionMetadata(t,this.rewriters)},i})(r);e.VisualContainerStateRewriter=i})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.explorationStateVisitor=e,this.visualContainerVisitor=t}return e.prototype.visitBookmark=function(e){},e.prototype.visitFilterContainer=function(e){},e.prototype.visitExploration=function(e){},e.prototype.visitSection=function(e){},e.prototype.visitLinkField=function(e){},e.prototype.visitPod=function(e){},e})();e.DefaultExplorationVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.visualContainerStateVisitor=e}return e.prototype.visitFilterContainer=function(e){},e.prototype.visitSectionState=function(e){},e})();e.DefaultExplorationStateVisitor=t;var r=(function(t){function r(e,r){var i=t.call(this,r)||this;return i.rewriters=e,i}return __extends(r,t),r.prototype.visitFilterContainer=function(t){e.rewriteFilterContainerState(t,this.rewriters)},r})(t);e.ExplorationStateRewriter=r})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){var r=e.getMetadata(t);if(r){var i=r.format;return ve.create({format:i,allowFormatBeautification:!0})}}function n(e,r,i,n){var o=e.getMetadata(r);if(o){if(5===i)return t.contracts.FilterType.Categorical;var a=o.type,s=a&&(a.text||a.bool||a.dateTime),l=o.idOnEntityKey&&n&&ce.equals(e,n);return!s||de.isMeasure(e)||l?t.contracts.FilterType.Advanced:t.contracts.FilterType.Categorical}}function o(e,r){return de.isMeasure(e)||!r?t.contracts.FilterType.Advanced:t.contracts.FilterType.Categorical}function a(e,t,i,n,o,a,l){if(!t||!i)return!1;if(!r.supportsMeasureFilters(e,a)&&de.isMeasure(t))return!1;var u=pe.asFieldPattern(t,i),c=ne.toFieldExprEntityItemPattern(u),p=i.schema(c.schema);if(!p)return!1;var d,f,v=p.findProperty(c.entity,ne.getPropertyName(u));if(v||(u.hierarchyLevel?(d=p.findHierarchy(c.entity,u.hierarchyLevel.name),d&&(f=d.levels.withName(u.hierarchyLevel.level))):u.columnHierarchyLevelVariation&&(d=p.findHierarchy(u.columnHierarchyLevelVariation.level.entity,u.columnHierarchyLevelVariation.level.name),d&&(f=d.levels.withName(u.columnHierarchyLevelVariation.level.level)))),!v&&!f||!n||!n.container)return!1;if(v&&1===v.kind&&(0!==n.scopeType||p.capabilities.limitMultiColumnFiltersToQueryGroupColumns)&&!o)return!1;if(o){var m=v&&v.kind;if(!(!!f||0===m||1===m))return!1;var h=!1;if(1===n.scopeType){var g=n.container;g&&!g.transient&&(h=!0)}if(!h)return!1}if(0===n.scopeType){var y=n.container;if(!y||!s(y,a,l))return!1}return!0}function s(e,r,i){var n=t.util.VisualContainerUtils.getVisualType(e);return(!i.supportsFilterOutput(e)||i.supportsVisualLevelSlicerFilters())&&r.isQueryVisual(n)}function l(e,r){var i=t.util.VisualContainerUtils.getVisualType(e);return!r.isAnalysisVisual(i)}function u(e){return null!=r.tryGetFilterPropertyIdentifier(e,null,null)}function c(e,t,r){return t&&r&&r.isCustomVisual(t)?te:e?ie.findFilterOutput(e.objects):void 0}function p(e,t,r,i){var n=c(e,t,r);if(n)return re.getValue(i,n,void 0)}function d(e,t){e.filters||(e.filters=[]),e.filters.push(t)}function f(e,r,i){switch(e){case 0:return t.services.selectionUtils.getSelectedVisual(r);case 1:return i.getCurrentSection();case 2:return i.getCurrentExploration();default:debug.assertNever(e)}}function v(e,r,i){if(e){var n={filter:e.filter,name:C(r),type:e.type,restatement:e.restatement,howCreated:i};if(e.type===t.contracts.FilterType.Categorical||e.filterExpressionMetadata&&1===e.filterExpressionMetadata.expressions.length){n.expression=e.filterExpressionMetadata.expressions[0];var o=[];if(!_.isEmpty(e.filterExpressionMetadata.cachedValueItems)){for(var a=0,s=e.filterExpressionMetadata.cachedValueItems;a<s.length;a++){var l=s[a];1===l.identities.length&&o.push({identity:l.identities[0],displayName:l.valueMap[0]})}n.cachedValueItems=o}}else e.filterExpressionMetadata&&(n.filterExpressionMetadata=e.filterExpressionMetadata);return n}}function m(i,n,o,a,s){if(!o)return!1;var l=i.expression;if(!l)return!1;var u=e.data.SQExprUtils.isMeasure(l),c=!_.isEmpty(r.validate(i,n,a)),p=t.util.VisualContainerUtils.hasGrouping(o,n);if(u){if(!p&&!c)return!0;var d=l.getTargetEntity().schema;if(n.schema(d).capabilities.limitMultiColumnFiltersToQueryGroupColumns)return!0;if(t.util.VisualContainerUtils.hasFilterMappingWithNonAggregatableColumns(o,n,s))return!0;if(t.util.VisualContainerUtils.hasGroupByItemsInQuery(o))return!0}return!1}function h(e,t){var r=e.getMetadata(t);if(r)return r.type}function g(t,r){var i=e.data.SQExprUtils.getDefaultValues(t,r);if(!_.isEmpty(i)){return{isNot:!1,scopeIds:[[e.data.createDataViewScopeIdentity(e.data.SQExprUtils.getDataViewScopeIdentityComparisonExpr(t,i))]]}}}function y(e,r,i){var n=e.expression,o=e.filter,a=t.util.ModelAuthoringUtility.validate(n,r,i);if(o&&(a=o.validate(r,i,a)),!_.isEmpty(a))return a}function C(e){if(_.isEmpty(e))return me;for(var t={},r=0,i=e;r<i.length;r++){t[i[r].name]=!0}return fe.findUniqueName(t,me)}function x(e){return e===t.contracts.FilterType.Categorical||e===t.contracts.FilterType.Visual}function S(e,t,r){var i=e.filters,n=[];if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o],l=s&&s.filter;if(l&&_.isEmpty(l.validate(t,r))&&2===s.howCreated&&b(l.where())){var u=E(e,s.expression);u&&n.push(u)}}return n}function b(e){return!_.isEmpty(e)&&_.every(e,(function(e){if(null==e)return!1;var t=e.condition;return ce.isIn(t)?t.values&&1===t.values.length:!!ce.isCompareRef(t)&&0===t.comparison}))}function E(e,r){var i=t.util.VisualContainerUtils.getVisualQuery(e);if(i)return i.defn.selectNameOf(r)}function w(e,t){if(t){var r=t.condition,i=new ge(e);return r.accept(i),i.values}}function V(t,i,n){var o=[],a=n&&n.Filters&&0!==n.Filters.length?n.Filters:null;a&&a.length!==i.length&&(a=null);for(var s=0,l=i.length;s<l;s++){var u=i[s],c=a&&a[s],p=c&&c.expression&&ue.deserializeExpr(c.expression);o.push({name:r.getNextFilterName(o),filter:new e.data.SemanticFilter(t,[u]),restatement:c&&c.Restatement,expression:p,howCreated:0,type:c&&c.type})}return o}function F(e,t){var i=_.filter(e.From,(function(e){return 1!==e.Type})),n={Version:e.Version,From:i,Where:e.Where},o={RemovedIndexes:[]},a=ue.deserializeFilter(n,o);if(t&&!_.isEmpty(o.RemovedIndexes)&&(t.Filters=_.filter(t.Filters,(function(e,t){return!_.includes(o.RemovedIndexes,t)}))),a)return r.deriveFromSQFilters(a.from(),a.where(),t)}function P(e,t){_.isEmpty(e.filters)||(t.filters=z(t.filters,e.filters,"explore"),e.filters=[])}function T(e){var t=e.isHiddenInViewMode===!0,r=e.isLockedInViewMode===!0,i=!!e.displayName,n=void 0!==e.ordinal,o=t||r||i||n;return!!e.filter||!re.isEmpty(e.objects)||o}function N(e,t,r,i,n){var o=n;if(e.filters=O(t,e.filters,r,i),_.isEmpty(i)&&_.isEmpty(r)||(o=!0),o)for(var a=0,s=e.visualContainers;a<s.length;a++){var l=s[a];l.cachedData=null}}function D(e){if(e){var t=e.dataFilters?e.dataFilters.slice():[];e.highlightFiltersUnmerged&&(t=t.concat(e.highlightFiltersUnmerged));for(var r=[],i=[],n=0,o=t;n<o.length;n++){var a=o[n],s=a.filter.where();if(!_.isEmpty(s)){var l=_.filter(s,(function(e){return 1===oe.run(e.condition)}));if(i.push.apply(i,l),!_.isEmpty(l)){var u=_.filter(s,(function(e){return 1!==oe.run(e.condition)}));if(_.isEmpty(u))continue;a={filter:le.fromSQFromAndSQFilters(a.filter.from(),u)}}r.push(a)}}if(!_.isEmpty(i)){var c=le.fromMeasureFilters(e.query,i);c&&r.push({filter:c})}return r}}function R(e,t,r){if(r&&!_.isEmpty(r.cachedValueItems)){var i=j(e,t,r);if(i){var n=[],o=[];for(var a in i.valueMap)n.push(i.valueMap[a]),o.push(r.expressions[a]);return{values:n,columns:o}}}}function I(e,t,r){if(r&&!_.isEmpty(r.cachedValueItems)){var i=j(e,t,r);i&&_.remove(r.cachedValueItems,(function(e){return e===i}))}}function j(e,t,r){if(r&&!_.isEmpty(r.cachedValueItems))for(var i=0,n=r.cachedValueItems;i<n.length;i++){for(var o=n[i],a=new se,s=0,l=o.identities;s<l.length;s++){var u=l[s];u.expr.accept(a)}if(a.keys.length===e.length){for(var c=!0,p=function(r){var i=a.keys[r];if(_.findIndex(e,(function(e){return ce.equals(e,i)}))<0||t[r].value!==a.values[r].value)return c=!1,"break"},d=0;d<a.keys.length;d++){var f=p(d);if("break"===f)break}if(c)return o}}}function O(e,t,r,i){var n=(t||[]).slice();if(_.isEmpty(i)||e&&!_.isEmpty(e.parameters)&&_.remove(n,(function(t){return _.some(e.parameters,(function(e){return e.boundFilter===t.name}))})),!_.isEmpty(i)||!_.isEmpty(r)){return M(M(i,r),n)}return n}function M(e,t){return _.isEmpty(e)?t:_.isEmpty(t)?e:z(A(e,t)||[],e||[],"param")}function A(e,t){if(_.isEmpty(e)||_.isEmpty(t))return t;var r=$(e);return _.filter(t,(function(e){var t=Z(e);return!_.some(t,(function(e){return _.some(r,(function(t){return ce.equals(t,e,!1,!0)}))}))}))}function k(e,t){e=e||[],t=t||[];for(var r={},i=[],n=0,o=t;n<o.length;n++){var a=o[n];r[a.name]=a}for(var s=0,l=e;s<l.length;s++){var a=l[s],u=r[a.name];u&&_.isEqual(u,a)||i.push(a)}return i}function z(e,t,r){var i={};e=e||[];for(var n=0,o=e;n<o.length;n++){var a=o[n];i[a.name]=!0}for(var s=0,l=t;s<l.length;s++){var a=l[s];a.name=r+"_"+a.name,i[a.name]||(i[a.name]=!0)}return e.concat(t)}function B(e,t,r,i){return 6!==e&&(!(5===e&&!t&&ce.isMeasure(r))&&!!i)}function U(e){return _.some(e.filters,(function(e){return 5===e.howCreated&&!e.isTransient&&(e.isLinkedAsAggregation||e.expression&&ce.isMeasure(e.expression))}))}function L(e,r){e.publishToChannel(t.services.events.userActionTriggered,{source:"UserAction_ChangeFilter"}),e.publishToChannel(t.services.events.filterContainerChanged,r)}function q(e,r,i,n,o,a){var s={filterScopeType:r,filterType:i,id:n,canApply:o,wasDeleted:a};e.publishToChannel(t.services.events.applyAllBufferedFilterCardChanged,s)}function G(e,r,i){var n,o,a;return r?(n=e&&e.$instances&&e.$instances[t.constants.ExploreCanvasConstants.Applied],o=i.colorPalette.backgroundLight.value,a=t.constants.ExploreCanvasConstants.DefaultAppliedFilterCardTransparency):(n=e&&e.$instances&&e.$instances[t.constants.ExploreCanvasConstants.Available],o=i.colorPalette.background.value,a=t.constants.ExploreCanvasConstants.DefaultAvailableFilterCardTransparency),{borderColor:W(n),backgroundColor:X(n,o,a),foregroundColor:K(n,"foregroundColor",i.colorPalette.foreground.value),inputBoxBorderColor:W(n,!0),inputBoxBackgroundColor:K(n,"inputBoxColor",t.constants.ExploreCanvasConstants.DefaultControlBackgroundColor),inputBoxForegroundColor:K(n,"foregroundColor",t.constants.ExploreCanvasConstants.DefaultControlForegroundColor),fontSize:J(n),fontFamily:Y(n)}}function H(e,t,r){if(5===e.howCreated){return null!=r.defaultAggregate(e.expression,t)}}function Q(e,t,r){var i=null;return i=t===ae.Include?e.get("Include_Label"):e.get("FilterPane_Exclude"),i+" ("+r+")"}function W(r,i){var n=e.DataViewObject.getFillColorByPropertyName(r,"borderColor",t.constants.ExploreCanvasConstants.DefaultFilterCardBorderColor),o=e.DataViewObject.getValue(r,"border",t.constants.ExploreCanvasConstants.DefaultFilterCardBorder),a=0;return(o===!0||i)&&(a=1),ee.hexToRGBString(n,a)}function X(t,r,i){var n=e.DataViewObject.getFillColorByPropertyName(t,"backgroundColor",r),o=ee.convertTransparencyToOpacity(e.DataViewObject.getValue(t,"transparency",i));return ee.hexToRGBString(n,o)}function K(t,r,i){var n=e.DataViewObject.getFillColorByPropertyName(t,r,i);return ee.hexToRGBString(n)}function J(r){return e.DataViewObject.getValue(r,"textSize",t.constants.ExploreCanvasConstants.DefaultFilterCardTextSizePt)+"pt"}function Y(r){return e.DataViewObject.getValue(r,"fontFamily",t.constants.ExploreCanvasConstants.DefaultOutspacePaneFontFamily)}function $(e){return _.flatten(_.map(e,(function(e){return Z(e)})))}function Z(e){var t=[];if(e.expression&&t.push(e.expression),e.filter)for(var r=0,i=e.filter.conditions();r<i.length;r++){var n=i[r],o=new he;n.accept(o),t=t.concat(o.fields)}return t}var ee=e.common.utils.ColorUtility,te=e.visualHost.CustomVisualsFilterPropertyIdentifier,re=e.data.DataViewObjectDefinitions,ie=e.data.DataViewObjectDescriptors,ne=e.data.FieldExprPattern,oe=e.data.FilterKindDetector,ae=t.contracts.FilterType,se=e.data.ScopeIdentityExtractor.ScopeIdKeysAndValuesExtractorImpl,le=e.data.SemanticFilter,ue=e.data.services.SemanticQuerySerializer,ce=e.data.SQExpr,pe=e.data.SQExprConverter,de=e.data.SQExprUtils,fe=jsCommon.StringExtensions,ve=e.visuals.valueFormatter,me="Filter";r.getFormatter=i,r.getDefaultFilterType=n,r.getFilterType=o,r.canAdd=a,r.supportsVisualFilters=s,r.supportsMeasureFilters=l,r.supportsFilterOutput=u,r.tryGetFilterPropertyIdentifier=c,r.tryGetFilterProperty=p,r.add=d,r.getFiltersContainer=f,r.convertFilterData=v,r.shouldDisableFilter=m,r.getValueType=h,r.getDefaultRetainedValue=g,r.validate=y,r.getNextFilterName=C,r.isCategoricalFilter=x,r.getQueryRefsForSingleItemDrillFilters=S,r.getFilterValuesForColumn=w,r.deriveFromSQFilters=V,r.extractParameterFilters=F,r.mergeExplorationSectionFilters=P,r.isFilterModified=T,r.applySectionParameterFilters=N,r.getFiltersToApplyFromVisualQueryFilterContext=D,r.findValuesInFilterCache=R,r.removeEntryFromFilterCache=I,r.findIdentityMapInFilterCache=j,r.getNonoverriddenFilters=A,r.extractParameterFiltersFromSection=k,r.mergeFilters=z,r.canExpandManually=B,r.hasMeasureOrAsAggregationLinkField=U,r.notifyFilterContainerChangedByUser=L,r.notifyBufferedFilterChanges=q,r.getFilterCardStyle=G,r.determineIsLinkedAsAggregation=H,r.getDisplayNameForIncludeExcludeFilters=Q;var he=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.visitColumnRef=function(e){this.fields.push(e)},t.prototype.visitHierarchyLevel=function(e){this.fields.push(e)},t.prototype.visitMeasureRef=function(e){this.fields.push(e)},t.prototype.visitEntity=function(e){this.fields.push(e)},t.prototype.visitAggr=function(){},t})(e.data.DefaultSQExprVisitorWithTraversal),ge=(function(e){function t(t){var r=e.call(this)||this;return r.comparisonColumn=t,r.values=[],r}return __extends(t,e),t.prototype.visitCompare=function(e){0===e.comparison&&ce.isConstant(e.right)&&ce.equals(e.left,this.comparisonColumn)&&this.values.push(e.right)},t.prototype.visitIn=function(e){var t=this;if(!_.isEmpty(e.values)){var r=e.args,i=_.findIndex(r,(function(e){return ce.equals(e,t.comparisonColumn)}));if(!(i<0))for(var n=0,o=e.values;n<o.length;n++){var a=o[n];this.values.push(a[i])}}},t})(e.data.DefaultSQExprVisitor)})(r=t.FilterUtils||(t.FilterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.SQExpr,n=e.data.SQExprBuilder,o=e.data.SQExprConverter,a=e.data.SQExprGroupUtils,s=e.data.SQHierarchyExprUtils;!(function(t){function r(e,t,r,n){if(r&&t&&i.isHierarchyLevel(n)){for(var o=n,l=o.arg,u=s.expandExpr(e,l),c=[],p=function(t){var n=r.tryGetExprs(t.name);if(!n)return"continue";var p=void 0;if(i.isHierarchy(l)&&i.isPropertyVariationSource(l.arg)){var d=l.arg;p=_(a.groupExprs(e,n)).filter((function(e){return e.isHierarchyLevelsGroup&&i.isColumn(e.expr)&&i.equals(e.expr.source,d.arg)&&e.expr.ref===d.property})).reverse().value()}else p=_(a.groupExprs(e,n)).filter((function(e){return i.equals(e.expr,l)})).reverse().value();for(var f=0,v=p;f<v.length;f++){var m=v[f],h=s.getInsertionIndex(u,m.children,o);c.push({expr:o,schema:e,targetRole:t.name,targetIndex:m.selectQueryIndex+h})}},d=0,f=t.dataRoles;d<f.length;d++){p(f[d])}return c}}function l(t,r){if(t&&t.kind===e.VisualDataRoleKind.Measure){var i=s.getHierarchySourceAsVariationSource(r);if(i)return n.columnRef(i.arg,i.property)}}function u(e,t,r,n,o,a){var s=e.singleVisual.query.tryGetExprs(t)||[],u=s.slice(r,r+n);if(!_.isEmpty(u)){var c;if(c=_.isEmpty(a)?u[0]:a[0],i.isHierarchyLevel(c)){var p=l(o,c);if(p)return[p]}return _.isEmpty(a)?u:a}}function c(e,t){return i.isHierarchyLevel(e)&&i.isHierarchyLevel(t)&&i.equals(e.arg,t.arg)}function p(e,t){var r=o.asFieldPattern(t),i=r.hierarchyLevel;if(i){var n=e.findHierarchy(i.entity,i.name);return n?_.findIndex(n.levels,(function(e){return e.name===i.level})):void 0}}function d(e){_.isEmpty(e)||e.sort(f)}function f(e,t){return e.displayName.localeCompare(t.displayName,void 0,{sensitivity:"base"})}t.getOptionsToAddHierarchyLevelToExistingHierarchies=r,t.getHierarchyReplacementExpressions=u,t.hierarchyLevelComparer=c,t.findHierarchyLevelIndex=p,t.sortHierarchies=d})(r=t.HierarchyUtils||(t.HierarchyUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.DataViewMatrixUtils,n=e.visuals.matrixRoleNames,o=e.data.SQExprUtils;!(function(e){function t(e,t,i,o,l,u){if(e.matrix){for(var c=[],d=[],f=[],v=[],m=e.matrix,h=0,g=t;h<g.length;h++){var y=g[h],C=__assign({},y);C.roles={},c.push(C)}var x=function(e){if(u&&u.featureSwitches.showGeneratedColumnsInDetailView)return!0;var r=t[e.index];return!r||!_.isEmpty(r.roles)};if(r(m.rows,c,d,n.rows)&&r(m.columns,c,f,n.columns,(function(e){return!e.isMeasure}))&&a(m.valueSources,c,i,v,n.values,x)){var S=e;s(o,l,d,f,v),i&&i.length>1&&(S=p(e,i,t));var b={};d.length>0&&(b[n.rows]=d),f.length>0&&(b[n.columns]=f),v.length>0&&(b[n.values]=v);return{transformActions:{selects:c,roles:{ordering:b}},dataView:S}}}}function r(e,t,r,i,n){if(!e||_.isEmpty(e.levels))return!0;for(var o=0,s=e.levels;o<s.length;o++){if(!a(s[o].sources,t,[],r,i,n))return!1}return!0}function a(e,t,r,i,n,o){if(_.isEmpty(e))return!0;for(var a=d(r,t),s=function(r){if(!o||o(r)){if(null==r.index&&_.some(e,(function(e){return e.formatSource&&e.formatSource.formatString===r})))return"continue";if(a[r.index]||i.push(r.index),!t[r.index])return{value:!1};t[r.index].roles[n]=!0}},l=0,u=e;l<u.length;l++){var c=u[l],p=s(c);if("object"==typeof p)return p.value}return!0}function s(e,t,r,i,n){if(!_.isEmpty(e)&&t){var o=r.length>=2,a=i.length>=2,s=n.length>=2;if(o||a||s){var c=l(e,t);c&&(o&&u(r,c),a&&u(i,c),s&&u(n,c))}}}function l(e,t){var r=_.chain(e).map((function(e){return t[e]})).flatten().filter((function(e){return _.isNumber(e)})).value(),i=_.reduce(r,(function(e,t,r){return void 0===e[t]&&(e[t]=r),e}),{});return Object.keys(i).length>=2?i:void 0}function u(e,t){e.sort((function(e,r){return c(e,t)-c(r,t)}))}function c(e,t,r){return void 0===r&&(r=Number.MAX_VALUE),_.isNumber(t[e])?t[e]:r}function p(e,t,r){var i=(e.matrix,d(t,r)),n=e;return _.isEmpty(Object.keys(i))||_.isEmpty(e.matrix.columns.root.children)||_.isEmpty(e.matrix.rows.root.children)||(n=_.cloneDeep(e),m(n.matrix,i),f(n,i)),n}function d(e,t){var r={};if(e&&e.length>1){var i=!1;for(var n in e[0].selects){var a=t[n];if(a.expr&&o.isMeasure(a.expr)){i=!0;break}}if(i)for(var n in e[1].selects){var a=t[n];a.expr&&o.isMeasure(a.expr)&&(r[n]=!0)}}return r}function f(e,t){var r=e.matrix,n=0,o=r.columns.root;_.isEmpty(r.columns.root.children)?n=_.filter(r.valueSources,(function(e){return!t[e.index]})).length:i.forEachLeafNode(o,(function(){return n++}));for(var a=r.columns.levels[0],s=0,l=r.valueSources;s<l.length;s++){var u=l[s];if(t[u.index]){a.sources.push(u);var c={level:0,levelSourceIndex:a.sources.length-1};o.children.push(c)}}var p=v(e,t),d=0;i.forEachLeafNode(e.matrix.rows.root,(function(e){var t=n;for(var r in p){var i=p[r];e.values[t]={value:i[d],valueSourceIndex:parseInt(r,10)},t++}d++}))}function v(e,t){for(var r={},i=function(i){if(i.source&&t[i.source.index]){r[_.findIndex(e.matrix.valueSources,(function(e){return e.index===i.source.index}))]=i.values}},n=0,o=e.categorical.values;n<o.length;n++){i(o[n])}return r}function m(e,t){for(var r={},i=[],n=0;n<e.valueSources.length;n++){var o=e.valueSources[n];if(t[o.index]&&(r[n]=!0,i.push(o),o&&o.formatSource&&o.formatSource.formatString)){var a=o.formatSource.formatString;r[e.valueSources.indexOf(a)]=!0,i.push(a),delete o.formatSource}}h(e.columns,r),e.valueSources=g(e.rows,r,e.valueSources);var s=_.last(e.columns.levels);s.sources=s.sources.filter((function(e){return!_.find(i,(function(t){return t===e}))}))}function h(e,t){for(var r=i.getLeafNodesPath(e.root),n=0,o=r;n<o.length;n++){var a=o[n],s=a.length-2,l=a[s];l.children=_.filter(l.children,(function(e){return!t[e.levelSourceIndex||0]})),l.children&&null!=l.level&&1===l.children.length&&delete l.children}}function g(e,t,r){if(!_.isEmpty(e.root.children)){var n=r.filter((function(e,r){return e&&!t[r]})),o=n.length;return n.push.apply(n,r.filter((function(e,r){return e&&null!=e.index&&t[r]}))),i.forEachLeafNode(e.root,(function(e){var r={},i=0;for(var n in e.values){var a=e.values[n];if(!t[a.valueSourceIndex||0]){var s=i%o;0===s?delete a.valueSourceIndex:a.valueSourceIndex=s,r[i]=a,i++}}e.values=r})),n}}e.generate=t,e.fixMeasuresGroupedByRowHierarchy=p})(r=t.MatrixVisualDataViewConverter||(t.MatrixVisualDataViewConverter={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.SQExpr,o=e.data.SQExprBuilder,a=e.data.SQExprConverter;!(function(e){function t(e,t,r){if(e){var n=a.asFieldPattern(e),o=i.toFieldExprEntityItemPattern(n),s=""===o.entity?null:o.entity;f({itemShowHide:{schema:o.schema,entity:s,property:m(n),objectType:v(n),makeHidden:t}},r)}}function r(e,t,r){if(e){var i=a.asFieldPattern(e),n=i.hierarchyLevel;if(n){f({hierarchyLevelMove:{schema:n.schema,entity:n.entity,hierarchy:n.name,level:n.level,index:t}},r)}}}function s(e,t){var r=i.toFieldExprEntityItemPattern(e);f({entityRefresh:{schema:r.schema,entity:r.entity}},t)}function l(e,t,r){if(e){var n,o=a.asFieldPattern(e),s=i.toFieldExprEntityItemPattern(o);if(o.hierarchyLevel){var l=o.hierarchyLevel;n={hierarchyLevelRename:{schema:l.schema,entity:l.entity,hierarchy:l.name,before:l.level,after:t}}}else i.hasFieldExprName(o)?n={propertyRename:{schema:s.schema,entity:s.entity,objectType:v(o),before:m(o),after:t}}:o.hierarchy?n={propertyRename:{schema:s.schema,entity:s.entity,objectType:v(o),before:i.getHierarchyName(o),after:t}}:s.entity&&(n={entityRename:{schema:s.schema,before:s.entity,after:t}});return f(n,r)}}function u(e,t){if(!_.isEmpty(e)){for(var r,i=[],o=0,s=e;o<s.length;o++){var l=s[o],u=a.asFieldPattern(l),c=u.column||u.groupingColumn;if(!c)return;if(r){if(!n.equals(l.source,r))return}else r=l.source;i.push(c.name)}f({hierarchyCreate:{schema:r.schema,entity:r.entity,name:null,properties:i}},t)}}function c(e,t,r,i){if(e){var n=a.asFieldPattern(e),o=n.column||n.groupingColumn;if(o){f({hierarchyLevelCreate:{schema:o.schema,entity:o.entity,hierarchy:t,property:o.name,index:r}},i)}}}function p(e){if(null!=e&&!_.isEmpty(e.changes)){var t=_.filter(e.changes,(function(e){return e.newMeasureCreated||e.newCalculatedColumnCreated||e.measureMove||e.newCalculatedTableCreated||e.newBins||e.newGroups}));if(0!==t.length){var r,i,n,a,s=t[t.length-1];return s.newMeasureCreated?(r=s.newMeasureCreated.schema,i=s.newMeasureCreated.entity,a=s.newMeasureCreated.name,o.measureRef(o.entity(r,i),a)):s.newCalculatedColumnCreated?(r=s.newCalculatedColumnCreated.schema,i=s.newCalculatedColumnCreated.entity,n=s.newCalculatedColumnCreated.name,o.columnRef(o.entity(r,i),n||a)):s.newCalculatedTableCreated?(r=s.newCalculatedTableCreated.schema,i=s.newCalculatedTableCreated.entity,o.entity(r,i)):s.measureMove?(r=s.measureMove.schema,i=s.measureMove.destination,a=s.measureMove.property,o.measureRef(o.entity(r,i),a)):s.newBins?(r=s.newBins.schema,i=s.newBins.entity,n=s.newBins.name,o.columnRef(o.entity(r,i),n)):s.newGroups?(r=s.newGroups.schema,i=s.newGroups.entity,n=s.newGroups.name,o.columnRef(o.entity(r,i),n)):void 0}}}function d(e,t,r){var i=[];if(e&&(i=e.validate(t,r,i)),!_.isEmpty(i))return i}function f(e,t){return t.apply({changes:[e]})}function v(e){if(m(e)){if(e.column||e.groupingColumn)return"Column";if(e.measure)return"Measure";if(e.hierarchy)return"Hierarchy"}return"Table"}function m(e){return i.getPropertyName(e)||i.getHierarchyName(e)}function h(e,t,r){var n,o=a.asFieldPattern(e);if(o.hierarchyLevel){var s=o.hierarchyLevel;n={setDescription:{schema:s.schema,topLevelObjectName:s.entity,tableItemName:s.name,levelName:s.level,objectType:"Level",description:t}}}else{var l=i.toFieldExprEntityItemPattern(o);
n={setDescription:{schema:l.schema,topLevelObjectName:l.entity,tableItemName:m(o),objectType:v(o),description:t}}}f(n,r)}e.hide=t,e.move=r,e.refreshEntity=s,e.rename=l,e.createHierarchy=u,e.createHierarchyLevel=c,e.getSelectedItemFromModelChange=p,e.validate=d,e.getObjectTypeForSchemaChange=v,e.getFieldExprReferenceNameInEntity=m,e.setDescription=h})(r=t.ModelAuthoringUtility||(t.ModelAuthoringUtility={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}var r;!(function(e){e[e.None=0]="None",e[e.DuplicatedName=1]="DuplicatedName",e[e.EmptyName=2]="EmptyName",e[e.NameTooLong=3]="NameTooLong"})(r=e.NameValidationError||(e.NameValidationError={})),e.createNameValidator=t;var i=(function(){function e(e,t){this.federatedConceptualSchema=e,this.localizationService=t,this.MaximumNameLength=512}return e.prototype.validateMeasureName=function(t,i){if(!t||0===t.trim().length)return{error:r.EmptyName,reason:this.localizationService.get("NameValidationFailedEmptyName")};if(t.length>this.MaximumNameLength)return{error:r.NameTooLong,reason:this.localizationService.format("NameValidationFailedLongName",[t,this.MaximumNameLength])};var n=e.normalizeModelItemName(t);return i&&e.normalizeModelItemName(i)===n?{error:r.None}:this.validateColumnAndMeasureNameUniqueness(n)},e.prototype.validateExistingMeasureName=function(t){var r=e.normalizeModelItemName(t.name);return this.validateColumnAndMeasureNameUniqueness(r,(function(e,r){return r!==t}))},e.prototype.makeValidMeasureName=function(e){var t=this;return this.makeValidName(e,(function(e){return t.validateMeasureName(e).error}))},e.prototype.makeValidName=function(e,t){var i,n=e,o=t(n);if(o===r.DuplicatedName)i=2;else{if(o===r.None)return e;i=0}for(;;){var a=void 0;switch(a=i?n+" "+i:n,o=t(a)){case r.None:return a;case r.DuplicatedName:i++,1===i&&(i=2);continue;case r.NameTooLong:n=n.slice(0,Math.min(this.MaximumNameLength,n.length-1)),i=0;continue;default:throw new Error("MakeValidName encountered a problem it can't fix.")}}},e.prototype.validateColumnAndMeasureNameUniqueness=function(t,i){for(var n=0,o=this.federatedConceptualSchema.schemas;n<o.length;n++)for(var a=o[n],s=0,l=a.entities;s<l.length;s++)for(var u=l[s],c=0,p=u.properties;c<p.length;c++){var d=p[c];if((!i||i(u,d))&&e.normalizeModelItemName(d.name)===t){var f=d.measure?"NameValidationFailedCollisionMeasure":"NameValidationFailedCollisionColumn";return{error:r.DuplicatedName,reason:this.localizationService.format(f,[d.name,u.name])}}}return{error:r.None}},e.normalizeModelItemName=function(e){return jsCommon.StringExtensions.normalizeCase(e)},e})()})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new a(e,t,r,i)}var i=e.data.QueryProjectionCollection,n=e.data.QueryProjectionsByRole,o=(function(){function e(e,t,r){this.plugin=e,this.initialize(t,r)}return Object.defineProperty(e,"ValuesRoleName",{get:function(){return e.ValuesRole},enumerable:!0,configurable:!0}),e.getProjection=function(e,t){var r=n.getRole(e,t);return r||(e[t]=r=new i([])),r.all()},e.addCategoryRole=function(t,r){e.getProjection(t,e.CategoryRole).push(r.projection)},e.addValuesRole=function(t,r){e.getProjection(t,e.ValuesRole).push(r.projection)},e.addSeriesRole=function(t,r){e.getProjection(t,e.SeriesRole).push(r.projection)},e.addBreakdownRole=function(t,r){e.getProjection(t,e.BreakdownRole).push(r.projection)},e.addGroupRole=function(t,r){e.getProjection(t,e.GroupRole).push(r.projection)},e.addDetailsRole=function(t,r){e.getProjection(t,e.DetailsRole).push(r.projection)},e.addYRole=function(t,r){e.getProjection(t,e.YRole).push(r.projection)},e.addTargetValueRole=function(t,r){e.getProjection(t,e.TargetValueRole).push(r.projection)},e.addMinValueRole=function(t,r){e.getProjection(t,e.MinValueRole).push(r.projection)},e.addMaxValueRole=function(t,r){e.getProjection(t,e.MaxValueRole).push(r.projection)},e.addXRole=function(t,r){e.getProjection(t,e.XRole).push(r.projection)},e.addSizeRole=function(t,r){e.getProjection(t,e.SizeRole).push(r.projection)},e.addGradientRole=function(t,r){e.getProjection(t,e.GradientRole).push(r.projection)},e.addTooltipRole=function(t,r){e.getProjection(t,e.TooltipRole).push(r.projection)},e.addRowsRole=function(t,r){e.getProjection(t,e.RowsRole).push(r.projection)},e.addColumnsRole=function(t,r){e.getProjection(t,e.ColumnsRole).push(r.projection)},e.prototype.initialize=function(e,t){var r=e.select();this.projectionsInfo=[];for(var i=0,n=r.length;i<n;i++){var o=r[i];this.projectionsInfo.push({projection:{queryRef:o.name},metadata:o.expr.getMetadata(t)})}},e.ValuesRole="Values",e.SeriesRole="Series",e.BreakdownRole="Breakdown",e.CategoryRole="Category",e.GroupRole="Group",e.DetailsRole="Details",e.YRole="Y",e.XRole="X",e.SizeRole="Size",e.GradientRole="Gradient",e.PlayRole="Play",e.RowsRole="Rows",e.ColumnsRole="Columns",e.MinValueRole="MinValue",e.MaxValueRole="MaxValue",e.TargetValueRole="TargetValue",e.TooltipRole="Tooltips",e})();t.QueryProjectionBuilder=o;var a=(function(e){function t(t,r,i,n){var o=e.call(this,t,i,n)||this;return o.dataRoles=r,o}return __extends(t,e),t.prototype.validatePlugin=function(){return!0},t.prototype.build=function(){for(var e={},t=0,r=this.dataRoles.length;t<r;t++){var i=this.dataRoles[t],n=this.projectionsInfo[i.Projection];if(n&&(o.getProjection(e,i.Name).push(n.projection),i.isActive)){e[i.Name].addActiveQueryReference(n.projection.queryRef)}}return e},t})(o);t.DataRolesQueryProjectionBuilder=a,t.createProjectionBuilderFromDataRoles=r})(r=t.QueryProjectionBuilderCoreUtils||(t.QueryProjectionBuilderCoreUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e,t,r,i){var n=i.defer(),o=m(e,t);return o===-1?n.resolve(void 0):r.get(e.reportId,e.pods[o].name).then((function(e){var t=e&&e.words.slice();if(_.isEmpty(t))n.resolve(void 0);else{t.shift();var r={altNames:t};n.resolve(r)}})),n.promise}function i(e,t,r){var i=m(e,t);i>-1&&(r.set(e.reportId,e.pods[i].name,[]),R(e,i,r,!1))}function n(e,t,r){var i=m(e,t);i>-1&&(r.set(e.reportId,e.pods[i].name,[]),I(e,i))}function o(e,t,r){return a(e,t.name,t.displayName,r)}function a(e,t,r,i){var n=N(e,t,0,0);return i.get(e.reportId,n.name).then((function(t){var o=t&&t.words;_.isEmpty(o)?o=[r]:o[0]=r,i.set(e.reportId,n.name,o)}))}function s(e,t,r,i){var n=N(e,t.name,0,0);r.unshift(t.displayName),i.set(e.reportId,n.name,r)}function l(e,t,r,i,n,o,a){var s=N(e,t,0,0);s.parameters||(s.parameters=[]);var l={name:"Param_"+r,boundFilter:r,fieldExpr:i,asAggregation:n,isLegacySingleSelection:o};s.parameters.push(l),null!=s.type&&0!==s.type||0===a||(s.type=a)}function u(e,t,r,i){var n=m(e,t);if(n>-1){var o=e.pods[n],a=T(o,r);a>-1&&(o.parameters.splice(a,1),R(e,n,i,!0))}}function c(e,t,r,i){var n=m(e,t);if(n>-1){var o=e.pods[n],a=T(o,r);a>-1&&(o.parameters[a].asAggregation=i)}}function p(e,t,r){var i=m(e,t);return i!==-1&&T(e.pods[i],r)!==-1}function d(e,t,r,i){var n,o=m(e,t);(o!==-1||r)&&(o===-1?(n=D(e,t,0,0),o=e.pods.length-1):n=e.pods[o],n.cortanaEnabled=r,R(e,o,i,!0))}function f(e,t){if(e&&e.pods){var r=e.pods,i=_.findIndex(r,(function(e){return e.name===t}));return i!==-1?i:void 0}}function v(e,t,r,i,n){var o=m(e,e.sections[r].name);if(o===-1)return n.resolve();var a=e.pods[o],s=void 0!==a.config?a.config.acceptsFilterContext:0,l=D(e,t.name,a.referenceScope,s);return l.cortanaEnabled=a.cortanaEnabled,l.parameters=_.cloneDeep(a.parameters),l.type=a.type,O(e.reportId,t,l,a,i)}function m(e,t){return e&&e.pods?_.findIndex(e.pods,(function(e){return e.boundSection===t})):-1}function h(e,t){var r=m(e,t);if(r!==-1)return e.pods[r]}function g(e,t,r){var i=h(e,t);if(i||0===r||(i=D(e,t,0,r)),i)return null==i.config?void(i.config={acceptsFilterContext:r}):void(i.config.acceptsFilterContext!==r&&(i.config.acceptsFilterContext=r))}function y(e,t,r){var i=h(e,t);i||0===r||(i=D(e,t,r,0)),i&&null!=r&&i.referenceScope!==r&&(i.referenceScope=r)}function C(e,t){if(!e||!t)return!0;var r=h(e,t.name);return!r||!r.config||0===r.config.acceptsFilterContext}function x(t,r){if(!t||!r)return!1;var i=h(t,r.name);return!(!i||!i.config)&&e.DrillthroughUtils.hasMeasureOrAsAggregationPodParameter(i.type,i.parameters)}function S(e,t){if(!e||!t)return!1;var r=h(e,t.name);return!!r&&1===r.referenceScope}function b(e){return e?1:0}function E(e){return e?0:1}function w(e){return 0===e.type||void 0===e.type?1:1===e.type?2:0}function V(e,t,r){if(!e||!t)return!1;var i=h(e,t.name);if(!i||_.isEmpty(i.parameters))return!1;var n=T(i,r.name);return n!==-1&&i.parameters[n].asAggregation}function F(t,r){return r&&1===r.scopeType&&e.FilterUtils.isCategoricalFilter(t.type)&&!t.isTransient}function P(e,t,r){var i=m(e,t);if(i!==-1){var n=e.pods[i];_.isEmpty(n.parameters)&&(n.type=0),n.type=r}}function T(e,t){return e&&e.parameters?_.findIndex(e.parameters,(function(e){return e.boundFilter===t})):-1}function N(e,t,r,i){var n=h(e,t);return n?n:D(e,t,r,i)}function D(e,t,r,i){e.pods||(e.pods=[]);var n={name:j(e.pods),boundSection:t,parameters:[],type:0,referenceScope:r,config:{acceptsFilterContext:i}};return e.pods.push(n),n}function R(e,t,r,i){var n=e.pods[t];_.isEmpty(n.parameters)&&(n.type=0),!n.cortanaEnabled&&_.isEmpty(n.parameters)&&0===n.config.acceptsFilterContext&&0===n.referenceScope&&(i?r.get(e.reportId,n.name).then((function(r){r&&!_.isEmpty(r.words)||I(e,t)})):I(e,t))}function I(e,t){e.pods.splice(t,1),0===e.pods.length&&(e.pods=void 0)}function j(e){for(var t={},r=0,i=e;r<i.length;r++){t[i[r].name]=!0}return M.findUniqueName(t,A)}function O(e,t,r,i,n){return n.get(e,i.name).then((function(i){var o=i&&i.words.slice();_.isEmpty(o)||(o.shift(),o.unshift(t.displayName),n.set(e,r.name,o))}))}var M=jsCommon.StringExtensions,A="Pod";t.getLinguisticMetadata=r,t.deleteLinguisticEntity=i,t.deletePod=n,t.ensurePod=o,t.updateLinguisticPrimaryName=a,t.updateLinguisticAltNames=s,t.addParameter=l,t.deleteParameter=u,t.updateParameter=c,t.hasParameter=p,t.setCortanaEnabled=d,t.findPodIndexForPodName=f,t.duplicatePod=v,t.findPodIndexForSectionName=m,t.findPodForSectionName=h,t.updateConfig=g,t.updateReferenceScope=y,t.acceptsAllFiltersWhenLinked=C,t.hasMeasureOrAsAggregation=x,t.acceptsCrossReportDrillthrough=S,t.determineReferenceScope=b,t.determineAcceptsFilterContextKind=E,t.determineType=w,t.isLinkedAsAggregation=V,t.isPodEnabled=F,t.updateType=P})(t=e.PodUtils||(e.PodUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return void 0===t&&(t=!0),{automaticallyImport:t,sandboxProperties:[2,3,1,0],visualTypeOptions:{class:"powerApps",titleKey:"PowerAppsForPowerBI"},providers:{blocker:{blockedInCluster:function(){return e.featureSwitches.disablePowerAppsVisual},blockedInTenant:function(){return e.featureSwitches.disablePowerAppsVisual}}}}}e.createPowerAppsVisualRegisterOptions=t})(t=e.PowerAppsVisualHelper||(e.PowerAppsVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(r){for(var i=[],n=0,o=r;n<o.length;n++){var a=o[n];a.measureMove&&i.push(new p(e.data.createMoveMeasureRewriter(a.measureMove),t.util.BindingRewrite.createMeasureMoveRewriter(a.measureMove))),a.entityRename&&i.push(new p(e.data.createEntityRenameRewriter(a.entityRename),t.util.BindingRewrite.createEntityRenameRewriter(a.entityRename))),a.propertyRename&&i.push(new p(e.data.createPropertyRenameRewriter(a.propertyRename),t.util.BindingRewrite.createPropertyRenameRewriter(a.propertyRename))),a.hierarchyLevelRename&&i.push(new p(e.data.createHierarchyLevelRenameRewriter(a.hierarchyLevelRename),t.util.BindingRewrite.createHierarchyLevelRenameRewriter(a.hierarchyLevelRename))),a.removeVariation&&i.push(new d(new c(a.removeVariation),a.removeVariation))}return i}function n(e,t){var r=l.asFieldPattern(e);return r.columnHierarchyLevelVariation&&r.columnHierarchyLevelVariation.source.entity===t.entity&&r.columnHierarchyLevelVariation.source.schema===t.schema&&r.columnHierarchyLevelVariation.source.name===t.property&&r.columnHierarchyLevelVariation.variationName===t.name}var o=e.data.SQColumnRefExpr,a=e.data.SQEntityExpr,s=e.data.SQExpr,l=e.data.SQExprConverter,u=e.data.SQExprRewriter;r.createSchemaChangeRewriters=i;var c=(function(e){function t(t){var r=this;return r=e.call(this)||this,r.change=t,r}return __extends(t,e),t.prototype.visitHierarchyLevel=function(e){return n(e,this.change)?new o(new a(this.change.schema,this.change.entity),this.change.property):e},t})(u),p=(function(){function e(e,t){this.exprRewriter=e,this.spanRewriter=t}return e.prototype.rewriteQuery=function(e){var t=this,r=e.defn;return r=r.rewrite(this.exprRewriter),e.defn=r,e.expansionStates=_.map(e.expansionStates,(function(e){return e.rewrite(t.exprRewriter)})),e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.exprRewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.exprRewriter)},e.prototype.rewriteSpan=function(e){return this.spanRewriter?this.spanRewriter.rewriteSpan(e):e},e})();r.VisualQueryExprRewriter=p;var d=(function(){function e(e,t){this.exprRewriter=e,this.change=t}return e.prototype.rewriteQuery=function(e){var t=this;this.removeDuplicateSQHierarchyLevelExpr(e);var r=e.defn;return r=r.rewrite(this.exprRewriter),e.defn=r,e.expansionStates=_.map(e.expansionStates,(function(e){return e.rewrite(t.exprRewriter)})),e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.exprRewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.exprRewriter)},e.prototype.rewriteSpan=function(e){return e},e.prototype.removeDuplicateSQHierarchyLevelExpr=function(e){for(var t=e.defn.select(),r=0;r<t.length;){var i=t[r];if(r++,s.isHierarchyLevel(i.expr)&&n(i.expr,this.change))for(;r<t.length&&s.isHierarchyLevel(t[r].expr)&&s.equals(i.expr.arg,t[r].expr.arg);)e.removeExpr(t[r].expr,!1),r++}},e})()})(r=t.schemaRewriterUtils||(t.schemaRewriterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=[];if(!e||!e.visualContainers)return r;for(var i=0,n=e.visualContainers;i<n.length;i++){var o=n[i];t.addScriptVisualInfo(o,r)}return r}function r(e,r){var i={totalVisualsCount:0,info:[]};if(!e||!e.sections)return i;for(var n=0,o=e.sections;n<o.length;n++){var a=o[n];if(a.visualContainers){var s=t(a,r);i.info=i.info.concat(s),i.totalVisualsCount+=a.visualContainers.length}}return i}function i(e,r,i,n,o){var a=[];switch(e){case 0:if(!n)return a;o.addScriptVisualInfo(n,a);break;case 1:a=t(i,o);break;case 2:if(!r)return a;for(var s=0,l=r.sections;s<l.length;s++){var u=l[s],c=t(u,o);a=a.concat(c)}break;default:return a}return a}function n(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n&&n.config&&n.config.singleVisual){var o=n.config.singleVisual.visualType;if(o&&t.isScriptVisual(o))return!0}}return!1}function o(e,t,r,i,n,o){var a=e.control(),s=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_OkButton"),l=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_CancelButton"),u=[new InJs.ModalDialogAction(s,function(){a.hideDialog(),n()}),new InJs.ModalDialogAction(l,function(){a.hideDialog(),o()})],c=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_Title"),p=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_WarningMessage"),d="<div><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart1")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821887" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink1")+"</a><span> "+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart2")+"</span><br/><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart3")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821886" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink2")+"</a></div>";i.message=p;var f={dialogName:c,isDismissable:!1,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",dialogActions:u,notificationType:jsCommon.ModalDialogNotificationType.SecurityWarning,notificationText:p,htmlMessageText:d,focusOnFirstButton:!1,noActiveButtons:!0,flipContentAndNotificationOrder:!0};r.showLegacyWebModalDialog(f)}function a(e){switch(e){case"scriptVisual":return 0;case"pythonVisual":return 1;default:return null}}function s(e){switch(e){case 0:return"scriptVisual";case 1:return"pythonVisual";default:return null}}e.defaultScript="##############################",e.getScriptVisualIdsInSection=t,e.getVisualStatsInExploration=r,e.getScriptVisualIds=i,e.visualContainerHasScriptVisuals=n,e.confirmRefreshForRDataSource=o,e.getScriptVisualType=a,e.getScriptVisualTypeName=s})(t=e.ScriptVisualsUtil||(e.ScriptVisualsUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,r){void 0===r&&(r=!0),this.containerSelector=e,this.itemsSelector=t,this.includeDescendants=r}return Object.defineProperty(e.prototype,"position",{get:function(){},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.scrollItemIntoView=function(e,t,r){var i=this.getContainer(),n=this.getRange(i),o=this.getItems(),a=o[e];if(a){var s=0===e,l=e===o.length-1,u=this.getRange($(a),!0);if(s?t=0:l?t=r||0:null!==t&&void 0!==t||(t=this.getDefaultOverscroll()),n&&u){var c=this.calculatePositionDelta(n,u,t);this.position=this.position+c}}},e.prototype.getPageDownItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n<r.length-1;n++){if(i+=this.getRange(r.eq(n)).size,i>t.size)return n}return r.length-1}return-1},e.prototype.getPageUpItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n>0;n--){if(i+=this.getRange(r.eq(n)).size,i>t.size)return n}return 0}return-1},e.prototype.retainPosition=function(e){var t=this.position;try{e()}finally{this.position=t}},e.prototype.handleKeyDown=function(e,t,r){var i=!0,n=e,o=this.getItems(),a=o.length-1;switch(t.keyCode){case $.ui.keyCode.PAGE_UP:var s=this.getPageUpItemIndex(e);n=Math.max(s,0);break;case $.ui.keyCode.PAGE_DOWN:var l=this.getPageDownItemIndex(e);n=Math.min(l,a);break;case $.ui.keyCode.END:n=a;break;case $.ui.keyCode.HOME:n=0;break;default:n=this.getNewIndexOnKeyDown(e,a,t),i=void 0!==n}return void 0!==n&&n!==e&&(r(n),this.scrollItemIntoView(n)),i},e.prototype.onScroll=function(e){var t=this;this.getContainer().scroll((function(){e(t.position/t.max)}))},e.prototype.getNewIndexOnKeyDown=function(e,t,r){},e.prototype.getRange=function(e,t){void 0===t&&(t=!1)},e.prototype.getDefaultOverscroll=function(){},e.prototype.getContainer=function(){return $(this.containerSelector)},e.prototype.getItems=function(){return this.retrieveItems()},e.prototype.retrieveItems=function(){return this.includeDescendants?this.getContainer().find(this.itemsSelector):this.getContainer().children(this.itemsSelector)},e.prototype.calculatePositionDelta=function(e,t,r){return t.min<e.min?-(e.min-t.min+r):t.max>e.max?t.max-e.max+r:0},e})();e.BaseScrollHelper=t;var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this.getContainer().scrollTop()},set:function(e){var t=this.getContainer();t.scrollTop()!==e&&t.scrollTop(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollHeight:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){switch(r.keyCode){case $.ui.keyCode.UP:return r.scrollHandled=!0,Math.min(Math.max(e-1,0),t);case $.ui.keyCode.DOWN:return Math.min(e+1,t)}},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerHeight():e.innerHeight();return{min:r.top,max:r.top+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 0},t})(t);e.VerticalScrollHelper=r;var i=(function(e){function t(t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0);var o=e.call(this,t,r,n)||this;return o.isRtl=i,o}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this.getContainer().scrollLeft()},set:function(e){var t=this.getContainer();t.scrollLeft()!==e&&t.scrollLeft(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollWidth:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){var i=0;switch(r.keyCode){case $.ui.keyCode.LEFT:i=-1;break;case $.ui.keyCode.RIGHT:i=1}if(this.isRtl&&(i=-i),0!==i)return e+=i,e<0&&(e=0),e>t&&(e=t),e},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerWidth():e.innerWidth();return{min:r.left,max:r.left+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 16},t.prototype.calculatePositionDelta=function(t,r,i){var n=e.prototype.calculatePositionDelta.call(this,t,r,i);return this.isRtl?-n:n},t})(t);e.HorizontalScrollHelper=i;var n=(function(){function e(e,t,r){var i=this;this.lastScrollLeft=0,this.lastScrollTop=0,this.scrollPanel=e,this.syncedPanel=t,this.syncOptions=r,this.onScroll=this.onScroll.bind(this),jsCommon.Zone.runOutsideAngular((function(){i.scrollPanel.addEventListener("scroll",i.onScroll)}))}return e.prototype.dispose=function(){this.scrollPanel.removeEventListener("scroll",this.onScroll)},e.prototype.onScroll=function(){var e=this;this.syncOptions.syncDelay?(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){e.syncScrollPositions()}),this.syncOptions.syncDelay)):this.syncScrollPositions()},e.prototype.syncScrollPositions=function(){if(this.syncOptions.syncX){var e=this.scrollPanel.scrollLeft;e!==this.lastScrollLeft&&(this.syncedPanel.scrollLeft=e,this.lastScrollLeft=e)}if(this.syncOptions.syncY){var t=this.scrollPanel.scrollTop;t!==this.lastScrollTop&&(this.syncedPanel.scrollTop=t,this.lastScrollTop=t)}},e})();e.ScrollSyncHelper=n})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){if(e.activeSection){var t={visualContainers:e.visualContainers,visualContainerGroups:e.visualContainerGroups};return e.filterScope&&(t.filterScope=e.filterScope),e.pendingHighlights&&(t.pendingHighlights=e.pendingHighlights),e.visibility&&(t.visibility=e.visibility),t}return e}e.excludeActiveSectionImpact=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(t,r,i,n){void 0===n&&(n=!0),this._hasFocus=!1,this.selection=e.createTreeSelectionManager(t),this.scrollHelper=new e.VerticalScrollHelper(r,i),this.getVisibleNodes=t,this.allowMultiSelect=n}return t.prototype.hasFocus=function(){return this._hasFocus},t.prototype.onNodeClick=function(e,t){if(t.ctrlKey)this.selection.toggle(e);else if(t.shiftKey&&this.selection.lastSelected){var r=this.selection.lastSelected;this.selection.clear(),this.selection.selectRange(this.getNodesRange(r,e))}else{var i=500;this.lastNodeClickTime&&t.timeStamp-this.lastNodeClickTime>i&&_.isEqual(this.selection.getSelectedItems(),[e])?this.selection.toggle(e):(this.focus(e),this.selection.clear(),this.selection.select(e)),this.lastNodeClickTime=t.timeStamp}t.stopPropagation()},t.prototype.onBackgroundClick=function(e){this.selection.clear(),e.stopPropagation()},t.prototype.onFocus=function(){this.focus(this.getFocusedNode()||this.getVisibleNodes()[0]),this._hasFocus=!0},t.prototype.onBlur=function(){this.getVisibleNodes().map((function(e){return e.isFocused=!1})),this._hasFocus=!1},t.prototype.onKeyDown=function(e){var t=this,r=this.getVisibleNodes(),i=!1,n=this.selection.lastSelected;e.ctrlKey&&65===e.keyCode&&this.allowMultiSelect&&(this.selection.selectAll(),i=!0),e.keyCode===$.ui.keyCode.ESCAPE&&(this.selection.clear(),i=!0),e.keyCode===$.ui.keyCode.LEFT&&n&&(n.isExpanded?n.isExpanded=!1:n.parent&&this.selectAndScrollTo([n.parent]),i=!0),e.keyCode===$.ui.keyCode.RIGHT&&n?(n.children&&(n.isExpanded?n.children.length>0&&this.selectAndScrollTo([n.children[0]]):n.isExpanded=!0),i=!0):i=this.scrollHelper.handleKeyDown(r.indexOf(this.selection.lastSelected),e,(function(i){t.allowMultiSelect&&(e.ctrlKey||e.shiftKey)||t.selection.clear(),t.focus(r[i]),t.selection.select(r[i])})),i&&(e.stopPropagation(),e.preventDefault())},t.prototype.toggleExpandCollapse=function(e,t){e.isExpanded=!e.isExpanded,t&&t.stopPropagation()},t.prototype.selectAndScrollTo=function(e){var t=this;this.selection.clear(),this.selection.selectRange(e),requestAnimationFrame((function(){var r=t.getVisibleNodes(),i=r.indexOf(e[0]);t.scrollHelper.scrollItemIntoView(i,30)}))},t.prototype.getNodesRange=function(e,t){var r,i=this.getVisibleNodes(),n=i.indexOf(e),o=i.indexOf(t),a=Math.min(n,o),s=Math.max(n,o);if(a>-1){r=[];for(var l=a;l<=s;l++)r.push(i[l])}return r},t.prototype.focus=function(e){e&&(this.getVisibleNodes().map((function(e){return e.isFocused=!1})),e.isFocused=!0)},t.prototype.getFocusedNode=function(){var e=this.getVisibleNodes(),t=_.find(e,(function(e){return e.isSelected}));return null!=t?t:_.find(e,(function(e){return e.isFocused}))},t})();e.TreeHelper=t})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createTreeSelectionManager=t;var r=(function(){function e(e){this.selectedItems=[],this.getItems=e}return Object.defineProperty(e.prototype,"lastSelected",{get:function(){return _.last(this.selectedItems)},enumerable:!0,configurable:!0}),e.prototype.getSelectedItems=function(){return this.selectedItems.slice()},e.prototype.select=function(e){e.isSelected||(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.selectRange=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.select(i)}},e.prototype.selectAll=function(){this.selectRange(this.getItems())},e.prototype.toggle=function(e){e.isSelected?(e.isSelected=!1,this.selectedItems.splice(this.selectedItems.indexOf(e),1)):(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.clear=function(){for(var e=0,t=this.selectedItems;e<t.length;e++){t[e].isSelected=!1}this.selectedItems.splice(0)},e})()})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=[2,3,1,0];return e&&t.push(4),{automaticallyImport:!1,sandboxProperties:t,visualTypeOptions:r()}}function r(){return{watermarkKey:"visioVisual"}}e.createVisioVisualRegisterOptions=t})(t=e.VisioVisualHelper||(e.VisioVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createMapboxVisualRegisterOptions=t})(t=e.MapboxVisualHelper||(e.MapboxVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createVPMenuVisualRegisterOptions=t})(t=e.PowerOnVPMenuVisualHelper||(e.PowerOnVPMenuVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createDEMatrixV2VisualRegisterOptions=t})(t=e.PowerOnDEMatrixV2VisualHelper||(e.PowerOnDEMatrixV2VisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createDEMatrixV3VisualRegisterOptions=t})(t=e.PowerOnDEMatrixV3VisualHelper||(e.PowerOnDEMatrixV3VisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0,1]}}e.createDetailReportVisualRegisterOptions=t})(t=e.PowerOnDetailReportVisualHelper||(e.PowerOnDetailReportVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createSmartFilterVisualRegisterOptions=t})(t=e.PowerOnSmartFilterVisualHelper||(e.PowerOnSmartFilterVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0,1]}}e.createTableEditorVisualRegisterOptions=t})(t=e.PowerOnTableEditorVisualHelper||(e.PowerOnTableEditorVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0,1]}}e.createTableEditorV2VisualRegisterOptions=t})(t=e.PowerOnTableEditorV2VisualHelper||(e.PowerOnTableEditorV2VisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createForecasterVisualRegisterOptions=t})(t=e.PowerOnForecasterVisualHelper||(e.PowerOnForecasterVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return _.isEmpty(e)?e:S.rewriteArray(e,(function(e){return P.isScopeIdentity(e)?i(e,t):P.isScopeWildcard(e)?n(e,t):P.isRoleWildcard(e)||P.isWildcard(e)?e:P.isScopeTotal(e)?o(e,t):e}))}function i(e,t){var r=h(e.expr,t);return r!==e.expr?b(r):e}function n(e,t){var r=S.rewriteArray(e.exprs,(function(e){return h(e,t)}));return r!==e.exprs?F.fromExprs(r):e}function o(e,t){var r=S.rewriteArray(e.exprs,(function(e){return h(e,t)}));return r!==e.exprs?V.fromExprs(r):e}function a(e,t){if(e){var r=e.properties.qna;if(r){var i=r.suggestedUtterances;if(i)for(var n=function(e){var r=e.spans;r&&r.forEach((function(r,i){e.spans[i]=s(r,t)}))},o=0,a=i;o<a.length;o++){var l=a[o];n(l)}}}}function s(e,t){return _.reduce(t,(function(e,t){return t.rewriteSpan(e)}),e)}function l(e,t){f(e,t)}function u(e,t){f(e,t)}function c(t,r,i){var n=w.findFilterOutput(r);if(n){var o=e.data.DataViewObjectDefinitions.getPropertyContainer(t,n,null);if(o){var a=n.propertyName,s=o[a];if(s){for(var l=0,u=i;l<u.length;l++){s=u[l].rewriteFilter(s)}o[a]=s}}}}function p(t,r,i){function n(e,t){for(var r=0,i=t;r<i.length;r++){e=i[r].rewriteExpr(e)}return e}t&&r&&(_.isEmpty(i)||E.visitPropertyDefinitions(t,r,(function(t,r,o,a,s){var l=s&&s.properties[r],u=t[r];if(u instanceof T)for(var c=0,p=i;c<p.length;c++){var f=p[c];u=f.rewriteExpr(u)}else{var v=l.type;if(v.fill&&v.fill.solid&&v.fill.solid.color){if(!e.StructuralObjectDefinition.isFillDefinition(u))return;
var m=u.solid.color;if(!m)return;var h=m;m=n(m,i),m!==h&&(u={solid:{color:m}})}else if(v.paragraphs){if(!e.StructuralObjectDefinition.isParagraphsDefinition(u))return;if(!d(u,i))return;u=_.map(u,(function(e){return{horizontalTextAlignment:e.horizontalTextAlignment,textRuns:_.map(e.textRuns,(function(e){var t=e.value;if(t instanceof T)for(var r=0,n=i;r<n.length;r++){var o=n[r];t=o.rewriteExpr(t)}return{textStyle:e.textStyle,url:e.url,value:t}}))}}))}else if(v.icon){if(!e.StructuralObjectDefinition.isIconDefinition(u))return;var g={kind:"Icon",value:u.value?n(u.value,i):u.value,layout:u.layout?n(u.layout,i):u.layout,verticalAlignment:u.verticalAlignment?n(u.verticalAlignment,i):u.verticalAlignment};u.value===g.value&&u.layout===g.layout&&u.layout===g.layout||(u=g)}}t[r]=u})))}function d(e,t){for(var r=0,i=e;r<i.length;r++)for(var n=i[r],o=n.textRuns,a=0,s=o;a<s.length;a++){var l=s[a],u=l.value;if(u instanceof T)for(var c=u,p=0,d=t;p<d.length;p++){var f=d[p];if(c=f.rewriteExpr(c),c!==u)return!0}}return!1}function f(e,t){var r=e.expression,i=e.filter,n=e.cachedValueItems;r&&(e.expression=h(r,t)),i&&(e.filter=m(i,t)),n&&v(n,t)}function v(e,t){for(var r=0,n=e;r<n.length;r++){var o=n[r],a=i(o.identity,t);a!==o.identity&&(o.identity=a)}}function m(e,t){return _.reduce(t,(function(e,t){return t.rewriteFilter(e)}),e)}function h(e,t){return _.reduce(t,(function(e,t){return t.rewriteExpr(e)}),e)}function g(e,t){var r=e.fieldExpr;e.fieldExpr=h(r,t)}function y(e,t){if(!_.isEmpty(e.parameters))for(var r=0,i=e.parameters;r<i.length;r++){var n=i[r];n.fieldExpr&&(n.fieldExpr=h(n.fieldExpr,t))}}function C(e,t){for(var r=0,n=e;r<n.length;r++){var o=n[r];o.identities=S.rewriteArray(o.identities,(function(e){return i(e,t)}))}}function x(e,t){e.expressions=S.rewriteArray(e.expressions,(function(e){return h(e,t)})),e.cachedValueItems&&C(e.cachedValueItems,t)}var S=jsCommon.ArrayExtensions,b=e.data.createDataViewScopeIdentity,E=e.data.DataViewObjectDefinitions,w=e.data.DataViewObjectDescriptors,V=e.data.DataViewScopeTotal,F=e.data.DataViewScopeWildcard,P=e.data.Selector,T=e.data.SQExpr;t.rewriteDataRepetitionSelectors=r,t.rewriteVisualLink=a,t.rewriteFilterContainer=l,t.rewriteFilterContainerState=u,t.rewriteFilterOutput=c,t.rewriteDataBoundPropertyDefinitions=p,t.rewriteDisplayNameIdentityPairs=v,t.rewriteSemanticFilter=m,t.rewriteExpr=h,t.rewriteLinkField=g,t.rewritePod=y,t.rewriteFilterExpressionMetadata=x})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(r,i,o,a,s,l,u){var c=[],p=i.where(c,new e.data.SQFrom),d={expr:[],visualType:s.plugin.name,schema:l,query:new t.contracts.VisualQuery(p,s.build(a),[])};return n(r,i,o,u.create(d).singleVisual)}function n(e,r,i,n){return{name:e,config:{singleVisual:n},filters:t.FilterUtils.deriveFromSQFilters(r.from(),r.where(),i),layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:null}])}}r.create=i,r.createWithSingleVisualConfig=n})(r=t.VisualContainerFactory||(t.VisualContainerFactory={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=jsCommon.CssConstants,o=e.data.DataViewObjectDefinitions,a=e.data.services.DataViewObjectSerializer,s=e.data.DataViewTransform,l=e.visuals.Units.FontSize,u=e.common.utils.IdUtility,c=e.data.InteractiveQueryCachingSettings,p=jsCommon.PixelConverter,d=e.data.SQExpr,f=e.data.SQExprUtils,v=t.contracts.VisualContainer;!(function(r){function i(e){if(e)return t.contracts.isVisualContainerGroup(e)?t.constants.GroupComponentType:e.config&&e.config.singleVisual?e.config.singleVisual.visualType:void 0}function m(e){return e&&e.config&&e.config.singleVisual?e.config.singleVisual.query:null}function h(e){return e&&e.config&&e.config.singleVisual}function g(e){var t=e.config;if(t){var r=t.singleVisual;if(r&&r.query){return r.query.defn.select()}}}function y(e,t){if(e&&t){var r=t.getPlugin(e);if(r)return r.capabilities}}function C(e,t){return y(e&&e.config&&e.config.singleVisual?e.config.singleVisual.visualType:null,t)}function x(e,t){return y(r.getVisualType(e),t)}function S(e,t){var r=x(e,t);if(r&&!_.isEmpty(r.dataRoles))return r.dataRoles}function b(e,t,r){if(e)return"UserAction_ChangeModel"===t||"UserAction_Refresh"===t||"AutoPageRefresh"===r?c.BypassCache:c.Default}function E(e){if(e.config&&e.config.singleVisual){var t=e.config.singleVisual;t&&t.query&&t.query.hasShowAll()&&(t.queryOptions=t.queryOptions||{},t.queryOptions.keepProjectionOrder=!0)}}function w(e){if(e){var t=e.capabilities;if(t&&!_.isEmpty(t.dataRoles))return t.dataRoles}}function V(t,r,i){var n=x(t,r);if(n){var o=m(t);if(o){return e.visualCapabilitiesHelperModuleFactory().create(n,i).getNumberRangesForRoles(o)}}}function F(e,t){var i=r.getVisualType(e);return t&&t.isScriptVisual(i)}function P(e){return e.config&&e.config.singleVisual&&e.config.singleVisual.objects}function T(e){return e.config&&e.config.singleVisual&&e.config.singleVisual.vcObjects}function N(e,t,r){var i=e.config.singleVisual.query.projections[t],n=i.all(),o=n[r];return o.queryRef}function D(t,r,i,n,o,a,s){if(i){var l=i.defn.select(),u=i.projections,c=[],p=[],v=ue(i),m=e.DataViewAnalysis.chooseDataViewMappings(i.projections,o.dataViewMappings,v,a),h=m.supportedMappings;if(h){for(var g=0,y=h;g<y.length;g++){var C=y[g],x=h.length>1?I(C):null,S=[];for(var b in u)if(null==x||_.includes(x,b))for(var E=u[b],w=0,V=E.all();w<V.length;w++){var F=V[w],P=Ee.indexWithName(l,F.queryRef),T=l[P];if(!d.isTransformOutputRoleRef(T.expr)){var N=T.expr.getMetadata(r,f.buildExprEvaluationContext(i.defn.from())),D={Restatement:t.getDisplayName(T.expr,r,o,T.name,n),Name:F.queryRef,Type:j(N.type)},R=f.getKpiMetadata(T.expr,r);R&&(D.kpi=R);var M=F.format||N.format;M&&(D.Format=M);var A=O(N.type);A&&(D.DataCategory=A),c[P]=D,S.push({Name:b,Projection:P,isActive:_.includes(E.activeProjectionRefs,F.queryRef)})}}p.push({DataRoles:S})}return{queryMetadata:{Select:c,Filters:s},visualElements:p}}}}function R(e,t){var r=e;if(r.role)return void t.push(r.role);var i=e;if(i.bind)return void(i.bind.to&&t.push(i.bind.to));var n=e;if(n.for)return void(n.for.in&&t.push(n.for.in));var o=e;if(o.group){if(o.group.by&&t.push(o.group.by),o.group.select)for(var a=0,s=o.group.select;a<s.length;a++){var l=s[a];R(l,t)}}else{var u=e;if(u.composite)for(var c=0,p=u.composite;c<p.length;c++){var d=p[c];R(d,t)}else{var f=e;if(f.select)for(var v=0,m=f.select;v<m.length;v++){var l=m[v];R(l,t)}}}}function I(e){var t=[];return e&&(e.categorical&&(e.categorical.categories&&R(e.categorical.categories,t),e.categorical.values&&R(e.categorical.values,t)),e.table&&e.table.rows&&R(e.table.rows,t),e.single&&R(e.single,t),e.tree&&(e.tree.nodes&&R(e.tree.nodes,t),e.tree.values&&R(e.tree.values,t)),e.matrix&&(e.matrix.columns&&R(e.matrix.columns,t),e.matrix.rows&&R(e.matrix.rows,t),e.matrix.values&&R(e.matrix.values,t))),t=_.uniq(t)}function j(e){switch(e.extendedType){case 66048:return 67;case 131584:return 35}switch(e.primitiveType){case 1:return 2048;case 2:case 3:return 1;case 4:return 3;case 5:return 4096;case 6:return 20;case 7:return 4;case 9:return 8}}function O(t){return e.data.conceptualDataCategoryFromString(t.categoryString)}function M(e,t){if(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.defn){var r=e.config.singleVisual.query.projections,i=e.config.singleVisual.query.defn.select();if(r&&i.length>0)for(var n in r)for(var o=r[n],a=0,s=o.all();a<s.length;a++){var l=s[a],u=jsCommon.ArrayExtensions.findItemWithName(i,l.queryRef);if(u){var c=u.expr,p=c.getMetadata(t);if(p&&0===p.kind&&null==p.aggregate)return!0}}return!1}}function A(e){return function(t){return e===t}}function k(e){return function(t){return e!==t}}function z(e,t,r,i){return function(n){return e===n||3!==(r&&r.relationshipFilterAction(t,e,n,i))}}function B(t,r){t.publishToChannel(e.explore.services.events.dataSelectionChanged,{affectContainer:function(e){return e===r}})}function U(t,i,n,o,s,l,u,c,p){if(l){var d,f=t.capabilities(l.visualType);if(f){var v=r.describeForPinning(i,s,l.query,l.columnProperties,f,u,c);if(v){var m=a.serializeObjects(l.objects,f.objects);d=o.transforms&&f&&f.objects?e.data.services.DataViewTransformActionsSerializer.serializeDataViewTransformActions(o.transforms,f.objects):{objects:m},d.objects=d.objects||m,d.visualElements=v.visualElements,d.queryMetadata=v.queryMetadata}}return{queryObject:o.options.query.command,dataObject:n,transformsObject:d,dataUpdatedTime:p}}}function L(e){var r={};return t.contracts.traverseVisualContainerGroups(e,(function(e){r[e.name]=!0})),q(r)}function q(e){return u.generateUniqueId(e)}function G(e){var r=[];return t.contracts.traverseVisualContainerGroups(e,(function(e){t.contracts.isVisualContainerGroup(e)&&r.push(e)})),r}function H(e,t,r){void 0===t&&(t=0);for(var i=_.cloneDeep(e),n=r;n;){if(!n.layouts.withId(t))return i;var o=n.layouts.withId(t).position;i.x+=o.x,i.y+=o.y,n=n.parentGroup}return i}function Q(e,t,r){void 0===r&&(r=0);for(var i=_.cloneDeep(e),n=t.parentGroup;n;){var o=n.layouts.withId(r).position;i.x-=o.x,i.y-=o.y,n=n.parentGroup}return i}function W(t,r,i){t.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(e){return e!==r},sourceLabelKey:i})}function X(t,r,i){_.isEmpty(r)||t.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(e){return _.includes(r,e)},sourceLabelKey:i})}function K(t){return _.some(t,(function(t){return t.dsr&&t.dsr.vsName===e.common.constants.onPremiseVSName}))}function J(e){return e&&null!=e.size?p.fromPoint(e.size.pt):p.toString(r.DefaultTitleFontSizeInPixel)}function Y(t){var i=J(t),n={fontFamily:t&&t.family||r.DefaultTitleFontFamily,fontSize:i};return e.TextMeasurementService.estimateSvgTextHeight(n)}function $(e,r,i,n,a,l,u){var c=i.config.singleVisual.visualType,p=i.config.singleVisual.vcObjects,f=o.getValue(p,{objectName:"stylePreset",propertyName:"name"},void 0),v=r.getVisualObjects(e,c,f&&d.isConstant(f)&&f.value,t.contracts.VisualContainer.CommonObjectDescriptors);v&&(p=o.clone(p||{}),n&&n.dataBoundPropertiesUseThemeDefaults?o.extend(p,v,!0):o.extend(p,v));var m=r.getVisualStyle(e),h=s.evaluateMetadataOnceDataViewObjectDefinitions(p,t.contracts.VisualContainer.CommonObjectDescriptors,m,n,a,l,u),g=o.getObjectDefinition(p,"visualLink",void 0);return g&&(h.dataViewObjects.visualLink.qna=g.properties.qna),h}function Z(e,t){t.toggleClass("showHover",e)}function ee(t,r,i){var n=t?e.common.events.canvasItemContainerShowHover:e.common.events.canvasItemContainerHideHover;i.publishToChannel(n,{containerName:r})}function te(e,t,r,i,o,a){var s={},l=null!=t;return s[n.transformProperty]=l?"scale("+t+")":"",s[n.widthProperty]=e.width,s[n.heightProperty]=e.height,s[n.borderProperty]=i||"",s[n.paddingProperty]=a||"",s[n.borderRadiusProperty]=o||"",s[n.backgroundColorProperty]=r||"",s}function re(t){if(t&&t.show){var r=e.visuals.visualBackgroundHelper.getDefaultValues();return(t.transparency||0===t.transparency)&&(r.transparency=t.transparency),t.color&&t.color.solid.color&&(r.color=t.color),e.common.utils.ColorUtility.applyTransparency(r.color.solid.color,(100-r.transparency)/100)}}function ie(e,t){return{show:e?e.show:t.show,color:e&&e.color&&e.color.solid&&e.color.solid.color?e.color:t.color,radius:e&&e.radius||t.radius}}function ne(e){return null!=e&&null!=e.metadata&&null!=e.metadata.segment}function oe(e){if(e&&e.defn){var t=e.defn.groupBy();return!_.isEmpty(t)}return!1}function ae(e){return oe(r.getVisualQuery(e))}function se(e,t,i){var n=r.getDataRolesForVisual(e,t),o=m(e);if(o&&!_.isEmpty(n)){var a=n[0].name,s=o.tryGetExprs(a);return!_.isEmpty(s)&&!_.some(s,(function(e){var t=e.getMetadata(i);if(t)return!t.type.text}))}}function le(e,t,r){var i=he(e,r);if(_.isEmpty(i))return!1;for(var n=0,o=i;n<o.length;n++){var a=o[n];if(1===f.getAggregateBehavior(a,t))return!0}return!1}function ue(t){for(var r={},i=t.defn.select(),n=0,o=i;n<o.length;n++){var a=o[n],s=void 0;s=f.isMeasure(a.expr)?e.VisualDataRoleKind.Measure:e.VisualDataRoleKind.Grouping,r[a.name]=s}return r}function ce(e){for(var t=0,r=e.sections;t<r.length;t++){pe(r[t])}}function pe(e){for(var t=0,r=e.visualContainers;t<r.length;t++){var i=r[t];delete i.cachedData,i.disableCacheOnServerForInitialLoad=!0}}function de(e){for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],n=0,o=i.visualContainers;n<o.length;n++){var a=o[n];a.disableCacheOnServerForInitialLoad=!0}}function fe(e){function r(e,t){var r=t.config.singleVisual.visualType;e[r]||(e[r]=0),e[r]++}function i(){var t=e&&e.visualContainers||[],i={};t=_.reject(t,(function(e){return v.isHidden(e.config.singleVisual)}));for(var n=0,o=t;n<o.length;n++){r(i,o[n])}return i}function n(){var n=e.visualContainerGroups;if(_.isEmpty(n))return i();var o={},a={__hidden:o};return t.contracts.traverseVisualContainerGroups(e.visualContainerGroups,(function(e,i){t.contracts.isVisualContainer(e)&&r(i?o:a,e)})),a}try{return n()}catch(e){return jsCommon.Trace.error("Error getting visuals from groups "+(e&&e.message)+": "+(e&&e.stack)),i()}}function ve(e,i,n,o,a,s){if(void 0===s&&(s=!1),t.FilterUtils.supportsVisualFilters(e,i,n)){var l=function(e){var r=0;return{name:void 0,expression:e,expanded:!1,howCreated:r,type:t.FilterUtils.getDefaultFilterType(e,o,r),isHiddenInViewMode:s}},u=t.FilterUtils.supportsMeasureFilters(e,i),c=r.getSelectExprs(e);if(u||(c=_.filter(c,(function(e){return!f.isMeasure(e.expr)}))),c)return _.chain(c).map((function(e){return e.expr})).filter((function(e){return f.isExprValidForFiltering(e)&&_.isEmpty(e.validate(o,a))})).map((function(e){return l(e)})).value()}}function me(e,t,r,i){var n=r.getDrillCrossFiltersToApply(e,t,i),o=function(e){return{name:void 0,type:e.type,filter:e.filter,expression:e.expression,expanded:!1,howCreated:6,precedence:e.precedence}};return _.map(n,(function(e){return o(e)}))}function he(t,r){var i=m(t);if(i){var n=x(t,r);if(n&&n.filterMappings&&n.filterMappings.measureFilter&&n.filterMappings.measureFilter.targetRoles){for(var o=n.filterMappings.measureFilter.targetRoles,a=_.chain(n.dataRoles).filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping})).map((function(e){return e.name})).difference(o).value(),s=[],l=0,u=a;l<u.length;l++){var c=u[l];i.projections[c]&&s.push.apply(s,i.projections[c].all())}var p=g(t);return _.isEmpty(s)?void 0:_.chain(p).filter((function(e){return _.some(s,(function(t){return t.queryRef===e.name}))})).map((function(e){return e.expr})).value()}}}function ge(e,t){for(var r=0,i=0,n=e.sections;i<n.length;i++)for(var o=n[i],a=0,s=o.visualContainers;a<s.length;a++){var l=s[a];l.config.singleVisual.visualType===t.name&&++r}return r}function ye(e){var t=e.resourcePackages;if(!t)return!1;for(var r=0,i=e.sections;r<i.length;r++){var n=i[r];if(n.visualContainers)for(var o=n.visualContainers,a=0,s=t;a<s.length;a++)for(var l=s[a],u=0,c=o;u<c.length;u++){var p=c[u];if(p.config&&p.config.singleVisual&&p.config.singleVisual.visualType){var d=p.config.singleVisual.visualType;if(l.name===d)return!0}}}return!1}function Ce(e){var t=e.objects;if(t&&t.outspacePane){var r=o.getValue(t,{objectName:"outspacePane",propertyName:"expanded"},null);return r&&r.value}}function xe(e){var t=e.objects;if(t&&t.outspacePane){var r=o.getValue(t,{objectName:"outspacePane",propertyName:"visible"},null);return r&&r.value}}function Se(e,t){var r=e.settings&&e.settings.useNewFilterPaneExperience;if(r){var i={usingImprovedFilterExperience:r,viewMode:0===t};if(!r)return i;var n=Ce(e);_.isUndefined(n)||(i.isOutspacePaneExpanded=n);var o=xe(e);return _.isUndefined(o)||(i.isOutspacePaneVisible=o),i}}function be(e,t){return e.id&&!t}var Ee=jsCommon.ArrayExtensions;r.DefaultTitleFontSizeInPixel=12,r.DefaultTitleFontFamily="'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif",r.DefaultTitleFontColor="#C8C8C8",r.DefaultTitleTextClass="largeTitle",r.DefaultTitleThemeColor="foreground",r.DefaultTitleFontSizeInPoints=jsCommon.PixelConverter.toPoint(r.DefaultTitleFontSizeInPixel),r.DefaultTitleFontProperties={size:l.createFromPt(r.DefaultTitleFontSizeInPoints),family:r.DefaultTitleFontFamily,color:r.DefaultTitleFontColor},r.getVisualType=i,r.getVisualQuery=m,r.getSingleVisualConfig=h,r.getSelectExprs=g,r.getFilterCapabilities=C,r.getVisualCapabilities=x,r.getDataRolesForVisual=S,r.getVisualQueryCachingSettings=b,r.setQueryKeepProjectionOrder=E,r.getDataRolesForVisualPlugin=w,r.getNumberRangesForRoles=V,r.isScriptVisual=F,r.getObjectDefinitions=P,r.getContainerObjectDefinitions=T,r.getQueryName=N,r.describeForPinning=D,r.getRolesForDataViewMapping=I,r.toSemanticType=j,r.toConceptualDataCategory=O,r.hasGrouping=M,r.contractEqualityComparator=A,r.contractUnEqualityComparator=k,r.filterAffects=z,r.clearDataSelection=B,r.createCacheEntry=U,r.uniqueName=L,r.nextUniqueName=q,r.getVisualContainerGroups=G,r.getAbsoluteVisualContainerPosition=H,r.getGroupRelativeVisualContainerPosition=Q,r.notifyVisualContainersExceptSource=W,r.notifyVisualContainers=X,r.hasOnPremDataSource=K,r.getTitleFontSize=J,r.getTitleHeight=Y,r.evaluateObjectDefinitions=$,r.setHoverClass=Z,r.notifyContainerHoverEvent=ee,r.getVisualStyleAttributes=te,r.getVisualBackgroundColor=re,r.getVisualBorder=ie,r.isSegment=ne,r.hasGroupByItems=oe,r.hasGroupByItemsInQuery=ae,r.containSearchableField=se,r.hasFilterMappingWithNonAggregatableColumns=le,r.createRoleKindByQueryRef=ue,r.clearExplorationQueryCaches=ce,r.clearSectionQueryCaches=pe,r.markInitialLoadQueriesDirty=de,r.getVisualTypesAndCountsFromSection=fe,r.getAutoVisualFilterContainers=ve,r.getAutoCrossDrillVisualFilterContainers=me,r.getVisualContainerCount=ge,r.containsCustomVisuals=ye,r.getImprovedFilterExperienceTelemetry=Se,r.shouldUseQueryCache=be})(i=r.VisualContainerUtils||(r.VisualContainerUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=e.data.SQExpr,o=e.data.SQExprConverter,a=jsCommon.StringExtensions,s=e.explore.util.VisualContainerUtils;!(function(r){function i(e,r,i){if(!r||!r.column||!r.column.groupingMetadata)return t.services.GroupMode.None;if(i){var n=i.getGroupingDesignState(e,r.name);if(!n)return t.services.GroupMode.Basic;if(n.partitionTable)return t.services.GroupMode.Clustering;if(n.binItem)return t.services.GroupMode.Binning}return t.services.GroupMode.Basic}function l(e,r,n){var o=i(e,r,n);return o===t.services.GroupMode.Basic||o===t.services.GroupMode.Binning}function u(e,r,n){return i(e,r,n)===t.services.GroupMode.Clustering}function c(e,t,r){if(!t||!t.column||!t.column.groupingMetadata)return!1;var i=r.getGroupingDesignState(e,t.name);return!(!i||!i.groupItems&&!i.partitionTable)}function p(e,t){if(t&&d(e,t)&&(n.isColumn(t)||n.isGroupRef(t))){return f(t.getConceptualProperty(e))}return!1}function d(e,t){return b(e,t).capabilities.canEdit}function f(e){return e&&!!(e.type.dateTime||e.type.integer||e.type.numeric||e.type.text)}function v(e,t){return a.constructNameFromList(e,t.get("GroupDefinition_And"),j)}function m(e){if(e&&e.column&&e.column.keys){var t=e.column.keys;return 1===t.length&&t[0].name!==e.name||t.length>1}return!1}function h(e,t){var r=t&&t.defn.select();if(r&&r.length>0&&e)for(var i=0,n=e;i<n.length;i++){var o=n[i];if(!o||!o.dataMap)return;var a=Object.keys(o.dataMap),s=_.size(a);if(2===s){var l=r.withName(a[0]),u=r.withName(a[1]);if(l&&u)return R(l.expr,u.expr)}}}function g(e,t){_.some(e,(function(e){return e.blankDefaultPlaceholder}))||e.splice(0,0,{name:t.get("NullValue"),blankDefaultPlaceholder:!0})}function y(e){return _.filter(e,(function(e){return!e.blankDefaultPlaceholder}))}function C(t,r,i){var n=[],o=s.getVisualCapabilities(t,r);if(o&&o.grouping){var a=s.getVisualQuery(t);if(!a)return n;for(var l=a.projections,u=s.createRoleKindByQueryRef(a),c=_.filter(o.grouping.groupingRules,(function(e){return e.kind===i})),p=0,d=c;p<d.length;p++){var f=d[p],v=e.DataViewAnalysis.checkForConditionErrors(l,f.condition,u,!1);_.isEmpty(v)&&n.push(f)}}return n}function x(t,r,i){var n=o.asFieldPattern(t);if(n.groupingColumn)return _.map(n.groupingColumn.groupedColumns,(function(t){return e.data.SQExprBuilder.fieldExpr(t)}));if(n.column){var a=r.schema(n.column.schema),s=a.findProperty(n.column.entity,n.column.name);if(c(n.column.entity,s,i)){var l=t.getTargetEntity();return S(s.column.groupingMetadata,l)}}}function S(t,r){return _.map(t.groupedColumns,(function(t){if(N(t))return e.data.SQExprBuilder.columnRef(r,t.name)}))}function b(t,r){var i=e.data.FieldExprPattern.getSchema(o.asFieldPattern(r));return t.schema(i)}function E(e,t){var r=t&&t.defn.select();if(!_.isEmpty(r)&&!_.isEmpty(e)){for(var i=0,o=e;i<o.length;i++){var a=o[i];if(!a||!a.dataMap)return!1;var s=Object.keys(a.dataMap),l=_.size(a.dataMap);if(l>2)return!1;if(2===l){var u=r.withName(s[0]),c=r.withName(s[1]);if(u&&c&&!D(u.expr,c.expr))return!1}else if(1===l){var p=r.withName(s[0]);if(p&&!n.isColumn(p.expr)&&!n.isGroupRef(p.expr))return!1}}return!0}return!1}function w(e){return e.dateTime?t.services.GroupDataType.DateTime:e.numeric?t.services.GroupDataType.Number:t.services.GroupDataType.Category}function V(e){switch(e){case 4:return 3;case 6:return 2;case 8:return 0;case 9:return 7;case 10:return 6;case 11:return 5}}function F(e){switch(e){case 3:return 4;case 2:return 6;case 0:return 8;case 7:return 9;case 6:return 10;case 5:return 11}}function P(e){if(!e.get()){var r,i={dbName:"dbName",id:1,vsName:"vsName"},n=[{type:"dsr",id:i.id,name:r,dsr:{schemaName:r,vsName:i.vsName,dbName:i.dbName}}],o=t.contracts.createDataSourceArray(n);e.set(o)}}function T(t,r){var i=r.getDetails(e.common.localize);t.error(i.message,"GroupDialog",{debugErrorInfo:i.debugErrorInfo,displayableErrorInfo:i.displayableErrorInfo,helpLink:i.helpLink})}function N(e){return 0===e.kind}function D(e,t){return!!R(e,t)}function R(e,t){if(n.isGroupRef(e)&&n.isColumn(t)&&I(e,t))return e;if(n.isGroupRef(t)&&n.isColumn(e)&&I(t,e))return t;if(n.isGroupRef(e)&&n.isGroupRef(t)){if(I(e,t))return e;if(I(t,e))return t}}function I(t,r){return e.data.SQExprUtils.sequenceEqual(t.groupedExprs,[r])}var j=50;r.getGroupMode=i,r.isGroupOrBinColumn=l,r.isClusteringColumn=u,r.isGroupOrClusteringColumn=c,r.canExprBeGrouped=p,r.canEditSchema=d,r.canPropertyBeGrouped=f,r.generateGroupDisplayName=v,r.hasGroupOnKeys=m,r.findGroupingColumn=h,r.ensureBlankDefaultPlaceholder=g,r.filterOutBlankDefaultPlaceholder=y,r.getValidGroupingRules=C,r.getGroupedColumns=x,r.getGroupedColumnsFromMetadata=S,r.getConceptualSchema=b,r.canGroup=E,r.getGroupDataType=w,r.convertToTimeUnit=V,r.convertToBinUnit=F,r.ensureDataSources=P,r.showQueryError=T})(i=r.GroupUtils||(r.GroupUtils={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.SQExpr,i=(function(){function e(e){this.key=[],this.value=[],this.comparer=e}return e.prototype.add=function(e,t){this.key.push(e),this.value.push(t)},e.prototype.get=function(e){if(r.isHierarchyLevel(e))for(var t=0;t<this.key.length;t++)if(this.comparer(this.key[t],e))return this.value[t]},e})();t.SQExprToRoleDictionary=i})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}var r;!(function(e){e.negMinOrder=-1,e.posMinOrder=0,e.negMaxOrder=-1e7,e.posMaxOrder=1e7,e.defaultGap=1e3,e.minGap=5})(r=e.CanvasListOrderingConstants||(e.CanvasListOrderingConstants={})),e.createCanvasListOrderNormalizeService=t;var i=(function(){function e(){}return e.prototype.getContainerListOrders=function(e,t){for(var r={},i=0,n=e;i<n.length;i++){var o=n[i];r[o.name]=t(o)}return r},e.prototype.getSortedContainerNames=function(e,t){var r=t?"asc":"desc";return _.chain(e).keys().orderBy((function(t){return e[t]}),r).value()},e.prototype.settingListOrder=function(e,t,r,i){for(var n=0,o=t;n<o.length;n++){e[o[n]]=r,r+=i}return r},e.prototype.checkIfExtremitiesSurpassed=function(e,t,i){var n,o,a,s;return i?(n=r.posMinOrder,o=r.posMaxOrder,a=t[_.head(e)]<n,s=t[_.last(e)]>o):(n=r.negMinOrder,o=r.negMaxOrder,a=t[_.head(e)]>n,s=t[_.last(e)]<o),!(!a&&!s)},e.prototype.shouldNormalizeListOrder=function(e,t){var i=this.getSortedContainerNames(e,t);if(this.checkIfExtremitiesSurpassed(i,e,t))return!0;if(_.some(e,(function(e){return void 0===e})))return!0;for(var n,o=0,a=i;o<a.length;o++){var s=a[o],l=e[s];if(null!=n){if(Math.abs(l-n)<r.minGap)return!0}n=l}return!1},e.prototype.normalizeListOrder=function(e,t){var i=this.getSortedContainerNames(e,t),n=t?r.posMaxOrder-r.posMinOrder:r.negMaxOrder-r.negMinOrder,o=t?Math.min(n/i.length,r.defaultGap):Math.max(n/i.length,-r.defaultGap),a=t?r.posMinOrder:r.negMinOrder,s={};return a=this.settingListOrder(s,i,a,o),s},e})();e.CanvasListOrderNormalizeService=i})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,n,o,a,s){return new i(e,t,r,n,o,a,s)}t.CurrentClipboardDataVersion=2,t.CurrentClipboardFormatDataVersion=1,t.createClipboardService=r;var i=(function(){function r(e,t,r,i,n,o,a){this.eventBridge=e,this.popOutService=t,this.undoRedoService=r,this.visualStylePresetService=i,this.telemetryService=n,this.staticResourceReferences=o,this.clipboardStorageService=a,o.addReferenceSource(this)}return r.prototype.getReferences=function(){var e=this.clipboardStorageService.getData();return e&&e.referencedStaticResources},r.prototype.restoreMissingResources=function(){return this.staticResourceReferences.restoreReferences(this.getReferences())},r.prototype.copySelectedVisuals=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(n){switch(n.label){case 0:return e=this.handler.getSelectionResources(),this.clipboardStorageService.supportsMultipleReports()?[4,this.staticResourceReferences.loadItemsContent(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return i={version:t.CurrentClipboardDataVersion,sourceAction:r,sourceSectionName:this.handler.getSelectionSectionName()},[4,this.handler.serializeSelection()];case 3:return[2,(i.visuals=n.sent(),i.referencedStaticResources=e,i.sessionId=this.telemetryService.sessionId,i)]}}))}))},r.prototype.copy=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(i){switch(i.label){case 0:return this.isReady()?(r=(e=this.clipboardStorageService).setData,[4,this.copySelectedVisuals(0)]):[2];case 1:return r.apply(e,[i.sent()]),this.eventBridge.publishToChannel(t.events.clipboardDataUpdated),[2]}}))}))},r.prototype.cut=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r=this;return __generator(this,(function(i){switch(i.label){case 0:return this.isReady()?[4,this.copySelectedVisuals(1)]:[2];case 1:return e=i.sent(),setTimeout((function(){r.undoRedoService.register("Cut",(function(){r.clipboardStorageService.setData(e),r.eventBridge.publishToChannel(t.events.clipboardDataUpdated),r.handler.deleteSelection()}))}),0),[2]}}))}))},r.prototype.paste=function(){var r=this;if(this.isReady()&&this.canPaste()){var i=this.clipboardStorageService.getData();if(!i||i.version!==t.CurrentClipboardDataVersion)return void this.telemetryService.logEvent(e.telemetry.ClipboardServiceUnsupportedVersion,i&&i.version);var n=i.sessionId===this.telemetryService.sessionId;this.telemetryService.logEvent(e.telemetry.ClipboardServicePaste,n),this.restoreMissingResources().then((function(){setTimeout((function(){r.undoRedoService.register("Paste",(function(){r.staticResourceReferences.addItemsContent(i.referencedStaticResources),r.handler.deserializeAndDuplicateData(i.sourceAction,i.sourceSectionName,i.visuals,n)}))}),0)}))}},r.prototype.canPaste=function(){return Boolean(null==this.popOutService.get()&&this.clipboardStorageService.canPaste())},r.prototype.setHandler=function(e){this.handler=e},r.prototype.getFormatData=function(){return this.formatData},r.prototype.setFormatData=function(e){this.formatData=e,this.eventBridge.publishToChannel(t.events.clipboardDataUpdated)},r.prototype.clearFormatData=function(){this.formatData=void 0,this.eventBridge.publishToChannel(t.events.clipboardDataUpdated)},r.prototype.copyFormat=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(i){return this.isReady()&&(e=this.handler.copyCanvasItemFormat())?(r={version:t.CurrentClipboardFormatDataVersion,sourceAction:0,format:e},this.setFormatData(r),[2]):[2]}))}))},r.prototype.tryPasteFormat=function(){var e=this;this.canPasteFormat()&&this.isReady()&&setTimeout((function(){e.undoRedoService.register("PasteFormat",(function(){if(e.canPasteFormat()&&e.isReady()){var t=e.getFormatData(),r=t.format;e.handler.pasteCanvasItemFormat(r,e.visualStylePresetService),e.clearFormatData()}}))}),0)},r.prototype.canPasteFormat=function(){return!(!this.formatData||!this.formatData.format)},r.prototype.isReady=function(){return this.handler&&this.handler.isReady()},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getFormatInfo:function(){return r},getAllCurrencySymbolCustomFormatItemsInfo:function(){return[]},getAllDateTimeFormatItemsInfo:function(){return[]}}}e.createCultureService=t;var r={lcid:1033,displayName:"English (United States)",currencyDecimalDigits:2,numberDecimalDigits:2,percentDecimalDigits:2,percentSymbol:"%",percentPositivePattern:0,percentNegativePattern:0,currencySymbol:"$",currencyPositivePattern:0,currencyNegativePattern:0,shortDatePattern:"M/d/yyyy",longDatePattern:"dddd, MMMM d, yyyy",fullDateTimePattern:"dddd, MMMM d, yyyy h:mm:ss tt",monthDayPattern:"MMMM d",rfc1123Pattern:"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'",sortableDateTimePattern:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",shortTimePattern:"h:mm tt",longTimePattern:"h:mm:ss tt",universalSortableDateTimePattern:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",yearMonthPattern:"MMMM yyyy"}})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createDaxParserService=t;var r=(function(){function e(e){this.promiseFactory=e}return e.prototype.getMeasureReferences=function(e,t){var r=_.isArray(t)?_.map(t,(function(){return{measures:[],unrecognizedReferences:!1}})):[];return this.promiseFactory.resolve(r)},e.prototype.renameMeasureReferences=function(e,t,r,i){var n=_.map(t,(function(e){return e.expression}));return this.promiseFactory.resolve(n)},e.prototype.renameMovedMeasureTableReference=function(e,t,r,i,n){var o=_.map(t,(function(e){return e.expression}));return this.promiseFactory.resolve(o)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new m(e,t,r,i)}function n(e,t,r,i){if(!r||!r.includeDefaultAggregate)return i.defaultAggregate(e,t,!1)===e.func}function o(e,t,r,i){var n=s(t,r),o=i.aggregateDisplayNames[n];return p.format(o,[e])}function a(e,t,r){if(!_.isEmpty(e)){if(1===e.length)return e[0];var i=e.pop();return v.format(r.stringResourceProvider.get(t),e.length>1?e.join(r.stringResourceProvider.get("ListJoin_Separator")):e[0],i)}return null}function s(t,r){var i=e.data.aggregateFunctionName(t);return(3===t||4===t)&&r&&r.type&&(r.type.dateTime?i="Date"+i:r.type.text&&(i="String"+i)),i}var l=e.data.DataViewObjectDefinitions,u=e.data.FieldExprPattern,c=e.data.FilterPattern,p=e.formattingService,d=e.data.SQExpr,f=e.data.SQExprBuilder,v=jsCommon.StringExtensions;r.createDisplayNameService=i;var m=(function(){function i(e,t,r,i){this.locOptions=e,this.aggrOps=t,this.visualPluginService=r,this.visualTimeSynchronizationService=i}return i.prototype.getOriginalDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t,r))return u.visit(t,new h(r,this.locOptions,this.aggrOps,i,this.visualTimeSynchronizationService,n),r);
},i.prototype.getDisplayName=function(e,t,r,i,n,o){if(n&&i){var a=n[i];if(a&&a.displayName)return a.displayName}return this.getOriginalDisplayName(e,t,r,o)},i.prototype.getQualifiedDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t,r))return g.run(t,r,this.locOptions,this.aggrOps,i,this.visualTimeSynchronizationService,n)},i.prototype.getFilterRestatement=function(t,i,n,o){var a=e.data.SQFilterConverter.asFilterPattern(t,i);if(a&&a[0])return c.visit(a[0],new r.FilterRestatementVisitor(i,this.locOptions,this.aggrOps,n,this.visualTimeSynchronizationService,o))},i.prototype.getFilterRestatementForOverlay=function(t,i,n,o,a){var s=this,l=e.data.SQFilterConverter.asFilterPattern(t.filter,i);if(l&&l[0])return _.flatten(l.map((function(e){if(e.condition&&e.condition.complex&&t.restatement)return{fieldName:"",restatements:[t.restatement],fieldNameToolTip:""};var l=new r.FilterOverlayRestatementVisitor(i,s.locOptions,n,s,s.visualTimeSynchronizationService,t,o,a);return c.visit(e,l)})))},i.prototype.getQualifiedFilterRestatement=function(t,i,n,o){var a=e.data.SQFilterConverter.asFilterPattern(t,i);if(a&&a[0])return c.visit(a[0],new r.FilterRestatementVisitor(i,this.locOptions,this.aggrOps,n,this.visualTimeSynchronizationService,o,(!0)))},i.prototype.getVisualTitle=function(r,i,n,o){var a=e.Prototype.inherit(r||{show:o&&!o.suppressDefaultTitle});if(t.contracts.VisualTitle.isHidden(a))return r;if(null==a.show&&(a.show=!(!o||o.suppressDefaultTitle)),void 0!==a.text)return a;var s=a.titleComponents=this.getRawTitleComponents(i,n,o);return a.text=this.getTitleText(i,n,o,s),this.formatTitleComponents(s),a},i.prototype.getVisualDisplayName=function(e,t){var r=this.visualPluginService.capabilities(e.visualType);if(r){return this.getTitleText(e,t,r)||this.generateNonQueryTitle(e.visualType)}return this.generateNonQueryTitle(e.visualType)},i.prototype.getTitleText=function(e,t,r,i){var n;return i=i||this.getRawTitleComponents(e,t,r),n=i.subtitle?v.format(this.locOptions.stringResourceProvider.get("VisualTitle_By_Template"),i.title,i.subtitle):i.title},i.prototype.getTitleComponents=function(e,t,r){var i=this.getRawTitleComponents(e,t,r);return this.formatTitleComponents(i),i},i.prototype.generateNonQueryTitle=function(t){var r=this.visualPluginService.getPlugin(t);return r&&r.titleKey?e.data.getDisplayName(r.titleKey,this.locOptions.stringResourceProvider):r&&r.custom?r.displayName||r.name.match(/([A-z\s]+)/g)[0]:r&&r.displayName?r.displayName:t},i.prototype.formatTitleComponents=function(e){e.subtitle&&(e.subtitle=v.format(this.locOptions.stringResourceProvider.get("VisualTitle_By_Template"),"",e.subtitle).trim())},i.prototype.getRawTitleComponents=function(e,t,r){var i=l.getValue(e.vcObjects,{objectName:"title",propertyName:"text"},void 0);if(i){if(d.isConstantText(i))return{title:i.value};if(e.getEvaluatedObject){var n=e.getEvaluatedObject("title");if(n&&n.text)return{title:n.text}}return{title:null}}var o=[],s=[];if(e&&e.query){var u=e.query;if(u.projections&&r&&!r.suppressDefaultTitle&&r.dataRoles)for(var c=0,p=r.dataRoles;c<p.length;c++){var f=p[c];this.populateDisplayNamesByDataRole(f,u,t,r,e.columnProperties,o,s)}}var v={},m="AndConjunction";return o.length>0?(v.title=a(o,m,this.locOptions),s.length>0&&(v.subtitle=a(s,m,this.locOptions))):s.length>0&&(v.title=a(s,m,this.locOptions)),v},i.prototype.getDescription=function(e,t){return y.run(e,t)},i.prototype.populateDisplayNamesByDataRole=function(t,r,n,o,a,s,l){var u=r.defn.select(),c=r.projections[t.name];if(c)for(var p=_.isEmpty(c.activeProjectionRefs)?_.map(c.all(),(function(e){return e.queryRef})):c.activeProjectionRefs,d=0,f=p;d<f.length;d++){var v=f[d],m=u.withName(v);if(m&&m.expr){var h=this.getDisplayName(m.expr,n,o,v,a);t.kind===e.VisualDataRoleKind.Grouping?l.push(h):t.kind===e.VisualDataRoleKind.Measure?s.push(h):i.isRoleUsedAsGroup(t,r,n)?l.push(h):s.push(h)}}},i.isRoleUsedAsGroup=function(e,t,r){var i=t.projections[e.name];if(i){var n=_.head(i.all()),o=t.defn.select().withName(n.queryRef).expr,a=o.getMetadata(r);if(a)return 0===a.kind}return!1},i})(),h=(function(){function t(e,t,r,i,n,o){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.visualTimeSynchronizationService=n,this.displayOptions=o}return t.prototype.visitColumn=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitColumnAggr=function(e){return t.getDisplayNameForSQAggregate(e,f.fromColumnAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.visualTimeSynchronizationService,this.aggrOps,this.displayOptions)},t.prototype.visitGroupingColumn=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitGroupingColumnAggr=function(e){return t.getDisplayNameForSQAggregate(e,f.fromGroupingColumnAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.visualTimeSynchronizationService,this.aggrOps,this.displayOptions)},t.prototype.visitColumnHierarchyVariation=function(e){return t.getVariationHierarchyName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitColumnHierarchyLevelVariation=function(e){return t.getVariationLevelName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitColumnSubquery=function(e){},t.prototype.visitColumnAggrSubquery=function(e){},t.prototype.visitEntity=function(e){return t.getDisplayNameForEntity(e,this.schema)},t.prototype.visitEntityAggr=function(e){return t.getDisplayNameForSQAggregate(e,f.fromEntityAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.visualTimeSynchronizationService,this.aggrOps,this.displayOptions)},t.prototype.visitHierarchy=function(e){return t.getDisplayNameForHierarchy(e,this.schema)},t.prototype.visitHierarchyLevel=function(e){return t.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitHierarchyLevelAggr=function(e){return t.getDisplayNameForSQAggregate(e,f.fromHierarchyLevelAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.visualTimeSynchronizationService,this.aggrOps,this.displayOptions)},t.prototype.visitMeasure=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){var t=this.locOptions.showValueAsDisplayNames;return p.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[u.visit(e.arg,this),e.k])},t.prototype.visitPercentOfGrandTotal=function(e){return p.format(this.locOptions.showValueAsDisplayNames.PercentOfGrandTotal,[u.visit(e.baseExpr,this)])},t.prototype.visitPercentOfRoleTotal=function(t){if(this.visualCapabilities&&this.visualCapabilities.dataRoleTotals){var r=this.visualCapabilities.dataRoleTotals,i=_.find(r,(function(e){return _.isEqual(t.roles,e.roles)}));if(i){var n=e.data.getDisplayName(i.shortDisplayName,this.locOptions.stringResourceProvider);return p.format(n,[u.visit(t.baseExpr,this)])}}},t.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},t.prototype.visitFilteredEval=function(e){for(var t=this.locOptions.stringResourceProvider.get("VisualTitle_For_Template"),i=u.visit(e.baseExpr,this),n=new r.FilterRestatementVisitor(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.visualTimeSynchronizationService,this.displayOptions),o=[],s=0,l=e.filters;s<l.length;s++){var d=l[s],f=c.visit(d,n);null!=f&&o.push(f)}if(!_.isEmpty(o)){var v=a(o,"FilterRestatement_CompoundAnd",this.locOptions);return p.format(t,[i,v])}},t.getDisplayNameForEntity=function(e,t){var r=t.schema(e.schema).entities.withName(e.entity);if(r)return r.displayName},t.getDisplayNameForProperty=function(e,t){var r=t.schema(e.schema),i=r.findProperty(e.entity,e.name);if(i)return i.displayName},t.getDisplayNameForHierarchyLevel=function(e,t,r,i){var n=t.schema(e.schema),o=n.findHierarchy(e.entity,e.name);if(o){var a=o.levels.withName(e.level);if(a){var s=a.displayName||a.column.displayName;if(r&&r.includeHierarchyName&&i){var l=o.displayName;s=v.format(i.get("IncludeVariationSourceDisplayName"),l,s)}return s}}},t.getDisplayNameForHierarchy=function(e,t){var r=t.schema(e.schema),i=r.findHierarchy(e.entity,e.name);if(i)return i.displayName},t.getVariationHierarchyName=function(e,t,r,i){var n=t.schema(e.source.schema).findProperty(e.source.entity,e.source.name);if(n)for(var o=n.column.variations,a=0,s=o;a<s.length;a++){var l=s[a],u=l.defaultHierarchy;if(l.name===e.variationName&&u&&u.name===e.hierarchy.name){var c=u.displayName;return r&&r.includeVariationSource&&i?v.format(i.get("IncludeVariationSourceDisplayName"),n.displayName,c):c}}},t.getVariationLevelName=function(e,t,r,i){var n=t.schema(e.source.schema).findProperty(e.source.entity,e.source.name);if(n)for(var o=n.column.variations,a=0,s=o;a<s.length;a++){var l=s[a];if(l.name===e.variationName)for(var u=0,c=l.defaultHierarchy.levels;u<c.length;u++){var p=c[u];if(p.name===e.level.level){var d=p.column.displayName;return r&&r.includeVariationSource&&i?v.format(i.get("IncludeVariationSourceDisplayName"),n.displayName,d):d}}}},t.getDisplayNameForSQAggregate=function(e,r,i,a,s,l,c,p){var d=i.schema(e.schema).entities.withName(e.entity);if(d){var f=u.visit(r.arg,new t(i,a,c,s,l,p));return f?n(r,i,p,c)?f:o(f,r.func,r.arg.getMetadata(i),a):o(d.displayName,r.func,r.arg.getMetadata(i),a)}},t})();r.DisplayNameServiceVisitor=h;var g=(function(){function t(e,t,r,i,n,o){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.visualTimeSynchronizationService=n,this.displayOptions=o}return t.run=function(e,r,i,n,o,a,s){return new t(r,i,n,o,a,s).accept(e,r)},t.prototype.accept=function(e,t){var r=e;if(d.isAggregation(r)){var i=u.visit(r.arg,this);return n(r,this.schema,this.displayOptions,this.aggrOps)?i:o(i,r.func,r.arg.getMetadata(this.schema),this.locOptions)}return u.visit(e,this,t)},t.prototype.visitEntity=function(e){var t=h.getDisplayNameForEntity(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitColumn=function(e){var t=h.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitColumnAggr=function(e){},t.prototype.visitGroupingColumn=function(e){var t=h.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitGroupingColumnAggr=function(e){},t.prototype.visitColumnHierarchyVariation=function(e){var t=h.getVariationHierarchyName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e.source)},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=h.getVariationLevelName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e.source)},t.prototype.visitColumnSubquery=function(e){},t.prototype.visitColumnAggrSubquery=function(e){},t.prototype.visitEntityAggr=function(e){var t=h.getDisplayNameForSQAggregate(e,f.fromEntityAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.visualTimeSynchronizationService,this.aggrOps,this.displayOptions);return this.formatWithEntity(t,e)},t.prototype.visitHierarchy=function(e){var t=h.getDisplayNameForHierarchy(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitHierarchyLevel=function(e){var t=h.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e)},t.prototype.visitHierarchyLevelAggr=function(e){},t.prototype.visitMeasure=function(e){var t=this.locOptions.qualifiedDisplayNameTemplate,r=h.getDisplayNameForProperty(e,this.schema),i=h.getDisplayNameForEntity(e,this.schema);return i?v.format(t,i,r):r},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){var t=this.locOptions.showValueAsDisplayNames;return p.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[this.accept(f.fieldExpr(e.arg)),e.k])},t.prototype.visitPercentOfGrandTotal=function(e){return p.format(this.locOptions.showValueAsDisplayNames.PercentOfGrandTotalTooltip,[this.accept(f.fieldExpr(e.baseExpr))])},t.prototype.visitPercentOfRoleTotal=function(t){if(this.visualCapabilities&&this.visualCapabilities.dataRoleTotals){var r=this.visualCapabilities.dataRoleTotals,i=_.find(r,(function(e){return _.isEqual(t.roles,e.roles)}));if(i){var n=e.data.getDisplayName(i.tooltip,this.locOptions.stringResourceProvider);return p.format(n,[this.accept(f.fieldExpr(t.baseExpr))])}}},t.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},t.prototype.visitFilteredEval=function(e){for(var t=this.locOptions.stringResourceProvider.get("VisualTitle_For_Template"),i=this.accept(f.fieldExpr(e.baseExpr)),n=[],o=new r.FilterRestatementVisitor(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.visualTimeSynchronizationService,this.displayOptions,(!0)),s=0,l=e.filters;s<l.length;s++){var u=l[s],d=c.visit(u,o);null!=d&&n.push(d)}if(!_.isEmpty(n)){var v=a(n,"FilterRestatement_CompoundAnd",this.locOptions);return p.format(t,[i,v])}},t.prototype.formatWithEntity=function(e,t){var r=this.locOptions.qualifiedDisplayNameTemplate,i=h.getDisplayNameForEntity(t,this.schema);return i?v.format(r,i,e):e},t})();r.QualifiedDisplayNameVisitor=g;var y=(function(){function e(e){this.schema=e}return e.run=function(t,r){var i=new e(r);return u.visit(t,i)},e.prototype.visitColumn=function(e){return this.getPropertyDescription(e)},e.prototype.visitColumnAggr=function(e){return this.getPropertyDescription(e)},e.prototype.visitGroupingColumn=function(e){return this.getPropertyDescription(e)},e.prototype.visitGroupingColumnAggr=function(e){return this.getPropertyDescription(e)},e.prototype.visitColumnHierarchyVariation=function(e){var t=e.hierarchy,r=this.findHierarchy(t);if(r)return r.description},e.prototype.visitColumnHierarchyLevelVariation=function(e){return this.getHierarchyLevelDescription(e.level)},e.prototype.visitColumnSubquery=function(e){},e.prototype.visitColumnAggrSubquery=function(e){},e.prototype.visitEntity=function(e){return this.getEntityDescription(e)},e.prototype.visitEntityAggr=function(e){return this.getEntityDescription(e)},e.prototype.visitHierarchy=function(e){var t=this.findHierarchy(e);if(t)return t.description},e.prototype.visitHierarchyLevel=function(e){return this.getHierarchyLevelDescription(e)},e.prototype.visitHierarchyLevelAggr=function(e){return this.getHierarchyLevelDescription(e)},e.prototype.visitMeasure=function(e){return this.getPropertyDescription(e)},e.prototype.visitPercentile=function(e){return u.visit(e.arg,this)},e.prototype.visitPercentOfGrandTotal=function(e){return u.visit(e.baseExpr,this)},e.prototype.visitPercentOfRoleTotal=function(e){return u.visit(e.baseExpr,this)},e.prototype.visitSelectRef=function(e){},e.prototype.visitTransformOutputRoleRef=function(e){},e.prototype.visitFilteredEval=function(e){},e.prototype.getPropertyDescription=function(e){var t=this.schema.schema(e.schema);if(t){var r=t.findProperty(e.entity,e.name);return r&&r.description}},e.prototype.getEntityDescription=function(e){var t=this.schema.schema(e.schema);if(t){var r=t.entities.withName(e.entity);return r&&r.description}},e.prototype.getHierarchyLevelDescription=function(e){var t=this.findHierarchy(e);if(t){var r=t.levels.withName(e.level);return r&&r.description}},e.prototype.findHierarchy=function(e){var t=this.schema.schema(e.schema);if(t)return t.findHierarchy(e.entity,e.name)},e})();r.concatStrings=a,r.getAggregateKey=s})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Unknown=0]="Unknown",e[e.Swipe=1]="Swipe"})(t=e.SectionNavigationAction||(e.SectionNavigationAction={}));var r;!(function(e){function t(e,t){return e.visualContainer===t}e.modelChangeApplyingUpdate={type:4,name:"modelChangeApplyingUpdate"},e.explorationLoaded={type:1,name:"explorationLoaded"},e.explorationUnloaded={type:1,name:"explorationUnloaded"},e.explorationContainerReady={type:3,name:"explorationContainerReady"},e.explorationSlowDataSourceSettingsLoaded={type:1,name:"explorationSlowDataSourceSettingsLoaded"},e.explorationSettingsLoaded={type:1,name:"explorationSettingsLoaded"},e.updateNavButtonEvent={type:1,name:"updateNavButtonEvent"},e.userActionTriggered={type:2,name:"userActionTriggered"},e.filterContainerChanged={type:2,name:"filterContainerChanged"},e.applyAllBufferedFilterCardChanged={type:1,name:"applyAllBufferedFilterCardChange"},e.applyAllClicked={type:1,name:"applyAllClicked"},e.explorationFiltersContainerChanged={type:1,name:"explorationFiltersContainerChanged"},e.sectionFiltersContainerChanged={type:1,name:"sectionFiltersContainerChanged"},e.sectionDrillthroughLinkChanged={type:1,name:"sectionDrillthroughLinkChanged"},e.formFactorChanged={type:1,name:"formFactorChanged"},e.canvasLayoutChanged={type:1,name:"canvasLayoutChanged"},e.modelChanged={type:0,name:"modelChanged"},e.visualRelationshipsModeChanged={type:2,name:"visualRelationshipsModeChanged"},e.schemaItemActivationChanged={type:0,name:"schemaItemActivationChanged"},e.selectionChanged={type:2,name:"selectionChanged"},e.visualTypeChanged={type:2,name:"visualTypeChanged"},e.visualLinkButtonClicked={type:2,name:"visualLinkButtonClicked"},e.dataPointsSelected={type:2,name:"dataPointsSelected"},e.dataHyperlinkClicked={type:2,name:"dataHyperlinkClicked"},e.undoRedoStackUpdated={type:1,name:"undoRedoStackUpdated"},e.undoRedoStackCleared={type:1,name:"undoRedoStackCleared"},e.onReportChanged={type:1,name:"onReportChanged"},e.onReportChangedGlobal={type:4,name:"onReportChanged"},e.clipboardDataUpdated={type:1,name:"clipboardDataUpdated"},e.dataSelectionChanged={type:2,name:"dataSelectionChanged"},e.drillModeChanged={type:2,name:"drillModeChanged"},e.refreshExploration={type:2,name:"refreshExploration"},e.clearAnnotations={type:2,name:"clearAnnotations"},e.saveReportCompleted={type:0,name:"saveReportCompleted"},e.customSaveAsTriggered={type:0,name:"customSaveAsTriggered"},e.sectionLayoutRemoved={type:1,name:"sectionLayoutRemoved"},e.canvasChanged={type:1,name:"canvasChanged"},e.visualContainerChanged={type:2,name:"visualContainerChanged"},e.dataRefreshTriggered={type:2,name:"triggerDataRefresh"},e.visualContainerGroupChanged={type:2,name:"visualContainerGroupChanged"},e.visualContainerGroupRendered={type:2,name:"visualContainerGroupRendered"},e.visualContainerDataRenderingStarted={type:2,name:"visualContainerDataRenderingStarted"},e.visualContainerDataRendered={type:2,name:"visualContainerDataRendered"},e.canvasItemContainerPositionChanged={type:2,name:"canvasItemContainerPositionChanged"},e.visualContainerLoadingStarted={type:2,name:"visualContainerLoadingStarted"},e.visualContainerLoadingStopped={type:2,name:"visualContainerLoadingStopped"},e.visualConversion={type:2,name:"visualConversion"},e.canvasSizeChangedEvent={type:2,name:"canvasSizeChanged"},e.visualPluginsChanged={type:2,name:"visualPluginsChanged"},e.addCustomVisual={type:2,name:"addCustomVisual"},e.deleteCustomVisual={type:2,name:"deleteCustomVisual"},e.modelingContextChanged={type:0,name:"modelingContextChanged"},e.changeViewMode={type:2,name:"changeViewMode"},e.requestViewModeChange={type:2,name:"requestViewModeChange"},e.editModeChanged={type:2,name:"editModeChanged"},e.getClusters={type:2,name:"getClusters"},e.toggleSortVisualContainer={type:2,name:"toggleSortVisualContainer"},e.saveKeyPressedEvent={type:1,name:"saveEventViaCtrlS"},e.highContrastModeChanged={type:1,name:"highContrastModeChanged"},e.canvasDisplayChanged={type:1,name:"canvasDisplayChanged"},e.canvasZoomChanged={type:1,name:"canvasZoomChanged"},e.canvasZoomScaleUpdated={type:1,name:"canvasZoomScaleUpdated"},e.canvasDimensionChanged={type:1,name:"canvasDimensionChanged"},e.explorationObjectsLoaded={type:3,name:"explorationObjectsLoaded"},e.explorationObjectsChanged={type:3,name:"explorationObjectsChanged"},e.sectionObjectsEvaluated={type:1,name:"sectionObjectsEvaluated"},e.sectionObjectsChanged={type:1,name:"sectionObjectsChanged"},e.datasourceVariablesEditClicked={type:3,name:"showDataSourceVariablesDialog"},e.themeDialogButtonClicked={type:3,name:"showThemeDialog"},e.visibilityChanged={type:2,name:"visibilityChanged"},e.canvasItemHiddenChanged={type:2,name:"canvasItemHiddenChanged"},e.align={type:1,name:"align"},e.deleteSectionInitiated={type:1,name:"deleteSectionInitiated"},e.sectionNameChanged={type:1,name:"sectionNameChanged"},e.sectionDeleted={type:1,name:"sectionDeleted"},e.renameSection={type:1,name:"renameSection"},e.sectionChanged={type:1,name:"sectionChanged"},e.podParameterChanged={type:1,name:"podParameterChanged"},e.missingTableRelationship={type:2,name:"missingTableRelationship"},e.addVisualContainer={type:1,name:"addVisualContainer"},e.addCustomVisualToCanvas={type:3,name:"addCustomVisualToCanvas"},e.deleteVisualContainer={type:2,name:"deleteVisualContainer"},e.addInsightContainer={type:1,name:"addInsightContainer"},e.addQnaContainer={type:1,name:"addQnaContainer"},e.showQnaPopout={type:1,name:"showQnaPopoutEventArgs"},e.canvasPinched={name:"canvasPinched",type:1},e.changeFormFactor={name:"changeFormFactor",type:1},e.arrangeVisualsOrder={type:1,name:"arrangeVisualsOrder"},e.createImage={type:1,name:"createImage"},e.createBasicShape={type:1,name:"createBasicShape"},e.createActionButton={type:1,name:"createActionButton"},e.createTextbox={type:1,name:"createTextbox"},e.importVisual={type:1,name:"importVisual"},e.addManagedCustomVisual={type:4,name:"addManagedCustomVisual"},e.installVisual={type:1,name:"installVisual"},e.downloadVisual={type:1,name:"downloadVisual"},e.newQueryCacheResultAvailable={type:2,name:"newQueryCacheResultAvailable"},e.exportVisualData={type:2,name:"exportVisualData"},e.exportVisualDataFromPane={type:1,name:"exportVisualDataFromPane"},e.addCommentVisual={type:2,name:"addCommentVisual"},e.reportSlidesChanged={type:1,name:"reportSlidesChanged"},e.createSection={type:1,name:"createSection"},e.deleteSection={type:1,name:"deleteSection"},e.duplicateSection={type:1,name:"duplicateSection"},e.insertSection={type:1,name:"insertSection"},e.reorderSection={type:1,name:"reorderSection"},e.switchSection={type:1,name:"switchSection"},e.explorationNextPage={type:3,name:"explorationNextPage"},e.explorationPreviousPage={type:3,name:"explorationPreviousPage"},e.copyTable={type:1,name:"copyDataTable"},e.showEnableScriptVisualsDialog={type:2,name:"showEnableScriptVisualsDialog"},e.CanvasResized={type:1,name:"canvasResized"},e.openReportFinished={type:4,name:"openReportFinished"},e.ShowVisuals={type:4,name:"ShowVisuals"},e.bookmarkApplied={type:1,name:"bookmarkApplied"},e.exploreCanvasVisualRendered={type:1,name:"exploreCanvasVisualRendered"},e.reportVisualError={type:2,name:"ReportVisualError"},e.reportVisualErrorGlobal={type:4,name:"ReportVisualError"},e.visualThumbnailDoubleClicked={type:3,name:"visualThumbnailDoubleClicked"},e.removeVisualContainerFromLayout={type:2,name:"removeVisualContainerFromLayout"},e.pauseQueriesChanged={type:1,name:"pauseQueriesChanged"},e.deleteVisual={type:2,name:"deleteVisual"},e.deleteCustomVisuals={type:2,name:"deleteCustomVisuals"},e.exportAsImage={type:3,name:"exportAsImage"},e.resetPersistentUserState={type:4,name:"resetPersistentUserState"},e.reloadPersistenState={type:3,name:"reloadPersistenState"},e.togglePaneVisibility={type:1,name:"togglePaneVisibility"},e.visualDrillFilterOtherVisualsSettingChanged={type:2,name:"visualDrillFilterOtherVisualsSettingChanged"},e.emulationChanged={type:0,name:"emulationChanged"},e.focusGroupChanged={type:0,name:"focusGroupChanged"},e.showOtherBookmarks={type:3,name:"showOtherBookmarks"},e.parentExpandCollapseAction={type:2,name:"parentExpandCollapseAction"},e.bookmarkViewStateChanged={type:3,name:"bookmarkViewStateChanged"},e.exportDataStarted={type:0,name:"exportDataStarted"},e.exportDataEnded={type:0,name:"exportDataEnded"},e.visualContainerControllerLinked={type:2,name:"visualContainerControllerLinked"},e.insightsPaneClose={type:4,name:"insightsPaneClose"},e.pinInsightContainer={type:4,name:"pinInsightContainer"},e.insightSelected={type:4,name:"insightSelected"},e.getRelatedInsights={type:4,name:"getRelatedInsights"},e.viewInsightInFocus={type:4,name:"viewInsightInFocus"},e.autoPageRefreshTriggered={type:0,name:"autoPageRefreshTriggered"},e.drillthroughActionTriggered={type:2,name:"drillthroughActionTriggered"},e.saveAsExploration={name:"saveAsExploration"},e.generateReportQR={name:"generateReportQR"},e.saveExploration={name:"saveExploration"},e.affectsVisualContainer=t})(r=e.events||(e.events={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new s(e,t)}var n=e.data.ExpansionState,o=e.data.Selector,a=t.util.VisualContainerUtils;r.createExpandCollapseService=i;var s=(function(){function t(e,t){this.visualPlugin=e,this.featureSwitch=t}return t.prototype.getExpandCollapseRoles=function(t){e.contract.checkValue(t,"visual should have a value");var r=this.visualPlugin.capabilities(a.getVisualType(t));if(r&&r.expandCollapse&&!_.isEmpty(r.expandCollapse.roles))return r.expandCollapse.roles},t.prototype.isSupported=function(e,t,r){if(!t||!e||!e.supportsInstanceFilters)return!1;var i=a.getVisualQuery(t);return!!i&&!(!_.isEmpty(r)&&_.some(r,(function(e){return 3===i.currentDrillMode(e)})))},t.prototype.isEnabled=function(t,r){if(e.contract.checkValue(t,"visual should have a value"),_.isEmpty(r))return!1;var i=this.getExpandCollapseRoles(t);return!_.isEmpty(i)&&!_.some(r,(function(e){return _.indexOf(i,e)===-1}))},t.prototype.getMaximumExpansionDepth=function(e,t){if(this.isEnabled(e,t)){var r=a.getVisualQuery(e);if(r){var i=r.getRolesProjectionRefs(t);return i.length}}},t.prototype.getAllowedActions=function(e,t,r){var i=a.getVisualQuery(e);if(i&&this.isEnabled(e,t)&&!_.isEmpty(r)&&1===r.length){var s=r[0];if(s&&s.dataMap&&!_.isEmpty(s.dataMap)){var l=o.toScopeIdentities(o.convertSelectorsByColumnToSelector(s));if(!_.isEmpty(l)){var u=i.getRolesUniqueProjectionRefs(t),c=i.getRolesUniqueActiveProjectionsRefs(t),p=c.length===u.length,d=_.some(t,(function(e){return 3===i.currentDrillMode(e)}));if(1===u.length||d)return{};var f=this.getSelectorRefs(s);if(!_.some(f,(function(e){return!_.includes(c,e)}))){var v=l.length,m=v===u.length,h=v===c.length,g=n.findExpansionState(i.expansionStates,t);if(g){var y=g.getNodeLevelState(l,g.root,0);return{expandNode:!m&&!!y.isNodeCollapsed,collapseNode:!h&&!y.isNodeCollapsed,expandLevel:!m&&(y.levelHasToggledNodes||!!y.isNodeCollapsed),collapseLevel:!h&&(y.levelHasToggledNodes||!y.isNodeCollapsed),expandHierarchy:!p||!g.isHierarchyExpanded(),collapseHierarchy:!g.isWholeLevelCollapsed(0)}}return{expandNode:!m&&h,collapseNode:!h,expandLevel:!m&&h,collapseLevel:!h,expandHierarchy:!p,collapseHierarchy:c.length>1}}}}}},t.prototype.getSelectorRefs=function(e){if(!e||!e.dataMap||_.isEmpty(e.dataMap))return[];var t=[];for(var r in e.dataMap)t.push(r);return t},t.prototype.expandNode=function(e,t,r){var i=this.setNodeState(e,t,r,!1);if(i){var n=this.ensureExpansionState(e,t),o=this.getSelectorRefs(r),s=o.length-1,l=n.getVisibleDescendentsDepth(i,s),u=a.getVisualQuery(e);if(u){l>u.getRolesUniqueActiveProjectionsRefs(t).length&&this.setActiveProjections(e,t,l)}}},t.prototype.collapseNode=function(e,t,r){this.setNodeState(e,t,r,!0);var i=this.ensureExpansionState(e,t),n=i.getVisibleDescendentsDepth(i.root,-1);this.setActiveProjections(e,t,n)},t.prototype.expandLevel=function(e,t,r,i){void 0===i&&(i=!1);var n=this.ensureExpansionState(e,t);this.setLevelState(e,t,r,!1,i);var o=n.getVisibleDescendentsDepth(n.root,-1);this.setActiveProjections(e,t,o)},t.prototype.collapseLevel=function(e,t,r,i){void 0===i&&(i=!1),this.setLevelState(e,t,r,!0,i),this.setActiveProjections(e,t,r+1)},t.prototype.expandAll=function(e,t){this.setAllLevelsState(e,t,!1);var r=this.ensureExpansionState(e,t),i=r.levels.length;this.setActiveProjections(e,t,i)},t.prototype.collapseAll=function(e,t){this.setAllLevelsState(e,t,!0),this.setActiveProjections(e,t,this.canCollapseRoot(e)?0:1)},t.prototype.pinLevels=function(e,t,r){this.ensureExpansionState(e,t).pinLevels(r)},t.prototype.unpinLevels=function(e,t,r){this.ensureExpansionState(e,t).unpinLevels(r)},t.prototype.lockLevels=function(e,t,r){this.ensureExpansionState(e,t).lockLevels(r)},t.prototype.unlockLevels=function(e,t,r){this.ensureExpansionState(e,t).unlockLevels(r)},t.prototype.setAILevelInformation=function(e,t,r,i,n){var o=this.ensureExpansionState(e,t);o.setAILevelInformation(r,n)},t.prototype.getAILevelInformation=function(e,t,r){var i=a.getVisualQuery(e);return n.getAILevelInformation(i.expansionStates,t,r)},t.prototype.clearAILevelsInformation=function(e,t){for(var r=this.ensureExpansionState(e,t),i=0;i<_.size(r.levels);i++)r.setAILevelInformation(i,void 0)},t.prototype.setNodeState=function(e,t,r,i){var n=this.ensureExpansionState(e,t),a=this.getSelectorRefs(r);if(!_.isEmpty(a)||this.canCollapseRoot(e))return n.setNodeState(o.convertSelectorsByColumnToSelector(r),i)},t.prototype.setLevelState=function(e,t,r,i,n){var o=this.ensureExpansionState(e,t);if(n)for(var a=0;a<r;a++)o.setLevelState(a,!1);o.setLevelState(r,i)},t.prototype.setAllLevelsState=function(e,t,r){var i=this.ensureExpansionState(e,t);this.canCollapseRoot(e)&&i.setLevelState(-1,r);for(var n=i.levels,o=0;o<n.length-1;o++)i.setLevelState(o,r)},t.prototype.ensureExpansionState=function(e,t){var r=a.getVisualQuery(e),i=this.visualPlugin.capabilities(a.getVisualType(e)),n=i&&i.expandCollapse&&i.expandCollapse.supportsMerge,o=this.canCollapseRoot(e),s=r.ensureExpansionState(t,n,o);return s},t.prototype.canCollapseRoot=function(e){var t=this.visualPlugin.capabilities(a.getVisualType(e));return!(!t||!t.noDefaultProjections)},t.prototype.setActiveProjections=function(e,t,r){!this.canCollapseRoot(e);var i=a.getVisualQuery(e);i.setActiveProjections(t,r)},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(r){function i(r,i){var o,a=i.getCurrentSection(),s=i.getCurrentExploration(),l=i.getExplorationTelemetryData();switch(a&&(o={visualTypesAndCounts:JSON.stringify(t.util.VisualContainerUtils.getVisualTypesAndCountsFromSection(a)),activeSectionId:a.id,sectionGuid:a.objectId,sectionIndex:s&&s.activeSectionIndex}),l&&(o||(o={}),o.modelId=l.modelId,o.reportGuid=l.reportGuid,o.dataCacheMode=l.dataCacheMode,o.datasetHost=l.datasetHost,o.dbName=l.dbName,o.enterpriseCapacitySkuTier=l.enterpriseCapacitySkuTier,o.isDirectQuery=l.isDirectQuery,o.isOnPrem=l.isOnPrem,o.exid=l.exid,o.exsid=l.exsid),r.name){case e.telemetry.EXOpenExplorationEventName:case e.telemetry.EXSwitchSectionEventName:n(o,a,l)}if(o){var u=r.formatted||function(){return{}};r.formatted=function(){return e.extendFormatted(u.apply(r),o)}}}function n(e,t,r){e||(e={}),t&&(e.usageReportSection=r&&r.isNewUsageMetrics?t.displayName:void 0),r&&(e.isNewUsageMetrics=r.isNewUsageMetrics,e.isUsageMetrics=r.isUsageMetrics)}r.addExplorationInfoToEvent=i})(i=r.ExplorationTelemetryUtil||(r.ExplorationTelemetryUtil={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e){return new i(e)}t.createFederatedSchemaValidator=r;var i=(function(){function t(e){this.localization=e}return t.prototype.validate=function(t){if(t)for(var r=e.util.createNameValidator(t,this.localization),i=0,n=t.schemas;i<n.length;i++){var o=n[i];if(o.isExtensionSchema)for(var a=t.schema(o.extends),s=0,l=o.entities;s<l.length;s++){var u=l[s],c=!1,p=a.entities.withName(u.name);if(!p){c=!0,u.errorMessage=this.localization.get("ReportMeasuresMissingTableErrorMessage"),u.queryable=1;var d=u;d.isAbandoned=!0}for(var f=0,v=u.properties;f<v.length;f++){var m=v[f];if(1===m.kind){var h=r.validateExistingMeasureName(m);h.error===e.util.NameValidationError.DuplicatedName?(m.errorMessage=h.reason,
m.queryable=1):c&&(m.errorMessage=this.localization.get("ReportMeasuresMissingTableMeasureErrorMessage"),m.queryable=1)}}}}},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,o,a,s,l){return new d(e,t,r,i,n,o,a,s,l)}var n=e.explore.contracts.CollectedFilterSource,o=e.data.DataViewObjectDescriptors,a=e.data.FilterKindDetector,s=e.visuals.plugins,l=e.explore.util.ScriptVisualsUtil,u=e.data.Selector,c=e.data.SQExprUtils,p=e.explore.util.VisualContainerUtils;r.createFilterGenerator=i;var d=(function(){function i(e,t,r,i,n,o,a,s,l){this.eventBridge=e,this.visualPlugins=t,this.aggrOps=r,this.relationshipService=i,this.hostFilters=n,this.telemetryService=o,this.scriptVisuals=a,this.featureSwitchService=s,this.visualCapabilitiesService=l}return i.prototype.collectVisualContainerFilters=function(e,t,i){var n=new r.FilterCollector(this.visualPlugins);n.collectFilters(i.filters,0,i),t&&(n.collectFilters(t.filters,1),this.collectCrossFilter(n,t,i)),this.collectSelfFilter(n,i,null),e&&n.collectFilters(e.filters,2);var o=this.hostFilters.getSelectedHostFilters();return o&&n.collectFilters(o.filters,1),n.getCollectedFilters()},i.prototype.collectVisualContainerDrillFilters=function(e){var t=new r.FilterCollector(this.visualPlugins),i=_.filter(e.filters,(function(e){return 2===e.howCreated}));return t.collectFilters(i,0,e),t.getCollectedFilters()},i.prototype.addVisualContainerFilters=function(e,t,r,i,n,o){void 0===o&&(o=!1),e.addCollectedFilters(this.collectVisualContainerFilters(t,r,i),!0,this.getShouldApplyFilter(i,n,r,o)),r&&(this.addHighlightFilter(e,r,i,n),this.addCrossDrillFilters(e,r,i,n))},i.prototype.calculateVisualContainerFilter=function(e,i,n,o,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);var l=new r.FilterBuilder(n);this.addVisualContainerFilters(l,e,i,n,o,a);var u=l.getFilters(s);return u.queryRefsForSingleItemDrillFilters=t.FilterUtils.getQueryRefsForSingleItemDrillFilters(n,o,this.aggrOps),u},i.prototype.calculateDetailVisualFilter=function(e,i,n,o,a){var s=new r.FilterBuilder(n);this.addVisualContainerFilters(s,e,i,n,o),0===a&&(a=1);var l=s.getHighlightFilters();l&&(s.clearHighlightFilters(),s.mergeHighlightFiltersBasedOnRelationship(l,a));var u=s.getFilters();return u.queryRefsForSingleItemDrillFilters=t.FilterUtils.getQueryRefsForSingleItemDrillFilters(n,o,this.aggrOps),u},i.prototype.clearCrossHighlight=function(e){var t=this.clearCrossHighlightOperation(e);p.notifyVisualContainers(this.eventBridge,t,"UserAction_CrossHighlight")},i.prototype.clearCrossHighlightForVisualContainers=function(e,t){var r=this.clearCrossHighlightForVisualContainersOperation(e,t);p.notifyVisualContainers(this.eventBridge,r,"UserAction_CrossHighlight")},i.prototype.clearCrossHighlightForVisualContainersOperation=function(e,t){var r=e.crossFilterSource&&e.crossFilterSource.highlight;if(!_.isEmpty(r)){for(var i=_.chain(r).map((function(e){return e.sourceVisualContainer})).filter((function(e){return _.includes(t,e)})).valueOf(),n=[],o=0,a=i;o<a.length;o++){var s=a[o],l=this.setCrossHighlightOperation(null,null,e,!0,s);n.push.apply(n,l)}return _.uniq(n)}},i.prototype.clearFiltersFromVisualContainers=function(e,t,r){var i=this,n=e&&e.crossFilterSource,o=n&&n.drill,a=n&&n.highlight,s=[];if(!_.isEmpty(a)&&_.some(t,(function(e){return _.some(a,(function(t){return e===t.sourceVisualContainer}))}))&&(s=this.clearCrossHighlightOperation(e)),!_.isEmpty(o)){var l=this.clearCrossDrillFromVisualContainersOperation(e,t);s=_.union(s,l)}_.some(t,(function(e){return i.supportsFilterOutput(e)}))?p.notifyVisualContainers(this.eventBridge,e.visualContainers,r):_.isEmpty(s)||p.notifyVisualContainers(this.eventBridge,s,r)},i.prototype.updateCrossHighlightCollectedFilters=function(e,t,r){var i=e&&e.crossFilterSource&&e.crossFilterSource.highlight;if(i){var n=_.find(i,(function(e){return e.sourceVisualContainer===r}));n&&!_.isEmpty(n.selection)&&(n.collectedFilters=this.collectVisualContainerFilters(t,e,r),p.notifyVisualContainersExceptSource(this.eventBridge,r))}},i.prototype.calculateFilterContainerInputFilter=function(e,t,i,n,o){if(i&&t&&o){var a;0===o.scopeType&&(a=o.container);var s=new r.FilterCollector(this.visualPlugins);if(e&&s.collectFiltersForFilterContainer(e.filters,2,i),1===o.scopeType){var l=5===i.howCreated?_.filter(t.filters,(function(e){return 5===e.howCreated})):t.filters;s.collectFiltersForFilterContainer(l,1,i)}else 2!==o.scopeType&&s.collectFiltersForFilterContainer(t.filters,1,i);this.collectSelfFilter(s,null,i),a&&(s.collectFiltersForFilterContainer(a.filters,0,i,a),this.collectCrossFilter(s,t,a));var u=new r.FilterBuilder(a,i);return u.addCollectedFilters(s.getCollectedFilters(),!1,this.getShouldApplyFilterContainerInputFilter(i,a,n,t)),u.getFilters()}},i.prototype.getVisualContainerCrossFilters=function(e,t,i){var n=new r.FilterCollector(this.visualPlugins);this.collectCrossFilter(n,e,t);var o=new r.FilterBuilder(t);return o.addCollectedFilters(n.getCollectedFilters(),!1,this.getShouldApplyFilter(t,i,e)),this.addHighlightFilter(o,e,t,i),this.addCrossDrillFilters(o,e,t,i),{dataFilters:o.getCrossFilters()||[],highlightFilters:o.getHighlightFilters()}},i.prototype.supportsVisualLevelSlicerFilters=function(){return this.featureSwitchService.featureSwitches.visualLevelSlicerFilters===!0},i.prototype.logRFilterTelemetry=function(e,t,r){var i=l.getScriptVisualIdsInSection(t,this.scriptVisuals);_.isEmpty(i)||this.telemetryService.logEvent(e,r,JSON.stringify(i))},i.prototype.setCrossHighlightOperation=function(t,r,i,n,o,a){var s=i.crossFilterSource&&i.crossFilterSource.highlight,l=!1;if(o){l=!0,i.crossFilterSource||(i.crossFilterSource={highlight:[]}),i.crossFilterSource.highlight||(i.crossFilterSource.highlight=[]);var c=i.crossFilterSource.highlight,d=void 0;n&&this.newAndPreviousSelectionsSupportMultiVisualSelection(o,c)?(d=_.findIndex(c,(function(e){return e.sourceVisualContainer===o})),d===-1&&(d=c.length)):(i.crossFilterSource.highlight=c=[],d=0),null==r?(_.isEmpty(c)||(c=c.slice(),c.splice(d,1),i.crossFilterSource.highlight=c),o=null):c[d]={sourceVisualContainer:o,selection:r,selectorFilter:u.filterFromSelectorsByColumn(r),collectedFilters:_.isEmpty(r)?[]:this.collectVisualContainerFilters(t,i,o),filterExpressionMetadata:a},this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,i,"Highlight")}else s&&(l=!0,i.crossFilterSource.highlight=void 0);if(l){var f=i.crossFilterSource&&i.crossFilterSource.highlight;if(!_.isEmpty(s)){for(var v=function(e){_.findIndex(f,(function(t){return t.sourceVisualContainer===e.sourceVisualContainer}))===-1&&p.clearDataSelection(m.eventBridge,e.sourceVisualContainer)},m=this,h=0,g=s;h<g.length;h++){var y=g[h];v(y)}for(var C=function(e){if(e.sourceVisualContainer!==o){if(!(_.findIndex(f,(function(t){return t.sourceVisualContainer===e.sourceVisualContainer}))!==-1))return o=null,"break"}},x=0,S=s;x<S.length;x++){var y=S[x];if("break"===C(y))break}}return _.filter(i.visualContainers,(function(e){return e!==o}))}},i.prototype.newAndPreviousSelectionsSupportMultiVisualSelection=function(e,t){return!!this.supportsMultiVisualSelection(e)&&!(1===t.length&&!this.supportsMultiVisualSelection(t[0].sourceVisualContainer))},i.prototype.supportsMultiVisualSelection=function(e){var t=p.getVisualCapabilities(e,this.visualPlugins);return t&&t.supportsMultiVisualSelection},i.prototype.clearCrossHighlightOperation=function(e){if(e.crossFilterSource&&e.crossFilterSource.highlight)return this.setCrossHighlightOperation(null,null,e)},i.prototype.clearCrossDrillFromVisualContainersOperation=function(e,t){if(!_.isEmpty(t)){for(var r=[],i=0,n=t;i<n.length;i++){var o=n[i],a=this.updateCrossDrillFromVisualContainerOperation(e,o,!0);r=_.union(r,a)}return r}},i.prototype.updateCrossDrillFromVisualContainerOperation=function(e,t,r){var i,n=e.crossFilterSource&&e.crossFilterSource.drill,o=!1;if(!r){var a=this.collectVisualContainerDrillFilters(t);_.isEmpty(a)||(i={sourceVisualContainer:t,collectedFilters:a})}var s=_.findIndex(n,(function(e){return e.sourceVisualContainer===t}));if(s>=0?(o=!0,i?n[s]=i:n.splice(s,1)):i&&(o=!0,e.crossFilterSource||(e.crossFilterSource={}),(e.crossFilterSource.drill||(e.crossFilterSource.drill=[])).push(i)),o)return _.filter(e.visualContainers,(function(e){return e!==t}))},i.prototype.collectSelfFilter=function(e,t,r){var i,o=this;!t?(i=this.getFilterFromFilterPropertyInFilterContainer(r,(function(e){return o.tryGetSelfFilterProperty(e)})),i&&e.collectFilter(i,r,null,0,n.Self)):(i=this.getFilterFromFilterPropertyInVisualContainer(t,(function(e){return o.tryGetSelfFilterProperty(e)})),i&&e.collectFilter(i,null,t,0,n.Self))},i.prototype.collectCrossFilter=function(e,t,r){for(var i=this,o=0,a=t.visualContainers;o<a.length;o++){var s=a[o];if(s!==r){var l=this.getFilterFromFilterPropertyInVisualContainer(s,(function(e,t){return i.tryGetFilterPropertyIdentifier(e,t)}));l&&e.collectFilter(l,null,s,0,n.Slicer)}}},i.prototype.getFilterFromFilterPropertyUtil=function(t,r,i){var n=i(t,r&&r.visualType);if(n){var o=r.objects;if(o){return e.data.DataViewObjectDefinitions.getValue(o,n,null)}}},i.prototype.getFilterFromFilterPropertyInVisualContainer=function(e,t){var r=p.getVisualCapabilities(e,this.visualPlugins),i=e.config&&e.config.singleVisual;return this.getFilterFromFilterPropertyUtil(r,i,t)},i.prototype.getFilterFromFilterPropertyInFilterContainer=function(e,t){var r=p.getFilterCapabilities(e,this.visualPlugins),i=e.config&&e.config.singleVisual;return this.getFilterFromFilterPropertyUtil(r,i,t)},i.prototype.addHighlightFilter=function(e,t,r,i){var n=t.crossFilterSource&&t.crossFilterSource.highlight;if(!_.isEmpty(n)&&p.getVisualType(r)!==s.slicer.name)for(var o=0,a=n;o<a.length;o++){var l=a[o];if(l.sourceVisualContainer!==r){var u=this.buildHighlightFiltersForRelatedTargets(l,i,t);if(u){var c=this.relationshipService.relationshipFilterAction(t,l.sourceVisualContainer,r,i),d=p.getVisualCapabilities(r,this.visualPlugins);0===c&&(c=this.relationshipService.defaultFilterAction(l.sourceVisualContainer,r)),e.mergeHighlightFiltersBasedOnRelationship(u,c,!d.supportsHighlight)}}}},i.prototype.addCrossDrillFilters=function(e,t,i,n){var o=t.crossFilterSource&&t.crossFilterSource.drill;if(!_.isEmpty(o)){for(var a=[],s=0,l=o;s<l.length;s++){var u=l[s],c=u.sourceVisualContainer;if(this.relationshipService.shouldApplyCrossDrill(t,c,i,n)){var p=new r.FilterBuilder(c);p.addCollectedFilters(u.collectedFilters,!1,this.getShouldApplyDrillCrossFilter(c,n,t));var d=p.getUnmergedDrillCrossFilter();if(d)for(var f=function(t){e.addCrossFilter(t);var r=_.find(u.collectedFilters,(function(e){return e.filter===t.filter}));r&&a.push(r.filterContainer)},v=0,m=d;v<m.length;v++){var h=m[v];f(h)}}}return a}},i.prototype.buildHighlightFiltersForRelatedTargets=function(e,i,n){var o=new r.FilterBuilder(e.sourceVisualContainer);return e.selectorFilter&&o.setSelectorFilter({filter:e.selectorFilter,filterExpressionMetadata:e.filterExpressionMetadata,type:t.contracts.FilterType.Include}),o.addCollectedFilters(e.collectedFilters,!1,this.getShouldApplyHighlightFilter(e.sourceVisualContainer,i,n)),o.getCrossHighlightFilters()},i.prototype.getShouldApplyFilterContainerInputFilter=function(e,t,r,i){var n=this;return function(o,a,s){return n.shouldApplyFilterContainerInputFilter(o,a,s,e,t,r,i)}},i.prototype.shouldApplyFilterContainerInputFilter=function(e,t,r,i,n,o,s){if(t===i)return!0;if(!this.shouldApplyFilter(e,t,r,n,o,s))return!1;var l=t&&t.expression;return(!l||!c.isMeasure(l))&&!_.some(e.conditions(),(function(e){return 3===a.run(e)}))},i.prototype.getShouldApplyHighlightFilter=function(e,t,r){var i=this;return function(n,o,a){return i.shouldApplyHighlightFilter(n,o,a,e,t,r)}},i.prototype.getShouldApplyDrillCrossFilter=function(e,t,r){var i=this;return function(n,o,a){return i.shouldApplyDrillCrossFilter(n,o,a,e,t,r)}},i.prototype.shouldApplyHighlightFilter=function(e,t,r,i,n,o){return!!this.shouldApplyFilter(e,t,r,i,n,o)&&!_.some(e.conditions(),(function(e){return 1===a.run(e)}))},i.prototype.shouldApplyDrillCrossFilter=function(e,t,r,i,n,o){return!!this.shouldApplyFilterForCrossDrill(e,t,r,i,n,o)&&!_.some(e.conditions(),(function(e){return 1===a.run(e)}))},i.prototype.getShouldApplyFilter=function(e,t,r,i){var n=this;return void 0===i&&(i=!1),function(o,a,s){return n.shouldApplyFilter(o,a,s,e,t,r,i)}},i.prototype.shouldApplyFilter=function(e,t,r,i,n,o,a){var s=this;void 0===a&&(a=!1);var l=a?function(){return 1}:function(e,t,r,i){return s.relationshipService.relationshipFilterAction(e,t,r,i)};return this.shouldApplyFilterInternal(e,t,r,i,n,o,l)},i.prototype.shouldApplyFilterForCrossDrill=function(e,t,r,i,n,o){var a=this,s=function(e,t,r,i){return a.relationshipService.drillRelationshipFilterAction(e,t,r,i)};return this.shouldApplyFilterInternal(e,t,r,i,n,o,s)},i.prototype.shouldApplyFilterInternal=function(e,r,i,n,o,a,s){if(r&&t.FilterUtils.shouldDisableFilter(r,o,i,this.aggrOps,this.visualPlugins))return!1;if(!(_.isEmpty(e.validate(o,this.aggrOps))||i&&i===n))return!1;if(i&&n&&i!==n){if(3===s(a,i,n,o))return!1;var l=i.config.singleVisual.syncGroup,u=n.config.singleVisual.syncGroup;if(l&&u&&l.groupName===u.groupName)return!1}return!0},i.prototype.setMultipleFiltersOnSelectData=function(e,t,r){for(var i=this.clearCrossHighlightOperation(t),n=0,o=r;n<o.length;n++){var a=o[n];i=_.union(i,this.setCrossHighlightOperation(e,a.selection,t,!0,a.sourceVisualContainer,a.filterExpressionMetadata))}p.notifyVisualContainers(this.eventBridge,i,"UserAction_CrossHighlight")},i.prototype.setFilterOnSelectData=function(t,r,i,n,o,a){if(this.supportsFilterOutput(n))this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,i,"Data");else{var s=this.setCrossHighlightOperation(t,r,i,o,n,a);p.notifyVisualContainers(this.eventBridge,s,"UserAction_CrossHighlight")}},i.prototype.updateCrossFilterOnDrill=function(e,t){var r=this.updateCrossDrillFromVisualContainerOperation(e,t,!1);p.notifyVisualContainers(this.eventBridge,r)},i.prototype.updateCrossDrillFromVisualContainers=function(e,t){var r=this.updateCrossDrillFromVisualContainersOperation(e,t);p.notifyVisualContainers(this.eventBridge,r)},i.prototype.updateCrossDrillFromVisualContainersOperation=function(e,t){if(!_.isEmpty(t)){for(var r=[],i=0,n=t;i<n.length;i++){var o=n[i],a=this.updateCrossDrillFromVisualContainerOperation(e,o,!1);r=_.union(r,a)}return r}},i.prototype.updateCrossDrillOfSection=function(e){var t=this.updateCrossDrillOfSectionOperation(e);p.notifyVisualContainers(this.eventBridge,t)},i.prototype.updateCrossDrillOfSectionOperation=function(e){return this.updateCrossDrillFromVisualContainersOperation(e,e.visualContainers)},i.prototype.getDrillCrossFiltersToApply=function(e,t,i){var n=new r.FilterBuilder(t);return this.addCrossDrillFilters(n,e,t,i)},i.prototype.supportsFilterOutput=function(e){return t.FilterUtils.supportsFilterOutput(p.getVisualCapabilities(e,this.visualPlugins))},i.prototype.tryGetFilterPropertyIdentifier=function(e,r){return t.FilterUtils.tryGetFilterPropertyIdentifier(e,r,this.visualPlugins)},i.prototype.tryGetSelfFilterEnabledProperty=function(e){if(e)return o.findSelfFilterEnabled(e.objects)},i.prototype.tryGetSelfFilterProperty=function(e){if(e)return o.findSelfFilter(e.objects)},i.prototype.resolveFilterTargets=function(e,t,i,n,o){var a={dataRoles:i,mappings:n,queryProjections:t.projections,select:t.defn.select(),schema:e},s=new r.VisualFilterMappingResolver(a),l=t.defn;return o&&(l=l.addSemanticFilter(o)),s.resolveSemanticQuery(l)},i.prototype.applyFilterOutput=function(e){this.supportsFilterOutput(e)&&p.notifyVisualContainersExceptSource(this.eventBridge,e)},i})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=e.data.DataViewObjectDefinition,o=e.data.DataViewObjectDefinitions,a=e.explore.contracts.VisualContainer,s=e.explore.contracts.VisualContainerGroup;!(function(e){function i(e){return"visualContainer"===e.canvasItemType}function l(e){return"group"===e.canvasItemType}function u(e,i){var n=r.selectionUtils.getSelectedCanvasItem(e);if(n){if(t.contracts.isVisualContainer(n)){var o=n,a=o.config.singleVisual.visualType;if(i.isCustomVisual(a))return;var s=o.config.singleVisual,l={canvasItemType:"visualContainer",visualType:s.visualType,objects:s.objects,vcObjects:s.vcObjects};return l}var u=n,l={canvasItemType:"group",objects:u.objects};return l}}function c(e,n,o){var a=r.selectionUtils.getSelectedCanvasItem(e);if(a&&o){if(t.contracts.isVisualContainer(a)){if(i(o))p(n,o,a);else if(l(o)){var s=a.config.singleVisual;s.vcObjects=d(f,v,o.objects,s.objects)}}else i(o)?t.contracts.traverseVisualContainerGroups([a],(function(e){t.contracts.isVisualContainer(e)&&p(n,o,e)})):l(o)&&(a.objects=d(v,v,o.objects,a.objects));return a}}function p(e,t,r){var i=r.config.singleVisual,n=e.capabilities(i.visualType),o=e.capabilities(t.visualType);n&&o&&(i.objects=d(n.objects,o.objects,t.objects,i.objects)),i.vcObjects=d(f,f,t.vcObjects,i.vcObjects)}function d(e,t,r,i){if(r===i)return i;i=i||{};for(var a in e){var s=e[a],l=t[a];if(l&&!s.suppressFormatPainterCopy&&!l.suppressFormatPainterCopy){var u=r&&r[a],c=i&&i[a];for(var p in s.properties){var d=s.properties[p],f=l.properties[p];if(f&&!d.suppressFormatPainterCopy&&!f.suppressFormatPainterCopy&&_.isEqual(d.type,f.type)){if(c)for(var v=0,m=c;v<m.length;v++){var h=m[v];n.deleteSingleProperty(h,p)}if(u)for(var g=0,y=u;g<y.length;g++){var h=y[g];if(h.properties[p]){var C=o.ensure(i,a,h.selector);C.properties[p]=h.properties[p]}}}}}}return o.reduce(i)}e.isVisualContainerFormat=i,e.isGroupFormat=l,e.copyFormatCanvasItem=u;var f=a.CommonObjectDescriptors,v=s.objectDescriptors;e.pasteFormatCanvasItem=c})(i=r.FormatPainter||(r.FormatPainter={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,o,s,l,u,c){return new a(e,t,r,i,n,o,s,l,u,c)}var n=t.contracts.DataSource,o=e.explore.util.VisualContainerUtils;r.createModelChangeHandler=i;var a=(function(){function t(e,t,i,n,o,a,s,l,u,c){var p=this;this.conceptualSchemaProxy=e,this.dataProxy=t,this.dataSources=i,this.eventBridge=n,this.globalEventBridge=o,this.undoRedoService=a,this.visualPluginService=s,this.promiseFactory=l,this.uiBlockingService=u,this.visualTimeSynchronizationService=c,this.handlerTokens=[],this.subscriptionManager=n.createChannelSubscriptionManager().subscribe(r.events.explorationLoaded,(function(e,t){return p.currentExplorationContract=t}))}return t.prototype.onDestroy=function(){this.subscriptionManager.unsubscribeAll()},t.prototype.applyChange=function(t){var i=this,a=t.providerType;a||(a="dsr");var s=this.dataSources.get();if(n.referenced(s,null)){var l=n.dataReaderDataSources(n.queried(s,null)),u=this.conceptualSchemaProxy,c=this.dataProxy;u.stopCommunication(new e.IgnorableClientError("ModelChangeHandler.applyChange rejects current conceptualSchemaProxy.get promises")),u.clearCache(),c.stopCommunication(a);var p=_.find(s,(function(e){return!n.isExtension(e)}));p&&this.globalEventBridge.publishToChannel(e.explore.services.events.modelChangeApplyingUpdate,p),t.change.then((function(n){var s=n.result;s.hasQueryImpact&&(c.clearCache(a,l),i.currentExplorationContract&&o.clearExplorationQueryCaches(i.currentExplorationContract));var u;s&&(u=s.changes)&&!_.isEmpty(u)&&(s.hasQueryImpact||"dsr"!==a||e.data.dsr.createQueryCacheHandler().apply(c,l,u),i.currentExplorationContract&&r.createSchemaChangeHandler(i.visualPluginService).apply(i.currentExplorationContract,u)),i.conceptualSchemaProxy.resumeCommunication();var p=[];try{for(var d=0,f=i.handlerTokens;d<f.length;d++){var v=f[d];p.push(v.handle(s))}}finally{i.promiseFactory.all(p).finally((function(){i.visualTimeSynchronizationService.setAnchorTimeToNow(),i.dataProxy.resumeCommunication(a),t.leaveUndo||(i.undoRedoService.canUndo()||i.undoRedoService.canRedo())&&(i.undoRedoService.clear(),i.eventBridge.publishToChannel(r.events.undoRedoStackCleared)),i.uiBlockingService.beginBlockUI();var e=i.eventBridge;e.publishToChannelAsync(r.events.modelChanged,s).finally((function(){i.uiBlockingService.endBlockUI()})),e.publishToChannel(r.events.visualContainerChanged,{affectContainer:function(){return!0},cacheResponseOnServer:t.cacheResponseOnServer,sourceLabelKey:"UserAction_ChangeModel"}),n.onModelChangeHandlingComplete&&n.onModelChangeHandlingComplete.resolve()}))}}),(function(){return i.resumeCommunication(a)}))}},t.prototype.register=function(e){var t=this,r={handle:e,stopHandling:function(){var e=t.handlerTokens.indexOf(r);e>-1&&t.handlerTokens.splice(e,1)}};return this.handlerTokens.push(r),r},t.prototype.resumeCommunication=function(e){this.conceptualSchemaProxy.resumeCommunication(),this.dataProxy.resumeCommunication(e)},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createRunningVisualService=t;var r=(function(){function e(){this.runningVisuals={}}return e.prototype.getVisual=function(e){var t=this.runningVisuals[e.name];return t&&t.visual},e.prototype.setVisual=function(e,t){this.runningVisuals[e.name]={contract:e,visual:t}},e.prototype.removeVisual=function(e){delete this.runningVisuals[e.name]},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createServicePauser=t;var r=(function(){function e(){this.isPaused=!1}return e.prototype.register=function(e){var t=jQuery.extend(!0,{},e);return this.updateService(t),t},e.prototype.pause=function(){this.isPaused=!0},e.prototype.resume=function(){this.isPaused=!1},e.prototype.updateService=function(e){var t=function(t){if(_.isFunction(e[t])){var i=e[t],n=r;e[t]=function(){if(!n.isPaused)return i.apply(e,arguments)}}},r=this;for(var i in e)t(i)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new u(e,t,r,i,n)}var i=e.data.DataViewObjectDefinitions,n=e.visualHost.ResourcePackageReferenceResolver,o=e.visualHost.utils.ResourcePackageUtils,a=e.data.SQExpr,s=jsCommon.UrlUtils;t.createStaticResourceReferenceService=r;var l;!(function(e){function t(e,t,r,s){e&&i.visitPropertyExprs({definitions:e,descriptors:t,visitor:function(e){if(a.isResourcePackageItem(e)){var t=o.findResourcePackage(r,e.packageType,e.packageName),i=o.findItemInPackage(t,e.itemName);i&&n(s,t.name,t.type,i.name,i.type)}}})}function r(e,t,r){return e[t]||(e[t]={items:{},name:t,type:r}),e[t]}function n(e,t,i,n,o){var a=r(e,t,i).items;return a[n]=a[n]||{name:n,type:o}}function s(e,t,r){var i=e[t];return i&&i.items&&i.items[r]}function l(e,t,r){var i=e[t];if(i){var n=i.items;delete n[r],0===_.size(n)&&delete e[t]}}function u(e,t){for(var r in e){var i=e[r];for(var n in i.items)t(i,i.items[n])}}e.addObjectsReferences=t,e.ensurePackageReference=r,e.addItemReference=n,e.findItem=s,e.eraseItem=l,e.visitItemReferences=u})(l=t.StaticResourceReferences||(t.StaticResourceReferences={}));var u=(function(){function e(e,t,r,i,n){this.promiseFactory=e,this.resourceLoader=t,this.explorationNavigation=r,this.explorationSerializer=i,this.resourceRegistration=n,this.restorableReferenceSources=[],this.preservedReferences={}}return e.prototype.addReferenceSource=function(e){this.restorableReferenceSources.push(e)},e.prototype.removeReferenceSource=function(e){_.pull(this.restorableReferenceSources,e)},e.prototype.garbageCollectUnreferencedStaticResources=function(){var e=this.explorationNavigation.getCurrentExploration(),t=e&&e.resourcePackages;if(t){for(var r=this.explorationSerializer.getReferencedStaticResources(e),i=this.getRestorableReferences(),n=[],a=t.length-1;a>=0;a--){var s=t[a];o.isStaticResource(s)&&(this.garbageCollectItems(s,r,this.preservedReferences,i,n),_.isEmpty(s.items)&&_.pull(t,s))}return _.isEmpty(t)&&delete e.resourcePackages,this.cleanPreservedReferences(r,i),n}},e.prototype.cleanPreservedReferences=function(e,t){var r=this;l.visitItemReferences(this.preservedReferences,(function(i,n){!l.findItem(e,i.name,n.name)&&l.findItem(t,i.name,n.name)||l.eraseItem(r.preservedReferences,i.name,n.name)}))},e.prototype.getRestorableReferences=function(){for(var e={},t=0,r=this.restorableReferenceSources;t<r.length;t++){var i=r[t];l.visitItemReferences(i.getReferences(),(function(t,r){l.addItemReference(e,t.name,t.type,r.name,r.type)}))}return e},e.prototype.garbageCollectItems=function(e,t,r,i,n){for(var o=e.items,a=e.name,s=_.size(o)-1;s>=0;s--){var u=o[s],c=u.name;l.findItem(t,a,c)||(l.findItem(i,a,c)&&this.preserveItem(e,c,u.type),n.push(a+"/"+u.path),_.pull(o,u))}},e.prototype.preserveItem=function(e,t,r){var i=l.addItemReference(this.preservedReferences,e.name,e.type,t,r);i.uri||(i.uri=n.loadAndResolveContent(e,t,this.resourceLoader,this.promiseFactory).then((function(e){return s.isDataUri(e)||(e=s.makeJsonDataUri(e)),e})))},e.prototype.loadItemsContent=function(e){var t=[],r=this.explorationNavigation.getCurrentExploration(),i=r&&r.resourcePackages;for(var o in e){var a=e[o];if(1===a.type){var s=a.items,l=function(e){var r=s[e];t.push(n.loadRegisteredResourceAsDataUri(u.promiseFactory,u.resourceLoader,i,r.name).then((function(e){r.content=e})))},u=this;for(var c in s)l(c)}}return this.promiseFactory.all(t).then((function(){}))},e.prototype.addItemsContent=function(e){var t=this.explorationNavigation.getCurrentExploration();for(var r in e){var i=e[r],n=i.items;for(var o in n){var a=n[o];this.addResource(t.resourcePackages,r,i.type,a.name,a.type,a.content)}}},e.prototype.needingRestore=function(e){var t=this;if(!_.isEmpty(e)){var r=this.explorationNavigation.getCurrentExploration();if(r){var i=r&&r.resourcePackages;if(!_.isEmpty(i)){var n={};return l.visitItemReferences(e,(function(e,r){var a=e.name,s=r.name,u=l.findItem(t.preservedReferences,a,s);if(u&&!o.findItemInPackages(i,e.type,r.name,a)){l.ensurePackageReference(n,a,e.type).items[s]=u}})),n}}}},e.prototype.addResource=function(e,t,r,i,n,a){o.findItemInPackages(e,r,i,t)||this.resourceRegistration.add(i,r,n,{content:a,skipUniqueName:!0})},e.prototype.restoreReferences=function(e){var t=this,r=this.needingRestore(e),i=[];return l.visitItemReferences(r,(function(e,r){i.push(r.uri.then((function(i){t.resourceRegistration.restore(r.name,e.type,r.type,i)})))})),this.promiseFactory.all(i).then((function(){}))},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new u(e,t,r,i)}var i=jsCommon.FileUtils,n=e.visualHost.ResourcePackageReferenceResolver,o=e.explore.util.ResourcePackageUtils,a=e.visualHost.utils.ResourcePackageUtils,s=e.data.SQExprBuilder,l=jsCommon.UrlUtils;t.createResourceRegistrationService=r;var u=(function(){function e(e,t,r,i){this.explorationNavigationService=e,this.promiseFactory=t,this.resourceLoader=r,this.resourcePublishingService=i}return e.prototype.addResource=function(e,t,r,i){var u,c=this;if(1===e.type?u={type:r,path:t,name:t,content:i}:2===e.type&&(a.findItemInPackage(e,t)||(u=o.newSharedResourceItem(t,r,i))),u){e.items.push(u);var p=void 0;p=_.isEmpty(i)?n.loadAndResolveContent(e,t,this.resourceLoader,this.promiseFactory).then((function(e){return l.isDataUri(e)||(e=l.utoa(e)),e})):this.promiseFactory.resolve(l.getBase64ContentFromDataUri(i)),p.then((function(t){c.resourcePublishingService.publish(e.name,u.path,t)}))}return s.resourcePackageItem(e.name,e.type,t)},e.prototype.restore=function(e,t,r,i){var n=this.ensureResourcePackageExists(t);_.find(n.items,(function(t){return t.name===e}))||this.addResource(n,e,r,i)},e.prototype.add=function(e,t,r,i){var n=this.ensureResourcePackageExists(t);return 1!==t||i&&i.skipUniqueName||(e=this.getUniqueName(e,n)),this.addResource(n,e,r,i&&i.content)},e.prototype.getUniqueName=function(e,t){var r=e.replace(/[^a-zA-Z0-9:@\-._~!$&'()*+,;=]/g,"_"),n=i.getFileWithoutExtension(r),o=i.getFileExtension(r);o&&(o="."+o),n=n.substr(0,30),o=o.substr(0,11);for(var a;;){if(a=n+Math.random().toString().substr(2)+o,!_.find(t.items,(function(e){return e&&e.name&&e.name.toUpperCase()===a.toUpperCase()})))break}return a},e.prototype.ensureResourcePackageExists=function(e){var t=this.explorationNavigationService.getCurrentExploration();return o.ensureResourcePackageType(t,e)},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(t){function r(e){return Math.round(100*jsCommon.PixelConverter.toPoint(e))/100}function i(e){switch(typeof e){case"string":e=+e;case"number":return r(e);default:return e}}function n(e){e&&(e.objects&&a(e.objects),e.vcObjects&&p(e.vcObjects))}function o(t){t&&t.objects&&t.visualType===e.visuals.plugins.textbox.name&&c(t.objects)}function a(e){if(e)for(var r=0,i=t.visualPropertiesToUpdate;r<i.length;r++){var n=i[r];s(e,n)}}function s(e,t){var r=l(e,t.objectName);if(r){var i=r[t.propertyName];if(i)if(u(i))r[t.propertyName]=f(i);else{var n=h.deserializeExpr(i.expr);r[t.propertyName]=d(f(n))}}}function l(e,t){if(e){var r=e[t];if(r)for(var i=0,n=r;i<n.length;i++){var o=n[i];if(null==o.selector)return o.properties}}}function u(t){return t instanceof e.data.SQExpr&&e.data.SQExpr.isConstant(t)}function c(e){if(e){var t=l(e,"general");if(t)for(var i=t.paragraphs,n=0,o=i;n<o.length;n++)for(var a=o[n],s=0,u=a.textRuns;s<u.length;s++){var c=u[s];if(c.textStyle&&c.textStyle.fontSize){var p=c.textStyle.fontSize,d=p.indexOf("px");if(d!==-1){var f=+p.substr(0,d);c.textStyle.fontSize=r(f)+"pt"}}}}}function p(e){if(e){var t=e.visualTooltip&&e.visualTooltip[0]&&e.visualTooltip[0].properties;if(t){var r=t.fontSize;if(r)if(u(r))t.fontSize=f(r);else{var i=h.deserializeExpr(r.expr);t.fontSize=d(f(i))}}}}function d(e){return{expr:h.serializeExpr(e)}}function f(e){var t=e.value,i=r(t);return g.decimal(i)}function v(e){var t=h.deserializeExpr(e.expr),r=+t.value,i=m(r);return{expr:h.serializeExpr(g.decimal(i))}}function m(e){return Math.round(100*jsCommon.PixelConverter.fromPointToPixel(e))/100}var h=e.data.services.SemanticQuerySerializer,g=e.data.SQExprBuilder;t.pxToPt=r,t.pxToPtUpgrader=i,t.updateSingleVisualConfigPxToPt=n,t.updateSingleVisualConfigTextboxPxToPt=o,t.visualPropertiesToUpdate=[{objectName:"valueAxis",propertyName:"fontSize"},{objectName:"valueAxis",propertyName:"titleFontSize"},{objectName:"valueAxis",propertyName:"secFontSize"},{objectName:"valueAxis",propertyName:"secTitleFontSize"},{objectName:"categoryAxis",propertyName:"fontSize"},{objectName:"categoryAxis",propertyName:"titleFontSize"}],t.visualContainerPropertiesToUpdate=[{objectName:"visualTooltip",propertyName:"fontSize"}],t.upgradePropertyFromPxToPt=s,t.toExpr=d,t.pxToPtExpr=f,t.ptToPxWireExpr=v,t.ptToPx=m})(r=t.UpgradeUtils||(t.UpgradeUtils={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(r){function i(t){return e.explore.util.ThemeUtils.baseThemeVersions[t]||f.v3_6}function n(e,t){var r=S[e.kind]||y.ZeroStr,i=new b(r);e.accept(i),r=i.highestVersion;var n=t;return n&&n.fill&&n.fill.solid&&n.fill.solid.color&&(r=y.max(r,o(e))),r}function o(e){if(g.isFillRule(e)&&e.input&&!g.isSelectRef(e.input))return E.ConditionalFormattingSource;if(g.isConditional(e)){var t=function(e){return g.isCompare(e)&&!g.isSelectRef(e.left)},r=function(e){return!!t(e)||!(!g.isAnd(e)||!t(e.left)&&!t(e.right))};if(_.some(e.cases,(function(e){return r(e.condition)})))return E.ConditionalFormattingSource}return g.isMeasure(e)||g.isAggregation(e)?E.ConditionalFormattingByValue:y.ZeroStr}function a(e){if(e&&!_.isEmpty(e.data)&&1===e.data.length&&m.isWildcard(e.data[0]))return e.data[0].matchingOption;
}function s(e){if(e instanceof h)return!!_.find(w,(function(t){return t===e.value}));if(e instanceof Object&&!(e instanceof Function))for(var t=Object.keys(e),r=0,i=t;r<i.length;r++){var n=i[r];if(s(e[n]))return!0}return!1}function l(e,t,r){return{added:p(e),renamed:u(t),updated:r}}function u(e){for(var t={},r=0,i=e.length;r<i;r++){var n=e[r];if(null!=n.types)for(var o=0,a=n.types;o<a.length;o++){var s=a[o];c(s,n,t)}else{c(v,n,t);for(var s in t)c(s,n,t)}}return t}function c(e,t,r){var i=r[e];r[e]||(i=r[e]={});var n=t.currentId.objectName,o=i[n];o||(o=i[n]={});var a=t.previousId,s=function(e,t){var r=e&&e[t.objectName];return r&&r[t.propertyName]},l=s(i,a)||s(r[v],a);o[t.currentId.propertyName]=__assign({},t,{previous:l})}function p(e){for(var t={},r=0;r<e.length;r++){var i=e[r];if(null!=i.types)for(var n=0,o=i.types;n<o.length;n++){var a=o[n];d(a,i,t)}else d(v,i,t)}return t}function d(e,t,r){var i=r[e];r[e]||(i=r[e]={});var n=t.property.objectName,o=i[n];o||(o=i[n]={});var a=t.property.propertyName,s=o[a];s||(s=o[a]=[]),s.push(t)}var f,v=e.data.ObjectPropertyVersionWildcard,m=e.data.Selector,h=e.data.SQConstantExpr,g=e.data.SQExpr,y=jsCommon.Version,C=t.contracts.VisualLink,x=t.contracts.VisualTooltip;!(function(e){e.v1_0="1.0",e.v2_0="2.0",e.v2_2="2.2",e.v2_3="2.3",e.v2_5="2.5",e.v3_0="3.0",e.v3_1="3.1",e.v3_2="3.2",e.v3_3="3.3",e.v3_4="3.4",e.v3_5="3.5",e.v3_6="3.6",e.v3_6_1="3.6.1",e.v3_7="3.7",e.v3_8="3.8",e.v3_9="3.9",e.v3_10="3.10",e.v3_11="3.11",e.v3_12="3.12",e.v3_12_1="3.12.1",e.v3_13="3.13",e.v3_14="3.14",e.v3_14_1="3.14.1",e.v3_15="3.15",e.v3_16="3.16",e.v3_17="3.17",e.v3_18="3.18",e.v3_19="3.19",e.v3_20="3.20",e.v3_21="3.21",e.v3_22="3.22",e.v3_23="3.23",e.v3_24="3.24",e.v4_0="4.0",e.v4_1="4.1",e.v4_2="4.2",e.v5_0="5.0",e.v5_1="5.1",e.v5_2="5.2",e.v5_3="5.3",e.v5_4="5.4",e.v5_5="5.5",e.v5_6="5.6",e.v5_7="5.7",e.v5_8="5.8",e.v5_9="5.9"})(f=r.ExplorationVersions||(r.ExplorationVersions={}));var S={};S[42]=f.v3_7,S[33]=f.v3_8,r.getVersionForBaseTheme=i;var b=(function(e){function t(t){var r=e.call(this)||this;return r.highestVersion=t,r}return __extends(t,e),t.prototype.visitAllRolesRef=function(t){this.highestVersion=y.max(this.highestVersion,f.v5_1),e.prototype.visitAllRolesRef.call(this,t)},t.prototype.visitRangePercent=function(t){this.highestVersion=y.max(this.highestVersion,f.v5_1),e.prototype.visitRangePercent.call(this,t)},t})(e.data.DefaultSQExprVisitorWithTraversal);r.getVersionForSQExpr=n;var E;!(function(e){e.bookmarks=f.v3_6,e.visualHidden=f.v3_6,e.slowDataSource=f.v3_7,e.ExplorationState_v1_1=f.v3_8,e.description=f.v3_8,e.BookmarkOptions=f.v3_8,e.SectionCrossDrill=f.v3_8,e.SectionVisibility=f.v3_9,e.ExplorationState_v1_2=f.v3_10,e.VisualSyncGroup=f.v3_11,e.ExplorationSettings=f.v3_11,e.CanvasTooltips=f.v3_12,e.ActionButton=f.v3_13,e.QnaLink=f.v3_13,e.ConditionalFormattingSource=f.v3_14,e.MeasureDrillthrough=f.v3_14,e.OutspaceFormatting=f.v3_15,e.StylableVisualContainerHeader=f.v3_15,e.BookmarkGroup=f.v3_17,e.ConditionalFormattingByValue=f.v3_17,e.BuiltInThemes=f.v3_18,e.DotPlotVisual=f.v3_18,e.ExportDataMode=f.v3_19,e.ExpandCollapse=f.v3_20,e.CartesianConditionalFormatting=f.v3_20,e.FilterContainerVisibilityControl=f.v3_20,e.OutspacePaneFormatting=f.v3_20,e.ExplorationState_v1_3=f.v3_20,e.NewFilterPaneExperience=f.v3_20,e.VisualTabOrders=f.v3_21,e.VisualLinkTooltip=f.v3_21,e.FilterRequireSingleSelect=f.v3_21,e.DefaultFilterAction=f.v3_22,e.KeyDriversVisual=f.v3_22,e.TitleWordWrap=f.v3_22,e.VisualBorderRadius=f.v3_22,e.WebUrlAction=f.v3_23,e.StrictSingleSelect=f.v3_23,e.DefaultTooltipFormatting=f.v3_23,e.DisplayAreaVerticalAlignment=f.v3_23,e.FilterContainerFilterMetadata=f.v3_23,e.FiltersSort=f.v3_23,e.CrossReportDrillthrough=f.v3_24,e.AllowChangeFilterTypes=f.v3_24,e.RenameFilters=f.v3_24,e.ExpressionBoundVisualTitles=f.v4_0,e.ColorConditionalFormatting=f.v4_2,e.VisualLevelSlicerFilters=f.v4_2,e.GaugeConditionalFormatting=f.v4_2,e.VisualHeaderTooltip=f.v4_2,e.ExplorationState_v1_4=f.v4_2,e.ReportAnnotations=f.v4_2,e.ExpressionBoundVisualBackground=f.v5_0,e.KeyDriversCounting=f.v5_1,e.KeyDriversDetails=f.v5_2,e.MigrateFilterPaneExperience=f.v5_2,e.VisualContainerGrouping=f.v5_2,e.ExpressionBoundBorderColor=f.v5_3,e.ExpressionBoundAltText=f.v5_3,e.ExpressionBoundGaugeColors=f.v5_3,e.AutomaticPageRefresh=f.v5_4,e.ExpressionBoundActions=f.v5_5,e.AdditionalKPISettings=f.v5_6,e.FilterPaneSearchBoxFormatting=f.v5_7,e.DisableFilterPaneSearch=f.v5_8,e.DecompTreeBarsPerLevel=f.v5_8,e.HierarchicalSlicer=f.v5_8,e.LineChartDualAxis=f.v5_8,e.ChangeDetectionRefresh=f.v5_9,e.FilterPaneHiddenInEditMode=f.v5_9,e.AllowInlineExploration=f.v5_9,e.RelativeTimeFilter=f.v5_9,e.LinguisticSchemaSyncVersion=f.v5_9,e.ApplyAll=r.CurrentExplorationVersion,e.VisualFilterExpressionMetadata=r.CurrentExplorationVersion,e.NarrativeVisual=r.CurrentExplorationVersion,e.DecompositionInsights=r.CurrentExplorationVersion})(E=r.ExplorationFeatureVersions||(r.ExplorationFeatureVersions={})),r.DefaultCategoryColorVisualsToUpgrade=["barChart","clusteredBarChart","clusteredColumnChart","columnChart","comboChart","dataDotClusteredColumnComboChart","dataDotStackedColumnComboChart","funnel","hundredPercentStackedBarChart","hundredPercentStackedColumnChart","lineStackedColumnComboChart","lineClusteredColumnComboChart","map","filledMap","shapeMap","scatterChart"],r.AddedObjectPropertyVersions=[{property:{objectName:"general",propertyName:"altText"},version:f.v3_1},{property:{objectName:"visualLink",propertyName:"type"},version:f.v3_5},{property:{objectName:"visualLink",propertyName:"type",matchByContents:function(e){return e.value===C.Bookmark}},version:E.bookmarks},{property:{objectName:"labels",propertyName:"enableBackground"},version:f.v3_9},{property:{objectName:"labels",propertyName:"backgroundColor"},version:f.v3_9},{property:{objectName:"labels",propertyName:"backgroundTransparency"},version:f.v3_9},{property:{objectName:"categoryLabels",propertyName:"labelEnableBackground"},version:f.v3_9},{property:{objectName:"categoryLabels",propertyName:"labelBackgroundColor"},version:f.v3_9},{property:{objectName:"categoryLabels",propertyName:"labelBackgroundTransparency"},version:f.v3_9},{property:{objectName:"dateRange",propertyName:"anchorDate"},version:f.v3_9},{property:{objectName:"categoryAxis",propertyName:"maxMarginFactor"},version:f.v3_9},{property:{objectName:"categoryAxis",propertyName:"innerPadding"},version:f.v3_9},{property:{objectName:"columnFormatting",propertyName:"labelDisplayUnits"},version:f.v3_12},{property:{objectName:"columnFormatting",propertyName:"labelPrecision"},version:f.v3_12},{property:{objectName:"visualTooltip",propertyName:"type",matchByContents:function(e){return e.value===x.Canvas}},version:E.CanvasTooltips},{property:{objectName:"lineStyles",propertyName:"lineStyle"},version:f.v3_13,types:[e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name]},{property:{objectName:"legend",propertyName:"legendMarkerRendering"},version:f.v3_13,types:[e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name]},{property:{objectName:"legend",propertyName:"defaultToCircle"},version:f.v3_13,types:[e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name]},{property:{objectName:"legend",propertyName:"matchLineColor"},version:f.v3_13,types:[e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.lineStackedColumnComboChart.name]},{property:{objectName:"visualLink",propertyName:"type",matchByContents:function(e){return e.value===C.Qna}},version:E.QnaLink},{property:{objectName:"labels",propertyName:"funnelLabelStyle"},version:f.v3_14,types:[e.visuals.plugins.funnel.name]},{property:{objectName:"dataPoint",propertyName:"fillRule",matchByContents:s},version:f.v3_15},{property:{objectName:"values",propertyName:"backColor",matchByContents:s},version:f.v3_15},{property:{objectName:"values",propertyName:"fontColor",matchByContents:s},version:f.v3_15},{property:{objectName:"outspace",propertyName:v},version:E.OutspaceFormatting,types:["page"]},{property:{objectName:"visualHeader",propertyName:v},version:E.StylableVisualContainerHeader},{property:{objectName:"visualTooltip",propertyName:"show"},version:f.v3_16},{property:{objectName:"categoryAxis",propertyName:"axisType",matchByContents:function(t){return t.value===e.visuals.axisType.categorical}},version:E.DotPlotVisual,types:[e.visuals.plugins.scatterChart.name]},{property:{objectName:"searchBox",propertyName:v},version:f.v3_19,types:[e.visuals.plugins.slicer.name]},{property:{objectName:"rowHeaders",propertyName:"showExpandCollapseButtons"},version:E.ExpandCollapse,types:[e.visuals.plugins.pivotTable.name]},{property:{objectName:"dataPoint",propertyName:"fill",matchByContents:function(e,t){return t&&t.data&&1===t.data.length&&m.isWildcard(t.data[0])}},version:E.CartesianConditionalFormatting,types:r.DefaultCategoryColorVisualsToUpgrade},{property:{objectName:"filterCard",propertyName:v},version:E.OutspacePaneFormatting,types:["page"]},{property:{objectName:"outspacePane",propertyName:v},version:E.OutspacePaneFormatting,types:["page"]},{property:{objectName:"outspacePane",propertyName:"expanded"},version:E.OutspacePaneFormatting,types:["report"]},{property:{objectName:"outspacePane",propertyName:"visible"},version:E.OutspacePaneFormatting,types:["report"]},{property:{objectName:"visualLink",propertyName:"tooltip"},version:E.VisualLinkTooltip},{property:{objectName:"general",propertyName:"requireSingleSelect"},version:E.FilterRequireSingleSelect,types:["filter"]},{property:{objectName:"title",propertyName:"titleWrap"},version:E.TitleWordWrap},{property:{objectName:"border",propertyName:"radius"},version:E.VisualBorderRadius},{property:{objectName:"visualLink",propertyName:"webUrl"},version:E.WebUrlAction},{property:{objectName:"selection",propertyName:"strictSingleSelect"},version:E.StrictSingleSelect,types:[e.visuals.plugins.slicer.name]},{property:{objectName:"visualTooltip",propertyName:"fontColor"},version:E.DefaultTooltipFormatting},{property:{objectName:"visualTooltip",propertyName:"fontSize"},version:E.DefaultTooltipFormatting},{property:{objectName:"visualTooltip",propertyName:"fontFamily"},version:E.DefaultTooltipFormatting},{property:{objectName:"visualTooltip",propertyName:"background"},version:E.DefaultTooltipFormatting},{property:{objectName:"visualTooltip",propertyName:"transparency"},version:E.DefaultTooltipFormatting},{property:{objectName:"displayArea",propertyName:"verticalAlignment"},version:E.DisplayAreaVerticalAlignment,types:["page"]},{property:{objectName:"section",propertyName:"verticalAlignment"},version:E.DisplayAreaVerticalAlignment,types:["report"]},{property:{objectName:"title",propertyName:"text",isExprBound:!0},version:E.ExpressionBoundVisualTitles},{property:{objectName:"indicator",propertyName:"fontSize"},version:f.v4_1,types:[e.visuals.plugins.kpi.name]},{property:{objectName:"labels",propertyName:"labelPosition"},version:f.v4_1,types:[e.visuals.plugins.lineChart.name]},{property:{objectName:"title",propertyName:"fontColor",matchByContents:function(e,t){var r=e,i=r&&r.solid&&r.solid.color;return!(g.isConstant(i)||g.isThemeDataColor(i))}},version:E.ColorConditionalFormatting},{property:{objectName:"title",propertyName:"background",matchByContents:function(e,t){var r=e,i=r&&r.solid&&r.solid.color;return!(g.isConstant(i)||g.isThemeDataColor(i))}},version:E.ColorConditionalFormatting},{property:{objectName:"labels",propertyName:"color",matchByContents:function(e,t){var r=e,i=r&&r.solid&&r.solid.color;return!(g.isConstant(i)||g.isThemeDataColor(i))}},version:E.ColorConditionalFormatting,types:[e.visuals.plugins.card.name]},{property:{objectName:"categoryLabels",propertyName:"color",matchByContents:function(e,t){var r=e,i=r&&r.solid&&r.solid.color;return!(g.isConstant(i)||g.isThemeDataColor(i))}},version:E.ColorConditionalFormatting,types:[e.visuals.plugins.card.name]},{property:{objectName:"subTotals",propertyName:"rowSubtotalsLabel"},types:[e.visuals.plugins.pivotTable.name],version:f.v4_2},{property:{objectName:"subTotals",propertyName:"columnSubtotalsLabel"},types:[e.visuals.plugins.pivotTable.name],version:f.v4_2},{property:{objectName:"subTotals",propertyName:"levelSubtotalLabel"},types:[e.visuals.plugins.pivotTable.name],version:f.v4_2},{property:{objectName:"total",propertyName:"label"},types:[e.visuals.plugins.tableEx.name],version:f.v4_2},{property:{objectName:"visualHeader",propertyName:"showTooltipButton"},version:E.VisualHeaderTooltip},{property:{objectName:"visualHeaderTooltip",propertyName:"section"},version:E.VisualHeaderTooltip},{property:{objectName:"visualHeaderTooltip",propertyName:"text"},version:E.VisualHeaderTooltip},{property:{objectName:"visualHeaderTooltip",propertyName:"titleFontColor"},version:E.VisualHeaderTooltip},{property:{objectName:"visualHeaderTooltip",propertyName:"fontSize"},version:E.VisualHeaderTooltip},{property:{objectName:"visualHeaderTooltip",propertyName:"fontFamily"},version:E.VisualHeaderTooltip},{property:{objectName:"visualHeaderTooltip",propertyName:"background"},version:E.VisualHeaderTooltip},{property:{objectName:"visualHeaderTooltip",propertyName:"transparency"},version:E.VisualHeaderTooltip},{property:{objectName:"dataPoint",propertyName:"fill",matchByContents:function(e,t){var r=e;return!g.isConstant(r&&r.solid&&r.solid.color)}},version:E.GaugeConditionalFormatting,types:[e.visuals.plugins.gauge.name]},{property:{objectName:"background",propertyName:"color",matchByContents:function(e,t){var r=e,i=r&&r.solid&&r.solid.color;return!(g.isConstant(i)||g.isThemeDataColor(i))}},version:E.ExpressionBoundVisualBackground},{property:{objectName:"keyDrivers",propertyName:"allowKeyDriversCounting",matchByContents:function(e){return e.value===!0}},version:E.KeyDriversCounting},{types:[e.visuals.plugins.pivotTable.name,e.visuals.plugins.tableEx.name],property:{objectName:"values",propertyName:"icon"},version:f.v5_1},{property:{objectName:"text",propertyName:"fontFamily"},types:[e.visuals.plugins.textbox.name],version:f.v5_3},{property:{objectName:"text",propertyName:"fontSize"},types:[e.visuals.plugins.textbox.name],version:f.v5_3},{property:{objectName:"text",propertyName:"color"},types:[e.visuals.plugins.textbox.name],version:f.v5_3},{property:{objectName:"general",propertyName:"altText",isExprBound:!0},version:E.ExpressionBoundAltText},{property:{objectName:"border",propertyName:"color",isExprBound:!0},version:E.ExpressionBoundBorderColor},{property:{objectName:"dataPoint",propertyName:"target",isExprBound:!0},version:E.ExpressionBoundGaugeColors,types:[e.visuals.plugins.gauge.name]},{property:{objectName:"labels",propertyName:"color",isExprBound:!0},version:E.ExpressionBoundGaugeColors,types:[e.visuals.plugins.gauge.name]},{property:{objectName:"target",propertyName:"color",isExprBound:!0},version:E.ExpressionBoundGaugeColors,types:[e.visuals.plugins.gauge.name]},{property:{objectName:"calloutValue",propertyName:"color",isExprBound:!0},version:E.ExpressionBoundGaugeColors,types:[e.visuals.plugins.gauge.name]},{property:{objectName:"pageRefresh",propertyName:"show"},version:E.AutomaticPageRefresh,types:["page"]},{property:{objectName:"pageRefresh",propertyName:"duration"},version:E.AutomaticPageRefresh,types:["page"]},{property:{objectName:"text",propertyName:"text",isExprBound:!0},version:E.ExpressionBoundActions,types:[e.visuals.plugins.actionButton.name]},{property:{objectName:"text",propertyName:"fontColor",isExprBound:!0},version:E.ExpressionBoundActions,types:[e.visuals.plugins.actionButton.name]},{property:{objectName:"icon",propertyName:"lineColor",isExprBound:!0},version:E.ExpressionBoundActions,types:[e.visuals.plugins.actionButton.name]},{property:{objectName:"outline",propertyName:"lineColor",isExprBound:!0},version:E.ExpressionBoundActions,types:[e.visuals.plugins.actionButton.name]},{property:{objectName:"fill",propertyName:"fillColor",isExprBound:!0},version:E.ExpressionBoundActions,types:[e.visuals.plugins.actionButton.name]},{property:{objectName:"visualLink",propertyName:"tooltip",isExprBound:!0},version:E.ExpressionBoundActions},{types:[e.visuals.plugins.kpi.name],property:{objectName:"indicator",propertyName:"fontFamily"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"indicator",propertyName:"fontColor"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"indicator",propertyName:"verticalAlignment"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"indicator",propertyName:"horizontalAlignment"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"trendline",propertyName:"transparency"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"goalText"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"fontSize"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"goalFontFamily"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"goalFontColor"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"distanceLabel"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"percentageLabelPrecision"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"titleFontSize"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"distanceFontFamily"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"distanceFontColor"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"goals",propertyName:"direction"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"period",propertyName:"show"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"period",propertyName:"fontSize"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"period",propertyName:"periodFontFamily"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.kpi.name],property:{objectName:"period",propertyName:"periodFontColor"},version:E.AdditionalKPISettings},{types:[e.visuals.plugins.pivotTable.name,e.visuals.plugins.tableEx.name],property:{objectName:"values",propertyName:"webURL"},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.categoryLabels,propertyName:e.visuals.decompositionTreeObjectPropertyNames.categoryLabelFontColor},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.categoryLabels,propertyName:e.visuals.decompositionTreeObjectPropertyNames.categoryLabelFontFamily},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.categoryLabels,propertyName:e.visuals.decompositionTreeObjectPropertyNames.categoryLabelFontSize},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.dataLabels,propertyName:e.visuals.decompositionTreeObjectPropertyNames.dataLabelFontColor},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.dataLabels,propertyName:e.visuals.decompositionTreeObjectPropertyNames.dataLabelFontFamily},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.dataLabels,propertyName:e.visuals.decompositionTreeObjectPropertyNames.dataLabelFontSize},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.dataLabels,propertyName:e.visuals.decompositionTreeObjectPropertyNames.dataLabelDisplayUnits},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.dataLabels,propertyName:e.visuals.decompositionTreeObjectPropertyNames.dataLabelPrecision},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.dataBars,propertyName:e.visuals.decompositionTreeObjectPropertyNames.dataBarBackgroundColor},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.dataBars,propertyName:e.visuals.decompositionTreeObjectPropertyNames.dataBarWidthPercent},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.levelHeader,propertyName:e.visuals.decompositionTreeObjectPropertyNames.levelHeaderBackgroundColor},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.levelHeader,propertyName:e.visuals.decompositionTreeObjectPropertyNames.levelTitleFontColor},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.levelHeader,propertyName:e.visuals.decompositionTreeObjectPropertyNames.levelTitleFontFamily},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.levelHeader,propertyName:e.visuals.decompositionTreeObjectPropertyNames.levelTitleFontSize},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.levelHeader,propertyName:e.visuals.decompositionTreeObjectPropertyNames.levelSubtitleFontColor},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.levelHeader,propertyName:e.visuals.decompositionTreeObjectPropertyNames.levelSubtitleFontFamily},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.levelHeader,propertyName:e.visuals.decompositionTreeObjectPropertyNames.levelSubtitleFontSize},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.levelHeader,propertyName:e.visuals.decompositionTreeObjectPropertyNames.showSubtitles},version:f.v5_6},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.tree,propertyName:e.visuals.decompositionTreeObjectPropertyNames.connectorDefaultColor},version:f.v5_6},{types:["page"],property:{objectName:"outspacePane",propertyName:"inputBoxColor"},version:E.FilterPaneSearchBoxFormatting},{types:["page"],property:{objectName:"outspacePane",propertyName:"searchTextSize"},version:E.FilterPaneSearchBoxFormatting},{types:[e.visuals.plugins.actionButton.name],property:{objectName:"visualLink",propertyName:"navigationSection"},version:f.v5_8},{types:[e.visuals.plugins.actionButton.name],property:{objectName:"visualLink",propertyName:"drillthroughSection"},version:f.v5_8},{property:{objectName:"y2Axis",propertyName:"show"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secAxisLabel"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secAxisScale"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secStart"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secEnd"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secShowAxisTitle"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secAxisStyle"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secLabelColor"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secFontFamily"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secFontSize"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secLabelDisplayUnits"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secLabelPrecision"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secTitleColor"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secTitleFontFamily"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secTitleFontSize"},version:E.LineChartDualAxis},{property:{objectName:"y2Axis",propertyName:"secTitleText"},version:E.LineChartDualAxis},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.tree,propertyName:e.visuals.decompositionTreeObjectPropertyNames.barsPerLevel},version:E.DecompTreeBarsPerLevel},{types:["page"],property:{objectName:"pageRefresh",propertyName:"refreshType"},version:E.ChangeDetectionRefresh},{property:{objectName:"visualHeader",propertyName:"showPersonalizeVisualButton"},version:E.AllowInlineExploration},{types:[e.visuals.plugins.slicer.name],property:{objectName:"data",propertyName:"mode",matchByContents:function(t){return t.value===e.visuals.slicerMode.relativeTime}},version:E.RelativeTimeFilter},{types:["tableEx","pivotTable"],property:{objectName:"values",propertyName:"backColor",matchByContents:function(e,t){return void 0!==a(t)}},version:f.v5_9},{types:["tableEx","pivotTable"],property:{objectName:"values",propertyName:"fontColor",matchByContents:function(e,t){return void 0!==a(t)}},version:f.v5_9},{types:["tableEx","pivotTable"],property:{objectName:"values",propertyName:"icon",matchByContents:function(e,t){var r=a(t);return void 0!==r&&1!==r}},version:f.v5_9},{types:["tableEx","pivotTable"],property:{objectName:"values",propertyName:"webURL",matchByContents:function(e,t){var r=a(t);return void 0!==r&&1!==r}},version:f.v5_9},{property:{objectName:"values",propertyName:"value"},types:[e.visuals.plugins.textbox.name],version:E.NarrativeVisual},{types:[e.visuals.plugins.decompositionTreeVisual.name],property:{objectName:e.visuals.decompositionTreeObjectNames.insights,propertyName:e.visuals.decompositionTreeObjectPropertyNames.isAINode},version:E.DecompositionInsights}];var w=["minColor","midColor","maxColor","nullColor"];r.RenamedObjectPropertyVersions=[{currentId:{objectName:"dataPoint",propertyName:"fill"},previousId:{objectName:"dataPoint",propertyName:"defaultCategoryColor"},version:f.v3_19,types:r.DefaultCategoryColorVisualsToUpgrade}],r.UpdatedObjectPropertyVersions=[{property:{objectName:"categoryAxis",propertyName:"fontSize"},version:f.v4_2,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"categoryAxis",propertyName:"titleFontSize"},version:f.v4_2,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"valueAxis",propertyName:"fontSize"},version:f.v4_2,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"valueAxis",propertyName:"titleFontSize"},version:f.v4_2,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"valueAxis",propertyName:"secFontSize"},version:f.v4_2,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"valueAxis",propertyName:"secTitleFontSize"},version:f.v4_2,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"visualTooltip",propertyName:"fontSize"},version:f.v4_2,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"outspacePane",propertyName:"titleSize"},version:f.v5_1,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"outspacePane",propertyName:"headerSize"},version:f.v5_1,upgrader:r.UpgradeUtils.pxToPtUpgrader},{property:{objectName:"filterCard",propertyName:"textSize"},version:f.v5_1,upgrader:r.UpgradeUtils.pxToPtUpgrader}],r.ObjectVersioning=l(r.AddedObjectPropertyVersions,r.RenamedObjectPropertyVersions,r.UpdatedObjectPropertyVersions);var V;!(function(e){e.v1_0="1.0",e.v1_1="1.1",e.v1_2="1.2",e.v1_3="1.3",e.v1_4="1.4",e.v1_5="1.5",e.v1_6="1.6"})(V=r.ExplorationStateVersions||(r.ExplorationStateVersions={}));var F;!(function(e){e.v1_0="1.0"})(F=r.UtteranceDefinitionVersions||(r.UtteranceDefinitionVersions={}))})(i=r.upgrade||(r.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.explore.services.upgrade.CurrentExplorationVersion,n=e.data.DataViewObjectDefinitions,o=e.explore.contracts.ExplorationObjectDescriptors,a=e.explore.services.upgrade.ExplorationVersions;!(function(t){function r(t,r,n){return e.getThemeMetadata(t,r,n||i)}function s(e){return{name:e&&e.featureSwitches&&e.featureSwitches.useNewCY19SU06BaseTheme?p:c,version:i,type:2}}function l(){return{name:c,version:t.baseThemeVersions[c],type:2}}function u(t,r,i){var a=t.themeCollection,s=e.explore.constants.ExplorationComponentType,l=t.objects,u=r.getVisualObjects(a,s,void 0,o);u&&(l=n.clone(l||{}),n.extend(l,u));var c=r.getVisualStyle(a),p=e.data.DataViewTransform.evaluateMetadataOnceDataViewObjectDefinitions(l,o,c,i);t.evaluatedObjects=p.dataViewObjects}var c="CY18SU07",p="CY19SU12";t.baseThemeVersions={CY17SU10:a.v3_6,CY17SU12:a.v3_7,CY18SU04:a.v3_12,CY18SU07:a.v3_15,CY19SU06:a.v5_3,CY19SU12:a.v5_6},t.ClassicBaseThemeName="Classic",t.DefaultBaseThemeName="Default",t.CustomThemeName="Custom",t.ClassicBaseThemeBuiltInThemeNames=["Classic","CityPark","Classroom","ColorblindSafe","Electric","HighContrast","Sunset","Twilight"],t.getThemeMetadata=r,t.getCurrentBaseThemeMetadata=s,t.getClassicBaseThemeMetadata=l,t.evaluateObjects=u})(r=t.ThemeUtils||(t.ThemeUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}var r=jsCommon.Version;e.createExplorationDowngrader=t;var i=(function(){function t(){this.downgraders=[new e.PodDrillthroughDowngrader,new e.SectionLinkFieldDowngrader,new e.visualContainerProperties.VisualContainerConfigDowngrader,new e.explorationConfig.ExplorationConfigDowngrader,new e.OutspaceFontDowngrader]}return t.prototype.getFinalExplorationVersion=function(e,t){for(var i=0,n=this.downgraders;i<n.length;i++){var o=n[i];t=r.max(t,o.getMinDowngradeVersionForContract(e))}return t},t.prototype.downgrade=function(e,t){for(var r=0,i=this.downgraders;r<i.length;r++){i[r].downgrade(e,t)}},t})();e.ExplorationDowngrader=i})(t=e.downgrade||(e.downgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(t){var r=e.explore.services.upgrade.ExplorationFeatureVersions,i=e.explore.services.upgrade.ExplorationVersions,n=jsCommon.Version,o=(function(){function e(){}return e.prototype.getMinDowngradeVersionForContract=function(e){var t=e.themeCollection;if(t.customTheme&&2===t.customTheme.type)return r.BuiltInThemes;for(var o in t)if(n.gt(t[o].version,i.v3_18))return i.v3_18;return n.ZeroStr},e.prototype.downgrade=function(e,t){if(n.lt(t,i.v3_18)){var r=e.config;r.themeCollection.customTheme&&(e.theme=r.themeCollection.customTheme.name),r.themeCollection.baseTheme&&(r.baseTheme=r.themeCollection.baseTheme.name),delete r.themeCollection}},e})();t.ExplorationConfigDowngrader=o})(r=t.explorationConfig||(t.explorationConfig={}))})(r=t.downgrade||(t.downgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r=e.explore.services.upgrade.ExplorationVersions,i=jsCommon.Version,n=jsCommon.JsonExtensions,o=(function(){
function e(){}return e.prototype.getMinDowngradeVersionForContract=function(e){for(var t=i.ZeroStr,n=0,o=e.sections;n<o.length;n++){var a=o[n];if(1===a.type){if(a.acceptsAllFiltersWhenLinked===!1){t=r.v3_14;break}var s=a.filters;if(_.some(s,(function(e){return 5===e.howCreated&&!e.isTransient&&e.filter}))){t=r.v3_14;break}t=r.v3_13}}return t},e.prototype.downgrade=function(e,t){if(i.lt(t,r.v3_14))for(var n=0,o=e.sections;n<o.length;n++){var a=o[n];this.tryDowngradeSection(a)}},e.prototype.tryDowngradeSection=function(e){var t=e.config,r=e.filters?n.tryParseJSON(e.filters):[];1===t.type&&r&&(t.linkFields=_.remove(r,(function(e){return 5===e.howCreated})).map((function(e){return{fieldExpr:e.expression,asAggregation:e.isLinkedAsAggregation}})),e.filters=JSON.stringify(r))},e})();t.SectionLinkFieldDowngrader=o})(r=t.downgrade||(t.downgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(i){var n;!(function(i){var n=e.data.services.wireContracts.DataViewObjectDefinitions,o=e.explore.services.upgrade.ExplorationVersions,a=e.data.PrimitiveValueEncoding,s=e.explore.services.upgrade,l=jsCommon.Version,u=(function(){function i(){}return i.prototype.getMinDowngradeVersionForContract=function(e){for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],n=0,a=i.visualContainers;n<a.length;n++){var s=a[n],u=s.config.singleVisual.vcObjects;if(this.checkObjectsForThemeRelative(u))return o.v3_15}return l.ZeroStr},i.prototype.checkObjectsForThemeRelative=function(r){var i=!1;if(r){var n=function(t){e.data.SQExpr.isThemeDataColor(t)&&(i=!0)};e.data.DataViewObjectDefinitions.visitPropertyExprs({definitions:r,descriptors:t.contracts.VisualContainer.CommonObjectDescriptors,visitor:n})}return i},i.prototype.downgrade=function(i,a){if(l.lt(a,o.v5_3))for(var u=0,c=i.sections;u<c.length;u++)for(var p=c[u],d=0,f=p.visualContainers;d<f.length;d++){var v=f[d],m=v.config,h=m&&m.singleVisual,g=h&&h.vcObjects;if(g&&l.lt(a,o.v3_15)){if(g.background){var y=n.getObjectDefinitionProperties(g,"background");h.background={color:this.getValueFromExpr(y.color),show:this.getValueFromExpr(y.show),transparency:this.getValueFromExpr(y.transparency)}}if(g.border){var C=n.getObjectDefinitionProperties(g,"border");h.border={color:this.getValueFromExpr(C.color),show:this.getValueFromExpr(C.show)}}if(g.general){var x=n.getObjectDefinitionProperties(g,"general");h.altText=this.getValueFromExpr(x.altText)}if(g.lockAspect){var S=n.getObjectDefinitionProperties(g,"lockAspect");h.aspectRatio={show:this.getValueFromExpr(S.show)}}if(g.stylePreset){var b=n.getObjectDefinitionProperties(g,"stylePreset");h.stylePresetName=this.getValueFromExpr(b.name)}if(g.title){var E=n.getObjectDefinitionProperties(g,"title");h.title={alignment:this.getValueFromExpr(E.alignment),background:this.getValueFromExpr(E.background),fontColor:this.getValueFromExpr(E.fontColor),fontFamily:this.getValueFromExpr(E.fontFamily),fontSize:this.getValueFromExpr(E.fontSize),show:this.getValueFromExpr(E.show),text:this.getValueFromExpr(E.text)}}if(g.visualLink){var w=n.getObjectDefinitionProperties(g,"visualLink");h.visualLink={type:this.getValueFromExpr(w.type),bookmark:this.getValueFromExpr(w.bookmark),qna:w.qna,show:this.getValueFromExpr(w.show)}}if(g.visualTooltip){var V=n.getObjectDefinitionProperties(g,"visualTooltip");h.visualTooltip={section:this.getValueFromExpr(V.section),type:this.getValueFromExpr(V.type)}}delete h.vcObjects}var F=h&&h.objects,P=h&&h.visualType;if(F&&_.includes(s.DefaultCategoryColorVisualsToUpgrade,P)&&l.lt(a,o.v3_19)){var T=n.getObjectDefinitionProperties(F,"dataPoint"),N=T&&T.fill;N&&(T.defaultCategoryColor=T.fill,delete T.fill)}if(l.lt(a,o.v4_2)){if(F)for(var D=t.services.upgrade.UpgradeUtils.visualPropertiesToUpdate,R=0,I=D;R<I.length;R++){var j=I[R],T=n.getObjectDefinitionProperties(F,j.objectName),O=T&&T[j.propertyName];O&&(T[j.propertyName]=r.upgrade.UpgradeUtils.ptToPxWireExpr(O))}if(g)for(var M=r.upgrade.UpgradeUtils.visualContainerPropertiesToUpdate,A=0,k=M;A<k.length;A++){var z=k[A],T=n.getObjectDefinitionProperties(g,z.objectName),O=T&&T[z.propertyName];O&&(T[z.propertyName]=r.upgrade.UpgradeUtils.ptToPxWireExpr(O))}}if(l.lt(a,o.v5_3)&&P===e.visuals.plugins.textbox.name){var x=n.getObjectDefinitionProperties(F,"general");if(x)for(var B=x.paragraphs,U=0,L=B;U<L.length;U++)for(var q=L[U],G=0,H=q.textRuns;G<H.length;G++){var Q=H[G];if(Q.textStyle&&Q.textStyle.fontSize){var W=Q.textStyle.fontSize,X=W.indexOf("pt");if(X!==-1){var K=+W.substr(0,X);isNaN(K)||(Q.textStyle.fontSize=r.upgrade.UpgradeUtils.ptToPx(K)+"px")}}}}}},i.prototype.getValueFromExpr=function(e){if(null!=e){var t=e,r=e;if(t.solid&&t.solid.color&&(r=t.solid.color),r.expr&&r.expr.Literal)return a.parseTypeEncodedValue(r.expr.Literal.Value)}},i})();i.VisualContainerConfigDowngrader=u})(n=i.visualContainerProperties||(i.visualContainerProperties={}))})(i=r.downgrade||(r.downgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new k(e,t,r,i)}function n(t){if(t.visualType!==e.visuals.plugins.scatterChart.name)return!1;var r=e.visuals.scatterRoleNames.x,i=t.query,n=i?i.getRolesProjectionRefs([r]):void 0,o=_.size(n);if(o>1)return!0;if(1===o){var a=i.tryGetExpr(r,0);if(a&&!P.isMeasure(a))return!0}return!1}function o(t){return t.visualType===e.visuals.plugins.scatterChart.name&&t.query&&t.query.projections.Play&&!_.isEmpty(t.query.projections.Play.all())}var a=jsCommon.ArrayExtensions,s=e.explore.contracts.Bookmark,l=e.explore.contracts,u=e.explore.services.upgrade.CurrentExplorationVersion,c=e.common.contracts.DataCacheModeType,p=e.data.DataViewObjectDefinitions,d=e.data.services.DataViewObjectSerializer,f=e.data.ExpansionState,v=e.data.services.ExpansionStateSerializer,m=e.explore.services.upgrade.ExplorationFeatureVersions,h=e.explore.services.upgrade.ExplorationStateVersions,g=e.explore.services.upgrade.ExplorationVersions,y=l.FilterContainer.ObjectType,C=l.FilterContainer.CommonObjectDescriptors,x=jsCommon.JsonExtensions,S=l.LinguisticSchemaSyncVersion,b=e.data.QueryProjectionCollection,E=e.contracts.ResourcePackageItemType,w=e.visualHost.utils.ResourcePackageUtils,V=e.data.services.SemanticQuerySerializer,F=e.data.SQExpr,P=e.data.SQExprUtils,T=jsCommon.StringExtensions,N=e.visualHost.ThemeUtils,D=jsCommon.Version,R=l.VisualContainer,I=l.VisualContainerGroup,j=t.util.VisualContainerUtils,O=l.VisualQuery,M="Gradient",A="Size";r.createExplorationSerializer=i;var k=(function(){function i(e,t,i,n){this.visualPlugins=e,this.telemetryService=t,this.featureSwitchService=i,this.canvasListOrderNormalizeService=n,this.explorationUpgrader=r.upgrade.createExplorationUpgrader(i),this.explorationDowngrader=r.downgrade.createExplorationDowngrader()}return i.prototype.deepCopyExploration=function(e,t){return this.deserializeExploration(this.serializeExploration(e,t),[],!0)},i.prototype.ensureInitialized=function(){return this.visualPlugins.ensureBuiltInPlugins()},i.prototype.deserializeExploration=function(t,r,i,n,o){var a,s=this;if(t){var u=this.explorationUpgrader.upgrade(t,r,i,o);if(!u)return;var p=u.config;if(a={id:u.id,width:void 0,height:void 0,sections:void 0,dataSources:void 0,reportId:u.reportId,themeCollection:N.cloneThemeCollection(p.themeCollection),bookmarks:[],mwcToken:u.mwcToken,capacityUri:u.capacityUri},p.tags&&(a.tags=_.cloneDeep(p.tags)),p.slowDataSourceSettings&&(a.slowDataSourceSettings=_.cloneDeep(p.slowDataSourceSettings)),p.settings&&(a.settings=_.cloneDeep(p.settings)),p.objects&&(a.objects=d.deserializeObjects(p.objects,l.ExplorationObjectDescriptors)),p.bookmarks&&this.defineProperty(a,"bookmarks",(function(){var e=s.deserializeBookmarks(p.bookmarks);return e})),u.userState&&(a.userState=this.deserializeUserState(u.userState)),u.activeWebBookmark&&(a.activeWebBookmark=this.deserializeWebBookmark(u.activeWebBookmark,i)),u.sections){var f=_.sortBy(u.sections,(function(e){return void 0!==e.ordinal?e.ordinal:0})),v=a.settings&&a.settings.useStylableVisualContainerHeader;if(a.sections=_.map(f,(function(e){return s.deserializePage(e,v)})),a.filters=this.deserializeFilterContainers(u.filters),a.dataSources=l.createDataSourceArray(),u.resourcePackages&&(a.resourcePackages=this.deserializeResourcePackages(u.resourcePackages)),u.pods&&(a.pods=_.map(u.pods,(function(e){return s.deserializePod(e)}))),_.isNumber(p.activeSectionIndex)&&p.activeSectionIndex<u.sections.length&&(a.activeSectionIndex=p.activeSectionIndex),p.modelExtensions&&(a.modelExtensions=this.deserializeModelExtensions(p.modelExtensions)),n)if(n.lastTimeAModelChangeWasDetectedInTheCluster&&!_.isEmpty(n.onPremModelConnectionString)){var m=jsCommon.DateExtensions.deserializeDate(n.lastTimeAModelChangeWasDetectedInTheCluster);this.updateVisualContainerCachingOptions(a,m,(function(e){e.useInitialCachedQuery=!0}),(function(e){e.useInitialCachedQuery=!1}))}else if(_.isEmpty(n.onPremModelConnectionString)&&n.dataCacheMode===c.Import&&n.lastRefreshTime){var m=jsCommon.DateExtensions.deserializeDate(n.lastRefreshTime);this.updateVisualContainerCachingOptions(a,m,(function(e){e.disableCacheOnServerForInitialLoad=!0}),(function(e){e.disableCacheOnServerForInitialLoad=!1}))}}u.report&&(a.report=e.Prototype.inherit(u.report),u.report.linguisticSchemaId&&(a.reportHasLinguisticSchema=!0)),null!=p.defaultDrillFilterOtherVisuals&&(a.defaultDrillFilterOtherVisuals=p.defaultDrillFilterOtherVisuals),p.filterSortOrder&&(a.filterSortOrder=p.filterSortOrder),p.dataSourceVariables&&(a.dataSourceVariables=p.dataSourceVariables),a.linguisticSchemaSyncVersion=this.deserializeLinguisticSchemaSyncVersion(p.linguisticSchemaSyncVersion)}return a},i.prototype.deserializeLinguisticSchemaSyncVersion=function(e){return null==e?S.Unspecified:e},i.prototype.defineProperty=function(e,t,r){var i;Object.defineProperty(e,t,{get:function(){return i||(i=r()),i},set:function(e){i=e},enumerable:!0,configurable:!0})},i.prototype.updateVisualContainerCachingOptions=function(e,t,r,i){for(var n=0,o=e.sections;n<o.length;n++)for(var a=o[n],s=0,l=a.visualContainers;s<l.length;s++){var u=l[s];if(u.cachedData&&u.cachedData.dataUpdatedTime&&u.cachedData.data){var c=+u.cachedData.dataUpdatedTime-+t;c>=0?r(u):i(u)}else i(u)}},i.prototype.deserializeResourcePackages=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this.upgradeResourcePackage(n.resourcePackage),t.push(n.resourcePackage)}for(var o=0;o<t.length;++o)if(t[o])for(var a=t.length;--a>o;)t[a]&&t[o].name===t[a].name&&(t[a].id>t[o].id&&(t[o]=t[a]),t.splice(a,1));return t},i.prototype.deserializeLinkField=function(e){var t=V.deserializeExpr(e.fieldExpr);return{asAggregation:e.asAggregation,fieldExpr:t}},i.prototype.deserializePage=function(e,r){var i=this;if(e){var n={id:e.id,objectId:e.objectId,name:e.name,displayName:e.displayName,visualContainers:void 0,visualContainerGroups:void 0,size:{displayOption:void 0!==e.displayOption?e.displayOption:0,height:e.height||t.constants.ExploreCanvasConstants.DefaultCanvasHeight,width:e.width||t.constants.ExploreCanvasConstants.DefaultCanvasWidth},filters:this.deserializeFilterContainers(e.filters)};e.transient&&(n.transient=e.transient);var o=e.config;if(n.acceptsAllFiltersWhenLinked=o.acceptsAllFiltersWhenLinked,o.objects&&(n.objects=d.deserializeObjects(o.objects,l.Section.objectDescriptors)),null!=o.visibility&&(n.visibility=o.visibility),null!=o.type&&(n.type=o.type),null!=o.filterSortOrder&&(n.filterSortOrder=o.filterSortOrder),_.isEmpty(o.linkFields)||(n.linkFields=_.map(o.linkFields,(function(e){return i.deserializeLinkField(e)}))),e.visualContainers){var a=this.deserializeCanvasItems(e.visualContainers,null,r);a?(n.visualContainers=a.visualContainers,n.visualContainerGroups=a.visualContainerGroups):(n.visualContainers=[],n.visualContainerGroups=[]),o.relationships&&(n.relationships=this.deserializeRelationships(o.relationships,n.visualContainers))}return n}},i.prototype.deserializePod=function(e){if(e)return{id:e.id,name:e.name,boundSection:e.boundSection,parameters:this.deserializePodParameters(e.parameters),cortanaEnabled:e.cortanaEnabled,type:void 0===e.type?0:e.type,referenceScope:void 0===e.referenceScope?0:e.referenceScope,config:this.deserializePodConfig(e.config)}},i.prototype.deserializeRelationships=function(e,t){if(!_.isEmpty(e)){for(var r,i=0,n=e;i<n.length;i++){var o=n[i],a=this.deserializeRelationship(o,t);a&&(r||(r=[])).push(a)}return r}},i.prototype.deserializeBookmarks=function(e){var t=this;if(e)return _.map(e,(function(e){if(t.isBookmarkGroup(e)){return{displayName:e.displayName,name:e.name,children:t.deserializeBookmarks(e.children)}}var i=e.explorationState,n={displayName:e.displayName,name:e.name,explorationState:r.ExplorationState.deserialize(i,t.visualPlugins)};return e.options&&(n.options=t.deserializeBookmarkOptions(e.options)),n}))},i.prototype.deserializeBookmarkOptions=function(e){return e},i.prototype.deserializeUserState=function(t){if(!T.isNullOrUndefinedOrWhiteSpaceString(t)){var i=x.tryParseJSON(t);if(i)try{return r.UserState.deserialize(i,this.visualPlugins)}catch(t){return t&&this.telemetryService.logEvent(e.telemetry.PersistentStateSerializationError,t.stack,t.message),{explorationState:null}}}},i.prototype.deserializeWebBookmark=function(t,i){var n=r.WebBookmark.deserialize(t,this.visualPlugins);if(n.errors&&!i)for(var o=0,a=n.errors;o<a.length;o++){var s=a[o];this.telemetryService.logEvent(e.telemetry.SerializationError,"WebBookmark",s.code,void 0,s.stack,s.message)}return n.contract},i.prototype.deserializeModelExtensions=function(e){var t=this;return a.extendWithName(_.map(e,(function(e){var r={name:e.name,extends:e.extends};return e.entities&&(r.entities=t.deserializeModelExtensionEntities(e.entities)),r})))},i.prototype.deserializeModelExtensionEntities=function(e){var t=this;return a.extendWithName(_.map(e,(function(e){var r;return r=e.extends?{name:e.name,extends:e.extends}:{name:e.name},e.measures&&(r.measures=t.deserializeModelExtensionMeasures(e.measures)),r})))},i.prototype.deserializeModelExtensionMeasures=function(e){var t=this;return a.extendWithName(_.map(e,(function(e){var r={name:e.name,dataCategory:e.dataCategory,dataType:e.dataType,expression:e.expression,errorMessage:e.errorMessage,hidden:e.hidden,references:t.deserializeExpressionReferences(e.references),formulaOverride:e.formulaOverride,formatInformation:e.formatInformation};return e.annotations&&(r.annotations=t.deserializeModelExtensionAnnotations(e.annotations)),e.measureTemplate&&(r.measureTemplate={daxTemplateName:e.measureTemplate.daxTemplateName,version:e.measureTemplate.version}),e.description&&(r.description=e.description),r})))},i.prototype.deserializeExpressionReferences=function(e){return e?{unrecognizedReferences:!!e.unrecognizedReferences,measures:e.measures||[]}:{unrecognizedReferences:!1,measures:[]}},i.prototype.deserializeModelExtensionAnnotations=function(e){return a.extendWithName(_.map(e,(function(e){return{name:e.name,value:e.value}})))},i.prototype.deserializeFilterCollection=function(e,t,r){if(e){var i=this.explorationUpgrader.upgradeFilterCollection(e,t,r);if(i)return this.deserializeFilterContainers(i.filters)}},i.prototype.deserializeFilterContainer=function(e){return{name:e.name,type:l.FilterType[e.type],expression:e.expression?V.deserializeExpr(e.expression):void 0,filter:e.filter&&e.filter.Where?V.deserializeFilter(e.filter):void 0,restatement:e.restatement,cachedValueItems:r.DisplayNameSerializer.deserializeFilterLabelIdPairs(e.cachedDisplayNames),howCreated:e.howCreated,isLinkedAsAggregation:e.isLinkedAsAggregation,isTransient:e.isTransient,isHiddenInViewMode:e.isHiddenInViewMode,objects:e.objects?d.deserializeObjects(e.objects,C):void 0,isLockedInViewMode:e.isLockedInViewMode,filterExpressionMetadata:e.filterExpressionMetadata?t.FilterExpressionMetadataUtils.deserializeFilterExpressionMetadata(e.filterExpressionMetadata):void 0,displayName:e.displayName,ordinal:e.ordinal}},i.prototype.deserializeCanvasItems=function(e,t,r,i){if(!_.isEmpty(e)){for(var n=[],o=[],a={},s={},u=0,c=e;u<c.length;u++){var p=c[u],d=p.config,f=d.name,v=i&&i(p),m=this.deserializeCanvasItem(p,t,v),h=m.name;s[f]=h,l.isVisualContainer(m)&&n.push(m),void 0===d.parentGroupName?o.push(m):(a[d.parentGroupName]||(a[d.parentGroupName]=[]),a[d.parentGroupName].push(m))}var g={};for(var y in a){var C=s[y];C?g[C]=a[y]:o.push.apply(o,a[y])}return this.ensureVisualContainerGrouping(o,g,r),this.ensureNames(n),r?(this.ensureGroupZIndexNormalized(o),this.ensureListOrderNormalized(n,!1)):(o=n.slice(),this.ensureListOrderNormalized(n)),{visualContainerGroups:o,visualContainers:n}}},i.prototype.deserializeCanvasItem=function(t,r,i){var n=t.config;return n.singleVisual?this.deserializeVisualContainer(t,r,i):n.singleVisualGroup?this.deserializeVisualContainerGroup(t,r,i):void this.telemetryService.logEvent(e.telemetry.EXEmptyVisualContainerConfig)},i.prototype.deserializeVisualContainer=function(e,t,r){var i,n=e.config,o={name:r||n.name,id:t?void 0:e.id,layouts:a.createWithId(),config:{singleVisual:this.deserializeSingleVisual(n.singleVisual,e.prototypeQuery)}};null!=e.visibility&&(o.visibility=e.visibility),null!=e.detailVisualLayout&&(o.detailVisualLayout=e.detailVisualLayout),void 0===e.dataBinaryBase64Encoded&&void 0===e.query&&void 0===e.dataTransforms||(o.cachedData={data:e.dataBinaryBase64Encoded,query:e.query,transforms:e.dataTransforms,dataUpdatedTime:e.dataUpdatedTime?jsCommon.DateExtensions.parseUtcDate(e.dataUpdatedTime):void 0}),o.filters=this.deserializeFilterContainers(e.filters);var s=n.singleVisual.drillFilterOtherVisuals;null!=s&&(o.drillFilterOtherVisuals=s);var l=n.singleVisual.filterSortOrder;return null!=l&&(o.filterSortOrder=l),(i=o.layouts).push.apply(i,_.cloneDeep(n.layouts)),o},i.prototype.deserializeVisualContainerGroup=function(e,t,r){var i,n=e.config,o=n.singleVisualGroup,s={name:r||n.name,id:t?void 0:e.id,children:[],displayName:o.displayName,groupMode:o.groupMode,layouts:a.createWithId(),isHidden:o.isHidden};return(i=s.layouts).push.apply(i,_.cloneDeep(n.layouts)),o.objects&&(s.objects=d.deserializeObjects(o.objects,I.objectDescriptors)),s},i.prototype.deserializeRelationship=function(e,t){var r=a.findItemWithName(t,e.source),i=a.findItemWithName(t,e.target);if(0!==e.type&&r&&i)return{source:r,target:i,type:e.type}},i.prototype.deserializeFilterContainers=function(e){var t=this;if(!T.isNullOrUndefinedOrWhiteSpaceString(e)){var r=[],i=x.tryParseJSON(e);return i&&(r=i.map((function(e){return t.deserializeFilterContainer(e)}))),r}},i.prototype.deserializePodParameters=function(e){var t=this,r=[];if(!T.isNullOrUndefinedOrWhiteSpaceString(e)){var i=x.tryParseJSON(e);i&&(r=i.map((function(e){return t.deserializePodParameter(e)})))}return r},i.prototype.deserializePodParameter=function(e){return{name:e.name,boundFilter:e.boundFilter,fieldExpr:e.fieldExpr?V.deserializeExpr(e.fieldExpr):void 0,asAggregation:e.asAggregation,isLegacySingleSelection:e.isLegacySingleSelection}},i.prototype.deserializePodConfig=function(e){if(T.isNullOrUndefinedOrWhiteSpaceString(e))return{acceptsFilterContext:0};var t=x.tryParseJSON(e);return void 0===t.acceptsFilterContext&&(t.acceptsFilterContext=0),t},i.prototype.deserializeVisualQuery=function(e,t,r,i,n){var o=this.visualPlugins.capabilities(e.visualType),a=o&&o.expandCollapse&&o.expandCollapse.supportsMerge,s=o&&o.noDefaultProjections,l=new O(t,this.convertProjections(r,t.select(),n),v.deserializeExpansionStates(i,a,s));this.upgradeVisualQuery(l,e.visualType),e.query=l},i.prototype.deserializeSingleVisual=function(e,i){var n={visualType:e.visualType||e.visualConfig.visualType},o=e.visualConfig?e.visualConfig.projections:void 0,a=e.projections||{};if(o)for(var s=0,l=o;s<l.length;s++){var u=l[s],c=a[u.role];c||(c=[],a[u.role]=c),c.push(u)}else if(a&&a.length>0){o=a,a={};for(var f=0,v=o;f<v.length;f++){var u=v[f],c=a[u.role];c||(c=[],a[u.role]=c),c.push(u)}}var m=e.prototypeQuery?e.prototypeQuery:i?x.tryParseJSON(i):null;if(m){var h=V.deserializeQuery(m);this.deserializeVisualQuery(n,h,a,e.expansionStates,e.showAllRoles)}var g=e.display;null!=e.display&&(n.display=g),e.columnProperties&&(n.columnProperties=_.cloneDeep(e.columnProperties));var y=e.queryOptions;y&&(n.queryOptions=_.cloneDeep(y));var C=e.syncGroup;null!=C&&(n.syncGroup=_.cloneDeep(C));var S=e.hasDefaultSort;null!=S&&(n.hasDefaultSort=S);var b=this.visualPlugins.capabilities(n.visualType);if(b&&e.objects)n.objects=d.deserializeObjects(e.objects,b.objects);else{var E=e.objects;E&&(n.objects=d.deserializeObjects(E,null))}if(e.vcObjects){n.vcObjects=d.deserializeObjects(e.vcObjects,R.CommonObjectDescriptors);var w=p.getObjectDefinition(n.vcObjects,"visualLink",void 0);if(w){var F=e.vcObjects.visualLink[0].properties.qna,P=F&&F.suggestedUtterances;_.isEmpty(P)||(w.properties.qna={suggestedUtterances:_.map(P,(function(e){return r.UtteranceDefinitionSerializer.deserialize(e)}))})}}return e.cachedFilterDisplayItems&&(n.cachedFilterDisplayItems=r.DisplayNameSerializer.deserializeFilterLabelIdPairs(e.cachedFilterDisplayItems)),e.filterExpressionMetadata&&(n.filterExpressionMetadata=t.FilterExpressionMetadataUtils.deserializeFilterExpressionMetadata(e.filterExpressionMetadata)),n},i.prototype.isBookmarkGroup=function(e){return void 0!==e.children},i.prototype.ensureVisualContainerGrouping=function(e,t,r,i){for(var n=0,o=e;n<o.length;n++){var a=o[n];if(i&&(a.parentGroup=i),!r&&l.isVisualContainer(a)&&a.parentGroup){var s=a.layouts.withId(0),u=j.getAbsoluteVisualContainerPosition(s.position,0,a.parentGroup);s.position=u,a.parentGroup=void 0}l.isVisualContainerGroup(a)&&(a.children=t[a.name],this.ensureVisualContainerGrouping(a.children,t,r,a))}},i.prototype.ensureGroupZIndexNormalized=function(e){if(!_.isEmpty(e)){this.ensureListOrderNormalizedInternal(e,!0,"z");for(var t=0,r=e;t<r.length;t++){var i=r[t];l.isVisualContainerGroup(i)&&this.ensureGroupZIndexNormalized(i.children)}}},i.prototype.ensureListOrderNormalized=function(e,t){void 0===t&&(t=!0),_.isEmpty(e)||(t&&this.ensureListOrderNormalizedInternal(e,!0,"z"),_.every(e,(function(e){var t=e.layouts.withId(0);return t&&t.position&&null==t.position.tabOrder}))||(this.ensureTabOrderNormalized(e,!0),this.ensureTabOrderNormalized(e,!1)))},i.prototype.ensureTabOrderNormalized=function(e,t){var r=this,i=_.filter(e,(function(e){var i=r.getListOrderPropertyFunction(e,"tabOrder");return t?i>=0||void 0===i:i&&i<0}));this.ensureListOrderNormalizedInternal(i,t,"tabOrder")},i.prototype.getListOrderPropertyFunction=function(e,t){var r=e.layouts.withId(0);return r&&r.position&&r.position[t]},i.prototype.setListOrderPropertyFunction=function(e,t,r){var i=e.layouts.withId(0);i&&i.position&&(i.position[t]=r)},i.prototype.ensureListOrderNormalizedInternal=function(e,t,r){var i=this,n=this.canvasListOrderNormalizeService.getContainerListOrders(e,(function(e){return i.getListOrderPropertyFunction(e,r)}));this.canvasListOrderNormalizeService.shouldNormalizeListOrder(n,t)&&(n=this.canvasListOrderNormalizeService.normalizeListOrder(n,t,(function(e){return i.getListOrderPropertyFunction(e,r)})),this.updateListOrders(e,n,r))},i.prototype.updateListOrders=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var o=n[i],a=t[o.name];if(null!=a){a!==this.getListOrderPropertyFunction(o,r)&&this.setListOrderPropertyFunction(o,r,a)}}},i.prototype.ensureNames=function(e){for(var t,r=e.length,i={},n=0;n<r;n++){var o=e[n].name;_.isEmpty(o)?t=!0:i[o]=!0}if(t)for(var n=0;n<r;n++){var a=e[n],s=a.name;_.isEmpty(s)&&(a.name=j.nextUniqueName(i),i[a.name]=!0)}},i.prototype.convertProjections=function(e,t,r){var i={};for(var n in e){var o=_.includes(r,n);i[n]=this.convertProjectionArray(e[n],t,o)}return i},i.prototype.convertProjectionArray=function(e,t,r){for(var i,n=[],o=0,a=e;o<a.length;o++){var s=a[o],l=this.convertProjection(s,t);s.active&&(i=i||[],i.push(l.queryRef)),n.push(l)}return new b(n,i,r)},i.prototype.convertProjection=function(e,t){var r=e.queryRef;_.isNumber(e.queryRef)&&(r=t[e.queryRef].name);var i={queryRef:r};return e.format&&(i.format=e.format),i},i.prototype.serializeExploration=function(e,t){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializeExploration(e,t)},i.prototype.serializeModelExtensions=function(e){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializeModelExtensions(e)},i.prototype.serializePage=function(e,t,r){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializePage(e,t,r)},i.prototype.serializePageShallow=function(e,t,r){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializePageShallow(e,t,r)},i.prototype.serializeVisualContainer=function(e,t){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializeVisualContainer(e,t)},i.prototype.serializeVisualContainerGroup=function(e){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializeVisualContainerGroup(e)},i.prototype.serializePod=function(e){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializePod(e)},i.prototype.serializeFilterCollection=function(e){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializeFilterCollection(e)},i.prototype.serializeResourcePackages=function(e){return new z(this.visualPlugins,this.explorationDowngrader,this.telemetryService,this.featureSwitchService).serializeResourcePackages(e)},i.prototype.upgradeVisualQuery=function(r,i){if(i===e.visuals.plugins.filledMap.name&&r.projections[M]){var n=r.projections[M],o=r.projections[A];if(o&&o.all.length>0)for(var a=o.all().length,s=a-1;s>=0;s--)r.removeProjection(A,s);r.projections[A]=n,delete r.projections[M]}var l=this.visualPlugins.capabilities(i);if(l){var u=t.util.DrillUtils.getDrillableRoles(l),c=r.ensureDrillableRoles(u);if(!_.isEmpty(c)){for(var p={},d=0,f=c;d<f.length;d++){var v=f[d],m=r.projections[v],h=0;m&&(h=_.size(m.all())),p[v]=h}this.telemetryService.logEvent(e.telemetry.EXVisualDrillableRoleActiveItemsFixed,i,JSON.stringify(p))}}},i.prototype.upgradeResourcePackage=function(e){void 0===e.type&&(e.type=0)},i.prototype.getReferencedStaticResources=function(e){var t={},i=e.themeCollection.customTheme,n=e.themeCollection.baseTheme;if(this.addItemReference(t,e.resourcePackages,i&&i.type,i&&i.name),this.addItemReference(t,e.resourcePackages,n&&n.type,n&&n.name),!_.isEmpty(e.sections))for(var o=0,a=e.sections;o<a.length;o++){var s=a[o];if(r.StaticResourceReferences.addObjectsReferences(s.objects,l.Section.objectDescriptors,e.resourcePackages,t),!_.isEmpty(s.visualContainers))for(var u=0,c=s.visualContainers;u<c.length;u++){var p=c[u],d=p.config.singleVisual,f=d.objects,v=this.visualPlugins.capabilities(d.visualType);r.StaticResourceReferences.addObjectsReferences(f,v&&v.objects,e.resourcePackages,t)}}return t},i.prototype.addItemReference=function(e,t,i,n){if(n&&i){var o=w.findItemInPackages(t,i,n);if(o){var a=w.ensurePackageName(i);r.StaticResourceReferences.addItemReference(e,a,i,n,o.type)}}},i.prototype.parseExplorationConfigs=function(e){var t=this;if(e){var r=this.parseConfig(e);return r.sections=_.map(e.sections,(function(e){return t.parsePageConfigs(e)})),r}},i.prototype.parseConfig=function(e){var t=_.clone(e);return t.config=x.tryParseJSON(e.config)||{},t},i.prototype.parsePageConfigs=function(e){var t=this,r=this.parseConfig(e);return r.visualContainers=_.map(e.visualContainers,(function(e){return t.parseConfig(e)})),r},i.prototype.stringifyExplorationConfigs=function(e){var t=this,r=this.stringifyConfig(e);return r.sections=_.map(e.sections,(function(e){return t.stringifyPageConfigs(e)})),r},i.prototype.stringifyConfig=function(e){var t=_.clone(e);return t.config=JSON.stringify(e.config),t},i.prototype.stringifyPageConfigs=function(e){var t=this,r=this.stringifyConfig(e);return r.visualContainers=_.map(e.visualContainers,(function(e){return t.stringifyConfig(e)})),r},i.prototype.parseFilterCollectionConfig=function(e){if(e)return this.parseConfig(e)},i.prototype.stringifyFilterCollectionConfig=function(e){if(e)return this.stringifyConfig(e)},i})();r.OldestSaveVersion=g.v3_14;var z=(function(){function i(e,t,i,n){this.visualPlugins=e,this.explorationDowngrader=t,this.telemetryService=i,this.featureSwitchService=n,this.version=r.OldestSaveVersion}return i.prototype.serializeExploration=function(e,t){var r=this,i=e.sections;t&&t.withTransientPages||(i=l.Section.filterTransient(i));var n,o=_.map(i,(function(e,i){return r.serializePage(e,i,t)}));_.isEmpty(e.pods)||(this.removeInvalidPods(e.sections,e.pods,this.telemetryService),n=_.map(e.pods,(function(e){return r.serializePod(e)})));var a=this.serializeExplorationShallowWithResourcePackages(e,t);return a.sections=o,a.pods=n,t&&t.forSave&&this.explorationDowngrader.downgrade(a,this.version),a},i.prototype.serializeBookmarks=function(e,t){var i=this;if(e){var n=h.v1_0,o=_.map(e,(function(e){if(s.isBookmarkGroup(e)){var o={displayName:e.displayName,name:e.name,children:i.serializeBookmarks(e.children,t)};return i.version=D.max(i.version,m.BookmarkGroup),o}r.ExplorationState.clearUnusedReferences(e.explorationState,t);var a={displayName:e.displayName,name:e.name,explorationState:r.ExplorationState.serialize(e.explorationState)};return n=D.max(a.explorationState.version,n),e.options&&(a.options=i.serializeBookmarkOptions(e.options),i.version=D.max(i.version,m.BookmarkOptions)),a}));switch(n){case h.v1_0:this.version=D.max(this.version,m.bookmarks);break;case h.v1_1:this.version=D.max(this.version,m.ExplorationState_v1_1);break;case h.v1_2:this.version=D.max(this.version,m.ExplorationState_v1_2);break;case h.v1_3:this.version=D.max(this.version,m.ExplorationState_v1_3);break;case h.v1_4:this.version=D.max(this.version,m.ExplorationState_v1_4);break;case h.v1_5:this.version=D.max(this.version,m.VisualFilterExpressionMetadata);break;case h.v1_6:this.version=D.max(this.version,m.AllowInlineExploration)}return o}},i.prototype.serializeBookmarkOptions=function(e){return e},i.prototype.serializeQnaAction=function(e){if(e){var t=e.suggestedUtterances;if(!_.isEmpty(t)){return{suggestedUtterances:_.map(t,(function(e){return r.UtteranceDefinitionSerializer.serialize(e)}))}}}},i.prototype.serializeExplorationShallowWithResourcePackages=function(e,t){var i=e.activeSectionIndex,n=this.createVersionedElementConfig(r.OldestSaveVersion);if(this.version=D.max(this.version,n.version),n.themeCollection=N.cloneThemeCollection(e.themeCollection),_.isNumber(i)&&(n.activeSectionIndex=i),_.isEmpty(e.modelExtensions)||(this.version=D.max(this.version,g.v3_0),n.modelExtensions=this.serializeModelExtensions(e.modelExtensions)),!_.isEmpty(e.bookmarks)){var o=this.serializeBookmarks(e.bookmarks,e);n.bookmarks=o}t&&t.excludeHighContrastTheme&&delete n.themeCollection.highContrastTheme,t&&t.forSave&&delete n.themeCollection.transientUserSetTheme;var a=e.themeCollection.baseTheme;if(a&&(this.version=D.max(this.version,r.upgrade.getVersionForBaseTheme(a.name))),T.isNullOrUndefinedOrWhiteSpaceString(e.dataSourceVariables)||(this.version=D.max(this.version,g.v4_2),n.dataSourceVariables=e.dataSourceVariables),e.tags&&(n.tags=e.tags),null!=e.defaultDrillFilterOtherVisuals&&(n.defaultDrillFilterOtherVisuals=e.defaultDrillFilterOtherVisuals,e.defaultDrillFilterOtherVisuals&&(this.version=D.max(this.version,m.SectionCrossDrill))),null!=e.filterSortOrder&&(n.filterSortOrder=e.filterSortOrder,e.filterSortOrder&&(this.version=D.max(this.version,m.FiltersSort))),e.slowDataSourceSettings){var s=_.cloneDeep(e.slowDataSourceSettings);(s.isCrossHighlightingDisabled||s.isFieldWellButtonEnabled||s.isFilterSelectionsButtonEnabled||s.isSlicerSelectionsButtonEnabled||s.isApplyAllButtonEnabled)&&(this.version=s.isApplyAllButtonEnabled?D.max(this.version,m.ApplyAll):D.max(this.version,m.slowDataSource)),
n.slowDataSourceSettings=s}if(null!=e.linguisticSchemaSyncVersion&&(n.linguisticSchemaSyncVersion=e.linguisticSchemaSyncVersion,e.linguisticSchemaSyncVersion!==S.Unspecified&&(this.version=D.max(this.version,m.LinguisticSchemaSyncVersion))),e.settings){var c=_.cloneDeep(e.settings);(c.isPersistentUserStateDisabled||c.hideVisualContainerHeader)&&(this.version=D.max(this.version,m.ExplorationSettings)),c.useStylableVisualContainerHeader&&(this.version=D.max(this.version,m.StylableVisualContainerHeader)),void 0!==c.exportDataMode&&0!==c.exportDataMode&&(this.version=D.max(this.version,m.ExportDataMode)),c.useNewFilterPaneExperience&&(this.version=D.max(this.version,m.NewFilterPaneExperience)),c.isReportAnnotationsDisabled&&(this.version=D.max(this.version,m.ReportAnnotations)),c.defaultFilterActionIsDataFilter===!0&&(this.version=D.max(this.version,m.DefaultFilterAction)),c.useCrossReportDrillthrough&&(this.version=D.max(this.version,m.CrossReportDrillthrough)),c.allowChangeFilterTypes&&(this.version=D.max(this.version,m.AllowChangeFilterTypes)),c.allowInlineExploration&&(this.version=D.max(this.version,m.AllowInlineExploration)),c.optOutNewFilterPaneExperience&&(this.version=D.max(this.version,m.MigrateFilterPaneExperience)),c.filterPaneHiddenInEditMode&&(this.version=D.max(this.version,m.FilterPaneHiddenInEditMode)),c.disableFilterPaneSearch&&(this.version=D.max(this.version,m.DisableFilterPaneSearch)),n.settings=c}e.objects&&(n.objects=this.serializeObjects(e.objects,l.ExplorationObjectDescriptors,"report")),t&&t.forSave?this.version=this.explorationDowngrader.getFinalExplorationVersion(e,this.version):this.version=u;var p=this.serializeFilterContainers(e.filters,t);return n.version=this.version,{id:e.id,report:e.report,reportId:e.reportId,theme:e.themeCollection.customTheme&&e.themeCollection.customTheme.name,filters:p,resourcePackages:this.serializeResourcePackages(e.resourcePackages,t),sections:void 0,config:n,layoutOptimization:this.getLayoutOptimizations(e)}},i.prototype.serializeLinkField=function(e){var t=e.fieldExpr;return{asAggregation:e.asAggregation,fieldExpr:V.serializeExpr(t)}},i.prototype.serializeFilterCollection=function(e){if(!_.isEmpty(e)){var t=this.createVersionedElementConfig(r.OldestSaveVersion);return{filters:this.serializeFilterContainers(e),config:t}}},i.prototype.serializePage=function(e,t,r){var i=this.serializePageShallow(e,t,r);if(i.visualContainers=[],e.visualContainerGroups)this.serializeVisualContainerTreeToList(e.visualContainerGroups,i.visualContainers,r);else for(var n=0,o=e.visualContainers;n<o.length;n++){var a=o[n];i.visualContainers.push(this.serializeVisualContainer(a,r))}return i},i.prototype.serializeVisualContainerTreeToList=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var o=n[i];l.isVisualContainerGroup(o)?(t.push(this.serializeVisualContainerGroup(o)),this.serializeVisualContainerTreeToList(o.children,t,r)):t.push(this.serializeVisualContainer(o,r))}},i.prototype.isRegularPageUsingMeasureDrillthrough=function(e){var t=!1,r=!1;return e.type&&0!==e.type||(t=e.acceptsAllFiltersWhenLinked===!0,r=_.some(e.filters,(function(e){return 5===e.howCreated&&!e.isTransient&&(e.isLinkedAsAggregation||e.expression&&F.isMeasure(e.expression))}))),t||r},i.prototype.isMeasureDrillthroughPod=function(e){var t=!1,r=!1;return 1===e.type&&(t=e.config&&0===e.config.acceptsFilterContext,r=_.some(e.parameters,(function(e){return e.asAggregation||e.fieldExpr&&F.isMeasure(e.fieldExpr)}))),t||r},i.prototype.serializePageShallow=function(e,t,r){var i=this,n={id:e.id,name:e.name,displayName:e.displayName,filters:this.serializeFilterContainers(e.filters,r),ordinal:t,visualContainers:void 0,transient:e.transient,objectId:e.objectId,config:{}};e.size&&(n.displayOption=e.size.displayOption,n.width=e.size.width,n.height=e.size.height);var o=n.config;return _.isEmpty(e.relationships)||(o.relationships=this.serializeRelationships(e.relationships),r&&r.featureUsage&&(r.featureUsage.hasVisualRelationships=!0)),e.objects&&(o.objects=this.serializeObjects(e.objects,l.Section.objectDescriptors,"page")),null!=e.visibility&&(o.visibility=e.visibility,this.version=D.max(this.version,m.SectionVisibility)),null!=e.type&&(o.type=e.type,this.version=D.max(this.version,m.CanvasTooltips)),null!=e.filterSortOrder&&(o.filterSortOrder=e.filterSortOrder,this.version=D.max(this.version,m.FiltersSort)),o.acceptsAllFiltersWhenLinked=e.acceptsAllFiltersWhenLinked,this.isRegularPageUsingMeasureDrillthrough(e)&&(this.version=D.max(this.version,m.MeasureDrillthrough)),_.isEmpty(e.linkFields)||(o.linkFields=_.map(e.linkFields,(function(e){return i.serializeLinkField(e)})),this.version=D.max(this.version,m.CanvasTooltips)),n},i.prototype.serializePod=function(e){var t=this.serializePodParameters(e.parameters);return this.isMeasureDrillthroughPod(e)&&(this.version=D.max(this.version,m.MeasureDrillthrough)),1===e.referenceScope&&(this.version=D.max(this.version,m.CrossReportDrillthrough)),{id:e.id,name:e.name,boundSection:e.boundSection,parameters:_.isEmpty(t)?void 0:JSON.stringify(t),cortanaEnabled:e.cortanaEnabled?e.cortanaEnabled:void 0,type:0!==e.type?e.type:void 0,referenceScope:0!==e.referenceScope?e.referenceScope:void 0,config:this.serializePodConfig(e.config)}},i.prototype.serializeVisualContainer=function(r,i){var n,o=this.serializeVisualContainerConfig(r,i),a=r.layouts&&r.layouts.withId(0);if(a?(n={id:r.id,x:a.position.x,y:a.position.y,z:a.position.z,width:a.position.width,height:a.position.height,config:o,filters:this.serializeFilterContainers(r.filters)},a.position.tabOrder&&(n.tabOrder=a.position.tabOrder)):n={id:r.id,config:o,filters:this.serializeFilterContainers(r.filters)},!_.isEmpty(r.filters)){var s=this.visualPlugins.capabilities(r.config.singleVisual.visualType);t.FilterUtils.supportsFilterOutput(s)&&(this.version=D.max(this.version,m.VisualLevelSlicerFilters))}return i&&i.withVisibility&&(null!=r.visibility&&(n.visibility=r.visibility),null!=r.detailVisualLayout&&(n.detailVisualLayout=r.detailVisualLayout)),i&&r.cachedData&&((i.withQuery||i.withData)&&(n.query=r.cachedData.queryObject?JSON.stringify(r.cachedData.queryObject):r.cachedData.query,n.dataTransforms=r.cachedData.transformsObject?e.data.services.DataViewTransformActionsSerializer.serializeTransformActions(r.cachedData.transformsObject):r.cachedData.transforms,n.dataUpdatedTime=r.cachedData.dataUpdatedTime?r.cachedData.dataUpdatedTime.toISOString():void 0),i.withData&&(n.dataBinaryBase64Encoded=r.cachedData.dataObject?jsCommon.GzipUtility.compress(JSON.stringify(r.cachedData.dataObject)):r.cachedData.data)),n},i.prototype.serializeVisualContainerGroup=function(e){this.version=D.max(this.version,m.VisualContainerGrouping);var t={name:e.name,layouts:_.cloneDeep(e.layouts),singleVisualGroup:{displayName:e.displayName,groupMode:e.groupMode,isHidden:e.isHidden}};e.parentGroup&&(t.parentGroupName=e.parentGroup.name),e.objects&&(t.singleVisualGroup.objects=this.serializeObjects(e.objects,I.objectDescriptors,I.objectType));var r,i=e.layouts&&e.layouts.withId(0);return r=i?{id:e.id,x:i.position.x,y:i.position.y,z:i.position.z,width:i.position.width,height:i.position.height,config:t}:{id:e.id,config:t}},i.prototype.serializeModelExtensions=function(e){var t=this;if(e)return _.map(e,(function(e){return{name:e.name,extends:e.extends,entities:t.serializeModelExtensionEntities(e.entities)}}))},i.prototype.serializeRelationship=function(e){return{source:e.source.name,target:e.target.name,type:e.type}},i.prototype.serializeVisualContainerConfig=function(i,a){var s=i.config&&i.config.singleVisual,l=s.query,u={name:i.name,layouts:_.cloneDeep(i.layouts),singleVisual:{visualType:s.visualType,projections:this.serializeQueryProjections(l?l.projections:void 0),prototypeQuery:l?V.serializeQuery(l.defn):void 0}};if(_.some(i.layouts,(function(e){return e.position&&void 0!==e.position.tabOrder}))&&(this.version=D.max(this.version,m.VisualTabOrders)),l&&f.hasExpansionState(l.expansionStates)){var c=v.serializeExpansionStates(l.expansionStates);_.isEmpty(c)||(u.singleVisual.expansionStates=c,this.version=D.max(this.version,m.ExpandCollapse))}var d=s.columnProperties;if(d&&!_.isEmpty(d)&&(this.version=D.max(this.version,g.v3_4),u.singleVisual.columnProperties=_.cloneDeep(d)),s.queryOptions&&(null!=s.queryOptions.allowBinnedLineSample&&(this.version=D.max(this.version,g.v3_3)),null!=s.queryOptions.allowOverlappingPointsSample&&(this.version=D.max(this.version,g.v3_5)),null!=s.queryOptions.keepProjectionOrder&&(this.version=D.max(this.version,g.v4_1)),u.singleVisual.queryOptions=_.cloneDeep(s.queryOptions)),s.display&&(this.version=D.max(this.version,m.visualHidden),u.singleVisual.display=_.cloneDeep(s.display)),l&&l.defn){var h=l.defn.select();if(_.some(h,(function(e){return F.isFilteredEval(e.expr)}))&&(this.version=D.max(this.version,g.v3_5)),s.visualType===e.visuals.plugins.slicer.name){var y=l.projections;y&&y[e.visuals.slicerRoles.value]&&y[e.visuals.slicerRoles.value].all().length>1&&(this.version=D.max(this.version,m.HierarchicalSlicer))}}var C=this.serializeShowAllRoles(l?l.projections:void 0);_.isEmpty(C)||(u.singleVisual.showAllRoles=C,a&&a.featureUsage&&(a.featureUsage.hasShowAllEnabled=!0)),s.visualType===e.visuals.plugins.ribbonChart.name&&(this.version=D.max(this.version,g.v3_5)),s.visualType===e.visuals.plugins.actionButton.name&&(this.version=D.max(this.version,m.ActionButton)),s.visualType===e.visuals.plugins.pythonVisual.name&&(this.version=D.max(this.version,g.v3_17)),s.visualType===e.visuals.plugins.keyDriversVisual.name&&(this.version=D.max(this.version,g.v4_1),s.query&&!_.isEmpty(s.query.tryGetExprs(e.visuals.keyDriverRoleNames.details))&&(this.version=D.max(this.version,m.KeyDriversDetails))),s.visualType===e.visuals.plugins.qnaVisual.name&&(this.version=D.max(this.version,g.v5_4)),s.visualType===e.visuals.plugins.azureMap.name&&(this.version=D.max(this.version,g.v5_5)),s.visualType===e.visuals.plugins.decompositionTreeVisual.name&&(this.version=D.max(this.version,g.v5_5)),s.syncGroup&&(u.singleVisual.syncGroup=_.cloneDeep(s.syncGroup),this.version=D.max(this.version,m.VisualSyncGroup)),null!=i.drillFilterOtherVisuals&&(u.singleVisual.drillFilterOtherVisuals=i.drillFilterOtherVisuals,this.version=D.max(this.version,m.SectionCrossDrill)),null!=i.filterSortOrder&&(u.singleVisual.filterSortOrder=i.filterSortOrder,this.version=D.max(this.version,m.FiltersSort)),i.parentGroup&&(u.parentGroupName=i.parentGroup.name,this.version=D.max(this.version,m.VisualContainerGrouping)),s.hasDefaultSort&&(u.singleVisual.hasDefaultSort=s.hasDefaultSort);var x=l?s.query.defn.select():jsCommon.ArrayExtensions.createWithName();if(s.objects){var S=this.visualPlugins.capabilities(s.visualType),b=S&&S.objects;if(u.singleVisual.objects=this.serializeObjects(s.objects,b,s.visualType,x),o(s)){var E=!1,w=function(e,t,r,i,n){"fill"===t&&"dataPoint"===i&&null!=r&&(E=!0)};p.visitPropertyDefinitions(s.objects,b,w),E&&(this.version=D.max(this.version,g.v5_1))}}var P=s.vcObjects;if(P){u.singleVisual.vcObjects=this.serializeObjects(P,R.CommonObjectDescriptors,s.visualType,x);var T=p.getObjectDefinition(P,"visualLink",void 0),N=T&&T.properties.qna;N&&(u.singleVisual.vcObjects.visualLink[0].properties.qna=this.serializeQnaAction(N))}return s.cachedFilterDisplayItems&&(u.singleVisual.cachedFilterDisplayItems=r.DisplayNameSerializer.serializeFilterLabelIdPairs(s.cachedFilterDisplayItems)),s.filterExpressionMetadata&&(u.singleVisual.filterExpressionMetadata=t.FilterExpressionMetadataUtils.serializeFilterExpressionMetadata(s.filterExpressionMetadata),this.version=D.max(this.version,m.VisualFilterExpressionMetadata)),this.version<m.DotPlotVisual&&n(s)&&(this.version=m.DotPlotVisual),u},i.prototype.serializeObjects=function(e,t,r,i){var n=d.serializeObjects(e,t);return this.setVersionForObjectDefinitions(e,t,r,i),n},i.prototype.isAtLatestVersion=function(){return this.version===u},i.prototype.setVersionForObjectDefinitions=function(t,i,n,o){var a=this;this.isAtLatestVersion()||(p.visitPropertyExprs({definitions:t,descriptors:i,visitor:function(e,t,i,n){a.version=D.max(r.upgrade.getVersionForSQExpr(e,n),a.version)}}),p.visitPropertyDefinitions(t,i,(function(i,s,l,u,c){var d=c&&c.properties[s],f=function(){var e=p.getValue(t,{objectName:u,propertyName:s},l);if(e){var r=p.getDataBoundExprs(e,d.type,l,o);if(!_.isEmpty(r))return!0}return!1};a.version=D.max(a.version,e.data.DataViewObjectVersioning.getVersionForDefinition(r.upgrade.ObjectVersioning.added,i[s],l,n,u,s,a.version,f))})))},i.prototype.serializeShowAllRoles=function(e){if(e){var t=_.pickBy(e,(function(e){return e.showAll===!0}));return _.keys(t)}},i.prototype.serializeQueryProjections=function(e){if(e){var t={};for(var r in e){var i=e[r].all(),n=e[r].activeProjectionRefs;if(i.length>0){t[r]=[];for(var o=0,a=i;o<a.length;o++){var s=a[o],l=s.queryRef,u={queryRef:l};s.format&&(u.format=s.format),_.includes(n,l)&&(u.active=!0),t[r].push(u)}}}return t}},i.prototype.serializeModelExtensionEntities=function(t){var r=this;if(e.contract)return _.map(t,(function(e){var t={name:e.name};return e.extends&&(t.extends=e.extends),e.measures&&(t.measures=r.serializeModelExtensionMeasures(e.measures)),t}))},i.prototype.serializeExpressionReferences=function(e){if(e&&(e.unrecognizedReferences||!_.isEmpty(e.measures))){var t={unrecognizedReferences:e.unrecognizedReferences};return _.isEmpty(e.measures)||(t.measures=e.measures),t}},i.prototype.serializeModelExtensionAnnotations=function(e){if(e)return _.map(e,(function(e){return{name:e.name,value:e.value}}))},i.prototype.serializeModelExtensionMeasures=function(e){var t=this;if(e)return _.map(e,(function(e){var r={name:e.name,dataType:e.dataType,dataCategory:e.dataCategory,expression:e.expression,errorMessage:e.errorMessage,hidden:e.hidden,references:t.serializeExpressionReferences(e.references),formulaOverride:e.formulaOverride,formatInformation:e.formatInformation};return e.annotations&&(r.annotations=t.serializeModelExtensionAnnotations(e.annotations)),e.measureTemplate&&(r.measureTemplate={daxTemplateName:e.measureTemplate.daxTemplateName,version:e.measureTemplate.version}),e.description&&(r.description=e.description,t.version=D.max(t.version,m.description)),r}))},i.prototype.serializeFilterContainers=function(e,i){if(e){for(var n=[],o=0,a=e;o<a.length;o++){var s=a[o];(0!==s.howCreated||t.FilterUtils.isFilterModified(s))&&(!s.isTransient||i&&i.withTransientFilters)&&(7===s.howCreated&&i&&i.forSave&&(s.howCreated=1),5===s.howCreated&&(this.version=D.max(this.version,g.v3_5)),s.isHiddenInViewMode&&(this.version=D.max(this.version,m.FilterContainerVisibilityControl)),s.isLockedInViewMode&&(this.version=D.max(this.version,m.FilterContainerVisibilityControl)),s.displayName&&(this.version=D.max(this.version,m.RenameFilters)),s.ordinal&&(this.version=D.max(this.version,m.FiltersSort)),s.type===l.FilterType.RelativeTime&&(this.version=D.max(this.version,m.RelativeTimeFilter)),!s.filterExpressionMetadata||_.isEmpty(s.filterExpressionMetadata.expressions)||_.isEmpty(s.filterExpressionMetadata.cachedValueItems)||(this.version=D.max(this.version,m.FilterContainerFilterMetadata)),n.push({name:s.name,expression:s.expression?V.serializeExpr(s.expression):void 0,filter:s.filter?V.serializeFilter(s.filter):void 0,type:l.FilterType[s.type],restatement:s.restatement,cachedDisplayNames:r.DisplayNameSerializer.serializeFilterLabelIdPairs(s.cachedValueItems),howCreated:s.howCreated,isLinkedAsAggregation:s.isLinkedAsAggregation,isTransient:s.isTransient,objects:s.objects?this.serializeObjects(s.objects,C,y):void 0,isHiddenInViewMode:s.isHiddenInViewMode,isLockedInViewMode:s.isLockedInViewMode,filterExpressionMetadata:s.filterExpressionMetadata?t.FilterExpressionMetadataUtils.serializeFilterExpressionMetadata(s.filterExpressionMetadata):void 0,displayName:s.displayName,ordinal:s.ordinal}))}return JSON.stringify(n)}},i.prototype.createVersionedElementConfig=function(e){return{version:e}},i.prototype.serializeResourcePackages=function(e,t){if(!_.isEmpty(e)){for(var r=[],i=function(e){var i=_.find(e.items,(function(e){return e.type===E.CustomVisualMetadata}));if(i&&void 0!==i.content){var n=_.isString(i.content)?jsCommon.JsonExtensions.tryParseJSON(i.content):i.content;n&&(n.content=void 0,i.content=JSON.stringify(n))}var o=e.items;if(o){var a=["contentBlob","contentBlobUrl","promise"];t&&t.excludeResourceItemContent&&a.push("content"),o=_.map(o,(function(e){return _.omit(e,a)}))}r.push({resourcePackage:{id:e.id,name:e.name,type:e.type,items:o,disabled:!!e.disabled}})},n=0,o=e;n<o.length;n++){i(o[n])}return r}},i.prototype.getLayoutOptimizations=function(e){var t=this.getDistinctLayouts(e);return this.getLayoutOptimizationFromLayouts(t)},i.prototype.getLayoutOptimizationFromLayouts=function(e){for(var t=0,r=0,i=e;r<i.length;r++){switch(i[r].id){case 1:t|=1}}return t},i.prototype.getDistinctLayouts=function(e){for(var t=e.sections,r=a.createWithId(),i=0,n=t;i<n.length;i++)for(var o=n[i],s=0,l=o.visualContainers;s<l.length;s++)for(var u=l[s],c=0,p=u.layouts;c<p.length;c++){var d=p[c];r.withId(d.id)||r.push(d)}return r},i.prototype.serializePodParameters=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];t.push({name:n.name,boundFilter:n.boundFilter,fieldExpr:n.fieldExpr?V.serializeExpr(n.fieldExpr):void 0,asAggregation:n.asAggregation?n.asAggregation:void 0,isLegacySingleSelection:n.isLegacySingleSelection?n.isLegacySingleSelection:void 0})}return t}},i.prototype.serializePodConfig=function(e){var t="{}";return _.isEmpty(e)?t:0===e.acceptsFilterContext?t:JSON.stringify(e)},i.prototype.serializeRelationships=function(e){if(!_.isEmpty(e)){for(var t,r=0,i=e;r<i.length;r++){var n=i[r],o=this.serializeRelationship(n);o&&(t||(t=[])).push(o)}return t}},i.prototype.removeInvalidPods=function(t,r,i){var n=_.map(t,(function(e){return e.name})),o=_.remove(r,(function(e){return!_.includes(n,e.boundSection)})),a=_.size(o);if(a>0&&i.logEvent(e.telemetry.PodSerializationErrorFixed,"NonExistingBoundSection",a),!(_.size(r)<=_.size(t))){var s=_.groupBy(r,(function(e){return e.boundSection})),l=0;_.forEach(s,(function(e){var t=e.length;if(t>1){l++;for(var i=e[0].boundSection,n=_.findLastIndex(r,(function(e){return e.boundSection===i})),o=t-1;o>0&&n>=0;)r.splice(n,1),o--,n=_.findLastIndex(r,(function(e){return e.boundSection===i}),n-1)}})),l>0&&i.logEvent(e.telemetry.PodSerializationErrorFixed,"DuplicateBoundSection",l);var u=_.size(r)-_.size(t);u>0&&(r=r.slice(0,_.size(t)),i.logEvent(e.telemetry.PodSerializationErrorFixed,"ExceedingPodsNumberAfterInitialFix",u))}},i})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new n(e)}var r=jsCommon.Version,i=jsCommon.JsonExtensions;e.createExplorationUpgrader=t;var n=(function(){function t(t){this.versionUpgraders=[e.v1_0.createVersionUpgrader(),e.v2_0.createVersionUpgrader(),e.v2_2.createVersionUpgrader(),e.v2_3.createVersionUpgrader(),e.v2_5.createVersionUpgrader(),e.v3_6_1.createVersionUpgrader(),e.v3_12_1.createVersionUpgrader(),e.v3_14.createVersionUpgrader(t),e.v3_14_1.createVersionUpgrader(),e.v3_15.createVersionUpgrader(),e.v3_18.createVersionUpgrader(),e.v3_19.createVersionUpgrader(),e.v3_20.createVersionUpgrader(t),e.v3_24.createVersionUpgrader(),e.v4_1.createVersionUpgrader(),e.v4_2.createVersionUpgrader(),e.v5_1.createVersionUpgrader(),e.v5_3.createVersionUpgrader(),e.v5_9.createVersionUpgrader(t)]}return t.prototype.upgrade=function(e,t,r,i){if(this.upgradeElement(e,t,r,(function(e,t,r){return e.upgrade(t,r)}),i))return e},t.prototype.upgradeFilterCollection=function(e,t,r){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgradeFilterCollection(t)})))return e},t.prototype.getVersionUpgraders=function(){return this.versionUpgraders},t.prototype.upgradeElement=function(t,i,n,o,a){var s=this.getVersionedElementConfig(t),l=s.version&&_.isString(s.version)?s.version:r.ZeroStr;if(r.gt(l,e.CurrentExplorationVersion)){if(i.push({errorType:0}),!n)return}else{for(var u=0,c=this.versionUpgraders;u<c.length;u++){var p=c[u],d=p.getVersion();(r.lt(d,"2.2")||r.gt(d,l))&&(o(p,t,l),a&&a.upgraderCount++)}t.config.version=e.CurrentExplorationVersion}return t},t.prototype.getVersionedElementConfig=function(e){return _.isString(e.config)&&(e.config=i.tryParseJSON(e.config)),e.config||(e.config={version:r.ZeroStr}),e.config},t})()})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new d}var n=e.data.services.DataViewObjectSerializer,o=e.visuals.GradientUtils,a=jsCommon.JsonExtensions,s=e.visuals.labelStyle,l=e.visuals.plugins,u=e.data.services.SemanticQuerySerializer,c=e.data.SQExprBuilder,p=jsCommon.Version;r.createVersionUpgrader=i;var d=(function(){function r(){}return r.prototype.upgrade=function(e,t){if(e&&(e.filters=this.upgradeFilterContainers(e.filters),e.sections))for(var r=0,i=e.sections;r<i.length;r++){var n=i[r];if(n.filters=this.upgradeFilterContainers(n.filters),n.visualContainers)for(var o=0,a=n.visualContainers;o<a.length;o++){var s=a[o];s.filters=this.upgradeFilterContainers(s.filters);var l=s.config.singleVisual;if(l){var u=l.visualType||l.visualConfig.visualType;l.objects=this.upgradeVisualObjects(l.objects,u,t)}}}},r.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},r.prototype.getVersion=function(){return t.ExplorationVersions.v1_0},r.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=a.tryParseJSON(e);if(t)for(var r=0,i=t;r<i.length;r++){var n=i[r];this.upgradeFilterContainer(n)}return JSON.stringify(t)}},r.prototype.upgradeFilterContainer=function(e){if(!e.expression&&e.field){var t=f.fieldDef(e.field);t&&(e.expression=u.serializeExpr(t))}void 0===e.howCreated&&(e.howCreated=e.autoGenerated?0:1)},r.prototype.upgradeVisualObjects=function(e,t,r){switch(this.dropMalformedSelectors(e),t){case l.filledMap.name:return this.upgradeObjectsFilledMap(e);case l.card.name:return this.upgradeObjectsCard(e);case l.donutChart.name:case l.pieChart.name:return r&&p.gt(r,"1.0")?e:this.upgradeObjectsDonutChart(e)}return e},r.prototype.dropMalformedSelectors=function(e){if(e)for(var t in e){var r=e[t];if(r)for(var i=r.length-1;i>=0;i--){var n=r[i],o=n.selector;o&&(o.metadata||delete o.metadata,_.isEmpty(Object.keys(o))&&r.splice(i,1))}}},r.prototype.upgradeObjectsFilledMap=function(t){var r="dataPoint",i="fillRule";t||(t={});var a=t[r];a||(t[r]=a=[]);for(var s,l=0,u=a;l<u.length;l++){var c=u[l];if(!c.selector){s=c;break}}return s||(s={selector:null,properties:{}},a.push(s)),null==s.properties[i]&&(s.properties[i]=n.serializeObjectProperty(o.getDefaultFillRuleDefinition(),e.visuals.getFilledMapCapabilities().objects[r].properties[i])),t},r.prototype.upgradeObjectsCard=function(e){var t="cardTitle";if(e){var r=e[t];r&&(e.categoryLabels=r,delete e[t])}return e},r.prototype.upgradeObjectsDonutChart=function(t){var r="categoryLabels",i="labels",o="labelStyle",a="show";if(t){var l,p=this.getMetadataOnceObjectDefn(t,i),d=this.getPropertyExpr(p,a),f=!!d&&u.deserializeExpr(d).value,v=this.getMetadataOnceObjectDefn(t,r);if(v){var m=this.getPropertyExpr(v,a),h=!!m&&u.deserializeExpr(m).value;f&&h?l=s.categoryAndData:f&&!h?l=s.data:!f&&h&&(l=s.category),delete t[r]}else{p&&p.properties[o]||(l=f?s.categoryAndData:s.category)}if(null!=l){var g=e.visuals.donutChartCapabilities.objects[i].properties;if(!p){var y=t[i];y||(t[i]=y=[]),p=_.find(y,(function(e){return!e.selector})),p||(p={properties:{}},y.push(p))}p.properties[a]=n.serializeObjectProperty(c.boolean(!0),g[a]),p.properties[o]=n.serializeObjectProperty(c.text(l),g[o])}return t}},r.prototype.getMetadataOnceObjectDefn=function(e,t){if(e){var r=e[t];if(!_.isEmpty(r))return _.find(r,(function(e){return!e.selector}))}},r.prototype.getPropertyExpr=function(e,t){if(e){var r=e.properties[t];if(r)return r.expr}},r})();r.VersionUpgrader=d;var f;!(function(e){function t(e){return r(e)||i(e)||n(e)||o(e)}function r(e){var t=e.aggregate;if(void 0!==t){var r=i(e)||o(e);if(r)return c.aggregate(r,t)}}function i(e){var t=e.column;if(t){var r=o(e);if(r)return c.columnRef(r,t)}}function n(e){var t=e.measure;if(t){var r=o(e);if(r)return c.measureRef(r,t)}}function o(e){return c.entity(e.schema,e.entity,e.entityVar)}e.fieldDef=t})(f||(f={}))})(r=t.v1_0||(t.v1_0={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new i}t.createVersionUpgrader=r;var i=(function(){function t(){}return t.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var a=o[n],s=a.config;if(!s.layouts){var l={x:a.x,y:a.y,z:a.z,width:a.width,height:a.height};s.layouts=[{id:0,position:l}]}}}},t.prototype.upgradeFilterCollection=function(e){},t.prototype.getVersion=function(){return e.ExplorationVersions.v2_0},t})()})(t=e.v2_0||(e.v2_0={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new n}var i=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var n=(function(){function t(){}return t.prototype.upgrade=function(e){},t.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},t.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=i.tryParseJSON(e);if(t)for(var r=0,n=t;r<n.length;r++){var o=n[r];this.upgradeFilterContainer(o)}return JSON.stringify(t)}},t.prototype.upgradeFilterContainer=function(e){2!==e.howCreated||e.precedence||(e.precedence=0)},t.prototype.getVersion=function(){return e.ExplorationVersions.v2_2},t})()})(t=e.v2_2||(e.v2_2={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new u}var n=e.data.DataViewObjectDefinitions,o=e.data.services.DataViewObjectSerializer,a=e.visuals.plugins,s=e.visuals.slicerMode,l=e.data.SQExprBuilder;r.createVersionUpgrader=i;var u=(function(){function r(){}return r.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var a=o[n],s=a.config.singleVisual;if(s){var l=s.visualType||s.visualConfig.visualType;s.objects=this.upgradeVisualObjects(s.objects,l)}}}},r.prototype.upgradeFilterCollection=function(e){},r.prototype.getVersion=function(){return t.ExplorationVersions.v2_3},r.prototype.upgradeVisualObjects=function(e,t){return t===a.slicer.name?this.upgradeSlicerObjects(e):e},r.prototype.upgradeSlicerObjects=function(t){var r="data",i="mode";t||(t={});var a=n.ensure(t,r,null),u=e.visuals.getSlicerCapabilities().objects[r].properties;return null==a.properties[i]&&(a.properties[i]=o.serializeObjectProperty(l.text(s.basic),u[i])),t},r})();r.VersionUpgrader=u})(r=t.v2_3||(t.v2_3={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new a}var n=e.data.DataViewObjectDefinitions,o=e.visuals.plugins;r.createVersionUpgrader=i;var a=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var a=o[n],s=a.config.singleVisual;if(s){var l=s.visualType||s.visualConfig.visualType;s.objects=this.upgradeVisualObjects(s.objects,l)}}}},e.prototype.upgradeFilterCollection=function(e){},e.prototype.getVersion=function(){return t.ExplorationVersions.v2_5},e.prototype.upgradeVisualObjects=function(e,t){return t===o.gauge.name?this.upgradeGaugeTarget(e):e},e.prototype.upgradeGaugeTarget=function(e){var t="labels",r="target",i=["show","labelDisplayUnits","labelPrecision","color"];e||(e={});var o=n.getObjectDefinition(e,t,null);if(!o)return e;for(var a=n.ensure(e,r,null),s=0,l=i;s<l.length;s++){var u=l[s];null!=o.properties[u]&&(a.properties[u]=o.properties[u])}return e},e})();r.VersionUpgrader=a})(r=t.v2_5||(t.v2_5={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new s}var n=e.GeoJsonTypes,o=e.visualHost.utils.ResourcePackageUtils,a=e.contracts.ResourcePackageItemType;r.createVersionUpgrader=i;var s=(function(){function e(){}return e.prototype.upgrade=function(e){if(e){var t=e.resourcePackages||[],r=_.find(t,(function(e){return 2===e.resourcePackage.type})),i=!r;r=r||{resourcePackage:{id:void 0,items:[],name:o.ensurePackageName(2),type:2}};var n=r.resourcePackage.items;if(e.sections)for(var s=0,l=e.sections;s<l.length;s++){var u=l[s];if(u.visualContainers)for(var c=0,p=u.visualContainers;c<p.length;c++){var d=p[c],f=d.config.singleVisual;f&&this.upgradeSharedResourcePackages(f.objects,n)}}var v=e.config&&e.config.baseTheme;v&&(_.find(n,(function(e){return e.name===v}))||n.push({name:v,type:a.BaseTheme,path:"BaseThemes/"+v+".json"})),i&&r.resourcePackage.items.length>0&&(t.push(r),e.resourcePackages||(e.resourcePackages=t))}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationVersions.v3_6_1},e.prototype.upgradeSharedResourcePackages=function(e,t){for(var r in e)for(var i=0,o=e[r];i<o.length;i++){var s=o[i],l=function(e){var r=s.properties[e],i=r&&r.geoJson;if(i){var o=i.type.expr,l=o.Literal&&o.Literal.Value;if(l&&u.removeQuotes(l)===n.shared){var c=u.removeQuotes(i.name.expr.Literal.Value);_.find(t,(function(e){return e.name===c}))||t.push({name:c,type:a.ShapeMap,path:"Shapemaps/"+c+".json"})}}},u=this;for(var c in s.properties)l(c)}},e.prototype.removeQuotes=function(e){return e.substr(1,e.length-2)},e})();r.VersionUpgrader=s})(r=t.v3_6_1||(t.v3_6_1={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(e){return new n(e)}var i=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var n=(function(){function t(e){this.featureSwitchService=e}return t.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var n=r[t],o=n.config,a=i.tryParseJSON(n.filters)||[];1===o.type?this.upgradeTooltipPage(a,o):0!==o.type&&null!=o.type||this.upgradeRegularPage(a,o),n.filters=JSON.stringify(a)}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v3_14},t.prototype.upgradeTooltipPageLinkFields=function(e,t){var r=_.map(t.linkFields,(function(e){return{howCreated:5,isTransient:!1,isLinkedAsAggregation:e.asAggregation,expression:e.fieldExpr}}));e.push.apply(e,r),t.linkFields=[]},t.prototype.upgradeTooltipPage=function(e,t){t.acceptsAllFiltersWhenLinked=!0,this.upgradeTooltipPageLinkFields(e,t)},t.prototype.upgradeRegularPage=function(e,t){if(t.acceptsAllFiltersWhenLinked=!1,e)for(var r=0,i=e;r<i.length;r++){var n=i[r];n.isLinkedAsAggregation=!1}},t})();t.VersionUpgrader=n})(t=e.v3_14||(e.v3_14={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;
!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new i}t.createVersionUpgrader=r;var i=(function(){function t(){}return t.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var a=o[n],s=a.config.singleVisual;s&&this.upgradeSQExprToInt(s.objects)}}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v3_14_1},t.prototype.upgradeSQExprToInt=function(e){for(var t in e)if("labels"===t||"bubbles"===t||"categoryLabels"===t)for(var r=0,i=e[t];r<i.length;r++){var n=i[r];for(var o in n.properties)if("bubbleSize"===o||"labelDensity"===o||"backgroundTransparency"===o){var a=n.properties[o],s=a&&a.expr&&a.expr.Literal;s&&/^'\d+(\.\d+)?'$/.test(s.Value)&&(s.Value=this.convertLiteralSQTextIntoNumber(s.Value)+"L")}}},t.prototype.convertLiteralSQTextIntoNumber=function(e){return Math.floor(_.parseInt(e.substr(1,e.length-2)))},t})();t.VersionUpgrader=i})(t=e.v3_14_1||(e.v3_14_1={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new a}var n=e.data.services.SemanticQuerySerializer,o=e.data.SQExprBuilder;r.createVersionUpgrader=i;var a=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var s=a[n],l=s.config.singleVisual;if(l){var u={};if(l.altText&&(u.general=[{properties:{altText:this.toExpr(o.text(l.altText))}}],delete l.altText),l.aspectRatio){var c=l.aspectRatio;u.lockAspect=[{properties:{show:null!=c.show?this.toExpr(o.boolean(c.show)):void 0}}],delete l.aspectRatio}if(l.background){var p=l.background;u.background=[{properties:{color:null!=p.color?{solid:{color:this.toExpr(o.text(p.color))}}:void 0,show:null!=p.show?this.toExpr(o.boolean(p.show)):void 0,transparency:null!=p.transparency?this.toExpr(o.integer(p.transparency)):void 0}}],delete l.background}if(l.border){var d=l.border;u.border=[{properties:{color:null!=d.color?{solid:{color:this.toExpr(o.text(d.color))}}:void 0,show:null!=d.show?this.toExpr(o.boolean(d.show)):void 0}}],delete l.border}if(l.stylePresetName&&(u.stylePreset=[{properties:{name:this.toExpr(o.text(l.stylePresetName))}}],delete l.stylePresetName),l.title){var f=l.title;f.show=null!=f.hidden?!f.hidden:f.show,u.title=[{properties:{alignment:null!=f.alignment?this.toExpr(o.text(f.alignment)):void 0,background:null!=f.background?{solid:{color:this.toExpr(o.text(f.background))}}:void 0,fontColor:null!=f.fontColor?{solid:{color:this.toExpr(o.text(f.fontColor))}}:void 0,fontFamily:null!=f.fontFamily?this.toExpr(o.text(f.fontFamily)):void 0,fontSize:null!=f.fontSize?this.toExpr(o.integer(f.fontSize)):void 0,show:null!=f.show?this.toExpr(o.boolean(f.show)):void 0,text:null!=f.text?this.toExpr(o.text(f.text)):void 0}}],delete l.title}if(l.visualLink){var v=l.visualLink;u.visualLink=[{properties:{bookmark:null!=v.bookmark?this.toExpr(o.text(v.bookmark)):void 0,qna:v.qna,show:null!=v.show?this.toExpr(o.boolean(v.show)):void 0,type:null!=v.type?this.toExpr(o.text(v.type)):void 0}}],delete l.visualLink}if(l.visualTooltip){var m=l.visualTooltip;u.visualTooltip=[{properties:{section:null!=m.section?this.toExpr(o.text(m.section)):void 0,type:null!=m.type?this.toExpr(o.text(m.type)):void 0}}],delete l.visualTooltip}this.clearUndefinedPropertiesVCObjects(u),_.isEmpty(u)||(l.vcObjects=u)}}}},e.prototype.toExpr=function(e){return{expr:n.serializeExpr(e)}},e.prototype.clearUndefinedPropertiesVCObjects=function(e){for(var t in e){var r=e[t][0].properties;for(var i in r)r[i]||delete r[i];_.isEmpty(r)&&delete e[t]}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationVersions.v3_15},e})();r.VersionUpgrader=a})(r=t.v3_15||(t.v3_15={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new o}var n=e.explore.util.ThemeUtils;r.createVersionUpgrader=i;var o=(function(){function e(){}return e.prototype.upgrade=function(e){if(e){var t={},r=e.config;r.themeCollection=t,e.theme&&(t.customTheme=n.getThemeMetadata(e.theme,1,this.getVersion()),delete e.theme),r.baseTheme&&(t.baseTheme=n.getThemeMetadata(r.baseTheme,2,this.getVersion()),delete r.baseTheme)}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationVersions.v3_18},e})();r.VersionUpgrader=o})(r=t.v3_18||(t.v3_18={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new a}function i(e){var t="dataPoint",r="defaultCategoryColor";if(e&&e[t])for(var i=0,n=e[t];i<n.length;i++){var o=n[i];null==o.selector&&o.properties[r]&&(o.properties.fill=o.properties[r],delete o.properties[r])}}function n(t){return _.includes(e.DefaultCategoryColorVisualsToUpgrade,t)}var o=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var a=(function(){function t(){}return t.prototype.upgrade=function(e){if(e)for(var t=0,r=e.sections;t<r.length;t++)for(var a=r[t],s=0,l=a.visualContainers;s<l.length;s++){var u=l[s],c=u.config.singleVisual;if(c){var p=c.objects,d=c.visualType;if(!n(d))continue;i(p);var f=o.tryParseJSON(u.dataTransforms);if(f){var v=f.objects;i(v),u.dataTransforms=JSON.stringify(f)}}}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v3_19},t})();t.VersionUpgrader=a,t.upgradeDefaultCategoryColorToFill=i,t.needsToUpgradeDefaultCategoryColor=n})(t=e.v3_19||(e.v3_19={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new i}t.createVersionUpgrader=r;var i=(function(){function t(){}return t.prototype.upgrade=function(t){if(t&&!_.isEmpty(t.sections))for(var r=0,i=t.sections;r<i.length;r++)for(var n=i[r],o=0,a=n.visualContainers;o<a.length;o++){var s=a[o],l=s.config&&s.config.singleVisual;e.UpgradeUtils.updateSingleVisualConfigPxToPt(l)}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v4_2},t})();t.VersionUpgrader=i})(t=e.v4_2||(e.v4_2={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new s}function n(e){if(e&&e.config&&e.config.objects)for(var i=0,n=r.outspacePanePropertiesToUpdate;i<n.length;i++){var o=n[i];t.UpgradeUtils.upgradePropertyFromPxToPt(e.config.objects,o)}}function o(e){if(e&&e.config&&e.config.objects&&e.config.objects.filterCard)for(var r=e.config.objects.filterCard,i=0,n=r;i<n.length;i++){var o=n[i],s=o&&o.properties;if(s){var l=s.textSize;if(l){var u=a.deserializeExpr(l.expr);s.textSize=t.UpgradeUtils.toExpr(t.UpgradeUtils.pxToPtExpr(u))}}}}var a=e.data.services.SemanticQuerySerializer;r.createVersionUpgrader=i;var s=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&!_.isEmpty(e.sections))for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];n(i),o(i)}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationVersions.v5_1},e})();r.VersionUpgrader=s,r.outspacePanePropertiesToUpdate=[{objectName:"outspacePane",propertyName:"titleSize"},{objectName:"outspacePane",propertyName:"headerSize"}]})(r=t.v5_1||(t.v5_1={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new i}t.createVersionUpgrader=r;var i=(function(){function t(){}return t.prototype.upgrade=function(t){if(t&&!_.isEmpty(t.sections))for(var r=0,i=t.sections;r<i.length;r++)for(var n=i[r],o=0,a=n.visualContainers;o<a.length;o++){var s=a[o],l=s.config&&s.config.singleVisual;e.UpgradeUtils.updateSingleVisualConfigTextboxPxToPt(l)}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v5_3},t})();t.VersionUpgrader=i})(t=e.v5_3||(e.v5_3={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(e){var t={Version:u.v1_0,Utterance:e.utterance};return _.isEmpty(e.spans)||(t.Spans=_.map(e.spans,(function(e){return n(e)}))),t}function i(e){var t={utterance:e.Utterance};return _.isEmpty(e.Spans)||(t.spans=_.map(e.Spans,(function(e){return a(e)}))),t}function n(e){var t={StartIndex:e.StartIndex,Length:e.Length};return e.Binding&&(t.Binding=o(e.Binding)),t}function o(e){var t={};return e.Table&&(t.Table=e.Table),e.Pod&&(t.Pod=e.Pod),e.Property&&(t.Property=e.Property),e.Value&&(t.Value=e.Value),e.Range&&(t.Range=e.Range),null!=e.VisType&&(t.VisType=e.VisType),e.Composite&&(t.Composite=e.Composite),e.Core&&(t.Core=e.Core),_.isEmpty(t)?void 0:t}function a(e){var t={StartIndex:e.StartIndex,Length:e.Length};return e.Binding&&(t.Binding=s(e.Binding)),t.Source=1,t}function s(e){return __assign({},e)}var l=e.explore,u=l.services.upgrade.UtteranceDefinitionVersions;t.serialize=r,t.deserialize=i})(r=t.UtteranceDefinitionSerializer||(t.UtteranceDefinitionSerializer={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(t){var r={};if(t.explorationState)r.explorationState=e.ExplorationState.serialize(t.explorationState);else{var i=r.bookmarkRef={};t.bookmarkRef.ref?i.ref=t.bookmarkRef.ref:i.bookmark=e.WebBookmark.serialize(t.bookmarkRef.bookmark)}return r}function i(t,r){var i={};if(t.explorationState)i.explorationState=e.ExplorationState.deserialize(t.explorationState,r);else{var n=i.bookmarkRef={};if(t.bookmarkRef.ref)n.ref=t.bookmarkRef.ref;else{var o=e.WebBookmark.deserialize(t.bookmarkRef.bookmark,r);if(o.errors)return;n.bookmark=o.contract}}return i}t.serialize=r,t.deserialize=i})(t=e.UserState||(e.UserState={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createSchemaItemActivationService=t;var r=(function(){function t(e){this.eventBridge=e}return t.prototype.setActiveItem=function(e){_.isEqual(this.activeItems,e)||(this.activeItems=e,this.raiseEvent())},t.prototype.clearActiveItem=function(){this.activeItems&&(this.activeItems=null,this.raiseEvent())},t.prototype.getActiveItem=function(){return this.activeItems},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.schemaItemActivationChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.SQExprConverter;!(function(e){function t(e,t,r){var a=n.asFieldPattern(t,r),s=i.toFieldExprEntityItemPattern(a),l=s.schema,u=s.entity,c=o.createActiveSchemaItem(l,u,a);e.setActiveItem(c)}function r(e,t,r){if(e){for(var i=0,n=t.changes;i<n.length;i++){var o=n[i];if(o.itemDelete&&o.itemDelete.entity===e.entity&&(!o.itemDelete.property||e.property&&e.property===o.itemDelete.property||e.hierarchy&&e.hierarchy===o.itemDelete.property))return;o.entityRename&&e.entity===o.entityRename.before?e=__assign({},e,{entity:o.entityRename.after}):o.propertyRename&&e.entity===o.propertyRename.entity?(e.property&&e.property===o.propertyRename.before&&(e=__assign({},e,{property:o.propertyRename.after})),(e.hierarchy||e.hierarchyLevel)&&e.hierarchy===o.propertyRename.before&&"Hierarchy"===o.propertyRename.objectType&&(e=__assign({},e,{hierarchy:o.propertyRename.after}))):o.hierarchyLevelRename&&e.entity===o.hierarchyLevelRename.entity&&e.hierarchy===o.hierarchyLevelRename.hierarchy&&e.hierarchyLevel===o.hierarchyLevelRename.before?e=__assign({},e,{hierarchyLevel:o.hierarchyLevelRename.after}):o.measureMove&&e.entity===o.measureMove.source&&e.property===o.measureMove.property&&(e=__assign({},e,{entity:o.measureMove.destination}))}var a=r.schema(e.schema);if(a){if(a.entities.withName(e.entity)){if(e.property){return a.findProperty(e.entity,e.property)&&e}if(e.hierarchyLevel){return a.findHierarchyLevel(e.entity,e.hierarchy,e.hierarchyLevel)&&e}if(e.hierarchy){return a.findHierarchy(e.entity,e.hierarchy)&&e}return e}}}}e.setActiveSchemaItem=t,e.trackItemThroughModelChange=r})(r=t.schemaItemActivationUtils||(t.schemaItemActivationUtils={}));var o;!(function(e){function t(e,t,r){return{schema:e,entity:t,property:i.getPropertyName(r),hierarchy:i.getHierarchyName(r)||r.hierarchyLevel&&r.hierarchyLevel.name,hierarchyLevel:r.hierarchyLevel&&r.hierarchyLevel.level}}e.createActiveSchemaItem=t})(o=t.ActiveSchemaItemFactory||(t.ActiveSchemaItemFactory={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new o(e)}var n=e.explore.schemaRewriterUtils;r.createSchemaChangeHandler=i;var o=(function(){function e(e){this.visualPluginService=e}return e.prototype.apply=function(e,r){var i=n.createSchemaChangeRewriters(r),o=new a(i);t.util.traverseExploration(e,o,this.visualPluginService)},e})(),a=(function(e){function r(r){var i=this,n=new t.util.VisualContainerStateRewriter(r),o=new t.util.ExplorationStateRewriter(r,n),a=new s(r);return i=e.call(this,o,a)||this,i.rewriters=r,i}return __extends(r,e),r.prototype.visitFilterContainer=function(e){e&&t.util.rewriteFilterContainer(e,this.rewriters)},r.prototype.visitLinkField=function(e){e&&t.util.rewriteLinkField(e,this.rewriters)},r.prototype.visitPod=function(e){e&&t.util.rewritePod(e,this.rewriters)},r})(t.util.DefaultExplorationVisitor),s=(function(e){function t(t){var r=this;return r=e.call(this,t)||this}return __extends(t,e),t.prototype.visitSingleVisualConfig=function(t){e.prototype.visitSingleVisualConfig.call(this,t),t.conversionSourceContext=void 0},t})(t.util.VisualContainerRewriter);r.SchemaChangeVisualContainerRewriter=s})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){return new n(e,t,r)}e.createReportTileService=t;var r=10,i=2,n=(function(){function e(e,t,r){this.promiseFactory=e,this.explorationProxy=t,this.timeout=r,this.explorationJobsQueue=[],this.inProgressJobsQueue=[]}return e.prototype.getExploration=function(e,t){var r=this.promiseFactory.defer();return this.explorationJobsQueue.push({reportId:e,sectionId:t,deferred:r}),this.scheduleLoadExploration(),r.promise},e.prototype.scheduleLoadExploration=function(){var e=this;this.delayTimeout&&this.timeout.cancel(this.delayTimeout),this.delayTimeout=this.timeout((function(){e.loadExplorations()}),r)},e.prototype.loadExplorations=function(){var e=this,t=this.explorationJobsQueue;if(!_.isEmpty(t)){var r=t.shift();this.inProgressJobsQueue.push(r);var i=this.shouldRequestForAllSection(r.reportId,r.sectionId),n=r.reportId,o=i?null:r.sectionId;i&&(this.inProgressJobsQueue=this.inProgressJobsQueue.concat(_.remove(t,(function(e){return e.reportId===n}))));var a={id:n,sectionId:o,allowCache:!0};this.explorationProxy.get(a).then((function(t){e.processResult(a.id,a.sectionId,t)}),(function(){e.processResult(a.id,a.sectionId,null)})),this.loadExplorations()}},e.prototype.processResult=function(e,t,r){for(var i=[],n=0,o=this.inProgressJobsQueue;n<o.length;n++){var a=o[n];a.reportId!==e||_.isNumber(t)&&t!==a.sectionId?i.push(a):r?a.deferred.resolve(r):a.deferred.reject(r)}this.inProgressJobsQueue=i},e.prototype.shouldRequestForAllSection=function(e,t){if(null==t)return!0;var r=this.explorationJobsQueue;if(_.isEmpty(r))return!1;for(var n=0,o=0,a=r;o<a.length;o++){var s=a[o];if(s.reportId===e){if(null==s.sectionId)return!0;if(s.sectionId!==t&&n++,n>=i)return!0}}return!1},e})();e.ReportTileService=n})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var r,i=e.util.VisualContainerUtils,n=e.contracts.isVisualContainer;!(function(t){function r(e,t,r,i){var n=o.createSelectableCanvasItem(e);t.selectElement(n,r,i)}function a(e,t){var r=c(t);_.includes(r,e)&&s(_.without(r,e),t)}function s(e,t,r){var i=_.map(e,(function(e){return o.createSelectableCanvasItem(e)}));t.selectElements(i,!1,r)}function l(e,t){var r=c(t);return _.includes(r,e)}function u(e){return _.first(c(e))}function c(e){return _.chain(e.getSelectedElements()).map((function(e){return e.canvasItem})).compact().value()}function p(t){return _.chain(t.getSelectedElements()).filter((function(t){return e.contracts.isVisualContainer(t.canvasItem)})).map((function(e){return e.canvasItem})).compact().value()}function d(e){return c(e).length>1}function f(e){var t=c(e);if(1===t.length){var r=t[0];return n(r)?r:void 0}}function v(e){var t=c(e),r=t[0];if(r){var n=i.getVisualType(r);return _.every(t,(function(e){return i.getVisualType(e)===n}))?r:void 0}}t.selectCanvasItem=r,t.unselectCanvasItem=a,t.selectCanvasItems=s,t.isCanvasItemSelected=l,t.getSelectedCanvasItem=u,t.getSelectedCanvasItems=c,t.getSelectedVisualContainers=p,t.hasMultipleVisualContainerSelection=d,t.getSelectedVisual=f,t.getDefaultSelectedVisualInSingleOrMultiCase=v})(r=t.selectionUtils||(t.selectionUtils={}));var o;!(function(e){function t(e){return s.createFromCanvasItem(e)}e.createSelectableCanvasItem=t})(o=t.SelectableItemFactory||(t.SelectableItemFactory={}));var a;!(function(e){function t(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(!s.equals(e[r],t[r]))return!1;return!0}e.equals=t})(a=t.SelectableUtils||(t.SelectableUtils={}));var s=(function(){function e(){}return Object.defineProperty(e.prototype,"id",{get:function(){if(this._canvasItem)return this._canvasItem.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvasItem",{get:function(){return this._canvasItem},enumerable:!0,configurable:!0}),e.createFromCanvasItem=function(t){var r=new e;return r._canvasItem=t,r},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.id===t.id&&e.canvasItem===t.canvasItem)},e})();t.SelectableItem=s})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n,a){return new o(e,t,r,i,n,a)}var i=e.explore.util.VisualContainerUtils,n=e.explore.util.ScriptVisualsUtil;t.createScriptVisualsService=r;var o=(function(){function e(e,t,r,i,n,o){this.services={visualPlugin:e,featureSwitchService:t,localizationService:r,userInfo:i,embedModeService:n,licenseServiceExtend:o}}return e.prototype.addScriptVisualInfo=function(e,t){var r=i.getVisualType(e);if(this.services.visualPlugin.isScriptVisual(r)&&e.id){var o={id:e.id,scriptType:n.getScriptVisualType(r)};t.push(o)}},e.prototype.showEnableScriptVisualDialogIfRequired=function(e,t,r){return!1},e.prototype.getScriptVisualErrorDetails=function(e,t){var r,i=this.services.localizationService,n=this.services.featureSwitchService.featureSwitches;if(0!==e||n.scriptVisualEnabled){if(this.services.embedModeService&&this.services.embedModeService.isAnonymousLiveEmbed())return n.scriptVisualAnonymousEmbeddingEnabled||(r=this.buildErrorDetails(i.get(this.getLocalizationKey("Error_VisualsNotSupportedInEmbedReports",e)))),r;var o=this.getUserInfoForErrorDetails();if(o&&o.isViralTenant)r=this.buildErrorDetails(i.get(this.getLocalizationKey("Error_VisualsNotSupportedForViralTenant",e)));else if(n.rScriptVisualEnabled===!1)r=this.buildErrorDetails(i.get(this.getLocalizationKey("Error_VisualsDisabledByAdmin",e)));else{var a=!1,s=this.services.embedModeService&&this.services.embedModeService.isReportEmbedScenario();!this.services.licenseServiceExtend||Array.isArray(this.services.licenseServiceExtend)||s||(a=t&&this.services.licenseServiceExtend.isReportInPremiumCapacity(t)),!o||o.isPremiumUser||a||(r=this.buildErrorDetails(i.get(this.getLocalizationKey("Error_VisualsIsProFeature",e))))}}else r=this.buildErrorDetails(i.get(this.getLocalizationKey("Error_VisualsNotSupported",e)));return r},e.prototype.overrideEmbeddedErrorDetails=function(e,t){var r=this.services.embedModeService&&(this.services.embedModeService.isAppTokenEmbed()||this.services.embedModeService.isSaasEmbed()||this.services.embedModeService.isSecurePublishToWeb()),i=this.services&&this.services.localizationService;if(r&&t){var n=t;return n.helpLink="",n.message=i.get(this.getLocalizationKey("Error_VisualsEmbeddedText",e)),n.displayableErrorInfo=[{errorInfoKey:i.get(this.getLocalizationKey("Error_VisualsEmbeddedText",e)),errorInfoValue:i.get(this.getLocalizationKey("Error_VisualsErrorInEmbedReports",e))}],n}},e.prototype.getLocalizationKey=function(e,t){var r;switch(t){case 0:r="R";break;case 1:r="Py";break;default:r=""}return r+e},e.prototype.shouldBlockScriptVisual=function(e,t){var r=this.services.featureSwitchService.featureSwitches,i=this.getUserInfoForErrorDetails(),n=this.services.embedModeService&&this.services.embedModeService.isAnonymousLiveEmbed(),o=this.services.embedModeService&&this.services.embedModeService.isReportEmbedScenario();switch(e){case 0:if(n)return!r.scriptVisualAnonymousEmbeddingEnabled||!r.scriptVisualEnabled;var a=!1;return!this.services.licenseServiceExtend||Array.isArray(this.services.licenseServiceExtend)||o||(a=t&&this.services.licenseServiceExtend.isReportInPremiumCapacity(t)),!a&&(!r.scriptVisualEnabled||i&&i.isViralTenant||!r.rScriptVisualEnabled||i&&!i.isPremiumUser);case 1:return n?!r.scriptVisualAnonymousEmbeddingEnabled:(!this.services.licenseServiceExtend||Array.isArray(this.services.licenseServiceExtend)||o||(a=t&&this.services.licenseServiceExtend.isReportInPremiumCapacity(t)),!a&&(i&&i.isViralTenant||i&&!i.isPremiumUser))}},e.prototype.canLaunchExternalIDE=function(){return!1},e.prototype.launchExternalIDE=function(e){return null},e.prototype.openOptionsDialog=function(){return null},e.prototype.refreshScriptCustomVisuals=function(e){},e.prototype.buildErrorDetails=function(e){return{message:e,displayableErrorInfo:[],helpLink:"https://go.microsoft.com/fwlink/?linkid=829101",errorType:1}},e.prototype.getUserInfoForErrorDetails=function(){var e=this.services.userInfo,t=this.services.embedModeService&&this.services.embedModeService.isReportEmbedScenario();if(e&&!Array.isArray(e)&&!t){return{isViralTenant:e.userMetadata&&e.userMetadata.tenantMetadata&&0===e.userMetadata.tenantMetadata.tenantType,isPremiumUser:e.isPremiumUser}}},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return new o(e)}var i=jsCommon.ArrayExtensions,n=e.explore.services.SelectableItem;t.createSelectionService=r;var o=(function(){function r(t){var r=this;this.eventBridge=t,this.selectedElements=i.createWithId(),this.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.visualContainerControllerLinked,(function(e,t){r.focusedElement===t.visualContainer&&(t.focusCallback(),r.focusedElement=void 0)}))}return r.prototype.selectElement=function(e,t,r){this.selectElements([e],t,r)},r.prototype.selectElements=function(e,r,i){if(i&&!_.isEmpty(e)&&(this.focusedElement=_.first(e).canvasItem),!t.SelectableUtils.equals(e,this.selectedElements)){if(r||this.clearSelectionCore(!1),this.selectedElements.length){for(var o=this.selectedElements.length,a=0;a<o;a++)if(n.equals(this.selectedElements[a],e[0])){this.selectedElements.splice(a,1);break}o===this.selectedElements.length&&this.addISelectable(e)}else this.addISelectable(e);this.raiseEvent()}},r.prototype.clearSelection=function(){this.clearSelectionCore(!0)},r.prototype.addISelectable=function(e){this.selectedElements=i.extendWithId(this.selectedElements.concat(e))},r.prototype.clearSelectionCore=function(e){this.selectedElements=i.createWithId(),e&&this.raiseEvent()},r.prototype.getSelectedElements=function(){return this.selectedElements},r.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(t.events.selectionChanged)},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n,o,a,s,l,u,c,p){return new h(e,t,r,a,s,u,o,i,n,l,c,p)}function i(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n,o,a,s,l,u,p,d,f,v;return __generator(this,(function(m){switch(m.label){case 0:for(e=[],n=[],o=c.getExpectedModelExtension(t,r),a=0,s=o.entities;a<s.length;a++)for(l=s[a],u=0,p=l.measures;u<p.length;u++)d=p[u],d.references.unrecognizedReferences&&(n.push(d),e.push({context:{schema:o.name,entity:l.name,property:d.name},expression:d.expression}));return _.some(e)?[4,i.getMeasureReferences(t.modelExtensions,e)]:[2];case 1:for(f=m.sent(),v=0;v<f.length;v++)n[v].references={unrecognizedReferences:f[v].unrecognizedReferences,measures:f[v].measures};return[2]}}))}))}function n(t,r,i,n,o){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(a){switch(a.label){case 0:return[4,o.getMeasureReferences(t.modelExtensions,{context:{schema:r,entity:i,property:n.name},expression:n.expression})];case 1:return e=a.sent(),n.references={unrecognizedReferences:e.unrecognizedReferences,measures:e.measures},[2]}}))}))}function o(t,r,i,n){return __awaiter(this,void 0,e.Promise,(function(){var e,o,a,s,l,u,c,p,d,f,v;return __generator(this,(function(m){switch(m.label){case 0:for(e=[],o=[],a=0,s=t.entities;a<s.length;a++)for(l=s[a],u=0,c=l.measures;u<c.length;u++)p=c[u],d=_.findIndex(p.references.measures,r),d!==-1&&(o.push(p),e.push({context:{schema:t.name,entity:l.name,property:p.name},expression:p.expression}),i?p.references.measures[d]=i:p.references.measures.splice(d,1));return n?[4,n(e)]:[3,2];case 1:for(f=m.sent(),v=0;v<f.length;v++)o[v].expression=f[v];m.label=2;case 2:return[2]}}))}))}var a=e.data.dsr,s=e.explore.util,l=e.explore.util.FormatUtils,u=e.common.dialog.MessageDialogBuilder,c=e.explore.util.ModelExtensionUtils,p=e.explore.util.NameValidationError,d=e.data.contracts.primitiveTypeFromDataType,f=jsCommon.Utility,v={changes:[],hasQueryImpact:!1};t.createModelAuthoringService=r;var m;!(function(e){e.isNew="43dbc3e8-3a1c-4b6f-9923-b49ff7d6691c"})(m||(m={}));var h=(function(){function t(e,t,r,i,n,o,a,s,l,u,c,p){this.promiseFactory=e,this.telemetryService=t,this.modelChangeHandler=r,this.dataSourcesService=i,this.conceptualSchemaProxy=n,this.explorationSerializer=o,this.explorationNavigationService=a,a&&(this.services={cultureService:c,daxParserService:u,localizationService:l,promiseFactory:this.promiseFactory,telemetryService:this.telemetryService,modelAuthoringDialogService:new g(s,p)})}return t.prototype.apply=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.tryApply(t)];case 1:return e=r.sent(),[2]}}))}))},t.prototype.tryApply=function(e){var r=this;return this.lastChange=t.continueTaskUnconditionally(this.lastChange,(function(){return r.tryApplyCore(e)})),this.lastChange},t.prototype.tryApplyCore=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,i,n,o,a,s,l,u,c=this;return __generator(this,(function(p){switch(p.label){case 0:return this.services?(e=_.map(r.changes,(function(e){return c.getSchemaChangeExecutor(e)})),e=_.filter(e,(function(e){return e&&e.canExecute()})),e.length>0?(i=r.changes[0],n=e[0],this.logTelemetry(i),[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]):[3,7]):[3,7];case 1:o=p.sent(),a=this.explorationNavigationService.getCurrentExploration(),s=void 0,a.modelExtensions&&(s=this.explorationSerializer.serializeModelExtensions(a.modelExtensions)),this.onBeginModelChange(),l=v,p.label=2;case 2:return p.trys.push([2,4,5,7]),[4,n.execute(this.services,o,a)];case 3:return l=p.sent(),[2,!0];case 4:if(u=p.sent(),a.modelExtensions=s?this.explorationSerializer.deserializeModelExtensions(s):void 0,t.isHandledAuthoringError(u))return[2,!0];throw f.ensureError(u);case 5:return[4,this.onEndModelChange(l)];case 6:return p.sent(),[7];case 7:return[2,!1]}}))}))},t.prototype.onBeginModelChange=function(){this.pendingModelChangeDefer=this.promiseFactory.defer(),this.modelChangeHandler.applyChange({change:this.pendingModelChangeDefer.promise})},t.prototype.onEndModelChange=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return this.pendingModelChangeDefer.resolve({result:t}),this.pendingModelChangeDefer=null,e=this.promiseFactory.defer(),e.resolve(void 0),[4,e.promise];case 1:return r.sent(),[2]}}))}))},t.prototype.getSchemaChangeExecutor=function(e){return e.newMeasure?new C(e.newMeasure):e.newQuickCalc?new x(e.newQuickCalc):e.copyFormatting?new D(e.copyFormatting):e.propertyRename?new S(e.propertyRename):e.itemDelete?new b(e.itemDelete):e.updateCalculation?new E(e.updateCalculation):e.measureMove?new w(e.measureMove):e.setAnnotation?new V(e.setAnnotation):e.itemShowHide?new F(e.itemShowHide):e.setDataType?new P(e.setDataType):e.setDataCategory?new T(e.setDataCategory):e.setFormatting?new N(e.setFormatting):e.toggleThousandsSeparator?new R(e.toggleThousandsSeparator):e.setDecimalPlaces?new j(e.setDecimalPlaces):e.setDateTimeFormatInfo?new O(e.setDateTimeFormatInfo):e.setCurrencyFormatInfo?new M(e.setCurrencyFormatInfo):e.setDescription?new I(e.setDescription):void 0},t.prototype.logTelemetry=function(t){var r=Object.getOwnPropertyNames(t);this.telemetryService.logEvent(e.telemetry.EXModelChange,r[0])},t.createHandledAuthoringError=function(){var e=new Error;return e.suppressExceptionHandler=!0,e},t.isHandledAuthoringError=function(e){return e.suppressExceptionHandler},t.continueTaskUnconditionally=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:if(!t)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t];case 2:return i.sent(),[3,4];case 3:return e=i.sent(),[3,4];case 4:return[4,r()];case 5:return[2,i.sent()]}}))}))},t})();t.ModelAuthoringService=h;var g=(function(){function t(e,t){this.modalDialogService=e,this.uiBlockingService=t}return t.prototype.showDialog=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:this.uiBlockingService.beginAllowModalDialogs(),r.label=1;case 1:return r.trys.push([1,,3,4]),e=new u(this.modalDialogService),[4,e.show("model authoring message",t)];case 2:return[2,r.sent()];case 3:return this.uiBlockingService.endAllowModalDialogs(),[7];case 4:return[2]}}))}))},t})(),y=(function(){function e(e){this.schemaChangeBase=e}return e.prototype.canExecute=function(){return!!this.schemaChangeBase.schema},e.prototype.showMessage=function(e,t,r){var i={okButtonText:"OK_ButtonText",titleText:t,messageText:r};return e.modelAuthoringDialogService.showDialog(i)},e})(),C=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var o,s,u,p,d,f,v,h,g;return __generator(this,(function(y){if(o=r.schema(a.DefaultSchemaName),
!o||!o.capabilities.isExtendable)throw new Error("Attempting to extend a non-existent or non-extendable schema");return s=c.ensureEntityExists(n,this.schemaChange.schema,this.schemaChange.entity),u=e.explore.util.createNameValidator(r,t.localizationService),p=u.makeValidMeasureName(t.localizationService.get("NewMeasureName")),d={name:p,dataType:3,references:{unrecognizedReferences:!1,measures:[]},expression:"",hidden:!1},c.addMeasure(s,d),i(n,this.schemaChange.schema,t.daxParserService),f=new l(t.cultureService.getFormatInfo()),d.formatInformation=f.updateFormatUponDataTypeChange(d.dataType,d.formatInformation),v={schema:this.schemaChange.schema,objectType:"Measure",topLevelObjectName:s.name,property:d.name,annotationName:m.isNew,value:"true"},h=V.setAnnotation(v,n),g={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:d.name,expression:d.expression},[2,{changes:[{newMeasureCreated:g},h],hasQueryImpact:!0}]}))}))},r})(y),x=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n,o,a,l,u,p,d,f,v;return __generator(this,(function(m){switch(m.label){case 0:return e={newMeasure:{schema:this.schemaChange.schema,entity:this.schemaChange.entity}},n=new C(e.newMeasure),[4,n.execute(t,r,i)];case 1:return o=m.sent(),a=_.find(o.changes,(function(e){return e.newMeasureCreated})),l=s.createNameValidator(r,t.localizationService),u=l.makeValidMeasureName(this.schemaChange.name),p={updateCalculation:{schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:a.newMeasureCreated.name,expression:this.schemaChange.expression,anonymizedExpression:"",newName:u}},d=new E(p.updateCalculation),[4,d.execute(t,r,i)];case 2:return m.sent(),f=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,u),f.measureTemplate={daxTemplateName:this.schemaChange.daxTemplateName,version:0},v={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:u,expression:this.schemaChange.expression},[2,{changes:[{newMeasureCreated:v}],hasQueryImpact:!0}]}}))}))},r})(y),S=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var o,a,l;return __generator(this,(function(u){switch(u.label){case 0:return o=c.getExpectedMeasure(n,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.before),a=s.createNameValidator(r,t.localizationService),l=a.validateMeasureName(this.schemaChange.after,this.schemaChange.before),l.error===p.None?[3,2]:[4,this.showMessage(t,t.localizationService.get("RenameMeasureErrorTitle"),l.reason)];case 1:throw u.sent(),h.createHandledAuthoringError();case 2:return[4,this.fixupUponMeasureRename(t.daxParserService,n)];case 3:return u.sent(),o.name=this.schemaChange.after,[4,i(n,this.schemaChange.schema,t.daxParserService)];case 4:return u.sent(),o.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureEdited,o.measureTemplate.daxTemplateName),[2,{changes:[{propertyRename:this.schemaChange}],hasQueryImpact:!0}]}}))}))},r.prototype.fixupUponMeasureRename=function(e,t){var r=this,i={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.before},n={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.after},a=c.getExpectedModelExtension(t,this.schemaChange.schema);return debug&&c.getExpectedMeasure(t,i.schema,i.entity,i.name),o(a,i,n,(function(i){return e.renameMeasureReferences(t.modelExtensions,i,r.schemaChange.before,r.schemaChange.after)}))},r})(y),b=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:return r=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),c.removeMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),[4,this.fixupMeasureReferences(c.getOptionalModelExtension(i,this.schemaChange.schema))];case 1:return n.sent(),r.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureDeleted,r.measureTemplate.daxTemplateName),[2,{changes:[{itemDelete:this.schemaChange}],hasQueryImpact:!0}]}}))}))},r.prototype.showDeleteConfirmationDialog=function(e){var t={okButtonText:"Delete",cancelButtonText:"ModalDialogButtonText_Cancel",titleText:"DeleteMeasurePromptTitle",messageText:e.localizationService.format("DeleteMeasurePrompt",[this.schemaChange.property])};return e.modelAuthoringDialogService.showDialog(t)},r.prototype.fixupMeasureReferences=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return t?(e={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.property},[4,o(t,e,void 0)]):[2];case 1:return r.sent(),[2]}}))}))},r})(y),E=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var o,a,s,l,u,p,d,f;return __generator(this,(function(v){switch(v.label){case 0:return o=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),o.expression=this.schemaChange.expression,o.formulaOverride=this.schemaChange.expressionOverride&&this.schemaChange.expressionOverride.formula,o.errorMessage=this.schemaChange.errorMessage,t.telemetryService.logEvent(e.telemetry.EXMeasures,this.schemaChange.anonymizedExpression||"","ReportModelOperationUpdateMeasure"),o.formulaOverride&&(a={expression:o.formulaOverride,formula:o.formulaOverride}),s={updateExpression:{schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:this.schemaChange.property,expression:this.schemaChange.expression,errorMessage:this.schemaChange.errorMessage,expressionOverride:a}},[4,n(i,this.schemaChange.schema,this.schemaChange.entity,o,t.daxParserService)];case 1:return v.sent(),l=[s],this.schemaChange.newName===this.schemaChange.property?[3,3]:(u={propertyRename:{schema:this.schemaChange.schema,objectType:"Measure",entity:this.schemaChange.entity,before:this.schemaChange.property,after:this.schemaChange.newName}},p=new S(u.propertyRename),[4,p.execute(t,r,i)]);case 2:d=v.sent(),l.push.apply(l,d.changes),v.label=3;case 3:return o.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureEdited,o.measureTemplate.daxTemplateName),f={schema:this.schemaChange.schema,objectType:"Measure",topLevelObjectName:this.schemaChange.entity,property:this.schemaChange.newName,annotationName:m.isNew,value:null},l.push(V.setAnnotation(f,i)),[2,{changes:l,hasQueryImpact:!0}]}}))}))},r})(y),w=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var e,r,o;return __generator(this,(function(a){switch(a.label){case 0:return e=c.getExpectedModelExtension(n,this.schemaChange.schema),r=c.getExpectedMeasure(n,this.schemaChange.schema,this.schemaChange.source,this.schemaChange.property),o=c.getOrCreateExtendingEntity(e,this.schemaChange.destination),[4,this.fixupUponMeasureMove(t.daxParserService,n)];case 1:return a.sent(),c.removeMeasure(n,this.schemaChange.schema,this.schemaChange.source,this.schemaChange.property),c.addMeasure(o,r),[4,i(n,this.schemaChange.schema,t.daxParserService)];case 2:return a.sent(),[2,{changes:[{measureMove:this.schemaChange}],hasQueryImpact:!0}]}}))}))},r.prototype.fixupUponMeasureMove=function(e,t){var r=this,i=c.getExpectedModelExtension(t,this.schemaChange.schema),n={schema:this.schemaChange.schema,entity:this.schemaChange.source,name:this.schemaChange.property},a={schema:this.schemaChange.schema,entity:this.schemaChange.destination,name:this.schemaChange.property};return debug&&c.getExpectedMeasure(t,n.schema,n.entity,n.name),o(i,n,a,(function(i){return e.renameMovedMeasureTableReference(t.modelExtensions,i,r.schemaChange.property,r.schemaChange.source,r.schemaChange.destination)}))},r})(y),V=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.setAnnotation=function(e,t){var r=c.getExpectedMeasure(t,e.schema,e.topLevelObjectName,e.property);return c.setAnnotation(r,e.annotationName,e.value),{setAnnotation:e}},r.prototype.execute=function(t,i,n){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=r.setAnnotation(this.schemaChange,n),[2,{changes:[e],hasQueryImpact:!1}]}))}))},r})(y),F=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r,n,o,a,s,e;return __generator(this,(function(l){if(this.schemaChange.property)e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),e.hidden=this.schemaChange.makeHidden;else if(t=c.getOptionalModelExtension(i,this.schemaChange.schema))for(r=0,n=t.entities;r<n.length;r++)for(o=n[r],a=0,s=o.measures;a<s.length;a++)e=s[a],e.hidden=this.schemaChange.makeHidden;return[2,{changes:[{itemShowHide:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),P=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r,n,o;return __generator(this,(function(a){return r=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),n=r.dataType,r.dataType=d(this.schemaChange.dataType),o=new l(t.cultureService.getFormatInfo()),r.formatInformation=o.updateFormatUponDataTypeChange(r.dataType,r.formatInformation),t.telemetryService.logEvent(e.telemetry.EXReportMeasureDataTypeChange,e.PrimitiveTypeStrings[n],e.PrimitiveTypeStrings[r.dataType]),[2,{changes:[{setDataType:this.schemaChange}],hasQueryImpact:!0}]}))}))},r})(y),T=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r,n;return __generator(this,(function(o){return r=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),n=r.dataCategory,"Uncategorized"===this.schemaChange.dataCategory&&(this.schemaChange.dataCategory=void 0),r.dataCategory=this.schemaChange.dataCategory,t.telemetryService.logEvent(e.telemetry.EXReportMeasureDataCategoryChange,n,r.dataCategory),[2,{changes:[{setDataCategory:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),N=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.changeFormat(e.dataType,e.formatInformation,this.schemaChange.format),[2,{changes:[{setFormatting:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),D=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n,o;return __generator(this,(function(a){switch(a.label){case 0:return this.schemaChange.sourceSchema?(e=c.getExpectedMeasure(i,this.schemaChange.sourceSchema,this.schemaChange.sourceEntity,this.schemaChange.sourceProperty),n={setFormatting:{schema:this.schemaChange.schema,entity:this.schemaChange.targetEntity,property:this.schemaChange.targetProperty,format:e.formatInformation.format}},o=new N(n.setFormatting),[4,o.execute(t,r,i)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2,{changes:[{copyFormatting:this.schemaChange}],hasQueryImpact:!1}]}}))}))},r})(y),R=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.toggleThousandsSeparator(e.dataType,e.formatInformation),[2,{changes:[{toggleThousandsSeparator:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),I=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(r){return e=this.schemaChange,t=c.getExpectedMeasure(i,e.schema,e.topLevelObjectName,e.tableItemName),t.description=e.description,[2,{changes:[{setDescription:e}],hasQueryImpact:!1}]}))}))},r})(y),j=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.setAccuracy(e.dataType,e.formatInformation,this.schemaChange.decimalPlaces),[2,{changes:[{setDecimalPlaces:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),O=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.setDateTimeFormat(e.dataType,e.formatInformation,this.schemaChange.format,this.schemaChange.dateTimeCustomFormatGroup,this.schemaChange.formatString),[2,{changes:[{setDateTimeFormatInfo:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y),M=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=c.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new l(t.cultureService.getFormatInfo()),e.formatInformation=r.setCurrencyFormat(e.dataType,e.formatInformation,this.schemaChange.format,this.schemaChange.lcid,this.schemaChange.displayName,this.schemaChange.currencySymbol,this.schemaChange.positivePattern,this.schemaChange.negativePattern),[2,{changes:[{setCurrencyFormatInfo:this.schemaChange}],hasQueryImpact:!1}]}))}))},r})(y)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new s(e)}var n;!(function(e){e[e.None=0]="None",e[e.Basic=1]="Basic",e[e.Binning=2]="Binning",e[e.Clustering=3]="Clustering"})(n=r.GroupMode||(r.GroupMode={}));var o;!(function(e){e[e.Category=0]="Category",e[e.Number=1]="Number",e[e.DateTime=2]="DateTime"})(o=r.GroupDataType||(r.GroupDataType={}));var a;!(function(e){e[e.BySize=0]="BySize",e[e.ByCount=1]="ByCount"})(a=r.BinMode||(r.BinMode={})),r.createDisabledGroupAuthoringService=i;var s=(function(){function e(e){this.visual=new l,this.dialog=new u,this.telemetry=new c(e)}return e})(),l=(function(){function e(){}return e.prototype.canGroup=function(e,t,r){return!1},e.prototype.group=function(e,t,r,i,n){return null},e})(),u=(function(){function e(){}return e.prototype.showDialog=function(e){return null},e})(),c=(function(){function r(e){this.telemetryService=e}return r.prototype.logGroupActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinBySizeActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinByCountActionTelemetry=function(e,t,r,i,n,o){},r.prototype.logGroupsErrorTelemetry=function(e,t,r,i){},r.prototype.logGroupsDeleteTelemetry=function(e,t,r){},r.prototype.logGroupsUsageTelemetry=function(r,i,o,a,s,l){var u=this;r.then((function(r){var c=i.getConceptualProperty(r);if(c){var p=i.getTargetEntity().entity,d=t.utils.GroupUtils.getGroupMode(p,c,null);if(d!==n.None){var f=d===n.Binning?"Bin":"List";u.telemetryService.logEvent(e.telemetry.EXGroupsUsage,o,a,s,l,f)}}}))},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.register=function(e,t){var r=e();return{actionResult:r,succeeded:!(_.isBoolean(r)&&!r)}},e.prototype.getTopUndoFrame=function(){},e.prototype.canRedo=function(){return!1},e.prototype.canUndo=function(){return!1},e.prototype.canClear=function(){return!1},e.prototype.undo=function(){return!1},e.prototype.redo=function(){return!1},e.prototype.clear=function(){return!1},e.prototype.getReferences=function(){return{}},e})();e.UndoRedoNoOp=t})(t=e.undoRedoStrategy||(e.undoRedoStrategy={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(t,r,n){return void 0===n&&(n=new e.undoRedoStrategy.UndoRedoNoOp),new i(t,r,n)}var r=(function(){function e(e,t){this.visualContainerName=e,this.action=t}return e.prototype.equals=function(e){return!!e&&this.action===e.action&&this.visualContainerName===e.visualContainerName},e})();e.ActionIdentifier=r,e.createUndoRedoService=t;var i=(function(){function t(e,t,r){this.eventBridge=e,this.loggerService=t,this.strategy=r}return t.prototype.setStrategy=function(e){this.strategy=e,this.clear()},t.prototype.undo=function(){var e=this;this.verifyStrategy()&&this.canUndo()&&setTimeout((function(){e.strategy&&e.strategy.undo()&&(e.runSideEffects(),e.fireEvents())}))},t.prototype.redo=function(){var e=this;this.verifyStrategy()&&this.canRedo()&&setTimeout((function(){e.strategy&&e.strategy.redo()&&(e.runSideEffects(),e.fireEvents())}))},t.prototype.registerSideEffect=function(e){this.sideEffects||(this.sideEffects=[]),this.sideEffects.push(e)},t.prototype.clear=function(){this.verifyStrategy()&&(this.strategy.canClear()&&this.strategy.clear(),this.eventBridge.publishToChannel(e.events.undoRedoStackUpdated))},t.prototype.canRedo=function(){return this.verifyStrategy()&&this.strategy.canRedo()},t.prototype.canUndo=function(){return this.verifyStrategy()&&this.strategy.canUndo()},t.prototype.getTopUndoFrame=function(){return this.verifyStrategy()&&this.strategy.getTopUndoFrame()},t.prototype.undoRedoPostProcessing=function(e){this.loggerService.addUserAction({message:e,type:"UndoRedo"}),setTimeout(_.noop)},t.prototype.register=function(e,t,r){var i,n=!1;if(this.verifyStrategy()){var o=this.strategy.register(t,r);i=o.actionResult,n=o.succeeded}else i=t(),n=!(_.isBoolean(i)&&!i);return n&&(this.runSideEffects(e),this.fireEvents()),this.undoRedoPostProcessing(e),i},t.prototype.fireEvents=function(){this.eventBridge.publishToChannel(e.events.onReportChanged,{explorationContentChanged:!0}),this.eventBridge.publishToChannel(e.events.undoRedoStackUpdated)},t.prototype.runSideEffects=function(e){if(!_.isEmpty(this.sideEffects))for(var t=0,r=this.sideEffects;t<r.length;t++){var i=r[t];i.run(e)}},t.prototype.verifyStrategy=function(){return!!this.strategy},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.CircularStack,r=30,i=(function(){function e(e,i){this.handler=e,this.staticResourceReferences=i,this.undoStack=new t(r),this.redoStack=new t(r),this.staticResourceReferences.addReferenceSource(this)}return e.prototype.register=function(e,t){var r=this.captureUndoFrame(this.handler);r.recurringActionInfo=t;var i=this.canMergeWithTopFrame(t),n=this.startTransaction(r),o=e(),a=!(_.isBoolean(o)&&!o);return a?this.endTransaction(n,i):this.cancelTransaction(n),{succeeded:a,actionResult:o}},e.prototype.getReferences=function(){return this.addStackReferences(this.undoStack,this.addStackReferences(this.redoStack))},e.prototype.addStackReferences=function(e,t){t=t||{};for(var r=e.length;r-- >0;)_.merge(t,e.item(r).getReferences());return t},e.prototype.undo=function(){return!!this.canUndo()&&this.rollbackTop(this.undoStack,this.redoStack)},e.prototype.redo=function(){return!!this.canRedo()&&this.rollbackTop(this.redoStack,this.undoStack)},e.prototype.clear=function(){return this.undoStack.clear(),this.redoStack.clear(),!0},e.prototype.canRedo=function(){return this.redoStack.length>0},e.prototype.canUndo=function(){return this.undoStack.length>0},e.prototype.canClear=function(){return!0},e.prototype.getTopUndoFrame=function(){var e=this.undoStack.peek();return e?e.getFrame():void 0},e.prototype.canMergeWithTopFrame=function(e){if(!e)return!1;if(this.canUndo()){var t=this.getTopUndoFrame();if(t&&void 0!==t.recurringActionInfo&&t.recurringActionInfo.equals(e))return!0}return!1},e.prototype.rollbackTop=function(e,t){var r=e.pop();if(r){var i=r.rollbackFrame(),n=this.validTransactionCheck(i);return n&&t.push(i),n}},e.prototype.isIPromise=function(e){return e&&e.finally},e.prototype.startTransaction=function(e){var t=new o;return this.currentTransaction||(this.currentTransaction=t,this.currentTransaction.addUndoFrame(e)),this.currentTransaction},e.prototype.endTransaction=function(e,t){if(!t){this.redoStack.clear();this.validTransactionCheck(this.currentTransaction)&&this.undoStack.push(this.currentTransaction)}this.currentTransaction=void 0},e.prototype.cancelTransaction=function(e){this.currentTransaction=void 0},e.prototype.captureUndoFrame=function(e){return new n(e)},e.prototype.validTransactionCheck=function(e){return!!e},e})();e.UndoRedoStack=i;var n=(function(){function e(e,t){this.handler=e,this.snapshot=this.handler.takeSnapshot(t)}return e.prototype.rollbackFrame=function(){var t=new e(this.handler,this.snapshot);return this.handler.rollback(this.snapshot),t},e.prototype.getReferences=function(){return this.snapshot.getReferences&&this.snapshot.getReferences()},e})(),o=(function(){function e(e){this.frames=e||[]}return e.prototype.addUndoFrame=function(e){this.frames.push(e)},e.prototype.rollbackFrame=function(){return new e(_.map(this.frames,(function(e){if(e)return e.rollbackFrame()})))},e.prototype.getFrame=function(){return this.frames[0]},e.prototype.getReferences=function(){for(var e={},t=0,r=this.frames;t<r.length;t++){var i=r[t];_.merge(e,i.getReferences())}return e},e})()})(t=e.undoRedoStrategy||(e.undoRedoStrategy={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){function e(e,t){var r=[];if(t.columnProperties)for(var i=0,n=e;i<n.length;i++){var o=n[i],a=t.query.defn.selectNameOf(o),s=t.columnProperties[a];s&&r.push({originalExpr:o,columnProperty:s})}return r}function t(e,t,r,i){var n=_.find(i,(function(t){return t.originalExpr===e}));if(n){var o=r.query.defn.selectNameOf(t);r.columnProperties[o]||(r.columnProperties[o]=n.columnProperty)}}return{getColumnPropertiesForExprs:e,applyColumnPropertiesByExpr:t}}e.columnPropertiesAuthoringModuleFactory=t})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new P(e,t,r,i)}function n(e,t,r,i){function n(e,t,r,n){i&&i(e.objectName,e.selector,t,r,n,n&&e.properties&&e.properties[t])}if(!e)return!1;var l=!1;if(e.replace)for(var u=0,c=e.replace;u<c.length;u++){var p=c[u],d=s.ensure(r,p.objectName,p.selector),f={};for(var v in p.properties)a.isValidPropertyName(v)&&(f[v]=o(p,v,t));var m=d.properties;if(!s.allPropertiesAreEqual(m,f)){l=!0;for(var h=s.getUnequalProperties(m,f),g=0,y=h;g<y.length;g++){var v=y[g];n(p,v,m[v],f[v])}d.properties=f}}if(e.merge)for(var C=0,x=e.merge;C<x.length;C++){var p=x[C],d=s.ensure(r,p.objectName,p.selector);for(var v in p.properties)if(a.isValidPropertyName(v)){var S=o(p,v,t);s.propertiesAreEqual(d.properties[v],S)||(l=!0,n(p,v,d.properties[v],S),d.properties[v]=S)}}if(e.remove)for(var b=0,E=e.remove;b<E.length;b++){var p=E[b],d=s.getObjectDefinition(r,p.objectName,p.selector);if(d)for(var v in p.properties)a.isValidPropertyName(v)&&d.properties.hasOwnProperty(v)&&(l=!0,n(p,v,d.properties[v],void 0),delete d.properties[v])}if(e.removeObject)for(var _=0,w=e.removeObject;_<w.length;_++){var p=w[_],d=s.getObjectDefinition(r,p.objectName,p.selector);if(d){if(i)for(var v in d.properties)n(p,v,d.properties[v],void 0);l=s.deleteObjectDefinition(r,p.objectName,p.selector)||l}}return l}function o(e,t,r){var i,n=e.properties[t];return r&&r[e.objectName]&&r[e.objectName].properties[t]&&(i=r[e.objectName].properties[t].type),s.encodePropertyValue(n,i||{})}var a=e.data.DataViewObjectDefinition,s=e.data.DataViewObjectDefinitions,l=e.data.DataViewRoleWildcard,u=e.explore.util.DrillUtils,c=e.data.FieldExprPattern,p=e.visuals.GradientUtils,d=t.util.HierarchyUtils,f=jsCommon.JsonComparer,v=e.data.QueryProjectionCollection,m=e.data.QueryProjectionsByRole,h=e.data.ScopeIdentityExtractor,g=e.data.Selector,y=e.data.SemanticQuery,C=t.contracts.SingleVisualConfig,x=e.data.SQExpr,S=e.data.SQExprBuilder,b=e.data.SQExprConverter,E=e.explore.utils.SQExprToRoleDictionary,w=e.data.SQExprUtils,V=e.data.SQHierarchyExprUtils,F=t.contracts.VisualQuery;r.createVisualAuthoringCore=i,r.applyPropertyChanges=n;var P=(function(){function i(e,t,i,n){this.visualPluginService=e,this.geoTaggingService=t,this.aggrOps=i,this.featureSwitchService=n,this.visualAuthoringCustomizeOperations=r.createVisualAuthoringCustomizeOperations(this.visualPluginService,n)}return Object.defineProperty(i.prototype,"isHierarchicalSlicerCreationEnabled",{get:function(){return this.featureSwitchService.featureSwitches&&this.featureSwitchService.featureSwitches.hierarchicalSlicer&&this.featureSwitchService.featureSwitches.hierarchicalSlicerCreation},enumerable:!0,configurable:!0}),i.prototype.create=function(t){var r=this.visualPluginService.capabilities(t.visualType),i=e.visualCapabilitiesHelperModuleFactory().create(r,this.geoTaggingService);if(i){var n=t.query||new F(y.create(),{},[]),o={visualType:t.visualType,query:n};this.visualAuthoringCustomizeOperations.customizeOptions(o,t.schema);for(var a in o.query.projections)this.ensureDependentObjectDefn(i.objectDescs,a,o);if(_.isEmpty(t.expr)||this.tryAdd(i,o,t))return{singleVisual:o}}},i.prototype.add=function(t,r){var n=r.singleVisual;if(!n)return!1;var o=this.visualPluginService.capabilities(n.visualType),a=e.visualCapabilitiesHelperModuleFactory().create(o,this.geoTaggingService);return!!a&&(n.query||(n.query=new F(y.create(),{},[])),!!this.tryAdd(a,n,t)&&(this.visualAuthoringCustomizeOperations.customizeOptions(n,t.schema),i.clearConversionSourceContext(n),!0))},i.prototype.remove=function(e,t,r){var n=t.singleVisual;return!!n&&(!!this.tryRemove(n.query,n.columnProperties,e,r)&&(i.clearConversionSourceContext(n),!0))},i.prototype.replace=function(e,t){var r=t.singleVisual;if(!r)return!1;if(e.sourceRole===e.targetRole&&!e.replacementExpressions)return!!r.query.moveProjection(e.targetRole,e.sourceIndex,e.targetIndex,e.sourceCount)&&(i.clearConversionSourceContext(r),!0);for(var n=[],o=0;o<e.sourceCount;o++)if(n[o]=r.query.tryGetExpr(e.sourceRole,e.sourceIndex+o),!n[o])return!1;return this.replaceProjectionCore(t,n,e.sourceRole,e.targetRole,e.sourceIndex,e.targetIndex,e.replacementExpressions,e.schema,e.allowPartialReplace)},i.prototype.convert=function(t){var r=t.source;if(!r)return!1;var i=r.conversionSourceContext;i||(i=r.conversionSourceContext=this.createConversionSourceContext(r.query,r.visualType,r.syncGroup));var n=this.visualPluginService.capabilities(i.visualType),o=this.visualPluginService.capabilities(t.target);if(!n||!o||_.isEmpty(o.dataRoles))return!1;if(f.equals(n,o)){var a=this.visualPluginService.capabilities(r.visualType);return this.convertRoleWildCardProperties(a,o,r.objects),r.query=i.query,r.visualType=t.target,r.visualType===t.target&&o.supportsSynchronizingFilterState&&(r.syncGroup=i.syncGroup),!0}var s=t.schema,l=this.convertDrillableRoles(i.query,n,t.target,o,s),c=l.query,p=u.getDrillableRoles(o);t.target!==e.visuals.plugins.slicer.name||this.isHierarchicalSlicerCreationEnabled||(p=[]);var d=i.query.getUniqueQueryRefs();d=_.difference(d,l.drillableRoleProjectionQueryRefs);var v=i.query.defn.select(),h=_.map(d,(function(e){return v.withName(e).expr})),g=e.visualCapabilitiesHelperModuleFactory().create(o,this.geoTaggingService),y=e.visualCapabilitiesHelperModuleFactory().create(n,this.geoTaggingService);g.orderByRolePreferences(s,h);var C=m.clone(c.projections),x=this.getExpressionRoleMappings(r.query,h),S=this.getConversionExprRoleList(x,y,g,s,t.target,C,p);if(_.isEmpty(S)&&_.isEmpty(c.projections))return!1;for(var b=0,E=S;b<E.length;b++){var w=E[b];c.add(w.expr,w.roleName),this.ensureDependentObjectDefn(g.objectDescs,w.roleName,r)}var V=u.getDrillableRoles(this.visualPluginService.capabilities(r.visualType));r.visualType!==e.visuals.plugins.slicer.name||this.isHierarchicalSlicerCreationEnabled||(V=[]);var F,P;_.isEmpty(V)?(F=u.getDrillableRoles(n),P=i.query):(F=V,P=r.query);for(var T=0,N=p;T<N.length;T++){var D=N[T];if(c.projections[D]){c.ensureActiveItems(D);for(var R=0,I=F;R<I.length;R++){var j=I[R];P.projections[j]&&(c.projections[D].activeProjectionRefs=P.projections[j].activeProjectionRefs)}}}return this.updateTargetShowAllInfo(i,c,g),c.removeUnusedOrderBy(),c.resetExpansionStates(),this.convertRoleWildCardProperties(n,o,r.objects),this.upgradePivotTableProperties(r.objects,r.visualType,t.target),r.query=c,r.visualType=t.target,this.visualAuthoringCustomizeOperations.customizeOptions(r,s),!0},i.prototype.convertRoleWildCardProperties=function(t,r,i){if(!_.isEmpty(i)){var n=_.chain(t.dataRoles).filter((function(t){return t.kind!==e.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value(),o=_.chain(r.dataRoles).filter((function(t){return t.kind!==e.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value();if(!_.isEmpty(n)&&!_.isEmpty(o))for(var a in i){var s=i[a];if(!_.isEmpty(s))for(var u=0,c=s;u<c.length;u++){var p=c[u],d=p.selector;if(d&&!_.isEmpty(d.data))for(var f=0,v=d.data.length;f<v;f++){var m=d.data[f];g.isRoleWildcard(m)&&_.isEqual(_.sortBy(m.roles),_.sortBy(n))&&(d.data[f]=l.fromRoles(o))}}}}},i.prototype.upgradePivotTableProperties=function(e,t,r){"matrix"!==t&&"table"!==t||"pivotTable"!==r&&"tableEx"!==r||(s.moveProperty(e,"general",void 0,"textSize","grid"),s.moveProperty(e,"general",void 0,"autoSizeColumnWidth","columnHeaders")),"matrix"===t&&"pivotTable"===r&&(s.moveProperty(e,"general",void 0,"columnSubtotals","subTotals"),s.moveProperty(e,"general",void 0,"rowSubtotals","subTotals")),"table"===t&&"tableEx"===r&&s.moveProperty(e,"general",void 0,"totals","total")},i.prototype.setAggregate=function(e,t){return!!t.singleVisual.query.setAggregate(e.role,e.index,e.newAggregate)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removeAggregate=function(e,t){return!!t.singleVisual.query.removeAggregate(e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.setPercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.setPercentOfGrandTotal(e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removePercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.removePercentOfGrandTotal(e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.setPercentOfRoleTotal=function(e,t){return!!t.singleVisual.query.setPercentOfRoleTotal(e.roleRefs,e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),
!0)},i.prototype.removePercentOfRoleTotal=function(e,t){return!!t.singleVisual.query.removePercentOfRoleTotal(e.role,e.index)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.toggleShowAll=function(e,t){t.singleVisual.query.toggleShowAll(e),i.clearConversionSourceContext(t.singleVisual)},i.prototype.changeActiveProjection=function(e,t,r){var n=t.query.projections[e];if(n){var o,a=_.uniqBy(n.all(),(function(e){return e.queryRef})),s=_.uniq(n.activeProjectionRefs);_.isEmpty(s)||(o=s.length);var l=o&&_.findIndex(a,(function(e){return e.queryRef===s[o-1]}));if(!(null==l||l<0)){if(1===r){if(!(l>=1))return;s.pop(),1!==o&&s[o-2]===a[l-1].queryRef||s.push(a[l-1].queryRef)}else{if(3===r&&(s.length=0),!(a.length>l+1))return;s.push(a[l+1].queryRef)}return i.clearConversionSourceContext(t),n.activeProjectionRefs=s,s}}},i.prototype.addDrillFilter=function(e,t,r,i,n){this.addDrill(e,t,r,i,n,2,!0)},i.prototype.addDrillToDetailsFilter=function(e,t,r,i,n){this.addDrill(e,t,r,i,n,0,!1)},i.prototype.addDrill=function(r,i,n,o,a,s,l){if(i&&n&&!_.isEmpty(o)&&a)for(var u=function(o){var u=n.defn.select().withName(o).expr,c=a.expr,p=x.isNot(c);p&&(c=c.arg);var d=h.getInExpr(c),f=[],v=void 0,m=u.getKeyColumns(r);if(!_.isEmpty(d.values))for(var g=function(e){var t=d.args[e];if(t&&w.indexOfExpr(m,t)!==-1){f.push(t);var r=_.map(d.values,(function(t){return[t[e]]}));v=_.isEmpty(v)?r:_.chain(v).zip(r).map((function(e){return _.flatten(e)})).value()}},y=0;y<d.args.length;y++)g(y);if(!_.isEmpty(f)&&!_.isEmpty(v)){var C=S.inValues(f,v||[]);p&&(C=S.not(C));var b=e.DataViewScopeIdentity.filterFromIdentity([{kind:1,expr:C,key:a.key}]),E=_.filter(i,(function(e){return x.equals(u,e.expression)})),V=void 0;if(l&&(V=_.find(E,(function(e){return e.howCreated===s}))),V)V.filter=b,V.howCreated=s,V.precedence=0;else{var F={name:null,expression:u,filter:b,type:t.contracts.FilterType.Categorical,howCreated:s,precedence:0};i.push(F)}}},c=0,p=o;c<p.length;c++){var d=p[c];u(d)}},i.prototype.removeDrillFilter=function(e,t){if(!e)return!1;for(var r,i=0,n=e.length;i<n;i++){var o=e[i];if(2===o.howCreated&&x.equals(t,o.expression)){r=i;break}}return void 0!==r&&(e.splice(r,1),!0)},i.prototype.replaceProjectionCore=function(t,r,n,o,a,s,l,u,c){var p=t.singleVisual;if(!p||!p.query)return!1;for(var d=C.clone(p),f=d.query.defn.orderBy(),v=l||r,m=e.columnPropertiesAuthoringModuleFactory(),h=m.getColumnPropertiesForExprs(v,d),g=r.length,y=0;y<g;y++)if(!this.tryRemove(d.query,d.columnProperties,{role:n,index:a},u))return!1;f.length>0&&d.query.orderBy(f);var x=this.visualPluginService.capabilities(p.visualType),S=e.visualCapabilitiesHelperModuleFactory().create(x,this.geoTaggingService);if(!S)return!1;var b=S.roles.withName(o);if(!b)return!1;for(var y=0;y<v.length;y++){var E=v[y];v[y]=this.aggregateIfNecessary(v[y],b,u);var _={expr:v[y],schema:u,targetRole:o,targetIndex:s+y};if(!this.tryAdd(S,d,_)){if(y>0&&c)break;return!1}if(p.query.projections[n].showAll){var w=v[y].getMetadata(u);this.isShowAllRole(b.kind)&&w&&1!==w.kind&&(d.query.projections[o].showAll=!0)}m.applyColumnPropertiesByExpr(E,v[y],d,h)}return t.singleVisual=d,this.visualAuthoringCustomizeOperations.customizeOptions(t.singleVisual,u),i.clearConversionSourceContext(t.singleVisual),!0},i.prototype.aggregateIfNecessary=function(t,r,i){return null!=c.getAggregate(t,i)||r.kind!==e.VisualDataRoleKind.Measure||w.discourageAggregation(t,i)?r.kind===e.VisualDataRoleKind.Grouping?S.removeAggregate(t,i):t:this.aggrOps.createExprWithAggregate(t,i,!0,r.requiredTypes)},i.clearConversionSourceContext=function(e){e.conversionSourceContext=null},i.prototype.getConversionExprRoleList=function(e,t,r,i,n,o,a){var s=this,l=this.getCompatRolesForExprs(e,t,r,i,n,!1,o,a);if(_.isEmpty(l)){var u=_.map(e,(function(e){var t=e.expr;return{expr:w.isMeasure(t)?t:s.aggrOps.createExprWithAggregate(t,i,!0,null)}}));l=this.getCompatRolesForExprs(u,t,r,i,n,!0,o,a)}if(_.isEmpty(l)){var c=_.map(e,(function(e){var t=e.expr;return{expr:w.isMeasure(t)?S.removeAggregate(t,i):t}}));l=this.getCompatRolesForExprs(c,t,r,i,n,!0,o,a)}return l},i.prototype.getCompatRolesForExprs=function(e,t,r,i,n,o,a,s){for(var l=[],u=a?a:{},c=new E(d.hierarchyLevelComparer),p=0,f=e;p<f.length;p++){var v=f[p],m=this.getTargetRoleForConversion(v,t,r),h=r.findCompatibleRole({queryProjections:u,schema:i,expr:v.expr,targetRole:m,preferDrillableRoles:!1,roleToExprMap:c,useStrict:!0});if(h){h=this.ensureCorrectKeyInfluencersRole(n,h,void 0),this.updateProjections(u,h.name,s);var g=r.getNumberRangesForRoles(u),y=g[h.name];if(this.shouldUseVariation(v.expr,i,h.name,s,y,_.size(e))){var C=V.getSourceVariationExpr(v.expr);return l.push({expr:C,roleName:h.name}),l}if(l.push({expr:v.expr,roleName:h.name}),o)return l}}return l},i.prototype.shouldUseVariation=function(e,t,r,i,n,o){if(!_.includes(i,r)&&n&&n.max<o){var a=b.asFieldPattern(e,t);if(a&&a.columnHierarchyLevelVariation)return!0}return!1},i.prototype.getExpressionRoleMappings=function(e,t){return _.map(t,(function(t){return{expr:t,roleName:e.getRoleNameForExpr(t)}}))},i.prototype.getTargetRoleForConversion=function(e,t,r){var i=t.roles.withName(e.roleName),n=r.roles.withName(e.roleName);if(i&&n){var o=this.getDataViewMappingConditions(t.capabilities),a=this.getDataViewMappingConditions(r.capabilities),s=e.roleName,l=o&&a&&_.isEqual(o[s],a[s])||!o&&!a;return!r.hasPreferredTypes()&&l&&_.isEqual(i.kind,n.kind)?s:void 0}},i.prototype.getDataViewMappingConditions=function(e){var t=e.dataViewMappings&&e.dataViewMappings[0];return t&&t.conditions},i.prototype.updateProjections=function(e,t,r){var i={queryRef:t},n=m.getRole(e,t);n||(e[t]=n=new v([]));var o=n.all();o.push(i),_.includes(r,t)&&n.addActiveQueryReference(o[0].queryRef)},i.prototype.createConversionSourceContext=function(e,t,r){return{query:e,visualType:t,syncGroup:r}},i.prototype.convertDrillableRoles=function(e,t,r,i,n){var o=new F(e.defn.select([]),{},[]),a=u.getDrillableRoles(t);return _.isEmpty(a)?{query:o,drillableRoleProjectionQueryRefs:[]}:{query:o,drillableRoleProjectionQueryRefs:this.convertDrillableProjections(r,i,e,n,a,o)}},i.prototype.convertDrillableProjections=function(t,r,i,n,o,a){var s=u.getDrillableRoles(r);t!==e.visuals.plugins.slicer.name||this.isHierarchicalSlicerCreationEnabled||(s=[]);for(var l=i.projections,c=i.defn.select(),p=[],d=0,f=o;d<f.length;d++){var v=f[d],m=l[v];if(m){var h=_.map(m.all(),(function(e){return e.queryRef})),g=_.map(h,(function(e){return c.withName(e)}));if(this.convertDrillableExprs(g,n,t,r,a),p=_.union(p,h),_.isEmpty(s))break}}return a.ensureDrillableRoles(s),p},i.prototype.convertDrillableExprs=function(t,r,i,n,o){var a=e.visualCapabilitiesHelperModuleFactory().create(n,this.geoTaggingService),s=a.getNumberRangesForRoles(o),l=u.getDrillableRoles(n);if(i===e.visuals.plugins.slicer.name&&!this.isHierarchicalSlicerCreationEnabled){l=[];for(var c in s)s[c].max=1}for(var p=_.isEmpty(l),f=new E(d.hierarchyLevelComparer),v=0,m=t;v<m.length;v++){var h=m[v],g=h.expr,y=h.name,C=a.findCompatibleRole({queryProjections:o.projections,schema:r,expr:g,preferDrillableRoles:!0,roleToExprMap:f,useStrict:!0});if(C){var x=C.name,S=s[x];if(this.shouldUseVariation(h.expr,r,C.name,l,S,_.size(t))){var b=V.getSourceVariationExpr(h.expr);return void o.add(b,x,{exprName:y})}if(o.add(g,x,{exprName:y}),p){var w=o.projections[x].all().length;if(S&&S.max&&S.max<=w)return}}}},i.prototype.tryRemove=function(e,t,r,i){var n=r;if(n&&n.expr){if(_.isArray(n.expr)){for(var o=!1,a=0,s=n.expr;a<s.length;a++){var l=s[a];o=e.removeExpr(l,!!n.ignoreAggregates,i)||o}return o}return e.removeExpr(n.expr,!!n.ignoreAggregates,i)}var u=r;if(u&&u.role&&$.isNumeric(u.index)){var c=e.getQueryRef(u.role,u.index),p=e.removeProjection(u.role,u.index);return c&&!e.isUsed(c)&&t&&t[c]&&delete t[c],p}return!1},i.prototype.tryAdd=function(e,t,r){var i=r.expr,n=new E(d.hierarchyLevelComparer),o=!1,a=r.targetIndex;if(_.isArray(i))for(var s=0,l=i;s<l.length;s++){var c=l[s];o=null!=this.tryAddQuery(e,t,r,c,a,n)||o,null!=a&&a++}else if(null==this.tryAddQuery(e,t,r,i,a,n))return!1;var p=u.getDrillableRoles(e.capabilities);return t.query.ensureDrillableRoles(p),!_.isArray(i)||o},i.prototype.tryAddQuery=function(t,r,i,n,o,a){var s=t.findCompatibleRole({queryProjections:r.query.projections,schema:i.schema,expr:n,preferDrillableRoles:!1,roleToExprMap:a,targetRole:i.targetRole});if(s){if(r.visualType===e.visuals.plugins.slicer.name&&!this.isHierarchicalSlicerCreationEnabled){var l=m.getRole(r.query.projections,s.name);if(l&&_.size(l.all())>0)return}s=this.ensureCorrectKeyInfluencersRole(r.visualType,s,i.targetRole);var u=s.name,c=r.query.add(n,u,{index:o});return this.ensureDependentObjectDefn(t.objectDescs,u,r),a.add(n,s),c}},i.prototype.ensureCorrectKeyInfluencersRole=function(t,r,i){return t!==e.visuals.plugins.keyDriversVisual.name||r.name!==e.visuals.keyDriverRoleNames.details||i?r:_.find(e.visuals.getKeyDriversCapabilities(this.featureSwitchService.featureSwitches).dataRoles,(function(t){return t.name===e.visuals.keyDriverRoleNames.explainBy}))},i.prototype.ensureDependentObjectDefn=function(e,t,r){if(e)for(var i in e){var n=e[i];for(var o in n.properties){var a=n.properties[o];if(a.rule&&a.rule.inputRole===t){var l=r.objects;l||(l=r.objects={});var u=s.ensure(l,i,null);u.properties[o]||(u.properties[o]=this.createDefaultDefinition(a.type))}}}},i.prototype.createDefaultDefinition=function(e){if(e.fillRule){return p.getDefaultFillRuleDefinition()}},i.prototype.getSourceShowAllInfo=function(e){for(var t={},r=0,i=_.values(e);r<i.length;r++)for(var n=i[r],o=n.showAll,a=0,s=n.all();a<s.length;a++){var l=s[a];t[l.queryRef]=o}return t},i.prototype.updateTargetShowAllInfo=function(e,t,r){for(var i=this.getSourceShowAllInfo(e.query.projections),n=0,o=_.keys(t.projections);n<o.length;n++){var a=o[n],s=r.roles.withName(a).kind;if(this.isShowAllRole(s))for(var l=0,u=t.projections[a].all();l<u.length;l++){var c=u[l],p=i[c.queryRef];p&&(t.projections[a].showAll=p)}}},i.prototype.isShowAllRole=function(t){return t===e.VisualDataRoleKind.Grouping||t===e.VisualDataRoleKind.GroupingOrMeasure},i})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return new n(e,t)}var i=e.data.DataViewTransform;t.createVisualAuthoringCustomizeOperations=r;var n=(function(){function r(e,t){this.visualPluginService=e,this.featureSwitchService=t}return r.prototype.customizeOptions=function(r,n){var o=r.visualType,a=this.visualPluginService.getPlugin(o);if(a&&a.customizeVisualAuthoringOperations){var s=this.visualPluginService.capabilities(o),l=i.evaluateMetadataOnceDataViewObjectDefinitions(r.objects,s.objects,e.visuals.visualStyles.create(),this.featureSwitchService.featureSwitches),u=l.dataViewObjects,c=e.data.compileDataView({mappings:s.dataViewMappings,queryDefn:r.query.defn,queryProjections:r.query.projections,schema:n,objectDescriptors:s.objects,objectDefinitions:r.objects,roles:s.dataRoles,featureSwitches:this.featureSwitchService.featureSwitches}),p=a.customizeVisualAuthoringOperations({objects:u,dataViewMappings:c});r.objects||(r.objects={}),t.applyPropertyChanges(p,s.objects,r.objects)}},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new c(e,t,r)}var n=e.DataViewMapping,o=e.data.QueryProjectionsByRole,a=e.data.SQExpr,s=e.data.SQExprUtils,l=e.explore.util.VisualContainerUtils,u=t.contracts.VisualQuery;r.createSortService=i;var c=(function(){function r(e,t,r){this.displayNameService=e,this.featureSwitches=t,this.visualPluginService=r}return r.prototype.getSortableFields=function(e){var t=e.visualType,r=e.query,i=r.projections,n=e.schema,o=this.visualPluginService.capabilities(t);if(o&&this.isVisualSortable(o)){if(o.sorting){var a=this.visualPluginService.getPlugin(t);if(a&&a.getSortableRoles){var s={dataViewMappings:e.compiledMappings};return this.getSortableFieldsFromAllowedRoles(i,r,n,o,a.getSortableRoles(s),e.columnProperties)}return this.getDefaultSortableFields(i,r,n,o,e.columnProperties)}return this.getDefaultSortableFields(i,r,n,o,e.columnProperties)}return[]},r.prototype.addSort=function(e,t){e&&e.defn&&t&&(e.defn=e.defn.orderBy(t))},r.prototype.removeSort=function(e,t){if(e&&e.defn&&t)for(var r=0,i=t;r<i.length;r++){var n=i[r];e.defn=e.defn.removeOrderBy(n.expr)}},r.prototype.resetSort=function(e){if(e&&e.defn){var t=e.defn.orderBy();this.removeSort(e,t)}},r.prototype.applyImplicitSort=function(e,t){if(!t)return e;var r=e.defn;if(!r)return e;for(var i=t.clauses,n=r.select(),a=[],s=0,l=i;s<l.length;s++){var c=l[s],p=o.getRole(e.projections,c.role);if(p){var d=c.direction;a.push.apply(a,_.map(p.all(),(function(e){return{expr:n.withName(e.queryRef).expr,direction:d}})))}}return _.isEmpty(a)?e:new u(r.orderBy(a),e.projections,e.expansionStates)},r.prototype.shouldApplyDefaultSort=function(e,t){return!(t.sorting&&(t.sorting.custom||t.sorting.implicit))&&(e.hasDefaultSort||e.query&&_.isEmpty(e.query.defn.orderBy()))},r.prototype.ensureValidSorting=function(e){var t=this.getSortableFields(e),r=_.chain(t).map((function(e){return e.exprs})).flatten().map((function(e){return e.name})).value(),i=e.query,n=i.defn;if(!n)return i;for(var o=n.orderBy(),a=!1,s=o.length-1;s>=0;s--){var l=n.selectNameOf(o[s].expr);_.includes(r,l)||(o.splice(s,1),a=!0)}return a?new u(n.orderBy(o),i.projections,i.expansionStates):i},r.prototype.isVisualSortable=function(t){return _.some(t.dataRoles,(function(t){return t.kind!==e.VisualDataRoleKind.Measure}))},r.prototype.getDefaultSortableFields=function(e,t,r,i,n){return this.getSortableFieldsFromProjections(e,t,r,i,n)},r.prototype.getSortableFieldsFromAllowedRoles=function(e,t,r,i,n,o){return n&&0!==n.length?this.getSortableFieldsFromProjections(e,t,r,i,o,n):[]},r.prototype.findSortExpressionIndex=function(e,r){if(e&&r)for(var i=0,n=r.length;i<n;i++)if(a.equals(e,r[i].expr))return i;return t.constants.invalidSortExprIndex},r.prototype.getSortableFieldsFromProjections=function(r,i,a,u,c,p){var d=[],f=i.defn.select(),v=i.defn.orderBy();if(u.dataRoles)for(var m=0,h=u.dataRoles;m<h.length;m++){var g=h[m];if(!(p&&_.indexOf(p,g.name)<0)){var y=o.getRole(r,g.name);if(y){var C=y.activeProjectionRefs;if(_.isEmpty(C))for(var x=0,S=y.all();x<S.length;x++){var b=S[x],E=f.withName(b.queryRef),w=E&&E.expr;if(w&&s.isExprValidForSorting(w)){var V=b.displayName||this.displayNameService.getDisplayName(w,a,u,b.queryRef,c),F=this.findSortExpressionIndex(w,v),P=F!==t.constants.invalidSortExprIndex;d.push({displayName:V,exprs:[{name:b.queryRef,expr:w}],active:P,orderByIndex:P?F:void 0,sortDirection:P?v[F].direction:void 0})}}else{var T=l.createRoleKindByQueryRef(i),N=e.DataViewAnalysis.chooseDataViewMappings(r,u.dataViewMappings,T,this.featureSwitches.featureSwitches);if(N.supportedMappings){var D=n.targetDataViewKinds(N.supportedMappings),R=0!==(1&D);d.push.apply(d,this.getSortableFieldsFromActiveProjections(a,f,C,v,u,c,R))}}}}}return d},r.prototype.getSortableFieldsFromActiveProjections=function(e,r,i,n,o,s,l){for(var u,c=!1,p=Number.MAX_VALUE,d=[],f=[],v=0,m=i;v<m.length;v++){var h=m[v],g=r.withName(h),y=g&&g.expr;if(y&&!a.isFilteredEval(y)){var C=this.findSortExpressionIndex(y,n);if(C!==t.constants.invalidSortExprIndex&&(p=Math.min(p,C)),l)c=c||C!==t.constants.invalidSortExprIndex,c&&!u&&(u=n[C].direction),f.push({name:h,expr:y});else{c=C!==t.constants.invalidSortExprIndex,u=c?n[C].direction:void 0;var x=this.getDisplayNameFromQueryRef(e,r,h,o,s);d.push({displayName:x,exprs:[g],active:c,orderByIndex:c?C:void 0,sortDirection:u})}}}if(l){var x=this.concatDisplayNamesForActiveItems(e,r,i,o,s);return[{displayName:x,exprs:f,active:c,orderByIndex:c?p:void 0,sortDirection:c?u:void 0}]}return d},r.prototype.concatDisplayNamesForActiveItems=function(e,t,r,i,n){var o=this;return _.map(r,(function(r){return o.getDisplayNameFromQueryRef(e,t,r,i,n)})).join(" ")},r.prototype.getDisplayNameFromQueryRef=function(e,t,r,i,n){var o=t.withName(r),a=o&&o.expr;return a?this.displayNameService.getDisplayName(a,e,i,r,n):""},r})();r.SortService=c})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){function t(e){return e&&e.geography&&(e.geography.latitude||e.geography.longitude)}function r(e){return _.some(e.preferredTypes,(function(e){return t(e)||e.numeric}))}function i(e){return 0===e.cartesianKind||1===e.cartesianKind}var n=e,o=n.data,a=n.explore,s=a.contracts,l=a.util,u=jsCommon.ArrayExtensions,c=n.DataViewMapping,p=n.DataViewAnalysis,d=l.DrillUtils,f=jsCommon.MathExtensions,v=o.SQExpr,m=o.SQExprConverter,h=s.VisualQuery,g=n.ValueType,y=(function(){function e(e,t,r,i){this.capabilities=e,this.roles=t,this.objectDescs=r,this.roleMappings=i}return e.prototype.findCompatibleRole=function(e){var t=e.expr,r=e.roleToExprMap,i=e.targetRole,n=e.preferDrillableRoles;if(v.isHierarchyLevel(t)){n=!0;var o=this.getExistingTargetRoleForHierarchyLevelIfAny(t,r);if(o){if(i&&i!==o.name)return;i=o.name}}var a,s=m.asFieldPattern(t,e.schema);s&&(a=s.column||s.columnAggr||s.groupingColumn||s.groupingColumnAggr||s.measure);var l={projections:e.queryProjections,metadata:t.getMetadata(e.schema),columnName:a?a.name:void 0,preferDrillableRoles:n,targetRole:i,useStrict:e.useStrict},u=this.findRole(l);return u||(l.preferDrillableRoles=!e.preferDrillableRoles,u=this.findRole(l)),u&&r&&r.add(t,u),u},e.prototype.findRole=function(e){var t=this.roleMappings;if(!_.isEmpty(t))for(var r=t[0].getValueType(e.metadata?e.metadata.type:void 0,e.columnName),i=this.roles.allRolesWithPreference(r?r.extendedType:void 0,e.projections,e.preferDrillableRoles,e.useStrict),n=e.targetRole?[e.targetRole]:i,o=0,a=n;o<a.length;o++)for(var s=a[o],l=0,u=t;l<u.length;l++){var c=u[l],p=c.checkRoleCompatibility(e,s,i);if(p)return p}},e.prototype.getExistingTargetRoleForHierarchyLevelIfAny=function(e,t){return t.get(e)},e.prototype.orderByRolePreferences=function(e,t){for(var r=this.roles.defns,i=0,n=t.length,o=0,a=r.length;o<a;o++){var s=r[o].preferredTypes;if(!_.isEmpty(s))for(var l=i;l<n;l++){var u=t[l],c=u.getMetadata(e);if(c){var p=c.type;if(p)for(var d=0,f=s.length;d<f;d++)if(p.extendedType===g.fromDescriptor(s[d]).extendedType){t.splice(l,1),t.splice(i,0,u),i++;break}}}}},e.prototype.getNumberRangesForRoles=function(e){var t,r=_.map(this.roles.defns,(function(e){return e.name}));t=e instanceof h?e.projections:e;for(var i={},n=0,o=r;n<o.length;n++){var a=o[n];i[a]={min:1/0,max:0}}for(var s=_.filter(this.roleMappings,(function(e){return e.projectionsAreCompatible({projections:t,roleNames:r,preferDrillableRoles:!0,ignoreMin:!0})})),l=0,u=s;l<u.length;l++)for(var c=u[l],p=c.getCondition(),d=0,v=r;d<v.length;d++){var a=v[d],m=p&&p[a],g=void 0;g=m?{min:f.max(m.min,0),max:f.min(m.max,1/0)}:{min:0,max:1/0};var y=i[a];y.min=Math.min(g.min,y.min),y.max=Math.max(g.max,y.max)}for(var C=0,x=_.values(i);C<x.length;C++){var y=x[C];y.min=Math.min(y.min,y.max)}return i},e.prototype.getNonLatLongRoles=function(){var e=this.getLatLongRoleNames();return this.getFilteredRoleNames(e)},e.prototype.getNonCartesianGroupingOrMeasureRoleNames=function(){var e=this.getCartesianGroupingOrMeasureRoleNames();return this.getFilteredRoleNames(e)},e.prototype.getFilteredRoleNames=function(e){for(var t=this.capabilities,r=t.dataViewMappings,i=[],n=0,o=r;n<o.length;n++){var a=o[n];a.categorical&&c.visitCategoricalCategories(a.categorical.categories,{visitRole:function(e){i.push(e)}}),a.matrix&&c.visitMatrixRows(a.matrix.rows,{visitRole:function(e){i.push(e)}})}return _.without.apply(_,[_.uniq(i)].concat(e))},e.prototype.getLatLongRoleNames=function(){return this.getRoleNames((function(e){return r(e)}))},e.prototype.getCartesianGroupingOrMeasureRoleNames=function(){return this.getRoleNames((function(e){return i(e)}))},e.prototype.getRoleNames=function(e){return _.chain(this.capabilities.dataRoles).filter(e).map((function(e){return e.name})).value()},e.prototype.hasPreferredTypes=function(){return _.some(this.capabilities.dataRoles,(function(e){return!_.isEmpty(e.preferredTypes)}))},e})(),C=(function(){function e(e,t,r,i){this.roles=e,this.geoTaggingService=t,this.condition=i,this.drillableRoles=r}return e.prototype.getCondition=function(){return this.condition},e.prototype.checkRoleCompatibility=function(e,t,r){if(e.metadata){var i=this.roles.withName(t);if(i&&this.exprIsCompatible(i,e.metadata,p.getPropertyCount(t,e.projections)+1,e.preferDrillableRoles)){if(!this.projectionsAreCompatible({projections:e.projections,roleNames:_.without(r,t),preferDrillableRoles:e.preferDrillableRoles,ignoreMin:!1}))return;return i}}},e.prototype.getValueType=function(e,t){if(e&&null==e.categoryString){var r=t&&this.geoTaggingService.getFieldType(t);null!=r&&(e=g.fromPrimitiveTypeAndCategory(e.primitiveType,r))}return e},e.prototype.projectionsAreCompatible=function(e){for(var t=0,r=e.roleNames;t<r.length;t++){var i=r[t],n=this.roles.withName(i);if(!n)return!1;var o=p.getPropertyCount(i,e.projections);if(!this.isCardinalityValid({count:o,roleName:n.name,preferDrillableRoles:e.preferDrillableRoles,ignoreMin:e.ignoreMin}))return!1}return!0},e.prototype.exprIsCompatible=function(e,t,r,i){if(!this.isCardinalityValid({count:r,roleName:e.name,preferDrillableRoles:i,ignoreMin:!1}))return!1;var o=e.kind;if(1===t.kind){if(o===n.VisualDataRoleKind.Grouping)return!1}else if(o===n.VisualDataRoleKind.Measure)return!1;var a=e.requiredTypes;return!(a&&!g.isCompatibleTo(t.type,a))},e.prototype.isRoleDrillable=function(e){return _.includes(this.drillableRoles,e)&&(!this.condition[e]||void 0===this.condition[e].max||1===this.condition[e].max)},e.prototype.isCardinalityValid=function(e){if(this.condition&&(!e.preferDrillableRoles||!this.isRoleDrillable(e.roleName))){var t=this.condition[e.roleName];return!t||null==p.validateRange(e.count,t,e.ignoreMin)}return!0},e})(),x=(function(){function t(e){this.defns=e}return t.prototype.withName=function(e){return u.findItemWithName(this.defns,e)},t.prototype.allRolesWithPreference=function(e,t,r,i){var n=this,o=_.map(this.defns,(function(e){return e.name}));return this.promoteAndPenalize(o,(function(t){return n.getTypeWeightForRole(e,t.preferredTypes)}),i),this.promoteAndPenalize(o,(function(e){return n.getProjectionWeightForRole(e,t,r)})),o},t.prototype.promoteAndPenalize=function(e,r,i){for(var n=0,o=0,a=this.defns;o<a.length;o++){var s=a[o],l=r(s);if(null!=l){var u=e.splice(e.indexOf(s.name),1)[0];l!==t.penalize||i?l===t.promote&&e.splice(n++,0,u):e.push(u)}}},t.prototype.getTypeWeightForRole=function(e,r){if(r){for(var i=t.penalize,n=0,o=r;n<o.length;n++){var a=o[n];if(e===g.fromDescriptor(a).extendedType){i=t.promote;break}}return i}},t.prototype.getProjectionWeightForRole=function(r,i,n){var o=i[r.name];if(!n&&o&&r.kind!==e.VisualDataRoleKind.Measure)return t.penalize},t.penalize=-1,t.promote=1,t})();return{create:function(e,t){if(e&&!_.isEmpty(e.dataRoles)){for(var r=e.dataViewMappings,i=new x(e.dataRoles),n=[],o=0,a=r;o<a.length;o++){var s=a[o],l=s.conditions;if(_.isEmpty(l))n.push(new C(i,t,d.getDrillableRoles(e)));else for(var u=0,c=l;u<c.length;u++){var p=c[u];n.push(new C(i,t,d.getDrillableRoles(e),p))}}return new y(e,i,e.objects,n)}},dataRoleWrapper:function(e){return new x(e)},isValueTypeDescriptorLatLong:t,isRoleCompatibleWithLatLong:r,isRoleCompatibleWithScatterXY:i}}e.visualCapabilitiesHelperModuleFactory=t})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new $(e.dataReaders,e.displayNameService,e.plugin,e.pluginOps,e.sortService,e.filterGenerator,e.aggrOps,e.featureSwitchService,e.transformPluginService,e.telemetryService,e.visualTimeSynchronizationService)}function n(e,t){if(_.isEmpty(t))return{queryForTransformActions:e,internalToPublicSelectNameMappingsByRole:{}};for(var r=e.clone(),i=0,n=t;i<n.length;i++){var o=n[i];if(o.selectExprAdded){var a=r.defn.select(),s=o.selectExprAdded;a[s.selectIndex]=s.namedSQExpr,r.defn=r.defn.select(a)}else if(o.projectionQueryRefChanged){var s=o.projectionQueryRefChanged,l=r.projections[s.role];l.replaceQueryRef(s.oldQueryRef,s.newInternalQueryRef)}else o.aggregatesAdded||o.selectExprReplaced}return{queryForTransformActions:r,internalToPublicSelectNameMappingsByRole:_.reduce(t,(function(e,t){var r=t.projectionQueryRefChanged;if(r){var i=e[r.role];i||(i={},e[r.role]=i),i[r.newInternalQueryRef]=r.oldQueryRef}return e}),{})}}function o(e,t){if(t)for(var r=0,i=t;r<i.length;r++){var n=i[r],o=n.projectionQueryRefChanged;if(o){var a=o.newInternalQueryRef;if(a===e)return o.oldQueryRef}}return e}function a(e,t,r,i,a,p,d,f,v,m,h,g,y,C,x,S,b,E){var V=b?b.dataFilter:null,F={},P=X.buildExprEvaluationContext(a.defn.from());if(m&&(F.objects=m,g&&_.some(g,(function(e){return e.selectExprReplaced})))){var T=new Z(a.defn,g,m,P);T.rewrite(),F.objects=T.rewrittenObjects}h&&(F.splits=h),_.isEmpty(a.expansionStates)||(F.expansionStates=a.expansionStates);var N={options:e,transforms:F,warnings:y,compiledMappings:C,deferred:E},D=n(a,g),R=D.queryForTransformActions,I=D.internalToPublicSelectNameMappingsByRole,j=R.defn.select(),O=R.defn.orderBy(),M=R.projections;if(V){var A=V.where(),k=X.buildExprEvaluationContext(V.from());if(_.some(A,(function(e){return e.condition&&!_.isEmpty(e.condition.validate(t,f,void 0,k))})))return N.error=new ee("Broken_Filters"),N}if(N.filterContext={dataFilters:b.dataFiltersUnmerged,highlightFilters:b.highlightFilter,highlightFiltersUnmerged:b.highlightFiltersUnmerged,query:p},M){var z=[],B={},U=void 0;for(var L in M){var q=B[L]=[],G=M[L];_.isEmpty(G.activeProjectionRefs)||(U||(U={}),U[L]=_.map(G.activeProjectionRefs,(function(e){return{queryRef:e}})));for(var H=0,Q=G.all();H<Q.length;H++){var W=Q[H],K=w.indexWithName(j,W.queryRef);z.push({queryRef:W.queryRef,format:W.format,queryIndex:K,roleName:L,displayName:W.displayName}),q.push(K)}}F.selects=[];for(var J,Y=[],$=R.defn.transforms(),te=!_.isEmpty($),re=function(n,a){var s=l(z,n),c=j[n],p=void 0,m=S&&S[c.name];if(!te||m){m&&(c=m);var h=X.buildExprEvaluationContext(R.defn.from());if(!_.isEmpty(c.expr.validate(t,f,void 0,h)))return Y.push(c.expr),"continue";var y=c.expr.getMetadata(t,P);p={type:y.type,expr:c.expr},!X.isMeasure(c.expr)&&(_.isEmpty(e.query.command)||E||v.keepAllMetadataColumns)&&(p.identityExprs=r.produceIdentities(c.expr,t));var C=X.getKpiMetadata(c.expr,t);C&&(p.kpi=C);var x=o(c.name,g),b=_.find(s,(function(e){return e.queryRef===c.name&&e.displayName}));p.displayName=b?b.displayName:d.getDisplayName(c.expr,t,v,x,i);var w=s[0];if(w){var V=w.format||y.format;V&&(p.format=V)}}else p={expr:c.expr,displayName:c.name};p.roles||(p.roles={});for(var T=0,N=s;T<N.length;T++){var D=N[T];D&&D.roleName&&(p.roles[D.roleName]=!0)}J=c.name,p.queryName=_.chain(Object.keys(p.roles)).map((function(e){return I[e]&&I[e][J]})).filter(_.isString).value()[0]||J;var M=u(O,c.expr);if(M!==-1){var A=O[M];p.sort=A.direction,p.sortOrder=M}var k=X.getDefaultValue(c.expr,t);if(k){p.defaultValue={value:k};var B=c.expr.getKeyColumns(t);p.defaultValue.identityFieldsValues=X.getDefaultValues(B,t)}1===X.getAggregateBehavior(c.expr,t)&&(p.discourageAggregationAcrossGroups=!0);var U=X.getParameterMetadata(c.expr,t);U&&(p.parameter=U),F.selects.push(p)},ie=0,ne=j.length;ie<ne;ie++)re(ie,ne);if(g)for(var oe=0,ae=g;oe<ae.length;oe++){var se=ae[oe];se.aggregatesAdded&&c(F.selects,se.aggregatesAdded)}F.roles={ordering:B},U&&(F.roles.activeItems=U,s(F,x)),N.error=ee.create(Y,t)}return N}function s(e,t){var r=e&&e.roles,i=r&&r.activeItems;if(i)for(var n in i)for(var o=i[n],a=0,s=o;a<s.length;a++){var l=s[a];l.suppressConcat=_.includes(t,l.queryRef)}}function l(e,t){return _.chain(e).compact().filter((function(e){return e.queryIndex===t})).value()}function u(e,t){return _.findIndex(e,(function(e){return G.equals(e.expr,t)}))}function c(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n.queryName===t.originalQueryRef){var o={},a=t.aggregates;a.min&&(o.min=p(a.min)),a.max&&(o.max=p(a.max)),n.aggregateSources=o;break}}var s=t.aggregates;d(e,s.min),d(e,s.max)}function p(e){return{index:e.index}}function d(e,t){if(t){var r=t.index;e[r]||(e[r]={displayName:"",queryName:t.queryName,expr:t.expr})}}function f(e,t){return{code:t,getDetails:function(){return{displayableErrorInfo:[],message:e}}}}function v(e,r){return{visual:{objects:e.objects,descriptors:r.objects},visualContainer:{objects:e.vcObjects,descriptors:t.contracts.VisualContainer.CommonObjectDescriptors}}}function m(t,r){var i,n=[];switch(t.name){case e.visuals.plugins.map.name:i=h(r);break;case e.visuals.plugins.scatterChart.name:i=g(r)}if(!i&&!_.isEmpty(r)){var o=r[0];switch(o.code){case D.conditionRangeTooLarge:i="DataViewMappingError_ConditionRangeTooLarge";break;case D.conditionRangeTooSmall:i="DataViewMappingError_ConditionRangeTooSmall";break;case D.conditionKindExpectedMeasure:i="DataViewMappingError_ConditionKindExpectedMeasure";break;case D.conditionKindExpectedGrouping:i="DataViewMappingError_ConditionKindExpectedGrouping";break;case D.conditionNotHierarchicallyRelated:i="DataViewMappingError_ConditionNotHierarchicallyRelated";break;case D.conditionSchemaCapabilities_TupleFilters:i="DataViewMappingError_ConditionSchemaCapabilities_TupleFilters";break;case D.conditionKindExpectedGroupingOrMeasure:break;default:debug.assertNever(o.code)}n=[o.roleName]}if(i){return f(e.common.localize.format(i,n),i)}}function h(e){var t=_.some(e,(function(e){return"Category"===e.roleName&&e.code===D.conditionRangeTooLarge})),r=_.some(e,(function(e){return"X"===e.roleName&&e.code===D.conditionKindExpectedGrouping})),i=_.some(e,(function(e){return"Y"===e.roleName&&e.code===D.conditionKindExpectedGrouping}));return t?"DataViewMappingError_LocationAndLatLongGroup":r||i?"DataViewMappingError_LatLongAggregateWithNoLocation":void 0}function g(t){var r=_.some(t,(function(t){return t.roleName===e.visuals.scatterRoleNames.category&&t.code===D.conditionRangeTooLarge})),i=_.some(t,(function(t){return t.roleName===e.visuals.scatterRoleNames.play&&t.code===D.conditionRangeTooLarge})),n=_.some(t,(function(t){return t.roleName===e.visuals.scatterRoleNames.x&&(t.code===D.conditionKindExpectedGrouping||t.code===D.conditionKindExpectedMeasure)}));return r?"DataViewMappingError_ScatterGroupingDetails":i?"DataViewMappingError_ScatterGroupingPlayAxis":n?"DataViewMappingError_ScatterXMismatchType":void 0}function y(e,t,r){for(var i=0,n=e;i<n.length;i++){var o=n[i];t&&t.allowBinnedLineSample===!1&&C(o),t&&t.allowOverlappingPointsSample===!1&&x(o),b(r)||S(o)}}function C(e){var t=e.categorical;if(t&&t.dataReductionAlgorithm&&t.dataReductionAlgorithm.binnedLineSample&&(t.dataReductionAlgorithm=void 0,t.categories&&(t.categories.dataReductionAlgorithm={sample:{}}),t.values)){var r=t.values;r.group&&(r.group.dataReductionAlgorithm={top:{}})}}function x(e){var t=e.categorical,r=e.matrix;if(t&&t.dataReductionAlgorithm&&t.dataReductionAlgorithm.overlappingPointsSample){var i=t.dataReductionAlgorithm.overlappingPointsSample.count;t.dataReductionAlgorithm={sample:{}},i&&(t.dataReductionAlgorithm.sample.count=i)}else if(r&&r.rows&&r.rows.dataReductionAlgorithm&&r.rows.dataReductionAlgorithm.overlappingPointsSample){var i=r.rows.dataReductionAlgorithm.overlappingPointsSample.count;r.rows.dataReductionAlgorithm={sample:{}},i&&(r.rows.dataReductionAlgorithm.sample.count=i)}}function S(e){var t=e.matrix;if(t&&t.rows&&t.rows.dataReductionAlgorithm&&t.rows.dataReductionAlgorithm.topNPerLevel){var r=t.rows.dataReductionAlgorithm.topNPerLevel.fallbackTopCount;t.rows.dataReductionAlgorithm={top:{}},r&&(t.rows.dataReductionAlgorithm.top.count=r)}}function b(e){return _.every(e.schemas,(function(e){return e.capabilities&&e.capabilities.supportsTopNPerLevel}))}var E=e.data.CacheOptions,w=jsCommon.ArrayExtensions,V=e.ClientErrorStrings,F=e.data.CompiledDataViewMapping,P=e.data.DataBoundObjectQueryExtender,T=e.data.DataReaderUtils,N=e.explore.contracts.DataSource,D=e.DataViewAnalysis.DataViewMappingMatchErrorCode,R=e.data.DataViewObjectDefinitions,I=e.data.DataViewObjectDescriptors,j=e.data.services.DataViewObjectSerializer,O=e.data.DataViewRoleWildcard,M=e.data.FieldExprPattern,A=e.data.FilterKindDetector,k=e.data.PrimitiveValueEncoding,z=e.data.RelativeDateFilterPattern,B=e.data.ScalarKeyUtils,U=e.data.Selector,L=e.data.SemanticFilter,q=e.data.SemanticQuery,G=e.data.SQExpr,H=e.data.SQExprBuilder,Q=e.data.SQExprConverter,W=e.data.SQExprRewriter,X=e.data.SQExprUtils,K=jsCommon.StringExtensions,J=t.util.VisualContainerUtils;
r.createVisualQueryGenerator=i;var Y,$=(function(){function r(e,t,r,i,n,o,a,s,l,u,c){this.dataReaders=e,this.displayNames=t,this.visualPluginService=r,this.pluginOps=i,this.sortService=n,this.filterGenerator=o,this.aggrOps=a,this.featureSwitchService=s,this.transformPluginService=l,this.telemetryService=u,this.visualTimeSynchronizationService=c}return r.prototype.shouldExecute=function(e,t){if(!e||_.isEmpty(t))return!1;var r=e.visualType,i=this.visualPluginService.capabilities(r);if(!i||this.pluginOps.isQueryDisabled(r,i))return!1;if(!this.getQueryGenerator(t,e))return!1;if(null==e.query){var n=v(e,i),o=[n.visual];return this.featureSwitchService.featureSwitches.exprBoundVisualTitle&&o.push(n.visualContainer),!_.isEmpty(o)&&P.needsToExtend(q.create(),o)}return this.pluginOps.isQueryVisual(r)&&!this.pluginOps.isAnalysisVisual(r)},r.prototype.execute=function(t){var i,n=t.cacheOptions;if(!t.disableAnchorTime&&this.hasRelativeTimeFilters(t)){n=E.AllowQuery;var o=this.visualTimeSynchronizationService.getAnchorTime();i=k.toTypeEncoded(o,e.ValueType.fromExtendedType(519))}var s;t.performanceActivity&&(s=t.performanceActivity.createChildActivity("Query Generation"));var l=t.config,u=t.dataSources;if(!_.isEmpty(u)){var c=T.findTypes(u,l.query&&l.query.defn);if(!_.isEmpty(c)){var p=this.dataReaders.queryGenerator(c),d=this.getCompileMappingsResult(l,l&&l.visualType,t.schema,p,t.additionalFilters,t.dataViewMappingsOverride),f=this.dataReaders.queryExtensionLookup(u);if(d){if(d.error)return{options:null,error:d.error};var v=d.compiled;if(v){var m;if(v.query&&v.query.defn&&!_.isEmpty(v.query.defn.select())&&!_.isEmpty(v.query.defn.transforms())){m={};for(var h=0,g=v.query.defn.select();h<g.length;h++){var y=g[h];G.isTransformOutputRoleRef(y.expr)||(m[y.name]=y)}}var C=this.getVisualCapabilities(t.config.visualType),x=r.compileFilters(t.additionalFilters,C),S=this.generateQuery(p,t.schema,v,C.dataRoles,l.queryOptions&&l.queryOptions.keepProjectionOrder,C.filterMappings,x.dataFilter,x.highlightFilter,t.restartToken,t.dataWindow,t.dataSourceVariables,null,f,!!t.performanceActivity,C.noDefaultProjections,t.windowExpansion,i),b=S.result,w=S.query,V=S.resolvedQuery,F=t.additionalFilters?t.additionalFilters.queryRefsForSingleItemDrillFilters:void 0,P=this.dataReaders.readerType(c);if(P){var D=N.queried(t.dataSources,V),R={type:P,query:{dataSources:N.dataReaderDataSources(D),command:b.command,cacheOptions:n,cacheResponseOnServer:t.cacheResponseOnServer,allowCache:t.allowCache,allowClientSideFilters:this.getAllowClientSideFiltersOrDefault(t,C),ignoreViewportForCache:t.ignoreViewportForCache,performanceActivity:t.performanceActivity,applicationContext:t.applicationContext},perfId:t.config.visualType};R.kinds=this.pluginOps.targetedDataViewKinds(t.config.visualType,w);var I=a(R,t.schema,p,l.columnProperties,w,V,this.displayNames,this.aggrOps,C,v.objectDefinitions,b.splits,b.queryRewrites,d.warnings,v.mappings,F,m,x,S.deferred);return s&&s.resolve(),I.options.query&&(I.options.query.telemetryV2Enabled=t.telemetryV2Enabled,null!=t.requestPriority&&(I.options.query.requestPriority=t.requestPriority)),I}}}}}},r.prototype.hasRelativeTimeFilters=function(e){return!!e.additionalFilters&&z.anyRelativeTimeFilter(e.additionalFilters.dataFilter)},r.prototype.executeForFlattenedQuery=function(e,t){var i=e.config,n=this.getQueryGenerator(e.dataSources,i);if(n){var o=this.getCompileMappingsResult(i,i&&i.visualType,e.schema,n,e.additionalFilters,e.dataViewMappingsOverride);if(o&&!o.error){var a=o.compiled;if(a){var s=this.getVisualCapabilities(e.config.visualType),l=r.compileFilters(e.additionalFilters,s);return this.generateFlattenedQuery(n,e.schema,a,s.dataRoles,i.queryOptions&&i.queryOptions.keepProjectionOrder,s.filterMappings,l.dataFilter,l.highlightFilter,e.restartToken,e.dataWindow,e.dataSourceVariables,t,s.noDefaultProjections,e.windowExpansion)}}}},r.prototype.getQueryGenerator=function(e,t){if(!_.isEmpty(e)){var r=t.query,i=T.findTypes(e,r&&r.defn);if(i)return this.dataReaders.queryGenerator(i)}},r.prototype.getVisualCapabilities=function(e){if(e){var t=this.visualPluginService.getPlugin(e);return t&&t.capabilities}},r.prototype.getCompileMappingsResult=function(t,r,i,n,o,a){if(t&&r&&i){var s=this.visualPluginService.getPlugin(r);if(s){var l,u=this.getVisualCapabilities(r),c=a||u.dataViewMappings,p=t.query,d=u.sorting?u.sorting.implicit:null,f=p?J.createRoleKindByQueryRef(p):{};if(c&&p){var h=e.DataViewAnalysis.chooseDataViewMappings(p.projections,c,f,this.featureSwitchService.featureSwitches,u.objects,t.objects,p.defn.select(),i);if(!h.supportedMappings){var g=m(s,h.mappingErrors);if(g)return{error:g,compiled:null};var y=e.data.QueryProjectionsByRole.clone(p.projections);for(var C in y){var x=y[C];x.activeProjectionRefs=_.map(x.activeProjectionRefs,(function(t){return"select"+e.obfuscate(t)}));for(var S=0,b=x.all();S<b.length;S++)b[S]?b[S]={queryRef:"select"+e.obfuscate(b[S].queryRef)}:b[S]=null}var E=new ee("ClientError_NoSupportedDataViewMappingFound");return E.addDebugInfo("VisualType",r),E.addDebugInfo("QueryProjectionsByRole",JSON.stringify(y)),this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorError,r,JSON.stringify(E.getDetails(e.common.localize).debugErrorInfo)),{error:E,compiled:null}}l=this.compileMappingsWithProperties(r,i,p,h.supportedMappings,f,u.dataRoles,u,t.queryOptions,t.columnProperties,v(t,u),s.customizeQuery,d,n,o)}else{var w=v(t,u);l=this.compileNoMappingsWithProperties(i,p,f,c,u.dataRoles,w)}var V=[];if(l){if(l.error)return{error:l.error,compiled:null};V.push.apply(V,te.validateAndAdjustRolesIfNecessary(l.mappings,l.query,i,this.displayNames,u)||[]),V.push.apply(V,re.validateAndAdjustHighlightIfNecessary(o)||[]),l.warnings&&this.featureSwitchService.featureSwitches.propertyEvaluationWarnings&&V.push.apply(V,l.warnings);for(var F=0,P=V;F<P.length;F++){var T=P[F];this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorWarning,T.code)}}return{compiled:l,warnings:V}}}},r.compileFilters=function(e,t){var r,i,n,o;return e&&(i=e.dataFilter,n=e.dataFiltersUnmerged,r=e.highlightFilter,o=e.highlightFiltersUnmerged),{dataFilter:i,dataFiltersUnmerged:n,highlightFilter:r,highlightFiltersUnmerged:o}},r.prototype.getAllowClientSideFiltersOrDefault=function(e,t){return _.isBoolean(e.allowClientSideFilters)?e.allowClientSideFilters:!!I.findSelfFilter(t.objects)},r.prototype.compileMappingsWithProperties=function(r,i,n,o,a,s,l,u,c,p,d,v,m,h){_.isEmpty(n.defn.transforms())&&(n=t.TransformGeneratorUtils.addTransforms(p.visual.objects,o,n,this.transformPluginService,l));var g=e.data.compileDataView({mappings:o,queryDefn:n.defn,queryProjections:n.projections,schema:i,objectDescriptors:p.visual.descriptors,objectDefinitions:p.visual.objects,roles:s,featureSwitches:this.featureSwitchService.featureSwitches});if(d){var C=this.getSorts(g),x=d({dataViewMappings:g,preferHigherDataVolume:this.featureSwitchService.featureSwitches.preferHigherDataVolume,scopedAggregates:this.featureSwitchService.featureSwitches.scopedAggregates});if(x&&x.error){var S=x.error.code;return{error:f(e.common.localize.get(S),S),query:void 0,mappings:void 0,additionalProjections:void 0,objectDefinitions:void 0}}if(!_.isEmpty(n.expansionStates)){var b=void 0,E=g[0].matrix;if(E){var w=E.rows;w.for&&(b=_.map(w.for.in.items,(function(e){return e})))}for(var V=0,F=n.expansionStates;V<F.length;V++){var T=F[V];if(!_.isEmpty(T.root.children))for(var N=0,D=T.levels.length;N<D;N++)for(var R=T.levels[N],I=0,j=b;I<j.length;I++){var O=j[I];O.queryName===R.queryRefs[0]&&2!==O.subtotalType&&(O.subtotalType=1)}}}var M=this.getSorts(g);n=this.updateSorts(n,C,M)}y(g,u,i),n=t.TransformGeneratorUtils.removeUnsupportedTransforms(this.transformPluginService,n,g),n=this.sortService.applyImplicitSort(n,v),n=this.sortService.ensureValidSorting({query:n,schema:i,visualType:r,columnProperties:c,compiledMappings:g});var A=Y.setProperties(i,g,n,p.visual.objects,p.visual.descriptors),k=A.modifiedObjectDefinitions,z=A.addedScalarKeys;k=this.setFilteredToUniqueValueProperties(h,m,i,g,n,k),p.visual.objects=k;var B=this.getQueryRefsByRole(n,s),U=[p.visual];this.featureSwitchService.featureSwitches.exprBoundVisualTitle&&p.visualContainer&&U.push(p.visualContainer);var L,q,G,H=P.extend(n.defn,i,U,B,n.projections,a);if(H){L=new t.contracts.VisualQuery(H.queryDefn,n.projections,n.expansionStates),q=H.additionalProjections,G=H.warnings;for(var Q=0,W=z;Q<W.length;Q++){var X=W[Q],K=L.defn.selectNameOf(X.expr);X.roleItem.scalarKeyInfo||(X.roleItem.scalarKeyInfo={}),X.roleItem.scalarKeyInfo.scalarKeyQueryName=K}}return{query:L||n,mappings:g,additionalProjections:q,warnings:G,objectDefinitions:p.visual.objects}},r.prototype.getSorts=function(e){for(var t=[],r=0,i=e;r<i.length;r++){for(var n=i[r],o=[],a=0,s=n.metadata.columns;a<s.length;a++){var l=s[a];l.sort&&o.push({queryName:l.queryName,sort:l.sort,sortOrder:l.sortOrder})}t.push(o)}return t},r.prototype.updateSorts=function(e,r,i){if(_.isEqual(r,i))return e;for(var n=[],o=e.defn.select(),a=0,s=i;a<s.length;a++)for(var l=s[a],u=_.sortBy(l,(function(e){return e.sortOrder})),c=0,p=u;c<p.length;c++){var d=p[c],f=o.withName(d.queryName);n.push({direction:d.sort,expr:f.expr})}return new t.contracts.VisualQuery(e.defn.orderBy(n),e.projections,e.expansionStates)},r.prototype.getQueryRefsByRole=function(e,t){var r={};if(_.isEmpty(t))return r;for(var i=0,n=t;i<n.length;i++){var o=n[i],a=e.tryGetExprs(o.name);r[o.name]=_.map(a,(function(t){return e.defn.selectNameOf(t)}))}return r},r.prototype.setFilteredToUniqueValueProperties=function(e,t,r,i,n,o){var a=this;if(!e||!e.dataFilter)return o;for(var s,l=n.defn.select(),u=e.dataFilter.where(),c=e.queryRefsForSingleItemDrillFilters,p=0,d=i;p<d.length;p++){var f=d[p];f&&f.categorical&&f.categorical.categories&&F.visitCategoricalCategories(f.categorical.categories,{visitRole:function(e){if(!_.isEmpty(e.items))for(var i=0,n=e.items;i<n.length;i++){var p=n[i],d=p.queryName;if(p.filteredToUniqueValueProperty&&_.includes(c,d)){var f=l.withName(d),v=a.isColumnFilteredToUniqueValue(f.expr,u,r,t);v&&(s||(s=o?R.clone(o):{}),a.setFilteredToUniqueValueProperty(v,p,s))}}}})}return s||o},r.prototype.isColumnFilteredToUniqueValue=function(e,r,i,n){if(!n||!n.hasAmbiguousEqualitySemantics)return!0;var o=e.getKeyColumns(i);return _.every(o,(function(e){return _.some(r,(function(r){var i=t.FilterUtils.getFilterValuesForColumn(e,r);if(1===_.size(i)){var o=i[0];if(G.isConstant(o)&&!n.hasAmbiguousEqualitySemantics(o))return!0}return!1}))}))},r.prototype.setFilteredToUniqueValueProperty=function(e,t,r){var i=t.filteredToUniqueValueProperty,n=H.boolean(e),o={metadata:t.queryName};R.setValue(r,i,o,n)},r.prototype.compileNoMappingsWithProperties=function(r,i,n,o,a,s){if(!i&&_.isEmpty(o)){i=new t.contracts.VisualQuery(q.create(),{},[]);var l=this.getQueryRefsByRole(i,a),u=[s.visual];this.featureSwitchService.featureSwitches.exprBoundVisualTitle&&u.push(s.visualContainer);var c=P.extend(i.defn,r,u,l,i.projections,n);if(c){var p=new t.contracts.VisualQuery(c.queryDefn,i.projections,i.expansionStates),d=c.additionalProjections,f=e.data.compileDataView({mappings:[{table:{rows:{for:{in:"*"}}}}],queryDefn:i.defn,queryProjections:i.projections,schema:r,objectDescriptors:s.visual.descriptors,objectDefinitions:s.visual.objects,roles:a,featureSwitches:this.featureSwitchService.featureSwitches});return{query:p||i,mappings:f,additionalProjections:d,warnings:c.warnings,objectDefinitions:s.visual.objects}}}},r.prototype.generateQuery=function(e,t,r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=this.getQueryGeneratorOptions(t,r,i,n,o,a,s,l,u,c,p,d,f,v,m,h),y=e.execute(g);return{result:y,query:r.query,resolvedQuery:g.query,deferred:y.deferred}},r.prototype.generateFlattenedQuery=function(e,t,r,i,n,o,a,s,l,u,c,p,d,f){var v=this.getQueryGeneratorOptions(t,r,i,n,o,a,s,l,u,c,p,void 0,void 0,d,f);return e.executeForQueryOnly?e.executeForQueryOnly(v):v.query},r.prototype.getQueryGeneratorOptions=function(e,r,i,n,o,a,s,l,u,c,p,d,f,v,m,h){var g=r.query,y=t.TransformGeneratorUtils.rewriteTransform(this.transformPluginService,g,i,this.getQueryRefsByRole(r.query,i),r.additionalProjections,r.mappings),C=this.filterGenerator.resolveFilterTargets(e,y,i,o,a);return{query:p?p(C):C,queryExtensionLookup:d,mappings:r.mappings,additionalProjections:r.additionalProjections,highlightFilter:s,restartToken:l,dataWindow:u,highVolumeOverride:this.featureSwitchService&&this.featureSwitchService.featureSwitches.highVolume,expansionStates:r.query.expansionStates,dataSourceVariables:c,executionMetricsKinds:f?3:0,keepProjectionOrder:n,noDefaultProjections:v,windowExpansion:m,anchorTime:h}},r})();!(function(t){function r(e,t,r,n,o){for(var a,s=[],l=0,u=t;l<u.length;l++){var c=u[l];F.visitMapping(c,{visitRole:function(t){if(t.items)for(var l=0,u=t.items;l<u.length;l++){var c=u[l];if(c.scalarKeyInfo&&c.scalarKeyInfo.scalarKeyMinProperty){if(!a)if(n){var p=j.serializeObjects(n,o);a=j.deserializeObjects(p,o)}else a={};s.push(i(e,r,t,c,a))}}}})}return{modifiedObjectDefinitions:a||n,addedScalarKeys:s}}function i(t,r,i,n,o){var a=n.scalarKeyInfo.scalarKeyMinProperty;e.contract.check(n.scalarKeyInfo.hasScalarKey,"Scalar key requested when not available");var s=r.defn.select().withName(n.queryName).expr,l=H.aggregate(B.getScalarKeyExpr(s,t),3),u={data:[O.fromRoles([i.role])]};return R.setValue(o,a,u,l),{roleItem:n,expr:l}}t.setProperties=r})(Y||(Y={}));var Z=(function(t){function r(e,r,i,n){var o=t.call(this)||this;return o.query=e,o.queryRewrites=r,o.objects=i,o.context=n,o}return __extends(r,t),r.prototype.rewrite=function(){for(var t in this.objects)for(var r=0;r<this.objects[t].length;r++){var i=this.objects[t][r];if(i.selector){var n=i.selector,o=U.toScopeIdentities(n);if(!_.isEmpty(o)){this.rewrittenObjects||(this.rewrittenObjects=R.clone(this.objects));for(var a=0,s=o;a<s.length;a++){var l=s[a],u=l.expr;this.rewrittenObjects[t][r].selector={data:[e.data.createDataViewScopeIdentity(u.accept(this))]}}}}}},r.prototype.visitSelectRef=function(e){var t=e.expressionName,r=this.query.select().withName(t),i=r.expr;r&&G.isColumn(r.expr)&&G.isSubqueryRef(r.expr.source)&&(i=X.getSubqueryExpression(r.expr,this.context));var n=_.find(this.queryRewrites,(function(e){return e.selectExprReplaced&&G.equals(e.selectExprReplaced.originalExpr,i)}));return n?n.selectExprReplaced.replacedExpr:e},r})(W);r.getDataViewMappingErrorFromFailures=m;var ee=(function(){function t(t,r){this.messageId="VisualContainer_FailedToLoadVisual",this.displayableErrorInfo=[{errorInfoKey:"",errorInfoValue:""}],this.errorCode=t,"Missing_References"===t?(this.displayableErrorInfo[0].errorInfoKey="Missing_References_Details_Title",this.displayableErrorInfo[0].errorInfoValue=r,this.detailsMessageFormat="Missing_References_Details_Message",this.messageId="Missing_References_Message",this.errorSource="User"):"Broken_Filters"===t?(this.displayableErrorInfo[0].errorInfoKey="ServiceError_CannotLoadVisual",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("Broken_Filters_Details_Message"),this.messageId="Broken_Filters_Message"):"ClientError_NoSupportedDataViewMappingFound"===t&&(this.displayableErrorInfo[0].errorInfoKey="VisualDisplayError_Title",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("ClientError_NoSupportedDataViewMappingFound_Message"),this.messageId="ClientError_NoSupportedDataViewMappingFound_Message")}return t.create=function(e,r){if(!_.isEmpty(e)){for(var i=[],n=0,o=e;n<o.length;n++){var a=o[n],s=Q.asFieldPattern(a),l=M.toFieldExprEntityItemPattern(s);if(l){var u=M.getPropertyName(s);s.hierarchy&&(u=s.hierarchy.name),s.hierarchyLevel&&(u=s.hierarchyLevel.name+"."+s.hierarchyLevel.level);var c="("+l.entity+") "+u,p=r.schema(l.schema),d=p&&p.findProperty(l.entity,u);d&&d.errorMessage&&(c+=": "+d.errorMessage),i.push(c)}}return new t("Missing_References",i.join(", "))}},Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this.errorSource},enumerable:!0,configurable:!0}),t.prototype.addDebugInfo=function(e,t){this.debugErrorInfo||(this.debugErrorInfo=[]),this.debugErrorInfo.push({errorInfoKey:e,errorInfoValue:t})},t.prototype.getDetails=function(e){var t,r=e.get(this.displayableErrorInfo[0].errorInfoKey),i=this.displayableErrorInfo[0].errorInfoValue;return this.detailsMessageFormat&&(i=K.format(e.get(this.detailsMessageFormat),i)),{message:e.get(this.messageId),displayableErrorInfo:[{errorInfoKey:r,errorInfoValue:i}],debugErrorInfo:(t=[{errorInfoKey:V.ClientErrorCode,errorInfoValue:this.code}]).concat.apply(t,this.debugErrorInfo)}},t})();r.VisualQueryClientError=ee;var te;!(function(e){function t(e,t,i,n,o){for(var a=new r(t.defn,i,n,o),s=0,l=e;s<l.length;s++){var u=l[s];F.visitMapping(u,a)}return a.warnings}e.validateAndAdjustRolesIfNecessary=t;var r=(function(){function e(e,t,r,i){this.displayNameService=r,this.incompatibleExprInfo=[];for(var n=0,o=e.select();n<o.length;n++){var a=o[n],s=Q.asFieldPattern(a.expr);s&&s.percentOfGrandTotal&&this.incompatibleExprInfo.push({basePropertyName:M.getPropertyName(s),fieldDisplayName:this.displayNameService.getQualifiedDisplayName(a.expr,t,i)})}this.warnings=[]}return e.prototype.visitRole=function(e){e.showAll&&this.incompatibleExprInfo.length>0&&(e.showAll=!1,this.warnings.push(new i(this.incompatibleExprInfo)))},e})(),i=(function(){function e(e){this.errorInfos=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"ShowAllDiabledWarning"},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t=e.get("ShowAllDisabledWarning_Value"),r=_.map(this.errorInfos,(function(e){return e.fieldDisplayName})).join(", ");return{message:e.get("ShowAllDisabledWarning_Message"),displayableErrorInfo:[{errorInfoKey:e.get("ShowAllDiabledWarning_ErrorInfoKey"),errorInfoValue:K.format(t,r)}]}},e})()})(te||(te={}));var re;!(function(e){function t(e){if(e&&e.highlightFilter){var t=e.highlightFilter.where(),i=_.find(t,(function(e){return 3===A.run(e.condition)})),n=_.find(t,(function(e){return G.isExists(e.condition)}));if(i||n)return e.dataFilter=e.dataFilter?L.merge([e.dataFilter,e.highlightFilter]):e.highlightFilter,e.highlightFilter=void 0,[new r(i?0:1)]}}e.validateAndAdjustHighlightIfNecessary=t;var r=(function(){function e(e){this.highlightDisableType=e}return Object.defineProperty(e.prototype,"code",{get:function(){switch(this.highlightDisableType){case 0:return"HighlightWithTOPNDisabledWarning";case 1:return"HighlightWithExistsFiltersDisabledWarning"}},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t=0===this.highlightDisableType,r=t?"HighlightWithTOPNDisabledWarning_Message":"HighlightWithExistFiltersDisabledWarning_Message",i=t?"HighlightWithTOPNDisabledWarning_ErrorInfoKey":"HighlightWithExistFiltersDisabledWarning_ErrorInfoKey",n=t?"HighlightWithTOPNDisabledWarning_Value":"HighlightWithExistFiltersDisabledWarning_Value";return{message:e.get(r),displayableErrorInfo:[{errorInfoKey:e.get(i),errorInfoValue:e.get(n)}]}},e})()})(re||(re={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n){return new a(e,t,r,i,n)}var n=e.visuals.plugins,o=t.util.VisualContainerUtils;r.createVisualRelationshipService=i;var a=(function(){function r(e,t,r,i,n){this.visualPluginService=e,this.pluginOps=t,this.explorationNavigationService=r,this.featureSwitchService=i,this.visualCapabilitiesService=n}return r.prototype.relationship=function(e,t,r){return this.getRelationship(e.relationships,t,r)},r.prototype.drillRelationship=function(e,t,r){var i=this.getRelationship(e.relationships,t,r);if(i){var n=i;return 2===i.type&&(n={source:i.source,target:i.target,type:1}),n}},r.prototype.getRelationship=function(e,t,r){return _.find(e,(function(e){return e.source===t&&e.target===r}))},r.prototype.getIsCrossHighlightingDisabled=function(){if(!this.featureSwitchService||!this.featureSwitchService.featureSwitches.slowDataSourceModeEnabled)return!1;var e=this.explorationNavigationService&&this.explorationNavigationService.getCurrentExploration(),t=e&&e.slowDataSourceSettings;return t&&t.isCrossHighlightingDisabled},r.prototype.relationshipFilterAction=function(e,t,r,i){var n=this.relationship(e,t,r);return this.getRelationshipFilterAction(n,t,r,i)},r.prototype.drillRelationshipFilterAction=function(e,t,r,i){if(!t.drillFilterOtherVisuals)return 3;var n=this.drillRelationship(e,t,r),o=this.getRelationshipFilterAction(n,t,r,i);return o},r.prototype.shouldApplyCrossDrill=function(e,t,r,i){if(t===r)return!1;if(o.getVisualType(r)===n.slicer.name)return!1;var a=this.drillRelationshipFilterAction(e,t,r,i);if(1===a)return!0;if(0===a){if(1===this.defaultDrillFilterAction(t,r))return!0}return!1},r.prototype.getRelationshipFilterAction=function(t,r,i,n){if(t&&this.supportsFilterActionTarget(r,i,t.type))return t.type;var o=i&&i.config&&i.config.singleVisual,a=o&&i.config.singleVisual.visualType,s=this.visualPluginService.capabilities(a);if(this.getIsCrossHighlightingDisabled()&&!this.isSlicer(s,a)){var l=r&&r.config&&r.config.singleVisual,u=l&&r.config.singleVisual.visualType,c=this.visualPluginService.capabilities(u);if(!this.isFilter(c,u,l&&l.objects))return 3}if(s){var p=o.query;if(p){var d=this.visualPluginService.getPlugin(a);if(d&&d.isCrossFilteredByDefault){var f=o.objects,v={mappings:s.dataViewMappings,queryDefn:p.defn,queryProjections:p.projections,schema:n,objectDescriptors:s.objects,objectDefinitions:f,roles:s.dataRoles,featureSwitches:this.featureSwitchService.featureSwitches},m=e.data.compileDataView(v),h={dataViewMappings:m};if(d.isCrossFilteredByDefault(h))return 3}}}return 0},r.prototype.isSlicer=function(e,r){return!!t.FilterUtils.tryGetFilterPropertyIdentifier(e,r,this.visualPluginService)},r.prototype.isFilter=function(e,r,i){return e?this.isSlicer(e,r):null!=t.FilterUtils.tryGetFilterProperty(e,r,this.visualPluginService,i)},r.prototype.supportsFilterActionTarget=function(e,t,r){var i=o.getVisualType(t),n=o.getVisualType(e);if(!_.isEmpty(n)&&!_.isEmpty(i)){var a=this.visualPluginService.capabilities(i),s=this.pluginOps.isQueryVisual(i)||this.featureSwitchService.featureSwitches.exprBoundVisualTitle,l=!a||a.supportsHighlight;switch(r){case 1:return s;case 2:return l&&!this.visualCapabilitiesService.hasFilterCapabilities(n);case 3:return s||l}}return!1},r.prototype.supportsAnyFilterAction=function(e){var t=o.getVisualType(e);if(_.isEmpty(t)||!this.pluginOps.isQueryVisual(t)&&!this.pluginOps.isQnaVisual(t))return!1;var r=this.visualPluginService.capabilities(t);return!r||r.supportsSelection!==!1},r.prototype.defaultFilterAction=function(e,t){var r=this.explorationNavigationService&&this.explorationNavigationService.getCurrentExploration(),i=r&&r.settings;return i&&i.defaultFilterActionIsDataFilter||!this.supportsFilterActionTarget(e,t,2)?this.supportsFilterActionTarget(e,t,1)?1:void 0:2},r.prototype.defaultDrillFilterAction=function(e,t){var r=this.defaultFilterAction(e,t);return 2===r&&(r=1),r},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new s(e,t,r,i)}var i=e.data.SemanticFilter,n=e.data.SemanticQuery,o=e.data.services.SemanticQuerySerializer,a=e.data.SQExprBuilder;t.createHostFiltersService=r;var s=(function(){function e(e,t,r,i){this.conceptualSchemaProxy=e,this.dataProxyFactory=t,this.promiseFactory=r,this.eventBridge=i,this.filtersDictionary={}}return e.prototype.getHostAvailableCategories=function(e,t){var r=this;return this.conceptualSchemaProxy.get(e).then((function(e){var i=_.filter(e.schemas,(function(e){return!e.isExtensionSchema})),n=_.flatten(_.map(i,(function(e){return e.entities}))),o=_.flatten(_.map(n,(function(e){return e.properties}))),a=_.filter(t,(function(e){return 1===r.typeWithinSchemaCount(o,e)}));if(a.length>0){return{categories:a}}return{categories:[]}}))},e.prototype.typeWithinSchemaCount=function(e,t){return _.filter(e,(function(e){return e.type.extendedType===t.extendedType})).length},e.prototype.addOrUpdateHostFilters=function(e,t,r){var i=this;return this.conceptualSchemaProxy.get(t).then((function(n){return i.promiseFactory.all(_.map(e,(function(e){return i.addOrUpdateHostFilter(t,n,e,r)})))}))},e.prototype.removeHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];void 0!==this.filtersDictionary[i]&&delete this.filtersDictionary[i]}},e.prototype.selectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.filtersDictionary[i];n&&(n.selected=!0)}},e.prototype.deselectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.filtersDictionary[i]&&(this.filtersDictionary[i].selected=!1)}},e.prototype.applySelectedHostFilters=function(){this.eventBridge.publishToChannel(t.events.visualContainerChanged,{affectContainer:function(){return!0},allowCache:!0})},e.prototype.getSelectedHostFilters=function(){var e=[];for(var t in this.filtersDictionary){var r=this.filtersDictionary[t];r.selected&&e.push(r.filterContainer)}return{filters:e}},e.prototype.addOrUpdateHostFilter=function(e,t,r,o){if(r.type&&r.value){for(var s=r.value.toString(),l={hostFilterValue:{value:s,type:r.type},filterValue:s,filterKey:r.type.categoryString,filterCanExecute:!1,filterReturnNonEmptyResults:!1},u=[],c=_.filter(t.schemas,(function(e){return!e.isExtensionSchema})),p=0,d=c;p<d.length;p++)for(var f=d[p],v=0,m=f.entities;v<m.length;v++)for(var h=m[v],g=0,y=h.properties;g<y.length;g++){var C=y[g];C.type.extendedType===r.type.extendedType&&u.push({schema:f,entity:h,property:C})}if(1===u.length){var x=u[0].schema,S=u[0].entity,b=u[0].property,E=a.entity(x.name,S.name),w=a.columnRef(E,b.name),V=r.alternativeValues?r.alternativeValues.concat(r.value):[r.value],F=a.inValues([w],_.map(V,(function(e){return[a.typedConstant(e,r.type)]}))),P=i.fromSQExpr(F),T={name:l.filterKey,expression:E,filter:P};if(l.filterCanExecute=!0,this.filtersDictionary[l.filterKey]={filterContainer:T,selected:!1},o){var N=n.create().addSelect(w).addSemanticFilter(P);if(N)return this.testHostFilterForNonEmptyResults(e,l,N)}}return this.promiseFactory.resolve(l)}},e.prototype.testHostFilterForNonEmptyResults=function(e,t,r){if(t.filterCanExecute&&r&&e){var i=_.compact(_.map(e,(function(e){return e.dsr}))),n={type:"dsr",query:{dataSources:i,command:{Commands:[{SemanticQueryDataShapeCommand:{Query:o.serializeQuery(r)}}]},allowCache:!0,cacheResponseOnServer:!0}};return this.dataProxyFactory.create().execute(n).then((function(e){return e.dataReaderResult.dataView.table.rows.length>0&&(t.filterReturnNonEmptyResults=!0),t}),(function(){return t}))}this.promiseFactory.reject()},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.explore.util.VisualContainerUtils,i=(function(){function e(e){this.visualPlugins=e,this.collectedFilters=[]}return e.prototype.collectFilters=function(e,t,r){if(e)for(var i=0,n=e;i<n.length;i++){var o=n[i];o.filter&&this.collectFilter(o.filter,o,r,t)}},e.prototype.collectFiltersForFilterContainer=function(e,t,r,i){if(e)for(var n=0,o=e;n<o.length;n++){var a=o[n];a.filter&&a!==r&&this.collectFilter(a.filter,a,i,t)}},e.prototype.collectFilter=function(e,t,i,n,o){if(e){var a;i&&(a=r.getVisualCapabilities(i,this.visualPlugins)),this.collectedFilters.push({filter:e,filterContainer:t,sourceVisualContainer:i,sourceVisualContainerCapabilities:a,scopeType:n,collectedFilterSource:o})}},e.prototype.getCollectedFilters=function(){return this.collectedFilters},e})();t.FilterCollector=i})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,r,i,n,o,s,u){var c={filter:e,scope:r,filterExpressionMetadata:u};if(i)c.restatement=i.restatement,c.type=i.type,c.isHidden=!!i.isHiddenInViewMode,c.filterExpressionMetadata=i.expression?{expressions:[i.expression]}:void 0,c.displayName=i.displayName,i.cachedValueItems&&c.filterExpressionMetadata?c.filterExpressionMetadata.cachedValueItems=a(i.cachedValueItems,0):i.filterExpressionMetadata&&(c.filterExpressionMetadata=i.filterExpressionMetadata);else if(n&&t.FilterUtils.supportsFilterOutput(o)&&n.config.singleVisual.query){var p=n.config.singleVisual.query.defn.select(),d=n.config.singleVisual.cachedFilterDisplayItems,f=n.config.singleVisual.filterExpressionMetadata;if(p.length>=1&&d&&s===l.Slicer)c.filterExpressionMetadata={expressions:[p[0].expr],cachedValueItems:a(d,0)};else if(f)c.filterExpressionMetadata=f;else{c.filterExpressionMetadata={expressions:[]};for(var v=0,m=p;v<m.length;v++){var h=m[v];c.filterExpressionMetadata.expressions.push(h.expr)}}}return c}function n(e){if(null!=e){var t={Restatement:e.restatement,type:e.type};return e.expression&&(t.expression=c.serializeExpr(e.expression)),t}}function o(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var o=i[r];t.push(n(o))}return t}}function a(e,t){for(var r=[],i=0,n=e;i<n.length;i++){var o=n[i],a={identities:[o.identity],valueMap:{}};a.valueMap[t]=o.displayName,r.push(a)}return r}var s=jsCommon.ArrayExtensions,l=e.explore.contracts.CollectedFilterSource,u=e.data.SemanticFilter,c=e.data.services.SemanticQuerySerializer,p=e.data.SubqueryRewriter,d=e.data.TopNFilterPruner,f=t.util.VisualContainerUtils;r.toFilterData=i,r.generateSingleFilterMetadata=n,r.generateFilterMetadata=o;var v=(function(){function e(e,t){if(this.visualContainer=e,this.filterContainer=t,e){var r=f.getVisualQuery(e);r&&(this.visualSemanticQuery=r.defn)}this.needToEnsurePrecedence=!1,this.shouldPruneUnnecessaryFilters=!1}return e.prototype.setSelectorFilter=function(e){this.selectorFilter=e,this.shouldPruneUnnecessaryFilters=!0},e.prototype.addDrillFilter=function(e){this.drillFilters=this.drillFilters||[],this.drillFilters.push(e)},e.prototype.addVisualFilter=function(e){this.visualSemanticQuery&&(e.filter=p.rewriteSubqueriesForContainingQuery(e.filter,this.visualSemanticQuery)),this.visualFilters=this.visualFilters||[],this.visualFilters.push(e),this.needToEnsurePrecedence=!0,this.shouldPruneUnnecessaryFilters=!0},e.prototype.addDrillthroughFilter=function(e){this.drillthroughFilters=this.drillthroughFilters||[],this.drillthroughFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addSectionFilter=function(e){this.sectionFilters=this.sectionFilters||[],this.sectionFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addReportFilter=function(e){this.reportFilters=this.reportFilters||[],this.reportFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addCrossFilter=function(e){this.crossFilters=this.crossFilters||[],this.crossFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addHighlight=function(e){this.highlightFilters=this.highlightFilters||[],this.highlightFilters.push(e)},e.prototype.addCollectedFilters=function(e,t,r){for(var o=0,a=e;o<a.length;o++){var s=a[o],l=s.filter,u=s.filterContainer,c=s.sourceVisualContainer;if(!r||r(l,u,c)){var p=u;s.filterContainer&&s.filterContainer===this.filterContainer&&(p=null);var d=i(l,s.scopeType,p,c,s.sourceVisualContainerCapabilities,s.collectedFilterSource);!u||2!==u.howCreated&&0!==u.precedence?s.sourceVisualContainer?s.sourceVisualContainer===this.visualContainer?this.addVisualFilter(d):this.addCrossFilter(d):5===u.howCreated?this.addDrillthroughFilter(d):1===s.scopeType?this.addSectionFilter(d):2===s.scopeType?this.addReportFilter(d):s.filterContainer&&s.filterContainer===this.filterContainer&&this.addVisualFilter(d):this.addDrillFilter(d),t&&u&&(this.metadata=this.metadata||[],this.metadata.push(n(u)))}}},e.prototype.mergeHighlightFiltersBasedOnRelationship=function(e,t,r){var i=this;switch(t){case 0:case 2:if(!r){_.each(e,(function(e){return i.addHighlight(e)}));break}case 1:e&&_.each(e,(function(e){return i.addCrossFilter(e)}));break;
case 3:}},e.prototype.getFilters=function(e){var t=this.getFilterData(e),r=this.highlightFilters&&u.merge(this.highlightFilters.map((function(e){return e.filter})));return{dataFilter:t?u.merge(_.map(t,(function(e){return e.filter}))):void 0,dataFiltersUnmerged:t,highlightFilter:r,highlightFiltersUnmerged:this.highlightFilters,filterMetadata:this.metadata}},e.prototype.getFilterData=function(e){if(this.pruneUnnecessaryFilters(),e||this.ensurePrecedence(),this.drillFilters||this.sectionFilters||this.reportFilters||this.visualFilters||this.crossFilters||this.drillthroughFilters){var t=this.drillFilters||[],r=this.visualFilters||[],i=this.sectionFilters||[],n=this.drillthroughFilters||[],o=this.reportFilters||[],a=this.crossFilters||[];return t.concat(r).concat(a).concat(i).concat(n).concat(o)}},e.prototype.getCrossHighlightFilters=function(){if(this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.selectorFilter||this.visualFilters){var e=this.selectorFilter?[this.selectorFilter]:[],t=this.visualFilters||[];return e.concat(t)}},e.prototype.getHighlightFilters=function(){return this.highlightFilters},e.prototype.clearHighlightFilters=function(){this.highlightFilters=void 0},e.prototype.getUnmergedDrillCrossFilter=function(){return this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.drillFilters},e.prototype.getCrossFilters=function(){return this.crossFilters},e.prototype.ensurePrecedence=function(){if(this.needToEnsurePrecedence){if(this.visualFilters){var e={visualFilters:this.visualFilters,crossFilters:this.crossFilters,reportFilters:this.reportFilters,drillThroughFilters:this.drillthroughFilters,sectionFilters:this.sectionFilters};this.visualFilters=r.FilterPrecedenceResolver.resolve(e)}this.needToEnsurePrecedence=!1}},e.prototype.pruneUnnecessaryFilters=function(){var e=this;this.shouldPruneUnnecessaryFilters&&(this.visualFilters&&this.selectorFilter&&this.visualFilters&&this.selectorFilter&&(this.visualFilters=s.filterArray(this.visualFilters,(function(t,r){return t.filter=d.removeUnnecessaryTopNFilters(t.filter,e.selectorFilter.filter),t.filter.where().length>0}))),this.shouldPruneUnnecessaryFilters=!1)},e})();r.FilterBuilder=v})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FilterKindDetector,n=e.data.SemanticFilter,o=e.data.SubqueryRewriter;!(function(e){function t(e){if(_.isEmpty(e.visualFilters))return e.visualFilters;for(var t=!1,a=[],s=0,l=e.visualFilters;s<l.length;s++){var u=l[s],c=u.filter.where(),p=c.filter((function(e){return 0===i.run(e.condition)}));t=t||r([u]),a.push.apply(a,p.map((function(e){return n.fromSQExpr(e.condition)})))}if(!t)return e.visualFilters;for(var d=[],f=0,v=e.visualFilters;f<v.length;f++){var u=v[f],m=u;if(r([u])){var h=u.filter;_.isEmpty(a)||(h=o.makeSubqueriesLowerPrecedenceThanSpecificFilters(h,a)),_.isEmpty(e.crossFilters)||(h=o.makeSubqueriesLowerPrecedenceThanSpecificFilters(h,e.crossFilters.map((function(e){return e.filter})))),_.isEmpty(e.sectionFilters)||(h=o.makeSubqueriesLowerPrecedenceThanSpecificFilters(h,e.sectionFilters.map((function(e){return e.filter})))),_.isEmpty(e.drillThroughFilters)||(h=o.makeSubqueriesLowerPrecedenceThanSpecificFilters(h,e.drillThroughFilters.map((function(e){return e.filter})))),_.isEmpty(e.reportFilters)||(h=o.makeSubqueriesLowerPrecedenceThanSpecificFilters(h,e.reportFilters.map((function(e){return e.filter})))),m={filter:h}}d.push(m)}return d}function r(e){if(_.isEmpty(e))return!1;for(var t=0,r=e;t<r.length;t++){var n=r[t];if(_.some(n.filter.where(),(function(e){return 3===i.run(e.condition)})))return!0}return!1}e.resolve=t})(r=t.FilterPrecedenceResolver||(t.FilterPrecedenceResolver={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.FilterKindDetector,i=e.data.SQScopedEvalExpr,n=(function(){function t(e){this.options=e}return t.prototype.resolveSemanticQuery=function(e){return e?e.where(this.resolveFilters(e.where()),e.from()):null},t.prototype.resolveFilters=function(e){var t=this;return e?_.map(e,(function(e){return t.resolveFilter(e)})):null},t.prototype.resolveFilter=function(e){if(!e)return null;if(e.target)return e;if(e.condition){switch(r.run(e.condition)){case 0:return this.resolveColumnFilter(e);case 2:return this.resolveExistsFilter(e);case 1:return this.resolveMeasureFilter(e);case 3:return this.resolveSubqueryFilter(e);default:return}}},t.prototype.resolveColumnFilter=function(e){return{condition:e.condition}},t.prototype.resolveMeasureFilter=function(e){var t=this,r=null;this.options.mappings&&this.options.mappings.measureFilter&&(r=this.options.mappings.measureFilter.targetRoles),r&&_.some(r,(function(e){return t.options.queryProjections[e]}))||(r=this.getDefaultMeasureFilterTargetRoles());var i,n,a=e.condition;if(r){for(var s=0,l=r;s<l.length;s++){var u=l[s],c=this.options.queryProjections[u];if(c)for(var p=0,d=c.all();p<d.length;p++){var f=d[p],v=this.options.select.filter((function(e){return e.name===f.queryRef})),m=v[0].expr,h=v[0].name,g=m.getMetadata(this.options.schema),y=i&&i[h];g&&1!==g.kind&&!y&&(n||(n=[],i={}),n.push(m),i[h]=!0)}}a=o.rewrite(a,r)}return{target:n,condition:a}},t.prototype.resolveExistsFilter=function(e){return e},t.prototype.resolveSubqueryFilter=function(e){return{condition:e.condition}},t.prototype.getDefaultMeasureFilterTargetRoles=function(){return(this.options.dataRoles?this.options.dataRoles.filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping||t.kind===e.VisualDataRoleKind.GroupingOrMeasure})):[]).map((function(e){return e.name}))},t})();t.VisualFilterMappingResolver=n;var o=(function(t){function r(e){var r=t.call(this)||this;return r.filterTargetRoles=e,r}return __extends(r,t),r.rewrite=function(e,t){var i=new r(t);return e.accept(i)},r.prototype.visitScopedEval=function(t){var r=this,n=_.filter(t.scope,(function(t){return!e.data.SQExpr.isRoleRef(t)||_.includes(r.filterTargetRoles,t.role)}));return n.length===t.scope.length?t:new i(t.expression,n)},r})(e.data.SQExprRewriter)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,o,a,s,l){return new c(e,t,r,i,n,o,a,s,l)}var n=e.explore.contracts.AutoPageRefreshOption,o=e.explore.contracts.DataSource,a=e.common.constants,s=e.explore.util,l=e.common.events.reportRefreshStateChanged;r.createReportRefreshService=i;var u={autoRefreshEnabled:!0,refreshIntervalSeconds:1},c=(function(){function i(e,t,r,i,n,o,a,s,l){this.telemetryService=e,this.eventBridge=t,this.explorationNavigation=r,this.dataSourcesService=i,this.dataProxy=n,this.conceptualSchemaProxy=o,this.globalEventBridge=a,this.visualTimeSynchronizationService=s,this.reportRefreshConfigProxy=l,this.visualsLoaded=!1,this.timerExpired=!1,this.isRunning=!1,this.refreshDelayedCount=0,this.subscriptionManager=t.createChannelSubscriptionManager()}return i.prototype.subscribeEvents=function(){var t=this;this.subscriptionManager.subscribe(r.events.sectionChanged,(function(){return t.onSectionChanged()})).subscribe(e.common.events.printSectionReady,(function(){return t.onVisualsLoaded()})).subscribe(r.events.sectionObjectsEvaluated,(function(){return t.onSectionsObjectsEvaluated()})).subscribe(r.events.modelChanged,(function(){return t.onModelChanged()}))},i.prototype.init=function(t){return void 0===t&&(t=!0),__awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.triggerNotifications=t,this.loadPageSettings(),this.updateRefreshState(),this.subscribeEvents(),[2]}))}))},i.prototype.destroy=function(){this.stopRefresh(),this.subscriptionManager.unsubscribeAll()},i.prototype.refreshData=function(){var e=o.dataReaderDataSources(o.queried(this.dataSourcesService.get(),null));e&&(this.dataProxy.clearCache(a.dsrDataReaderType,e),this.eventBridge.publishToChannel(r.events.visualContainerChanged,{affectContainer:function(){return!0}}))},i.prototype.getRefreshStats=function(){return{adminConfig:this.adminConfig,effectiveRefreshInterval:this.effectiveRefreshInterval,lastRefreshTimestamp:this.lastUpdateDate?this.lastUpdateDate.toLocaleTimeString():void 0}},i.prototype.loadAdminSettings=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r;return __generator(this,(function(i){switch(i.label){case 0:return this.reportRefreshConfigProxy?(e=this.explorationNavigation.getCurrentExploration(),e.report&&e.report.modelId?(t=e.report.modelId,[4,this.reportRefreshConfigProxy.getAPRConfig(t)]):[2]):(this.adminConfig=u,[2]);case 1:return r=i.sent(),this.adminConfig=r&&r.data,[2]}}))}))},i.prototype.loadPageSettings=function(){var e,r=this.explorationNavigation.getCurrentSection();if(r.evaluatedObjects&&r.evaluatedObjects.pageRefresh&&r.evaluatedObjects.pageRefresh.show&&(null==r.evaluatedObjects.pageRefresh.refreshType||r.evaluatedObjects.pageRefresh.refreshType===n.APR)){e=this.refreshIntervalInMilliseconds;var i=s.DurationParser.parseISODurationdString(r.evaluatedObjects.pageRefresh.duration||t.constants.ExploreCanvasConstants.DefaultTimeInterval);this.refreshIntervalInMilliseconds=s.DurationParser.durationParseResultAsMilliseconds(i)}else this.refreshIntervalInMilliseconds=void 0;return this.refreshIntervalInMilliseconds!==e},i.prototype.onSectionsObjectsEvaluated=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=this.loadPageSettings(),this.refreshIntervalInMilliseconds&&e?this.updateRefreshState():!this.refreshIntervalInMilliseconds&&this.isRunning&&this.stopRefresh(),[2]}))}))},i.prototype.onModelChanged=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.getRefreshInterval()];case 1:return e=t.sent(),e&&!this.isRunning?this.updateRefreshState():!e&&this.isRunning&&this.stopRefresh(),[2]}}))}))},i.prototype.getRefreshInterval=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r;return __generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())];case 1:return e=i.sent(),[3,3];case 2:return t=i.sent(),[2,null];case 3:return r=_.some(e.schemas,(function(e){return e.capabilities&&e.capabilities.supportsFastRefresh})),r?this.refreshIntervalInMilliseconds&&this.adminConfig&&this.adminConfig.autoRefreshEnabled?[2,_.max([this.refreshIntervalInMilliseconds,1e3*this.adminConfig.refreshIntervalSeconds])]:[2]:[2,null]}}))}))},i.prototype.updateRefreshState=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return this.stopRefresh(),this.isRunning=!0,this.adminConfig||null==this.refreshIntervalInMilliseconds?[3,2]:[4,this.loadAdminSettings()];case 1:t.sent(),t.label=2;case 2:return[4,this.getRefreshInterval()];case 3:return e=t.sent(),null!=e?this.runTimer(e):this.isRunning=!1,[2]}}))}))},i.prototype.onSectionChanged=function(){this.lastUpdateDate=void 0,this.loadPageSettings(),this.updateRefreshState()},i.prototype.onVisualsLoaded=function(){this.visualsLoaded=!0,this.timerExpired&&this.isRunning&&this.triggerRefresh()},i.prototype.stopRefresh=function(){this.nextUpdateDate=void 0,this.isRunning=!1,this.timerExpired=!1,this.clearTimeoutAndAnimationFrame(),this.notifyReportRefreshStateChanged()},i.prototype.clearTimeoutAndAnimationFrame=function(){clearTimeout(this.timeoutId),this.timeoutId=void 0,cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0},i.prototype.runTimer=function(e){var t=this;this.clearTimeoutAndAnimationFrame(),this.nextUpdateDate=new Date(Date.now()+e),this.notifyReportRefreshStateChanged(),this.timeoutId=setTimeout((function(){t.timeoutId=void 0,t.animationFrameId=requestAnimationFrame((function(){t.animationFrameId=void 0,t.onTimerTriggered()}))}),e)},i.prototype.onTimerTriggered=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return this.timerExpired=!0,this.visualsLoaded?this.triggerRefresh():this.refreshDelayedCount+=1,[4,this.loadAdminSettings()];case 1:return t.sent(),[4,this.getRefreshInterval()];case 2:return e=t.sent(),null!=e?this.runTimer(e):this.stopRefresh(),[2]}}))}))},i.prototype.calculateEffectiveInterval=function(){this.effectiveRefreshInterval=this.lastUpdateDate?(new Date).getTime()-this.lastUpdateDate.getTime():void 0},i.prototype.triggerRefresh=function(){this.logTriggerRefresh(this.refreshDelayedCount),this.calculateEffectiveInterval(),this.lastUpdateDate=new Date,this.visualTimeSynchronizationService.setAnchorTimeToNow(),this.eventBridge.publishToChannel(r.events.dataRefreshTriggered),this.timerExpired=!1,this.visualsLoaded=!1,this.refreshDelayedCount=0,this.notifyReportRefreshStateChanged()},i.prototype.logTriggerRefresh=function(t){return __awaiter(this,void 0,e.Promise,(function(){var r,i,n,o,a,s,l,u,c,p,d;return __generator(this,(function(f){switch(f.label){case 0:return r=this.explorationNavigation.getCurrentSection(),i=this.explorationNavigation.getCurrentExploration().report,n=this.explorationNavigation.getExplorationTelemetryData(),o="",a=-1,s="",l="-1",u="-1",i&&i.model&&(c=i.model,o=c.dbName,s=i.objectId,a=c.id),p=r.objectId,[4,this.getRefreshInterval()];case 1:return d=f.sent(),n&&(l=n.exid,u=n.exsid),this.telemetryService.logEvent(e.telemetry.TriggerRefresh,s,p,o,a,d,t,l,u),[2]}}))}))},i.prototype.notifyReportRefreshStateChanged=function(){if(this.triggerNotifications){var e=void 0,t=this.explorationNavigation.getCurrentExploration().report;t&&(e=t.objectId),this.globalEventBridge.publishToChannel(l,{reportId:e,nextUpdateDate:this.nextUpdateDate,lastUpdateDate:this.lastUpdateDate})}},i})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new c(e)}function r(e){return new p(e)}function i(e){return new d(e)}function n(e){return new f(e)}function o(e,t){if(_.isEmpty(t))return t;var r=[];return t.forEach((function(t){r.push(a(e,t))})),r}function a(e,t){if(_.isEmpty(t))return t;var r={};return t.Table&&(r.Table=e.visitTableBinding(t.Table)),t.Pod&&(r.Pod=e.visitPodBinding(t.Pod)),t.Property&&(r.Property=e.visitPropertyBinding(t.Property)),t.Value&&(r.Value=e.visitValueBinding(t.Value)),t.Range&&(r.Range=e.visitRangeBinding(t.Range)),t.VisType&&(r.VisType=e.visitVisualizationTypeBinding(t.VisType)),t.Composite&&(r.Composite=e.visitCompositeBinding(t.Composite)),t.Core&&(r.Core=e.visitCoreTermBinding(t.Core)),t.AnyEntity&&(r.AnyEntity=e.visitAnyEntityBinding(t.AnyEntity)),r}function s(e,t){if(_.isEmpty(t))return t;var r={StartIndex:t.StartIndex,Length:t.Length,Resolution:t.Resolution};return null!=t.Source&&(r.Source=t.Source),t.Binding&&(r.Binding=a(e,t.Binding)),t.AlternateBindings&&(r.AlternateBindings=o(e,t.AlternateBindings)),t.PhraseCompletions&&(r.PhraseCompletions=o(e,t.PhraseCompletions)),t.SuggestedReplacements&&(r.SuggestedReplacements=o(e,t.SuggestedReplacements)),r}function l(e,t){return(e||"")===(t||"")}e.createMeasureMoveRewriter=t,e.createEntityRenameRewriter=r,e.createPropertyRenameRewriter=i,e.createHierarchyLevelRenameRewriter=n;var u=(function(){function e(){}return e.prototype.visitBinding=function(e){return e},e.prototype.visitEntityBinding=function(e){var t=e.EntityText,r=this.visitBinding(e),i=__assign({},r);return null!=t&&(i.EntityText=t),i},e.prototype.visitAnyEntityBinding=function(e){return this.visitEntityBinding(e)},e.prototype.visitModelEntityBinding=function(e){var t=e.ConceptualEntity,r=e.ConceptualSchema,i=this.visitEntityBinding(e),n=__assign({},e,i);return n.ConceptualEntity=t,null!=r&&(n.ConceptualSchema=r),n},e.prototype.visitTableBinding=function(e){return this.visitModelEntityBinding(e)},e.prototype.visitPodBinding=function(e){return this.visitModelEntityBinding(e)},e.prototype.visitPropertyBaseBinding=function(e){var t=e.ConceptualProperty,r=e.ConceptualHierarchy,i=e.ConceptualHierarchyLevel,n=this.visitModelEntityBinding(e),o=__assign({},n);return null!=t&&(o.ConceptualProperty=t),null!=r&&(o.ConceptualHierarchy=r),null!=i&&(o.ConceptualHierarchyLevel=i),o},e.prototype.visitPropertyBinding=function(e){return this.visitPropertyBaseBinding(e)},e.prototype.visitValueBinding=function(e){return this.visitPropertyBaseBinding(e)},e.prototype.visitRangeBinding=function(e){var t=e.LowerBoundTerm,r=e.UpperBoundTerm,i=this.visitPropertyBaseBinding(e),n=__assign({},i);return t&&(n.LowerBoundTerm=this.rewriteSpan(t)),r&&(n.UpperBoundTerm=this.rewriteSpan(r)),n},e.prototype.visitCoreTermBaseBinding=function(e){return this.visitBinding(e)},e.prototype.visitCoreTermBinding=function(e){return this.visitCoreTermBaseBinding(e)},e.prototype.visitVisualizationTypeBinding=function(e){var t=e.Type,r=this.visitCoreTermBaseBinding(e),i=__assign({},e,r);return i.Type=t,i},e.prototype.visitCompositeBinding=function(e){var t=this,r=e.Terms,i=this.visitBinding(e),n=__assign({},e,i);return n.Terms=r,_.isEmpty(r)||(n.Terms=[],r.forEach((function(e){n.Terms.push(t.rewriteSpan(e))}))),n},e.prototype.rewriteSpan=function(e){return s(this,e)},e})(),c=(function(e){function t(t){var r=e.call(this)||this;return r.change=t,r}return __extends(t,e),t.prototype.visitPropertyBaseBinding=function(e){var t=this.change;if(l(e.ConceptualSchema,t.schema)&&e.ConceptualEntity===t.source&&e.ConceptualProperty===t.property){var r=_.cloneDeep(e);return r.ConceptualEntity=t.destination,r}return e},t})(u),p=(function(e){function t(t){var r=e.call(this)||this;return r.change=t,r}return __extends(t,e),t.prototype.visitModelEntityBinding=function(e){var t=this.change;if(l(e.ConceptualSchema,t.schema)&&e.ConceptualEntity===t.before){var r=_.cloneDeep(e);return r.ConceptualEntity=t.after,r}return e},t})(u),d=(function(e){function t(t){var r=e.call(this)||this;return r.change=t,r}return __extends(t,e),t.prototype.visitPropertyBaseBinding=function(e){var t=this.change;if(l(e.ConceptualSchema,t.schema)&&t.entity===e.ConceptualEntity&&t.before===e.ConceptualProperty){var r=_.cloneDeep(e);return r.ConceptualProperty=t.after,r}return e},t})(u),f=(function(e){function t(t){var r=e.call(this)||this;return r.change=t,r}return __extends(t,e),t.prototype.visitPropertyBaseBinding=function(e){var t=this.change;if(l(e.ConceptualSchema,t.schema)&&t.entity===e.ConceptualEntity&&t.before===e.ConceptualHierarchyLevel){var r=_.cloneDeep(e);return r.ConceptualHierarchyLevel=t.after,r}return e},t})(u)})(t=e.BindingRewrite||(e.BindingRewrite={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){var i=t.capabilities(e);return!(!i||!r.isQueryVisual(e)||r.isAnalysisVisual(e))&&(!i.disableVisualDetails&&_.some(i.dataViewMappings,(function(e){return e.categorical||e.matrix||e.table||e.tree})))}function r(t,r){var i,n,o=r||1;return 1===o?(i=t.width-2*e.DetailVisualBorder,n=t.height-e.DetailVisualBorder):(i=t.width-e.DetailVisualBorder,n=t.height-2*e.DetailVisualBorder),{width:Math.max(i,0),height:Math.max(n,0),scale:t.scale}}e.DetailVisualBorder=10,e.supportsVisualDetails=t,e.getDetailVisualViewport=r})(t=e.DetailVisualUtils||(e.DetailVisualUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(t,r,i,n,a){if(!t)return i;var s=[],l=a.objects,u=function(e){var r=l[e],n=function(n){if(r.properties[n].type.queryTransform){var a=_.filter(t[e],(function(e){return o(e,i)}));s.push.apply(s,_.map(a,(function(t){return{objectName:e,propertyName:n,object:t}})))}};for(var a in r.properties)n(a)};for(var c in l)u(c);if(_.isEmpty(s))return i;for(var p=i.clone(),d=0,m=s;d<m.length;d++){var h=m[d],g=f.getValue(t,{objectName:h.objectName,propertyName:h.propertyName},h.object.selector);if(!g)return i;if(g.algorithm!==v.name||_.some(r,e.DataViewMapping.isForecastDefined)){var y=n.getTransformPlugin(g.algorithm);p.addTransform(y,g.parameters,a)}}return p}function n(t,r,i){var n=r.defn.transforms();if(_.isEmpty(n))return r;for(var o=r.clone(),a=0,s=n;a<s.length;a++){var l=s[a];if(l.algorithm===e.data.transforms.plugins.Forecast.name&&!_.some(i,e.DataViewMapping.isForecastDefined)){var u=t.getTransformPlugin(l.algorithm);o.removeTransform(u,l.name)}}return o}function o(e,t){if(!e.selector||!_.isString(e.selector.metadata))return!0;var r=t.projections;if(!r)return!1;for(var i in r){var n=r[i];if(n){var o=n.all();if(o)for(var a=0,s=o;a<s.length;a++){var l=s[a];if(l.queryRef===e.selector.metadata)return!0}}}return!1}function a(e,t,r,i,n,o){var a=t.defn.transforms();if(_.isEmpty(a))return t;var c=t.defn.select();if(_.isEmpty(c))return t;for(var p=u(t,r,i,n),d=p.transformSelects,f=p.topLevelSelects,v=[],g=0;g<a.length;g++){var y=a[g],x=e.getTransformPlugin(y.algorithm),S="input"+g,b="output"+g,E={algorithm:y.algorithm,name:y.name,input:{parameters:y.input.parameters,table:{name:S,columns:s(d,i,r,x,o)}},output:{table:{name:b,columns:l(d,S,t.projections)}}};d=_.map(E.output.table.columns,(function(e){var t=h.columnRef(h.transformTableRef(b),e.expression.name);return{name:e.expression.name,expr:t}})),v.push(E)}var w,V=_.last(v),F=t.defn.orderBy();V&&!_.isEmpty(F)&&(w=_.map(F,(function(e){var t=_.find(c,(function(t){return m.equals(t.expr,e.expr)})),r=h.columnRef(h.transformTableRef(V.output.table.name),t.name);return{direction:e.direction,expr:r}})));var P=t.defn.transforms(v);if(!_.isEmpty(f))for(var T=function(e){var t=_.findIndex(c,(function(t){return t.name===e.name}));d.splice(t,0,e)},N=0,D=f;N<D.length;N++){var R=D[N];T(R)}return P=P.select(d),w&&(P=P.orderBy(w)),new C(P,t.projections,t.expansionStates)}function s(e,t,r,i,n){var o=_.filter(e,(function(e){return!m.isTransformOutputRoleRef(e.expr)})),a=c(n),s=Object.keys(t);return _.map(o,(function(e){var n=_.find(s,(function(r){return _.includes(t[r],e.name)}));if(!n)return{role:"X",expression:e};var o=_.find(r,(function(e){return e.name===n}));return{role:a&&0===o.cartesianKind?void 0:p(e.expr,i,o),expression:e}}))}function l(e,t,r){for(var i={},n=0,o=e;n<o.length;n++){var a=o[n];m.isTransformOutputRoleRef(a.expr)||(i[a.name]=!0)}return _.map(e,(function(e){var n,o,a;if(m.isTransformOutputRoleRef(e.expr)){var s=void 0;for(var l in r){var u=r[l].all();_.some(u,(function(t){return t.queryRef===e.name}))&&(s=l)}n=s,o=e.expr,a=y.findUniqueName(i,e.name)}else o=h.columnRef(h.transformTableRef(t),e.name),a=e.name;return{role:n,expression:{name:a,expr:o}}}))}function u(e,t,r,i){for(var n=[],o=[],a=e.defn.select(),s=function(t){if(m.isTransformOutputRoleRef(t.expr))return n.push(t),"continue";var a=Object.keys(r),s=_.filter(a,(function(e){return _.includes(r[e],t.name)}));if(!_.isEmpty(s)){for(var l=!1,u=0,c=s;u<c.length;u++){var p=c[u];if(!e.projections[p].activeProjectionRefs||_.includes(e.projections[p].activeProjectionRefs,t.name)){n.push(t),l=!0;break}}return l||o.push(t),"continue"}if(!_.isEmpty(i)){var d=_.find(i,(function(e){return e.queryName===t.name}));d&&d.selector&&d.selector.data?n.push(t):o.push(t)}},l=0,u=a;l<u.length;l++){s(u[l])}return{transformSelects:n,topLevelSelects:o}}function c(e){for(var t=!1,r=0,i=e;r<i.length;r++){var n=i[r];if(n.categorical){var o=n.categorical.categories;_.isEmpty(o)||d.visitCategoricalCategories(o,{visitRole:function(e){_.some(e.items,(function(e){return e.scalarKeyInfo&&e.scalarKeyInfo.scalarKeyMinProperty}))&&(t=!0)}})}if(t)break}return t}function p(e,t,r){var i=_.find(t.inputRoles,(function(t){var i=t.visualDataRoleMatching;return!i||(void 0===i.cartesianKind||i.cartesianKind===r.cartesianKind)&&((void 0===i.matchGrouping||i.matchGrouping!==g.isMeasure(e))&&((void 0===i.matchMeasure||i.matchMeasure===g.isMeasure(e))&&(!i.skipJoinPredicateNone||0!==r.joinPredicate)))}));if(i)return i.name}var d=e.data.CompiledDataViewMapping,f=e.data.DataViewObjectDefinitions,v=e.data.transforms.plugins.Forecast,m=e.data.SQExpr,h=e.data.SQExprBuilder,g=e.data.SQExprUtils,y=jsCommon.StringExtensions,C=t.contracts.VisualQuery;r.addTransforms=i,r.removeUnsupportedTransforms=n,r.rewriteTransform=a})(r=t.TransformGeneratorUtils||(t.TransformGeneratorUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){t.invalidSortExprIndex=-1,t.DefaultSchemaName=e.data.dsr.DefaultSchemaName,t.ExplorationSchemaName="extension",t.DefaultDrillFilterOtherVisuals=!0,t.SectionComponentType="page",t.ExplorationComponentType="report",t.GroupComponentType="group";var r;!(function(e){function t(){return{color:e.DefaultCanvasBackgroundColor,transparency:e.DefaultCanvasBackgroundTransparency}}function r(){return{color:e.DefaultCanvasOutspaceColor,transparency:e.DefaultCanvasOutspaceTransparency}}e.DefaultCanvasWidth=960,e.DefaultCanvasHeight=720,e.DefaultCanvasBackgroundColor="#FFFFFF",e.DefaultCanvasOutspaceColor="#EAEAEA",e.DefaultCanvasOutspaceTransparency=0,e.DefaultOutspacePaneTransparency=0,e.DefaultControlForegroundColor="#000000",e.DefaultControlBackgroundColor="#ffffff",e.DefaultOutspacePaneWidth=200,e.OutspacePaneCollapsedWidth=32,e.OutspacePaneMinWidth=180,e.OutspacePaneMaxWidth=420,e.DefaultOutspacePaneBorder=!0,e.DefaultOutspacePaneBorderColor="#C8C8C8",e.DefaultOutspacePaneTitleSizePt=12,e.DefaultOutspaceSearchTextSizePt=10,e.DefaultOutspacePaneHeaderSizePt=9,e.DefaultOutspacePaneFontFamily="'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif",e.DefaultAppliedFilterCardTransparency=0,e.DefaultAvailableFilterCardTransparency=0,e.DefaultFilterCardBorder=!0,e.DefaultFilterCardBorderColor="#C8C8C8",e.DefaultFilterCardTextSizePt=9,e.Available="Available",e.Applied="Applied",e.FilterCardSearchBoxBorderColor="#C8C6C4",e.FilterCardSearchBoxBackgroundColor="#FFFFFF",e.FilterCardFontColor="#252423",e.DefaultCanvasBackgroundTransparency=0,e.DefaultWidescreenWidth=1280,e.DefaultWidescreenHeight=720,e.DefaultCortanaWidth=296,e.DefaultCortanaHeight=592,e.DefaultLetterWidth=816,e.DefaultLetterHeight=1056,e.DefaultTooltipWidth=320,e.DefaultTooltipHeight=240,e.CanvasGutterSize=10,e.DefaultTimeInterval="PT30M",e.getDefaultCanvasBackground=t,e.getDefaultCanvasOutspace=r})(r=t.ExploreCanvasConstants||(t.ExploreCanvasConstants={}))})(r=t.constants||(t.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,r,i,n){var o;void 0===i&&(i=!0),void 0===n&&(n=0);var a={skipUnmatchedDrillthroughFilters:!1,filterMatchingBehavior:n},s=t.getFiltersState(e,a,r);return{state:{activeSection:i?e.name:void 0,sections:(o={},o[e.name]={filters:s},o)},options:{clearUnmatchedData:!1,suppressActiveSection:!i}}}function i(t,r,i){var n=[],o=i?i.slice():[],a={},s=r.filterMatchingBehavior;if(!_.isEmpty(t.filters))for(var l=function(t){if(5!==t.howCreated||t.isTransient)return"continue";var i=_.find(o,(function(e){return(1===s||!e.isTransient)&&e.filterExpressionMetadata&&1===e.filterExpressionMetadata.expressions.length&&u.equals(e.filterExpressionMetadata.expressions[0],t.expression)})),l=e.explore.services.convertToFilterContainerState(t);if(i)_.remove(o,i),l.filter=i.filter,l.cachedValueItems=void 0;else{if(r.skipUnmatchedDrillthroughFilters)return"continue";l.filter=void 0,l.cachedValueItems=void 0}n.push(l),a[t.name]=!0},p=0,d=t.filters;p<d.length;p++){var f=d[p];l(f)}var v={exprIdentifiedMerges:n};if(0===s&&_.some(o,(function(e){return e.isTransient}))||1===s&&!_.isEmpty(o)){for(var m=[],h=0,g=o;h<g.length;h++){var y=g[h],C=c.findUniqueName(a,"transientFilter");a[C]=!0;var x={name:C,expression:_.isEmpty(y.filterExpressionMetadata)||1!==y.filterExpressionMetadata.expressions.length?void 0:y.filterExpressionMetadata.expressions[0],type:y.type,restatement:y.restatement,filter:y.filter,howCreated:5,isTransient:!0,displayName:y.displayName};m.push(x)}v.transientFilters=m}return v}function n(e,t,r,i){for(var n=[],o=function(e){var o=e.fieldExpr;if(!o)return"continue";if(u.isMeasure(o)){_.find(r,(function(e){return u.isMeasure(e)&&u.equals(e,o)}))&&n.push(e)}else{var a=o.getKeyColumns(i);if(!_.isEmpty(a))if(e.asAggregation)for(var s=0,l=r;s<l.length;s++){var c=l[s];if(u.isAggregation(c)){var p=c.arg.getKeyColumns(i);if(d.isSubset(a,p)){n.push(e);break}}}else d.isSubset(a,t)&&n.push(e)}},a=0,s=e;a<s.length;a++){o(s[a])}return n}function o(e,t,r){for(var i=[],n=f.getVisualQuery(t),o=0,a=e;o<a.length;o++){var s=a[o];if(s.metadata)for(var u=0,c=s.metadata;u<c.length;u++){var d=c[u],v=n.defn.select().withName(d);if(v&&v.expr){var m=p.asFieldPattern(v.expr,r),h=l.getBaseSQExpr(m,r);i.push(h)}}}return i}function a(e,t){return(1===e||2===e)&&_.some(t,(function(e){return e.asAggregation||e.fieldExpr&&u.isMeasure(e.fieldExpr)}))}var s=e.data,l=s.FieldExprPattern,u=s.SQExpr,c=jsCommon.StringExtensions,p=e.data.SQExprConverter,d=s.SQExprUtils,f=e.explore.util.VisualContainerUtils;t.getApplyStateInfoForInternallDrillthrough=r,t.getFiltersState=i,t.getMatchedLinkFields=n,t.getMeasuresFromSelectors=o,t.hasMeasureOrAsAggregationPodParameter=a})(r=t.DrillthroughUtils||(t.DrillthroughUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.SQEntityExpr,i=e.data.SQExprRewriter,n=e.data.SQHierarchyExpr,o=e.data.SQHierarchyLevelExpr,a=e.data.SQPropertyVariationSourceExpr,s=(function(e){function t(t){var r=e.call(this)||this;return r.schema=t,r}return __extends(t,e),t.prototype.visitEntity=function(e){var t=this.getVariationMapping(e);return t?new r(e.schema,t.sourceEntity.name):e},t.prototype.visitColumnRef=function(e){var t=e.source.accept(this);if(t!==e.source){var r=this.getVariationMapping(e.source);if(r){var i=_.find(r.variation.defaultHierarchy.levels,(function(t){return t.column.name===e.ref}));if(i)return new o(new n(new a(t,r.variation.name,r.sourceProperty.name),r.variation.defaultHierarchy.name),i.name)}}return e},t.prototype.getVariationMapping=function(e){var t=this.schema.schema(e.schema).findVariationToHierarchyMappings(e.entity);if(t)return _.last(t)},t})(i);t.VariationToHierarchyRewriter=s})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){if(e)for(var r=0,n=e;r<n.length;r++){var o=n[r];i(o,t)}}function i(e,t){if(e&&e.filterExpressionMetadata&&e.filterExpressionMetadata.expressions){for(var r=[],i=0,n=e.filterExpressionMetadata.expressions;i<n.length;i++){var o=n[i];r.push.apply(r,f.run(o,t))}if(r=_.uniqBy(r,(function(e){return e.entity})),1===r.length){var a=r[0],s=[];e.filter=v.rewriteFilter(e.filter,a,t,s),1===s.length&&(e.filter=m.rewriteFilter(e.filter,s[0],a))}}}var n=e.data,o=n.DefaultSQExprVisitorWithTraversal,a=n.SemanticFilter,s=n.SemanticQueryRewriter,l=n.SQEntityExpr,u=n.SQExprUtils,c=n.SQFromEntitySource,p=n.SQFromSubquerySource,d=n.SQExprRewriter;t.rewriteVariationTargetEntities=r,t.rewriteVariationTargetEntity=i;var f=(function(e){function t(t){var r=e.call(this)||this;return r.schema=t,r.targets=[],r}return __extends(t,e),t.run=function(e,r){if(e){var i=new t(r);return e.accept(i),i.targets}},t.prototype.visitHierarchyLevel=function(e,t){if(u.isFromVariation(e)){var r=e.getKeyColumns(this.schema);if(!_.isEmpty(r)){var i=r[0].getTargetEntity();i&&this.targets.push(i)}}},t})(o),v=(function(){function e(e,t,r){this.schema=e,this.target=t,this.missing=r}return e.rewriteFilter=function(t,r,i,n){var o=s.rewriteFrom(t.from(),new e(i,r,n));return 1===n.length?new a(o,t.where()):t},e.prototype.visitEntity=function(e,t){var r=this.schema.schema(e.schema);return r&&_.find(r.entities,(function(t){return t.name===e.entity}))?e:(this.missing.push(e),new c(this.target.schema,this.target.entity))},e.prototype.visitSubquery=function(e,t){var r=s.rewriteFrom(e.subquery.from(),this);return new p(e.subquery.from(r));
},e.prototype.visitExpr=function(e,t){return e},e})(),m=(function(e){function t(t,r){var i=e.call(this)||this;return i.missing=t,i.target=r,i}return __extends(t,e),t.rewriteFilter=function(e,r,i){if(r){var n=new l(r.schema,r.entity);return e.rewrite(new t(n,i))}},t.prototype.visitEntity=function(e){return e.schema===this.missing.schema&&e.entity===this.missing.entity?new l(this.target.schema,this.target.entity,this.target.variable):e},t})(d)})(r=t.VariationUtils||(t.VariationUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createDefaultClipboardStorageService=t;var r=(function(){function e(){}return e.prototype.canPaste=function(){return Boolean(this.data&&this.data.visuals)},e.prototype.setData=function(e){this.data=e},e.prototype.getData=function(){return this.data},e.prototype.clearData=function(){this.data=void 0},e.prototype.supportsMultipleReports=function(){return!1},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return new a(e)}var i=e.explore.util.ExplorationTelemetryUtil,n=e.common.helpers.TelemetryHelper.TelemetryEventManager;t.createExplorationActivityService=r;var o=(function(){function e(e,t){this.unregisterExploreCanvasVisualRenderedListener=e,this.unregisterDestroyScopeListener=t}return e.prototype.unregister=function(){this.unregisterExploreCanvasVisualRenderedListener(),this.unregisterDestroyScopeListener()},e})(),a=(function(){function r(e){this.eventBridge=e,this.changeSectionActivity=new n({onReject:function(e){return e.event.info.isCancelled=!0}})}return r.prototype.registerExplorationNavigationService=function(e){this.explorationNavigation=e},r.prototype.registerExplorationHostScope=function(e,r){var i=this;this.telemetryScope&&this.unregisterExplorationHostScope(this.telemetryScope),this.telemetryScope=e,this.getVisualContainers=r;var n=this.eventBridge.createChannelSubscriptionManager().subscribe(t.events.exploreCanvasVisualRendered,(function(){return i.changeSectionActivity.resolve()}));this.listeners=new o(function(){return n.unsubscribeAll()},e.$on("$destroy",(function(){i.unregisterExplorationHostScope(i.telemetryScope)})))},r.prototype.unregisterExplorationHostScope=function(e){this.telemetryScope&&e===this.telemetryScope&&(this.listeners.unregister(),this.telemetryScope=void 0,this.getVisualContainers=void 0,this.listeners=void 0)},r.prototype.doActivity=function(e,t){if(!this.telemetryScope)return jsCommon.Trace.warning("doActivity with no registered exploration host scope"),e(_.noop);var r=t(this.telemetryScope);try{return e((function(e){r&&(r.reject(e),r=void 0)}))}catch(e){throw r&&(r.reject({errorCode:"Exception",errorMessage:e&&e.name}),r=void 0),e}finally{this.resolveActivityTelemetry(r)}},r.prototype.doActivityAsync=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var e,i,n;return __generator(this,(function(o){switch(o.label){case 0:return this.telemetryScope?[3,2]:(jsCommon.Trace.warning("doActivityAsync with no registered exploration host scope"),[4,t(_.noop)]);case 1:return[2,o.sent()];case 2:e=r(this.telemetryScope),o.label=3;case 3:return o.trys.push([3,5,6,7]),[4,t((function(t){e&&(e.reject(t),e=void 0)}))];case 4:return i=o.sent(),[2,i];case 5:throw n=o.sent(),e&&(e.reject({errorCode:"Exception",errorMessage:n&&n.name}),e=void 0),n;case 6:return this.resolveActivityTelemetry(e),[7];case 7:return[2]}}))}))},r.prototype.changeSection=function(e,t){var r=this;if(this.telemetryScope){this.changeSectionActivity.start((function(){return t(r.telemetryScope)}));try{var n=this.getVisualContainers();e(this.changeSectionActivity.event);var o=this.getVisualContainers();i.addExplorationInfoToEvent(this.changeSectionActivity.event.event,this.explorationNavigation),(_.isEmpty(o)||n===o)&&this.changeSectionActivity.resolve()}catch(e){throw this.changeSectionActivity.reject({errorCode:"Exception",errorMessage:e&&e.name}),e}}else jsCommon.Trace.warning("Section change with no registered exploration host scope"),e()},r.prototype.resolveActivityTelemetry=function(e){e&&(i.addExplorationInfoToEvent(e.event,this.explorationNavigation),e.resolve())},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("Explore/services/explorationStateDiffer",["require","exports"],(function(e,t){function r(e,t){var r=t.activeSection!==e.activeSection,o=t.dataSourceVariables&&t.dataSourceVariables!==e.dataSourceVariables,a={activeSection:r?t.activeSection:void 0,dataSourceVariables:o?t.dataSourceVariables:void 0},s=n(e.sections,t.sections);_.isEmpty(s)||(a.sections=s);var u=l(e.filters,t.filters);_.isEmpty(u)||(a.filters=u);var c=i(e.objects,t.objects);if(_.isEmpty(c)||(a.objects=c),!(_.isEmpty(s)&&_.isEmpty(u)&&_.isEmpty(c))||r||o)return a}function i(e,t){var r={};e=e||{merge:{}},t=t||{merge:{}};for(var i in t.merge)for(var n=0,o=t.merge[i];n<o.length;n++){var a=o[n],s=v.clone(e.merge),l=v.ensure(s,i,a.selector);for(var u in a.properties){var c=a.properties[u];v.propertiesAreEqual(l.properties[u],c)||(r.merge=r.merge||{},v.setValue(r.merge,{objectName:i,propertyName:u},null,c))}}return r}function n(e,t){if(e&&t){var r={};for(var i in t){var n=t[i],a=e[i];if(a){var s=o(a,n);s&&(r[i]=s)}}return r}}function o(e,t){var r={},i=!1,n=a(e.visualContainers,t.visualContainers);_.isEmpty(n)||(r.visualContainers=n,i=!0);var o=s(e.visualContainerGroups,t.visualContainerGroups);_.isEmpty(o)||(r.visualContainerGroups=o,i=!0);var u=l(e.filters,t.filters);return _.isEmpty(u)||(r.filters=u,i=!0),i&&r}function a(e,t){if(e&&t){var r={};for(var i in t){var n={},o=t[i],a=e[i];if(a){var s=l(a.filters,o.filters);_.isEmpty(s)||(n.filters=s),a.highlight!==o.highlight&&(n.highlight=o.highlight),a.visibility!==o.visibility&&(n.visibility=o.visibility);var u=m.serializeSingleVisual(a.singleVisual,n.visibility),c=m.serializeSingleVisual(o.singleVisual,n.visibility);g.equals(u,c)||(n.singleVisual=o.singleVisual),_.isEmpty(n)||(r[i]=n)}}return r}}function s(e,t){if(e&&t){var r={};for(var i in t){var n={},o=t[i],a=e[i];if(a){var l=void 0;a.isHidden!==o.isHidden&&(n.isHidden=o.isHidden,l=!0);var u=o.children,c=a.children;if(!_.isEmpty(c)&&!_.isEmpty(u)){var p=s(c,u);_.isEmpty(p)||(n.children=p,l=!0)}l&&(r[i]=n)}}return _.isEmpty(r)?void 0:r}}function l(e,t){if(!e)return t;t=t||{};var r={},i=u(e.nameIdentifiedMerges,t.nameIdentifiedMerges);_.isEmpty(i)||(r.nameIdentifiedMerges=i);var n=function(e,t){return y.equals(t.expression,e.expression)},o=c(e.exprIdentifiedMerges,t.exprIdentifiedMerges,n);_.isEmpty(o)||(r.exprIdentifiedMerges=o);var a=c(e.transientFilters,t.transientFilters,n);_.isEmpty(a)||(r.transientFilters=a);var s=function(e,t){return t.type===e.type},l=c(e.typeIdentifiedMerges,t.typeIdentifiedMerges,s);return _.isEmpty(l)||(r.typeIdentifiedMerges=l),r}function u(e,t){if(_.isEmpty(e))return t;var r={},i=_.clone(t||{});for(var n in e){var o=e[n],a=i[n];if(delete i[n],a){var s=p(o,a);if(!s)continue;r[n]=s}else{var l=d(o);if(!l)continue;r[n]=l}}return r}function c(e,t,r){if(_.isEmpty(e))return t;t=t||[];for(var i=[],n=t.slice(),o=function(e){var t=_.findIndex(n,(function(t){return r(e,t)})),o=n[t];if(_.pullAt(n,t),o){var a=p(e,o);if(!a)return"continue";i.push(a)}else{var s=d(e);if(!s)return"continue";i.push(s)}},a=0,s=e;a<s.length;a++){o(s[a])}return i}function p(e,t){return e&&g.equals(e,t)?void 0:t}function d(e){if(e&&e.type!==h.Passthrough)return{name:e.name,type:e.type,expression:e.expression,howCreated:e.howCreated}}Object.defineProperty(t,"__esModule",{value:!0});var f=powerbi.explore.contracts,v=powerbi.data.DataViewObjectDefinitions,m=powerbi.explore.services.ExplorationState,h=f.FilterType,g=jsCommon.JsonComparer,y=powerbi.data.SQExpr;t.diff=r}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n,o,a){return new l(e,t,r,i,n,o,a)}var i=e,n=i.explore,o=n.services,a=o.events,s=a.explorationFiltersContainerChanged;t.createExplorationStateManagerService=r;var l=(function(){function t(e,t,r,i,n,o,a){this.state=e,this.navigation=t,this.eventBridge=r,this.visibility=i,this.filterGenerator=n,this.explorationActivity=o,this.telemetryService=a}return t.prototype.exploration=function(){return this.navigation.getCurrentExploration()},t.prototype.capture=function(e,t){var r=this.exploration();if(r)return this.state.capture(r,e,t)},t.prototype.apply=function(e,t,r){var i=this.exploration(),n=this.state.apply(e,i,t,r);return this.applyImpact(n,i,r),n},t.prototype.captureFilterState=function(e){return this.state.captureFilterState(e)},t.prototype.applyFilterState=function(t,r){var i=this;if(!_.isEmpty(t)){var n=this.state.applyFilterState(t,r);this.explorationActivity.doActivity((function(){i.eventBridge.publishToChannel(a.visualContainerChanged,{affectContainer:function(e){return _.includes(n.visualContainers,e)}})}),(function(t){return i.telemetryService.startActivity(t,e.telemetry.EXExplorationStateApplyImpact)}))}},t.prototype.applyImpact=function(t,r,i){var o=this;this.explorationActivity.doActivity((function(){var e=t.dataSourceVariables,l=[];if(t.objects&&o.eventBridge.publishToChannel(a.explorationObjectsChanged),2===t.filterScope&&(o.eventBridge.publishToChannel(s,{container:r}),e=!0),t.activeSection)o.navigation.updateActiveSection({targetSectionIndex:r.activeSectionIndex,forceUpdate:!0});else if(1===t.filterScope){var u=o.navigation.getCurrentSection();o.eventBridge.publishToChannel(n.services.events.sectionFiltersContainerChanged,{container:u}),l=_.union(l,u.visualContainers)}else 0!==t.filterScope&&_.isEmpty(t.visualContainers)||(l=_.union(l,t.visualContainers));var c=[];if(e){o.eventBridge.publishToChannel(a.visualContainerChanged,{affectContainer:_.noopTrue});var u=o.navigation.getCurrentSection();c.push.apply(c,u.visualContainers)}else _.isEmpty(l)||(o.eventBridge.publishToChannel(a.visualContainerChanged,{affectContainer:function(e){return _.includes(l,e)}}),c.push.apply(c,l));var p=t.visualContainerGroups;if(_.isEmpty(p)||(o.eventBridge.publishToChannel(a.visualContainerGroupChanged,{affectContainer:function(e){return _.includes(p,e)}}),c.push.apply(c,p)),!i.suppressDisplay){if(t.visibility)o.visibility.set(t.visibility.visual,t.visibility.mode);else if(i.targetVisualNames){var d=r.sections[r.activeSectionIndex],f=_.filter(d.visualContainers,(function(e){return _.includes(i.targetVisualNames,e.name)}));o.visibility.clearForVisualContainers(f)}else o.visibility.clear();_.isEmpty(c)||o.eventBridge.publishToChannel(a.canvasItemHiddenChanged,{changedItems:c})}if(!i.suppressData){var v=t.pendingHighlights,m=o.navigation.getCurrentSection();if(v){o.filterGenerator.setMultipleFiltersOnSelectData(r,m,v);for(var h=0,g=v;h<g.length;h++){var y=g[h],C=y.sourceVisualContainer,x=C.config.singleVisual;x.setSelectedDataPoints?x.setSelectedDataPoints(y.selection):x.pendingSelection=y.selection}}else if(i.targetVisualNames){var d=r.sections[r.activeSectionIndex],f=_.filter(d.visualContainers,(function(e){return _.includes(i.targetVisualNames,e.name)}));o.filterGenerator.clearCrossHighlightForVisualContainers(d,f)}else o.filterGenerator.clearCrossHighlight(m)}}),(function(t){return o.telemetryService.startActivity(t,e.telemetry.EXExplorationStateApplyImpact)}))},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n,o){return new T(e,t,r,i,n,o)}function i(e,t,r){if(!_.isEmpty(e)){for(var i={},o=0,u=e;o<u.length;o++){var c=u[o];r(c)||(a(c)?(i.transientFilters||(i.transientFilters=[]),i.transientFilters.push(n(c))):s(c)?(i.exprIdentifiedMerges||(i.exprIdentifiedMerges=[]),i.exprIdentifiedMerges.push(n(c))):l(c)?(i.typeIdentifiedMerges||(i.typeIdentifiedMerges=[]),i.typeIdentifiedMerges.push(n(c))):(_.isEmpty(c.name)&&(c.name=b.getNextFilterName(e)),i.nameIdentifiedMerges||(i.nameIdentifiedMerges={}),i.nameIdentifiedMerges[c.name]=n(c)))}if(!_.isEmpty(i))return i}}function n(e){return{name:e.name,type:e.type,filter:e.filter,expression:e.expression,restatement:e.restatement,howCreated:e.howCreated,isTransient:e.isTransient,cachedValueItems:e.cachedValueItems,filterExpressionMetadata:_.cloneDeep(e.filterExpressionMetadata)}}function o(e){return{name:e.name,type:e.type,filter:e.filter,expression:e.expression,restatement:e.restatement,howCreated:e.howCreated,isTransient:e.isTransient,cachedValueItems:e.cachedValueItems,filterExpressionMetadata:_.cloneDeep(e.filterExpressionMetadata),displayName:e.displayName}}function a(e){return!!e.isTransient}function s(e){return!!e.expression}function l(e){return 3===e.howCreated||4===e.howCreated}function u(e,t){return!!e&&!!t}function c(e,t,r){if(t.filterState)return!0;var i=g.findFilterOutput(r),n=[i];return _.some(n,e)}function p(e){var t=[{objectName:"outspacePane",propertyName:"expanded"},{objectName:"outspacePane",propertyName:"visible"}];return _.some(t,e)}var d=e,f=d.data,v=d.explore,m=jsCommon.ArrayExtensions,h=e.data.DataViewObjectDefinitions,g=e.data.DataViewObjectDescriptors,y=d.DataViewObjectProperty,C=f.DataViewTransform,x=e.explore.contracts.ExplorationObjectDescriptors,S=v.contracts,b=v.FilterUtils,E=v.PodUtils,w=e.data.SemanticFilter,V=e.data.SQExpr,F=e.explore.contracts.VisualContainer,P=v.util.VisualContainerUtils;t.createExplorationStateService=r,t.convertToFilterContainerState=n;var T=(function(){function t(e,t,r,i,n,o){this.expandCollapse=e,this.filterGenerator=t,this.plugins=r,this.visualPluginOps=i,this.aggrOps=n,this.featureSwitchService=o,this.nonDrillthroughIsLinkedAsAggregationCallback=function(e){return!1}}return t.prototype.capture=function(e,t,r){var n=e.sections[e.activeSectionIndex],o={activeSection:n.name,filters:i(e.filters,2,this.nonDrillthroughIsLinkedAsAggregationCallback),sections:{}};if(this.featureSwitchService.featureSwitches.dataSourceVariablesOverride&&!r.suppressDataSourceVariables&&(o.dataSourceVariables=e.dataSourceVariables),e.objects&&(o.objects=this.captureExplorationObjects(e.objects)),r.captureAllSections)for(var a=0,s=e.sections;a<s.length;a++){var l=s[a];o.sections[l.name]=this.captureSection(l,t,e,r.capturePresentation)}else o.sections[n.name]=this.captureSection(n,t,e,r.capturePresentation);return o},t.prototype.captureExplorationObjects=function(e){return this.captureObjects(x,e,p)},t.prototype.captureFilterState=function(e){var t=this.captureFilterStateObjects(e.visualType,e.objects);return{visualType:e.visualType,objects:t,cachedFilterDisplayItems:e.cachedFilterDisplayItems}},t.prototype.captureSection=function(e,t,r,n){var o=function(t){return E.isLinkedAsAggregation(r,e,t)},a=this.getCrossHighlights(e);return{filters:i(e.filters,1,o),visualContainers:this.captureVisualContainers(e.visualContainers,a,t,n),visualContainerGroups:this.captureVisualContainerGroups(e.visualContainerGroups)}},t.prototype.getCrossHighlights=function(e){return e&&e.crossFilterSource&&e.crossFilterSource.highlight},t.prototype.captureVisualContainerGroups=function(e){for(var t,r=0,i=e;r<i.length;r++){var n=i[r];if(S.isVisualContainerGroup(n)){var o={};if(null!=n.isHidden&&(o.isHidden=n.isHidden),!_.isEmpty(n.children)){var a=this.captureVisualContainerGroups(n.children);o.children=a}null==o.isHidden&&null==o.children||(t=t||{},t[n.name]=o)}}return t},t.prototype.captureVisualContainers=function(e,t,r,n){for(var o={},a=function(e){var a=e.config.singleVisual;if(!a)return"continue";var l=void 0;if(!_.isEmpty(t)){var u=_.find(t,(function(e){return e.sourceVisualContainer.config.singleVisual===a&&!_.isEmpty(e.selection)}));u&&(l={selection:u.selection,filterExpressionMetadata:u.filterExpressionMetadata?u.filterExpressionMetadata:void 0})}var c=_.union(e.filters,s.getAdditionalVisualFiltersToCapture(e,r)),p={filters:i(c,0,s.nonDrillthroughIsLinkedAsAggregationCallback),singleVisual:{visualType:a.visualType,objects:s.captureVisualObjects(a.visualType,a.objects),cachedFilterDisplayItems:a.cachedFilterDisplayItems,filterExpressionMetadata:a.filterExpressionMetadata},highlight:l},d=e.visibility;null!=d&&0!==d&&(p.visibility=d),F.isHidden(a)&&(p.singleVisual.hidden=!0);var v=a.query;n&&a.presentationChangesApplied&&(p.singleVisual.targetType=a.visualType,v&&v.projections&&v.defn&&(p.singleVisual.projections=s.captureProjections(v))),v&&v.defn&&(p.singleVisual.orderBy=v.defn.orderBy()),v&&v.projections&&(p.singleVisual.activeProjections=s.captureActiveProjections(v)),v&&v.expansionStates&&(p.singleVisual.expansionStates=f.ExpansionState.clone(v.expansionStates)),o[e.name]=p},s=this,l=0,u=e;l<u.length;l++){a(u[l])}return o},t.prototype.captureProjections=function(e){var t={},r=e.defn.select();if(!r)return t;for(var i in e.projections){var n=e.projections[i];n&&(t[i]=n.all().map((function(e){return r.withName(e.queryRef).expr})))}return t},t.prototype.captureActiveProjections=function(e){var t,r=e.defn.select();for(var i in e.projections){var n=e.projections[i],o=n.activeProjectionRefs;if(!_.isEmpty(o)){var a=_.map(o,(function(e){return r.withName(e).expr}));t||(t={}),t[i]=a}}return t},t.prototype.captureVisualObjects=function(e,t){return this.captureFilterStateObjects(e,t)},t.prototype.captureFilterStateObjects=function(e,t){var r=this.plugins.capabilities(e);return r&&r.objects?this.captureObjects(r.objects,t,c):{}},t.prototype.captureObjects=function(e,t,r){var i={},n=null;for(var o in e){var a=e[o];for(var s in a.properties){var l=a.properties[s],u={objectName:o,propertyName:s};if(l.captureState||r(u,l,e)){var c=h.getValue(t,u,n);c&&h.setValue(i,u,n,c)}}}var p={};return _.isEmpty(i)||(p.merge=i),p},t.prototype.apply=function(e,t,r,i){var n={visualContainers:[],visualContainerGroups:[]};i.suppressActiveSection||this.applyActiveSection(e.activeSection,t,n),i.suppressData||i.targetVisualNames||this.applyFilters(e.filters,t,2,n,i.clearUnmatchedData,[],void 0,r,this.nonDrillthroughIsLinkedAsAggregationCallback),e.objects&&this.applyExplorationObjects(e.objects,t,n,i);for(var o in e.sections){var a=m.findItemWithName(t.sections,o);if(a){var s=e.sections[o],l=!i.suppressActiveSection||this.isActiveSection(a.name,t);this.applySection(t,s,a,r,n,i,l)}}if(n.activeSection&&null!=n.filterScope){var u=t.sections[t.activeSectionIndex];P.clearSectionQueryCaches(u)}return i.suppressDataSourceVariables||this.applyDataSourceVariables(e.dataSourceVariables,t,n),n},t.prototype.applyExplorationObjects=function(e,t,r,i){var n={};e&&e.merge&&(n.merge=h.clone(e.merge));var o=t.objects||{};for(var a in n.merge)for(var s=0,l=n.merge[a];s<l.length;s++){var u=l[s],c=h.ensure(o,a,u.selector);for(var p in u.properties){var d=u.properties[p];this.shouldApplyExplorationProperty(a,i)&&!h.propertiesAreEqual(c.properties[p],d)&&(r.objects=!0,c.properties[p]=d)}}return r.objects&&!t.objects&&(t.objects=o),r},t.prototype.isDisplayOptions=function(e){return void 0!==e&&void 0!==e.outspacePane&&void 0!==e.visuals},t.prototype.shouldApplyExplorationProperty=function(e,t){return"outspacePane"===e&&this.isDisplayOptions(t.suppressDisplay)?!t.suppressDisplay.outspacePane:!t.suppressDisplay},t.prototype.applyFilterState=function(e,t){for(var r={visualContainers:[],visualContainerGroups:[]},i=0,n=e;i<n.length;i++){var o=n[i],a=o.visual,s=o.state,l=a.config.singleVisual,u=this.plugins.capabilities(l.visualType),c=o.impacted;c=this.applyObjects(s,l,s.objects,u.objects,t,r)||c,c&&!_.includes(r.visualContainers,a)&&r.visualContainers.push(a)}return r},t.prototype.isActiveSection=function(e,t){return e===t.sections[t.activeSectionIndex].name},t.prototype.applyActiveSection=function(e,t,r){if(!this.isActiveSection(e,t)){var i=m.indexWithName(t.sections,e);i>=0&&(t.activeSectionIndex=i,r.activeSection=!0)}},t.prototype.applyDataSourceVariables=function(e,t,r){e?(t.dataSourceVariables=e,r.dataSourceVariables=!0):t.dataSourceVariables=void 0},t.prototype.applyFilters=function(e,t,r,i,n,o,a,s,l){var u=!1,c=[],p={nameIdentifiedMerges:_.clone(e&&e.nameIdentifiedMerges||{}),exprIdentifiedMerges:(e&&e.exprIdentifiedMerges||[]).slice(),typeIdentifiedMerges:(e&&e.typeIdentifiedMerges||[]).slice(),transientFilters:(e&&e.transientFilters||[]).slice()};if(u=this.applyRemainingFilters(p,t,0===r,i,c,o,a,s,l)||u,n&&t.filters)for(var d=t.filters.length-1;d>=0;d--){var f=t.filters[d];f.type!==S.FilterType.Passthrough&&(_.includes(c,f)||(2===f.howCreated?(t.filters.splice(d,1),this.addImpactCrossDrillSourceUpdate(a,t,0===r,i)):(f.filter=void 0,f.cachedValueItems=void 0,f.filterExpressionMetadata=void 0),u=!0))}return u&&this.setMinimumFilterScope(i,r),u},t.prototype.applyRemainingFilters=function(e,t,r,i,n,o,a,s,l){var u=this.applyTransientFilters(e,t,n);u=this.applyMatchingFilterByName(e,t,n)||u,u=this.applyMatchingFilterByExpr(e,t,r,n,s,l)||u,u=this.applyMatchingFilterByType(e,t,n)||u;var c=this.applyDrillFilters(e,t,n,o);return u=c||u,c&&this.addImpactCrossDrillSourceUpdate(a,t,r,i),u},t.prototype.addImpactCrossDrillSourceUpdate=function(e,t,r,i){if(u(t,r)){var n=t,o=this.filterGenerator.updateCrossDrillFromVisualContainersOperation(e,[n]);i.visualContainers=_.union(i.visualContainers,o)}},t.prototype.applyMatchingFilterByName=function(e,t,r){if(_.isEmpty(e)||_.isEmpty(e.nameIdentifiedMerges)||_.isEmpty(t.filters))return!1;var i=!1,n=[],a=function(a){var s=e.nameIdentifiedMerges[a],l=_.findIndex(t.filters,(function(e){return e.howCreated===s.howCreated&&!_.includes(r,e)&&e.name===a}));l!==-1&&(w.isSameFilter(t.filters[l].filter,s.filter)||(t.filters[l]=o(s),i=!0),n.push(a),r.push(t.filters[l]))};for(var s in e.nameIdentifiedMerges)a(s);return n.forEach((function(t){delete e.nameIdentifiedMerges[t]})),i},t.prototype.applyMatchingFilterByExpr=function(e,t,r,i,n,a){if(_.isEmpty(e)||_.isEmpty(e.exprIdentifiedMerges))return!1;for(var s,l,u=!1,c=!1,p=e.exprIdentifiedMerges.slice(),d=function(){var d=l.howCreated;if(2===d)return p.splice(0,1),"continue";var v=_.remove(p,(function(e){return e===l||e.howCreated===d&&V.equals(e.expression,l.expression)})),m=[];if((t.filters||[]).forEach((function(e,t){e.howCreated!==d||_.includes(i,e)||a(e)||!V.equals(e.expression,l.expression)||m.push(t)})),_.isEmpty(m)&&r&&0===d)if(l.filter){if(!c){c=!0;var h=!f.featureSwitchService.featureSwitches.singleFilterPane;s=P.getAutoVisualFilterContainers(t,f.visualPluginOps,f.filterGenerator,n,f.aggrOps,h)}var g=_.find(s,(function(e){return V.equals(e.expression,l.expression)}));g&&((t.filters||(t.filters=[])).push(g),m.push(t.filters.length-1))}else _.remove(e.exprIdentifiedMerges,l),_.remove(v,l);if(m.length>0){for(var y=Math.min(v.length,m.length);v.length>y;){var C=_.findIndex(v,(function(e){return _.isEmpty(e.filter)}));if(C===-1)break;v.splice(C,1)}for(var x=0;x<y;x++){var S=m[x];w.isSameFilter(t.filters[S].filter,v[x].filter)||(t.filters[S].filter=v[x].filter,t.filters[S].type=v[x].type,t.filters[S].cachedValueItems=v[x].cachedValueItems,u=!0),i.push(t.filters[S])}for(var x=y;x<v.length;x++){var b=o(v[x]);(t.filters||(t.filters=[])).push(b),i.push(b),u=!0}for(var x=y;x<m.length;x++){var S=m[x];t.filters[S].filter=void 0,t.filters[S].cachedValueItems=void 0,u=!0}e.exprIdentifiedMerges=_.difference(e.exprIdentifiedMerges,v)}},f=this;l=_.head(p);)d();return u},t.prototype.applyDrillFilters=function(e,t,r,i){var n=!1;if(_.isEmpty(i)||_.isEmpty(e)||_.isEmpty(e.exprIdentifiedMerges))return n;for(var a=[],s=function(e){if(2!==e.howCreated)return"continue";if(!_.find(i,(function(t){return V.equals(e.expression,t)})))return"continue";var s=_.find(t.filters,(function(t){return 2===t.howCreated&&!_.includes(r,t)&&V.equals(t.expression,e.expression)}));if(s)w.isSameFilter(s.filter,e.filter)||(s.filter=e.filter,s.cachedValueItems=e.cachedValueItems,n=!0),r.push(s);else{var l=o(e);(t.filters||(t.filters=[])).push(l),r.push(l),n=!0}a.push(e)},l=0,u=e.exprIdentifiedMerges;l<u.length;l++){s(u[l])}return e.exprIdentifiedMerges=_.difference(e.exprIdentifiedMerges,a),n},t.prototype.applyMatchingFilterByType=function(e,t,r){var i=!1;if(_.isEmpty(e)||_.isEmpty(e.typeIdentifiedMerges))return i;for(var n=[],a=function(e){var a=_.find(t.filters,(function(t){return t.howCreated===e.howCreated&&!_.includes(r,t)}));if(a)a.filter=e.filter,a.cachedValueItems=e.cachedValueItems,a.filterExpressionMetadata=_.cloneDeep(e.filterExpressionMetadata),r.push(a);else{var s=o(e);(t.filters||(t.filters=[])).push(s),r.push(s)}n.push(e),i=!0},s=0,l=e.typeIdentifiedMerges;s<l.length;s++){a(l[s])}return e.typeIdentifiedMerges=_.difference(e.typeIdentifiedMerges,n),i},t.prototype.applyTransientFilters=function(e,t,r){var i=!1;if(!_.isEmpty(e)&&!_.isEmpty(e.transientFilters)){for(var n=function(e){var n=_.find(t.filters,(function(t){return t.isTransient&&!_.includes(r,t)&&w.isSameFilter(t.filter,e.filter)}));if(n)n.filter=e.filter,n.cachedValueItems=e.cachedValueItems,n.filterExpressionMetadata=e.filterExpressionMetadata,r.push(n);else{var a=o(e);(t.filters||(t.filters=[])).push(a),r.push(a)}i=!0},a=0,s=e.transientFilters;a<s.length;a++){n(s[a])}e.transientFilters=[]}var l=_.remove(t.filters,(function(e){return e.isTransient&&!_.includes(r,e)}));return i=i||!_.isEmpty(l)},t.prototype.applySection=function(e,t,r,i,n,o,a){var s;if(!o.suppressData&&!o.targetVisualNames){var l=function(t){return E.isLinkedAsAggregation(e,r,t)};this.applyFilters(t.filters,r,1,n,o.clearUnmatchedData,[],r,i,l)}for(var u=0,c=r.visualContainers;u<c.length;u++){var p=c[u],d=p.name;if(!o.targetVisualNames||_.includes(o.targetVisualNames,d)){var f=t.visualContainers&&t.visualContainers[d],v=void 0;if(null!=f)v=this.applyVisualState(e,f,r,p,i,n,o,a),f.highlight&&!o.suppressData&&a&&this.isSelectionValid(f.highlight.selection,p.config.singleVisual,i)&&(null==n.pendingHighlights&&(n.pendingHighlights=[]),n.pendingHighlights.push({selection:f.highlight.selection,sourceVisualContainer:p,filterExpressionMetadata:f.highlight.filterExpressionMetadata}));else if(o.clearUnmatchedData){var m={};v=this.applyVisualState(e,m,r,p,i,n,o,a)}if(!_.isEmpty(v)){var h=_.without.apply(_,[v].concat(n.visualContainers));(s=n.visualContainers).push.apply(s,h)}}}for(var g=this.getCrossHighlights(r),y=0,C=r.visualContainerGroups;y<C.length;y++){var x=C[y];if(S.isVisualContainerGroup(x)){var b=t.visualContainerGroups&&t.visualContainerGroups[x.name];null!=b&&this.applyVisualGroupState(b,r,x,n,o,g)}}},t.prototype.applyVisualState=function(e,t,r,i,n,o,a,s){var l=!1,u=t.singleVisual;if(!a.suppressData){var c=this.plugins.capabilities(i.config.singleVisual.visualType),p=u&&u.objects,d=!1;c&&c.objects&&(d=this.applyObjects(u,i.config.singleVisual,p,c.objects,n,o));var f=this.presentationChangesAllowed(this.featureSwitchService.featureSwitches,e,a,i,u,this.visualPluginOps)&&this.applyPresentationChanges(i.config.singleVisual,u),v=u&&u.orderBy,m=this.applySort(i.config.singleVisual,v,a.clearUnmatchedData),h=u&&u.activeProjections,g=this.applyActiveProjections(i.config.singleVisual,h,a.clearUnmatchedData),y=this.collectValidDrillExprs(i.config.singleVisual),C=this.applyFilters(t.filters,i,0,o,a.clearUnmatchedData,y,r,n,this.nonDrillthroughIsLinkedAsAggregationCallback),x=u&&u.expansionStates,S=this.applyExpansionStates(i,x,a.clearUnmatchedData);l=d||f||m||g||C||S}var b=[];if(!this.getSuppressDisplayOptions(a).visuals){var E=t.visibility;null!=E&&s&&(o.visibility={visual:i,mode:E});var w=u&&u.hidden;b.push.apply(b,this.applyHidden(!!w,i,r))}return l&&!_.includes(b,i)&&b.push(i),b},t.prototype.applyPresentationChanges=function(e,t){if(!t)return!1;var r=!1,i=t.targetType,n=t.projections;i&&(r=i!==e.visualType,e.visualType=i);var o=e.query;if(!n||!o)return e.presentationChangesApplied=r,r;for(var a in o.projections)for(var s=0,l=o.tryGetExprs(a);s<l.length;s++){var u=l[s];o.removeExpr(u,!0)}for(var a in n)for(var c=0,p=n[a];c<p.length;c++){var d=p[c];o.add(d,a)}return e.presentationChangesApplied=!0,!0},t.prototype.applyVisualGroupState=function(e,t,r,i,n,o){var a=r.name;if(!n.targetVisualNames||_.includes(n.targetVisualNames,a)){var s=void 0;if(!this.getSuppressDisplayOptions(n).visuals){var l=e.isHidden,u=r.isHidden;if(null!=l&&l!==u&&(r.isHidden=l,s=!0),l&&!_.isEmpty(o)){var c=this.clearCrossHighlightsForGroup(r,t,o);i.visualContainers=_.chain(i.visualContainers).concat(c).uniq().value()}}s&&i.visualContainerGroups.push(r)}if(!_.isEmpty(e.children)){var p=function(a){var s=e.children[a],l=_.find(r.children,(function(e){return e.name===a}));return s&&l&&S.isVisualContainerGroup(l)?void d.applyVisualGroupState(s,t,l,i,n,o):"continue"},d=this;for(var f in e.children)p(f)}},t.prototype.getSuppressDisplayOptions=function(e){var t=e.suppressDisplay;return this.isDisplayOptions(t)?t:{outspacePane:t,visuals:t}},t.prototype.applyFilterExpressionCache=function(e,t,r){r?this.clearFilterExpressionCache(t):(t.filterExpressionMetadata=e.filterExpressionMetadata,t.cachedFilterDisplayItems=e.cachedFilterDisplayItems)},t.prototype.clearFilterExpressionCache=function(e){e.filterExpressionMetadata=void 0,e.cachedFilterDisplayItems=void 0},t.prototype.applyHidden=function(e,t,r){var i=t.config.singleVisual;if(e!==F.isHidden(i)){F.setHidden(i,e);var n=[t];return e&&(n=_.chain(n).concat(this.clearCrossHighlightsForVisual(t,r)).uniq().value()),n}},t.prototype.clearCrossHighlightsForGroup=function(e,t,r){var i=[];S.traverseVisualContainerGroups([e],(function(e){S.isVisualContainer(e)&&_.some(r,(function(t){return t.sourceVisualContainer===e}))&&i.push(e)}));var n;if(!_.isEmpty(i)){n=this.clearCrossHighlightsForVisuals(i,t)}return n||[]},t.prototype.clearCrossHighlightsForVisual=function(e,t){return this.clearCrossHighlightsForVisuals([e],t)},t.prototype.clearCrossHighlightsForVisuals=function(e,t){var r=e.slice();return r.push.apply(r,this.filterGenerator.clearCrossHighlightForVisualContainersOperation(t,e)),_.uniq(r)},t.prototype.collectValidDrillExprs=function(e){var t=e.query;if(!t)return[];var r=t.defn.select();if(_.isEmpty(r))return[];var i=[];for(var n in t.projections)for(var o=t.projections[n],a=o.activeProjectionRefs||[],s=0;s<a.length-1;s++){var l=a[s],u=r.withName(l);i.push(u.expr)}return i},t.prototype.applyActiveProjections=function(e,t,r){var i=e.query;if(!i)return!1;var n=i.defn.select(),o=this.plugins.capabilities(e.visualType),a=o&&o.drilldown&&o.drilldown.roles||[],s=!1,l={},u=function(e){if(!_.includes(a,e))return"continue";var r=t[e];l[e]||(l[e]=[]);var o=i.projections[e];if(!o)return s=!0,"continue";var u=o.all();if(_.isEmpty(u))return s=!0,"continue";if(r.length>u.length)return s=!0,"continue";if(1===r.length){var c=r[0],p=_.find(u,(function(e){var t=n.withName(e.queryRef);return V.equals(t.expr,c)}));if(!p)return s=!0,"continue";l[e].push(p.queryRef)}else for(var d=0;d<r.length;d++){var f=r[d],v=u[d],m=n.withName(v.queryRef);V.equals(m.expr,f)?l[e].push(v.queryRef):s=!0}};for(var c in t)u(c);if(s)for(var c in i.projections)l[c]=[];var p=!1;for(var c in i.projections)if(_.includes(a,c)){var d=i.projections[c],f=l[c];if(_.isEmpty(f)){if(!r)continue;var v=d.all();_.isEmpty(v)||(f=[_.head(v).queryRef])}m.sequenceEqual(d.activeProjectionRefs,f,(function(e,t){return e===t}))||(d.activeProjectionRefs=f,p=!0)}return p},t.prototype.applySort=function(e,t,r){var i=e.query;if(!i)return!1;var n=i.defn.orderBy()||[];return!(!t&&!r)&&(t=t||[],!m.sequenceEqual(n,t,f.SQUtils.sqSortDefinitionEquals)&&(i.orderBy(t),!0))},t.prototype.applyObjects=function(e,t,r,i,n,o){var a={};r&&(r.merge&&(a.merge=h.clone(r.merge)),r.remove&&(a.remove=r.remove.slice()));var s,l=t.objects||{},u=g.findFilterOutput(i),c=this.plugins.getPlugin(t.visualType);this.applyPluginUpdateSemantics(c,a,l,i),a.remove||(a.remove=this.getVisualPropertiesToRemove(t.visualType,l,a.merge));var p=this.mergeObjects(e,t,a.merge,l,o,n,u);return s=s||p.visualImpacted,a.remove=a.remove.concat(p.removeList),s=this.removeObjects(t,l,a.remove,o,u)||s},t.prototype.updateQueryProjectionsFromExpansionState=function(e,t){if(_.isEmpty(t))return!1;for(var r=function(t){var r=t.getVisibleDescendentsDepth(t.root,-1),i=Math.max(_.findLastIndex(t.levels,(function(e){return e.isPinned;
}))+1,r),n=function(r){var i=t.roles[r];return e.projections[i]&&e.projections[i].all()},o=function(r){var i,o=0,a=n(0),s=0,l=function(){if(s===_.size(a)){if(s=0,o++,o>=_.size(t.roles))return"break";if(a=n(o),!a)return"break"}var l=t.levels[i],u=_.findIndex(a,(function(e){return e.queryRef===_.first(l.queryRefs)}),r?s:0);return u===-1?"break":void(r&&s!==u&&e.moveProjection(t.roles[o],u,s,1))};for(i=0;i<_.size(t.levels);i++,s++){if("break"===l())break}return i};if(!(o(!1)>=i))return{value:!1};_.remove(e.expansionStates,(function(e){return _.isEqual(e.roles,t.roles)})),o(!0);var a=t.clone();e.setActiveProjections(a.roles,r);var s=e.getRolesUniqueProjectionRefs(a.roles),l=_.findIndex(a.levels,(function(e){return e.isCollapsed}));a.updateLevels(s,l===-1?r:l),e.expansionStates||(e.expansionStates=[]),e.expansionStates.push(a)},i=0,n=t;i<n.length;i++){var o=n[i],a=r(o);if("object"==typeof a)return a.value}return!0},t.prototype.applyExpansionStates=function(e,t,r){var i=this,n=e.config.singleVisual,o=n.query;if(!o)return!1;var a=o.expansionStates||[];if(!t&&!r)return!1;if(t=t||[],f.ExpansionState.areEqual(a,t))return!1;var s=this.plugins.capabilities(n.visualType);return s&&s.expandCollapse&&s.expandCollapse.restoreProjectionsOrderFromBookmark?this.updateQueryProjectionsFromExpansionState(o,t):(o.expansionStates=f.ExpansionState.clone(_.filter(t,(function(t){var r=o.projections[t.roles[0]],n=r&&r.all()||[];return!(!i.expandCollapse.isEnabled(e,t.roles)||1!==t.roles.length||n.length<t.levels.length)&&_.every(t.levels,(function(e,t){return n[t].queryRef===e.queryRefs[0]}))}))),!0)},t.prototype.applyPluginUpdateSemantics=function(t,r,i,n){if(r&&t&&t.mergeObjects){var o=e.visuals.visualStyles.create(),a=C.evaluateMetadataOnceDataViewObjectDefinitions(i,n,o,this.featureSwitchService.featureSwitches),s=a.dataViewObjects,l=C.evaluateMetadataOnceDataViewObjectDefinitions(r.merge||{},n,o,this.featureSwitchService.featureSwitches),u=l.dataViewObjects,c=t.mergeObjects({objects:s,changes:u});if(c){if(c.merge){r.merge={};for(var p=0,d=c.merge;p<d.length;p++){var f=d[p];for(var v in f.properties){var m=t.capabilities.objects[f.objectName].properties[v].type,g=h.encodePropertyValue(f.properties[v],m);h.setValue(r.merge,{objectName:f.objectName,propertyName:v},f.selector,g)}}}if(c.remove){r.remove=[];for(var y=0,x=c.remove;y<x.length;y++){var f=x[y];for(var v in f.properties)r.remove.push({object:f.objectName,property:v,selector:f.selector})}}}}},t.prototype.mergeObjects=function(e,t,r,i,n,o,a){var s={visualImpacted:!1,removeList:[]};if(_.isEmpty(r))return s;for(var l in r)for(var u=0,c=r[l];u<c.length;u++){var p=c[u],d=h.ensure(i,l,p.selector);for(var f in p.properties){var v=p.properties[f];if(!h.propertiesAreEqual(d.properties[f],v)){if(a&&y.propertyIdentifiersEqual(a,{objectName:l,propertyName:f})){var m=!!this.isFilterValid(v,t,o);if(this.applyFilterExpressionCache(e,t,!m),!m){s.removeList.push({object:a.objectName,property:a.propertyName,selector:null});continue}this.setMinimumFilterScope(n,1)}d.properties[f]=v,s.visualImpacted=!0,t.objects||(t.objects=i)}}}return s},t.prototype.removeObjects=function(e,t,r,i,n){if(_.isEmpty(r))return!1;for(var o=!1,a=0,s=r;a<s.length;a++){var l=s[a],u=l.selector,c=l.object,p=l.property;h.deleteProperty(t,c,u,p)&&(o=!0,n&&y.propertyIdentifiersEqual(n,{objectName:c,propertyName:p})&&(this.clearFilterExpressionCache(e),this.setMinimumFilterScope(i,1)))}return o},t.prototype.getVisualPropertiesToRemove=function(e,t,r){var i=this.plugins.capabilities(e),n=null;if(!i||!i.objects)return[];var o=g.findFilterOutput(i.objects),a=[];for(var s in i.objects){var l=i.objects[s];for(var u in l.properties){var c=l.properties[u];if(c.filterState||c.captureState||o&&y.propertyIdentifiersEqual(o,{objectName:s,propertyName:u})){var p={objectName:s,propertyName:u},d=h.getValue(r,p,n);h.getValue(t,p,n)&&!d&&a.push({object:s,property:u,selector:n})}}}return a},t.prototype.isFilterValid=function(e,t,r){var i=t.query;if(!i)return!1;var n=new N(i.defn,r);return e.rewrite(n),n.valid},t.prototype.isSelectionValid=function(e,t,r){var i=f.Selector.filterFromSelectorsByColumn(e);return i=new w(new f.SemanticQueryRewriter(f.SQExprRemoveEntityVariablesRewriter.instance).rewriteFrom(i.from()),_.map(i.where(),(function(e){return{condition:e.condition.accept(f.SQExprRemoveEntityVariablesRewriter.instance)}}))),this.isFilterValid(i,t,r)},t.prototype.setMinimumFilterScope=function(e,t){return e.filterScope?void(e.filterScope=Math.max(t,e.filterScope)):void(e.filterScope=t)},t.prototype.getAdditionalVisualFiltersToCapture=function(e,t){for(var r=[],i=!this.featureSwitchService.featureSwitches.singleFilterPane,n=P.getAutoVisualFilterContainers(e,this.visualPluginOps,this.filterGenerator,t,this.aggrOps,i)||[],o=function(t){_.find(e.filters,(function(e){return V.equals(e.expression,t.expression)}))||r.push(t)},a=0,s=n;a<s.length;a++){o(s[a])}return r},t.prototype.presentationChangesAllowed=function(e,t,r,i,n,o){if(!e||!e.inlineExplore)return!1;if(!t.settings||!t.settings.allowInlineExploration)return!1;if(!r.applyPresentationChanges)return!1;var a=i&&i.config&&i.config.singleVisual;if(!a)return!1;var s=[function(e){return o.isQnaVisual(e)},function(e){return o.isQueryVisual(e)}],l=n&&n.visualType;if(!s.some((function(e){return e(l)})))return!1;var u=a&&a.vcObjects,c=h.getValue(u,{objectName:"visualHeader",propertyName:"showPersonalizeVisualButton"},null);return!c||c.value!==!1},t})(),N=(function(e){function t(t,r){var i=this;return i=e.call(this)||this,i.valid=!0,i.query=t,i.schema=r,i}return __extends(t,e),t.prototype.visitColumnRef=function(e){return this.valid=this.valid&&this.exprInSelects(e),e},t.prototype.exprInSelects=function(e){var t=_.some(this.query.select(),(function(t){return V.equals(t.expr,e,!0,!0)}));if(t)return!0;if(!this.schema)return t;for(var r=this.query.select(),i=0,n=r;i<n.length;i++){var o=n[i],a=o.expr.getKeyColumns(this.schema);if(_.some(a,(function(t){return V.equals(e,t,!0,!0)})))return!0}return!1},t})(f.SQExprRewriter)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=e.data.isFilterComparisonPattern,o=e.data.SQExprBuilder,a=jsCommon.StringExtensions,s=e.visuals.valueFormatter;!(function(e){e[e.Default=0]="Default",e[e.Any=1]="Any",e[e.General=2]="General"})(i||(i={}));var l=(function(){function l(e,t,r,n,o,a,s,l){this.schema=e,this.locOptions=t,this.visualCapabilities=r,this.displayNameService=n,this.visualTimeSynchronizationService=o,this.filterData=a,this.options=s,this.visualConfig=l,this.filterType=i.General,this.columns=[]}return l.prototype.visitIn=function(i){var n=this,s=i.args;if(!this.isSingleColumnInPattern(i)||this.filterData.type===t.contracts.FilterType.Include||this.filterData.type===t.contracts.FilterType.Exclude){var l=this.formatMultiColumnBasic(i),u=this.getDisplayNameForMultiColumn(i.not,l.length);return[{fieldName:u,restatements:l,fieldNameToolTip:u}]}var c,p,d;if(this.filterData&&this.filterData.filterExpressionMetadata&&!_.isEmpty(this.filterData.filterExpressionMetadata.cachedValueItems)){var f=this.filterData.filterExpressionMetadata.expressions[0],v=this.visualConfig&&this.visualConfig.query&&this.visualConfig.query.defn.selectNameOf(f);p=this.filterData.displayName||this.displayNameService.getDisplayName(f,this.schema,this.visualCapabilities,v,this.visualConfig&&this.visualConfig.columnProperties),d=this.displayNameService.getQualifiedDisplayName(f,this.schema,this.visualCapabilities),c=[];for(var m=0,h=this.filterData.filterExpressionMetadata.cachedValueItems;m<h.length;m++){var g=h[m];c.push(g.valueMap[0])}}else p=this.getFieldName(s[0]),d=this.getQualifiedFieldName(s[0]),c=_.map(i.values,(function(t){return _.map(t,(function(t,r){var i=o.fieldExpr(s[r]),a=i&&i.getMetadata(n.schema);return e.visuals.valueFormatter.format(t.value,a&&a.format)})).join(" ")}));var y;return y=c&&c.length>2?r.concatStrings(c,"FilterRestatement_CompoundOrForMoreThanTwo",this.locOptions):r.concatStrings(c,"Generic_Or",this.locOptions),y=i.not?a.format(e.common.localize.get("FilterRestatement_NotEqual"),y):a.format(e.common.localize.get("FilterRestatement_Equal"),y),[{fieldName:p,restatements:[y],fieldNameToolTip:d}]},l.prototype.visitComposite=function(e){for(var t=[],r=0,i=e.filters;r<i.length;r++){var n=i[r];n.in?t.push.apply(t,this.formatMultiColumnBasic(n.in)):n.compareOperator?t.push.apply(t,this.visitCompare(n.compareOperator)[0].restatements):n.advancedOperator?t.push.apply(t,this.visitAdvanced(n.advancedOperator)[0].restatements):t.push.apply(t,this.visitComposite(n.composite)[0].restatements)}var o=this.getDisplayNameForMultiColumn(e.not,t.length);return[{fieldName:o,restatements:t,fieldNameToolTip:o}]},l.prototype.visitHierarchical=function(e){var t=[];return _.isEmpty(e.included)||t.push(this.getIncludeExcludeFilter(e.included,!1)),_.isEmpty(e.excluded)||t.push(this.getIncludeExcludeFilter(e.excluded,!0)),t},l.prototype.getIncludeExcludeFilter=function(e,t){var r=this,i=_.flatten(_.map(e,(function(e){return r.formatMultiColumnBasic(e)}))),n=this.getDisplayNameForMultiColumn(t,i.length);return{fieldName:n,restatements:i,fieldNameToolTip:n}},l.prototype.getDefaultValueRestatement=function(){for(var e=this.filterData.filterExpressionMetadata&&this.filterData.filterExpressionMetadata.expressions||_.map(this.columns,(function(e){return o.fieldExpr(e)})),t=[],i=[],n=[],a=0,s=e;a<s.length;a++){var l=s[a],u=r.filterRestatementUtil.getDefaultValueRestatement(l,this.schema);u&&(i.push(u),t.push(this.getFieldName(l)),n.push(l))}if(!_.isEmpty(t)){var c=t[0],p=i[0],d=this.getQualifiedFieldName(n[0]);return t.length>1&&(c=this.getDisplayNameForMultiColumn(!1,1),p=this.getColumnValueRestatement(t,i),d=c),{fieldName:c,restatements:[p],fieldNameToolTip:d}}},l.prototype.formatMultiColumnBasic=function(r){var i,n=this,a=[],s=r.args,l=_.map(s,(function(e){return o.fieldExpr(e)})),u=_.map(l,(function(e){return l&&e.getMetadata(n.schema)}));i=_.map(s,(function(e){return n.getFieldName(e)}));for(var c=0,p=r.values;c<p.length;c++){var d=p[c],f=_.map(d,(function(t,r){var i=u[r];return e.visuals.valueFormatter.format(t.value,i&&i.format)})),v=i;if(this.filterData&&this.filterData.filterExpressionMetadata){var m=t.FilterUtils.findValuesInFilterCache(l,d,this.filterData.filterExpressionMetadata);m&&(v=_.map(m.columns,(function(e){return n.getFieldName(e)})),f=m.values)}var h=this.getColumnValueRestatement(v,f);a.push(h)}return a},l.prototype.getColumnValueRestatement=function(t,r){if(!_.isEmpty(t)&&!_.isEmpty(r)&&t.length===r.length){var i=e.common.localize.get("MultiColumn_Join_Separator"),n=e.common.localize.get("NamePattern_Bracket");return _.map(r,(function(e,r){return a.format(n,e,t[r])})).join(i)}},l.prototype.getDisplayNameForMultiColumn=function(e,t){var r;return r=e?this.locOptions.stringResourceProvider.get("FilterPane_Exclude"):this.locOptions.stringResourceProvider.get("Include_Label"),a.format(this.locOptions.stringResourceProvider.get("NamePattern_Bracket"),r,String(t))},l.prototype.visitBetween=function(e){return[{fieldName:this.getFieldName(e.arg),restatements:[r.filterRestatementUtil.visitBetweenHelper(e)],fieldNameToolTip:this.getQualifiedFieldName(e.arg)}]},l.prototype.visitRelativeDateRange=function(e){var t=this,i=function(e,r){return t.locOptions.stringResourceProvider.format(e,r)};return[{fieldName:this.getFieldName(e.arg),restatements:[r.filterRestatementUtil.visitRelativeDateRangeHelper(e,i,this.visualTimeSynchronizationService.getAnchorTime())],fieldNameToolTip:this.getQualifiedFieldName(e.arg)}]},l.prototype.visitTopN=function(e){if(null!=e.itemCount){var t,r=s.format(e.itemCount,"#,###"),i=e.orderByField,n=e.isTop;if(i){var o=e.orderByField,l=this.getFieldName(o,!0),u=this.locOptions.stringResourceProvider.get(n?"FilterRestatement_TopNBy":"FilterRestatement_BottomNBy");t=a.format(u,r,l)}else{var u=this.locOptions.stringResourceProvider.get(n?"FilterRestatement_TopN":"FilterRestatement_BottomN");t=a.format(u,r)}return[{fieldName:this.getFieldName(e.fieldBeingFiltered),restatements:[t],fieldNameToolTip:this.getQualifiedFieldName(e.fieldBeingFiltered)}]}},l.prototype.visitCompare=function(e){if(e.condition.anyValue)return void(this.filterType=i.Any);if(e.condition.defaultValue)return this.filterType=i.Default,this.columns.push(e.arg),[this.getDefaultValueRestatement()];var n;if(e.condition&&e.condition.constant&&this.filterData.filterExpressionMetadata){var a=o.fieldExpr(e.arg),s=t.FilterUtils.findValuesInFilterCache([a],[e.condition.constant],this.filterData.filterExpressionMetadata);s&&!_.isEmpty(s.values)&&(n=s.values[0])}var l=r.filterRestatementUtil.visitComparisonFilterPatternHelper(e,this.schema,n);return[{fieldName:this.getFieldName(e.arg),restatements:l?[l]:void 0,fieldNameToolTip:this.getQualifiedFieldName(e.arg)}]},l.prototype.visitAdvanced=function(e){return this.parseAdvanceFilterProperties(e),this.filterType===i.Default?[this.getDefaultValueRestatement()]:this.filterType===i.Any||_.isEmpty(this.columns)?void 0:[{fieldName:this.getFieldName(this.columns[0]),restatements:[r.filterRestatementUtil.getAdvancedFilterPatternRestatement(e,this.schema)],fieldNameToolTip:this.getQualifiedFieldName(this.columns[0])}]},l.prototype.parseAdvanceFilterProperties=function(e){n(e)?(this.columns.push(e.arg),e.condition.defaultValue&&(this.filterType=i.Default),e.condition.anyValue&&(this.filterType=i.Any)):(this.parseAdvanceFilterProperties(e.left),this.parseAdvanceFilterProperties(e.right))},l.prototype.visitComplex=function(e){var t=this,i=r.concatStrings(_.map(e.args,(function(e){return t.getFieldName(e)})),"AndConjunction",this.locOptions);return[{fieldName:i,restatements:[this.locOptions.stringResourceProvider.get("FilterRestatement_Complex")],fieldNameToolTip:i}]},l.prototype.getFieldName=function(e,t){void 0===t&&(t=!1);var r=o.fieldExpr(e),i=this.visualConfig&&this.visualConfig.query&&this.visualConfig.query.defn.selectNameOf(r);return t?this.displayNameService.getDisplayName(r,this.schema,this.visualCapabilities,i,this.visualConfig&&this.visualConfig.columnProperties):this.filterData.displayName||this.displayNameService.getDisplayName(r,this.schema,this.visualCapabilities,i,this.visualConfig&&this.visualConfig.columnProperties)},l.prototype.getQualifiedFieldName=function(e){var t=o.fieldExpr(e);return this.displayNameService.getQualifiedDisplayName(t,this.schema,this.visualCapabilities)},l.prototype.isSingleColumnInPattern=function(e){return 1===e.args.length||!(!this.filterData||!this.filterData.filterExpressionMetadata||_.isEmpty(this.filterData.filterExpressionMetadata.cachedValueItems)||_.isEmpty(this.filterData.filterExpressionMetadata.expressions))&&1===this.filterData.filterExpressionMetadata.expressions.length},l})();r.FilterOverlayRestatementVisitor=l})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(r){function i(e){var t=e.lower.value,r=e.upper.value,i={min:t,max:r};return d.getDateRangeRestatement(i)}function n(e,t,r){return d.getRestatement(e.options,!0,t,r)}function o(r,i,n){var o=f.fieldExpr(r.arg);if(r.condition.defaultValue)return a(o,i);if(!r.condition.anyValue){var s=t.FilterUtils.getFormatter(o,i),l=n||c(r.condition);return e.data.RestatementHelper.fromCondition([new e.data.Condition(r.filterOperator,l,s)],2)}}function a(r,i){var n=e.data.SQExprUtils.getDefaultValue(r,i);if(n){var o=t.FilterUtils.getFormatter(r,i);return e.data.RestatementHelper.fromDefault(o.format(n.value))}}function s(t,r){var i=u(t,r);return e.data.RestatementHelper.fromCondition(i,t.logicalOperator)}function l(e,t,r,i,n){t.get(e).then((function(){var e=i.contract,t=m.extractParametersFromSemanticFilter(e.filter,v.Time),o=t&&t.options;if(o){var a=function(e,t){return r.format(e,t)},s=d.getRestatement(o,i.isFilterExpanded(),a,n);i.setRestatement(s)}}))}function u(r,i){if(p(r)){var n=f.fieldExpr(r.arg),o=t.FilterUtils.getFormatter(n,i);return[new e.data.Condition(r.filterOperator,c(r.condition),o)]}return u(r.left,i).concat(u(r.right,i))}function c(e){return e.constant?e.constant.value:e.dateSpan?e.dateSpan.value:void 0}var p=e.data.isFilterComparisonPattern,d=e.data.RelativeDateRangeHelper,f=e.data.SQExprBuilder,v=e.data.RelativeFilterType,m=e.data.RelativeDateFilterPattern;r.visitBetweenHelper=i,r.visitRelativeDateRangeHelper=n,r.visitComparisonFilterPatternHelper=o,r.getDefaultValueRestatement=a,r.getAdvancedFilterPatternRestatement=s,r.updateRestatementOnToggle=l})(i=r.filterRestatementUtil||(r.filterRestatementUtil={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.FieldExprPattern,i=e.data.SQExprBuilder,n=jsCommon.StringExtensions,o=(function(){function o(e,r,i,n,o,a,s){this.schema=e,this.locOptions=r,this.aggrOps=i,this.visualCapabilities=n,this.visualTimeSynchronizationService=o,this.displayOptions=a,this.isQualified=s,this.displayNameServiceVisitor=this.isQualified?new t.QualifiedDisplayNameVisitor(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.visualTimeSynchronizationService,this.displayOptions):new t.DisplayNameServiceVisitor(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.visualTimeSynchronizationService,this.displayOptions)}return o.prototype.visitIn=function(o){var a=this,s=o.args,l=o.values,u=_.map(l,(function(t){return _.map(t,(function(t,r){var n=i.fieldExpr(s[r]),o=n&&n.getMetadata(a.schema);return e.visuals.valueFormatter.format(t.value,o&&o.format)})).join(" ")})),c=t.concatStrings(u,"Generic_Or",this.locOptions);if(this.displayOptions&&this.displayOptions.includeFieldNamesInFilter){var p=o.args,d=_.map(p,(function(e){return r.visit(e,a.displayNameServiceVisitor)})).join(" ");return n.format(this.locOptions.stringResourceProvider.get("VisualTitle_Is_Template"),d,c)}return c},o.prototype.visitBetween=function(e){return t.filterRestatementUtil.visitBetweenHelper(e)},o.prototype.visitRelativeDateRange=function(e){var r=this,i=function(e,t){return r.locOptions.stringResourceProvider.format(e,t)};return t.filterRestatementUtil.visitRelativeDateRangeHelper(e,i,this.visualTimeSynchronizationService.getAnchorTime())},o.prototype.visitTopN=function(e){},o.prototype.visitCompare=function(e){return t.filterRestatementUtil.visitComparisonFilterPatternHelper(e,this.schema)},o.prototype.visitAdvanced=function(e){return t.filterRestatementUtil.getAdvancedFilterPatternRestatement(e,this.schema)},o.prototype.visitComplex=function(e){},o.prototype.visitComposite=function(e){},o.prototype.visitHierarchical=function(e){},o})();t.FilterRestatementVisitor=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new s(e,t,r,i)}function n(e){switch(e){case 1:return"Maximized";case 2:return"MaximizedWithData";case 8:return"MaximizedWithAccessibleData";case 4:return"Spotlight";default:return"Normal"}}function o(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.visualContainer===t.visualContainer&&e.visibility===t.visibility)}var a=t.util.VisualContainerUtils;r.createVisibilityService=i;var s=(function(){function i(e,t,i,n){var o=this;this.telemetryService=e,this.eventBridge=t,this.selectionService=i,this.explorationNavigation=n,this.selectionService=i,t.createChannelSubscriptionManager().subscribe(r.events.selectionChanged,(function(){return o.updatePopOutMode()}))}return i.prototype.get=function(e){var t=this.explorationNavigation.getCurrentSection(),r=t&&t.poppedOutElement;if(r)return e||(e=11),e&r.visibility?r.visualContainer:void 0},i.prototype.set=function(e,t,i){if(void 0===i&&(i=!0),0===t)return void this.clearInternal(!0,i);r.selectionUtils.selectCanvasItem(e,this.selectionService);var n={visualContainer:e,visibility:t},a=this.explorationNavigation.getCurrentSection();if(a){o(n,a&&a.poppedOutElement)||(this.clearInternal(!1,!1),this.setMode(n,t,i),a.poppedOutElement=n,this.raiseEvent())}},i.prototype.clear=function(){this.clearInternal()},i.prototype.clearForVisualContainers=function(e){var t=this.explorationNavigation.getCurrentSection(),r=t&&t.poppedOutElement;if(r)for(var i=0,n=e;i<n.length;i++){var o=n[i];if(r.visualContainer===o){this.clearInternal();break}}},i.prototype.clearInternal=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var r=this.explorationNavigation.getCurrentSection(),i=r&&r.poppedOutElement;i&&(this.setMode(i,0,t),r.poppedOutElement=void 0,e&&this.raiseEvent())},i.prototype.isSeeDataMode=function(e){return e&&(2===e||8===e)},i.prototype.updatePopOutMode=function(){var e=r.selectionUtils.getDefaultSelectedVisualInSingleOrMultiCase(this.selectionService);e&&t.contracts.isVisualContainer(e)&&null!=e.visibility&&0!==e.visibility?this.set(e,e.visibility,!1):this.clearInternal(!0,!1)},i.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(r.events.visibilityChanged)},i.prototype.setMode=function(t,r,i){var o=t.visualContainer;if(i){var s=n(r);this.telemetryService.logEvent(e.telemetry.EXToggleVisualDisplay,a.getVisualType(o),s,t.visualContainer.name)}o.visibility=r},i})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return new n(e)}var i=e.data.DataViewObjectDescriptors;t.createVisualCapabilitiesService=r;var n=(function(){function e(e){this.visualPlugins=e}return e.prototype.hasFilterCapabilities=function(e){var t=this.visualPlugins.getPlugin(e);return!!(t&&t.capabilities&&t.capabilities.objects&&i.findFilterOutput(t.capabilities.objects))},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createVisualLifecycleService=t;var r=(function(){function e(){this.visualIds={}}return e.prototype.add=function(e){this.visualIds[e]=1},e.prototype.delete=function(e){delete this.visualIds[e]},e.prototype.has=function(e,t){void 0===t&&(t=!0);var r=1===this.visualIds[e];return r&&t&&this.delete(e),r},e})();e.VisualLifecycleService=r})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new a(e,t)}var n=e.data.DataViewObjectDescriptors,o=t.util.VisualContainerUtils;r.createVisualPluginOps=i;var a=(function(){function t(e,t){this.plugins=e,this.featureSwitchService=t}return t.prototype.canEdit=function(t,r){var i=this.plugins.capabilities(t);switch(i&&i.advancedEditModeSupport){case 1:return!0;case 2:return r;default:return t===e.visualHost.EsriVisual}},t.prototype.dataViewKinds=function(t,r){if(t){var i=this.plugins.capabilities(t);if(i){var n=i.dataViewMappings,a=e.DataViewMapping.targetDataViewKinds(n);if(r){var s=o.createRoleKindByQueryRef(r),l=e.DataViewAnalysis.chooseDataViewMappings(r.projections,n,s,this.featureSwitchService.featureSwitches);a=e.DataViewMapping.targetDataViewKinds(l.supportedMappings),"map"===t&&1&a&&e.visuals.MapPluginMethods.mightRequireMatrixForUnpivot(r.projections,l.supportedMappings)&&(a|=2)}return a?a:void 0}}},t.prototype.targetedDataViewKinds=function(e,t){var r=31;return this.plugins.isCustomVisual(e)||(r=this.dataViewKinds(e,t)||31),r},t.prototype.supportsFocusMode=function(e){var t=this.plugins.capabilities(e);return t&&t.dataViewMappings&&!t.disableFocusMode},t.prototype.isSupportedVisual=function(e){var t=o.getVisualType(e);return!!t&&!!this.plugins.getPlugin(t)},t.prototype.canConvertVisual=function(e){if(!e)return!1;var t=o.getVisualType(e);if(!t)return!1;var r=this.plugins.capabilities(t);return(this.isQueryVisual(t)||!(!r||!r.isConvertible))&&!o.hasGroupByItemsInQuery(e)},t.prototype.canFormatVisual=function(e){return!!e&&!o.hasGroupByItemsInQuery(e)},t.prototype.isQueryVisual=function(e){var t=this.plugins.capabilities(e);return!t||!this.isQueryDisabled(e,t)&&null!=t.dataViewMappings},t.prototype.isQueryDisabled=function(t,r){if(r&&e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings))return!this.plugins.isScriptVisualQueryable(t)},t.prototype.supportVisualSearch=function(e){var t=this.plugins.capabilities(e);return!(!t||!this.isQueryVisual(e))&&!!n.findSelfFilter(t.objects)},t.prototype.isAnalysisVisual=function(t){return t===e.visuals.plugins.keyDriversVisual.name||t===e.visuals.plugins.distributionFactorsVisual.name||t===e.visuals.plugins.decompositionTreeVisual.name&&!this.featureSwitchService.featureSwitches.decompositionTreeCoreVisual},t.prototype.isQnaVisual=function(t){return t===e.visuals.plugins.qnaVisual.name},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return new n(e)}var i=e.explore.contracts.createDataSourceArray;t.createDataSourceSerializer=r;var n=(function(){function e(e){this.explorationSerializer=e}return e.prototype.deserializeDataSources=function(e){var t=this;if(e)return i(_.map(e,(function(e){return t.deserializeDataSource(e)})))},e.prototype.deserializeDataSource=function(e){if(e){var t={id:e.id,name:e.name};return e.type&&(t.type=e.type),e.packageId&&(t.packageId=e.packageId),e.extends&&(t.extends=e.extends),e.dsr&&(t.dsr=this.deserializeExecuteSemanticQueryDataSource(e.dsr)),e.exploration&&(t.exploration=this.deserializeExplorationDataReaderDataSource(e.exploration)),t}},e.prototype.deserializeExecuteSemanticQueryDataSource=function(e){if(e){var t={schemaName:e.schemaName};return e.vsName&&(t.vsName=e.vsName),e.dbName&&(t.dbName=e.dbName),e.modelId&&(t.modelId=e.modelId),t}},e.prototype.deserializeExplorationDataReaderDataSource=function(e){if(e){var t=this.explorationSerializer.deserializeModelExtensions(e.modelExtensions);return{extends:e.extends,schemaName:e.schemaName,getModelExtensions:function(){return t},getDataSourceVariables:function(){return e.dataSourceVariables}}}},e.prototype.serializeDataSources=function(e){var t=this;if(e)return _.map(e,(function(e){return t.serializeDataSource(e)}))},e.prototype.serializeDataSource=function(e){if(e){var t={id:e.id,name:e.name};return e.type&&(t.type=e.type),e.packageId&&(t.packageId=e.packageId),e.extends&&(t.extends=e.extends),e.dsr&&(t.dsr=this.serializeExecuteSemanticQueryDataSource(e.dsr)),e.exploration&&(t.exploration=this.serializeExplorationDataReaderDataSource(e.exploration)),t}},e.prototype.serializeExecuteSemanticQueryDataSource=function(e){if(e){var t={schemaName:e.schemaName};return e.vsName&&(t.vsName=e.vsName),e.dbName&&(t.dbName=e.dbName),e.modelId&&(t.modelId=e.modelId),t}},e.prototype.serializeExplorationDataReaderDataSource=function(e){if(e)return{extends:e.extends,schemaName:e.schemaName,modelExtensions:this.explorationSerializer.serializeModelExtensions(e.getModelExtensions())}},e})();t.DataSourceSerializer=n})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.services.DataViewObjectSerializer;!(function(e){function t(e){if(e&&!(e.length<1)){for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r];if(o.identity&&o.identity.expr){var a=i.serializeScopeIdentity(o.identity);a&&t.push({id:a,displayName:o.displayName})}}return t}}function r(e){if(e&&!(e.length<1)){for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r];if(o.id){var a=i.deserializeScopeIdentity(o.id);a&&t.push({identity:a,displayName:o.displayName})}}return t}}function n(e){if(e&&!(e.length<1)){for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r];if(!_.isEmpty(o.identities)){var a=_.map(o.identities,(function(e){return i.serializeScopeIdentity(e)}));a&&t.push({identities:a,valueMap:o.valueMap})}}return t}}function o(e){if(e&&!(e.length<1)){for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r];if(!_.isEmpty(o.identities)){var a=_.map(o.identities,(function(e){return i.deserializeScopeIdentity(e)}));a&&t.push({identities:a,valueMap:o.valueMap})}}return t}}e.serializeFilterLabelIdPairs=t,e.deserializeFilterLabelIdPairs=r,e.serializeIdentityValueMap=n,e.deserializeIdentityValueMap=o})(r=t.DisplayNameSerializer||(t.DisplayNameSerializer={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(i){function n(e,t){for(var r={},i=0,n=t.sections;i<n.length;i++)for(var o=n[i],a=0,s=o.visualContainers;a<s.length;a++){var l=s[a];r[l.name]=!0}for(var u in e.sections){var o=e.sections[u];for(var c in o.visualContainers)r[c]||delete o.visualContainers[c]}}function o(e,t){return d(S(e,null),t)}function a(e,t){var r={activeSection:e.activeSection,filters:s(e.filters),sections:_.mapValues(e.sections,(function(e){return u(e,t)}))};return e.objects&&(r.objects=v(e.objects)),e.dataSourceVariables&&(r.dataSourceVariables=e.dataSourceVariables),r}function s(e){if(e){var t={};return e.byName&&(t.nameIdentifiedMerges=_.mapValues(e.byName,l)),e.byExpr&&(t.exprIdentifiedMerges=_.map(e.byExpr,l)),e.byType&&(t.typeIdentifiedMerges=_.map(e.byType,l)),e.byTransientState&&(t.transientFilters=_.map(e.byTransientState,l)),t}}function l(e){return{name:e.name,type:V.FilterType[e.type],filter:e.filter?N.deserializeFilter(e.filter):void 0,expression:e.expression?N.deserializeExpr(e.expression):void 0,restatement:e.restatement,howCreated:e.howCreated,precedence:e.precedence,isTransient:e.isTransient,cachedValueItems:r.DisplayNameSerializer.deserializeFilterLabelIdPairs(e.cachedDisplayNames),filterExpressionMetadata:e.filterExpressionMetadata?t.FilterExpressionMetadataUtils.deserializeFilterExpressionMetadata(e.filterExpressionMetadata):void 0}}function u(e,t){return{filters:s(e.filters),visualContainers:_.mapValues(e.visualContainers,(function(e){return c(e,t)})),visualContainerGroups:e.visualContainerGroups&&_.mapValues(e.visualContainerGroups,p)}}function c(e,t){var r=d(e.singleVisual,t);return{filters:s(e.filters),singleVisual:r,visibility:e.singleVisual?g(e.singleVisual.display):void 0,highlight:e.highlight?h(e.highlight):void 0}}function p(e){return{isHidden:e.isHidden,children:e.children&&_.mapValues(e.children,(function(e){return p(e)}))}}function d(e,i){if(e){var n={visualType:e.visualType};if(e.objects&&(n.objects=v(e.objects)),e.orderBy&&(n.orderBy=N.deserializeSortDefinitions(e.orderBy,null)),e.targetType&&(n.targetType=e.targetType),e.activeProjections&&(n.activeProjections=f(e.activeProjections)),e.projections&&(n.projections=f(e.projections)),e.display&&"hidden"===e.display.mode&&(n.hidden=!0),e.cachedFilterDisplayItems&&(n.cachedFilterDisplayItems=r.DisplayNameSerializer.deserializeFilterLabelIdPairs(e.cachedFilterDisplayItems)),e.filterExpressionMetadata&&(n.filterExpressionMetadata=t.FilterExpressionMetadataUtils.deserializeFilterExpressionMetadata(e.filterExpressionMetadata)),e.expansionStates){var o=i.capabilities(e.visualType),a=o&&o.expandCollapse&&o.expandCollapse.supportsMerge,s=o&&o.noDefaultProjections;n.expansionStates=P.deserializeExpansionStates(e.expansionStates,a,s)}return n}}function f(e){var t;for(var r in e){var i=e[r];_.isEmpty(i)||(t||(t={}),t[r]=_.map(i,(function(e){return N.deserializeExpr(e)})))}return t}function v(e){var t={};return e.merge&&(t.merge=F.deserializeObjects(e.merge,null)),e.remove&&(t.remove=_.map(e.remove,m)),t}function m(e){return{object:e.object,property:e.property,selector:F.deserializeSelector(e.selector)}}function h(e){return{selection:_.map(e.selection,(function(e){return F.deserializeSelectorsByColumn(e)})),filterExpressionMetadata:e.filterExpressionMetadata?t.FilterExpressionMetadataUtils.deserializeFilterExpressionMetadata(e.filterExpressionMetadata):void 0}}function g(e){if(e&&e.mode)switch(e.mode){case"maximize":switch(e.maximizedOptions&&e.maximizedOptions.dataTable){case"accessible":return 8;case"normal":return 2;default:return 1}case"spotlight":
return 4}}function y(e){var t=new R,r={version:void 0,activeSection:e.activeSection,filters:t.serializeFilters(e.filters),sections:_.mapValues(e.sections,(function(e){return t.serializeSection(e)}))};return e.objects&&(r.objects=t.serializeObjects(e.objects),t.version=D.max(t.version,T.v1_3)),e.dataSourceVariables&&(r.dataSourceVariables=e.dataSourceVariables,t.version=D.max(t.version,T.v1_4)),r.version=t.version,r}function C(e){return(new R).serializeFilterContainer(e)}function x(e){return(new R).serializeHighlightState(e)}function S(e,t){return(new R).serializeSingleVisual(e,t)}function b(e){switch(e){case 1:return{mode:"maximize"};case 2:return{mode:"maximize",maximizedOptions:{dataTable:"normal"}};case 8:return{mode:"maximize",maximizedOptions:{dataTable:"accessible"}};case 4:return{mode:"spotlight"}}}var E=e,w=E.explore,V=w.contracts,F=E.data.services.DataViewObjectSerializer,P=e.data.services.ExpansionStateSerializer,T=w.services.upgrade.ExplorationStateVersions,N=E.data.services.SemanticQuerySerializer,D=jsCommon.Version;i.clearUnusedReferences=n,i.cloneSingleVisual=o,i.deserialize=a,i.serialize=y,i.serializeFilterContainer=C,i.serializeHighlightState=x,i.serializeSingleVisual=S;var R=(function(){function e(){this.version=T.v1_0}return e.prototype.serializeFilters=function(e){var t=this;if(e){var r={};return e.nameIdentifiedMerges&&(r.byName=_.mapValues(e.nameIdentifiedMerges,(function(e){return t.serializeFilterContainer(e)}))),e.exprIdentifiedMerges&&(r.byExpr=_.map(e.exprIdentifiedMerges,(function(e){return t.serializeFilterContainer(e)}))),e.typeIdentifiedMerges&&(r.byType=_.map(e.typeIdentifiedMerges,(function(e){return t.serializeFilterContainer(e)}))),e.transientFilters&&(r.byTransientState=_.map(e.transientFilters,(function(e){return t.serializeFilterContainer(e)}))),r}},e.prototype.serializeFilterContainer=function(e){return{name:e.name,type:null!=e.type?V.FilterType[e.type]:void 0,filter:e.filter?N.serializeFilter(e.filter):void 0,expression:e.expression?N.serializeExpr(e.expression):void 0,restatement:e.restatement,howCreated:e.howCreated,isTransient:e.isTransient,cachedDisplayNames:r.DisplayNameSerializer.serializeFilterLabelIdPairs(e.cachedValueItems),filterExpressionMetadata:e.filterExpressionMetadata?t.FilterExpressionMetadataUtils.serializeFilterExpressionMetadata(e.filterExpressionMetadata):void 0}},e.prototype.serializeSection=function(e){var t=this;return _.chain(e.visualContainers).values().sumBy((function(e){return null==e.highlight?0:1})).value()>1&&(this.version=D.max(this.version,T.v1_2)),{filters:this.serializeFilters(e.filters),visualContainers:_.mapValues(e.visualContainers,(function(e){return t.serializeVisualContainer(e)})),visualContainerGroups:e.visualContainerGroups&&_.mapValues(e.visualContainerGroups,(function(e){return t.serializeVisualContainerGroup(e)}))}},e.prototype.serializeVisualContainer=function(e){return e.highlight&&(this.version=D.max(this.version,T.v1_1)),{filters:this.serializeFilters(e.filters),singleVisual:this.serializeSingleVisual(e.singleVisual,e.visibility),highlight:e.highlight?this.serializeHighlightState(e.highlight):void 0}},e.prototype.serializeVisualContainerGroup=function(e){var t=this;return{isHidden:e.isHidden,children:e.children&&_.mapValues(e.children,(function(e){return t.serializeVisualContainerGroup(e)}))}},e.prototype.serializeSingleVisual=function(e,i){if(e){var n={visualType:e.visualType};return e.objects&&(n.objects=this.serializeObjects(e.objects)),e.orderBy&&(n.orderBy=N.serializeSortDefinitions(e.orderBy,!0)),e.activeProjections&&(n.activeProjections=this.serializeActiveProjections(e.activeProjections)),e.targetType&&(n.targetType=e.targetType,this.version=D.max(this.version,T.v1_6)),e.projections&&(n.projections=this.serializeActiveProjections(e.projections),this.version=D.max(this.version,T.v1_6)),e.cachedFilterDisplayItems&&(n.cachedFilterDisplayItems=r.DisplayNameSerializer.serializeFilterLabelIdPairs(e.cachedFilterDisplayItems)),e.filterExpressionMetadata&&(n.filterExpressionMetadata=t.FilterExpressionMetadataUtils.serializeFilterExpressionMetadata(e.filterExpressionMetadata),this.version=D.max(this.version,T.v1_5)),_.isEmpty(e.expansionStates)||(n.expansionStates=P.serializeExpansionStates(e.expansionStates)),e.hidden?n.display={mode:"hidden"}:i&&(n.display=b(i)),n}},e.prototype.serializeActiveProjections=function(e){var t;for(var r in e){var i=e[r];_.isEmpty(i)||(t||(t={}),t[r]=_.map(i,(function(e){return N.serializeExpr(e)})))}return t},e.prototype.serializeObjects=function(e){var t=this,r={};return e.merge&&(r.merge=F.serializeObjects(e.merge,null)),e.remove&&(r.remove=_.map(e.remove,(function(e){return t.serializeObjectPropSelector(e)}))),r},e.prototype.serializeObjectPropSelector=function(e){return{object:e.object,property:e.property,selector:F.serializeSelector(e.selector)||null}},e.prototype.serializeHighlightState=function(e){return e.filterExpressionMetadata&&(this.version=D.max(this.version,T.v1_3)),{selection:_.map(e.selection,(function(e){return F.serializeSelectorsByColumn(e)})),filterExpressionMetadata:e.filterExpressionMetadata?t.FilterExpressionMetadataUtils.serializeFilterExpressionMetadata(e.filterExpressionMetadata):void 0}},e})()})(i=r.ExplorationState||(r.ExplorationState={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(t,r){var i=[],n={objectId:t.objectId,name:t.objectId,type:t.type};t.creationTime&&(n.creationTime=new Date(Date.parse(t.creationTime))),t.expirationTime&&(n.expirationTime=new Date(Date.parse(t.expirationTime))),t.displayName&&(n.displayName=t.displayName),t.isDefault&&(n.isDefault=t.isDefault),null!=t.id&&(n.id=t.id);try{var o=void 0;t.explorationState&&(o=jsCommon.JsonExtensions.tryParseJSON(t.explorationState),o||i.push({code:0})),o&&(n.explorationState=e.ExplorationState.deserialize(o,r))}catch(e){i.push({code:1,message:e.message,stack:e.stack})}var a={contract:n};return _.isEmpty(i)||(a.errors=i),a}function i(t){var r={objectId:t.objectId,type:t.type};if(t.creationTime&&(r.creationTime=t.creationTime.toISOString()),t.expirationTime&&(r.expirationTime=t.expirationTime.toISOString()),t.displayName&&(r.displayName=t.displayName),t.isDefault&&(r.isDefault=t.isDefault),null!=t.id&&(r.id=t.id),t.explorationState){var i=e.ExplorationState.serialize(t.explorationState);r.explorationState=JSON.stringify(i)}return r}t.deserialize=r,t.serialize=i})(t=e.WebBookmark||(e.WebBookmark={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(r){var i=e.explore.services.upgrade.ExplorationVersions,n=jsCommon.Version,o=(function(){function e(){}return e.prototype.getMinDowngradeVersionForContract=function(e){for(var t=0,r=e.sections;t<r.length;t++){var o=r[t];if(o&&o.objects&&(o.objects.outspacePane||o.objects.filterCard))return i.v3_20}return n.ZeroStr},e.prototype.downgrade=function(e,r){if(n.lt(r,i.v5_1))for(var o=0,a=e.sections;o<a.length;o++){var s=a[o],l=s&&s.config&&s.config.objects;if(l&&l.outspacePane)for(var u=t.upgrade.v5_1.outspacePanePropertiesToUpdate,c=0,p=l.outspacePane;c<p.length;c++)for(var d=p[c],f=0,v=u;f<v.length;f++){var m=v[f],h=d.properties,g=h&&h[m.propertyName];g&&(h[m.propertyName]=t.upgrade.UpgradeUtils.ptToPxWireExpr(g))}if(l&&l.filterCard)for(var y=0,C=l.filterCard;y<C.length;y++){var d=C[y],h=d.properties,g=h&&h.textSize;g&&(h.textSize=t.upgrade.UpgradeUtils.ptToPxWireExpr(g))}}},e})();r.OutspaceFontDowngrader=o})(r=t.downgrade||(t.downgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r=e.explore.services.upgrade.ExplorationVersions,i=jsCommon.Version,n=jsCommon.JsonExtensions,o=jsCommon.StringExtensions,a=(function(){function e(){this.emptyPodConfig="{}"}return e.prototype.getMinDowngradeVersionForContract=function(e){if(e.settings&&e.settings.useCrossReportDrillthrough)return r.v3_24;if(_.isEmpty(e.pods)||_.isEmpty(e.sections))return i.ZeroStr;for(var t=0,n=e.pods;t<n.length;t++){if(1===n[t].referenceScope)return r.v3_24}return r.v3_14},e.prototype.downgrade=function(e,t){if(i.lt(t,r.v3_24)&&!_.isEmpty(e.pods)&&!_.isEmpty(e.sections))for(var n=0,o=e.pods;n<o.length;n++){var a=o[n];this.downgradePods(a,e.sections)}},e.prototype.downgradePods=function(e,t){if(null!=e.boundSection){var r=_.find(t,(function(t){return t.name===e.boundSection}));if(r&&null==r.config.acceptsAllFiltersWhenLinked){var i=n.tryParseJSON(e.config);if(null==r.config&&(r.config={}),r.config.acceptsAllFiltersWhenLinked=0===i.acceptsFilterContext||null==i.acceptsFilterContext,e.config=this.emptyPodConfig,e.referenceScope=void 0,e.type=void 0,null!=r.filters){var a=[];if(o.isNullOrUndefinedOrWhiteSpaceString(e.parameters)||(a=n.tryParseJSON(e.parameters)),!_.isEmpty(a)){var s=n.tryParseJSON(r.filters);_.isEmpty(s)||(e.parameters=this.downgradeParameters(a,s),r.filters=JSON.stringify(s))}}}}},e.prototype.downgradeParameters=function(e,t){for(var r=function(e){if(null==e.boundFilter)return"continue";var r=_.find(t,(function(t){return t.name===e.boundFilter}));return r?(5===r.howCreated&&(r.isLinkedAsAggregation=!!e.asAggregation),e.asAggregation=void 0,e.fieldExpr=void 0,void(e.isLegacySingleSelection=void 0)):"continue"},i=0,n=e;i<n.length;i++){r(n[i])}return JSON.stringify(e)},e})();t.PodDrillthroughDowngrader=a})(r=t.downgrade||(t.downgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new a}var n=e.data.DataViewObjectDefinitions,o=e.visuals.plugins;r.createVersionUpgrader=i;var a=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var a=o[n],s=a.config.singleVisual;if(s){var l=s.visualType||s.visualConfig.visualType;s.objects=this.upgradeVisualObjects(s.objects,l)}}}},e.prototype.upgradeFilterCollection=function(e){},e.prototype.getVersion=function(){return t.ExplorationVersions.v3_12_1},e.prototype.upgradeVisualObjects=function(e,t){return t===o.slicer.name?this.upgradeSlicerObjects(e):e},e.prototype.upgradeSlicerObjects=function(e){var t="general",r="filter";e||(e={});var i=n.getObjectDefinition(e,t,null),o=i&&i.properties[r],a=o&&o.filter;if(a&&this.isAndFilter(a)){var s="data",l=n.getObjectDefinition(e,s,null);if(l){var u=l.properties.startDate,c=l.properties.endDate,p=l.properties.numericStart,d=l.properties.numericEnd;(u&&!c||p&&!d)&&this.BetweenToBeforeOrAfterFilter(a,1),(c&&!u||d&&!p)&&this.BetweenToBeforeOrAfterFilter(a,0)}}return e},e.prototype.isAndFilter=function(e){if(1===e.Where.length){var t=e.Where[0].Condition;if(t&&t.And)return!0}return!1},e.prototype.BetweenToBeforeOrAfterFilter=function(e,t){var r=e.Where[0].Condition;return 0===t?e.Where[0].Condition=r.And.Right:e.Where[0].Condition=r.And.Left,e},e})();r.VersionUpgrader=a})(r=t.v3_12_1||(t.v3_12_1={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(e){return new C(e)}function n(e,t,r){var i=o(r),n=t&&!_.isEmpty(t[i]);if("scatterChart"===r&&n){null==v.getObjectDefinitionProperties(e,"fillPoint")&&(e||(e={}),e.fillPoint=[{properties:{show:{expr:g.serializeExpr(y.boolean(!0))}}}])}return e}function o(e){switch(e){case"filledMap":return"Size";case"barChart":case"clusteredBarChart":case"clusteredColumnChart":case"columnChart":case"funnel":case"hundredPercentStackedBarChart":case"hundredPercentStackedColumnChart":case"map":case"treemap":case"scatterChart":return"Gradient"}}function a(e){switch(e){case"filledMap":case"barChart":case"clusteredBarChart":case"clusteredColumnChart":case"columnChart":case"funnel":case"hundredPercentStackedBarChart":case"hundredPercentStackedColumnChart":case"map":case"treemap":case"scatterChart":return"Tooltips"}}function s(e,t){return"filledMap"===e&&t&&!_.isEmpty(t.Series)&&!_.isEmpty(t.Size)}function l(t,r,i){var n=o(i);if(n){var l=r.getQueryRef(n,0);if(l){var u=r.defn.select().withName(l),c=t&&t.dataPoint;if(!_.isEmpty(c))for(var p=0,d=c;p<d.length;p++){var f=d[p],v=f.properties.fillRule;if(null==f.selector&&v){if(s(i,r.projections)||c.push({selector:{data:[m.create(1)]},properties:{fill:{solid:{color:e.data.SQExprBuilder.fillRule(u.expr,v)}}}}),c.splice(c.indexOf(f),1),1===r.getUsageCount(l)){var h=r.tryGetExpr(n,0),g=a(i);r.add(h,g)}r.removeProjection(n,0);break}}}}}function u(e,t,r,i){var n,l,u="fillRule",p=o(r);if(p){var d=t&&t[p];if(!_.isEmpty(d)){var v=d[0].queryRef;if(v){var m=_.cloneDeep(_.find(i&&i.Select,(function(e){return e.Name===v})));if(m){delete m.Name;var h=m.Aggregation||m.Measure;if(h){var g=h.Expression.Column&&h.Expression.Column.Expression.SourceRef||h.Expression.SourceRef;if(g){var y=_.find(i.From,(function(e){return e.Name===g.Source}));if(y){g.Entity=y.Entity,delete g.Source;var C=e&&e.dataPoint;if(!_.isEmpty(C))for(var x=0,S=C;x<S.length;x++){var b=S[x];if(null==b.selector&&b.properties[u]){if(!s(r,t)){var E=_.cloneDeep(b.properties[u]);C.push({selector:{data:[{dataViewWildcard:{matchingOption:1}}]},properties:(n={},n.fill={solid:{color:{expr:{FillRule:{FillRule:f(E),Input:m}}}}},n)})}if(C.splice(C.indexOf(b),1),delete t[p],!c(v,t)){var w=a(r);t[w]||(t[w]=[]),(l=t[w]).push.apply(l,d)}break}}}}}}}}}}function c(e,t){for(var r in t){var i=t[r];if(_.some(i,(function(t){return t.queryRef===e})))return!0}return!1}function p(e){e.color&&(e.color=e.color.expr);var t=e;t.value&&(t.value=t.value.expr);var r=e;r.strategy&&(r.strategy=r.strategy.expr)}function d(e){p(e.min),p(e.max),e.mid&&p(e.mid),e.nullColoringStrategy&&p(e.nullColoringStrategy)}function f(e){return e.linearGradient2&&d(e.linearGradient2),e.linearGradient3&&d(e.linearGradient3),e}var v=e.data.services.wireContracts.DataViewObjectDefinitions,m=e.data.DataViewWildcard,h=jsCommon.JsonExtensions,g=e.data.services.SemanticQuerySerializer,y=e.data.SQExprBuilder;r.createVersionUpgrader=i;var C=(function(){function e(e){this.featureSwitchService=e}return e.prototype.upgrade=function(e){if(e)for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],o=0,a=i.visualContainers;o<a.length;o++){var s=a[o],l=s.config.singleVisual;if(l){var c=l.visualType,p=l.projections;this.featureSwitchService.featureSwitches.cartesianConditionalFormatting&&(l.objects=n(l.objects,p,c),u(l.objects,p,c,l.prototypeQuery));var d=h.tryParseJSON(s.dataTransforms);d&&(this.featureSwitchService.featureSwitches.cartesianConditionalFormatting&&(d.objects=n(d.objects,p,c),u(d.objects,p,c,l.prototypeQuery)),s.dataTransforms=JSON.stringify(d))}}},e.prototype.upgradeFilterCollection=function(){},e.prototype.getVersion=function(){return t.ExplorationFeatureVersions.CartesianConditionalFormatting},e})();r.VersionUpgrader=C,r.getFillRuleInputRoleFromVisualType=o,r.upgradeGradientOnObjectDef=l,r.upgradeGradientOnWireContractObjectDef=u})(r=t.v3_20||(t.v3_20={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new o}var i=jsCommon.JsonExtensions,n=jsCommon.StringExtensions;t.createVersionUpgrader=r;var o=(function(){function t(){this.podNamePrefix="Pod"}return t.prototype.upgrade=function(e){if(e&&!_.isEmpty(e.sections)){for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];this.upgradeSectionAcceptsAllFiltersWhenLinked(i)}for(var n=e.pods||[],o={},a=0,s=n;a<s.length;a++){o[s[a].name]=!0}for(var l=0,u=e.sections;l<u.length;l++){var i=u[l];this.upgradeSection(i,n,o)}_.isEmpty(n)||(e.pods=n)}},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v3_24},t.prototype.upgradeSectionAcceptsAllFiltersWhenLinked=function(e){e.config||(e.config={}),null==e.config.acceptsAllFiltersWhenLinked&&(1===e.config.type?e.config.acceptsAllFiltersWhenLinked=!0:0!==e.config.type&&null!=e.config.type||(e.config.acceptsAllFiltersWhenLinked=!1))},t.prototype.upgradeSection=function(e,t,r){if(e&&e.name){var n=i.tryParseJSON(e.filters)||[],o=_.some(n,(function(e){return 5===e.howCreated})),a=this.findPodForSectionName(t,e.name);a?this.upgradeExistingPod(a,e.config,o):o&&(a=this.createPod(t,e.name,e.config,r)),e.config&&(e.config.acceptsAllFiltersWhenLinked=void 0),a&&(this.upgradeFilters(a,n),e.filters=JSON.stringify(n))}},t.prototype.upgradeFilters=function(e,t){var r=[];n.isNullOrUndefinedOrWhiteSpaceString(e.parameters)||(r=i.tryParseJSON(e.parameters));for(var o=0,a=t;o<a.length;o++){var s=a[o];if(s.name&&!s.isTransient){var l=5===s.howCreated,u=this.findParamForFilterName(r,s.name);if(u)u.fieldExpr=s.expression,u.asAggregation=s.isLinkedAsAggregation,l||(u.isLegacySingleSelection=!0);else if(l){var c={name:"Param_"+s.name,boundFilter:s.name,fieldExpr:s.expression,asAggregation:s.isLinkedAsAggregation};r.push(c)}s.isLinkedAsAggregation=void 0}}e.parameters=JSON.stringify(r)},t.prototype.upgradeExistingPod=function(e,t,r){e.config=this.createPodConfig(t),e.referenceScope=0,r?e.type=this.determineType(t):e.type=0},t.prototype.findParamForFilterName=function(e,t){if(!_.isEmpty(e))return _.find(e,(function(e){return e.boundFilter===t}))},t.prototype.findPodForSectionName=function(e,t){if(!_.isEmpty(e))return _.find(e,(function(e){return e.boundSection===t}))},t.prototype.createPod=function(e,t,r,i){var o={name:n.findUniqueName(i,this.podNamePrefix),boundSection:t,type:this.determineType(r),referenceScope:0,config:this.createPodConfig(r)};return e.push(o),i[o.name]=!0,o},t.prototype.createPodConfig=function(e){var t=!e||e.acceptsAllFiltersWhenLinked?0:1,r={acceptsFilterContext:t};return JSON.stringify(r)},t.prototype.determineType=function(e){return e&&0!==e.type&&void 0!==e.type?e&&1===e.type?2:void 0:1},t})();t.VersionUpgrader=o})(t=e.v3_24||(e.v3_24={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new a}var n=e.data.services.DataViewObjectSerializer,o=e.visuals.keyDriversNumericAnalysis;r.createVersionUpgrader=i;var a=(function(){function r(){this.keyDriverObjectName="keyDrivers",this.selectedNumericAnalysisPropertyName="selectedNumericAnalysis"}return r.prototype.upgrade=function(t){if(t&&!_.isEmpty(t.sections))for(var r=0,i=t.sections;r<i.length;r++)for(var n=i[r],o=0,a=n.visualContainers;o<a.length;o++){var s=a[o],l=s.config&&s.config.singleVisual;l&&l.visualType===e.visuals.plugins.keyDriversVisual.name&&(l.objects=this.upgradeKeyDriversVisualObjects(l.objects))}},r.prototype.upgradeFilterCollection=function(){},r.prototype.getVersion=function(){return t.ExplorationVersions.v4_1},r.prototype.upgradeKeyDriversVisualObjects=function(t){t||(t={});var r=t[this.keyDriverObjectName];if(r||(r=t[this.keyDriverObjectName]=[{properties:{}}]),!r[0].properties[this.selectedNumericAnalysisPropertyName]){var i={enumeration:o.type},a=e.data.SQExprBuilder.typedConstant(o.categorical,i);r[0].properties[this.selectedNumericAnalysisPropertyName]=n.serializeObjectProperty(a,{type:i})}return t},r})();r.VersionUpgrader=a})(r=t.v4_1||(t.v4_1={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(e){return new i(e)}t.createVersionUpgrader=r;var i=(function(){function t(e){this.featureSwitchService=e}return t.prototype.upgrade=function(e){if(this.featureSwitchService&&this.featureSwitchService.featureSwitches&&this.featureSwitchService.featureSwitches.totalsConditionalFormatting&&e&&!_.isEmpty(e.sections))for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],n=0,o=i.visualContainers;n<o.length;n++){var a=o[n],s=a.config&&a.config.singleVisual;if(s&&s.objects){var l=s&&s.visualType;"pivotTable"!==l&&"tableEx"!==l||this.upgradeTablixProperties(s.objects,l)}}},t.prototype.upgradeTablixProperties=function(e,t){var r=e.values;if(r)for(var i=0,n=r;i<n.length;i++){var o=n[i];if(this.isValidRoleWildcard(o.selector,t)){var a=o.properties;a&&(o.properties.backColor||o.properties.fontColor)&&(o.selector.data=[{dataViewWildcard:{matchingOption:1}}])}}},t.prototype.isValidRoleWildcard=function(e,t){return!(!e||_.isEmpty(e.data)||1!==e.data.length||_.isEmpty(e.data[0].roles))&&("tableEx"===t&&_.isEqual(e.data[0].roles,["Values"])||"pivotTable"===t&&_.isEqual(e.data[0].roles,["Rows","Columns"]))},t.prototype.upgradeFilterCollection=function(){},t.prototype.getVersion=function(){return e.ExplorationVersions.v5_9},t})();t.VersionUpgrader=i})(t=e.v5_9||(e.v5_9={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{automaticallyImport:!1,sandboxProperties:[2,0]}}e.createDraggableChartVisualRegisterOptions=t})(t=e.PowerOnDraggableChartVisualHelper||(e.PowerOnDraggableChartVisualHelper={}))})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r=e.formattingService,i=jsCommon.Lazy,n=jsCommon.StringExtensions,o=(function(){function e(e,t,r){this.op=e,this.onOperatorChanged(),this.isCalendarShown=!1,this.value=new a(t,r)}return Object.defineProperty(e.prototype,"operator",{get:function(){return this.op},set:function(e){this.op!==e&&(this.op=e,this.onOperatorChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueRequired",{get:function(){return this.valRequired},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){return e.visit(this)},e.empty=function(){return new e(0)},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.operator===t.operator&&a.equals(e.value,t.value))},e.prototype.onOperatorChanged=function(){this.valRequired=s.getValueRequired(this.operator),this.valRequired||(this.value=void 0)},e})();t.Condition=o;var a=(function(){function e(e,t){null!=e&&(e instanceof Date&&(this.dateValue=e),this.value=e,this.formatter=t,this.stringValue=this.formatter?this.formatter.format(this.value):this.value.toString()),this.initialTime=this.dateValue,this.dateValue||(this.initialTime=new Date,this.initialTime.setHours(0,0,0,0))}return Object.defineProperty(e.prototype,"isDate",{get:function(){return null!=this.dateValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasValue",{get:function(){return null!=this.dateValue||!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(this.stringValue)},enumerable:!0,configurable:!0}),e.prototype.isValidDate=function(){return this.isDate&&(!_.isString(this.value)||null!==r.parseDate(this.value))},Object.defineProperty(e.prototype,"timePickerValue",{get:function(){return this.dateValue||this.initialTime},set:function(e){this.dateValue=e},enumerable:!0,configurable:!0}),e.equals=function(t,r){return t=t||null,r=r||null,t===r||!t==!r&&(e.compareDateTimeValue(t,r)&&t.stringValue===r.stringValue)},e.compareDateTimeValue=function(e,t){return(e.dateValue?e.dateValue.valueOf():0)===(t.dateValue?t.dateValue.valueOf():0)},e})();t.ConditionValue=a;var s;!(function(t){function r(e){return 11!==e&&12!==e&&0!==e}function n(e){return e.text?a.getValue():e.integer||e.numeric?s.getValue():e.dateTime?o.getValue():void 0}var o=new i(function(){var t=[];return t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan_DT")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual_DT")}),t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan_DT")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual_DT")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),a=new i(function(){var t=[];return t.push({value:5,label:e.common.localize.get("FilterOperator_Contains")}),t.push({value:6,label:e.common.localize.get("FilterOperator_DoesNotContain")}),t.push({value:7,label:e.common.localize.get("FilterOperator_StartsWith")}),t.push({value:8,label:e.common.localize.get("FilterOperator_DoesNotStartWith")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),s=new i(function(){var t=[];return t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t});t.getValueRequired=r,t.getFilterOperators=n})(s=t.OperatorHelper||(t.OperatorHelper={}));var l;!(function(r){function i(e,t,r){for(var i,n=new u(t,r),o=0,a=e;o<a.length;o++){var s=a[o];null!=s.operator&&0!==s.operator&&(i=s.accept(n))}return i}function o(t,r){var i;if(t.length>0){for(var o=[],a=0,s=t;a<s.length;a++){var l=s[a];o.push(c(l))}i=e.visuals.valueFormatter.formatListOr(o),i=r?n.format(e.common.localize.get("FilterRestatement_NotEqual"),i):n.format(e.common.localize.get("FilterRestatement_Equal"),i)}return i}function a(e,t,r){for(var i=[],n=0,a=e;n<a.length;n++){var l=a[n];i.push(s(l,r))}return o(i,t)}function s(e,r){var i=t.SQExprConverter.getFirstComparandValue(e);return r?r.format(i):i}function l(t){if(null!=t)return n.format(e.common.localize.get("FilterRestatement_IsDefault"),c(t))}function c(e){return null===e?null:_.isString(e)?e:e.displayName?e.displayName:"function"!=typeof e||"object"!=typeof e?e:void 0}r.fromCondition=i,r.fromLabels=o,r.fromDataViewScopeIdentities=a,r.getLabelFromScopeId=s,r.fromDefault=l})(l=t.RestatementHelper||(t.RestatementHelper={}));var u=(function(){function t(t,r){0===t?this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundAnd"):1===t&&(this.logicalOperatorResourceId=e.common.localize.get("Generic_Or")),this.formatter=r}return t.prototype.visit=function(e){var t=this.conditionToString(e);if(t)return _.isEmpty(this.result)?this.result=t:this.result=n.format(this.logicalOperatorResourceId,this.result,t),this.result},t.prototype.conditionToString=function(t){var r=t.value;if(!s.getValueRequired(t.operator)||r&&r.hasValue){var i;switch(r&&(i=this.formatter?this.formatter.format(r.value||r.stringValue):r.stringValue),t.operator){case 9:return n.format(e.common.localize.get("FilterRestatement_Equal"),i);case 10:return n.format(e.common.localize.get("FilterRestatement_NotEqual"),i);case 3:return r.isDate?n.format(e.common.localize.get("FilterRestatement_GreaterThan_DT"),i):n.format(e.common.localize.get("FilterRestatement_GreaterThan"),i);case 4:return r.isDate?n.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual_DT"),i):n.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual"),i);case 1:return r.isDate?n.format(e.common.localize.get("FilterRestatement_LessThan_DT"),i):n.format(e.common.localize.get("FilterRestatement_LessThan"),i);case 2:return r.isDate?n.format(e.common.localize.get("FilterRestatement_LessThanOrEqual_DT"),i):n.format(e.common.localize.get("FilterRestatement_LessThanOrEqual"),i);case 5:return n.format(e.common.localize.get("FilterRestatement_Contains"),i);case 6:return n.format(e.common.localize.get("FilterRestatement_DoesNotContain"),i);case 7:return n.format(e.common.localize.get("FilterRestatement_StartWith"),i);case 8:return n.format(e.common.localize.get("FilterRestatement_DoesNotStartWith"),i);case 11:return e.common.localize.get("FilterOperator_IsBlank");case 12:return e.common.localize.get("FilterOperator_IsNotBlank");default:return""}}},t})()})(t=e.data||(e.data={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(t,r,i){var n=s(t,r);return(i&&""!==i?e.DurationParser.durationParseResultAsMilliseconds(e.DurationParser.parseISODurationdString(i)):-Number.MAX_VALUE)>n}function i(t,r,i){var n=s(t,r);return(i&&""!==i?e.DurationParser.durationParseResultAsMilliseconds(e.DurationParser.parseISODurationdString(i)):Number.MAX_VALUE)<n}function n(e,t){var r=e.value,i=e.unit,n=e.isTimeUnit;switch(i){case"S":return 1===r?t.get("TimeUnit_Second"):t.get("TimeUnit_Seconds");case"M":return n?1===r?t.get("TimeUnit_Minute"):t.get("TimeUnit_Minutes"):1===r?t.get("TimeUnit_Month"):t.get("TimeUnit_Months");case"H":return 1===r?t.get("TimeUnit_Hour"):t.get("TimeUnit_Hours");case"D":return 1===r?t.get("TimeUnit_Day"):t.get("TimeUnit_Days");case"W":return 1===r?t.get("TimeUnit_Week"):t.get("TimeUnit_Weeks");case"Y":return 1===r?t.get("TimeUnit_Year"):t.get("TimeUnit_Years");default:return debug.assertNever(i),""}}function o(t,r){var i=e.DurationParser.parseISODurationdString(t),o=e.DurationParser.durationParseResultToArray(i);return o.length<=0?"":o[0].value+" "+n(o[0],r)}function a(e){switch(e){case"S":case"M":case"H":return!0;default:return!1}}function s(t,r){var i=[{value:t,unit:r,isTimeUnit:a(r)}],n=e.DurationParser.durationParseResultItemsToDurationParseResult(i);return e.DurationParser.durationParseResultAsMilliseconds(n)}function l(e,t){var r=Math.pow(10,t||0);return Math.round(e*r)/r}function u(e,t){return isNaN(e)?t.get("TwoDashes"):e<60?l(e,1)+" "+(1===e?t.get("TimeUnit_Second"):t.get("TimeUnit_Seconds")):(e/=60,e<60?l(e,1)+" "+(1===e?t.get("TimeUnit_Minute"):t.get("TimeUnit_Minutes")):(e/=60,l(e,1)+" "+(1===e?t.get("TimeUnit_Hour"):t.get("TimeUnit_Hours"))))}function c(e,t){var r=e.value,i=e.unit,n=e.isTimeUnit;switch(i){case"S":return 1===r?t.get("TimeUnit_One_second"):t.format("TimeUnit_seconds_with_value",r);case"M":return n?1===r?t.get("TimeUnit_One_minute"):t.format("CdsaAuthoring_Iframe_TheNumberOfHowManyMinutes",r):1===r?t.get("TimeUnit_One_month"):t.format("TimeUnit_months_with_value",r);case"H":return 1===r?t.get("SettingsDataset_ScheduleRefresh_RefreshFrequency_OneHour"):t.format("TimeUnit_hours_with_value",r);case"D":return 1===r?t.get("TimeUnit_One_day"):t.format("TimeUnit_days_with_value",r);case"W":return 1===r?t.get("TimeUnit_One_week"):t.format("TimeUnit_weeks_with_value",r);case"Y":return 1===r?t.get("TimeUnit_One_year"):t.format("TimeUnit_years_with_value",r);default:return debug.assertNever(i),""}}t.isBelowMinimumValue=r,t.isAboveMaximumValue=i,t.getFullUnitName=n,t.getReadableTimeString=o,t.isTimeUnit=a,t.convertSecondsToTimeString=u,t.getTimeString=c})(t=e.DurationDisplayHelper||(e.DurationDisplayHelper={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e){return{canClear:i(e),canDelete:n(e),canEdit:o(e),canHide:a(e),canLock:s(e),canRename:l(e),canSort:u(e)}}function i(e){return(0===e.howCreated||1===e.howCreated||2===e.howCreated||5===e.howCreated||7===e.howCreated)&&e.type!==c.Passthrough;
}function n(e){return 1===e.howCreated||5===e.howCreated||7===e.howCreated||e.type===c.Passthrough||3===e.howCreated||4===e.howCreated}function o(e){return(0===e.howCreated||1===e.howCreated||2===e.howCreated||5===e.howCreated||7===e.howCreated||3===e.howCreated||4===e.howCreated)&&e.type!==c.Passthrough}function a(e){return 0===e.howCreated||1===e.howCreated||5===e.howCreated&&!e.isTransient||e.type===c.Passthrough||3===e.howCreated||4===e.howCreated}function s(e){return(0===e.howCreated||1===e.howCreated||5===e.howCreated&&!e.isTransient||3===e.howCreated||4===e.howCreated)&&e.type!==c.Passthrough}function l(e){return(0===e.howCreated||1===e.howCreated)&&e.type!==c.Passthrough}function u(e){return 0===e.howCreated||1===e.howCreated||e.type===c.Passthrough||3===e.howCreated||4===e.howCreated}var c=e.contracts.FilterType;t.getFilterCapabilities=r})(t=e.FilterUtils||(e.FilterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,i){if(!_.isEmpty(e)&&d(e,t)){var n=f.getDataPointsDescription(i,e);return r.convertToFilterExpressionMetadata(n)}}function n(e,t,r){if(_.isEmpty(e)){return i(_.map(e,(function(e){return m.convertSelectorsByColumnToSelector(e)})),t,r)}}function o(e){if(!_.isEmpty(e.expressions)){var t={expressions:_.map(e.expressions,(function(e){return h.serializeExpr(e)}))};return _.isEmpty(e.cachedValueItems)||(t.cachedValueItems=v.serializeIdentityValueMap(e.cachedValueItems)),t}}function a(e){if(!_.isEmpty(e.expressions)){var t={expressions:_.map(e.expressions,(function(e){return h.deserializeExpr(e)}))};return _.isEmpty(e.cachedValueItems)||(t.cachedValueItems=v.deserializeIdentityValueMap(e.cachedValueItems)),t}}function s(e,t){if(!e||!t)return e||t;for(var r={expressions:t.expressions.slice(),cachedValueItems:_.isEmpty(t.cachedValueItems)?[]:t.cachedValueItems.slice()},i={},n=function(n){var o=e.expressions[n],a=_.findIndex(r.expressions,(function(e){return e===o||g.equals(e,o)}));a===-1&&(a=t.expressions.length,r.expressions.push(o)),i[n]=a},o=0;o<e.expressions.length;o++)n(o);if(!_.isEmpty(e.cachedValueItems))for(var a=0,s=e.cachedValueItems;a<s.length;a++){var l=s[a],u={};for(var c in l.valueMap)u[i[c]]=l.valueMap[c];r.cachedValueItems.push({identities:l.identities,valueMap:u})}return r}function l(e){for(var t=null,r=0,i=e;r<i.length;r++){t=s(i[r],t)}return t}function u(e,t){if(!_.isEmpty(t)&&e){for(var r=[],i=0,n=t;i<n.length;i++){var o=n[i],a={identities:[o.identity],valueMap:{}};a.valueMap[0]=o.displayName,r.push(a)}return{expressions:[e],cachedValueItems:r}}}function c(t){if(!_.isEmpty(t)){for(var r={expressions:[],cachedValueItems:[]},i=0,n=t;i<n.length;i++){for(var o=n[i],a={identities:[],valueMap:[]},s=0,l=o.selector.data;s<l.length;s++){var u=l[s];1===u.kind&&a.identities.push(u)}for(var c=0,p=o.values;c<p.length;c++){var d=p[c];if(d.expr instanceof e.data.SQColumnRefExpr){var f=_.indexOf(r.expressions,d.expr);f<0&&(r.expressions.push(d.expr),f=r.expressions.length-1),a.valueMap[f]=d.formattedValue}}_.isEmpty(a.valueMap)||r.cachedValueItems.push(a)}return r}}function p(e){if(e&&!(_.isEmpty(e.expressions)||e.expressions.length>1)){for(var t=[],r=0,i=e.cachedValueItems;r<i.length;r++){var n=i[r];if(_.isEmpty(n.identities)||n.identities.length>1)return;var o={identity:n.identities[0],displayName:n.valueMap[0]};t.push(o)}return t}}function d(t,r){if(!_.isEmpty(t)&&r&&r.query)for(var i=r.query.defn.select(),n=0,o=t;n<o.length;n++){var a=o[n],s=m.toScopeIdentities(a);if(_.isEmpty(s))return;for(var l=0,u=s;l<u.length;l++)for(var c=u[l],p=c.expr,d=e.data.ScopeIdentityExtractor.getKeys(p),f=0,v=d;f<v.length;f++)for(var h=v[f],y=0,C=i;y<C.length;y++){var x=C[y];if(!g.equals(h,x.expr))return!0}}}var f=e.data.DataViewQueryEngine,v=t.services.DisplayNameSerializer,m=e.data.Selector,h=e.data.services.SemanticQuerySerializer,g=e.data.SQExpr;r.getSelectorsMetadata=i,r.getSelectorsByColumnMetadata=n,r.serializeFilterExpressionMetadata=o,r.deserializeFilterExpressionMetadata=a,r.mergeFilterExpressionMetadata=s,r.mergeFilterExpressionMetadataArray=l,r.convertCacheToFilterExpressionMetadata=u,r.convertToFilterExpressionMetadata=c,r.tryGetDisplayNameIdentityPairs=p,r.hasGroupOnKeys=d})(r=t.FilterExpressionMetadataUtils||(t.FilterExpressionMetadataUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return s(e)}function r(e){return e.years*m+e.months*v+e.weeks*f+e.days*d+e.hours*p+e.minutes*c+e.seconds*u}function i(e){for(var t={years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0},r=0,i=e;r<i.length;r++){var n=i[r],o=n.value;n.isTimeUnit&&"S"===n.unit?t.seconds=o:n.isTimeUnit&&"M"===n.unit?t.minutes=o:n.isTimeUnit&&"H"===n.unit?t.hours=o:"D"===n.unit?t.days=o:"W"===n.unit?t.weeks=o:"M"===n.unit?t.months=o:"Y"===n.unit&&(t.years=o)}return t}function n(e){var t="P";return e.years>0&&(t+=""+e.years+"Y"),e.months>0&&(t+=""+e.months+"M"),e.weeks>0&&(t+=""+e.weeks+"W"),e.days>0&&(t+=""+e.days+"D"),0===e.hours&&0===e.minutes&&0===e.seconds?t:(t+="T",e.hours>0&&(t+=""+e.hours+"H"),e.minutes>0&&(t+=""+e.minutes+"M"),e.seconds>0&&(t+=""+e.seconds+"S"),t)}function o(e){var t=[];return e.seconds&&t.push({value:e.seconds,unit:"S",isTimeUnit:!0}),e.minutes&&t.push({value:e.minutes,unit:"M",isTimeUnit:!0}),e.hours&&t.push({value:e.hours,unit:"H",isTimeUnit:!0}),e.days&&t.push({value:e.days,unit:"D",isTimeUnit:!1}),e.weeks&&t.push({value:e.weeks,unit:"W",isTimeUnit:!1}),e.months&&t.push({value:e.months,unit:"M",isTimeUnit:!1}),e.years&&t.push({value:e.years,unit:"Y",isTimeUnit:!1}),t}function a(e,t){var r=e&&parseFloat(e.replace(",","."));return(isNaN(r)?0:r)*t}function s(e){var t=l.exec(e)||new Array(9),r="-"===t[1]?-1:1;return{years:a(t[2],r),months:a(t[3],r),weeks:a(t[4],r),days:a(t[5],r),hours:a(t[6],r),minutes:a(t[7],r),seconds:a(t[8],r)}}var l=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,u=1e3,c=60*u,p=60*c,d=24*p,f=7*d,v=30*d,m=365*d;e.parseISODurationdString=t,e.durationParseResultAsMilliseconds=r,e.durationParseResultItemsToDurationParseResult=i,e.durationParseResultToISODurationString=n,e.durationParseResultToArray=o})(t=e.DurationParser||(e.DurationParser={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));;"use strict";var __extends=this&&this.__extends||(function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}})(),__awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(o,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function s(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{o=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},__assign.apply(this,arguments)},powerbi;!(function(e){var t;!(function(t){function i(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x,E,F){var V=t.CustomerAction(d,h,v,g,f,y,m,C,S,w,b,x,E,F),P=je(V.info,{reportGuid:i,isDirectQuery:r,isOnPrem:o,enterpriseCapacitySkuTier:n,datasetHost:a,modelId:s,dataCacheMode:l,capacityObjectId:c,dbName:u,sectionVerticalAlignment:p});return{name:t.EXNewExplorationEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportGuid:P.reportGuid,isDirectQuery:P.isDirectQuery,isOnPrem:P.isOnPrem,datasetHost:P.datasetHost,modelId:P.modelId,dataCacheMode:P.dataCacheMode,capacityObjectId:P.capacityObjectId,dbName:P.dbName,sectionVerticalAlignment:P.sectionVerticalAlignment},{enterpriseCapacitySkuTier:P.enterpriseCapacitySkuTier},V.formatted())},info:P,loggers:t.EXNewExplorationLoggers}}function r(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{reportGuid:i,sectionIndex:r});return{name:t.EXRefreshReportEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportGuid:C.reportGuid,sectionIndex:C.sectionIndex},null,m.formatted())},info:C,loggers:t.EXRefreshReportLoggers}}function o(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{isSaveAs:i,source:r,isPersonalization:o});return{name:t.EXSaveExplorationEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({isSaveAs:S.isSaveAs,source:S.source},{isPersonalization:S.isPersonalization},C.formatted())},info:S,loggers:t.EXSaveExplorationLoggers}}function n(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.Verbose(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{sourceVisualType:i,targetVisualType:r,visualName:o});return{name:t.EXInteractionVisualConversionEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({sourceVisualType:S.sourceVisualType,targetVisualType:S.targetVisualType,visualName:S.visualName},null,C.formatted())},info:S,loggers:t.EXInteractionVisualConversionLoggers}}function a(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{sourceVisualType:i,isInlineHierarchyEnabled:r,visualName:o});return{name:t.EXInteractionExpandEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({sourceVisualType:S.sourceVisualType,isInlineHierarchyEnabled:S.isInlineHierarchyEnabled,visualName:S.visualName},null,C.formatted())},info:S,loggers:t.EXInteractionExpandLoggers}}function s(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{sourceVisualType:i,isDrillDown:r,visualName:o});return{name:t.EXInteractionDrillEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({sourceVisualType:S.sourceVisualType,isDrillDown:S.isDrillDown,visualName:S.visualName},null,C.formatted())},info:S,loggers:t.EXInteractionDrillLoggers}}function l(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{sourceVisualType:i,targetExprKind:r,visualName:o});return{name:t.EXDrillToDetailsEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({sourceVisualType:S.sourceVisualType,targetExprKind:S.targetExprKind,visualName:S.visualName},null,C.formatted())},info:S,loggers:t.EXDrillToDetailsLoggers}}function c(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S){var w=t.CustomerAction(s,l,c,u,p,d,h,v,g,f,y,m,C,S),b=je(w.info,{filterType:i,filterScopeType:r,fieldKind:o,drillToDetailsMode:n,viewMode:a});return{name:t.EXAddFilterEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({filterType:b.filterType,filterScopeType:b.filterScopeType,fieldKind:b.fieldKind,drillToDetailsMode:b.drillToDetailsMode,viewMode:b.viewMode},null,w.formatted())},info:b,loggers:t.EXAddFilterLoggers}}function u(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{filterType:i,filterScopeType:r,fieldKind:o,viewMode:n});return{name:t.EXClearFilterEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({filterType:w.filterType,filterScopeType:w.filterScopeType,fieldKind:w.fieldKind,viewMode:w.viewMode},null,S.formatted())},info:w,loggers:t.EXClearFilterLoggers}}function p(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{filterType:i,filterScopeType:r,fieldKind:o,viewMode:n});return{name:t.EXRemoveFilterEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({filterType:w.filterType,filterScopeType:w.filterScopeType,fieldKind:w.fieldKind,viewMode:w.viewMode},null,S.formatted())},info:w,loggers:t.EXRemoveFilterLoggers}}function d(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{filterType:i,filterScopeType:r,fieldKind:o,isFilterHidden:n});return{name:t.EXHideFilterEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({filterType:w.filterType,filterScopeType:w.filterScopeType,fieldKind:w.fieldKind,isFilterHidden:w.isFilterHidden},null,S.formatted())},info:w,loggers:t.EXHideFilterLoggers}}function h(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{filterType:i,filterScopeType:r,fieldKind:o,isFilterLocked:n});return{name:t.EXLockFilterEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({filterType:w.filterType,filterScopeType:w.filterScopeType,fieldKind:w.fieldKind,isFilterLocked:w.isFilterLocked},null,S.formatted())},info:w,loggers:t.EXLockFilterLoggers}}function v(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{paneType:i,expanded:r,viewMode:o});return{name:t.EXTogglePaneExpandedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({paneType:S.paneType,expanded:S.expanded,viewMode:S.viewMode},null,C.formatted())},info:S,loggers:t.EXTogglePaneExpandedLoggers}}function g(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w){var b=t.CustomerAction(l,c,u,p,d,h,v,g,f,y,m,C,S,w),x=je(b.info,{filterType:i,filterScopeType:r,fieldKind:o,expanded:n,viewMode:a,isInOutspacePane:s});return{name:t.EXToggleFilterCardExpandedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({filterType:x.filterType,filterScopeType:x.filterScopeType,fieldKind:x.fieldKind,expanded:x.expanded,viewMode:x.viewMode},{isInOutspacePane:x.isInOutspacePane},b.formatted())},info:x,loggers:t.EXToggleFilterCardExpandedLoggers}}function f(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{sortType:i});return{name:t.EXToggleFilterCardSortEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({sortType:m.sortType},null,y.formatted())},info:m,loggers:t.EXToggleFilterCardSortLoggers}}function y(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{isVisualFilter:i,filterType:r,viewMode:o,isInOutspacePane:n});return{name:t.EXFilterPaneAdvancedFilterAppliedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({isVisualFilter:w.isVisualFilter,filterType:w.filterType,viewMode:w.viewMode},{isInOutspacePane:w.isInOutspacePane},S.formatted())},info:w,loggers:t.EXFilterPaneAdvancedFilterAppliedLoggers}}function m(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w){var b=t.CustomerAction(l,c,u,p,d,h,v,g,f,y,m,C,S,w),x=je(b.info,{isTop:i,itemCount:r,atGrain:o,onVisualMeasure:n,viewMode:a,isInOutspacePane:s});return{name:t.EXFilterPaneTopNFilterAppliedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({isTop:x.isTop,itemCount:x.itemCount,atGrain:x.atGrain,onVisualMeasure:x.onVisualMeasure,viewMode:x.viewMode},{isInOutspacePane:x.isInOutspacePane},b.formatted())},info:x,loggers:t.EXFilterPaneTopNFilterAppliedLoggers}}function C(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b){var x=t.CustomerAction(c,u,p,d,h,v,g,f,y,m,C,S,w,b),E=je(x.info,{relativeQualifier:i,duration:r,relativeUnit:o,includeToday:n,isCalendarPeriod:a,viewMode:s,isInOutspacePane:l});return{name:t.EXFilterPaneRelativeDateFilterAppliedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({relativeQualifier:E.relativeQualifier,duration:E.duration,relativeUnit:E.relativeUnit,includeToday:E.includeToday,isCalendarPeriod:E.isCalendarPeriod,viewMode:E.viewMode},{isInOutspacePane:E.isInOutspacePane},x.formatted())},info:E,loggers:t.EXFilterPaneRelativeDateFilterAppliedLoggers}}function S(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S){var w=t.CustomerAction(s,l,c,u,p,d,h,v,g,f,y,m,C,S),b=je(w.info,{relativeQualifier:i,duration:r,relativeUnit:o,viewMode:n,isInOutspacePane:a});return{name:t.EXFilterPaneRelativeTimeFilterAppliedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({relativeQualifier:b.relativeQualifier,duration:b.duration,relativeUnit:b.relativeUnit,viewMode:b.viewMode},{isInOutspacePane:b.isInOutspacePane},w.formatted())},info:b,loggers:t.EXFilterPaneRelativeTimeFilterAppliedLoggers}}function w(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{filterScopeType:i,fieldKind:r,viewMode:o,isInOutspacePane:n});return{name:t.EXFilterPaneBasicFilterChangedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({filterScopeType:w.filterScopeType,fieldKind:w.fieldKind,viewMode:w.viewMode},{isInOutspacePane:w.isInOutspacePane},S.formatted())},info:w,loggers:t.EXFilterPaneBasicFilterChangedLoggers}}function b(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXFilterPaneFilterDefaultRestoredEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXFilterPaneFilterDefaultRestoredLoggers}}function x(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXFilterPaneFilterClearedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXFilterPaneFilterClearedLoggers}}function E(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXFilterPaneFilterDeletedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXFilterPaneFilterDeletedLoggers}}function F(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{filterInteractionKind:i,isInOutspacePane:r,viewMode:o});return{name:t.EXFilterPaneInteractionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({filterInteractionKind:S.filterInteractionKind,viewMode:S.viewMode},{isInOutspacePane:S.isInOutspacePane},C.formatted())},info:S,loggers:t.EXFilterPaneInteractionLoggers}}function V(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{enabled:i});return{name:t.EXImprovedFilterExperienceToggleReportSettingEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({enabled:m.enabled},null,y.formatted())},info:m,loggers:t.EXImprovedFilterExperienceToggleReportSettingLoggers}}function P(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{expanded:i,viewMode:r});return{name:t.EXImprovedFilterExperienceToggleOutspacePaneExpansionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({expanded:C.expanded,viewMode:C.viewMode},null,m.formatted())},info:C,loggers:t.EXImprovedFilterExperienceToggleOutspacePaneExpansionLoggers}}function M(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{visible:i});return{name:t.EXImprovedFilterExperienceToggleOutspacePaneVisibilityEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visible:m.visible},null,y.formatted())},info:m,loggers:t.EXImprovedFilterExperienceToggleOutspacePaneVisibilityLoggers}}function T(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{numOfFiltersShown:i,viewMode:r});return{name:t.EXImprovedFilterExperienceShowRestatementEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({numOfFiltersShown:C.numOfFiltersShown,viewMode:C.viewMode},null,m.formatted())},info:C,loggers:t.EXImprovedFilterExperienceShowRestatementLoggers}}function D(i){var r={message:i};return{name:t.EXLoadFilterErrorEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({message:r.message},null)},info:r,loggers:t.EXLoadFilterErrorLoggers}}function A(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{source:i,visualType:r,visualName:o});return{name:t.EXCreateVisualEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({source:S.source,visualType:S.visualType,visualName:S.visualName},null,C.formatted())},info:S,loggers:t.EXCreateVisualLoggers}}function I(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b){var x=t.Verbose(c,u,p,d,h,v,g,f,y,m,C,S,w,b),E=je(x.info,{source:i,targetVisualType:r,fieldKind:o,drillToDetailsMode:n,success:a,quickMeasureTemplateName:s,visualName:l});return{name:t.EXAddFieldEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({source:E.source,targetVisualType:E.targetVisualType,fieldKind:E.fieldKind,drillToDetailsMode:E.drillToDetailsMode,success:E.success,quickMeasureTemplateName:E.quickMeasureTemplateName,visualName:E.visualName},null,x.formatted())},info:E,loggers:t.EXAddFieldLoggers}}function _(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x){var E=t.Verbose(u,p,d,h,v,g,f,y,m,C,S,w,b,x),F=je(E.info,{loadType:i,onPrem:r,loadTypeWarnings:o,whereVisualIsLoaded:n,isServerCacheEligible:a,staleCacheResultFromServer:s,cacheResultFromServer:l,visualName:c});return{name:t.EXVisualFirstLoadEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({loadType:F.loadType,onPrem:F.onPrem,loadTypeWarnings:F.loadTypeWarnings,whereVisualIsLoaded:F.whereVisualIsLoaded,visualName:F.visualName},{isServerCacheEligible:F.isServerCacheEligible,staleCacheResultFromServer:F.staleCacheResultFromServer,cacheResultFromServer:F.cacheResultFromServer},E.formatted())},info:F,loggers:t.EXVisualFirstLoadLoggers}}function O(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{original:i,target:r});return{name:t.EXChangeQuickCalcEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({original:C.original,target:C.target},null,m.formatted())},info:C,loggers:t.EXChangeQuickCalcLoggers}}function N(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{visualType:i,diverging:r,userValueSpecified:o,visualName:n});return{name:t.EXSetConditionalFormattingEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualType:w.visualType,diverging:w.diverging,userValueSpecified:w.userValueSpecified,visualName:w.visualName},null,S.formatted())},info:w,loggers:t.EXSetConditionalFormattingLoggers}}function L(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.Verbose(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{visualType:i,userValueSpecified:r,fromPropertyPane:o,visualName:n});return{name:t.EXSetDataBarsEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualType:w.visualType,userValueSpecified:w.userValueSpecified,fromPropertyPane:w.fromPropertyPane,visualName:w.visualName},null,S.formatted())},info:w,loggers:t.EXSetDataBarsLoggers}}function k(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{totalVisuals:i,numberOfScriptVisuals:r,visualIds:o,userLicense:n});return{name:t.EXExplorationRefreshEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({totalVisuals:w.totalVisuals,numberOfScriptVisuals:w.numberOfScriptVisuals,visualIds:w.visualIds,userLicense:w.userLicense},null,S.formatted())},info:w,loggers:t.EXExplorationRefreshLoggers}}function R(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{reportObjectId:i});return{name:t.EXSnapshotEmbedCreateEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportObjectId:m.reportObjectId},null,y.formatted())},info:m,loggers:t.EXSnapshotEmbedCreateLoggers}}function B(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{reportObjectId:i});return{name:t.EXPublicEmbedCreateEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportObjectId:m.reportObjectId},null,y.formatted())},info:m,loggers:t.EXPublicEmbedCreateLoggers}}function z(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXSnapshotEmbedDeleteEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXSnapshotEmbedDeleteLoggers}}function $(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXSnapshotEmbedUpdateEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXSnapshotEmbedUpdateLoggers}}function H(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{fileName:i,resourcePackageId:r,resourcePackageName:o});return{name:t.EXImportCustomVizEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({fileName:S.fileName,resourcePackageId:S.resourcePackageId,resourcePackageName:S.resourcePackageName},null,C.formatted())},info:S,loggers:t.EXImportCustomVizLoggers}}function G(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{customVisualName:i});return{name:t.EXDeleteCustomVizEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({customVisualName:m.customVisualName},null,y.formatted())},info:m,loggers:t.EXDeleteCustomVizLoggers}}function U(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{whereVisualIsLoaded:i});return{name:t.EXEnableCustomVizEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({whereVisualIsLoaded:m.whereVisualIsLoaded},null,y.formatted())},info:m,loggers:t.EXEnableCustomVizLoggers}}function j(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{sourceVisualType:i,targetVisualType:r,filterAction:o});return{name:t.EXVisualRelationshipOverrideEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({sourceVisualType:S.sourceVisualType,targetVisualType:S.targetVisualType,filterAction:S.filterAction},null,C.formatted())},info:S,loggers:t.EXVisualRelationshipOverrideLoggers}}function X(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXCodePaneUserRunScriptEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXCodePaneUserRunScriptLoggers}}function Q(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXCodePaneUserEditScriptWithExternalIDEEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXCodePaneUserEditScriptWithExternalIDELoggers}}function W(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXCodePaneUserOpenOptionsDialogEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXCodePaneUserOpenOptionsDialogLoggers}}function q(i,r){var o={launchExternalIDEFailureType:i,message:r};return{name:t.EXCodePaneLaunchExternalIDEFailedEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({launchExternalIDEFailureType:o.launchExternalIDEFailureType,message:o.message},null)},info:o,loggers:t.EXCodePaneLaunchExternalIDEFailedLoggers}}function K(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXCodePaneLaunchExternalIDESucceededEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXCodePaneLaunchExternalIDESucceededLoggers}}function Z(i,r){var o={warningKey:i,message:r};return{name:t.EXCodePaneShowWarningEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({warningKey:o.warningKey,message:o.message},null)},info:o,loggers:t.EXCodePaneShowWarningLoggers}}function J(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b){var x=t.CustomerAction(c,u,p,d,h,v,g,f,y,m,C,S,w,b),E=je(x.info,{visualType:i,source:r,isPartialResult:o,dest:n,isPremiumUser:a,isDrillToDetailsMode:s,dataType:l});return{name:t.EXExportVisualDataEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualType:E.visualType,source:E.source,isPartialResult:E.isPartialResult,dest:E.dest,isPremiumUser:E.isPremiumUser,isDrillToDetailsMode:E.isDrillToDetailsMode,dataType:E.dataType},null,x.formatted())},info:E,loggers:t.EXExportVisualDataLoggers}}function Y(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.CustomerAction(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{countTotalVisuals:i,countScriptVisuals:r,visualIds:o,userLicense:n});return{name:t.EXLoadReportWithScriptVisEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({countTotalVisuals:w.countTotalVisuals,countScriptVisuals:w.countScriptVisuals,visualIds:w.visualIds,userLicense:w.userLicense},null,S.formatted())},info:w,loggers:t.EXLoadReportWithScriptVisLoggers}}function ee(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x,E,F,V){var P=t.Verbose(h,v,g,f,y,m,C,S,w,b,x,E,F,V),M=je(P.info,{reportId:i,reportGuid:r,sectionIndex:o,sectionGuid:n,groupObjectId:a,isReadonlyGroup:s,permissions:l,scrubUserInfo:c,newReport:u,originalReportGuid:p,originalGroupObjectId:d});return{name:t.ExploreHostChangeReportPageEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportId:M.reportId,reportGuid:M.reportGuid,sectionIndex:M.sectionIndex,permissions:M.permissions,originalReportGuid:M.originalReportGuid,originalGroupObjectId:M.originalGroupObjectId},{sectionGuid:M.sectionGuid,groupObjectId:M.groupObjectId,isReadonlyGroup:M.isReadonlyGroup,scrubUserInfo:M.scrubUserInfo,newReport:M.newReport},P.formatted())},info:M,loggers:t.ExploreHostChangeReportPageLoggers}}function te(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{reportId:i,numberOfVisualsRemoved:r});return{name:t.EXRemoveMobileCanvasVisualsEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportId:C.reportId,numberOfVisualsRemoved:C.numberOfVisualsRemoved},null,m.formatted())},info:C,loggers:t.EXRemoveMobileCanvasVisualsLoggers}}function ie(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.Verbose(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{reportGuid:i});return{name:t.EXLoadReportContainerEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportGuid:m.reportGuid},null,y.formatted())},info:m,loggers:t.EXLoadReportContainerLoggers}}function re(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b){var x=t.Verbose(c,u,p,d,h,v,g,f,y,m,C,S,w,b),E=je(x.info,{reportGuid:i,datasetId:r,packageId:o,isNew:n,permissions:a,packageType:s,httpStatusCode:l});return{name:t.EXLoadReportContainerDatasetMissingEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportGuid:E.reportGuid,datasetId:E.datasetId,packageId:E.packageId,isNew:E.isNew,permissions:E.permissions,packageType:E.packageType,httpStatusCode:E.httpStatusCode},null,x.formatted())},info:E,loggers:t.EXLoadReportContainerDatasetMissingLoggers}}function oe(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C){var S=t.Verbose(a,s,l,c,u,p,d,h,v,g,f,y,m,C),w=je(S.info,{reportGuid:i,isDirectQuery:r,isOnPrem:o,dataCacheMode:n});return{name:t.EXInitExplorationEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportGuid:w.reportGuid,isDirectQuery:w.isDirectQuery,isOnPrem:w.isOnPrem,dataCacheMode:w.dataCacheMode},null,S.formatted())},info:w,loggers:t.EXInitExplorationLoggers}}function ne(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.Verbose(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{visualTypesRemaining:i});return{name:t.EXLoadExplorationVisualsEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualTypesRemaining:m.visualTypesRemaining},null,y.formatted())},info:m,loggers:t.EXLoadExplorationVisualsLoggers,defaultTimeoutSec:60}}function ae(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.Verbose(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{visualType:i,visualName:r});return{name:t.EXRenderExplorationVisualEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualType:C.visualType,visualName:C.visualName},null,m.formatted())},info:C,loggers:t.EXRenderExplorationVisualLoggers,logRatio:.01}}function se(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.Verbose(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{reportGuid:i});return{name:t.EXFetchExplorationEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({reportGuid:m.reportGuid},null,y.formatted())},info:m,loggers:t.EXFetchExplorationLoggers}}function le(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m){var C=t.CustomerAction(n,a,s,l,c,u,p,d,h,v,g,f,y,m),S=je(C.info,{sourceLayout:i,targetLayout:r,viewMode:o});return{name:t.EXChangeCanvasLayoutEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({sourceLayout:S.sourceLayout,targetLayout:S.targetLayout,viewMode:S.viewMode},null,C.formatted())},info:S,loggers:t.EXChangeCanvasLayoutLoggers}}function ce(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w){var b=t.CustomerAction(l,c,u,p,d,h,v,g,f,y,m,C,S,w),x=je(b.info,{numberOfClusters:i,visualType:r,numberOfMeasures:o,numberOfDimensions:n,numberOfFilters:a,visualName:s});return{name:t.EXClusteringAddClusteringEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({numberOfClusters:x.numberOfClusters,visualType:x.visualType,numberOfMeasures:x.numberOfMeasures,numberOfDimensions:x.numberOfDimensions,numberOfFilters:x.numberOfFilters,visualName:x.visualName},null,b.formatted())},info:x,loggers:t.EXClusteringAddClusteringLoggers}}function ue(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S){var w=t.CustomerAction(s,l,c,u,p,d,h,v,g,f,y,m,C,S),b=je(w.info,{updatedName:i,updatedDescription:r,updatedClusterNames:o,updatedNumberOfClusters:n,newNumberOfClusters:a});return{name:t.EXClusteringEditClusteringEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({updatedName:b.updatedName,updatedDescription:b.updatedDescription,updatedClusterNames:b.updatedClusterNames,updatedNumberOfClusters:b.updatedNumberOfClusters,
newNumberOfClusters:b.newNumberOfClusters},null,w.formatted())},info:b,loggers:t.EXClusteringEditClusteringLoggers}}function pe(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{entryPoint:i,numberOfSelects:r});return{name:t.EXQuickMeasuresOpenDialogEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({entryPoint:C.entryPoint,numberOfSelects:C.numberOfSelects},null,m.formatted())},info:C,loggers:t.EXQuickMeasuresOpenDialogLoggers}}function de(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{selectedQuickMeasure:i,connectionType:r});return{name:t.EXQuickMeasuresDialogResultEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({selectedQuickMeasure:C.selectedQuickMeasure,connectionType:C.connectionType},null,m.formatted())},info:C,loggers:t.EXQuickMeasuresDialogResultLoggers}}function he(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{selectedQuickMeasure:i,isLast:r});return{name:t.EXQuickMeasuresOnMeasureChangeEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({selectedQuickMeasure:C.selectedQuickMeasure,isLast:C.isLast},null,m.formatted())},info:C,loggers:t.EXQuickMeasuresOnMeasureChangeLoggers}}function ve(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{entryPoint:i,toExternalReport:r});return{name:t.EXDrillthroughGotoTargetEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({entryPoint:C.entryPoint,toExternalReport:C.toExternalReport},null,m.formatted())},info:C,loggers:t.EXDrillthroughGotoTargetLoggers}}function ge(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{type:i,countOfCurrentPageDrillthroughFilters:r});return{name:t.EXDrillthroughFilterUpdateEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({type:C.type,countOfCurrentPageDrillthroughFilters:C.countOfCurrentPageDrillthroughFilters},null,m.formatted())},info:C,loggers:t.EXDrillthroughFilterUpdateLoggers}}function fe(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{visualType:i,visualName:r});return{name:t.EXRefreshHostDataEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualType:C.visualType,visualName:C.visualName},null,m.formatted())},info:C,loggers:t.EXRefreshHostDataLoggers}}function ye(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXBookmarkAddEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXBookmarkAddLoggers}}function me(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXBookmarkUpdateEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXBookmarkUpdateLoggers}}function Ce(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXBookmarkDeleteEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXBookmarkDeleteLoggers}}function Se(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXBookmarkPlayEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXBookmarkPlayLoggers}}function we(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{bookmarkName:i});return{name:t.EXBookmarkApplyEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({bookmarkName:m.bookmarkName},null,y.formatted())},info:m,loggers:t.EXBookmarkApplyLoggers}}function be(i,r,o,n,a){var s=t.ErrorWithStackTrace(n,a),l=je(s.info,{bookmarkType:i,bookmarkObjectId:r,errorCode:o});return{name:t.EXBookmarkLoadErrorEventName,category:e.TelemetryCategory.CriticalError,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({bookmarkType:l.bookmarkType,bookmarkObjectId:l.bookmarkObjectId,errorCode:l.errorCode},null,s.formatted())},info:l,loggers:t.EXBookmarkLoadErrorLoggers}}function xe(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{keepSynced:i,visualGroupCount:r});return{name:t.EXCopyPasteSyncGroupEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({keepSynced:C.keepSynced,visualGroupCount:C.visualGroupCount},null,m.formatted())},info:C,loggers:t.EXCopyPasteSyncGroupLoggers}}function Ee(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{entryPoint:i,action:r});return{name:t.EXCustomDateTableOpenDialogEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({entryPoint:C.entryPoint,action:C.action},null,m.formatted())},info:C,loggers:t.EXCustomDateTableOpenDialogLoggers}}function Fe(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{entryPoint:i,action:r});return{name:t.EXCustomDateTableCommitEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({entryPoint:C.entryPoint,action:C.action},null,m.formatted())},info:C,loggers:t.EXCustomDateTableCommitLoggers}}function Ve(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{errors:i});return{name:t.EXCustomDateTableValidationResultEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({errors:m.errors},null,y.formatted())},info:m,loggers:t.EXCustomDateTableValidationResultLoggers}}function Pe(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXNavigateBackEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXNavigateBackLoggers}}function Me(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x,E,F){var V=t.Verbose(d,h,v,g,f,y,m,C,S,w,b,x,E,F),P=je(V.info,{targetSectionIndex:i,forceUpdate:r,suppressHistory:o,canvasLayout:n,clearSelection:a,isCancelled1:s,width:l,height:c,displayOption:u,sectionGuid:p});return{name:t.EXUpdateActiveSectionEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({targetSectionIndex:P.targetSectionIndex,canvasLayout:P.canvasLayout,width:P.width,height:P.height,displayOption:P.displayOption,sectionGuid:P.sectionGuid},{forceUpdate:P.forceUpdate,suppressHistory:P.suppressHistory,clearSelection:P.clearSelection,isCancelled1:P.isCancelled1},V.formatted())},info:P,loggers:t.EXUpdateActiveSectionLoggers,defaultTimeoutSec:10}}function Te(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{nextPage:i});return{name:t.EXSwitchToAdjacentSectionEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({nextPage:m.nextPage},null,y.formatted())},info:m,loggers:t.EXSwitchToAdjacentSectionLoggers}}function De(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.Verbose(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{visualName:i});return{name:t.EXVisualContainerApplyUpdateEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualName:m.visualName},null,y.formatted())},info:m,loggers:t.EXVisualContainerApplyUpdateLoggers,logRatio:0}}function Ae(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.Verbose(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{visualName:i});return{name:t.EXVisualDataChangedEventName,category:e.TelemetryCategory.Verbose,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualName:m.visualName},null,y.formatted())},info:m,loggers:t.EXVisualDataChangedLoggers,logRatio:0}}function Ie(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{visualName:i});return{name:t.EXApplySlicerEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualName:m.visualName},null,y.formatted())},info:m,loggers:t.EXApplySlicerLoggers}}function _e(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{visualType:i,visualName:r});return{name:t.EXSelectDataPointEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualType:C.visualType,visualName:C.visualName},null,m.formatted())},info:C,loggers:t.EXSelectDataPointLoggers}}function Oe(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{visualId:i,visualName:r});return{name:t.EXRefreshSingleVisualEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualId:C.visualId,visualName:C.visualName},null,m.formatted())},info:C,loggers:t.EXRefreshSingleVisualLoggers}}function Ne(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{sectionId:i,reportId:r});return{name:t.EXPerformanceAnalyzerRefreshReportEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({sectionId:C.sectionId,reportId:C.reportId},null,m.formatted())},info:C,loggers:t.EXPerformanceAnalyzerRefreshReportLoggers}}function Le(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{numLogs:i});return{name:t.EXPerformanceAnalyzerExportLogsEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({numLogs:m.numLogs},null,y.formatted())},info:m,loggers:t.EXPerformanceAnalyzerExportLogsLoggers}}function ke(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(i,r,o,n,a,s,l,c,u,p,d,h,v,g),y=je(f.info,{});return{name:t.EXPerformanceAnalyzerCopyQueriesEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,null,f.formatted())},info:y,loggers:t.EXPerformanceAnalyzerCopyQueriesLoggers}}function Re(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x,E,F,V){var P=t.CustomerAction(h,v,g,f,y,m,C,S,w,b,x,E,F,V),M=je(P.info,{recordingLength:i,numLogs:r,filterChangeCount:o,modelChangeCount:n,slicerChangeCount:a,crossHighlightCount:s,drillCount:l,visualEditCount:c,sectionChangeCount:u,refreshCount:p,loadMoreCount:d});return{name:t.EXPerformanceAnalyzerStopRecordingEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({recordingLength:M.recordingLength,numLogs:M.numLogs,filterChangeCount:M.filterChangeCount,modelChangeCount:M.modelChangeCount,slicerChangeCount:M.slicerChangeCount,crossHighlightCount:M.crossHighlightCount,drillCount:M.drillCount,visualEditCount:M.visualEditCount,sectionChangeCount:M.sectionChangeCount,refreshCount:M.refreshCount,loadMoreCount:M.loadMoreCount},null,P.formatted())},info:M,loggers:t.EXPerformanceAnalyzerStopRecordingLoggers}}function Be(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x,E){var F=t.CustomerAction(p,d,h,v,g,f,y,m,C,S,w,b,x,E),V=je(F.info,{themeSentimentDivergentColorsCount:i,advancedColorCount:r,textFontSizeCount:o,textFontFaceCount:n,textFontColorCount:a,visualPropertyChangeCount:s,pagePropertyChangeCount:l,filterPanePropertyChangeCount:c,isOldThemeTextClassesAccessed:u});return{name:t.EXThemeDialogClosedEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({themeSentimentDivergentColorsCount:V.themeSentimentDivergentColorsCount,advancedColorCount:V.advancedColorCount,textFontSizeCount:V.textFontSizeCount,textFontFaceCount:V.textFontFaceCount,textFontColorCount:V.textFontColorCount,visualPropertyChangeCount:V.visualPropertyChangeCount,pagePropertyChangeCount:V.pagePropertyChangeCount,filterPanePropertyChangeCount:V.filterPanePropertyChangeCount,isOldThemeTextClassesAccessed:V.isOldThemeTextClassesAccessed},null,F.formatted())},info:V,loggers:t.EXThemeDialogClosedLoggers}}function ze(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{favoriteResourcePackageAction:i,favoriteResourcePackagePayload:r});return{name:t.SettingsFavoriteResourcePackagesEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({favoriteResourcePackageAction:C.favoriteResourcePackageAction},{favoriteResourcePackagePayload:C.favoriteResourcePackagePayload},m.formatted())},info:C,loggers:t.SettingsFavoriteResourcePackagesLoggers}}function $e(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){var m=t.CustomerAction(o,n,a,s,l,c,u,p,d,h,v,g,f,y),C=je(m.info,{visualPaneAction:i,visualPaneActionPayload:r});return{name:t.SettingsVisualPaneEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted({visualPaneAction:C.visualPaneAction},{visualPaneActionPayload:C.visualPaneActionPayload},m.formatted())},info:C,loggers:t.SettingsVisualPaneLoggers}}function He(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var y=t.CustomerAction(r,o,n,a,s,l,c,u,p,d,h,v,g,f),m=je(y.info,{outOfBoxVisuals:i});return{name:t.SettingsOutOfBoxVisualsEventName,category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:Ge(),formatted:function(){return e.extendFormatted(null,{outOfBoxVisuals:m.outOfBoxVisuals},y.formatted())},info:m,loggers:t.SettingsOutOfBoxVisualsLoggers}}var Ge,Ue=jsCommon.Utility,je=jsCommon.UnionExtensions.mergeUnionType,Xe=e.telemetry.EventFactories;Ge=Ue?Ue.generateGuid:Function.prototype,t.EXNewExplorationEventName="PBI.EX.NewExploration",t.EXNewExploration=i,Xe[t.EXNewExplorationEventName]=function(i){return e.telemetryEventFactory(t.EXNewExplorationEventName,i,t.EXNewExplorationLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["enterpriseCapacitySkuTier"])},t.EXRefreshReportEventName="PBI.EX.RefreshReport",t.EXRefreshReport=r,Xe[t.EXRefreshReportEventName]=function(i){return e.telemetryEventFactory(t.EXRefreshReportEventName,i,t.EXRefreshReportLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXSaveExplorationEventName="PBI.EX.SaveExploration",t.EXSaveExploration=o,Xe[t.EXSaveExplorationEventName]=function(i){return e.telemetryEventFactory(t.EXSaveExplorationEventName,i,t.EXSaveExplorationLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isPersonalization"])},t.EXInteractionVisualConversionEventName="PBI.EX.InteractionVisualConversion",t.EXInteractionVisualConversion=n,Xe[t.EXInteractionVisualConversionEventName]=function(i){return e.telemetryEventFactory(t.EXInteractionVisualConversionEventName,i,t.EXInteractionVisualConversionLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXInteractionExpandEventName="PBI.EX.InteractionExpand",t.EXInteractionExpand=a,Xe[t.EXInteractionExpandEventName]=function(i){return e.telemetryEventFactory(t.EXInteractionExpandEventName,i,t.EXInteractionExpandLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXInteractionDrillEventName="PBI.EX.InteractionDrill",t.EXInteractionDrill=s,Xe[t.EXInteractionDrillEventName]=function(i){return e.telemetryEventFactory(t.EXInteractionDrillEventName,i,t.EXInteractionDrillLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXDrillToDetailsEventName="PBI.EX.DrillToDetails",t.EXDrillToDetails=l,Xe[t.EXDrillToDetailsEventName]=function(i){return e.telemetryEventFactory(t.EXDrillToDetailsEventName,i,t.EXDrillToDetailsLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXAddFilterEventName="PBI.EX.AddFilter",t.EXAddFilter=c,Xe[t.EXAddFilterEventName]=function(i){return e.telemetryEventFactory(t.EXAddFilterEventName,i,t.EXAddFilterLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXClearFilterEventName="PBI.EX.ClearFilter",t.EXClearFilter=u,Xe[t.EXClearFilterEventName]=function(i){return e.telemetryEventFactory(t.EXClearFilterEventName,i,t.EXClearFilterLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXRemoveFilterEventName="PBI.EX.RemoveFilter",t.EXRemoveFilter=p,Xe[t.EXRemoveFilterEventName]=function(i){return e.telemetryEventFactory(t.EXRemoveFilterEventName,i,t.EXRemoveFilterLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXHideFilterEventName="PBI.EX.HideFilter",t.EXHideFilter=d,Xe[t.EXHideFilterEventName]=function(i){return e.telemetryEventFactory(t.EXHideFilterEventName,i,t.EXHideFilterLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXLockFilterEventName="PBI.EX.LockFilter",t.EXLockFilter=h,Xe[t.EXLockFilterEventName]=function(i){return e.telemetryEventFactory(t.EXLockFilterEventName,i,t.EXLockFilterLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXTogglePaneExpandedEventName="PBI.EX.TogglePaneExpanded",t.EXTogglePaneExpanded=v,Xe[t.EXTogglePaneExpandedEventName]=function(i){return e.telemetryEventFactory(t.EXTogglePaneExpandedEventName,i,t.EXTogglePaneExpandedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXToggleFilterCardExpandedEventName="PBI.EX.ToggleFilterCardExpanded",t.EXToggleFilterCardExpanded=g,Xe[t.EXToggleFilterCardExpandedEventName]=function(i){return e.telemetryEventFactory(t.EXToggleFilterCardExpandedEventName,i,t.EXToggleFilterCardExpandedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isInOutspacePane"])},t.EXToggleFilterCardSortEventName="PBI.EX.ToggleFilterCardSort",t.EXToggleFilterCardSort=f,Xe[t.EXToggleFilterCardSortEventName]=function(i){return e.telemetryEventFactory(t.EXToggleFilterCardSortEventName,i,t.EXToggleFilterCardSortLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXFilterPaneAdvancedFilterAppliedEventName="PBI.EX.FilterPaneAdvancedFilterApplied",t.EXFilterPaneAdvancedFilterApplied=y,Xe[t.EXFilterPaneAdvancedFilterAppliedEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneAdvancedFilterAppliedEventName,i,t.EXFilterPaneAdvancedFilterAppliedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isInOutspacePane"])},t.EXFilterPaneTopNFilterAppliedEventName="PBI.EX.FilterPaneTopNFilterApplied",t.EXFilterPaneTopNFilterApplied=m,Xe[t.EXFilterPaneTopNFilterAppliedEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneTopNFilterAppliedEventName,i,t.EXFilterPaneTopNFilterAppliedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isInOutspacePane"])},t.EXFilterPaneRelativeDateFilterAppliedEventName="PBI.EX.FilterPaneRelativeDateFilterApplied",t.EXFilterPaneRelativeDateFilterApplied=C,Xe[t.EXFilterPaneRelativeDateFilterAppliedEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneRelativeDateFilterAppliedEventName,i,t.EXFilterPaneRelativeDateFilterAppliedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isInOutspacePane"])},t.EXFilterPaneRelativeTimeFilterAppliedEventName="PBI.EX.FilterPaneRelativeTimeFilterApplied",t.EXFilterPaneRelativeTimeFilterApplied=S,Xe[t.EXFilterPaneRelativeTimeFilterAppliedEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneRelativeTimeFilterAppliedEventName,i,t.EXFilterPaneRelativeTimeFilterAppliedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isInOutspacePane"])},t.EXFilterPaneBasicFilterChangedEventName="PBI.EX.FilterPaneBasicFilterChanged",t.EXFilterPaneBasicFilterChanged=w,Xe[t.EXFilterPaneBasicFilterChangedEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneBasicFilterChangedEventName,i,t.EXFilterPaneBasicFilterChangedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isInOutspacePane"])},t.EXFilterPaneFilterDefaultRestoredEventName="PBI.EX.FilterPaneFilterDefaultRestored",t.EXFilterPaneFilterDefaultRestored=b,Xe[t.EXFilterPaneFilterDefaultRestoredEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneFilterDefaultRestoredEventName,i,t.EXFilterPaneFilterDefaultRestoredLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXFilterPaneFilterClearedEventName="PBI.EX.FilterPaneFilterCleared",t.EXFilterPaneFilterCleared=x,Xe[t.EXFilterPaneFilterClearedEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneFilterClearedEventName,i,t.EXFilterPaneFilterClearedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXFilterPaneFilterDeletedEventName="PBI.EX.FilterPaneFilterDeleted",t.EXFilterPaneFilterDeleted=E,Xe[t.EXFilterPaneFilterDeletedEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneFilterDeletedEventName,i,t.EXFilterPaneFilterDeletedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXFilterPaneInteractionEventName="PBI.EX.FilterPaneInteraction",t.EXFilterPaneInteraction=F,Xe[t.EXFilterPaneInteractionEventName]=function(i){return e.telemetryEventFactory(t.EXFilterPaneInteractionEventName,i,t.EXFilterPaneInteractionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["isInOutspacePane"])},t.EXImprovedFilterExperienceToggleReportSettingEventName="PBI.EX.ImprovedFilterExperience.ToggleReportSetting",t.EXImprovedFilterExperienceToggleReportSetting=V,Xe[t.EXImprovedFilterExperienceToggleReportSettingEventName]=function(i){return e.telemetryEventFactory(t.EXImprovedFilterExperienceToggleReportSettingEventName,i,t.EXImprovedFilterExperienceToggleReportSettingLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXImprovedFilterExperienceToggleOutspacePaneExpansionEventName="PBI.EX.ImprovedFilterExperience.ToggleOutspacePaneExpansion",t.EXImprovedFilterExperienceToggleOutspacePaneExpansion=P,Xe[t.EXImprovedFilterExperienceToggleOutspacePaneExpansionEventName]=function(i){return e.telemetryEventFactory(t.EXImprovedFilterExperienceToggleOutspacePaneExpansionEventName,i,t.EXImprovedFilterExperienceToggleOutspacePaneExpansionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXImprovedFilterExperienceToggleOutspacePaneVisibilityEventName="PBI.EX.ImprovedFilterExperience.ToggleOutspacePaneVisibility",t.EXImprovedFilterExperienceToggleOutspacePaneVisibility=M,Xe[t.EXImprovedFilterExperienceToggleOutspacePaneVisibilityEventName]=function(i){return e.telemetryEventFactory(t.EXImprovedFilterExperienceToggleOutspacePaneVisibilityEventName,i,t.EXImprovedFilterExperienceToggleOutspacePaneVisibilityLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXImprovedFilterExperienceShowRestatementEventName="PBI.EX.ImprovedFilterExperience.ShowRestatement",t.EXImprovedFilterExperienceShowRestatement=T,Xe[t.EXImprovedFilterExperienceShowRestatementEventName]=function(i){return e.telemetryEventFactory(t.EXImprovedFilterExperienceShowRestatementEventName,i,t.EXImprovedFilterExperienceShowRestatementLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXLoadFilterErrorEventName="PBI.EX.LoadFilterError",t.EXLoadFilterError=D,Xe[t.EXLoadFilterErrorEventName]=function(i){return e.telemetryEventFactory(t.EXLoadFilterErrorEventName,i,t.EXLoadFilterErrorLoggers,void 0,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null)},t.EXCreateVisualEventName="PBI.EX.CreateVisual",t.EXCreateVisual=A,Xe[t.EXCreateVisualEventName]=function(i){return e.telemetryEventFactory(t.EXCreateVisualEventName,i,t.EXCreateVisualLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXAddFieldEventName="PBI.EX.AddField",t.EXAddField=I,Xe[t.EXAddFieldEventName]=function(i){return e.telemetryEventFactory(t.EXAddFieldEventName,i,t.EXAddFieldLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXVisualFirstLoadEventName="PBI.EX.VisualFirstLoad",t.EXVisualFirstLoad=_,Xe[t.EXVisualFirstLoadEventName]=function(i){return e.telemetryEventFactory(t.EXVisualFirstLoadEventName,i,t.EXVisualFirstLoadLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,["isServerCacheEligible","staleCacheResultFromServer","cacheResultFromServer"])},t.EXChangeQuickCalcEventName="PBI.EX.ChangeQuickCalc",t.EXChangeQuickCalc=O,Xe[t.EXChangeQuickCalcEventName]=function(i){return e.telemetryEventFactory(t.EXChangeQuickCalcEventName,i,t.EXChangeQuickCalcLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXSetConditionalFormattingEventName="PBI.EX.SetConditionalFormatting",t.EXSetConditionalFormatting=N,Xe[t.EXSetConditionalFormattingEventName]=function(i){return e.telemetryEventFactory(t.EXSetConditionalFormattingEventName,i,t.EXSetConditionalFormattingLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXSetDataBarsEventName="PBI.EX.SetDataBars",t.EXSetDataBars=L,Xe[t.EXSetDataBarsEventName]=function(i){return e.telemetryEventFactory(t.EXSetDataBarsEventName,i,t.EXSetDataBarsLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXExplorationRefreshEventName="PBI.EX.ExplorationRefresh",t.EXExplorationRefresh=k,Xe[t.EXExplorationRefreshEventName]=function(i){return e.telemetryEventFactory(t.EXExplorationRefreshEventName,i,t.EXExplorationRefreshLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXSnapshotEmbedCreateEventName="PBI.EX.SnapshotEmbedCreate",t.EXSnapshotEmbedCreate=R,Xe[t.EXSnapshotEmbedCreateEventName]=function(i){return e.telemetryEventFactory(t.EXSnapshotEmbedCreateEventName,i,t.EXSnapshotEmbedCreateLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXPublicEmbedCreateEventName="PBI.EX.PublicEmbedCreate",t.EXPublicEmbedCreate=B,Xe[t.EXPublicEmbedCreateEventName]=function(i){return e.telemetryEventFactory(t.EXPublicEmbedCreateEventName,i,t.EXPublicEmbedCreateLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXSnapshotEmbedDeleteEventName="PBI.EX.SnapshotEmbedDelete",t.EXSnapshotEmbedDelete=z,Xe[t.EXSnapshotEmbedDeleteEventName]=function(i){return e.telemetryEventFactory(t.EXSnapshotEmbedDeleteEventName,i,t.EXSnapshotEmbedDeleteLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXSnapshotEmbedUpdateEventName="PBI.EX.SnapshotEmbedUpdate",t.EXSnapshotEmbedUpdate=$,Xe[t.EXSnapshotEmbedUpdateEventName]=function(i){return e.telemetryEventFactory(t.EXSnapshotEmbedUpdateEventName,i,t.EXSnapshotEmbedUpdateLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXImportCustomVizEventName="PBI.EX.ImportCustomViz",t.EXImportCustomViz=H,Xe[t.EXImportCustomVizEventName]=function(i){return e.telemetryEventFactory(t.EXImportCustomVizEventName,i,t.EXImportCustomVizLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXDeleteCustomVizEventName="PBI.EX.DeleteCustomViz",t.EXDeleteCustomViz=G,Xe[t.EXDeleteCustomVizEventName]=function(i){return e.telemetryEventFactory(t.EXDeleteCustomVizEventName,i,t.EXDeleteCustomVizLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXEnableCustomVizEventName="PBI.EX.EnableCustomViz",t.EXEnableCustomViz=U,Xe[t.EXEnableCustomVizEventName]=function(i){return e.telemetryEventFactory(t.EXEnableCustomVizEventName,i,t.EXEnableCustomVizLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXVisualRelationshipOverrideEventName="PBI.EX.VisualRelationshipOverride",t.EXVisualRelationshipOverride=j,Xe[t.EXVisualRelationshipOverrideEventName]=function(i){return e.telemetryEventFactory(t.EXVisualRelationshipOverrideEventName,i,t.EXVisualRelationshipOverrideLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXCodePaneUserRunScriptEventName="PBI.EX.CodePaneUserRunScript",t.EXCodePaneUserRunScript=X,Xe[t.EXCodePaneUserRunScriptEventName]=function(i){return e.telemetryEventFactory(t.EXCodePaneUserRunScriptEventName,i,t.EXCodePaneUserRunScriptLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXCodePaneUserEditScriptWithExternalIDEEventName="PBI.EX.CodePaneUserEditScriptWithExternalIDE",t.EXCodePaneUserEditScriptWithExternalIDE=Q,Xe[t.EXCodePaneUserEditScriptWithExternalIDEEventName]=function(i){return e.telemetryEventFactory(t.EXCodePaneUserEditScriptWithExternalIDEEventName,i,t.EXCodePaneUserEditScriptWithExternalIDELoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXCodePaneUserOpenOptionsDialogEventName="PBI.EX.CodePaneUserOpenOptionsDialog",t.EXCodePaneUserOpenOptionsDialog=W,Xe[t.EXCodePaneUserOpenOptionsDialogEventName]=function(i){return e.telemetryEventFactory(t.EXCodePaneUserOpenOptionsDialogEventName,i,t.EXCodePaneUserOpenOptionsDialogLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXCodePaneLaunchExternalIDEFailedEventName="PBI.EX.CodePaneLaunchExternalIDEFailed",t.EXCodePaneLaunchExternalIDEFailed=q,Xe[t.EXCodePaneLaunchExternalIDEFailedEventName]=function(i){return e.telemetryEventFactory(t.EXCodePaneLaunchExternalIDEFailedEventName,i,t.EXCodePaneLaunchExternalIDEFailedLoggers,void 0,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null)},t.EXCodePaneLaunchExternalIDESucceededEventName="PBI.EX.CodePaneLaunchExternalIDESucceeded",t.EXCodePaneLaunchExternalIDESucceeded=K,Xe[t.EXCodePaneLaunchExternalIDESucceededEventName]=function(i){return e.telemetryEventFactory(t.EXCodePaneLaunchExternalIDESucceededEventName,i,t.EXCodePaneLaunchExternalIDESucceededLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXCodePaneShowWarningEventName="PBI.EX.CodePaneShowWarning",t.EXCodePaneShowWarning=Z,Xe[t.EXCodePaneShowWarningEventName]=function(i){return e.telemetryEventFactory(t.EXCodePaneShowWarningEventName,i,t.EXCodePaneShowWarningLoggers,void 0,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null)},t.EXExportVisualDataEventName="PBI.EX.ExportVisualData",t.EXExportVisualData=J,Xe[t.EXExportVisualDataEventName]=function(i){
return e.telemetryEventFactory(t.EXExportVisualDataEventName,i,t.EXExportVisualDataLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXLoadReportWithScriptVisEventName="PBI.EX.LoadReportWithScriptVis",t.EXLoadReportWithScriptVis=Y,Xe[t.EXLoadReportWithScriptVisEventName]=function(i){return e.telemetryEventFactory(t.EXLoadReportWithScriptVisEventName,i,t.EXLoadReportWithScriptVisLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.ExploreHostChangeReportPageEventName="PBI.ExploreHost.ChangeReportPage",t.ExploreHostChangeReportPage=ee,Xe[t.ExploreHostChangeReportPageEventName]=function(i){return e.telemetryEventFactory(t.ExploreHostChangeReportPageEventName,i,t.ExploreHostChangeReportPageLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,["sectionGuid","groupObjectId","isReadonlyGroup","scrubUserInfo","newReport"])},t.EXRemoveMobileCanvasVisualsEventName="PBI.EX.RemoveMobileCanvasVisuals",t.EXRemoveMobileCanvasVisuals=te,Xe[t.EXRemoveMobileCanvasVisualsEventName]=function(i){return e.telemetryEventFactory(t.EXRemoveMobileCanvasVisualsEventName,i,t.EXRemoveMobileCanvasVisualsLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXLoadReportContainerEventName="PBI.EX.LoadReportContainer",t.EXLoadReportContainer=ie,Xe[t.EXLoadReportContainerEventName]=function(i){return e.telemetryEventFactory(t.EXLoadReportContainerEventName,i,t.EXLoadReportContainerLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXLoadReportContainerDatasetMissingEventName="PBI.EX.LoadReportContainerDatasetMissing",t.EXLoadReportContainerDatasetMissing=re,Xe[t.EXLoadReportContainerDatasetMissingEventName]=function(i){return e.telemetryEventFactory(t.EXLoadReportContainerDatasetMissingEventName,i,t.EXLoadReportContainerDatasetMissingLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXInitExplorationEventName="PBI.EX.InitExploration",t.EXInitExploration=oe,Xe[t.EXInitExplorationEventName]=function(i){return e.telemetryEventFactory(t.EXInitExplorationEventName,i,t.EXInitExplorationLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXLoadExplorationVisualsEventName="PBI.EX.LoadExplorationVisuals",t.EXLoadExplorationVisuals=ne,Xe[t.EXLoadExplorationVisualsEventName]=function(i){return e.telemetryEventFactory(t.EXLoadExplorationVisualsEventName,i,t.EXLoadExplorationVisualsLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXRenderExplorationVisualEventName="PBI.EX.RenderExplorationVisual",t.EXRenderExplorationVisual=ae,Xe[t.EXRenderExplorationVisualEventName]=function(i){return e.telemetryEventFactory(t.EXRenderExplorationVisualEventName,i,t.EXRenderExplorationVisualLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXFetchExplorationEventName="PBI.EX.FetchExploration",t.EXFetchExploration=se,Xe[t.EXFetchExplorationEventName]=function(i){return e.telemetryEventFactory(t.EXFetchExplorationEventName,i,t.EXFetchExplorationLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXChangeCanvasLayoutEventName="PBI.EX.ChangeCanvasLayout",t.EXChangeCanvasLayout=le,Xe[t.EXChangeCanvasLayoutEventName]=function(i){return e.telemetryEventFactory(t.EXChangeCanvasLayoutEventName,i,t.EXChangeCanvasLayoutLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXClusteringAddClusteringEventName="PBI.EX.Clustering.AddClustering",t.EXClusteringAddClustering=ce,Xe[t.EXClusteringAddClusteringEventName]=function(i){return e.telemetryEventFactory(t.EXClusteringAddClusteringEventName,i,t.EXClusteringAddClusteringLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXClusteringEditClusteringEventName="PBI.EX.Clustering.EditClustering",t.EXClusteringEditClustering=ue,Xe[t.EXClusteringEditClusteringEventName]=function(i){return e.telemetryEventFactory(t.EXClusteringEditClusteringEventName,i,t.EXClusteringEditClusteringLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXQuickMeasuresOpenDialogEventName="PBI.EX.QuickMeasures.OpenDialog",t.EXQuickMeasuresOpenDialog=pe,Xe[t.EXQuickMeasuresOpenDialogEventName]=function(i){return e.telemetryEventFactory(t.EXQuickMeasuresOpenDialogEventName,i,t.EXQuickMeasuresOpenDialogLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXQuickMeasuresDialogResultEventName="PBI.EX.QuickMeasures.DialogResult",t.EXQuickMeasuresDialogResult=de,Xe[t.EXQuickMeasuresDialogResultEventName]=function(i){return e.telemetryEventFactory(t.EXQuickMeasuresDialogResultEventName,i,t.EXQuickMeasuresDialogResultLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXQuickMeasuresOnMeasureChangeEventName="PBI.EX.QuickMeasures.OnMeasureChange",t.EXQuickMeasuresOnMeasureChange=he,Xe[t.EXQuickMeasuresOnMeasureChangeEventName]=function(i){return e.telemetryEventFactory(t.EXQuickMeasuresOnMeasureChangeEventName,i,t.EXQuickMeasuresOnMeasureChangeLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXDrillthroughGotoTargetEventName="PBI.EX.Drillthrough.GotoTarget";t.EXDrillthroughGotoTarget=ve;Xe[t.EXDrillthroughGotoTargetEventName]=function(i){return e.telemetryEventFactory(t.EXDrillthroughGotoTargetEventName,i,t.EXDrillthroughGotoTargetLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXDrillthroughFilterUpdateEventName="PBI.EX.Drillthrough.FilterUpdate",t.EXDrillthroughFilterUpdate=ge,Xe[t.EXDrillthroughFilterUpdateEventName]=function(i){return e.telemetryEventFactory(t.EXDrillthroughFilterUpdateEventName,i,t.EXDrillthroughFilterUpdateLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXRefreshHostDataEventName="PBI.EX.RefreshHostData",t.EXRefreshHostData=fe,Xe[t.EXRefreshHostDataEventName]=function(i){return e.telemetryEventFactory(t.EXRefreshHostDataEventName,i,t.EXRefreshHostDataLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXBookmarkAddEventName="PBI.EX.BookmarkAdd",t.EXBookmarkAdd=ye,Xe[t.EXBookmarkAddEventName]=function(i){return e.telemetryEventFactory(t.EXBookmarkAddEventName,i,t.EXBookmarkAddLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXBookmarkUpdateEventName="PBI.EX.BookmarkUpdate",t.EXBookmarkUpdate=me,Xe[t.EXBookmarkUpdateEventName]=function(i){return e.telemetryEventFactory(t.EXBookmarkUpdateEventName,i,t.EXBookmarkUpdateLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXBookmarkDeleteEventName="PBI.EX.BookmarkDelete",t.EXBookmarkDelete=Ce,Xe[t.EXBookmarkDeleteEventName]=function(i){return e.telemetryEventFactory(t.EXBookmarkDeleteEventName,i,t.EXBookmarkDeleteLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXBookmarkPlayEventName="PBI.EX.BookmarkPlay",t.EXBookmarkPlay=Se,Xe[t.EXBookmarkPlayEventName]=function(i){return e.telemetryEventFactory(t.EXBookmarkPlayEventName,i,t.EXBookmarkPlayLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXBookmarkApplyEventName="PBI.EX.BookmarkApply",t.EXBookmarkApply=we,Xe[t.EXBookmarkApplyEventName]=function(i){return e.telemetryEventFactory(t.EXBookmarkApplyEventName,i,t.EXBookmarkApplyLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXBookmarkLoadErrorEventName="PBI.EX.Bookmark.LoadError",t.EXBookmarkLoadError=be,Xe[t.EXBookmarkLoadErrorEventName]=function(i){return e.telemetryEventFactory(t.EXBookmarkLoadErrorEventName,i,t.EXBookmarkLoadErrorLoggers,t.ErrorWithStackTraceEventName,e.TelemetryCategory.CriticalError,void 0,void 0,void 0,null)},t.EXCopyPasteSyncGroupEventName="PBI.EX.CopyPasteSyncGroup",t.EXCopyPasteSyncGroup=xe,Xe[t.EXCopyPasteSyncGroupEventName]=function(i){return e.telemetryEventFactory(t.EXCopyPasteSyncGroupEventName,i,t.EXCopyPasteSyncGroupLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXCustomDateTableOpenDialogEventName="PBI.EX.CustomDateTableOpenDialog",t.EXCustomDateTableOpenDialog=Ee,Xe[t.EXCustomDateTableOpenDialogEventName]=function(i){return e.telemetryEventFactory(t.EXCustomDateTableOpenDialogEventName,i,t.EXCustomDateTableOpenDialogLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXCustomDateTableCommitEventName="PBI.EX.CustomDateTableCommit",t.EXCustomDateTableCommit=Fe,Xe[t.EXCustomDateTableCommitEventName]=function(i){return e.telemetryEventFactory(t.EXCustomDateTableCommitEventName,i,t.EXCustomDateTableCommitLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXCustomDateTableValidationResultEventName="PBI.EX.CustomDateTableValidationResult",t.EXCustomDateTableValidationResult=Ve,Xe[t.EXCustomDateTableValidationResultEventName]=function(i){return e.telemetryEventFactory(t.EXCustomDateTableValidationResultEventName,i,t.EXCustomDateTableValidationResultLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXNavigateBackEventName="PBI.EX.NavigateBack",t.EXNavigateBack=Pe,Xe[t.EXNavigateBackEventName]=function(i){return e.telemetryEventFactory(t.EXNavigateBackEventName,i,t.EXNavigateBackLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXUpdateActiveSectionEventName="PBI.EX.UpdateActiveSection",t.EXUpdateActiveSection=Me,Xe[t.EXUpdateActiveSectionEventName]=function(i){return e.telemetryEventFactory(t.EXUpdateActiveSectionEventName,i,t.EXUpdateActiveSectionLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,["forceUpdate","suppressHistory","clearSelection","isCancelled1"])},t.EXSwitchToAdjacentSectionEventName="PBI.EX.SwitchToAdjacentSection",t.EXSwitchToAdjacentSection=Te,Xe[t.EXSwitchToAdjacentSectionEventName]=function(i){return e.telemetryEventFactory(t.EXSwitchToAdjacentSectionEventName,i,t.EXSwitchToAdjacentSectionLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXVisualContainerApplyUpdateEventName="PBI.EX.VisualContainerApplyUpdate",t.EXVisualContainerApplyUpdate=De,Xe[t.EXVisualContainerApplyUpdateEventName]=function(i){return e.telemetryEventFactory(t.EXVisualContainerApplyUpdateEventName,i,t.EXVisualContainerApplyUpdateLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXVisualDataChangedEventName="PBI.EX.VisualDataChanged",t.EXVisualDataChanged=Ae,Xe[t.EXVisualDataChangedEventName]=function(i){return e.telemetryEventFactory(t.EXVisualDataChangedEventName,i,t.EXVisualDataChangedLoggers,t.VerboseEventName,e.TelemetryCategory.Verbose,void 0,void 0,void 0,null)},t.EXApplySlicerEventName="PBI.EX.ApplySlicer",t.EXApplySlicer=Ie,Xe[t.EXApplySlicerEventName]=function(i){return e.telemetryEventFactory(t.EXApplySlicerEventName,i,t.EXApplySlicerLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXSelectDataPointEventName="PBI.EX.SelectDataPoint",t.EXSelectDataPoint=_e,Xe[t.EXSelectDataPointEventName]=function(i){return e.telemetryEventFactory(t.EXSelectDataPointEventName,i,t.EXSelectDataPointLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXRefreshSingleVisualEventName="PBI.EX.RefreshSingleVisual",t.EXRefreshSingleVisual=Oe,Xe[t.EXRefreshSingleVisualEventName]=function(i){return e.telemetryEventFactory(t.EXRefreshSingleVisualEventName,i,t.EXRefreshSingleVisualLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXPerformanceAnalyzerRefreshReportEventName="PBI.EX.PerformanceAnalyzerRefreshReport",t.EXPerformanceAnalyzerRefreshReport=Ne,Xe[t.EXPerformanceAnalyzerRefreshReportEventName]=function(i){return e.telemetryEventFactory(t.EXPerformanceAnalyzerRefreshReportEventName,i,t.EXPerformanceAnalyzerRefreshReportLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXPerformanceAnalyzerExportLogsEventName="PBI.EX.PerformanceAnalyzerExportLogs",t.EXPerformanceAnalyzerExportLogs=Le,Xe[t.EXPerformanceAnalyzerExportLogsEventName]=function(i){return e.telemetryEventFactory(t.EXPerformanceAnalyzerExportLogsEventName,i,t.EXPerformanceAnalyzerExportLogsLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXPerformanceAnalyzerCopyQueriesEventName="PBI.EX.PerformanceAnalyzerCopyQueries",t.EXPerformanceAnalyzerCopyQueries=ke,Xe[t.EXPerformanceAnalyzerCopyQueriesEventName]=function(i){return e.telemetryEventFactory(t.EXPerformanceAnalyzerCopyQueriesEventName,i,t.EXPerformanceAnalyzerCopyQueriesLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXPerformanceAnalyzerStopRecordingEventName="PBI.EX.PerformanceAnalyzerStopRecording",t.EXPerformanceAnalyzerStopRecording=Re,Xe[t.EXPerformanceAnalyzerStopRecordingEventName]=function(i){return e.telemetryEventFactory(t.EXPerformanceAnalyzerStopRecordingEventName,i,t.EXPerformanceAnalyzerStopRecordingLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.EXThemeDialogClosedEventName="PBI.EX.ThemeDialogClosed",t.EXThemeDialogClosed=Be,Xe[t.EXThemeDialogClosedEventName]=function(i){return e.telemetryEventFactory(t.EXThemeDialogClosedEventName,i,t.EXThemeDialogClosedLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,null)},t.SettingsFavoriteResourcePackagesEventName="PBI.Settings.FavoriteResourcePackages",t.SettingsFavoriteResourcePackages=ze,Xe[t.SettingsFavoriteResourcePackagesEventName]=function(i){return e.telemetryEventFactory(t.SettingsFavoriteResourcePackagesEventName,i,t.SettingsFavoriteResourcePackagesLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["favoriteResourcePackagePayload"])},t.SettingsVisualPaneEventName="PBI.Settings.VisualPane",t.SettingsVisualPane=$e,Xe[t.SettingsVisualPaneEventName]=function(i){return e.telemetryEventFactory(t.SettingsVisualPaneEventName,i,t.SettingsVisualPaneLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["visualPaneActionPayload"])},t.SettingsOutOfBoxVisualsEventName="PBI.Settings.OutOfBoxVisuals",t.SettingsOutOfBoxVisuals=He,Xe[t.SettingsOutOfBoxVisualsEventName]=function(i){return e.telemetryEventFactory(t.SettingsOutOfBoxVisualsEventName,i,t.SettingsOutOfBoxVisualsLoggers,t.CustomerActionEventName,e.TelemetryCategory.CustomerAction,void 0,void 0,void 0,["outOfBoxVisuals"])}})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.Condition,o=e.data.OperatorHelper,n=e.data.RestatementHelper,a=(function(){function e(e){this.field=e,this.conditions=[],this.operators=[],this.logicalOperator=2,this.logicalAndOperator=0,this.logicalOrOperator=1}return e.prototype.toSQExpr=function(e){var t=this.field,r=t.getMetadata(e);if(r){var o=r.type;return i.FilterCardConverter.toSQExpr(t,o,this.conditions,this.logicalOperator)}},e.prototype.getRestatement=function(e){return n.fromCondition(this.conditions,this.logicalOperator,e)},e.prototype.areConditionsValid=function(e){var t=this.conditions;if(_.isEmpty(t))return!1;for(var i=0,r=t.length;i<r;i++){var n=t[i];if(null!=n.operator&&0!==n.operator){if(n.value&&n.value.hasValue){if(o.getValueRequired(n.operator)&&n.value&&!n.value.hasValue)return!1;if(e&&!this.isConditionValid(e,n))return!1}}else if(i<r-1)return!1}return!0},e.prototype.loadOperators=function(e,t){var i=this.field;if(_.isEmpty(i.validate(e,t))){var r=i.getMetadata(e);this.operators=o.getFilterOperators(r.type)}},e.prototype.ensureConditions=function(){var e=this.operators;this.conditions||(this.conditions=[]);var t=this.conditions;for(_.isEmpty(this.conditions)&&!_.isEmpty(e)&&t.push(new r(e[0].value));t.length<2;)this.logicalOperator=0,t.push(r.empty())},e.prototype.isConditionValid=function(e,r){if(!e)return!1;var o=r.value;if(o&&o.isDate&&!o.isValidDate())return!1;var n=this.field,a=t.FilterUtils.getValueType(n,e);return!!a&&i.FilterCardConverter.isConditionValid(n,a,r)},e})();i.AdvFilterCard=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.Condition,o=e.data.ConditionValue,n=e.data.SQAndExpr,a=e.data.SQBetweenExpr,s=e.data.SQCompareExpr,l=e.data.SQConstantExpr,c=e.data.SQContainsExpr,u=e.data.SQDateSpanExpr,p=e.data.SQExpr,d=e.data.SQExprBuilder,h=e.data.SQInExpr,v=e.data.SQNotExpr,g=e.data.SQOrExpr,f=e.data.SQStartsWithExpr,y=/[0-9]*\.?[0-9]+%/;!(function(e){function t(e,t,i){return e.accept(new m(t,i))}function i(e,t,i,r){void 0===r&&(r=0);for(var o,n=new C(e,t,r),a=0,s=i;a<s.length;a++){var l=s[a];null!=l.operator&&0!==l.operator&&(o=l.accept(n))}return o}function r(e,t,i){var r=new C(e,t,(void 0));return null!=i.accept(r)}e.createAdvFilter=t,e.toSQExpr=i,e.isConditionValid=r})(i=t.FilterCardConverter||(t.FilterCardConverter={}));var m=(function(e){function i(t,i){var r=e.call(this)||this;return r.supportsCategorical=!0,r.context={isNegative:!1,allowNot:!0,logicalOperator:2},r.formatter=t,r.field=i,r}return __extends(i,e),i.prototype.visitColumnRef=function(e){if(null==this.field||p.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitGroupRef=function(e){if(null==this.field||p.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitMeasureRef=function(e){return this.createFilterCard(e)},i.prototype.visitAggr=function(e){return this.createFilterCard(e)},i.prototype.visitArithmetic=function(e){return this.createFilterCard(e)},i.prototype.visitHierarchyLevel=function(e){return this.supportsCategorical=!1,this.createFilterCard(e)},i.prototype.visitEntity=function(e){return this.createFilterCard(e)},i.prototype.visitIn=function(e){if(!e.table&&e.args&&1===e.args.length){e.args[0].accept(this);var t=this.filter;if(null==t&&null!=this.field)return this.createFilterCard(this.field);for(var i=this.context,o=0,n=e.values;o<n.length;o++){var a=n[o];i.condition=new r(i.isNegative?10:9),a[0].accept(this),t.conditions.push(i.condition)}if(2!==t.logicalOperator)return;var s=i.isNegative?0:1;return t.logicalOperator=s,t}},i.prototype.visitBetween=function(e){this.supportsCategorical=!1,e.arg.accept(this);var t=this.filter,i=this.context;if(i.condition=new r(i.isNegative?1:4),e.lower.accept(this),t.conditions.push(i.condition),i.condition=new r(i.isNegative?3:2),e.upper.accept(this),t.conditions.push(i.condition),2===t.logicalOperator)return t.logicalOperator=0,t},i.prototype.visitAnd=function(e){this.supportsCategorical=!1;var t=this.context,i=t.isNegative?1:0;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitOr=function(e){var t=this.context,i=t.isNegative?0:1;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitCompare=function(e){var t=this.context,i=this.getFilterOperator(e,t.isNegative);if(void 0!==i&&0!==i){t.condition=new r(this.getFilterOperator(e,t.isNegative));var o=t.allowNot;if(t.allowNot=!1,e.left.accept(this)&&e.right.accept(this)&&(e.right instanceof l||e.right instanceof u)){var n=this.filter;return n.conditions.push(this.context.condition),n.conditions.length>1&&2===n.logicalOperator&&(n.logicalOperator=0),t.allowNot=o,t.condition=null,n}}},i.prototype.visitNot=function(e){var t=this.context,i=e.arg;if((i instanceof s||i instanceof h||i instanceof a||t.allowNot&&(i instanceof n||i instanceof g||i instanceof c||i instanceof f||i instanceof v))&&(t.isNegative=!t.isNegative,e.arg.accept(this)))return t.isNegative=!t.isNegative,this.filter},i.prototype.visitConstant=function(e){if(this.context.condition){var t=this.context.condition;return 0!==e.type.primitiveType&&(t.value=new o(e.value,this.formatter)),this.filter}},i.prototype.visitDateSpan=function(e){if(this.supportsCategorical=!1,5===e.unit){var t=this.context,i=t.allowNot;t.allowNot=!1;var r=e.arg.accept(this);return t.allowNot=i,r}},i.prototype.visitContains=function(e){this.supportsCategorical=!1;var t=this.context;t.condition=new r(t.isNegative?6:5);var i=t.allowNot;if(t.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),t.allowNot=i,o}},i.prototype.visitStartsWith=function(e){this.supportsCategorical=!1;var t=this.context;t.condition=new r(t.isNegative?8:7);var i=t.allowNot;if(t.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),t.allowNot=i,o}},i.prototype.getFilterOperator=function(e,t){switch(this.supportsCategorical=this.supportsCategorical&&0===e.comparison,e.comparison){case 3:return t?4:1;case 4:return t?3:2;case 1:return t?2:3;case 2:return t?1:4;case 0:return e.right instanceof l&&0===e.right.type.primitiveType?t?12:11:t?10:9}},i.prototype.createFilterCard=function(e){return this.filter||(this.filter=new t.AdvFilterCard(e),this.filter.supportsCategorical=this.supportsCategorical,this.filter.logicalOperator=this.context.logicalOperator),this.filter},i})(e.data.DefaultSQExprVisitor),C=(function(){function t(e,t,i){this.propertyExpr=e,this.dataType=t,this.logicalOperator=i}return t.prototype.visit=function(e){var t=this.expandExpr(e);return t&&(this.result?0===this.logicalOperator?this.result=d.and(this.result,t):1===this.logicalOperator&&(this.result=d.or(this.result,t)):this.result=t),this.result},t.prototype.expandExpr=function(e){var t,i=11!==e.operator&&12!==e.operator;if(i&&(t=this.getValueExpr(e)),t||!i)switch(e.operator){case 9:return d.compare(0,this.propertyExpr,t);case 10:return d.not(d.compare(0,this.propertyExpr,t));case 11:return d.compare(0,this.propertyExpr,d.nullConstant());case 12:return d.not(d.compare(0,this.propertyExpr,d.nullConstant()));case 5:return d.contains(this.propertyExpr,t);case 6:return d.not(d.contains(this.propertyExpr,t));case 7:return d.startsWith(this.propertyExpr,t);case 8:return d.not(d.startsWith(this.propertyExpr,t));case 3:return d.compare(1,this.propertyExpr,t);case 4:return d.compare(2,this.propertyExpr,t);case 1:return d.compare(3,this.propertyExpr,t);case 2:return d.compare(4,this.propertyExpr,t)}},t.prototype.getValueExpr=function(t){var i=this.dataType;if(t.value){var r=t.value.stringValue;if((i.integer||i.numeric)&&r){var o=e.formattingService.parseFloat(r);if(isNaN(o))return;return r.match(y)&&(o/=100),2===i.primitiveType?d.decimal(o):d.double(o)}if(i.text&&r)return d.text(r);if(i.dateTime){var n=t.value.dateValue;if(n)return d.dateSpan(5,d.dateTime(n))}}},t})()})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this._contract=e,this._state=t}return Object.defineProperty(e.prototype,"contract",{get:function(){return this._contract},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readOnlyState",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.updateViewState=function(){this.updateViewStateCore(this._state)},e.prototype.updateViewStateCore=function(e){},e})();e.ViewModel=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.explore.constants.ExploreCanvasConstants.CanvasGutterSize,o=e.common.utils.ColorUtility,n=e.visuals.ColorHelper,a=jsCommon.CssConstants.createClassAndSelector,s=jsCommon.CssConstants,l=e.data.DataViewObjectDefinitions,c=e.explore.constants.ExploreCanvasConstants,u=e.explore.services,p=e.visualHost.ResourcePackageReferenceResolver,d=e.explore.contracts.SectionAlignmentOption;!(function(t){function i(e,i,r,o,n,a){null!=e.canvasOptions.overrideSectionAlignment&&(a=e.canvasOptions.overrideSectionAlignment);var l=i.get(0).getBoundingClientRect(),u=y(i,U),p=u.get(0).getBoundingClientRect(),d=i.find(".displayAreaViewport").get(0).getBoundingClientRect();if(l.width>d.width){var g=l.width-d.width;null!=t.scrollWidth&&Math.abs(t.scrollWidth-g)>.01&&jsCommon.Trace.error("Multiple scroll bar widths detected, "+t.scrollWidth+" -> "+g),t.scrollWidth=g}n.getConfig().displayOptions.preserveScrollPositionOnResize||i.scrollTop(0).scrollLeft(0);var f=2*c.CanvasGutterSize,m=l.width-f,b=l.height-f,x=v(e,m,o),E=i.find(t.DisplayAreaNameSelector.selector);x.height<=b?(e.canvasViewStyle=2,i.css(s.overflowXProperty,s.hiddenValue).css(s.overflowYProperty,s.hiddenValue),C(E,d,x,a,!0)):(f=3*c.CanvasGutterSize/2+(t.scrollWidth||8),m=l.width-f,x=v(e,m,o),e.canvasViewStyle=1,i.css(s.overflowXProperty,s.hiddenValue).css(s.overflowYProperty,s.scrollValue),w(E));var F=m/e.viewModel.width,V=0,M=h(p,e.viewModel.width,e.viewModel.height,e.canvasOptions.scrollbarOffset,V);r.setDisplayAreaScaleFactor(F),r.setWallpaperScaleFactor(M),P(e,x.width,x.height),E.attr("class",t.DisplayAreaNameSelector.class+" "+O(e)),S(E,x)}function h(e,t,i,r,o,n,a){if(0===o){return(e.width-r)/t}var s=i;if(n&&a){s=n.getConfig().displayOptions.hideTileMenu?e.height:e.height-a}return s/i}function v(e,t,i){var r=t/e.viewModel.width,o=t,n=e.viewModel.height*r+i;if(e.adjustScaleForLayout){var a=e.adjustScaleForLayout({x:r,y:r});if(a.x!==r||a.y!==r){var s=Math.min(a.x,a.y),l=s/r;o*=l,n=(n-i)*l+i,r=s}}return{width:o,height:n}}function g(e,i,r,o,n,a){null!=e.canvasOptions.overrideSectionAlignment&&(a=e.canvasOptions.overrideSectionAlignment);var l=y(i,U),c=l.get(0).getBoundingClientRect(),u=e.outerViewport.width/e.viewModel.width,p=f(e,o,n),d=Math.min(u,p),v=d===u?0:1,g=h(c,e.viewModel.width,e.viewModel.height,e.canvasOptions.scrollbarOffset,v,o,n);if(e.adjustScaleForLayout){var m=e.adjustScaleForLayout({x:d,y:d});m.x===d&&m.y===d||(d=Math.min(m.x,m.y))}r.setDisplayAreaScaleFactor(d),r.setWallpaperScaleFactor(g),i.scrollTop(0).scrollLeft(0);var w=e.viewModel.width*d,b=e.viewModel.height*d+n;e.canvasViewStyle=0,e.canvasViewStyle|=4,i.css(s.overflowXProperty,s.hiddenValue).css(s.overflowYProperty,s.hiddenValue),P(e,w,b);var x=i.find(t.DisplayAreaNameSelector.selector);x.attr("class",t.DisplayAreaNameSelector.class+" "+O(e));var E={width:w,height:b};S(x,E),C(x,e.outerViewport,E,a,!1)}function f(e,t,i){var r=t.getConfig(),o=r.displayOptions.hideTileMenu?e.outerViewport.height:e.outerViewport.height-i;return o-=L(e,t),o/e.viewModel.height}function y(e,t){if(e)return e.hasClass(t.class)?e:y(e.parent(),t)}function m(e,t,i){var r=e.viewModel&&e.viewModel.contract&&e.viewModel.contract.evaluatedObjects&&e.viewModel.contract.evaluatedObjects.displayArea&&e.viewModel.contract.evaluatedObjects.displayArea.verticalAlignment&&e.viewModel.contract.evaluatedObjects.displayArea.verticalAlignment.toString();if(r)return d[r];var o=i.getCurrentExploration(),n=o&&o.evaluatedObjects&&o.evaluatedObjects.section&&o.evaluatedObjects.section.verticalAlignment&&o.evaluatedObjects.section.verticalAlignment.toString();return n?d[n]:void 0}function C(e,t,i,o,n){var a=null!=t.height&&null!=i.height?(t.height-i.height)/2:void 0,s=null!=t.width&&null!=i.width?(t.width-i.width)/2:void 0,l={position:"absolute",left:null!=s?s+"px":""};switch(o){case d.Top:var c=n?r:0;_.extend(l,{top:null!=a?c+"px":""});break;case d.Middle:default:_.extend(l,{top:null!=a?a+"px":""})}e.css(l)}function S(e,t){e.css({height:t.height+"px",width:t.width+"px"})}function w(e){e.css({position:"",top:"",left:""})}function b(e){e.css({height:"",width:""})}function x(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector);w(n),b(n),e.canvasViewStyle=8,r.setDisplayAreaScaleFactor(1),r.setWallpaperScaleFactor(1),P(e,e.outerViewport.width,e.outerViewport.height),i.css(s.overflowXProperty,s.hiddenValue).css(s.overflowYProperty,s.hiddenValue),n.attr("class",t.DisplayAreaNameSelector.class+" "+O(e))}function E(e,i,r){var o=t.getAutoLayoutVisualVCHeader(i,r),n=e.size;return{height:n.height+o,width:n.width}}function F(e,i,r,o,n,a,l){void 0===l&&(l=1),null!=e.canvasOptions.overrideSectionAlignment&&(a=e.canvasOptions.overrideSectionAlignment);var u=i.find(t.DisplayAreaNameSelector.selector),p=e.isCanvasBackdropVisible();e.canvasViewStyle=0;var d=e.viewModel.width*l,h=e.viewModel.height*l+n,v={width:p?c.PhoneAuthoringViewportWidth:d,height:p?c.PhoneAuthoringViewportHeight:h};v.width>e.outerViewport.width?(e.canvasViewStyle|=512,i.css(s.overflowXProperty,s.autoValue)):(e.canvasViewStyle|=256,i.css(s.overflowXProperty,s.hiddenValue)),v.height>e.outerViewport.height?(e.canvasViewStyle|=128,i.css(s.overflowYProperty,s.autoValue)):(e.canvasViewStyle|=64,i.css(s.overflowYProperty,s.hiddenValue));var g=e.canvasViewStyle,f={width:256&g?v.width:void 0,height:64&g?v.height:void 0};C(u,e.outerViewport,f,a,!0),256&g&&64&g?e.canvasViewStyle|=32:e.canvasViewStyle|=16,S(u,v),o.setDisplayAreaScaleFactor(l),o.setWallpaperScaleFactor(l),P(e,d,h);var y=O(e);u.attr("class",t.DisplayAreaNameSelector.class+" "+y),p&&r.attr("class",G.class+" "+y)}function V(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector);e.canvasViewStyle=0,e.canvasViewStyle|=512,e.canvasViewStyle|=128,e.canvasViewStyle|=16,e.viewModel.width>=e.outerViewport.width?i.css(s.overflowXProperty,s.autoValue):i.css(s.overflowXProperty,s.hiddenValue),e.viewModel.height>=e.outerViewport.height?i.css(s.overflowYProperty,s.autoValue):i.css(s.overflowYProperty,s.hiddenValue),r.setDisplayAreaScaleFactor(1),r.setWallpaperScaleFactor(1);var a=e.viewModel.width,l=e.viewModel.height+o;n.css({width:a+"px",height:l+"px"}),P(e,a,l),n.attr("class",t.DisplayAreaNameSelector.class+" "+O(e))}function P(e,t,i){var r={width:t,height:i};r.width>0&&r.height>0&&(e.size=r)}function M(t,i,r,n,a,s,u,p,d,h,v,g){var f,y,m,C,S,w=h.getConfig(),b=w.displayOptions.hideOutspaceFormatting,x=1===h.getMode()&&!i.isCanvasBackdropVisible();switch(t){case 1:m=i.outspace=i.outspace||{},y="outspace",f=i.outspaceBackground,C=c.getDefaultCanvasOutspace(),S=d.getCurrentLayoutCapabilities().canShowCanvasOutspace();break;case 2:m=i.background=i.background||{},y="background",f=i.canvasBackground,C=c.getDefaultCanvasBackground(),S=d.getCurrentLayoutCapabilities().canShowCanvasBackground();break;default:debug.assertNever(t)}if(S){var E=n&&n[y];i.hasPopOut?(m.color=c.DefaultCanvasBackgroundColor,m.transparency=0,m.image=null):E?(m.color=e.DataViewObject.getFillColorByPropertyName(E,"color",c.DefaultCanvasBackgroundColor),m.transparency=e.DataViewObject.getValue(E,"transparency",c.DefaultCanvasBackgroundTransparency),m.image=E.image):T(m,C);var F=m.image,V=i.viewModel.contract.objects,P=l.getObjectDefinition(V,y,null),M=P&&P.properties.image;M&&e.data.SQExpr.isResourcePackageItem(M.url)?A(i,f,m,F,M.url,P,s,u,p,g,x,v,b,t):D(f,m,F,F?F.url:"",i.hasPopOut,g,x,v,b,t)}else T(m,C),D(f,C,null,"",i.hasPopOut,g,x,v,b,t);2===t&&(h&&w.displayOptions.extendBackgroundToWholeCanvas?r.css({"background-color":o.hexToRGBString(m.color,(100-m.transparency)/100)}):r.css({"background-color":""}))}function T(e,t){e.color=t.color,e.image=t.image,e.transparency=t.transparency}function D(t,i,r,a,s,l,c,u,p,d){void 0===p&&(p=!1),void 0===d&&(d=null);var h=r&&r.scaling,v=s?1:(100-i.transparency)/100;if(t.imageFitClass=h,t.imageSource=r&&a,t.imageStyle=h===e.visuals.imageScalingType.normal?{transform:"scale("+l.getWallpaperScaleFactor()+")"}:{},t.backgroundStyle||(t.backgroundStyle={}),
t.backgroundStyle.opacity=v,t.backgroundStyle["background-color"]=p&&1===d?"transparent":o.hexToRGBString(i.color),2===d){var g=n.getThemeColor(u,"foregroundNeutralSecondary");t.displayAreaStyle||(t.displayAreaStyle={}),t.displayAreaStyle["box-shadow"]=p?"0 0 0":"0 0 10px rgba(200,200,200,"+v+")",t.displayAreaStyle.outline=c&&v<=.5?"2px dotted "+g:"none",t.imageStyle=h===e.visuals.imageScalingType.normal?{transform:"scale("+l.getDisplayAreaScaleFactor()+")"}:{}}}function A(t,i,r,o,n,a,s,l,c,u,d,h,v,g){void 0===v&&(v=!1);var f=l.getCurrentExploration();if(f){var y=t.viewModel.contract;p.loadAndResolveFromSQExpr(n,f.resourcePackages,s,c).then((function(s){var l=a.properties.image;y===t.viewModel.contract&&l&&e.data.SQExpr.equals(l.url,n)&&D(i,r,o,s.value||"",t.hasPopOut,u,d,h,v,g)}))}}function I(e,t,i){if(t&&t.outspace&&!e.isCanvasBackdropVisible())e.canvasBackground.displayAreaStyle&&delete e.canvasBackground.displayAreaStyle["background-color"];else{e.canvasBackground.displayAreaStyle||(e.canvasBackground.displayAreaStyle={});var r=n.getThemeColor(i,"background");e.canvasBackground.displayAreaStyle["background-color"]=r}}function O(e){var t="";return e.useResponsiveLayout&&(t+=" responsive"),e.disableAnimations&&(t+=" disableAnimations"),8===(8&e.canvasViewStyle)&&(t+=" fitToScreen"),4===(4&e.canvasViewStyle)&&(t+=" fitToPage"),1===(1&e.canvasViewStyle)&&(t+=" fitToWidthOrigin"),2===(2&e.canvasViewStyle)&&(t+=" fitToWidthCentered"),256===(256&e.canvasViewStyle)&&(t+=" actualSizeAlignCenter"),512===(512&e.canvasViewStyle)&&(t+=" actualSizeAlignLeft"),64===(64&e.canvasViewStyle)&&(t+=" actualSizeAlignMiddle"),128===(128&e.canvasViewStyle)&&(t+=" actualSizeAlignTop"),32===(32&e.canvasViewStyle)&&(t+=" actualSizeCentered"),16===(16&e.canvasViewStyle)&&(t+=" actualSizeOrigin"),t.trim()}function N(e,t){return t&&t.getCapabilities().visualContainerOptions.useStylableHeader?0:e&&e.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()?0:c.AutoLayoutVisualVCHeader}function L(e,t){if(1===t.getMode()){var i=e.background&&e.background.transparency;if(i&&i>=c.DisplayAreaTransparencyOutlineThreshold)return c.DisplayAreaOutlineSize}return 0}function k(e,r,o,n,a){if(e.viewModel&&e.viewModel.contract){var s=r.find(t.DisplayAreaContainerNameSelector.selector),l=y(r,U).find(G.selector),c=o.canvasScale.getDisplayOption(),p=N(o.formFactor,o.explorationCapabilities);switch(c){case 2:i(e,s,o.canvasScale,p,o.viewModeState,n);break;case 1:g(e,s,o.canvasScale,o.viewModeState,p,n);break;case 3:F(e,s,l,o.canvasScale,p,n,a);break;case 4:V(e,s,o.canvasScale,p);break;case 0:x(e,s,o.canvasScale,p);break;default:x(e,s,o.canvasScale,p)}o.eventBridge.publishToChannel(u.events.CanvasResized)}}function R(e,t){j=e.css(s.overflowXProperty),X=e.css(s.overflowYProperty),e.css(s.overflowXProperty,t),e.css(s.overflowYProperty,t)}function B(e){e.css(s.overflowXProperty,j),e.css(s.overflowYProperty,X)}function z(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function $(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function H(e){return!1}t.DisplayAreaNameSelector=a("displayArea"),t.DisplayAreaContainerNameSelector=a("displayAreaContainer"),t.VisualContainerHostSelector=a("visualContainerHost"),t.OutspaceContainerSelector=a("outspaceContainer"),t.OutspaceImageSelector=a("outspaceImage"),t.VisualBackgroundContainerSelector=a("visualBackgroundContainer"),t.VisualBackgroundImageSelector=a("visualBackgroundImage"),t.DefaultVisualPosition={x:100,y:100,width:300,height:300};var G=a("canvasBackdrop"),U=a("exploreCanvas"),j="",X="";t.fitToWidth=i,t.fitToPage=g,t.getFitToPageScaleY=f,t.getVerticalAlignmentSetting=m,t.fitToScreen=x,t.getCanvasActualSize=E,t.displayInActualSize=F,t.displayInActualSizeTopLeft=V,t.updateCanvasSize=P,t.updateAndApplyBackground=M,t.setDisplayAreaBackground=I,t.convertDisplayOptionToStyle=O,t.getAutoLayoutVisualVCHeader=N,t.getCanvasOutlineSize=L,t.applyFitOption=k,t.storeOverflowValuesAndChange=R,t.restoreOverflowValues=B,t.visualPositionToRect=z,t.rectToVisualPosition=$,t.isCortanaPageSize=H})(i=t.CanvasDisplayUtility||(t.CanvasDisplayUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions,n=e.data.DataViewObjectDefinitions,a=e.data.DataViewTransform,s=e.explore.contracts.FilterType,l=e.explore.services.selectionUtils,c=e.explore.services.StaticResourceReferences,u=e.explore.util.VisualContainerUtils;!(function(r){function p(e,t){var i=l.getSelectedCanvasItems(t);return h(e.visualContainerGroups,i)}function d(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.contract===t)return o}}function h(e,i){for(var r={},o=0,n=i;o<n.length;o++){r[n[o].name]=!0}var a=[];t.viewModels.traverseVisualContainerGroups(e,(function(e){r[e.name]&&a.push(e)}));var s=function(e){return _.findIndex(i,(function(t){return t.name===e.name}))};return a.sort((function(e,t){return s(e)-s(t)})),a}function v(i,r){for(var o=0,n=i;o<n.length;o++){var a=n[o],s=e.ItemGroupingManager.find(a.name,r);s&&t.viewModels.isVisualContainerGroup(a)&&t.contracts.isVisualContainerGroup(s)&&(a.contract!==s&&(a.contract=s),v(a.children,s.children))}}function g(e,t){if(t.parentGroup)for(var i=t.parentGroup;i;){var r=i.position;e.left+=r.x,e.top+=r.y,i=i.parentGroup}return e}function f(e){var t=0;if(_.isEmpty(e))return t;if(e[0].parentGroup)for(var i=e[0].parentGroup;i;)t++,i=i.parentGroup;return y(e,t)}function y(e,i){i++;for(var r=i,o=0,n=e;o<n.length;o++){var a=n[o];t.contracts.isVisualContainerGroup(a)&&(r=Math.max(y(a.children,i),r))}return r}function m(e,t,r,o,n){o.hideAllDropdowns(),i.EventBubblingUtility.markAsHandled(e);var a=jsCommon.BrowserUtils.isCtrlOrMeta(e),s=l.isCanvasItemSelected(t.contract,r);if(a&&s&&l.getSelectedCanvasItems(r).length>1)return void l.unselectCanvasItem(t.contract,r);if(!n){var c=S(t);return c.parentGroup&&c.parentGroup.isSelected&&l.unselectCanvasItem(c.parentGroup.contract,r),void l.selectCanvasItem(c.contract,r,a)}l.selectCanvasItem(t.contract,r,a)}function C(e,t,i){if(e.parentGroup)if(t){var r=S(e);r!==e&&u.notifyContainerHoverEvent(t,r.name,i)}else for(var o=e.parentGroup;o;)u.notifyContainerHoverEvent(t,o.name,i),o=o.parentGroup}function S(e,t){void 0===t&&(t=!1);for(var i=e.parentGroup,r=e;i;){if(i.isSelected||i.isChildSelected){t&&i.isSelected&&(r=i);break}r=i,i=i.parentGroup}return r}function w(e,t,i,r){l.isCanvasItemSelected(e.contract,i)||l.selectCanvasItem(e.contract,i);var o={data:void 0,position:t};r.createMenu(e.contract,o,void 0,void 0,!1)}function b(e,i,r,o){void 0===o&&(o=!0);var n=[];return M(i.getSelectedElements(),o,(function(i){if(t.contracts.isVisualContainerGroup(i))n.push(e.serializeVisualContainerGroup(i));else{var o=x(i,r);n.push(e.serializeVisualContainer(o))}})),n}function x(e,t){return e.filters?E(e,new i.VariationToHierarchyRewriter(t)):e}function E(t,i){var r=o.rewriteArray(t.filters,(function(e){return V(e,i)}));return r!==t.filters?e.Prototype.inherit(t,(function(e){return e.filters=r})):t}function F(e,t,i,r,o,s){var l=e.objects,c=o.getVisualObjects(r,i,void 0,t);c&&(l=n.clone(l||{}),n.extend(l,c));var u=o.getVisualStyle(r),p=a.evaluateMetadataOnceDataViewObjectDefinitions(l,t,u,s.featureSwitches);e.evaluatedObjects=p.dataViewObjects}function V(t,i){var r=t.filter;if((t.type===s.Include||t.type===s.Exclude)&&r){var o=r.rewrite(i);if(o!==r)return e.Prototype.inherit(t,(function(e){return e.filter=o}))}return t}function P(e,i,r){void 0===r&&(r=!0);var o={},n=function(e){if(t.contracts.isVisualContainer(e)){var r=e.config.singleVisual.objects;c.addObjectsReferences(r,void 0,i,o)}};return M(e.getSelectedElements(),r,(function(e){return n(e)})),o}function M(e,i,r){if(!_.isEmpty(e)){for(var o=i&&[],n=0,a=e;n<a.length;n++){var s=a[n],l=s.canvasItem;l&&(i&&t.contracts.isVisualContainerGroup(l)?o.push(l):r(l))}i&&!_.isEmpty(o)&&t.contracts.traverseVisualContainerGroups(o,(function(e){return r(e)}))}}function T(e,t,i){e=Math.max(0,e-t/2);var r=e+t-i;return r>0&&(e-=r),e}function D(e,t,i,r,o,n,a,s,l){return _.first(A([e],t,i,r,o,n,a,s,l))}function A(i,r,n,a,s,l,c,p,d){var h,v;if(i){var g={},f=!!l,y=n.size,m=d?n.visualContainerGroups:n.visualContainers,C=[],S=s.getCurrentLayout();t.contracts.traverseVisualContainerGroups(m,(function(e){if(g[e.name]=!0,null==e.parentGroup){var t=e.layouts.withId(S),i=t.position;C.push(i)}}));var w=a.deserializeCanvasItems(i,!0,d,(function(){var e=u.nextUniqueName(g);return g[e]=!0,e}));if(w){var b=w.visualContainerGroups,x=w.visualContainers,E=$(m,S),F=H(n.visualContainers,S),V=o.createWithId(),P=[],M=function(e){var i=null!=e.parentGroup,a=e.layouts.withId(S),s=a.position;if(i&&d||(s.z=E++,P.push(e)),null!=s.tabOrder&&t.contracts.isVisualContainer(e)){var l=s.tabOrder>=0;s.tabOrder=l?F.pos++:F.neg--}if(!i){for(;2!==I(s,y)&&L(s,C);)s.x+=10,s.y+=10;C.push(s)}if(e.layouts=o.extendWithId([a]),f&&t.contracts.isVisualContainer(e)){var c=t.viewModels.ViewModelFactory.convertVisualContainer(r,n,e,S);V.push(c)}};if(d)t.contracts.traverseVisualContainerGroups(b,(function(e){return M(e)}));else for(var T=0,D=x;T<D.length;T++){var A=D[T];M(A)}if((h=n.visualContainers).push.apply(h,x),f&&(v=l.visualContainers).push.apply(v,V),d){if(n.visualContainerGroups=e.ItemGroupingManager.add.apply(e.ItemGroupingManager,[n.visualContainerGroups].concat(b)),f){var _=t.viewModels.ViewModelFactory.convertVisualContainerGroups(b,V,S);l.visualContainerGroups=e.ItemGroupingManager.add.apply(e.ItemGroupingManager,[l.visualContainerGroups].concat(_))}}else n.visualContainerGroups=e.ItemGroupingManager.add.apply(e.ItemGroupingManager,[n.visualContainerGroups].concat(x)),f&&(l.visualContainerGroups=e.ItemGroupingManager.add.apply(e.ItemGroupingManager,[l.visualContainerGroups].concat(V)));if(c&&t.services.selectionUtils.selectCanvasItems(P,c,!0),p)for(var O=0,N=P;O<N.length;O++){var k=N[O];t.contracts.isVisualContainer(k)&&p.applyFilterOutput(k)}return P}}}function I(e,t){var i=t.width||0,r=t.height||0,o=0;return e.x+e.width>i&&(e.x=Math.max(i-e.width,0),o++),e.y+e.height>r&&(e.y=Math.max(r-e.height,0),o++),o}function O(t,i,r,o,n){return __awaiter(this,void 0,e.Promise,(function(){var a;return __generator(this,(function(s){switch(s.label){case 0:return t.expr?[3,1]:(a=o.addEmptyVisualContainer(i,t.visualType,t.position),[3,3]);case 1:return[4,o.addVisualContainer({expr:t.expr,visualType:t.visualType,targetRole:t.targetRole,dataSources:r,allowAggregate:!0},i)];case 2:a=s.sent(),s.label=3;case 3:return n.logEvent(e.telemetry.EXCreateVisual,N(t.telemetrySource),u.getVisualType(a),a.name),[2,a]}}))}))}function N(e){switch(e){case 0:return"CheckboxTickedInFieldList";case 3:return"DraggedToFieldWell";case 1:return"DraggedToCanvas";case 2:return"VisualTypeIconClicked";case 4:return"InsertVisualButton";case 5:return"WhatIfParameterControl";case 8:return"QnaAppBar";case 6:return"QnaDoubleClick";case 7:return"QnaKeyboardShortcut"}}function L(e,t){return _.some(t,(function(t){return e.x===t.x&&e.y===t.y}))}function k(e,t,i){var r={x:e.x*t.x,y:e.y*t.y,z:e.z,width:e.width*t.x,height:e.height*t.y,angle:e.angle,tabOrder:e.tabOrder};if(i===!0){var o=Math.round(r.x),n=Math.round(r.y),a=Math.round(r.x+r.width),s=Math.round(r.y+r.height);r={x:o,y:n,z:r.z,width:a-o,height:s-n,angle:e.angle,tabOrder:e.tabOrder}}return r}function R(e,t){return{x:e.x/t.x,y:e.y/t.y,z:e.z,width:e.width/t.x,height:e.height/t.y,angle:e.angle,tabOrder:e.tabOrder}}function B(e,t){return{left:e.left*t.x,top:e.top*t.y,width:e.width*t.x,height:e.height*t.y}}function z(e,t){return{left:e.left/t.x,top:e.top/t.y,width:e.width/t.x,height:e.height/t.y}}function $(e,t){return _.isEmpty(e)?0:_.chain(e).map((function(e){var i=e.layouts.withId(t),r=i&&i.position;return r&&r.z||0})).max().value()+1}function H(e,t){var i=0,r=0;if(_.isEmpty(e))return{pos:i,neg:r};for(var o=0,n=e;o<n.length;o++){var a=n[o],s=a.layouts.withId(t),l=s&&s.position,c=l&&null!=l.tabOrder?l.tabOrder:void 0;null!=c&&(i=Math.max(i,c),r=Math.min(r,c))}return{pos:i+1,neg:r-1}}function G(t,i,r){if(!t||_.isEmpty(t.visualContainers))return 0;var o=i?e.explore.services.CanvasListOrderingConstants.posMinOrder:e.explore.services.CanvasListOrderingConstants.negMinOrder;return _.forEach(t.visualContainers,(function(e){var t=e.layouts.withId(r),n=t&&t.position;if(n&&n.tabOrder){var a=n.tabOrder;o=i?Math.max(o,a):Math.min(o,a)}})),o+(i?1:-1)}function U(e,t,i){for(var r=0,o=0,n=0,a=0,s=null,l=0,c=0,p=i.length;c<p;c++){l=c;var d=i[c];if(d===e){var h=d.parentGroup,v=h&&h.layouts.withId(t);h=v?h:void 0,s=u.getAbsoluteVisualContainerPosition(j(d,t),t,h);break}}if(s){i.splice(l,1);for(var g=0,f=i;g<f.length;g++){var d=f[g],h=d.parentGroup,v=h&&h.layouts.withId(t);h=v?h:void 0;var y=u.getAbsoluteVisualContainerPosition(j(d,t),t,h),m=s.x-y.x;r=r<m?m:r,m=y.y+y.height-(s.y+s.height),o=o<m?m:o,m=s.y-y.y,n=n<m?m:n,m=y.x+y.width-(s.x+s.width),a=a<m?m:a}return{top:0-(n>0?n/s.height:0),left:0-(r>0?r/s.width:0),bottom:1+(o>0?o/s.height:0),right:1+(a>0?a/s.width:0)}}}function j(e,t){var i=e.layouts.withId(t);return i&&i.position}function X(e){for(var t=l.getSelectedCanvasItems(e),i={},r=0,o=t;r<o.length;r++){var n=o[r],a=n.parentGroup?n.parentGroup.name:Q;i[a]=i[a]||[],i[a].push(n)}return i}var Q="root";r.getSelectedCanvasItemViewModels=p,r.findVisualContainerViewModel=d,r.findCanvasItemViewModels=h,r.syncCanvasItemViewModelsWithContracts=v,r.addOffsetFromGroup=g,r.getContainerGroupDepth=f,r.toggleSelectContainer=m,r.setHoverForParentGroup=C,r.getContainerToSelect=S,r.showContextMenuForGroup=w,r.serializeSelection=b,r.evaluateObjects=F,r.rewriteFilterContainer=V,r.getSelectionResources=P,r.checkBoundaryForCharts=T,r.duplicateCanvasItem=D,r.duplicateCanvasItems=A,r.addVisualContainerToCanvas=O,r.convertToScaledPosition=k,r.convertFromScaledPosition=R,r.convertToScaledRect=B,r.convertFromScaledRect=z,r.getZIndexForNewCanvasItem=$,r.getNextTabOrders=H,r.getTabOrderForNewVisual=G,r.getDragRestrictElementRect=U,r.getCanvasItemsByLevel=X})(r=i.CanvasVisualsUtility||(i.CanvasVisualsUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.SQExprBuilder;!(function(t){function i(e,i){var r=s(e.objects,i);if(!r)return t.DefaultDataBarsSettings;var n,a=r.minValue;a&&(n=a.value);var l,c=r.maxValue;return c&&(l=c.value),{minValue:n,maxValue:l,positiveColor:o(r.positiveColor),negativeColor:o(r.negativeColor),axisColor:o(r.axisColor),reverseDirection:r.reverseDirection.value,hideText:r.hideText.value}}function o(e){var t=e.solid.color;return jsCommon.Color.isHexString(t.value)?{solid:{color:t.value}}:null}function n(){return a(t.DefaultDataBarsSettings,e.ValueType.fromPrimitiveTypeAndCategory(12))}function a(t,i){var o;void 0!==t.minValue&&(o=c(t.minValue,i));var n;return void 0!==t.maxValue&&(n=c(t.maxValue,i)),{minValue:o,maxValue:n,positiveColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.positiveColor&&t.positiveColor.solid.color,"maxColor"),negativeColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.negativeColor&&t.negativeColor.solid.color,"minColor"),axisColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.axisColor&&t.axisColor.solid.color,"foreground"),reverseDirection:r.boolean(t.reverseDirection),hideText:r.boolean(t.hideText)}}function s(t,i){return e.VisualObjectRepetition.getDefinition(t,i)}function l(e,t){return void 0!==s(e,t)}function c(e,t){if(t.integer){var i=Math.round(e);return r.integer(i)}return 2===t.primitiveType?r.decimal(e):r.double(e)}t.DefaultDataBarsSettings={reverseDirection:!1,hideText:!1},t.getDataBarsSettings=i,t.createDefaultDataBarsDefinition=n,t.createDataBarsDefinition=a,t.getDefinition=s,t.isDataBarsApplied=l})(i=t.DataBarsUtil||(t.DataBarsUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Field="field",e.Filter="filter",e.Bookmark="bookmark",e.Sections="sections",e.VisualContainer="visualContainer",e.VisualContainerThumbnail="visual-container-thumbnail"})(t=e.DragDropTypes||(e.DragDropTypes={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return e===t||e&&t&&e.UnitLength===t.UnitLength&&e.UnitDivisions===t.UnitDivisions}function i(t,i){var r=t/(i/e.CanvasLayout.UnitLength);return r=Math.floor(r),{UnitLength:r,UnitDivisions:_.find(n,(function(t){return 1===t||r/t>=e.MinimumUnitDivisionLength}))}}function r(e,t){return{x:o(e.x,t.width),y:o(e.y,t.height)}}function o(t,r){return i(i(t*r,r).UnitLength/e.CanvasLayout.UnitLength*r,r).UnitLength/e.CanvasLayout.UnitLength}e.CanvasLayout={UnitLength:96,UnitDivisions:12};var n=[12,6,4,3,2,1];e.MinimumUnitDivisionLength=8,e.sameLayout=t,e.getLayoutForScreen=i,e.adjustScaleForGrid=r})(t=e.DotGridUtil||(e.DotGridUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){if(!e)return!1;var t=e.displayableErrorInfo;return!_.isEmpty(t)&&(!_.isEmpty(t[0].errorInfoKey)&&!_.isEmpty(t[0].errorInfoValue))}function i(e){return e in o?o[e]:0}function r(e){return 1===i(e)}var o={BlockedCustomVisual:1,ScriptVisualsNotEnabled:1,UnapprovedCustomVisual:1,CvApiVersionNotSupported:1};e.hasAdditionalErrorInfo=t,e.getErrorOverlayType=i,e.shouldHideSeeDetails=r})(t=e.ErrorDetailsUtility||(e.ErrorDetailsUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.handled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent);var i=t.handled;return void 0!==i&&i===!0}},e.markAsHandled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent),t.handled=!0}},e})();e.EventBubblingUtility=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){return!!i.isTrustedVisual(e)&&_.some(t.sections,(function(t){return _.some(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e}))}))}function i(e,t){for(var i=[],r=0,o=e.sections;r<o.length;r++)for(var n=o[r],a=0,s=n.visualContainers;a<s.length;a++){var l=s[a],c=l.config.singleVisual.visualType;c&&t.isTrustedVisual(c)&&i.push(c)}return t.getConsentAndLoadVisuals(i)}e.explorationContainsTrustedVisual=t,e.acquireTrustedVisuals=i})(t=e.ExplorationTrustedVisualUtil||(e.ExplorationTrustedVisualUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return!e||!e.exploration}function i(e){return!e||!e.isReportAnnotationsDisabled}e.isIntermediateState=t,e.isReportAnnotationsEnabled=i})(t=e.ExplorationUtil||(e.ExplorationUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.contracts.FilterType,n=e.explore.services.FormatPainter,a=jsCommon.JsonExtensions,s=e.common.dialog.MessageDialogBuilder,l=e.data.services.SemanticQuerySerializer;!(function(r){function c(r,o,a,l,c,p,d,h,v,g,f,y,m,C,S){function w(e,t){return _.find(e,(function(e){return e.name===t}))}function b(e,t){return _.find(e,(function(e){return e.name===t}))}function x(e){for(var t=0,i=e;t<i.length;t++){i[t].config.singleVisual.syncGroup=null}}function E(e){return _.filter(e,(function(e){return t.contracts.isVisualContainer(e)&&e.config.singleVisual.syncGroup}))}function F(e,i,n){var a=[],s=b(r.exploration.contract.sections,e);if(!s)return a;for(var l=0;l<n.length;l++){var c=n[l];if(t.contracts.isVisualContainer(c)){var u=v.capabilities(c.config.singleVisual.visualType);if(u&&u.supportsSynchronizingFilterState&&c.config.singleVisual.query&&!c.config.singleVisual.syncGroup){var p=w(s.visualContainers,o.deserializeCanvasItem(i[l]).name);p&&a.push({sourceVisual:p,newVisual:c})}}}return a}function V(){for(var e={},t=r.exploration.contract.sections,i=0,o=t;i<o.length;i++)for(var n=o[i],a=0,s=n.visualContainers;a<s.length;a++){var l=s[a],c=l.config.singleVisual.syncGroup;c&&(e[c.groupName]=!0)}return e}function P(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,l;return __generator(this,(function(u){switch(u.label){case 0:return[4,c.get(p.get())];case 1:for(e=u.sent(),i=V(),r=0,o=t;r<o.length;r++)n=o[r],a=n.sourceVisual.config.singleVisual,s=a.syncGroup,s?n.newVisual.config.singleVisual.syncGroup=__assign({},s):(l=C.generateUniqueGroupName(e,a,i),a.syncGroup={groupName:l,fieldChanges:!0,filterChanges:!0},n.newVisual.config.singleVisual.syncGroup={groupName:l,fieldChanges:!0,filterChanges:!0},i[l]=!0);return[2]}}))}))}var M=this;return{deleteSelection:function(){r.exploration&&r.exploration.exploreCanvas&&h.deleteSelectedVisuals(r.exploration.exploreCanvas)},deserializeAndDuplicateData:function(t,n,h,v){return __awaiter(M,void 0,e.Promise,(function(){var m,C,w,b,V,M,T,D,A,I,O,N,L;return __generator(this,(function(k){switch(k.label){case 0:return r.exploration&&r.exploration.exploreCanvas?v?[3,2]:[4,c.get(p.get())]:[2];case 1:for(m=k.sent(),C=0,w=h;C<w.length;C++)b=w[C],u(b,m);k.label=2;case 2:return V=r.exploration,M=V.contract,T=V.exploreCanvas,D=M&&M.settings&&M.settings.useStylableVisualContainerHeader,A=i.CanvasVisualsUtility.duplicateCanvasItems(h,V.contract,T.contract,o,f,T,d,g,D),S?1===t?[2]:(I=E(A),n===r.exploration.exploreCanvas.contract.name?(x(I),[2]):(O=F(n,h,A),_.isEmpty(I)&&_.isEmpty(O)?[2]:(N=new s(l),[4,N.show("syncVisuals",{titleText:a.get("SyncVisualsDialog_Title"),messageText:a.get("SyncVisualsDialog_Message"),okButtonText:a.get("SyncVisualsDialog_Sync"),cancelButtonText:a.get("SyncVisualsDialog_DoNotSync")})]))):[2];case 3:return L=0===k.sent(),y.logEvent(e.telemetry.EXCopyPasteSyncGroup,L,O.length),L?[4,P(O)]:[3,5];case 4:return k.sent(),[3,6];case 5:x(I),k.label=6;case 6:return[2]}}))}))},serializeSelection:function(){return __awaiter(M,void 0,e.Promise,(function(){var e,t,r;return __generator(this,(function(n){switch(n.label){case 0:return t=(e=i.CanvasVisualsUtility).serializeSelection,r=[o,d],[4,c.get(p.get())];case 1:return[2,t.apply(e,r.concat([n.sent()]))]}}))}))},getSelectionResources:function(){return i.CanvasVisualsUtility.getSelectionResources(d,r.exploration.contract.resourcePackages)},getSelectionSectionName:function(){return r.exploration.exploreCanvas.contract.name},deserializeVisualContainer:function(e){return o.deserializeCanvasItem(e,!0)},copyCanvasItemFormat:function(){return n.copyFormatCanvasItem(d,v)},pasteCanvasItemFormat:function(e){var t=n.pasteFormatCanvasItem(d,v,e);t&&h.raiseCanvasItemChanged(t)},isReady:function(){return null!=r.exploration}}}function u(e,t){if(e.filters){for(var i=a.tryParseJSON(e.filters),r=0,n=i;r<n.length;r++){var s=n[r];if(s.type===o[o.Categorical]&&null!=s.filter){var l=p(s.expression,t);l&&(s.filter.From[0].Entity=l)}}e.filters=JSON.stringify(i)}}function p(e,t){var i=e&&e.HierarchyLevel,r=i&&i.Expression&&i.Expression.Hierarchy,o=r&&r.Expression&&r.Expression.PropertyVariationSource;if(o){var n=l.deserializeExpr(o.Expression),a=n.getTargetEntity();return d(t,a&&a.entity,o.Property,o.Name)}}function d(e,t,i,r){for(var o=0,n=e.schemas;o<n.length;o++)for(var a=n[o],s=0,l=a.entities;s<l.length;s++){var c=l[s];if(c.name===t)for(var u=0,p=c.properties;u<p.length;u++){var d=p[u];if(d.name===i){var h=d.column;if(h&&h.variations)for(var v=0,g=h.variations;v<g.length;v++){var f=g[v];if(f.name===r)return f.navigationProperty.targetEntity.name}}}}}r.createClipboardHandler=c})(r=i.ExploreClipboardHandlerUtility||(i.ExploreClipboardHandlerUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(){}return t.getDefaultVisualPlugin=function(t){return t&&t.featureSwitches&&t.featureSwitches.pivotTableVisualEnabled?e.visuals.plugins.tableEx:e.visuals.plugins.table},t})();t.FieldWellUtility=i})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.filterController=e}return e.prototype.setDirty=function(){this.filterController.filterForm.$setDirty()},e.prototype.setPristine=function(){this.filterController.filterForm.$setPristine()},e.prototype.isDirty=function(){return this.filterController.filterForm.$dirty},e.prototype.isValid=function(){return this.filterController.filterForm.$valid},e})();e.AngularJSForm=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i=[];if(!e||!t)return i;for(var r=0,o=e;r<o.length;r++){var n=o[r];i.push(t(n))}return i}function i(){return{type:1}}e.getMenuItems=t,e.createSeparator=i})(t=e.MenuItemUtility||(e.MenuItemUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.util.CanvasDisplayUtility,n=t.constants.ExploreCanvasConstants;!(function(i){function r(t){for(var i=[],r=0,o=t;r<o.length;r++){var n=o[r];i.push({value:n.value.toString(),displayName:e.explore.viewModels.ViewModelFactory.getDisplayName(n.displayName)})}return i}function a(t){void 0===t&&(t=!1);for(var i=e.visuals.valueFormatter.getDisplayUnits(t),r=[],o=0,n=i;o<n.length;o++){var a=n[o];r.push({displayName:a.title,value:a.value.toString()})}return r}function s(e,t){return l(e,t.getCurrentExploration(),t.getCurrentSection())}function l(e,r,a){if(0===e.displayOption)return i.PageSizeTypes.Dynamic;if(e.width===t.constants.ExploreCanvasConstants.DefaultCanvasWidth&&e.height===n.DefaultCanvasHeight)return i.PageSizeTypes.Standard;if(e.width===t.constants.ExploreCanvasConstants.DefaultWidescreenWidth&&e.height===n.DefaultWidescreenHeight)return i.PageSizeTypes.Widescreen;if(o.isCortanaPageSize(e)){var s=t.PodUtils.findPodIndexForSectionName(r,a.name);return s!==-1&&r.pods[s].cortanaEnabled?i.PageSizeTypes.Cortana:i.PageSizeTypes.Custom}return e.width===t.constants.ExploreCanvasConstants.DefaultLetterWidth&&e.height===n.DefaultLetterHeight?i.PageSizeTypes.Letter:u(e)?i.PageSizeTypes.Tooltip:i.PageSizeTypes.Custom}function c(e){return i.PageSizeTypesToSectionSize[e]}function u(e){return e.width===t.constants.ExploreCanvasConstants.DefaultTooltipWidth&&e.height===t.constants.ExploreCanvasConstants.DefaultTooltipHeight}var p;i.PageSizeTypes={Dynamic:"Dynamic",Standard:"Standard",Widescreen:"Widescreen",Cortana:"Cortana",Letter:"Letter",Tooltip:"Tooltip",Custom:"Custom"},i.PageSizeTypesToSectionSize=(p={},p[i.PageSizeTypes.Dynamic]={displayOption:0,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},p[i.PageSizeTypes.Standard]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},p[i.PageSizeTypes.Widescreen]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultWidescreenWidth,height:t.constants.ExploreCanvasConstants.DefaultWidescreenHeight},p[i.PageSizeTypes.Cortana]={displayOption:3,width:t.constants.ExploreCanvasConstants.DefaultCortanaWidth,height:t.constants.ExploreCanvasConstants.DefaultCortanaHeight},p[i.PageSizeTypes.Letter]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultLetterWidth,height:t.constants.ExploreCanvasConstants.DefaultLetterHeight},p[i.PageSizeTypes.Tooltip]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultTooltipWidth,height:t.constants.ExploreCanvasConstants.DefaultTooltipHeight},p[i.PageSizeTypes.Custom]={displayOption:3,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},p),i.getDisplayNames=r,i.getDisplayUnits=a,i.getPageSizeType=s,i.getPageSizeTypeBySection=l,i.getDefaultSectionSize=c})(r=i.PropertyPaneUtils||(i.PropertyPaneUtils={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.container=e,this.context={pendingGeocodingCount:0}}return e.prototype.newQuery=function(e){var t=0!==this.context.pendingGeocodingCount,i=this.context.geocodingActivity;this.context={pendingGeocodingCount:0,rootActivity:e},t&&(i&&i.reject(),this.container.onStopGeocoding())},e.prototype.hasPendingGeocoding=function(){return this.context.pendingGeocodingCount>0},e.prototype.wrapGeocoder=function(e){return{geocode:this.wrapAsyncGeocoderMethod(e,e.geocode),geocodeBoundary:this.wrapAsyncGeocoderMethod(e,e.geocodeBoundary),geocodePoint:this.wrapAsyncGeocoderMethod(e,e.geocodePoint),tryGeocodeImmediate:function(t){return e.tryGeocodeImmediate(t)},tryGeocodeBoundaryImmediate:function(t,i,r,o,n,a){return e.tryGeocodeBoundaryImmediate(t,i,r,o,n,a)}}},e.prototype.wrapAsyncGeocoderMethod=function(e,t){var i=this;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var n=i.context,a=t.apply(e,r);1===++n.pendingGeocodingCount&&(i.context.rootActivity&&(i.context.geocodingActivity=i.context.rootActivity.createChildActivity("Geocoding")),i.container.onStartGeocoding());var s=function(){n===i.context&&--n.pendingGeocodingCount<=0&&(i.context.geocodingActivity&&i.context.geocodingActivity.resolve(),i.container.onStopGeocoding())};return a.then(s,s),a}},e})();e.QueryGeocodingTracker=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){return e?i.get(e):t.reject()}function i(e,t){Object.defineProperty(e,"dataSources",{get:function(){return t.get()},set:function(e){return t.set(e)}})}e.getSchemaPromise=t,e.defineDataSourcesOnScopeLegacy=i})(t=e.ScopeUtils||(e.ScopeUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b){return new ee(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b)}function o(e,t,i){_.forEach(i,(function(i){if(!t||!t.isUsed(i)){var r=e.config.singleVisual.objects;_.forEach(r,(function(e,t){var o=[];_.forEach(e,(function(e){e.selector&&e.selector.metadata===i&&o.push(e.selector)})),_.forEach(o,(function(e){b.deleteObjectDefinition(r,t,e)}))}))}}))}function n(e,t){var i=[],r=e;if(r.role&&null!==r.index)for(var o=r.count||1,n=0;n<o;n++){var a=t.getQueryRef(r.role,r.index+n);i.push(a)}else{var s=e;if(s.expr){var l=y.ensureArray(s.expr),c=t.defn.select();_.forEach(l,(function(e){var t=_.filter(c,(function(t){var i=t.expr;return R.isAggregation(i)&&(i=i.arg),R.equals(i,e)}));_.forEach(t,(function(e){e&&e.name&&i.push(e.name)}))}))}}return i}function a(e,t,r,o){var n=e.getMetadata(t);if(n&&n.type.geography)return A.name;var a=z.asFieldPattern(e);if(r&&a){var s=a.column||a.groupingColumn,l=s&&s.name,c=a.hierarchyLevel&&a.hierarchyLevel||a.columnHierarchyLevelVariation&&a.columnHierarchyLevelVariation.level;if(c){var u=c.level;if(r.isGeographic(u))return A.name;var p=G.getConceptualHierarchyLevel(t,c.schema,c.entity,c.name,u);l=p&&p.column&&p.column.name}if(l&&r.isGeographic(l))return A.name}var d=a.column,h=d&&t.schema(d.schema).findProperty(d.entity,d.name).column;return h&&h.parameterMetadata&&1===h.defaultAggregate?k.name:i.isNumericMeasure(e,n,t)?C.name:o&&o.pivotTableVisualEnabled?Q.name:X.name}function s(t,i,r){var o=_.filter(r.filters,(function(e){return 5===e.howCreated}));t.logEvent(e.telemetry.EXDrillthroughFilterUpdate,i,o.length)}function l(e,t,i,r){if(e.config&&e.config.singleVisual){var o=e.config.singleVisual,n=r.capabilities(o.visualType);
if(i.shouldApplyDefaultSort(o,n)){var a=o.query;if(a){var s=a.defn,l=a.projections,c=s.select(),u=[],p=_.filter(n.dataRoles,(function(e){return!(_.has(e,"joinPredicate")||0===e.joinPredicate)}));if(_.some(p,(function(e){var i=I.getRole(l,e.name);if(i){var r=_.map(i.all(),(function(e){return c.withName(e.queryRef)}));return _.some(r,(function(e){return e.expr&&!_.isEmpty(e.expr.getOrderByColumns(t))}))}})))return void(o.hasDefaultSort&&(o.query=new Y(s.orderBy([]),a.projections,a.expansionStates),o.hasDefaultSort=!1));for(var d=!1,h=0,v=p;h<v.length;h++){var g=v[h],f=I.getRole(l,g.name);if(f){var y=_.map(f.all(),(function(e){return e.queryRef}));if(y){for(var m=!1,C={direction:1,expr:null},S=0,w=y;S<w.length;S++){var b=w[S],x=c.withName(b),E=x&&x.expr;if(E&&H.isExprValidForSorting(E)){var F=E.getMetadata(t);if(F){var V=1===F.kind&&F.type.numeric;if(null==C.expr&&(E&&V&&(C.direction=2),C.expr=E),F.type.temporal){m=d=!0;break}if(V){m=!0;break}}}}if(m&&(_.isEmpty(u)||d)&&(u=[C]),d)break}}}_.isEmpty(u)||(o.hasDefaultSort=!0,o.query=new Y(s.orderBy(u),a.projections,a.expansionStates))}}}}function c(e,t,i){return!!t&&(1===t.kind||t.type.numeric&&!H.discourageAggregation(e,i))}function u(e){var t;switch(e&&(t=e.kind),t){case 0:return"Entity";case 2:return"ColumnRef";case 3:return"MeasureRef";case 4:return"Aggregation";case 5:return"PropertyVariationSource";case 6:return"Hierarchy";case 7:return"HierarchyLevel";default:return"Other"}}function p(e){switch(e){case T.Advanced:return"Advanced";case T.Categorical:return"Categorical";case T.Passthrough:return"Passthrough";case T.Range:return"Range";case T.Visual:return"Visual"}}function d(e){switch(e){case 2:return"Exploration";case 1:return"Section";case 0:return"Visual"}}function h(e){switch(e){case 0:return"View";case 1:return"Edit"}}function v(e){switch(e){case 1:return"Ascending";case 2:return"Descending";case 3:return"Custom"}}var g=e.visuals.plugins.actionButton,f=e.visuals.ActionButtonType,y=jsCommon.ArrayExtensions,m=e.visuals.plugins.basicShape,C=e.visuals.plugins.clusteredColumnChart,S=e.explore.constants,w=e.data.DataBoundExprExtractor,b=e.data.DataViewObjectDefinitions,x=e.data.DataViewObjectDescriptors,E=e.data.DataViewRoleWildcard,F=e.explore.util.DrillUtils,V=t.services.events,P=e.explore.constants.ExploreCanvasConstants,M=e.data.FieldExprPattern,T=t.contracts.FilterType,D=e.explore.util.HierarchyUtils,A=e.visuals.plugins.map,I=e.data.QueryProjectionsByRole,O=e.contracts.ResourcePackageItemType,N=t.services.selectionUtils,L=e.data.SemanticFilter,k=e.visuals.plugins.slicer,R=e.data.SQExpr,B=e.data.SQExprBuilder,z=e.data.SQExprConverter,$=e.data.SQExprHierarchyToHierarchyLevelConverter,H=e.data.SQExprUtils,G=e.data.SQHierarchyExprUtils,U=e.data.SQHierarchyLevelExpr,j=e.data.SQScopedEvalExpr,X=e.visuals.plugins.table,Q=e.visuals.plugins.tableEx,W=e.visuals.TablixPropertyManager,q=e.explore.contracts.VisualContainer,K=e.explore.contracts.VisualContainerGroup,Z=e.explore.util.VisualContainerUtils,J=e.explore.contracts.VisualLink,Y=t.contracts.VisualQuery;i.createVisualAuthoringOperations=r;var ee=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x){this.visualPluginService=e,this.pluginOps=i,this.displayNameService=r,this.telemetry=o,this.explorationNavigationService=n,this.selectionService=a,this.geotaggingAnalyzerService=s,this.explorationSerializer=l,this.eventBridge=c,this.featureSwitchService=u,this.sortService=p,this.visualRelationshipService=d,this.drill=h,this.expandCollapse=v,this.filterGenerator=g,this.aggrOps=f,this.resourceRegistration=y,this.formFactorProvider=m,this.localizationService=C,this.viewModeState=S,this.linguisticSchemaProxy=w,this.explorationCapabilities=b,this.layoutAuthoring=x,this.core=t.services.createVisualAuthoringCore(e,s,f,u)}return r.prototype.addFieldToVisual=function(t,i,r,o){if(!r)return!1;var n=r.config.singleVisual,a=n.query,s=this.visualPluginService.capabilities(n.visualType),l=this.addHierarchyLevelToExistingHierarchiesInVisual(t,s,r.config,i)||this.addExpressionToVisualWithoutAggregation(t,r,s,i)||this.addExpressionToVisualForcingAggregation(t,r,s,i)||this.addExpressionToVisual(t,r,s,i),c=i.getConceptualProperty(t),p=c&&c.measure&&c.measure.template&&c.measure.template.name;return l?(this.runAddFieldValidation(r,t,i),void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,Z.getVisualType(r),u(i),Z.hasGroupByItemsInQuery(r),!0,p,r.name),!0):(r.config.singleVisual.query=a,void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,Z.getVisualType(r),u(i),Z.hasGroupByItemsInQuery(r),!1,p,r.name),!1)},r.prototype.addFieldInRole=function(t,i,r,o,n,a,s){var l=this.getVisualDataRole(o,r);if(!l)return!1;var c;this.shouldPreferGroupToAggregate(t,i,o,l)||a||(i=this.createExprWithAggregate(i,t,!0,l),c=!0);var p=this.canHierarchyLevelJoinExistingGroup(t,o.config.singleVisual.query,r,i,n),d=this.getTargetRoleAndExpressionsForAdd(t,o,i,r,s),h=c||p?i:d&&d.expressions,v={expr:h,schema:t,targetRole:r,targetIndex:n},g=i.getConceptualProperty(t),f=g&&g.measure&&g.measure.template&&g.measure.template.name;return this.core.add(v,o.config)?(this.runAddFieldValidation(o,t,i),this.telemetry.logEvent(e.telemetry.EXAddField,"DraggedToFieldWell",Z.getVisualType(o),u(i),Z.hasGroupByItemsInQuery(o),!0,f,o.name),!0):(this.telemetry.logEvent(e.telemetry.EXAddField,"DraggedToFieldWell",Z.getVisualType(o),u(i),Z.hasGroupByItemsInQuery(o),!1,f,o.name),!1)},r.prototype.runAddFieldValidation=function(e,t,i){this.ensureValidDrillMode(e),this.updateFilterState(t,e,!1,!0,!0),l(e,t,this.sortService,this.visualPluginService),Z.setQueryKeepProjectionOrder(e),this.setMatchingFilterToAuto(i,e)},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=(t.config.singleVisual.query.tryGetExprs(i)||[]).slice(r,r+o);if(_.isEmpty(n))return!1;var a=n[0];if(R.isHierarchyLevel(a)){var s=a.arg,l=G.expandExpr(e,s);if(_.isArray(l)){var c=l.length;if(o<c){for(var u=t.config.singleVisual.query,p=!1,d=0;d<c;d++)if(!R.equals(u.tryGetExpr(i,r+d),l[d])){if(!this.core.add({expr:l[d],schema:e,targetRole:i,targetIndex:r+d},t.config))break;this.setMatchingFilterToAuto(l[d],t),p=!0}return p&&this.notifyVisualContainers([t]),p}}}return!1},r.prototype.removeField=function(e,t,i){var r;r=i||N.getSelectedVisualContainers(this.selectionService);var o=G.expandExpr(t,e,!0),n=this.removeFieldImpl(e,r,t);return _.isArray(o)&&(n=this.removeFieldImpl(o,r,t)||n),n},r.prototype.removeProjection=function(e,t,i){var r=i;return!!r&&this.invokeRemoveOnSelectedVisuals(e,[r],t)},r.prototype.removeInvalidExpressions=function(e,t){var i=t.config.singleVisual;if(!i||!i.query)return!1;for(var r=[],o=i.query.defn.select(),n=0,a=o;n<a.length;n++){var s=a[n],l=s.expr;_.isEmpty(l.validate(e,this.aggrOps))||r.push(l)}for(var c=0,u=r;c<u.length;c++){var p=u[c];this.removeFiltersWithExpr(p,t)}return this.removeFieldImpl(r,[t],e),this.removeInvalidDataBoundProperty(i.vcObjects,e,o),this.removeInvalidDataBoundProperty(i.objects,e,o),!0},r.prototype.removeInvalidDataBoundProperty=function(e,t,i){function r(r){var o=function(o){var n=e[o];if(!_.isEmpty(n))for(var a=function(n){var a=n.properties,s=n.selector,l=function(n){var l=a[n],c=w.getDataBoundExprs(l,s,i);if(!_.isEmpty(c))for(var u=0,p=c;u<p.length;u++){var d=p[u];if(!_.isEmpty(d.expr.validate(t,r)))return{value:function(){b.deleteProperty(e,o,s,n)}}}};for(var c in a){var u=l(c);if("object"==typeof u)return u}},s=0,l=n;s<l.length;s++){var c=l[s],u=a(c);if("object"==typeof u)return u}};for(var n in e){var a=o(n);if("object"==typeof a)return a.value}}if(e){var o=r(this.aggrOps);o&&(o(),this.eventBridge.publishToChannel(V.visualContainerChanged,{affectContainer:function(){return!0}}))}},r.prototype.moveProjection=function(e,t,i,r,o,n,a){var s=a||N.getSelectedVisual(this.selectionService);if(!s)return!1;var c;if(t!==i){var u=this.getVisualDataRole(s,i),p=D.getHierarchyReplacementExpressions(s.config,t,r,n,u);if(_.isEmpty(p))return!1;c=p}var d={sourceRole:t,targetRole:i,sourceIndex:r,targetIndex:o,sourceCount:n,replacementExpressions:c,schema:e,allowPartialReplace:!0},h=s.config.singleVisual.query,v=F.getDrillFilterRemovalInfoList(h,d,1),g={index:r,role:t,count:n};if(this.removeAutoFilterFromContract(N.getSelectedVisual(this.selectionService),g),this.core.replace(d,s.config)){this.ensureValidDrillState(s,v),l(s,e,this.sortService,this.visualPluginService),Z.setQueryKeepProjectionOrder(s),this.updateFilterState(e,s,!0,!0,!0);var f=s.config.singleVisual.query,y=f.tryGetExpr(i,o);if(this.logReportMeasureMoveTelemetry(e,s,t,i,y),c&&c.length>0)for(var m=0,C=c;m<C.length;m++){var S=C[m];this.setMatchingFilterToAuto(S,s)}return!0}return!1},r.prototype.drillDownLevel=function(t,i,r){if(i){var o=Z.getVisualType(i),n=this.telemetry.startEvent(e.telemetry.EXInteractionExpand,o,2===r,i.name),a=i.config.singleVisual,s=_.isEmpty(t)?[]:[t];if(_.isEmpty(s)){var l=this.visualPluginService.capabilities(a.visualType);s=F.getDrillableRoles(l)}if(!_.isEmpty(s))for(var c=0,u=s;c<u.length;c++){var p=u[c];if(p){var d=this.core.changeActiveProjection(p,a,r);if(d)return 2===r&&this.expandCollapse.isEnabled(i,[p])&&this.expandCollapse.expandLevel(i,[p],d.length-2,!0),this.notifyVisualContainers([i],"UserAction_Drill"),void n.resolve()}}n.reject()}},r.prototype.replaceProjection=function(e,t,i,r,o){var n={sourceRole:i,targetRole:i,sourceIndex:r,targetIndex:r,sourceCount:1,replacementExpressions:[t],schema:e},a={index:r,role:i};return this.removeAutoFilterFromContract(N.getSelectedVisual(this.selectionService),a),!!this.core.replace(n,o.config)&&(this.ensureValidDrillMode(o),this.resetSearchProperties(o),this.updateFilterState(e,o,!1,!0,!0),this.setMatchingFilterToAuto(t,o),!0)},r.prototype.drillDown=function(t,i,o,n){var a=Z.getVisualType(o),s=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,a,!0,o.name),l=o.config.singleVisual;if(l.clearSelectedDataPoints(),_.isEmpty(i)||_.isEmpty(i[0].dataMap))return!1;o.filters||(o.filters=[]);var c=i[0].dataMap,u=l.query,p=_.isEmpty(n)?[]:[n];if(_.isEmpty(p)){var d=this.visualPluginService.capabilities(l.visualType);p=F.getDrillableRoles(d)}if(!_.isEmpty(p))for(var h=function(e){var i=u.projections[e],n=i&&i.activeProjectionRefs,a=_.filter(c,(function(e,t){return _.includes(n,t)}));if(!_.isEmpty(a)){var p=u.currentDrillMode(e)||2,d=v.core.changeActiveProjection(e,l,p);if(d){if(2===p&&v.expandCollapse.isEnabled(o,[e])){var h=_.uniq(d);v.expandCollapse.expandLevel(o,[e],h.length-2,!0)}for(var g=0,f=a;g<f.length;g++){var y=f[g];v.core.addDrillFilter(t,o.filters,u,n,r.chooseRepetitionSelectorForDrill(y))}var m=v.explorationNavigationService.getCurrentSection();return v.filterGenerator.updateCrossFilterOnDrill(m,o),v.notifyVisualContainers([o],"UserAction_Drill"),s.resolve(),{value:!0}}}},v=this,g=0,f=p;g<f.length;g++){var y=f[g],m=h(y);if("object"==typeof m)return m.value}return s.reject(),!1},r.chooseRepetitionSelectorForDrill=function(e){if(e=y.ensureArray(e),1===e.length)return e[0];for(var t,i=0,r=e;i<r.length;i++){var o=r[i];t||(t=o),o.key.length>t.key.length&&(t=o)}return t},r.prototype.drillUp=function(t,i){if(i){var r=Z.getVisualType(i),o=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,r,!1,i.name),n=i.config.singleVisual,a=n.query,s=_.isEmpty(t)?[]:[t];if(_.isEmpty(s)){var l=this.visualPluginService.capabilities(i.config.singleVisual.visualType);s=F.getDrillableRoles(l)}if(!_.isEmpty(s))for(var c=0,u=s;c<u.length;c++){var p=u[c],d=this.core.changeActiveProjection(p,n,1);if(!_.isEmpty(d)){var h=_.last(d),v=a.defn.select().withName(h).expr,g=a.currentDrillMode(p)||2;if(2===g&&this.expandCollapse.isEnabled(i,[p])){var f=_.uniq(d);this.expandCollapse.collapseLevel(i,[p],f.length-1)}var y=this.core.removeDrillFilter(i.filters,v);if(y){var m=this.explorationNavigationService.getCurrentSection();this.filterGenerator.updateCrossFilterOnDrill(m,i)}return this.notifyVisualContainers([i],"UserAction_Drill"),void o.resolve()}}o.reject()}},r.prototype.setDrillFilterOtherVisualsSetting=function(e){var t=N.getSelectedVisual(this.selectionService);t&&this.setVisualDrillFilterOtherVisualsSetting(t,e)},r.prototype.drillToDetails=function(t,i,r,o,n,a){var s=!1;if(_.some(r)&&(s=R.isAggregation(_.head(r))&&1===r.length||_.every(r,(function(e){return R.isMeasure(e)}))),s){var l=q.clone(n,this.explorationSerializer);this.addDrillToDetailsFilters(i,l,o);var c=l.config.singleVisual,p={name:t,config:{singleVisual:c},layouts:n.layouts,filters:l.filters};if(c.visualType!==e.visuals.plugins.tableEx.name){var d=this.convert(i,p,e.visuals.plugins.tableEx.name);if(!d)return}c=p.config.singleVisual;(c.vcObjects=c.vcObjects||{}).stylePreset=[{properties:{name:B.text("Default")}}];var h=c.objects={};b.setValue(h,W.PropTotalTableExTotals,void 0,B.boolean(!1));for(var v=c.query,g=0,f=r;g<f.length;g++){var y=f[g],m=y.getTargetEntity();R.isAggregation(y)?(this.removeAggregatesAndMeasures(i,p,!1),this.removeTableReferences(p),this.addDetailTableProperties(i,m,p),v.defn=v.defn.addGroupBy(m)):(this.addDetailTableProperties(i,m,p,!0,a),this.removeAggregatesAndMeasures(i,p,!0),this.removeTableReferences(p));var C=Z.getVisualType(n);this.telemetry.logEvent(e.telemetry.EXDrillToDetails,C,u(y),n.name)}return p}},r.prototype.removeAggregatesAndMeasures=function(e,t,i){for(var r=t.config.singleVisual.query,o=r.defn.select(),n=function(e){var t=e.expr;if(H.isMeasure(t)&&i===!1||R.isAggregation(t)&&i===!0){var o=r.getRoleNameForExpr(t),n=I.getRole(r.projections,o),a=_.findIndex(n.all(),(function(t){return t.queryRef===e.name}));r.removeAggregate(o,a)}R.isMeasure(t)&&i===!1&&r.removeExpr(t,!1)},a=0,s=o;a<s.length;a++){n(s[a])}},r.prototype.removeTableReferences=function(e){for(var t=e.config.singleVisual.query,i=t.defn.select(),r=0,o=i;r<o.length;r++){var n=o[r];R.isEntity(n.expr)&&t.removeExpr(n.expr,!1)}},r.prototype.addDetailTableProperties=function(e,t,i,r,o){for(var n=i.config.singleVisual.query,a=H.getConceptualEntity(t,e),s=n.defn.select(),l=0,c=s;l<c.length;l++){var u=c[l],p=u.expr,d=p.getTargetEntity();if(!_.isEqual(t,d)){var h=0;if(!H.isRelatedOneToOne(e,t,d,h)){H.isRelatedToMany(e,d,t,h)||n.removeExpr(p,!1)}}}for(var v=a.properties,g=0,f=v;g<f.length;g++){var y=f[g];if(!y.hidden&&(1!==y.kind||!o)&&(1!==y.kind&&!y.type.integer&&!y.type.numeric||r)&&(!y.type.dateTime||!y.column||_.isEmpty(y.column.variations))){var m=void 0;m=1===y.kind?B.measureRef(t,y.name):B.columnRef(t,y.name);n.defn.selectNameOf(m)||this.addFieldToVisual(e,m,i)}}},r.prototype.setAggregate=function(e,t,i,r,o){var n={role:t,index:i,newAggregate:r,schema:e},a={index:i,role:t};return this.removeAutoFilterFromContract(N.getSelectedVisual(this.selectionService),a),!!this.core.setAggregate(n,o.config)&&(l(o,e,this.sortService,this.visualPluginService),Z.setQueryKeepProjectionOrder(o),this.notifyVisualContainers([o]),!0)},r.prototype.removeAggregate=function(e,t,i,r){var o={role:t,index:i,schema:e},n={index:i,role:t};return this.removeAutoFilterFromContract(N.getSelectedVisual(this.selectionService),n),!!this.core.removeAggregate(o,r.config)&&(l(r,e,this.sortService,this.visualPluginService),Z.setQueryKeepProjectionOrder(r),this.notifyVisualContainers([r]),!0)},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.setPercentOfGrandTotal(o,r.config)&&(this.ensureValidDrillMode(r),this.notifyVisualContainers([r]),!0)},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removePercentOfGrandTotal(o,r.config)&&(this.notifyVisualContainers([r]),!0)},r.prototype.setPercentOfRoleTotal=function(e,t,i,r,o){var n={roleRefs:t,role:i,index:r,schema:e};return!!this.core.setPercentOfRoleTotal(n,o.config)&&(this.ensureValidDrillMode(o),this.notifyVisualContainers([o]),!0)},r.prototype.removePercentOfRoleTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removePercentOfRoleTotal(o,r.config)&&(this.notifyVisualContainers([r]),!0)},r.prototype.setVariation=function(e,t,i,r,o,n){if(n=n||1,o<0)return!1;for(var a=[],s=0;s<n;s++)if(a[s]=t.config.singleVisual.query.tryGetExpr(r,o+s),!a[s])return!1;var c=[i];if(R.isHierarchy(i)&&(c=$.convert(i,e),!c))return!1;var u=this.getVisualDataRole(t,r),p=D.getHierarchyReplacementExpressions(t.config,r,o,n,u,c);if(_.isEmpty(p))return!1;var d=p,h={sourceRole:r,targetRole:r,sourceIndex:o,targetIndex:o,sourceCount:a.length,replacementExpressions:d,schema:e,allowPartialReplace:!0},v={count:a.length,index:o,role:r},g=F.getDrillFilterRemovalInfoList(t.config.singleVisual.query,v,0),f={count:n,index:o,role:r};this.removeAutoFilterFromContract(N.getSelectedVisual(this.selectionService),f);var y=this.core.replace(h,t.config);if(y&&(this.ensureValidDrillState(t,g),l(t,e,this.sortService,this.visualPluginService),Z.setQueryKeepProjectionOrder(t),this.notifyVisualContainers([t]),d&&d.length>0))for(var m=0,C=d;m<C.length;m++){var S=C[m];this.setMatchingFilterToAuto(S,t)}return y},r.prototype.toggleShowAll=function(e,t){t&&(this.core.toggleShowAll(e,t.config),Z.setQueryKeepProjectionOrder(t),this.notifyVisualContainers([t]))},r.prototype.createVisualContainerConfig=function(e,t){return this.createVisualContainerConfigCore(t,e)},Object.defineProperty(r.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),r.prototype.addDrillToDetailsFilters=function(e,t,i){if(!_.isEmpty(i)&&i[0]&&!_.isEmpty(i[0].dataMap)){var o=Z.getVisualQuery(t);if(o){var n=[];if(o.projections)for(var a in o.projections)_.isEmpty(o.projections[a].activeProjectionRefs)||n.push(o.projections[a].activeProjectionRefs);var s=i[0].dataMap;t.filters=t.filters||[];var l;for(l in s){var c=_.find(n,(function(e){return _.includes(e,l)}));this.core.addDrillToDetailsFilter(e,t.filters,o,c||[l],r.chooseRepetitionSelectorForDrill(s[l]))}}}},r.prototype.findCompatibleRole=function(r,o,n){var a=o.config.singleVisual,s=a.query||new Y(e.data.SemanticQuery.create(),{},[]),l=this.visualPluginService.capabilities(a.visualType),c=s&&s.projections;if(l&&c){var u=e.visualCapabilitiesHelperModuleFactory().create(l,this.geotaggingAnalyzerService);return u&&u.findCompatibleRole({queryProjections:c,schema:r,expr:n,roleToExprMap:new t.utils.SQExprToRoleDictionary(i.HierarchyUtils.hierarchyLevelComparer),preferDrillableRoles:!1})}},r.prototype.getMaxNumberOfExpressionsAllowedInRole=function(t,i,r){var o=i.config.singleVisual,n=o.query||new Y(e.data.SemanticQuery.create(),{},[]),a=this.visualPluginService.capabilities(o.visualType),s=n&&n.projections;if(a&&s){var l=e.visualCapabilitiesHelperModuleFactory().create(a,this.geotaggingAnalyzerService),c=F.getDrillableRoles(a);if(_.includes(c,r))return Number.MAX_VALUE;var u=l.getNumberRangesForRoles(n),p=u[r];if(p&&p.max)return p.max}return 0},r.prototype.getTargetRoleAndExpressionsForAdd=function(e,t,i,r,o){var n=i;if(G.isHierarchyOrVariation(e,i)&&!this.shouldUseOriginalColumn(t,e,i,r)&&(n=G.expandExpr(e,i,o),_.isArray(n))){var a=n;if(!r){var s=this.findCompatibleRole(e,t,a[0]);s&&(r=s.name)}if(r){var l=this.getMaxNumberOfExpressionsAllowedInRole(e,t,r);l!==Number.MAX_VALUE&&(n=1===l&&R.isColumn(i)?i:R.isHierarchy(i)||R.isColumn(i)?a.slice(0,l):a.slice(a.length-l,a.length))}}return{targetRole:r,expressions:n}},r.prototype.shouldUseOriginalColumn=function(t,i,r,o){if(!o){var n=this.findCompatibleRole(i,t,r);n&&(o=n.name)}if(!o)return!1;var a=this.getVisualDataRole(t,o);if(a){var s=r.getConceptualProperty(i);if(s&&s.column&&(s.type===e.ValueType.fromExtendedType(518)||s.type===e.ValueType.fromExtendedType(519))&&a.preferDateColumn)return!0}if(r instanceof U){if(t.config.singleVisual.visualType===e.visuals.plugins.slicer.name&&!this.featureSwitchService.featureSwitches.hierarchicalSlicerCreation)return!0}return!1},r.prototype.addExpressionToVisualWithoutAggregation=function(t,i,r,o){var n=r&&e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings),a=this.getTargetRoleAndExpressionsForAdd(t,i,o);return a.targetRole&&r.dataRoles[a.targetRole]!==e.VisualDataRoleKind.Measure||(a.expressions instanceof Array&&(a.expressions=o),n||this.shouldPreferGroupToAggregate(t,o,i)||(a.expressions=this.createExprWithAggregate(a.expressions,t,!1))),this.core.add({expr:a.expressions,schema:t,targetRole:a.targetRole},i.config)},r.prototype.addExpressionToVisualForcingAggregation=function(e,t,i,r){var o=this.createExprWithAggregate(r,e,!0);return this.core.add({expr:o,schema:e},t.config)},r.prototype.addExpressionToVisual=function(e,t,i,r){return this.core.add({expr:r,schema:e},t.config)},r.prototype.createVisualContainerConfigCore=function(e,t){var i,r=e.expr,o=r instanceof Array;!e.allowAggregate||o||this.shouldPreferGroupToAggregate(t,r)||(r=this.createExprWithAggregate(r,t,!1));var n=o?r[0]:r,s=e.visualType||a(n,t,this.geotaggingAnalyzerService,this.featureSwitches),l={expr:i?e.expr:r,schema:t,visualType:s};return this.core.create(l)},r.prototype.addVisualContainerImageFromData=function(e,t,i){var r="data:image/png;base64,"+t,o=this.resourceRegistration.add(i,1,O.Image,{content:r});this.addVisualContainerImage(e,o)},r.prototype.addVisualContainerImage=function(t,i){var o={singleVisual:{visualType:"image",objects:{general:[{properties:{imageUrl:i}}]}}},n=e.Prototype.inherit(t),a=this.formFactorProvider.getCurrentLayout();n.position=r.getPositionForAddedVisual(t.exploreCanvas,a,t.position),this.createVisualFromConfig(n,o)},r.prototype.addVisualContainerShapeVisual=function(t,i,o){var n=e.Prototype.inherit(t),a=this.formFactorProvider.getCurrentLayout();n.position=r.getPositionForAddedVisual(t.exploreCanvas,a,t.position);var s,l;if(1===o)switch(s={icon:[{properties:{shapeType:B.text(i)},selector:{id:"default"}}]},l={properties:{show:B.boolean(!0)}},i){case f.back:l.properties.type=B.text(J.Back);break;case f.qna:l.properties.type=B.text(J.Qna);break;case f.bookmarks:l.properties.type=B.text(J.Bookmark);break;default:l=void 0}else s={general:[{properties:{shapeType:B.text(i)}}]};var c={singleVisual:{visualType:1===o?g.name:m.name,objects:s}};l&&(c.singleVisual.vcObjects={},c.singleVisual.vcObjects.visualLink=[l]);var u=this.createVisualFromConfig(n,c);this.telemetry.logEvent(e.telemetry.EXCreateVisual,"InsertVisualButton",Z.getVisualType(u),u.name)},r.prototype.applyConfigOptions=function(e,t){return e.visualLink&&(t.singleVisual.vcObjects=t.singleVisual.vcObjects||{},t.singleVisual.vcObjects.visualLink=[e.visualLink]),t},r.prototype.addVisualContainer=function(e,t,i,o){var n=this.formFactorProvider.getCurrentLayout();o=r.getPositionForAddedVisual(i,n,o),t.expr=G.expandExpr(e,t.expr);var a=this.createVisualContainerConfig(e,t);if(a)return this.createVisualFromConfig({exploreCanvas:i,position:o},a)},r.prototype.addEmptyVisualContainer=function(e,t,i){var o=this.formFactorProvider.getCurrentLayout();i=r.getPositionForAddedVisual(e,o,i);var n={singleVisual:{visualType:t}};return this.createVisualFromConfig({exploreCanvas:e,position:i},n)},r.prototype.addVisualContainerFromConfig=function(e,t,i,o,n){return o||(o=r.getPositionForAddedVisual(i,null)),this.createVisualFromConfig({exploreCanvas:i,position:o,select:n},e,t)},r.prototype.groupVisualContainers=function(o,n){for(var a=this,s=o.contract.visualContainerGroups,l=1,c=Z.getVisualContainerGroups(s),u=this.formFactorProvider.getCurrentLayout(),p=o.contract,d=_.isEmpty(p.visualContainerGroups)?p.visualContainers:p.visualContainerGroups,h=r.getDefaultVisualContainerPosition(d,u),v=this.formFactorProvider.getCurrentLayout();_.some(c,(function(e){return t.contracts.isVisualContainerGroup(e)&&e.displayName===a.localizationService.get("Group_Role")+" "+l}));)l++;var g={name:Z.uniqueName(s),displayName:this.localizationService.get("Group_Role")+" "+l,groupMode:0,layouts:jsCommon.ArrayExtensions.extendWithId([{id:v,position:h}]),children:n};o.contract.visualContainerGroups=e.ItemGroupingManager.group(g,s);var f=i.CanvasVisualsUtility.findCanvasItemViewModels(o.visualContainerGroups,g.children),y=t.viewModels.ViewModelFactory.convertVisualContainerGroup(g,f,v);return y&&(o.visualContainerGroups=e.ItemGroupingManager.group(y,o.visualContainerGroups),i.CanvasVisualsUtility.syncCanvasItemViewModelsWithContracts(o.visualContainerGroups,o.contract.visualContainerGroups)),N.selectCanvasItem(g,this.selectionService),y},r.prototype.mergeVisualContainerGroups=function(t,r){if(!(r.length<2)){var o=t.contract;o.visualContainerGroups=e.ItemGroupingManager.merge(r,o.visualContainerGroups);var n=i.CanvasVisualsUtility.findCanvasItemViewModels(t.visualContainerGroups,r);t.visualContainerGroups=e.ItemGroupingManager.merge(n,t.visualContainerGroups),i.CanvasVisualsUtility.syncCanvasItemViewModelsWithContracts(t.visualContainerGroups,o.visualContainerGroups);var a=e.ItemGroupingManager.find(r[0].name,o.visualContainerGroups);return a?N.selectCanvasItem(a,this.selectionService):this.selectionService.clearSelection(),n}},r.prototype.ungroupVisualContainers=function(r,o){r.contract.visualContainerGroups=e.ItemGroupingManager.ungroup(o,r.contract.visualContainerGroups);var n=e.ItemGroupingManager.find(o.name,r.visualContainerGroups);if(t.viewModels.isVisualContainerGroup(n))return r.visualContainerGroups=e.ItemGroupingManager.ungroup(n,r.visualContainerGroups),i.CanvasVisualsUtility.syncCanvasItemViewModelsWithContracts(r.visualContainerGroups,r.contract.visualContainerGroups),N.unselectCanvasItem(o,this.selectionService),n},r.prototype.moveCanvasItemInTree=function(t,r,o,n){t.contract.visualContainerGroups=e.ItemGroupingManager.move(r,o,t.contract.visualContainerGroups,n);var a=e.ItemGroupingManager.find(r.name,t.visualContainerGroups),s=e.ItemGroupingManager.find(o.name,t.visualContainerGroups);return t.visualContainerGroups=e.ItemGroupingManager.move(a,s,t.visualContainerGroups,n),i.CanvasVisualsUtility.syncCanvasItemViewModelsWithContracts(t.visualContainerGroups,t.contract.visualContainerGroups),N.selectCanvasItem(r,this.selectionService),a},r.prototype.updateContainerListOrders=function(e,i,r){for(var o=this.formFactorProvider.getCurrentLayout(),n=[],a=[],s=0,l=e;s<l.length;s++){var c=l[s],u=i[c.name];if(null!=u){u=Math.floor(u);u!==c.layouts.withId(o).position[r]&&("z"===r?this.setZIndex(c,u):this.setTabOrder(c,u),t.contracts.isVisualContainer(c)?n.push(c):a.push(c))}}_.isEmpty(n)||this.notifyVisualContainers(n),_.isEmpty(a)||this.notifyVisualContainerGroups(a)},r.prototype.createVisualFilters=function(e,i,r,o,n){for(var a=t.viewModels.ViewModelFactory.createVisualFilters(e,i,o,this.displayNameService,this.visualPluginService,this.pluginOps,this.filterGenerator,this.aggrOps,this.localizationService,this.featureSwitchService,n),s=0,l=a;s<l.length;s++){var c=l[s];c.updateFilterProperties(o,this.visualPluginService,this.aggrOps),c.canVisualize()&&(c.isInvalid()||this.createFilterVisualContainerConfig(c.contract,r,o))}return a},r.prototype.moveFilter=function(e,i,r,o){var n=t.FilterUtils.getFiltersContainer(i,this.selectionService,this.explorationNavigationService);return this.setFilterSortType(e,i,3),this.moveFilterContainer(n.filters,o,r),!0},r.prototype.setFilterSortType=function(r,o,n){var a=t.FilterUtils.getFiltersContainer(o,this.selectionService,this.explorationNavigationService);return a.filterSortOrder!==n&&(this.telemetry.logEvent(e.telemetry.EXToggleFilterCardSort,i.getTelemetryFilterCardSortType(n)),3===n?(this.sortFiltersByCurrentSortType(r,a,o),this.updateFilterOrdinal(a.filters)):a.filters&&a.filters.forEach((function(e){return e.ordinal=void 0})),a.filterSortOrder=n),!0},r.prototype.sortFiltersByCurrentSortType=function(e,i,r){var o=this;void 0===i.filterSortOrder&&(i.filterSortOrder=1);var n=i.filters.filter((function(e){return t.FilterUtils.getFilterCapabilities(e).canSort})),a=i.filters.filter((function(e){return!t.FilterUtils.getFilterCapabilities(e).canSort}));if(1===i.filterSortOrder||2===i.filterSortOrder){var s=N.getSelectedVisual(this.selectionService),l=Z.getVisualCapabilities(s,this.visualPluginService);n.sort((function(t,i){var n=t.displayName||o.getDisplayName(t,e,l,r,s&&s.config.singleVisual)||"",a=i.displayName||o.getDisplayName(i,e,l,r,s&&s.config.singleVisual)||"";return n.localeCompare(a)})),2===i.filterSortOrder&&n.reverse()}else 3===i.filterSortOrder&&n.sort((function(e,t){return e.ordinal-t.ordinal}));i.filters=n.concat(a)},r.prototype.moveFilterContainer=function(e,t,i){t<i&&(i-=1);var r=e[t];e.splice(t,1),e.splice(i,0,r),this.updateFilterOrdinal(e)},r.prototype.updateFilterOrdinal=function(e){e.forEach((function(e,t){e.ordinal=t}))},r.prototype.getDisplayName=function(e,i,r,o,n){var a;if(e.type===T.Include||e.type===T.Exclude){var s=new t.services.IncludeExcludeSQExprVisitor(i,this.displayNameService);a=t.FilterUtils.getDisplayNameForIncludeExcludeFilters(this.localizationService,e.type,s.dataPoints.length)}else if(e.type===T.Passthrough)a=e.restatement;else{var l=e.expression&&z.asFieldPattern(e.expression),c={includeVariationSource:!0},u=void 0,p=void 0;e.expression&&n&&(u=n.query&&n.query.defn.selectNameOf(e.expression),p=n.columnProperties),a=this.displayNameService.getDisplayName(e.expression,i,r,u,0===o?p:void 0,c)||(l?M.getFieldExprName(l):void 0)}return a},r.prototype.addFilter=function(r,o,n,a,l,c){var h=N.getSelectedVisual(this.selectionService);if(!t.FilterUtils.canAdd(h,o,r,n,l,this.pluginOps,this.filterGenerator))return!1;var v=l?5:1,g=t.FilterUtils.getDefaultFilterType(o,r,v),f={name:t.FilterUtils.getNextFilterName(n.container.filters),expression:o,type:g,howCreated:v},y=_.isEmpty(t.FilterUtils.validate(f,r,this.aggrOps));f.expanded=t.FilterUtils.canExpandManually(v,!1,o,y),e.data.SQExprUtils.isMeasure(o)||this.createFilterVisualContainerConfig(f,a,r),t.FilterUtils.add(n.container,f),3===n.container.filterSortOrder&&this.featureSwitchService.featureSwitches.filterPaneCustomSort&&this.moveFilterContainer(n.container.filters,n.container.filters.length-1,c);var m={filter:f,changeType:1,scope:n};if(t.FilterUtils.notifyFilterContainerChangedByUser(this.eventBridge,m),l){s(this.telemetry,"Add",n.container);var C=this.explorationNavigationService.getCurrentExploration(),S=n.container;if(null!=C&&null!=S){var w=t.FilterUtils.determineIsLinkedAsAggregation(f,r,this.aggrOps),b={filterName:f.name,type:0,isCausedByCode:!1,fieldExpr:f.expression,asAggregation:w,isLegacySingleSelection:!1};t.PodUtils.addParameter(C,S.name,f.name,f.expression,b.asAggregation,!1,t.PodUtils.determineType(S)),this.eventBridge.publishToChannel(V.podParameterChanged,b)}}else H.isMeasure(o)&&this.telemetry.logEvent(e.telemetry.EXAddFilter,p(g),d(n.scopeType),u(o),Z.hasGroupByItemsInQuery(h),i.getTelemetryViewMode(this.viewModeState.getMode()));return!0},r.prototype.addFilterContainers=function(e,i){for(var r=0,o=e;r<o.length;r++){var n=o[r];t.FilterUtils.add(i.container,n);var a={filter:n,changeType:1,scope:i};t.FilterUtils.notifyFilterContainerChangedByUser(this.eventBridge,a)}},r.prototype.removeFilter=function(e,t){return this.removeFilterImpl(e,t)},r.prototype.toggleSlicerVisualSearch=function(t,r,o){var n=i.VisualContainerUtils.getVisualCapabilities(t,o),a=this.filterGenerator.tryGetSelfFilterEnabledProperty(n);if(!a)return!1;var s=t.config.singleVisual;s.objects||(s.objects={});var l=e.data.DataViewObjectDefinitions.getValue(s.objects,a,null);if(l&&l.value){e.data.DataViewObjectDefinitions.deleteProperty(s.objects,a.objectName,null,a.propertyName);var c=r.tryGetSelfFilterProperty(n);c&&e.data.DataViewObjectDefinitions.deleteProperty(s.objects,c.objectName,null,c.propertyName)}else e.data.DataViewObjectDefinitions.setValue(s.objects,a,null,e.data.SQExprBuilder.boolean(!0));return!0},r.prototype.enableSearchInFilterCard=function(t){var i=e.visuals.plugins.slicer.capabilities,r=this.filterGenerator.tryGetSelfFilterEnabledProperty(i),o=e.visuals.visualStyles.create().colorPalette,n=e.visuals.slicerProps.searchBox,a=this.featureSwitchService.featureSwitches.paneColorRefresh||this.explorationCapabilities.getCapabilities().showFluentDesign,s=a?P.FilterCardSearchBoxBorderColor:o.foregroundNeutralDark.value,l=a?P.FilterCardSearchBoxBackgroundColor:o.foregroundNeutralSecondary.value,c=a?P.FilterCardFontColor:o.foregroundLight.value;
b.setValue(t,r,null,e.data.SQExprBuilder.boolean(!0)),b.setValue(t,n.borderColor,null,{solid:{color:e.data.SQExprBuilder.text(s)}}),b.setValue(t,n.outline,null,e.data.SQExprBuilder.text(e.visuals.lineStyle.solid)),b.setValue(t,n.background,null,{solid:{color:e.data.SQExprBuilder.text(l)}}),b.setValue(t,n.fontColor,null,{solid:{color:e.data.SQExprBuilder.text(c)}})},r.prototype.createFilterVisualContainerConfig=function(t,i,r){var o=t.expression;if(!R.isTransformOutputRoleRef(o)){var n=H.discourageAggregation(o,r),a=z.asFieldPattern(o),s=a.column||a.groupingColumn||a.hierarchyLevel,l={expr:o,dataSources:i,allowAggregate:!1,visualType:e.visuals.plugins.filterSlicer.name};if(!H.isMeasure(o)){var c=this.createVisualContainerConfigCore(l,r);if(c){var u=c.singleVisual.objects;u||(c.singleVisual.objects=u={});var p=5===t.howCreated&&!t.isTransient,d=p,h=!d,v=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,g=e.visuals.slicerProps.selection.singleSelect,f=e.visuals.slicerProps.header.show,y=e.visuals.slicerProps.data.mode,m=e.visuals.slicerProps.general.filter;b.setValue(u,y,null,B.text(e.visuals.slicerMode.basic)),b.setValue(u,v,null,B.boolean(h)),b.setValue(u,g,null,B.boolean(d)),b.setValue(u,f,null,B.boolean(!1)),this.featureSwitchService.featureSwitches.enableSearchInFilter&&this.enableSearchInFilterCard(u);var C=this.featureSwitchService.featureSwitches.paneColorRefresh||this.explorationCapabilities.getCapabilities().showFluentDesign,w=e.visuals.visualStyles.create().colorPalette,x=e.visuals.slicerProps.items.textSize,F=e.visuals.slicerProps.items.fontColor,V=C?P.FilterCardFontColor:w.foregroundLight.value;if(b.setValue(u,x,null,B.integer(S.smallFontSizeInPoint)),b.setValue(u,F,null,{solid:{color:e.data.SQExprBuilder.text(V)}}),!n&&s){var M=B.entity(s.schema,s.entity,s.entityVar),T=B.aggregate(M,2),D=e.visuals.slicerProps.general.count,A=c.singleVisual.query.getRoleNameForExpr(o),I={data:[E.fromRoles([A])]};b.setValue(u,D,I,T)}var _=0===t.howCreated&&!L.isDefaultFilter(t.filter);if(this.ensureDefaultFilterApplied(r,c.singleVisual,_)&&null==t.filter){var O=a.column||a.groupingColumn?o.getKeyColumns(r):[o];t.filter=L.getDefaultValueFilter(O)}t.filter&&b.setValue(u,m,null,t.filter),t.config=c}}}},r.prototype.notifyVisualContainers=function(e,t,i,r){var o=this;void 0===t&&(t="UserAction_EditVisual");var n=this.explorationNavigationService.getCurrentSection(),a=_.map(e,(function(e){return i?Z.filterAffects(e,n,o.visualRelationshipService,r):Z.contractEqualityComparator(e)}));this.eventBridge.publishToChannel(V.visualContainerChanged,{affectContainer:function(e){return _.some(a,(function(t){return t(e)}))},sourceLabelKey:t})},r.prototype.notifyVisualContainerGroups=function(e){this.eventBridge.publishToChannel(V.visualContainerGroupChanged,{affectContainer:function(t){return _.includes(e,t)}})},r.prototype.convert=function(i,r,o){var n=Z.getVisualType(r),a=this.telemetry.startEvent(e.telemetry.EXInteractionVisualConversion,n,o,r.name);if(n===o)return!1;r.config.singleVisual.customizeConvertFrom&&r.config.singleVisual.customizeConvertFrom(r);var s=r.config.singleVisual.query,c=this.visualPluginService.capabilities(o);if(s&&_.isEmpty(c.dataRoles)&&(r.config.singleVisual.query=void 0,s=void 0),s){this.resetSearchProperties(r);var u=t.contracts.SingleVisualConfig.clone(r.config.singleVisual),p=this.core.convert({schema:i,source:u,target:o});if(!p)return a.reject();r.config.singleVisual=u,a.resolve();var d=this.visualPluginService.capabilities(n),h=this.filterGenerator.tryGetFilterPropertyIdentifier(d);if(!h){var v=this.visualPluginService.capabilities(o);h=this.filterGenerator.tryGetFilterPropertyIdentifier(v)}this.ensureValidDrillMode(r),this.ensurePercentRoleTotal(r,o),this.updateFilterState(i,r,!1,!0,!0,h);var g=r.filters;return _.isEmpty(g)||t.FilterUtils.supportsVisualFilters(r,this.pluginOps,this.filterGenerator)||(r.filters=[]),this.removeUnsupportedDataBoundProperties(r,o),l(r,i,this.sortService,this.visualPluginService),this.featureSwitchService.featureSwitches.visualFiltersCustomSort&&_.remove(g,(function(e){return 0===e.howCreated&&void 0===e.filter})),this.eventBridge.publishToChannel(V.visualTypeChanged),p}return r.config.singleVisual.visualType=o,a.resolve(),this.notifyVisualContainers([r]),this.eventBridge.publishToChannel(V.visualTypeChanged),!0},r.prototype.setOrderBy=function(e,t){var i=e.config.singleVisual;i.query.orderBy(t),i.hasDefaultSort=!1,this.notifyVisualContainers([e])},r.prototype.removeOrderBy=function(e,t,i){for(var r=0,o=t;r<o.length;r++){var n=o[r];e.config.singleVisual.query.removeOrderBy(n)}l(e,i,this.sortService,this.visualPluginService),this.notifyVisualContainers([e])},r.prototype.deleteVisualRelationships=function(e,t){_.remove(e.relationships,(function(e){return e.source===t||e.target===t}))},r.prototype.addProperty=function(e,t,i,r){var o=e.config.singleVisual,n=o.objects;n||(o.objects=n={}),b.setValue(n,t,i,r)},r.prototype.removeProperty=function(e,t,i){var r=e.config.singleVisual.objects;b.deleteProperty(r,t.objectName,i,t.propertyName)},r.prototype.setVisibility=function(e,t,i){var r=e.config.singleVisual;if(q.setHidden(r,t),t){var o=this.explorationNavigationService.getCurrentSection();this.filterGenerator.clearCrossHighlightForVisualContainers(o,[e]),i||N.unselectCanvasItem(e,this.selectionService)}},r.prototype.clearCrossHighlightsForGroup=function(e,i,r){var o=[];t.contracts.traverseVisualContainerGroups([e],(function(e){t.contracts.isVisualContainer(e)&&_.some(r,(function(t){return t.sourceVisualContainer===e}))&&o.push(e)}));var n;if(!_.isEmpty(o)){this.filterGenerator.clearCrossHighlightForVisualContainers(i,o);n=this.clearCrossHighlightsForVisuals(o,i)}return n||[]},r.prototype.clearCrossHighlightsForVisuals=function(e,t){var i=e.slice();return i.push.apply(i,this.filterGenerator.clearCrossHighlightForVisualContainersOperation(t,e)),_.uniq(i)},r.prototype.setVisualContainerGroupVisibility=function(e,t,i){if(K.setHidden(e,t),t){var r=this.explorationNavigationService.getCurrentSection(),o=r&&r.crossFilterSource&&r.crossFilterSource.highlight;this.clearCrossHighlightsForGroup(e,r,o)}i||N.unselectCanvasItem(e,this.selectionService)},r.prototype.setVisualContainerGroupDisplayName=function(e,t){K.setDisplayName(e,t)},r.prototype.setZIndex=function(e,t){var i=this.formFactorProvider.getCurrentLayout();e.layouts.withId(i).position.z=t},r.prototype.setTabOrder=function(e,t){var i=this.formFactorProvider.getCurrentLayout();e.layouts.withId(i).position.tabOrder=t},r.prototype.setVisualRelationship=function(e,t,i,r){if(t!==i){e.relationships=e.relationships||[];var o=this.visualRelationshipService.relationship(e,t,i);if(o)o.type=r;else{var n=(_.includes(e.visualContainers,t),_.includes(e.visualContainers,i),{source:t,target:i,type:r});e.relationships.push(n)}}},r.prototype.persistProperties=function(e,i,r){var o=i.objects||{},n=this.visualPluginService.capabilities(i.visualType),a=n?n.objects:void 0;return!!t.services.applyPropertyChanges(e,a,o,r)&&(i.objects=o,!0)},r.prototype.persistVCProperties=function(e,i){var r=i.vcObjects||{};return!!t.services.applyPropertyChanges(e,q.CommonObjectDescriptors,r)&&(i.vcObjects=r,!0)},r.prototype.removeUnsupportedDataBoundProperties=function(e,t){if(this.visualPluginService.isScriptVisual(t)||this.pluginOps.isAnalysisVisual(t)){var i=e.config.singleVisual.vcObjects;if(i){var r=e.config.singleVisual.query.defn.select(),o=[];_.forEach(i,(function(e,t){var n=e[0].properties;_.forEach(n,(function(e,n){w.getDataBoundExprs(e,null,r).length>0&&o.push((function(){b.deleteProperty(i,t,null,n)}))}))})),_.forEach(o,(function(e){e()}))}}},r.prototype.ensureValidDrillState=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];this.core.removeDrillFilter(e.filters,o.expr);var n=e.config.singleVisual.query,a=n.projections[o.roleName];if(a){var s=_.last(a.activeProjectionRefs);if(null!=s){var l=n.defn.select().withName(s).expr;this.core.removeDrillFilter(e.filters,l)}}}this.ensureValidDrillMode(e)},r.prototype.ensureValidDrillMode=function(e){var t=e.drillMode;(1===t&&0===this.drill.getSupportedDrillDirections(e)||2===t&&!this.drill.canDrillToDetails(e))&&this.drill.setDrillMode(e,0)},r.prototype.ensurePercentRoleTotal=function(e,r){if(!this.visualPluginService.capabilities(r).dataRoleTotals){var o=new te,n=new t.schemaRewriterUtils.VisualQueryExprRewriter(o),a=new i.VisualContainerRewriter([n]);i.traverseVisualContainer(e,a,this.visualPluginService)}},r.prototype.getVisualDataRole=function(e,t){var i=Z.getDataRolesForVisual(e,this.visualPluginService);if(!_.isEmpty(i))return y.findItemWithName(i,t)},r.prototype.removeFieldImpl=function(e,t,i){return this.invokeRemoveOnSelectedVisuals({expr:e,ignoreAggregates:!0},t,i)},r.prototype.removeFilterImpl=function(r,o){if(!o||!o.container||!o.container.filters)return!1;for(var n={filter:r,changeType:0,scope:o},a=0;a<o.container.filters.length;a++)if(o.container.filters[a]===r){o.container.filters.splice(a,1),3===o.container.filterSortOrder&&this.featureSwitches.filterPaneCustomSort&&this.updateFilterOrdinal(o.container.filters),t.FilterUtils.notifyFilterContainerChangedByUser(this.eventBridge,n);var l=5===r.howCreated&&!r.isTransient;if(l&&s(this.telemetry,"Delete",o.container),l&&1===o.scopeType||t.PodUtils.isPodEnabled(r,o)){var c=this.explorationNavigationService.getCurrentExploration(),u=o.container;if(null!=c&&null!=u){t.PodUtils.deleteParameter(c,u.name,r.name,this.linguisticSchemaProxy);var p={filterName:r.name,type:1};this.eventBridge.publishToChannel(V.podParameterChanged,p)}}return!0}return this.telemetry.logEvent(e.telemetry.EXRemoveFilter,i.getTelemetryFilterType(r.type),i.getTelemetryFilterScopeType(o.scopeType),r.expression&&i.getTelemetryFieldKind(r.expression),i.getTelemetryViewMode(this.viewModeState.getMode())),!1},r.prototype.removeFiltersWithExpr=function(e,t){var i=t.filters;if(!i)return!1;for(var r,o=i.length-1;o>=0;o--){var n=i[o];R.equals(n.expression,e)&&(r=this.removeFilterImpl(n,{scopeType:0,container:t}))}return r},r.prototype.removeAutoFilterFromContract=function(e,i){if(this.featureSwitchService.featureSwitches.visualFiltersCustomSort&&e){var r=e.filters;if(r){var o=e.config.singleVisual.query,a=n(i,o);_.forEach(a,(function(i){var n=o.defn.select().withName(i),a=n?n.expr:void 0,s=y.filterArray(r,(function(e){return 0===e.howCreated&&R.equals(e.expression,a)}));if(s.length>0){var l=t.FilterUtils.isFilterModified(s[0]);l?l&&(s[0].howCreated=1):_.remove(e.filters,s[0])}}))}}},r.prototype.setMatchingFilterToAuto=function(e,t){if(t.filters){var i=_.find(t.filters,(function(t){return R.equals(t.expression,e)}));i&&(i.howCreated=0)}},r.prototype.invokeRemoveOnSelectedVisuals=function(e,t,i){for(var r=!1,a=t.length-1;a>-1;a--){var s=t[a],c=s.config.singleVisual,u=c.query;if(u){var p=F.getDrillFilterRemovalInfoList(u,e,0),d=n(e,u);this.removeAutoFilterFromContract(s,e),this.removeExpressionsFromVisual(e,s.config,i)&&(this.ensureValidDrillState(s,p),this.isEmptyQueryVisual(s)?u=c.query=void 0:(l(s,i,this.sortService,this.visualPluginService),Z.setQueryKeepProjectionOrder(s)),this.updateFilterState(i,s,!0,!1,!0,null),o(s,u,d),this.notifyVisualContainers([s]),r=!0)}}return r},r.prototype.isEmptyQueryVisual=function(t){var i=t.config.singleVisual;if(i&&this.pluginOps.isQueryVisual(i.visualType)&&i.query&&0===i.query.defn.select().length){var r=this.visualPluginService.capabilities(i.visualType);if(r){var o=e.ScriptResultUtil.extractScriptResultFromVisualConfig(r.dataViewMappings,i.objects);return!(o&&!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(o.source))}return!1}return!1},r.prototype.removeExpressionsFromVisual=function(e,t,i){for(var r=e.count||1,o=0;o<r;o++)if(!this.core.remove(e,t,i))return!1;return!0},r.prototype.createVisualFromConfig=function(r,o,n){o=this.applyConfigOptions(r,o);var a=this.formFactorProvider.getCurrentLayout(),s=r.exploreCanvas,l={name:Z.uniqueName(s.contract.visualContainers),config:o,filters:n||[],layouts:jsCommon.ArrayExtensions.extendWithId([{id:a,position:r.position}])},c=this.explorationNavigationService.getCurrentExploration();c.defaultDrillFilterOtherVisuals&&(l.drillFilterOtherVisuals=!0);var u=s.contract,p=N.getSelectedCanvasItems(this.selectionService),d=p&&p[0],h=p&&1===p.length&&t.contracts.isVisualContainerGroup(d);u.visualContainers.push(l),h&&t.contracts.isVisualContainerGroup(d)?u.visualContainerGroups=e.ItemGroupingManager.addToGroup(l,d,u.visualContainerGroups):u.visualContainerGroups=e.ItemGroupingManager.add(u.visualContainerGroups,l);var v=t.viewModels.ViewModelFactory.convertVisualContainer(c,u,l,a);if(v){if(s.visualContainers.push(v),h){var g=e.ItemGroupingManager.find(d.name,s.visualContainerGroups);t.viewModels.isVisualContainerGroup(g)&&(s.visualContainerGroups=e.ItemGroupingManager.addToGroup(v,g,s.visualContainerGroups)),i.CanvasVisualsUtility.syncCanvasItemViewModelsWithContracts(s.visualContainerGroups,u.visualContainerGroups);var f=e.ItemGroupingManager.find(d.name,s.visualContainerGroups);t.viewModels.isVisualContainerGroup(f)&&this.layoutAuthoring.addCanvasItemToGroup(f,v)}else s.visualContainerGroups=e.ItemGroupingManager.add(s.visualContainerGroups,v);return r.select!==!1&&N.selectCanvasItem(l,this.selectionService,!1,!0),l}},r.prototype.createExprWithAggregate=function(e,t,i,r){if(H.discourageAggregation(e,t))return e;var o=this.getPreferredAggregate(t,e,r);return this.aggrOps.createExprWithAggregate(e,t,i,r?r.requiredTypes:null,o)},r.getPositionForAddedVisual=function(e,t,o){var n=e.contract,a=n.visualContainerGroups;if(!o)return r.getDefaultVisualContainerPosition(a,t);if(null!=o.z)return o;var s=_.cloneDeep(o);return s.z=i.CanvasVisualsUtility.getZIndexForNewCanvasItem(a,t),s},r.getDefaultVisualContainerPosition=function(e,t){return{height:0,width:0,x:0,y:0,z:i.CanvasVisualsUtility.getZIndexForNewCanvasItem(e,t)}},r.prototype.shouldPreferGroupToAggregate=function(t,i,r,o){if(r){var n=o||this.findCompatibleRole(t,r,i);if(n&&n.kind===e.VisualDataRoleKind.GroupingOrMeasure&&1===n.kindPreference)return!0}if(o&&o.kind===e.VisualDataRoleKind.GroupingOrMeasure){var a=this.isRoleOrExprLatLong(t,i,o);if(a){if(!r)return!0;var s=Z.getVisualQuery(r);if(s&&s.projections){var l=this.visualPluginService.capabilities(r.config.singleVisual.visualType),u=e.visualCapabilitiesHelperModuleFactory().create(l,this.geotaggingAnalyzerService),p=void 0;a&&(p=u.getNonLatLongRoles());for(var d=0,h=p;d<h.length;d++){var v=h[d];if(s.projections[v])return!1}}}else{if(!H.isExprValidForAggregation(i))return!0;if(c(i,i.getMetadata(t),t))return!1}}return o&&o.kind!==e.VisualDataRoleKind.Measure},r.prototype.getPreferredAggregate=function(e,t,i){if(this.isRoleOrExprLatLong(e,t,i))return 1},r.prototype.isRoleOrExprLatLong=function(t,i,r){var o=e.visualCapabilitiesHelperModuleFactory().isValueTypeDescriptorLatLong;if(r){var n=r.preferredTypes;if(o(_.isEmpty(n)?void 0:n[0]))return!0}var a=i.getMetadata(t),s=a?a.type:void 0;if(o(s))return!0;if(s){var l=z.asFieldPattern(i),c=l.column||l.columnAggr||l.groupingColumnAggr||l.groupingColumnAggr||l.measure;if(c){var u=c&&this.geotaggingAnalyzerService.getFieldType(c.name);if(null!=u){var p=e.ValueType.fromPrimitiveTypeAndCategory(s.primitiveType,u);if(o(p)||p.numeric)return!0}}}return!1},r.prototype.canHierarchyLevelJoinExistingGroup=function(e,t,i,r,o){var n=t&&t.projections[i];if(R.isHierarchyLevel(r)&&n&&n.all().length>0){var a=r,s=n.all(),l=G.expandExpr(e,a.arg),c=_.isNumber(o)?o-1:s.length-1;if(c>=0&&G.areHierarchyLevelsOrdered(l,t.tryGetExpr(i,c),a))return!0;if(_.isNumber(o)&&o<s.length&&G.areHierarchyLevelsOrdered(l,a,t.tryGetExpr(i,o)))return!0}return!1},r.prototype.addHierarchyLevelToExistingHierarchiesInVisual=function(e,t,i,r){var o=!1,n=D.getOptionsToAddHierarchyLevelToExistingHierarchies(e,t,i.singleVisual.query,r);if(n)for(var a=0,s=n;a<s.length;a++){var l=s[a];o=this.core.add(l,i)||o}return o},r.prototype.updateFilterState=function(e,t,i,r,o,n){var a=t.config.singleVisual,s=this.visualPluginService.capabilities(a.visualType),l=s?s.objects:null;if(r&&this.ensureDefaultFilterApplied(e,a,i)||o&&this.clearFilterOutput(a,l,!1))this.notifyVisualContainers([t],"UserAction_ChangeFilter",!0,e);else{var c=!1,u=t.config.singleVisual;if(n&&u&&u.objects){b.getValue(u.objects,n,null)&&(c=!0)}this.notifyVisualContainers([t],"UserAction_ChangeFilter",c,e)}},r.prototype.ensureDefaultFilterApplied=function(e,t,i){var r=t.query.getUniqueQueryRefs();if(0===r.length)return!1;var o=t.query.defn.select().withName(r[0]).expr,n=H.getDefaultValue(o,e),a=this.visualPluginService.capabilities(t.visualType),s=a?a.objects:null;if(!n)return this.clearFilterOutput(t,s,!0);if(!x.findDefaultValue(s))return this.clearFilterOutput(t,s,!0);if(i)return!1;t.objects||(t.objects={});var l,c=z.asFieldPattern(o);l=c.column||c.groupingColumn?o.getKeyColumns(e):o;var u=x.findFilterOutput(s),p=L.getDefaultValueFilter(l);return b.setValue(t.objects,u,null,p),!0},r.prototype.clearFilterOutput=function(e,t,i){if(!e.objects)return!1;var r=x.findFilterOutput(t);if(!r)return!1;var o=b.getValue(e.objects,r,null);return!(!o||i&&!L.isDefaultFilter(o))&&(b.deleteProperty(e.objects,r.objectName,null,r.propertyName),!0)},r.prototype.resetSearchProperties=function(e){var t=Z.getObjectDefinitions(e);if(t){var i=Z.getVisualCapabilities(e,this.visualPluginService),r=this.filterGenerator.tryGetSelfFilterEnabledProperty(i);r&&b.deleteProperty(t,r.objectName,null,r.propertyName);var o=this.filterGenerator.tryGetSelfFilterProperty(i);o&&b.deleteProperty(t,o.objectName,null,o.propertyName)}},r.prototype.logReportMeasureMoveTelemetry=function(t,i,r,o,n){if(r!==o){var a=n&&n.getTargetEntity();if(a&&a.schema===S.ExplorationSchemaName){var s=n.getConceptualProperty(t);if(s){var l=this.getVisualDataRole(i,r),c=this.getVisualDataRole(i,o),u=JSON.stringify(l.requiredTypes),p=JSON.stringify(c.requiredTypes);u!==p&&this.telemetry.logEvent(e.telemetry.EXReportMeasureMoveRoleKind,e.PrimitiveTypeStrings[s.type.primitiveType],u,p)}}}},r.prototype.setVisualDrillFilterOtherVisualsSetting=function(e,t){e.drillFilterOtherVisuals!==t&&(e.drillFilterOtherVisuals=t,this.eventBridge.publishToChannel(V.visualDrillFilterOtherVisualsSettingChanged,{visualContainer:e,on:t}))},r})(),te=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitScopedEval=function(e){return new j(e.expression,[])},t})(e.data.SQExprRewriter);i.getVisualDefaultType=a,i.setDefaultSort=l,i.isNumericMeasure=c,i.getTelemetryFieldKind=u,i.getTelemetryFilterType=p,i.getTelemetryFilterScopeType=d,i.getTelemetryViewMode=h,i.getTelemetryFilterCardSortType=v})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new c(e,t,i,r)}var o=i.ErrorDetailsUtility,n=e.explore.services.events,a=e.data.SQExprUtils,s=jsCommon.TraceType;i.createVisualContainerErrorManager=r;var l="Sampled",c=(function(){function i(e,t,i,r){this.viewModel=e,this.getVisualType=t,this.getVisualContract=i,this.services=r}return i.prototype.showErrorDetails=function(){var e=this.viewModel;this.logErrorAndShowDialog(e.errorInfo,this.getVisualType(),"User"!==e.errorInfo.source,!0)},i.prototype.showWarningDetails=function(){var e=this.viewModel,t={details:e.warningInfo?e.warningInfo.details:e.customVisualDeprecatedWarningInfo.details,code:e.warningInfo?e.warningInfo.code:e.customVisualDeprecatedWarningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,this.getVisualType(),!1,!0)},i.prototype.showTransformWarningDetails=function(){var e=this.viewModel,t={details:e.transformWarningInfo.details,code:e.transformWarningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,this.getVisualType(),!1,!0)},i.prototype.showInfoDetails=function(){var e=this.viewModel,t={details:e.visualInfo.details,code:e.visualInfo.code,fixableError:0};this.logErrorAndShowDialog(t,this.getVisualType(),!1,!1)},i.prototype.clearError=function(){var e=this.viewModel;e.errorInfo=void 0,e.warningInfo=void 0,e.transformWarningInfo=void 0,e.visualInfo=void 0},i.prototype.showErrorOverlay=function(t,i,r,n){var a=this.viewModel,s=this.getVisualType(),l=this.getVisualContract();if(this.services.telemetryService.logEvent(e.telemetry.VisualError,i,s,void 0,l.name,t.message),!a.errorInfo||a.errorInfo.code!==i){var c=o.getErrorOverlayType(i),u=o.shouldHideSeeDetails(i),p=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0),d=this.getFixableErrorKind(i,this.services.featureSwitchService.featureSwitches.enableTableToTableRelationship&&p&&p.canEdit);a.errorInfo={details:t,code:i,fixableError:d,hideSeeDetails:u,overlayType:c,requestId:r,source:n}}},i.prototype.showWarningIcon=function(e,t){var i=this.viewModel,r=this.getVisualType();this.logVisualWarning(r,t,e.message),i.warningInfo||(i.warningInfo={details:e,code:t})},i.prototype.showDeprecationWarning=function(){var t=this.viewModel,i=e.common.localize.get("CustomVisuals_DeprecatedMessageWarningKey"),r=e.common.localize.get("CustomVisuals_DeprecatedMessageWarningValue"),o={message:e.common.localize.get("CustomVisuals_DeprecatedMessage"),displayableErrorInfo:[{errorInfoKey:i,errorInfoValue:r}],hideAdditionalErrorInfo:!0};t.customVisualDeprecatedWarningInfo={details:o,code:"CustomVisuals_DeprecatedMessage"}},i.prototype.clearDeprecationWarning=function(){this.viewModel.customVisualDeprecatedWarningInfo=void 0},i.prototype.showTransformWarningIcon=function(e,t,i){var r=this.viewModel,o=this.getVisualType(),n=i?t.concat("|").concat(l):t;this.logVisualWarning(o,n,e.message),r.transformWarningInfo||(r.transformWarningInfo={details:e,code:t})},i.prototype.showInfoIcon=function(e,t){var i=this.viewModel,r=this.getVisualType();this.logVisualWarning(r,t,e.message),i.visualInfo||(i.visualInfo={details:e,code:t})},i.prototype.fixErrors=function(){var e=this.viewModel,i=this.getVisualContract();switch(e.errorInfo.fixableError){case 1:t.services.selectionUtils.selectCanvasItem(i,this.services.selection),this.services.visualAuthoring.removeInvalidExpressions(i,this.services.dataSources.get());break;case 2:var r=a.getActiveTablesNames(i.config.singleVisual.query.defn);this.services.eventBridge.publishToChannel(n.missingTableRelationship,{tables:r});break;case 3:this.removeBrokenFilters();break;case 4:this.services.eventBridge.publishToChannel(n.showEnableScriptVisualsDialog,0);break;case 5:this.services.eventBridge.publishToChannel(n.showEnableScriptVisualsDialog,1);break;case 0:}},i.prototype.removeBrokenFilters=function(){var e=this,t=this.getVisualContract(),i=t.filters,r={scopeType:0,container:t};this.services.conceptualSchemaProxy.get(this.services.dataSources.get()).then((function(t){for(var o=0,n=i;o<n.length;o++){var a=n[o];a.filter&&!_.isEmpty(a.filter.validate(t,e.services.aggrOps))&&e.services.visualAuthoring.removeFilter(a,r)}}))},i.prototype.generateShowMoreErrorDetails=function(t){var i=[],r=t.message,n=e.common.localize.get("ServiceError_CannotLoadVisual");if(o.hasAdditionalErrorInfo(t)&&(n=t.displayableErrorInfo[0].errorInfoKey,r=t.displayableErrorInfo[0].errorInfoValue,t.displayableErrorInfo.length>1))for(var a=1;a<t.displayableErrorInfo.length;a++)i.push(t.displayableErrorInfo[a]);return{title:n,message:r,displayableErrorInfo:i,debugErrorInfo:t.debugErrorInfo,source:t.source}},i.prototype.getFixableErrorKind=function(e,t){switch(e){case"Missing_References":return 1;case"InvalidUnconstrainedJoin":return t?2:0;case"Broken_Filters":return 3;case"ScriptVisualsNotEnabled":return 4;case"PythonVisualsNotEnabled":return 5;default:return 0}},i.prototype.logErrorAndShowDialog=function(e,i,r,o){var n,a,l=this.generateShowMoreErrorDetails(e.details),c=e.code;if(r?(n="VisualErrorSeeDetails_"+c+"_"+i,a=s.Error):(n="VisualWarningSeeDetails_"+c+"_"+i,a=s.Warning),o){var u={title:l.title,displayableErrorInfo:l.displayableErrorInfo,debugErrorInfo:l.debugErrorInfo,level:a,source:null!=l.source?l.source:e.source},p=e.details;p&&(u.showAdditionalErrorInfo=p.hideAdditionalErrorInfo!==!0,p.helpLink&&(u.helpLink=p.helpLink,u.displayLearnMoreHelpLink=1===p.helpLinkType)),e.requestId&&(u.requestId=e.requestId),this.services.errorService.error(l.message,n,u)}else{new t.dialogs.LearnMoreDialogBuilder(this.services.modalDialogService).show("VisualContainerInfo",l.title,l.message,"PBI_Button_Label_Close",e.details.helpLink)}},i.prototype.logVisualWarning=function(t,i,r){var o=this.getVisualContract();this.services.telemetryService.logEvent(e.telemetry.VisualWarning,t,o.name,void 0,!1,"PowerBI",i,r)},i})();i.VisualContainerErrorManager=c})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getFilters:function(){return{dataFilter:null,dataFiltersUnmerged:null}},getDataSourceVariables:function(){},getVisualRelationshipFilterAction:function(){return 0},selectDataPoint:_.noop,setVisualRelationshipFilterAction:_.noop}}function i(e,t){return{clearAILevels:function(i){return t.clearAILevels(e,i)},isSupported:function(){return t.isSupported()},isTopNPerLevelSupported:function(){return t.isTopNPerLevelSupported()},removeLevel:function(i){return t.removeLevel(e,i)},addLevelAndExpandNode:function(i,r){return t.addLevelAndExpandNode(e,i,r)},addAILevelAndExpandNode:function(i,r,o){return t.addAILevelAndExpandNode(e,i,r,o)},updateLevel:function(i,r){return t.updateLevel(e,i,r)},updateAILevel:function(i,r){return t.updateAILevel(e,i,r)},toggleLockedLevels:function(i){return t.toggleLockedLevels(e,i)},toggleNode:function(i){return t.toggleNode(e,i)}}}e.createQueryVisualHostServices=t,e.createVisualHostDecompositionService=i})(t=e.VisualHostServicesUtil||(e.VisualHostServicesUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,s,l,c,u,p){var d,h,g,f;if(!_.isEmpty(e))for(var y=0,m=e;y<m.length;y++){var C=m[y],S=v.bottom(C),w=v.right(C);C.top<=t.y&&S>=t.y?w<t.x?d=!d||w>v.right(d)?C:d:C.left>t.x&&(h=!h||C.left<h.left?C:h):C.left<=t.x&&w>=t.x&&(S<t.y?g=!g||S>v.bottom(g)?C:g:C.top>t.y&&(f=!f||C.top<f.top?C:f))}var b=r(t,d,g,h,f,i,c,u,p),x=b.result,E=b.flexibleDirection;return o(e,x,b.trimHorizontally),n(x,E,s,l),a(x,i,s,l),x}function r(e,t,i,r,o,n,a,s,l){var c,u={left:0,top:0,width:0,height:0},p=!1;return t&&i?(u.left=Math.max(v.right(t),i.left),u.top=Math.max(t.top,v.bottom(i)),u.width=v.right(i)-u.left,u.height=v.bottom(t)-u.top,c=10,p=!!r):t&&o?(u.left=Math.max(v.right(t),o.left),u.top=t.top,u.width=v.right(o)-u.left,u.height=Math.min(v.bottom(t),o.top)-u.top,c=6,p=!!r):r&&i?(u.left=i.left,u.top=Math.max(r.top,v.bottom(i)),u.width=Math.min(r.left,v.right(i))-u.left,u.height=v.bottom(r)-u.top,c=9):r&&o?(u.left=o.left,u.top=r.top,u.width=Math.min(r.left,v.right(o))-u.left,u.height=Math.min(v.bottom(r),o.top)-u.top,c=5):t?(u.left=Math.max(v.right(t)+l,e.x-t.width/2),u.top=t.top,u.width=t.width,u.height=t.height,c=14,p=!!r):i?(u.left=i.left,u.top=Math.max(v.bottom(i)+l,e.y-i.height/2),u.width=i.width,u.height=i.height,c=11):r?(u.left=Math.min(r.left-l,e.x+r.width/2)-r.width,u.top=r.top,u.width=r.width,u.height=r.height,c=13):o?(u.left=o.left,u.top=Math.min(o.top-l,e.y+o.height/2)-o.height,u.width=o.width,u.height=o.height,c=7):(u.left=e.x,e.x+a>n.width&&(u.left=n.width-a),u.top=e.y,e.y+s>n.height&&(u.top=n.height-s),u.width=a,u.height=s,c=15),u.height=Math.min(v.bottom(n)-u.top,u.height),u.width=Math.min(v.right(n)-u.left,u.width),{result:u,flexibleDirection:c,trimHorizontally:p}}function o(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];i?(c(t,n),u(t,n),s(t,n),l(t,n)):(s(t,n),l(t,n),c(t,n),u(t,n))}}function n(e,t,i,r){var o=h.hasFlag(t,1),n=h.hasFlag(t,2),a=h.hasFlag(t,4),s=h.hasFlag(t,8);if(e.width<i){var l=i-e.width;e.width=i,o&&n?e.left-=l/2:o&&(e.left-=l)}if(e.height<r){var l=r-e.height;e.height=r,a&&s?e.top-=l/2:a&&(e.top-=l)}}function a(e,t,i,r){e.left=Math.max(t.left,e.left),v.right(e)>t.width&&(e.width=t.width-e.left,e.width<i&&(e.left=Math.max(t.left,t.width-i),e.width=Math.min(t.width,i))),e.top=Math.max(e.top,t.top),v.bottom(e)>t.height&&(e.height=t.height-e.top,e.height<r&&(e.top=Math.max(t.top,t.height-r),e.height=Math.min(t.height,r)))}function s(e,t){if(p(t,e)){var i=v.bottom(t),r=i-e.top;e.top=i,e.height-=r}}function l(e,t){p(e,t)&&(e.height=t.top-e.top)}function c(e,t){if(d(e,t)){var i=v.right(t),r=i-e.left;e.left=i,e.width-=r}}function u(e,t){d(t,e)&&(e.width=t.left-e.left)}function p(e,t){return v.containsPoint(e,v.topRight(t),!0)||v.containsPoint(e,v.topLeft(t),!0)||v.containsPoint(t,v.bottomRight(e),!0)||v.containsPoint(t,v.bottomLeft(e),!0)}function d(e,t){return v.containsPoint(e,v.bottomRight(t),!0)||v.containsPoint(e,v.topRight(t),!0)||v.containsPoint(t,v.topLeft(e),!0)||v.containsPoint(t,v.bottomLeft(e),!0)}var h=jsCommon.EnumExtensions,v=e.visuals.shapes.Rect;t.getBestFitRectangle=i})(i=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.scrollCarouselToEndEventName="scrollCarouselToEnd",e.pinVisualContainerEventName="pinVisualContainer",e.saveReportBeforePinning="saveReportFromPinDialog",e.trustedVisualConsentStateChangedEventName="trustedVisualConsentStateChanged",e.invalidVisualContainerId=-1,e.updateNavButtonEvent="updateNavButtonEvent",e.ConnectionSetupLimit=4,e.smallFontSizeInPoint=9,e.TransformSelector="transform",e.MaxGroupingDepth=20;var t;!(function(e){e.AutoLayoutVisualPadding=10,e.AutoLayoutVisualVCHeader=20,e.AutoLayoutVisualSkittlesRightPadding=30,e.AutoLayoutMaxSpaceHeight=300,e.AutoLayoutMaxSpaceWidth=300,e.AutoLayoutMinSpaceHeight=150,e.AutoLayoutMinSpaceWidth=150,e.ResponsiveLayoutMaxWidthBreakpoint=500,e.ScrollbarOffset=15,e.DefaultCanvasUiScale={x:1,y:1},e.DisplayAreaHeightAdditionMinimumScale=.9,e.DisplayAreaHeightScaleAddtion=.02,e.DisplayAreaOverflowEpsilonPx=8,e.DisplayAreaOutlineSize=8,e.DisplayAreaTransparencyOutlineThreshold=50,e.PhoneAuthoringViewportHeight=558,e.PhoneAuthoringViewportWidth=324,e.PhonePortraitColumnCount=18,e.PhonePortraitRowCount=180,e.PhonePortraitCanvasHeight=3600,e.PhonePortraitColumnCountLegacy=6,e.PhonePortraitRowCountLegacy=60})(t=e.ExploreCanvasConstants||(e.ExploreCanvasConstants={}))})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.ExploreUIShellModule={name:"powerbi.exploreUIShell",dependency:{javascript:"ExploreUIShell/module",css:["exploreUIShell"]}},e.ExploreUIDialogsModule={name:"powerbi.explore.dialogs",dependency:{javascript:"ExploreUIDialogs/module",css:["exploreUIDialogs"]}}})(t=e.modules||(e.modules={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.visuals.GradientUtils,o=e.data.SQExprBuilder,n=e.data.SQRangePercentExpr;!(function(t){function i(e){return{solid:{color:a(e,r.getDefaultGradientSettings())}}}function a(t,i){var r,n={color:o.color(i.minColor,"minColor")},a=i.minValue;null!=a&&(r=o.double(a));var s,l;if(i.diverging){s={color:o.color(i.midColor,"midColor")};var c=i.midValue;null!=c&&(l=o.double(c))}var u,p={color:o.color(i.maxColor,"maxColor")},d=i.maxValue;null!=d&&(u=o.double(d));var h,v=i.nullStrategy,g=i.nullColor,f={};return h=i.diverging?f.linearGradient3={min:n,mid:s,max:p}:f.linearGradient2={min:n,max:p},r&&(h.min.value=r),l&&(h.mid.value=l),u&&(h.max.value=u),v&&(h.nullColoringStrategy={strategy:o.text(v)},v===e.NullStrategy.specificColor&&(h.nullColoringStrategy.color=o.color(g,"nullColor"))),o.fillRule(t,f)}function s(e,t){var i={condition:o.compare(3,e,o.double(0)),value:o.text(t)};return{solid:{color:o.conditional([i])}}}function l(e){return{kind:"Icon",value:o.conditional([c(e,.67,1,!0,o.text("CircleHigh")),c(e,.33,.67,!1,o.text("SignMedium")),c(e,0,.33,!1,o.text("SignLow"))]),
layout:o.text(t.DefaultIconLayout),verticalAlignment:o.text(t.DefaultIconVerticalAlignment)}}function c(e,t,i,r,a){var s,l;t>0&&(s=o.compare(2,e,n.overRangeOf(e,t))),i<1&&(l=o.compare(r?4:3,e,n.overRangeOf(e,i)));var c;return c=s&&l?o.and(s,l):s||l,{condition:c,value:a}}t.createDefaultGradientFillDefinition=i,t.createFillExpression=a,t.createDefaultConditionalFillDefinition=s,t.DefaultIconId="CircleHigh",t.DefaultIconLayout="Before",t.DefaultIconVerticalAlignment="Top",t.createDefaultIconDefinition=l,t.createIconCase=c})(i=t.ConditionalFormattingUtil||(t.ConditionalFormattingUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e,t,i,r,o,n){this.lazy=e,this.localizationService=t,this.modalDialogService=i,this.promiseFactory=r,this.telemetryService=o,this.visualAuthoring=n}return t.prototype.show=function(t,i,r,o,n,a,s){var l={fieldDisplayName:i,fieldExpr:r,repetition:n,schema:o,visual:t,fromPropertyPane:a,promiseFactory:this.promiseFactory,localizationService:this.localizationService,modalDialogService:this.modalDialogService,telemetryService:this.telemetryService,visualAuthoring:this.visualAuthoring,colorPalette:s},c=this.promiseFactory.defer();return this.lazy("dataBarsDialogBuilder").then((function(e){e.show(l).then((function(){c.resolve(void 0)})).catch((function(){c.reject()}))})),e.createRejectablePromise(c)},t})();t.DataBarsDialogLauncher=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,n,a,s,l){return new o(e,t,i,r,n,a,s,l)}i.createConditionalFormattingDialogLauncher=r;var o=(function(){function i(e,i,r,o,n,a,s,l){this.lazy=e,this.localizationService=i,this.modalDialogService=r,this.promiseFactory=o,this.visualAuthoring=n,this.itemPickerService=a,this.dataSourcesService=s,this.dataSourcesSerializer=t.services.createDataSourceSerializer(l)}return i.prototype.show=function(t,i,r,o,n){var a=this.dataSourcesSerializer.serializeDataSources(this.dataSourcesService.get()),s={targetExprDisplayName:i,targetExpr:r,repetition:o,propertyDefinition:n,visual:t,dataSources:a,promiseFactory:this.promiseFactory,localizationService:this.localizationService,modalDialogService:this.modalDialogService,visualAuthoring:this.visualAuthoring,itemPickerService:this.itemPickerService},l=this.promiseFactory.defer();return this.lazy("conditionalFormattingDialogBuilder").then((function(e){e.show(s).then((function(e){l.resolve(e)})).catch((function(){l.reject()}))})),e.createRejectablePromise(l)},i})();i.ConditionalFormattingDialogLauncher=o})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t){var i=[{name:"AdvancedFilter",blockType:2,consumerHostFlags:8491},{name:"DateTimePicker",blockType:2,consumerHostFlags:8203},{name:"DeleteVisualWarningDialog",blockType:1,consumerHostFlags:8491},{name:"DetailVisual",blockType:2,consumerHostFlags:8491},{name:"EsriConsentDialog",blockType:1,consumerHostFlags:8491},{name:"ExplorationFooter",blockType:2,consumerHostFlags:8491},{name:"ExploreCanvas",blockType:2,consumerHostFlags:8491},{name:"ExploreModeFieldList",blockType:2,consumerHostFlags:8491},{name:"ExploreModeFieldWell",blockType:2,consumerHostFlags:8491},{name:"InlineExploreVisualTypesContainer",blockType:2,consumerHostFlags:8491},{name:"Filter",blockType:2,consumerHostFlags:8491},{name:"FilterPane",blockType:2,consumerHostFlags:8491},{name:"FilterVisual",blockType:2,consumerHostFlags:8491},{name:"JqSelect",dependencies:[],blockType:1,consumerHostFlags:8491},{name:"IncludeExcludeFilter",blockType:2,consumerHostFlags:8491},{name:"ModelingContextChanger",blockType:1,consumerHostFlags:8491},{name:"PbiValidate",blockType:1,consumerHostFlags:8491},{name:"PropertyPaneTextBox",dependencies:["localizationService"],blockType:1,consumerHostFlags:9003},{name:"RelativeDateFilter",blockType:2,consumerHostFlags:8491},{name:"SectionAnimationSlider",blockType:1,consumerHostFlags:8491},{name:"SectionTabKeyHandler",blockType:1,consumerHostFlags:8491},{name:"SelectionBox",blockType:1,consumerHostFlags:8491},{name:"TaskPane",blockType:2,consumerHostFlags:8491},{name:"TopNFilter",blockType:2,consumerHostFlags:8491},{name:"VirtualList",blockType:1,consumerHostFlags:8491},{name:"VisualContainer",blockType:2,consumerHostFlags:8491},{name:"VisualContainerContextMenu",blockType:1,consumerHostFlags:8491},{name:"VisualContainerHeader",blockType:2,consumerHostFlags:8491},{name:"SingleVisualHost",blockType:2,consumerHostFlags:9003},{name:"VisualizationPane",blockType:2,consumerHostFlags:8491},{name:"VisualTooltip",blockType:2,consumerHostFlags:9003}];e.common.registerBuildingBlocksForHost(t,i,{componentsTarget:"powerbi.explore.components",componentsMap:e.explore.components,directivesTarget:"powerbi.explore.directives",directivesMap:e.explore.directives})}angular.module("powerbi.explore.controllers",[]),angular.module("powerbi.explore.directives",[]),angular.module("powerbi.explore.components",[]);var r=["powerbi.common","powerbi.explore.controllers","powerbi.explore.directives","powerbi.explore.components","powerbi.visualHost"];angular.module("powerbi.explore",r).factory("dataReaderExtensions",["promiseFactory",function(t){var i={};return e.explore.dataReaderPlugins.registerExplorationDataReaderExtension(i,t,!1),i}]).config(["lazyProvider",function(t){var i=t.factories;i.fieldWellViewModelFactory={source:{javascript:"ExploreUIShell/viewModels/fieldWellViewModelFactory"},ng:["aggrOps","displayNameService","featureSwitchService","geoTaggingAnalyzerService","localizationService","promiseFactory","fieldWellPropertyViewModelFactory"],fn:function(e,t,i,r,o,n,a,s){return e.create(t,i,r,o,n,a,s)}},i.instantEmail={source:{javascript:"PowerBISidePanes/services/instantEmailService"},ng:["taskPaneSliderService"],fn:function(e,t){return e.create(t)}},i.conditionalFormattingDialogBuilder={source:{javascript:"ExploreUIDialogs/dialogs/conditionalFormattingDialog/conditionalFormattingDialogBuilder"},fn:function(e){return new e.ConditionalFormattingDialogBuilder}},i.dataBarsDialogBuilder={source:{javascript:"ExploreUIDialogs/dialogs/dataBarsDialog/dataBarsDialogBuilder"},fn:function(e){return new e.DataBarsDialogBuilder}},i.tableViewDialogBuilder={source:{javascript:"ExploreUIDialogs/dialogs/tableViewDialog/tableViewDialogBuilder"},ng:["modalDialogService"],fn:function(e,t){return e.create(t)}},i.explorationStateDiffer={source:{javascript:"Explore/services/explorationStateDiffer"},fn:function(e){return e}},i.insightsService={source:{javascript:"Insights/services/insightsService"},ng:["embedModeService","errorService","localizationService","telemetryService","impersonationService"],modular:["insightsCache","insightsRuntime"],fn:function(e,t,i,r,o,n,a,s){return e.create(a,s,o,i,r,t,n)}},i.insightsCache={source:{javascript:"Insights/services/insightsCacheService"},ng:["featureSwitchService","globalEventBridge"],fn:function(e,t,i){return e.create(t,i)}},i.insightsRuntime={source:{javascript:"Insights/proxies/insightsHttpRuntime"},ng:["promiseFactory","syncService","featureSwitchService"],fn:function(t,i,r,o){return t.create(e.common.httpService,i,r,o)}}}]).factory("reportTileService",["promiseFactory","explorationProxy","$timeout",function(t,i,r){return e.explore.services.createReportTileService(t,i,r)}]).factory("daxParserService",["promiseFactory",function(t){return e.explore.services.createDaxParserService(t)}]).directive("datepickerPopup",(function(){return{restrict:"EAC",require:"ngModel",link:function(e,t,i,r){r.$formatters.shift()}}})).factory("subscription",["taskPaneSliderService","userInfo","localizationService",function(t,i,r){return e.explore.services.createSubscriptionPaneService(t,i,r)}]).run(["lazyScopedFactories",function(e){e.clustering={source:{javascript:"ExploreUI/services/clustering"},ng:["conceptualSchemaProxy","errorService","explorationSerializer","localizationService","modalDialogService","promiseFactory","telemetryService"],scoped:["clusteringState","groupingDesignStateService","modelChangeHandler","visualAuthoring","visualPlugin"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d){return e.create(t,null,l,c,p,d,i,o,u,n,a,s,r)}},e.drillthrough={source:{javascript:"ExploreActions/services/drillthrough"},ng:["conceptualSchemaProxy","drillthroughNavigatorProvider"],scoped:["eventBridge","dataSources","explorationNavigation","explorationStateManager"],fn:function(e,t,i,r,o,n,a){return e.create(r,t,o,n,a,i)}},e.insightsAnalysisService={source:{javascript:"Insights/services/insightsAnalysisService"},ng:["displayNameService","localizationService","featureSwitchService"],scoped:["visualPluginOps","visualPlugin"],fn:function(e,t,i,r,o,n){return e.create(t,o,i,r,n)}},e.bookmark={source:{javascript:"ExploreUIShell/services/bookmarkService"},ng:["conceptualSchemaProxy","featureSwitchService","localizationService","telemetryService"],scoped:["dataSources","eventBridge","explorationNavigation","explorationStateManager","lazyScopedSync","selection","viewModeState","undoRedo"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d){return e.create(t,n,a,l,c("explorationStateApplier"),s,r,u,p,d,o)}},e.canvasListOrderingService={source:{javascript:"ExploreUIShell/services/canvasListOrderingService"},ng:["canvasListOrderNormalize"],scoped:["visualAuthoring","visualAuthoringOperations","formFactor"],fn:function(e,t,i,r,o){return e.create(t,i,r,o)}},e.tabOrder={source:{javascript:"ExploreUIShell/services/tabOrderService"},scopedModular:["canvasListOrderingService"],fn:function(e,t){return e.create(t)}},e.zIndex={source:{javascript:"ExploreUIShell/services/zIndexService"},scopedModular:["canvasListOrderingService"],fn:function(e,t){return e.create(t)}},e.explorationAuthoring={source:{javascript:"ExploreUIShell/services/explorationAuthoring"},ng:["explorationSerializer","linguisticSchemaProxy","localizationService","promiseFactory","telemetryService","featureSwitchService"],scoped:["eventBridge","explorationNavigation","undoRedo","explorationActivity"],fn:function(e,t,i,r,o,n,a,s,l,c,u){return e.create(c,i,s,t,l,r,u,n,o,a)}},e.visualHostTooltipActionsProvider={source:{javascript:"ExploreUIShell/services/visualHostTooltipActionsProvider"},ng:["telemetryService"],scoped:["explorationNavigation","drill","dataSources","lazyScoped","visualAuthoring","visualPluginOps"],fn:function(e,t,i,r,o,n,a,s){return e.create(i,r,o,n,s,t,a)}},e.qnaExplore={source:{javascript:"InfoNavBootstrap/services/qnaExplore"},ng:["$compile","$timeout","featureSwitchService","errorService","localizationService"],scoped:["lazyScoped","eventBridge"],fn:function(e,t,i,r,o,n,a,s){return e.create(t,i,r,s,a,o,n)}},e.canvasPopout={source:{javascript:"ExploreUIDialogs/services/canvasPopoutService"},ng:["$templateCache","$compile","overlayService","promiseFactory"],scoped:["eventBridge","explorationNavigation","explorationCapabilities","modelChangeHandler"],fn:function(e,t,i,r,o,n,a,s,l){return e.create(t,i,r,n,a,s,l,o)}},e.exportVisualData={source:{javascript:"ExploreUIShell/services/exportVisualDataService"},ng:["aggrOps","conceptualSchemaProxy","singleExecutableDataProxyFactory","geoTaggingAnalyzerService","featureSwitchService","promiseFactory","displayNameService","localizationService","localeProviderService","exportToExcelProxy"],scoped:["visualPlugin","visualQueryGenerator"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d){return e.create(p,d,r.create(),i,t,o,n,a,s,l,c,u)}},e.userEmulationService={source:{javascript:"ExploreUI/services/userEmulationService"},scoped:["eventBridge"],fn:function(e,t){return e.create(t)}}}]).run(["lazyScopedSyncFactories",function(t){t.explorationStateApplier={ng:["dataProxy","featureSwitchService"],scoped:["explorationNavigation","explorationStateManager","visualSync"],fn:function(t,i,r,o,n){return e.explorationStateApplierModuleFactory().create(t,o,r,i,n)}}}]).run(["scopedProvider",function(i){i.register("bubblingEventBridge",{fn:function(){return e.common.createEventBridge()}}).register("itemPicker",{fn:function(){return e.common.createItemPickerService()}}).register("groupAuthoring",{services:["telemetryService"],fn:function(t){return e.explore.services.createDisabledGroupAuthoringService(t)}}).register("importVisual",{services:["localFileService","localizationService","modalDialogService","notificationToast","promiseFactory","telemetryService","upload"],scopedServices:["eventBridge","visualPlugin"],fn:function(t,i,r,o,n,a,s,l,c){return e.exploreui.services.createImportVisualService(t,i,r,o,n,a,s,l,c)}}).register("hostFiltersService",{services:["conceptualSchemaProxy","singleExecutableDataProxyFactory","promiseFactory"],scopedServices:["eventBridge"],fn:function(t,i,r,o){return e.explore.services.createHostFiltersService(t,i,r,o)}}).register("scriptVisuals",{services:["featureSwitchService","localizationService","userInfo","embedModeService","licenseEnforcementService"],scopedServices:["visualPlugin"],fn:function(t,i,r,o,n,a){return e.explore.services.createScriptVisualsService(a,t,i,r,o,n)}}).register("conditionalFormattingDialogLauncher",{services:["explorationSerializer","lazy","localizationService","modalDialogService","promiseFactory"],scopedServices:["itemPicker","dataSources","visualAuthoring"],fn:function(e,i,r,o,n,a,s,l){return t.dialogs.createConditionalFormattingDialogLauncher(i,r,o,n,l,a,s,e)}}).register("modelAuthoring",{services:["promiseFactory","telemetryService","modalDialogService","localizationService","daxParserService","explorationSerializer","cultureService","uiBlockingService"],scopedServices:["modelChangeHandler","explorationNavigation"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d){return e.explore.services.createModelAuthoringService(t,i,c,r,o,u,p,d,n,a,s,l)}}).register("groupQueryService",{services:["conceptualSchemaProxy","promiseFactory","singleExecutableDataProxyFactory"],scopedServices:["filterGenerator","visualQueryGenerator","visualPlugin","explorationCapabilities"],fn:function(e,i,r,o,n,a,s){return t.services.createGroupQueryService(r,o,e,n,i,a,s)}}).register("schemaItemActivation",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSchemaItemActivationService(t)}}).register("pinVisual",{services:["conceptualSchemaProxy","displayNameService","singleExecutableDataProxyFactory","featureSwitchService","resourcePackagesService"],scopedServices:["visualQueryGenerator","visualPlugin","visualPluginOps","visualCapabilitiesService"],fn:function(t,i,r,o,n,a,s,l,c){return e.explore.services.createPinVisualService(t,i,r.create(),o,n,a,s,l,c)}})}]),t.registerBuildingBlocksForHost=i})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.value.dateValue;e.value.value=a.formatValue(t,"d")}var o=t.services.events,n=t.contracts.FilterType,a=e.formattingService,s=e.common.utils.IdUtility,l=e.data.SemanticFilter,c=e.common.directives.TooltipAnchorElementType,u=(function(){function e(e,t){var i=this;this.services=t;var r=function(e){return i.onFilterChanged({args:e})};this.core=new p(r,this.services)}return Object.defineProperty(e.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(e){this.core.viewModel=e},enumerable:!0,configurable:!0}),e.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","highContrastCssGenerationService","overlayService","telemetryService","localizationService","tooltipService"],scopedDependencies:["dataSources","eventBridge","explorationActivity","explorationNavigation","undoRedo","viewModeState","visualAuthoring","visualPlugin"]}},e.prototype.$onInit=function(){this.core.$onInit()},e.prototype.$onDestroy=function(){this.core.$onDestroy()},e.prototype.timeSelected=function(e){if(e.value.value&&e.value.value instanceof Date){var t=e.value.timePickerValue.getHours(),i=e.value.timePickerValue.getMinutes();e.value.dateValue=new Date(e.value.value.setHours(t,i)),r(e)}else e.value.dateValue=e.value.timePickerValue,r(e);this.core.updateConditionsValid(),this.core.markDirty()},e.prototype.dateTextUpdated=function(e){var t=a.parseDate(e.value.value);t&&(e.value.dateValue=t)},e.prototype.dateTextUpdateComplete=function(e){_.isString(e.value.value)&&r(e)},e})();i.AdvancedFilterController=u;var p=(function(){function i(e,t){this.onFilterChanged=e,this.services=t,this.moduleConfig={name:"ui.bootstrap",dependency:{javascript:"angular-ui-datetimepicker"}},this.tooltipConfig={tooltipLocalizeTitle:"AdvancedFilter_InvalidTooltip",tooltipAnchorElementSelector:"input[type='text']:first",tooltipAnchorElementType:c.Sibling},this.menuIds={},this.isDirty=!1}return i.prototype.$onInit=function(){var t=this;e.zoneify(this.currentZone,(function(){return t.onInitImpl()}))},i.prototype.onInitImpl=function(){this.initialize(),this.initializeHighContrastRules(),this.viewModel.setServices(void 0,void 0,this.services.viewModeState)},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.initialize=function(){var i=this;this.getConceptualSchema().then((function(e){i.advFilterCard=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(i.viewModel.contract),i.updateRestatement(),i.updateModel(e),i.formatDate(i.advFilterCard),i.subscriptionManager=i.services.eventBridge.createChannelSubscriptionManager().subscribe(o.applyAllClicked,(function(){return i.applyFilter()})).subscribe(o.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)}))})).catch((function(){return i.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Conceptual schema could not be found.")}))},i.prototype.markDirty=function(){this.isDirty=!0,this.isApplyAllEnabled()&&this.canApplyFilter()&&t.FilterUtils.notifyBufferedFilterChanges(this.services.eventBridge,this.viewModel.getFilterContainerScope().scopeType,t.contracts.FilterType.Advanced,this.viewModel.id,!0)},i.prototype.clearDirty=function(){this.isDirty=!1},i.prototype.getMenuId=function(e){return this.menuIds[e]||(this.menuIds[e]=s.generateId()),this.menuIds[e]},i.prototype.initializeHighContrastRules=function(){this.services.highContrastCssGenerationService.addRule(".themeableElement .advancedControl.conditionValue","{ border-color: @buttonForegroundColor !important; }")},i.prototype.updateModel=function(t){if(this.advFilterCard.loadOperators(t,this.services.aggrOps),!this.advFilterCard.operators)return void this.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Filter operators failed to load.");var i=this.advFilterCard.field,r=i.getMetadata(t);r&&(this.advFilterCard.isDateTime=!!r.type.dateTime),this.advFilterCard.ensureConditions();var o=this.advFilterCard.conditions;this.viewModel.updateFilterProperties(t,this.services.visualPlugin,this.services.aggrOps);for(var n=0,a=o;n<a.length;n++){var s=a[n];s&&s.value&&(s.value.formatter=this.viewModel.formatter)}this.updateConditionsValid(t),this.viewModel.updateViewState()},i.prototype.applyFilter=function(){var i=this,r=this.viewModel;r.contract.type=n.Advanced,document.activeElement.blur(),this.services.explorationActivity.doActivityAsync((function(e){return i.getConceptualSchema().then((function(t){i.services.undoRedo.register("ApplyAdvancedFilter",(function(){if(i.updateConditionsValid(t),!i.canApplyFilter())return e(),!1;var r,o=i.advFilterCard.toSQExpr(t),n=i.viewModel;o?(i.services.visualAuthoring.updateFilter(n.getFilterContainerScope(),n.contract,l.fromSQExpr(o)),r=2):(i.services.visualAuthoring.updateFilter(n.getFilterContainerScope(),n.contract,void 0),r=10),i.clearDirty(),n.useDefaultFilter=!1,i.updateRestatement();var a={filter:i.viewModel.contract,changeType:r,scope:i.viewModel.getFilterContainerScope(),source:i.viewModel};return i.onFilterChanged(a),i.formatDate(i.advFilterCard),!0}))}))}),(function(o){return i.services.telemetryService.startActivity(o,e.telemetry.EXFilterPaneAdvancedFilterApplied,r.isVisualFilter,t.contracts.FilterType.Advanced,t.util.getTelemetryViewMode(i.services.viewModeState.getMode()),r.isInOutspacePane)}))},i.prototype.validateFilterInput=function(e){var t=this;this.getConceptualSchema().then((function(i){e.value&&e.value.value&&!t.advFilterCard.isConditionValid(i,e)?e.isInvalid=!0:(e.isInvalid=!1,t.services.tooltipService.hideTooltip())}))},i.prototype.formatDate=function(e){if(e.isDateTime)for(var t=0,i=e.conditions;t<i.length;t++){var o=i[t];r(o)}},i.prototype.handleFocusedInputChanged=function(e,t){this.validateFilterInput(t)},i.prototype.handleInputBlur=function(){this.services.tooltipService.hideTooltip()},i.prototype.dateSelected=function(e){this.services.overlayService.hideAllDropdowns(),e.value.dateValue&&r(e),this.updateConditionsValid(),this.markDirty()},i.prototype.changeOperator=function(e){39!==e.keyCode&&37!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode||(0===this.advFilterCard.logicalOperator?this.advFilterCard.logicalOperator=1:this.advFilterCard.logicalOperator=0,$(e.target).siblings().attr("tabindex","0").focus(),e.stopPropagation(),this.markDirty())},i.prototype.timePickerSelected=function(e){e.value.value?(e.value.dateValue=this.addTimeToDate(e.value.timePickerValue,e.value.value),r(e)):(e.value.dateValue=e.value.timePickerValue,r(e)),this.updateConditionsValid(),this.markDirty()},i.prototype.dateUpdated=function(e){e.value.dateValue=this.addTimeToDate(e.value.dateValue,e.value.value)},i.prototype.addTimeToDate=function(e,t){var i=new Date(t);if(null!=e){var r=e.getHours(),o=e.getMinutes();return new Date(i.setHours(r,o))}return i},i.prototype.updateRestatement=function(){var e=this.viewModel;e.useDefaultFilter||e.contract.type!==n.Advanced||e.setRestatement(this.advFilterCard.getRestatement(e.formatter))},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(e)},i.prototype.updateConditionsValid=function(e){var t=this;null!=e?this.conditionsValid=this.advFilterCard.areConditionsValid(e):this.getConceptualSchema().then((function(e){t.conditionsValid=t.advFilterCard.areConditionsValid(e)}))},i.prototype.onFilterContainerChanged=function(e){var i=this.viewModel;if(e.filter===i.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)){var r=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(e.filter);this.advFilterCard.conditions=r.conditions,this.advFilterCard.logicalOperator=r.logicalOperator,this.updateRestatement(),this.advFilterCard.ensureConditions()}},i.prototype.canApplyFilter=function(){return this.isDirty&&!this.viewModel.readOnlyState.disabled&&this.conditionsValid},i.prototype.onKeyUp=function(e){e.preventDefault();var t=e.keyCode||e.which;this.isApplyAllEnabled()||13!==t||this.applyFilter()},i.prototype.getLocalizedPlaceholder=function(){return a.getCurrentCulture().calendar.patterns.d},i.prototype.isApplyAllEnabled=function(){var e=this.services.explorationNavigation.getCurrentExploration();return!(!e||!e.slowDataSourceSettings)&&e.slowDataSourceSettings.isApplyAllButtonEnabled},i})();i.AdvancedFilterCore=p})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.AdvancedFilter={templateUrl:"components/advancedFilter/advancedFilter.html",bindings:{viewModel:"<",onFilterChanged:"&"},controller:e.common.createController(t.AdvancedFilterController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.utils.IdUtility,r=(function(){function e(e,t){this.moduleConfig={name:"ui.bootstrap",dependency:{javascript:"angular-ui-datetimepicker"}},this.services=t,this.id=i.generateId(),this.calendarButtonText=this.services.localizationService.get("GroupNavigationPaneContextMenuItem_Calendar")}return e.createOptions=function(){return{additionalServices:["overlayService","localizationService"]}},e.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){if(_.isNumber(e.ngModel.$viewValue)){var t=new Date(e.ngModel.$viewValue);"Invalid Date"!==t.toString()?e.ngModel.$setViewValue(t):e.ngModel.$setViewValue(void 0)}else void 0===e.ngModel.$viewValue?(e.textVal=void 0,e.dateVal=void 0,e.inputInvalid=!1):e.inputInvalid||(e.dateVal=e.ngModel.$viewValue,e.textVal=e.ngModel.$viewValue.toLocaleDateString()+" "+e.ngModel.$viewValue.toLocaleTimeString())}},e.prototype.$onChanges=function(e){e&&e.validators&&void 0!==this.textVal&&this.validateTextInput()},e.prototype.dateSelected=function(){this.inputInvalid=!1,this.textVal=this.dateVal.toLocaleDateString()+" "+this.dateVal.toLocaleTimeString(),this.ngModel.$setViewValue(this.dateVal),this.services.overlayService.hideAllDropdowns()},e.prototype.dateTextUpdated=function(){this.validateTextInput(),this.inputInvalid||this.ngModel.$setViewValue(this.dateVal)},e.prototype.validateTextInput=function(){if(this.textVal){var e=new Date(this.textVal);this.inputInvalid="Invalid Date"===e.toString(),this.validators&&(this.inputInvalid=this.inputInvalid||e<this.validators.min||e>this.validators.max),this.inputInvalid||(this.dateVal=e)}else this.textVal=void 0,this.dateVal=void 0,this.inputInvalid=!1},e})();t.DateTimePickerController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DateTimePicker={templateUrl:"components/dateTimePicker/dateTimePicker.html",bindings:{placeholder:"<",validators:"<",labelId:"<"},require:{ngModel:"ngModel"},controller:e.common.createController(t.controllers.DateTimePickerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.data.SQConstantExpr,a=e.data.SQExprBuilder,s=e.visuals.TablixPropertyManager,l=e.explore.util.VisualContainerUtils,c=(function(){function e(e,t){this.$scope=e,this.services=t}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","featureSwitchService","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationCapabilities","explorationNavigation","filterGenerator","visibility","visualPlugin","visualAuthoring","visualQueryGenerator"]}},e.prototype.$onInit=function(){this.core=new u(this.$scope,this.services),this.core.viewModel=this.viewModel,this.core.$onInit(),this.modernVisual=this.services.featureSwitchService.featureSwitches.useVisualModern},e.prototype.$onChanges=function(e){this.core&&e.viewModel&&(this.core.viewModel=e.viewModel.currentValue,this.core.$onChanges(e))},e.prototype.$onDestroy=function(){this.core&&this.core.$onDestroy()},e})();i.DetailVisualController=c;var u=(function(){function i(e,i){this.$scope=e,this.services=i,this.spinnerService=t.services.createDetailVisualSpinnerService(this.$scope)}return i.prototype.$onInit=function(){this.dataProxy=this.services.singleExecutableDataProxyFactory.create(),this.visualDataProxyService=t.services.createExploreVisualDataProxyService(this.dataProxy,this.services.filterGenerator,this.services.promiseFactory,this.services.visualPlugin,this.services.explorationCapabilities),this.queryVisualHostServices=this.createQueryVisualHostServices(),this.initializeVisual()},i.prototype.$onDestroy=function(){this.subscriptionManager&&this.subscriptionManager.unsubscribeAll()},i.prototype.$onChanges=function(e){e.viewModel&&!this.isInitialized&&this.initializeVisual()},i.prototype.initializeVisual=function(){var i=this;if(this.viewModel&&this.viewModel.parentContract){var r=this.viewModel.parentContract,n=this.viewModel.visual;n.visualPlugin=this.services.visualPlugin,n.interactivityOptions={isInteractiveLegend:!1,selection:!1},n.type=2===r.visibility?e.visuals.plugins.pivotTable.name:e.visuals.plugins.accessibleTable.name,n.hostServices=e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return i.persistProperties(e)},e.getLocalizedString=function(e){for(var t,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return(t=i.services.localizationService).format.apply(t,[e].concat(r))},e.getViewMode=function(){return 1},e.loadMoreData=function(){i.runQuery(!1,!1,!0)}})),this.initializeDetailVisualContract(n.type),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerChanged,(function(e,t){t&&i.viewModel.parentContract&&t.affectContainer(i.viewModel.parentContract)&&i.runQuery(!1)})).subscribe(o.filterContainerChanged,(function(e,t){0===t.scope.scopeType&&t.scope.container!==i.viewModel.parentContract||i.runQuery(!1)})).subscribe(o.parentExpandCollapseAction,(function(e,t){t.visualContainer===i.viewModel.parentContract&&i.runQuery(!1)})),this.runQuery(!0),this.isInitialized=!0}},i.prototype.initializeDetailVisualContract=function(e){this.detailVisualContract={name:this.viewModel.parentContract.name,config:{singleVisual:{visualType:e}},layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:{x:0,y:0,width:0,height:0}}])}},i.prototype.updateSubtotalState=function(){var t=this.viewModel.parentContract,i=!1,o=!1;if(t.config&&t.config.singleVisual)if("pivotTable"===t.config.singleVisual.visualType){if(i=!0,o=!0,t.config.singleVisual.objects){var l=r.getValue(t.config.singleVisual.objects,s.PropSubTotalsPivotTableColumnSubtotals,void 0);l&&l.value&&(o=n.getBooleanValue(l)),l=r.getValue(t.config.singleVisual.objects,s.PropSubTotalsPivotTableRowSubtotals,void 0),l&&l.value&&(i=n.getBooleanValue(l))}}else"tableEx"===t.config.singleVisual.visualType?i=!0:t.config.singleVisual.visualType===e.visuals.plugins.waterfallChart.name&&(o=!0);var c=this.detailVisualContract.config.singleVisual.objects||{};r.setValue(c,s.PropSubTotalsPivotTableRowSubtotals,null,a.boolean(i)),r.setValue(c,s.PropSubTotalsPivotTableColumnSubtotals,null,a.boolean(o)),this.detailVisualContract.config.singleVisual.objects=c},i.prototype.persistProperties=function(e){var t=this.detailVisualContract,i=_.isArray(e)?{replace:e}:e;this.services.visualAuthoring.persistProperties(i,t,!0)&&this.runQuery(!1,!0)},i.prototype.runQuery=function(e,t,i){var r=this;if(void 0===i&&(i=!1),this.viewModel&&this.viewModel.parentContract){this.updateSubtotalState();var o=this.viewModel.parentContract,n=this.services.dataSources.get();n&&o.config&&o.config.singleVisual&&(i&&!this.visualDataProxyService.canLoadMore()||(this.spinnerService.startSpinner(),this.services.conceptualSchemaProxy.get(n).then((function(o){var a=r.viewModel.parentContract,s={dataSources:n,schema:o,config:a.config.singleVisual,hostServices:r.queryVisualHostServices,visualQueryGenerator:r.services.visualQueryGenerator,executionType:i?1:2,preferCurrentData:t,additionalDataViewKinds:2};return r.visualDataProxyService.runQuery(s).then((function(t){return r.onDataChanged(t,e,i)}),(function(t){return r.clearData("Query error",e)}))}),(function(t){return r.clearData("Conceptual schema error",e)})).finally((function(){return r.spinnerService.stopSpinner()}))))}},i.prototype.clearData=function(e,t){var i=this.viewModel,r={dataView:{metadata:{columns:[]},matrix:{rows:{root:{children:[],childIdentityFields:[]},levels:[]},columns:{root:{children:[]},levels:[]},valueSources:[]}},dataViewSource:null};i.visual.dataTransforms={},i.visual.data=r,i.hasData=!1},i.prototype.onDataChanged=function(i,r,o){var n;if(n=i?{dataView:i&&i.dataReaderResult?i.dataReaderResult.dataView:null,dataViewSource:i&&i.dataViewSource?i.dataViewSource:null}:this.viewModel.visual.data){var a=n.dataView;if(a&&!a.matrix){return void this.clearData("No matrix data view",r)}var s=l.isSegment(n.dataView);s&&(n.isFirstSegment=s);
var c;if(null!=a){var u=this.visualDataProxyService.lastExecutedQuery(),p=l.getDataRolesForVisual(this.viewModel.parentContract,this.services.visualPlugin),d=_.map(p,(function(e){return e.name})),h=t.util.MatrixVisualDataViewConverter.generate(a,u.transforms.selects,u.transforms.splits,d,u.transforms.roles&&u.transforms.roles.ordering,this.services.featureSwitchService);if(c=h?h.transformActions:void 0,n.dataView=h&&h.dataView?h.dataView:n.dataView,!c)return void this.clearData("Failed to generate data view transform actions",r);c.objects=this.detailVisualContract.config.singleVisual.objects}o&&(a=this.viewModel.visual.data.dataView,e.data.segmentation.DataViewMerger.mergeDataViews(a,n.dataView),n.dataView=a),this.viewModel.visual.dataTransforms=c,this.viewModel.visual.data=n,this.viewModel.hasData=!0}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateDetailVisualFilter(r.getCurrentExploration(),r.getCurrentSection(),i.viewModel.parentContract,t,1)},e.getDataSourceVariables=function(){var e=i.services.explorationNavigation.getCurrentExploration();return void 0!==e?e.dataSourceVariables:void 0}}))},i})();i.DetailVisualComponentCore=u})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DetailVisual={templateUrl:"components/detailVisual/detailVisual.html",bindings:{viewModel:"<"},controller:e.common.createController(t.controllers.DetailVisualController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.events,o=(function(){function i(e,i){var o=this;this.scope=e,this.services=i,this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.renameSection,(function(e,t){return o.renameSection(t)})),this.exploreUIShellConfig=t.modules.ExploreUIShellModule}return i.createOptions=function(){return{additionalServices:["dropdown"],scopedDependencies:["eventBridge","formFactor","lazyScoped","undoRedo","viewModeState"]}},i.prototype.isBookmarkView=function(){return null!=this.services.viewModeState.getViewState().bookmarkView},i.prototype.createSection=function(){this.services.eventBridge.publishToChannel(r.createSection)},i.prototype.seeAllSections=function(e){var t=this,i={items:[]},o=this.isReadingMode();_.forEach(this.viewModel.exploration.sections,(function(e,r){o&&t.isHiddenInViewMode(e)||i.items.push({key:r,text:e.displayName,type:0,selected:e.selected})})),this.services.dropdown.showContextMenu(i,{x:e.pageX,y:e.pageY},(function(e){return t.services.eventBridge.publishToChannel(r.switchSection,{index:e})}),!0,void 0,!0,!0)},i.prototype.isEditMode=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canAddRemoveSections()},i.prototype.isReadingMode=function(){return 0===this.services.viewModeState.getMode()},i.prototype.getModeString=function(){return this.isEditMode()?"editing":this.isReadingMode()||1===this.services.viewModeState.getMode()&&1===this.services.formFactor.getCurrentLayout()?"reading":void 0},i.prototype.isHiddenInViewMode=function(e){return!!(1&e.contract.visibility)},i.prototype.isOnlySectionVisibleInViewMode=function(e){if(this.isHiddenInViewMode(e))return!1;for(var t=0,i=this.viewModel.exploration.sections;t<i.length;t++){var r=i[t];if(r!==e&&!this.isHiddenInViewMode(r))return!1}return!0},i.prototype.renameSection=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.services.lazyScoped("explorationAuthoring")];case 1:return e=i.sent(),e.renameSection(this.viewModel,t.sectionNewName,t.sectionIndex),[2]}}))}))},i})();i.ExplorationFooterController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.ExplorationFooter={templateUrl:"components/explorationFooter/explorationFooter.html",bindings:{viewModel:"<"},controller:e.common.createController(e.explore.controllers.ExplorationFooterController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=(function(){function t(){this.exploreUIShellConfig=e.modules.ExploreUIShellModule}return t})();t.ExploreModeFieldListController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=(function(){function t(){this.exploreUIShellConfig=e.modules.ExploreUIShellModule}return t})();t.ExploreModeFieldWellController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.ArrowVerticalPosition,o=e.explore.util.DragDropTypes,n=jsCommon.DropPosition,a=e.explore.services.events,s=e.explore.constants.ExploreCanvasConstants,l=t.services.selectionUtils,c=(function(){function e(e,t){this.core=new u(t)}return Object.defineProperty(e.prototype,"isInOutspacePane",{get:function(){return this.core.isInOutspacePane},set:function(e){this.core.isInOutspacePane=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sectionObjects",{get:function(){return this.core.sectionObjects},set:function(e){this.core.sectionObjects=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchFiltersInput",{get:function(){return this.core.searchFiltersInput},set:function(e){this.core.searchFiltersInput=e},enumerable:!0,configurable:!0}),e.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","featureSwitchService","localizationService","promiseFactory","telemetryService","dropdown"],scopedDependencies:["dataSources","eventBridge","explorationCapabilities","explorationNavigation","scriptVisuals","selection","viewModeState","visualAuthoring","visualPlugin","visualPluginOps"]}},e.prototype.$onInit=function(){this.core.$onInit()},e.prototype.$onDestroy=function(){this.core.$onDestroy()},e.prototype.$onChanges=function(e){this.core.$onChanges(e)},e})();i.FilterPaneController=c;var u=(function(){function i(e){this.services=e;var i=this.services.explorationNavigation.getCurrentExploration();this.viewModel=t.viewModels.ViewModelFactory.createFilterPane(this.services.localizationService,null!=i),this.filterPaneDropConfig={accept:o.Field,greedy:!1},this.services.featureSwitchService.featureSwitches.filterPaneCustomSort&&(this.filterDropConfig={accept:o.Filter+" "+o.Field,greedy:!1},this.dropZoneDropConfig={accept:o.Field,greedy:!1}),this.exploreUIShellConfig=t.modules.ExploreUIShellModule,this.invalidFilterChanges={},this.validFilterChanges={}}return i.prototype.$onInit=function(){var t=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(a.selectionChanged,(function(){return t.updateSelection()})).subscribe(a.visualTypeChanged,(function(){return t.updateSelection()})).subscribe(a.modelChanged,(function(){return t.onModelChanged()})).subscribe(a.canvasChanged,(function(){return t.onCanvasChanged()})).subscribe(a.explorationLoaded,(function(){return t.onModelChanged()})).subscribe(a.visualContainerChanged,(function(e,i){return t.onVisualContainerChanged(i)})).subscribe(a.explorationFiltersContainerChanged,(function(e,i){return t.onExplorationFiltersContainerChanged(i)})).subscribe(a.sectionFiltersContainerChanged,(function(e,i){return t.onSectionFiltersContainerChanged(i)})).subscribe(a.filterContainerChanged,(function(e,i){return t.onFilterContainerChanged(i)})).subscribe(a.applyAllBufferedFilterCardChanged,(function(e,i){return t.onApplyAllFilterCardBufferedChanges(i)})).subscribe(a.explorationSlowDataSourceSettingsLoaded,(function(i,r){return e.zoneify(t.services.explorationNavigation.getCurrentZone(),(function(){r.isApplyAllButtonEnabledChanged&&(t.onApplyAllClicked(),t.updateisApplyAllSettingOn())}))})),this.filterPaneHeaderLocalization_Visual="FilterPane_Visual"+(this.isInOutspacePane?"_OutspacePane":""),this.filterPaneHeaderLocalization_Page="FilterPane_Page"+(this.isInOutspacePane?"_OutspacePane":""),this.filterPaneHeaderLocalization_Report="FilterPane_Report"+(this.isInOutspacePane?"_OutspacePane":""),this.updateisApplyAllSettingOn(),this.updateSelection(),this.onModelChanged()},i.prototype.getFilterPaneDropConfig=function(){if(!this.isInOutspacePane||!this.customSortEnabled()&&this.isSearchTextNullOrEmpty())return this.filterPaneDropConfig},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.$onChanges=function(e){e.sectionObjects&&this.updateFormatting(e.sectionObjects.currentValue)},i.prototype.getDropConfigForVisualFilters=function(){if(!this.isInOutspacePane||this.customSortEnabled(0)&&this.isSearchTextNullOrEmpty())return this.filterDropConfig},i.prototype.getFilterDropConfig=function(){if(!this.isInOutspacePane||this.isSearchTextNullOrEmpty())return this.filterDropConfig},i.prototype.getOptionsMenuTooltipConfig=function(){return{tooltipArrowVerticalPosition:r.top,tooltipTitle:this.services.localizationService.get("Options_Menu"),tooltipShowOnFocus:!0}},i.prototype.updateFormatting=function(t){if(this.isInOutspacePane){var i=t&&t.outspacePane,r=e.DataViewObject.getValue(i,"fontFamily",s.DefaultOutspacePaneFontFamily);this.headerFontFamily=r;var o=e.DataViewObject.getValue(i,"headerSize",s.DefaultOutspacePaneHeaderSizePt);this.headerFontSize=o+"pt"}},i.prototype.getMenuItems=function(){var e={items:[]},t={checked:!1,text:this.services.localizationService.get("FilterPane_Filter_Sort_AZ"),key:1,type:0,showIcon:!0,icon:"glyphicon pbi-glyph-atoz glyph-small"},i={checked:!1,text:this.services.localizationService.get("FilterPane_Filter_Sort_ZA"),key:2,type:0,showIcon:!0,icon:"glyphicon pbi-glyph-ztoa glyph-small"};return e.items.push(t),e.items.push(i),e},i.prototype.showSortOrderContextMenu=function(e,t){var i={anchorElement:$(e.currentTarget)};this.services.dropdown.showContextMenu(this.getMenuItems(),{x:e.pageX,y:e.pageY},this.onSortOrderMenuItemSelected.bind(this,t),!1,void 0,void 0,!0,i)},i.prototype.moveFilter=function(t,i,r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.services.visualAuthoring.moveFilter(this.services.dataSources.get(),r,i,t)];case 1:return e=o.sent(),e&&this.sortFiltersBySortType(r,3),[2]}}))}))},i.prototype.addFilterWithCustomOrder=function(i,r){return __awaiter(this,void 0,e.Promise,(function(){var e,o;return __generator(this,(function(n){switch(n.label){case 0:return e=t.FilterUtils.getFiltersContainer(r,this.services.selection,this.services.explorationNavigation),[4,this.services.visualAuthoring.setFilterSortType(this.services.dataSources.get(),r,3)];case 1:return o=n.sent(),o&&t.util.FilterPaneUtil.addFilterToScopeFromDrop(r,e,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring,i),[2]}}))}))},i.prototype.showEditVariablesLink=function(){var e=this.services,t=e.conceptualSchemaProxy,i=e.dataSources,r=e.explorationCapabilities;if(!this.isInOutspacePane)return!1;var o=t.getLatestCapabilities(i.get(),void 0);if(!o||!o.supportsDataSourceVariables)return!1;var n=r.getCapabilities();return!(!n||n.disableEditVariables)},i.prototype.editVariablesOnClick=function(){this.services.eventBridge.publishToChannel(a.datasourceVariablesEditClicked)},i.prototype.getFiltersByScopeType=function(e,t){var i;switch(e){case 0:i=this.viewModel.visualFilters;break;case 1:i=t&&5===t?this.viewModel.drillthroughFilters:this.viewModel.pageFilters;break;case 2:i=this.viewModel.reportFilters;break;default:debug.assertNever(e)}return i},i.prototype.setFiltersByScopeType=function(e,t,i){switch(e){case 0:this.viewModel.visualFilters=t;break;case 1:5===i?this.viewModel.drillthroughFilters=t:this.viewModel.pageFilters=t;break;case 2:this.viewModel.reportFilters=t;break;default:debug.assertNever(e)}},i.prototype.sortFiltersBySortType=function(e,i){var r=this;void 0===i&&(i=1);var o=this.getFiltersByScopeType(e),n=this.services.viewModeState.getConfig().displayOptions.enableMobileFilters,a=o.filter((function(e){return(r.isInOutspacePane||n)&&e.canSortManually})),s=o.filter((function(e){return!r.isInOutspacePane&&!n||!e.canSortManually}));if(o.length>0){switch(i){case 1:a.sort(t.viewModels.ViewModelFactory.sortFilterByDisplayName),s.sort(t.viewModels.ViewModelFactory.sortFilterByDisplayName);break;case 2:a.sort(t.viewModels.ViewModelFactory.sortFilterByDisplayName).reverse(),s.sort(t.viewModels.ViewModelFactory.sortFilterByDisplayName).reverse();break;case 3:a.sort(t.viewModels.ViewModelFactory.sortFilterByOrdinal)}this.setFiltersByScopeType(e,a.concat(s))}},i.prototype.onSortOrderMenuItemSelected=function(e,t){this.services.visualAuthoring.setFilterSortType(this.services.dataSources.get(),e,t),this.sortFiltersBySortType(e,t)},i.prototype.onModelChanged=function(){this.createReportFilters(),this.createPageScopeFilters()},i.prototype.isOutspacePaneInTwoPaneMode=function(){return this.isInOutspacePane&&!this.singleFilterPane()},i.prototype.shouldShowAddFilterLabelText=function(e){return!(!this.isInOutspacePane&&!_.isEmpty(e))},i.prototype.isEditMode=function(){return 1===this.services.viewModeState.getMode()},i.prototype.isReadingMode=function(){return 0===this.services.viewModeState.getMode()},i.prototype.singleFilterPane=function(){return this.services.featureSwitchService.featureSwitches.singleFilterPane},i.prototype.customSortEnabled=function(e){return 0===e?this.services.featureSwitchService.featureSwitches.visualFiltersCustomSort&&this.isEditMode()&&this.isInOutspacePane:this.services.featureSwitchService.featureSwitches.filterPaneCustomSort&&this.isEditMode()&&this.isInOutspacePane},i.prototype.filterCustomSortDisabled=function(e){if(!e)return!0;var t=e.getFilterContainerScope();return!(t?this.customSortEnabled(t.scopeType):this.customSortEnabled())||!e.canSortManually||!this.isSearchTextNullOrEmpty()},i.prototype.isSortable=function(e){return this.isInOutspacePane&&!this.filterCustomSortDisabled(e)},i.prototype.isSinglePaneReadingMode=function(){return this.singleFilterPane()&&this.isReadingMode()&&this.isInOutspacePane},i.prototype.isSinglePaneOutspacePaneEditMode=function(){return this.singleFilterPane()&&this.isEditMode()&&this.isInOutspacePane},i.prototype.showDrillthroughDropZone=function(){var e=this.services.viewModeState;return!this.isInOutspacePane&&(e.getConfig().alwaysPopulatePanes||this.isEditMode())},i.prototype.onExplorationFiltersContainerChanged=function(e){e.container===this.services.explorationNavigation.getCurrentExploration()&&(this.createReportFilters(),this.createPageScopeFilters())},i.prototype.onSectionFiltersContainerChanged=function(e){e.container===this.services.explorationNavigation.getCurrentSection()&&this.createPageScopeFilters()},i.prototype.onCanvasChanged=function(){this.createPageScopeFilters()},i.prototype.getTargetIndex=function(e,t,i){if(i&&(t+=1),t!==e)return t},i.prototype.getDropAction=function(e,t){var i=this.services.promiseFactory.defer(),r=this.services.dragDataService.getDragContext();return r&&r.field?this.customSortEnabled()?i.resolve(1):i.resolve(3):i.resolve(0),i.promise},i.prototype.getDragContext=function(e,t){return{filter:e,filterScopeType:e.getFilterContainerScope().scopeType,startIndex:t,dragDropWithinFilter:!0}},i.prototype.getOutspaceFilterDropAction=function(e,t){var i,r=this.services.dragDataService.getDragContext(),o=t.getFilterContainerScope().scopeType;return i=!r||0===o&&!this.services.featureSwitchService.featureSwitches.visualFiltersCustomSort?0:void 0!==r.filterScopeType&&o!==r.filterScopeType?0:n.isBelow(e)?3:2,this.services.promiseFactory.resolve(i)},i.prototype.dropFilterWithCustomOrder=function(e,t,i,r,o){var n=o&&o.getFilterContainerScope()&&o.getFilterContainerScope().scopeType;if(this.customSortEnabled(n)){var a=this.services.dragDataService.getDragContext(),s=o.getFilterContainerScope().scopeType;if(a.dragDropWithinFilter){var l=this.getTargetIndex(a.startIndex,r,3===i);void 0!==l&&this.moveFilter(a.startIndex,l,s)}else{var c=3===i?r+1:r;this.addFilterWithCustomOrder(c,s)}}},i.prototype.dropVisualFilter=function(i,r,o){return __awaiter(this,void 0,e.Promise,(function(){var e,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this.getSelectedVisual(),e?this.customSortEnabled(0)?[4,this.services.visualAuthoring.setFilterSortType(this.services.dataSources.get(),0,3)]:[3,2]:[2];case 1:return n=a.sent(),n&&t.util.FilterPaneUtil.addFilterToScopeFromDrop(0,e,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring,this.viewModel.visualFilters.length),[3,3];case 2:this.appendVisualFilters(i,r,o),a.label=3;case 3:return[2]}}))}))},i.prototype.appendVisualFilters=function(e,i,r){var o=this.getSelectedVisual();if(o){var n=3===o.filterSortOrder?this.viewModel.visualFilters.length:void 0;t.util.FilterPaneUtil.addFilterToScopeFromDrop(0,o,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring,n)}},i.prototype.dropPageFilter=function(i,r,o){return __awaiter(this,void 0,e.Promise,(function(){var e,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this.services.explorationNavigation.getCurrentSection(),this.customSortEnabled(1)?[4,this.services.visualAuthoring.setFilterSortType(this.services.dataSources.get(),1,3)]:[3,2];case 1:return n=a.sent(),n&&t.util.FilterPaneUtil.addFilterToScopeFromDrop(1,e,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring,this.getSortableFiltersLength(this.viewModel.pageFilters)),[3,3];case 2:this.appendPageFilters(i,r,o),a.label=3;case 3:return[2]}}))}))},i.prototype.appendPageFilters=function(e,i,r){var o=this.services.explorationNavigation.getCurrentSection(),n=3===o.filterSortOrder?this.getSortableFiltersLength(this.viewModel.pageFilters):void 0;t.util.FilterPaneUtil.addFilterToScopeFromDrop(1,o,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring,n)},i.prototype.dropDrillthroughFilter=function(e,i,r){var o=this.services.explorationNavigation.getCurrentSection();t.util.FilterPaneUtil.addFilterToScopeFromDrop(1,o,!0,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring)},i.prototype.dropReportFilter=function(i,r,o){return __awaiter(this,void 0,e.Promise,(function(){var e,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this.services.explorationNavigation.getCurrentExploration(),this.customSortEnabled(2)?[4,this.services.visualAuthoring.setFilterSortType(this.services.dataSources.get(),2,3)]:[3,2];case 1:return n=a.sent(),n&&t.util.FilterPaneUtil.addFilterToScopeFromDrop(2,e,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring,this.getSortableFiltersLength(this.viewModel.reportFilters)),[3,3];case 2:this.appendReportFilters(i,r,o),a.label=3;case 3:return[2]}}))}))},i.prototype.appendReportFilters=function(e,i,r){var o=this.services.explorationNavigation.getCurrentExploration(),n=3===o.filterSortOrder?this.getSortableFiltersLength(this.viewModel.reportFilters):void 0;t.util.FilterPaneUtil.addFilterToScopeFromDrop(2,o,!1,this.services.dataSources,this.services.dragDataService,this.services.visualAuthoring,n)},i.prototype.getSortableFiltersLength=function(e){var t=_.findIndex(e,(function(e){return!e.canSortManually}));return t===-1?e.length:t},i.prototype.isVisualFiltersVisible=function(){var e=this.services.viewModeState.getMode(),t=1===e,i=0===e;if(this.isSinglePaneOutspacePaneEditMode()&&this.viewModel.isVisualVisible)return!0;if(this.isInOutspacePane){var r=_.filter(this.viewModel.visualFilters,(function(e){return e.contract.isHiddenInViewMode!==!0}));return this.viewModel.isVisualVisible&&!_.isEmpty(r)}return!(!t||!this.viewModel.isVisualVisible)||!(!i||_.isEmpty(this.viewModel.visualFilters))},i.prototype.isPageFiltersVisible=function(){var e=this.viewModel.pageFilters;return this.isNewFilterExperienceReadingMode()&&(e=e.concat(this.viewModel.drillthroughFilters)),this.isPageOrReportScopeFiltersVisible(e)},i.prototype.isDrillthroughFiltersVisible=function(){if(!this.services.viewModeState.getConfig().displayOptions.showDrillthroughFilters)return!1;var e=this.services.explorationNavigation.getCurrentSection();return!(!e||null!=e.type&&0!==e.type)&&this.isPageOrReportScopeFiltersVisible(this.viewModel.drillthroughFilters)},i.prototype.isReportFiltersVisible=function(){return this.isPageOrReportScopeFiltersVisible(this.viewModel.reportFilters)},i.prototype.showNoFiltersHeader=function(){return this.isInOutspacePane&&!this.isVisualFiltersVisible()&&!this.isPageFiltersVisible()&&!this.isDrillthroughFiltersVisible()&&!this.isReportFiltersVisible()},i.prototype.isPageOrReportScopeFiltersVisible=function(e){if(this.isInOutspacePane){if(this.isSinglePaneOutspacePaneEditMode())return!0;e=_.reduce(e,(function(e,t){return t.contract.isHiddenInViewMode||e.push(t),e}),[])}else{if(this.services.viewModeState.getConfig().alwaysPopulatePanes)return!0;if(this.isEditMode())return!0}return!_.isEmpty(e)},i.prototype.updateSelection=function(){if(this.isApplyAllEnabled){for(var e in this.validFilterChanges)0===this.validFilterChanges[e].filterScope&&delete this.validFilterChanges[e];for(var e in this.invalidFilterChanges)0===this.invalidFilterChanges[e].filterScope&&delete this.invalidFilterChanges[e];this.updateIsApplyAllInErrorState()}var t=this.viewModel,i=this.getSelectedVisual();t.visualFilters.length=0,i&&this.services.visualPluginOps.isQueryVisual(i.config.singleVisual.visualType)?(t.isVisualVisible=!0,this.updateVisualFilters()):this.viewModel.isVisualVisible=!1},i.prototype.onVisualContainerChanged=function(e){if(e){var t=this.getSelectedVisual();t&&e.affectContainer(t)&&this.updateVisualFilters()}},i.prototype.onFilterContainerChanged=function(e){var i=this,r=5===e.filter.howCreated&&!this.services.viewModeState.getConfig().displayOptions.showDrillthroughFilters;this.viewModel;if(t.util.FilterPaneUtil.updateCategoricalFiltersIfNeeded(this.services,0,this.viewModel.visualFilters,e),t.util.FilterPaneUtil.updateCategoricalFiltersIfNeeded(this.services,1,this.viewModel.pageFilters,e),t.util.FilterPaneUtil.updateCategoricalFiltersIfNeeded(this.services,2,this.viewModel.reportFilters,e),r||t.util.FilterPaneUtil.updateCategoricalFiltersIfNeeded(this.services,1,this.viewModel.drillthroughFilters,e),!r||this.isInOutspacePane){var o,n=this.services.explorationNavigation.getCurrentExploration(),a=this.getSelectedVisual(),s=t.FilterUtils.getFiltersContainer(e.scope.scopeType,this.services.selection,this.services.explorationNavigation),l=s?s.filterSortOrder:void 0;o=this.getFiltersByScopeType(e.scope.scopeType,e.filter.howCreated),t.util.FilterPaneUtil.onFilterContainerChanged(e,o,n,this.services,a).then((function(){1!==e.changeType&&256!==e.changeType||i.sortFiltersBySortType(e.scope.scopeType,l)}))}},i.prototype.getSelectedVisual=function(){return l.getSelectedVisual(this.services.selection)},i.prototype.createPageScopeFilters=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this.services.explorationNavigation.getCurrentSection(),e?[4,t.util.FilterPaneUtil.getPageScopeFilters(this.services)]:[2];case 1:for(i=a.sent(),this.viewModel.pageFilters=[],this.viewModel.drillthroughFilters=[],r=0,o=i;r<o.length;r++)n=o[r],5!==n.howCreated?this.viewModel.pageFilters.push(n):this.viewModel.drillthroughFilters.push(n);return this.sortFiltersBySortType(1,e.filterSortOrder),[2]}}))}))},i.prototype.createReportFilters=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return e=this.services.explorationNavigation.getCurrentExploration(),e?[4,t.util.FilterPaneUtil.getConceptualSchema(this.services.dataSources,this.services.conceptualSchemaProxy)]:(this.viewModel.reportFilters=null,[2]);case 1:return i=r.sent(),this.viewModel.reportFilters=t.viewModels.ViewModelFactory.createFilters({scopeType:2,container:e},i,this.services.displayNameService,this.services.visualPlugin,this.services.aggrOps,this.services.localizationService,null),t.util.FilterPaneUtil.addConfigToFilters(this.viewModel.reportFilters,i,this.services.dataSources,this.services.visualAuthoring),this.sortFiltersBySortType(2,this.services.explorationNavigation.getCurrentExploration().filterSortOrder),[2]}}))}))},i.prototype.updateVisualFilters=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.util.FilterPaneUtil.getConceptualSchema(this.services.dataSources,this.services.conceptualSchemaProxy)];case 1:return e=o.sent(),i=this.services.explorationNavigation.getCurrentSection(),(r=this.getSelectedVisual())?(this.viewModel.visualFilters=this.services.visualAuthoring.createVisualFilters(i,r,this.services.dataSources.get(),e,this.singleFilterPane()||!this.isInOutspacePane),this.sortFiltersBySortType(0,this.getSelectedVisual().filterSortOrder),[2]):[2]}}))}))},i.prototype.isNewFilterExperienceReadingMode=function(){return this.isOutspacePaneInTwoPaneMode()||this.isSinglePaneReadingMode()},i.prototype.isSearchTextNullOrEmpty=function(){return!(this.searchFiltersInput&&!/^\s*$/.test(this.searchFiltersInput))},i.prototype.clearSearchFiltersInput=function(){this.searchFiltersInput=""},i.prototype.updateisApplyAllSettingOn=function(){this.isApplyAllEnabled=!1;var e=this.services.explorationNavigation.getCurrentExploration();e&&e.slowDataSourceSettings&&(this.isApplyAllEnabled=e.slowDataSourceSettings.isApplyAllButtonEnabled)},i.prototype.applyAllHasFiltersToApply=function(){return Object.keys(this.validFilterChanges).length+Object.keys(this.invalidFilterChanges).length>0},i.prototype.onApplyAllFilterCardBufferedChanges=function(e){e.wasDeleted?(delete this.validFilterChanges[e.id],delete this.invalidFilterChanges[e.id]):e.canApply?(this.validFilterChanges[e.id]={filterType:e.filterType,filterScope:e.filterScopeType},delete this.invalidFilterChanges[e.id]):(this.invalidFilterChanges[e.id]={filterType:e.filterType,filterScope:e.filterScopeType},delete this.validFilterChanges[e.id]),this.updateIsApplyAllInErrorState()},i.prototype.updateIsApplyAllInErrorState=function(){this.isApplyAllButtonInErrorState=Object.keys(this.invalidFilterChanges).length>0&&this.isApplyAllButtonInErrorState},i.prototype.onApplyAllClicked=function(){Object.keys(this.invalidFilterChanges).length>0?this.isApplyAllButtonInErrorState=!0:(this.validFilterChanges={},this.invalidFilterChanges={},this.services.eventBridge.publishToChannel(a.applyAllClicked))},i})();i.FilterPaneCore=u})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.FilterPane={bindings:{isInOutspacePane:"<?",sectionObjects:"<?",searchFiltersInput:"<?"},controller:e.common.createController(t.FilterPaneController),templateUrl:"components/filterPane/filterPane.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.filterChanged={name:"filterChanged"},e.topNFilterOrderByUpdate={type:2,name:"topNFilterOrderByUpdate"}})(t=e.FilterEvents||(e.FilterEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=t.contracts.FilterType,n=e.explore.FilterUtils,a=e.data.RestatementHelper,s=e.data.SemanticFilter,l=e.explore.services.filterRestatementUtil,c=jsCommon.StringExtensions,u=(function(){function e(e,t){this.services=t,this.core=new p(e,this.services)}return Object.defineProperty(e.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(e){this.core.viewModel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInOutspacePane",{get:function(){return this.core.isInOutspacePane},set:function(e){this.core.isInOutspacePane=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this.core.index},set:function(e){this.core.index=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastIndex",{get:function(){return this.core.lastIndex},set:function(e){this.core.lastIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchFiltersInput",{get:function(){return this.core.searchFiltersInput},set:function(e){this.core.searchFiltersInput=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moveFilter",{get:function(){return this.core.moveFilter},set:function(e){this.core.moveFilter=e},enumerable:!0,configurable:!0}),e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","highContrastCssGenerationService","displayNameService","dropdown","$element","localizationService","featureSwitchService","telemetryService","themeService"],scopedDependencies:["dataSources","eventBridge","explorationActivity","explorationCapabilities","explorationNavigation","includeExcludeService","visualAuthoring","viewModeState"]}},e.prototype.$onInit=function(){this.core.$onInit()},e.prototype.$onDestroy=function(){this.core.$onDestroy()},e.prototype.$onChanges=function(e){this.core.$onChanges(e)},e})();i.FilterController=u;var p=(function(){function i(e,t){this.$scope=e,this.services=t,this.ariaLabelFilterType=this.services.localizationService.get("FilterCardTypeSwitchLabel"),this.useNewFilterPane=!1,this.allowChangeFilterTypes=!0,this.initializeHighContrastRules()}return i.prototype.$onInit=function(){var i=this,o=this.viewModel;o.updateViewState(),o.updateAvailableTypes(this.services.featureSwitchService.featureSwitches),o.isInOutspacePane=this.isInOutspacePane;var n=this.services;this.$scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){i.blurLabel()})),this.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDisable:!o.readOnlyState.invalid,tooltipTitle:n.localizationService.get("Invalid_Filter_Tooltip")}}},o.chevronExpandDescription=n.localizationService.get("Chevron_ExpandDescription"),o.chevronCollapseDescription=n.localizationService.get("Chevron_CollapseDescription"),this.subscriptionManager=n.eventBridge.createChannelSubscriptionManager().subscribe(r.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})).subscribe(r.sectionObjectsEvaluated,(function(e,t){return i.updateFilterCardStyle()})).subscribe(e.events.visualThemeChanged,(function(){return i.updateFilterCardStyle()})).subscribe(r.podParameterChanged,(function(e,t){return i.onPodParameterChanged(t)})).subscribe(r.explorationSettingsLoaded,(function(e,t){t.useNewFilterPaneExperienceChanged&&(i.updateUseNewFilterPaneSettings(i.services.explorationNavigation.getCurrentExploration()),i.updateAllowChangeFilterTypeSettings(i.services.explorationNavigation.getCurrentExploration())),t.allowChangeFilterTypesChanged&&i.updateAllowChangeFilterTypeSettings(i.services.explorationNavigation.getCurrentExploration())})),this.updateUseNewFilterPaneSettings(this.services.explorationNavigation.getCurrentExploration()),this.updateAllowChangeFilterTypeSettings(this.services.explorationNavigation.getCurrentExploration()),this.initializeDefaultValue(),this.updateRestatement(),this.updateFilterCardStyle(),this.isInOutspacePane&&5===this.viewModel.contract.howCreated&&t.util.FilterPaneUtil.setDrillthroughMetadata(this.viewModel,this.services.explorationNavigation)},i.prototype.$onDestroy=function(){
this.subscriptionManager.unsubscribeAll()},i.prototype.$onChanges=function(e){e.searchFiltersInput&&this.updateHiddenBySearchInput()},i.prototype.updateLinkAsAggregation=function(){var e=this.viewModel;this.services.visualAuthoring.setLinkFieldAsAggregation(e.contract,e.getFilterContainerScope(),e.isLinkedAsAggregation),this.updateLinkAsAggregationOnViewModel()},i.prototype.updateLinkAsAggregationOnViewModel=function(){var e=this.viewModel;if(e.isLinkedAsAggregation&&e.contract.filter){this.viewModel.clearRestatement(),this.services.visualAuthoring.updateFilter(e.getFilterContainerScope(),e.contract,void 0);var t={filter:e.contract,changeType:10,scope:e.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,t)}var i={filter:e.contract,changeType:16,scope:e.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,i)},i.prototype.getLabelForAsAggregationOption=function(e){return e?this.services.localizationService.get("LinkField_AsAggregationEnabledText"):this.services.localizationService.get("LinkField_AsAggregationDisabledText")},i.prototype.getResourceIdForAsAggregationDropdown=function(){return 1===this.services.explorationNavigation.getCurrentSection().type?"LinkField_AsAggregationForTooltip":"LinkField_AsAggregationForDrillthrough"},i.prototype.isIncludeExclude=function(){return this.viewModel.contract.type===o.Include||this.viewModel.contract.type===o.Exclude},i.prototype.getDisplayName=function(){return this.viewModel.contract.displayName?this.viewModel.contract.displayName:this.viewModel.displayName},i.prototype.getRestatement=function(){var e;return this.viewModel.contract.type===o.Passthrough?e="":(e=this.viewModel.getRestatement(),e||(e=this.services.localizationService.get("FilterRestatement_IsAll"))),e},i.prototype.isFilterApplied=function(){return(this.useNewFilterPane||this.isFluentDesignEnabled||this.isForceMigrationLive()||this.useMobileFilterConfig())&&this.viewModel.hasRestatement},Object.defineProperty(i.prototype,"isFilterHidden",{get:function(){return!!this.useNewFilterPane&&(this.isEditMode?this.hiddenBySearchInput:this.viewModel.isFilterHidden()||this.hiddenBySearchInput)},enumerable:!0,configurable:!0}),i.prototype.getTooltip=function(){var e;return e=this.isIncludeExclude()?this.getDisplayName():this.viewModel.contract.type===o.Passthrough?this.getDisplayName():this.viewModel.tooltip},i.prototype.getIconClassName=function(){var e=this.viewModel;if(5===e.howCreated&&e.contract&&!e.contract.isTransient)return e.isMeasure?"fieldListMeasure":e.isLinkedAsAggregation?"fieldListNumeric":void 0},Object.defineProperty(i.prototype,"canExpand",{get:function(){return this.isEditMode?this.viewModel.canExpandManually:this.viewModel.canExpandManually&&!this.viewModel.isFilterLocked()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showDeleteIcon",{get:function(){return!(!this.isEditMode&&!this.isIncludeExclude()&&this.viewModel.contract.type!==o.Passthrough)&&this.viewModel.canDeleteManually},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showVisibilityIcon",{get:function(){return!(!this.useNewFilterPane||this.useMobileFilterConfig())&&(this.viewModel.canHideManually&&(this.isEditMode||this.viewModel.isFilterHidden()))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showLockIcon",{get:function(){return!!this.useNewFilterPane&&(this.viewModel.canLockManually&&(this.isEditMode||this.viewModel.isFilterLocked()))},enumerable:!0,configurable:!0}),i.prototype.isFilterExpanded=function(){return!(this.useNewFilterPane&&this.viewModel.isFilterLocked()&&!this.isEditMode)&&this.viewModel.isFilterExpanded()},i.prototype.showFilterTypeSelection=function(){var e=!1;if(this.services.featureSwitchService.featureSwitches.forceMigrateNewFilterPane){var t=this.services.explorationNavigation.getCurrentExploration();t&&t.settings&&(e=!t.settings.useNewFilterPaneExperience)}return(!this.isInOutspacePane||e||this.allowChangeFilterTypes||this.isEditMode)&&this.viewModel.availableTypes&&this.viewModel.availableTypes.length>1&&!this.viewModel.isSingleSelectionRequired&&!this.viewModel.isInvalid()&&!this.isIncludeExclude()},i.prototype.getFilterLockTooltip=function(){return this.viewModel.isFilterLocked()?"FilterPane_FilterLocked":this.viewModel.isFilterLocked()?"FilterPane_UnlockFilter":"FilterPane_LockFilter"},i.prototype.getFilterTypeTooltip=function(){return this.allowChangeFilterTypes?"FilterPane_FilterType_Shown":"FilterPane_FilterType_Hidden"},i.prototype.useMobileFilterConfig=function(){return this.services.viewModeState.getConfig().displayOptions.useMobileExplorationFooter},i.prototype.initializeHighContrastRules=function(){this.services.highContrastCssGenerationService.addRule(".themeableElement .visual .slicer-container .slicer-content-wrapper .searchHeader","{ border-color: @buttonForegroundColor !important; }")},i.prototype.getAriaLabelString=function(){var e=this.getDisplayName(),t=this.getRestatement();return t&&(e=e+" "+t),e},i.prototype.onFilterChanged=function(e){var t=this.viewModel.contract.expression;this.viewModel.useDefaultFilter&&(e.filter.filter=s.getDefaultValueFilter(t)),n.notifyFilterContainerChangedByUser(this.services.eventBridge,e),this.updateRestatement(),this.updateFilterCardStyle()},i.prototype.onFilterContainerChanged=function(e){var t=this.viewModel;e.filter===t.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&(this.updateRestatement(),this.viewModel.updateViewState()),e.filter===t.contract&&t!==e.source&&(jsCommon.EnumExtensions.hasFlag(e.changeType,32)&&((e.filter.type===o.TopN&&t.cardType.type!==o.TopN||e.filter.type!==o.TopN&&t.cardType.type===o.TopN)&&this.viewModel.clearRestatement(),t.updateCardType(e.filter.type)),jsCommon.EnumExtensions.hasFlag(e.changeType,16)&&this.viewModel.updateViewState()),this.updateFilterCardStyle()},i.prototype.toggle=function(i){if(void 0===i&&(i=!0),this.canExpand){var o=this.services.visualTimeSynchronizationService?this.services.visualTimeSynchronizationService.getAnchorTime():void 0;l.updateRestatementOnToggle(this.services.dataSources.get(),this.services.conceptualSchemaProxy,this.services.localizationService,this.viewModel,o);var n=this.viewModel.contract;if(n.expanded=!n.expanded,this.services.telemetryService.logEvent(e.telemetry.EXToggleFilterCardExpanded,t.util.getTelemetryFilterType(n.type),t.util.getTelemetryFilterScopeType(this.viewModel.getFilterContainerScope().scopeType),t.util.getTelemetryFieldKind(n.expression),n.expanded,t.util.getTelemetryViewMode(this.services.viewModeState.getMode()),this.isInOutspacePane),this.viewModel.updateViewState(),i){var a=this.viewModel,s={filter:a.contract,changeType:16,scope:a.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,s)}}},i.prototype.clearFilter=function(i){var r=this;return i&&i.stopPropagation(),this.isApplyAllEnabled()&&n.notifyBufferedFilterChanges(this.services.eventBridge,this.viewModel.getFilterContainerScope().scopeType,this.viewModel.cardType.type,this.viewModel.id,!1,!0),this.viewModel.hasDefaultValue?void this.restoreDefaultFilter():void(this.viewModel.contract.filter&&(this.services.explorationActivity.doActivity((function(){r.viewModel.clearRestatement();var e=r.viewModel;r.services.visualAuthoring.clearFilter(e.getFilterContainerScope(),e.contract);var t={filter:r.viewModel.contract,changeType:10,scope:r.viewModel.getFilterContainerScope()};n.notifyFilterContainerChangedByUser(r.services.eventBridge,t)}),(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXFilterPaneFilterCleared)})),this.services.telemetryService.logEvent(e.telemetry.EXFilterPaneInteraction,"Clear",this.isInOutspacePane,t.util.getTelemetryViewMode(this.services.viewModeState.getMode()))))},i.prototype.updateHiddenBySearchInput=function(){if(this.services.featureSwitchService.featureSwitches.enableSearchFilters)if(!this.searchFiltersInput||/^\s*$/.test(this.searchFiltersInput))this.hiddenBySearchInput=!1;else{var e=this.getDisplayName();_.isEmpty(e)&&(e=this.viewModel.getRestatement()),this.hiddenBySearchInput=!c.containsIgnoreCase(e,this.searchFiltersInput)}else this.hiddenBySearchInput=!1},Object.defineProperty(i.prototype,"clearFilterTooltip",{get:function(){return this.viewModel.hasDefaultValue?"FilterPane_ResetDefaultFilter":"FilterPane_ClearFilter"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showTopRowClearIcon",{get:function(){return this.viewModel.canClearManually&&this.useNewFilterPane&&!this.viewModel.isFilterLocked()&&!this.isEditMode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showBottomRowClearIcon",{get:function(){return this.viewModel.canClearManually&&(!this.useNewFilterPane||this.isEditMode)&&this.viewModel.hasRestatement&&!this.viewModel.isFilterLocked()},enumerable:!0,configurable:!0}),i.prototype.toggleFilterVisibility=function(t){if(t&&t.stopPropagation(),this.isEditMode){var i=this.viewModel;this.services.visualAuthoring.toggleFilterVisibility(i.getFilterContainerScope(),i.contract),this.services.telemetryService.logEvent(e.telemetry.EXFilterPaneInteraction,"Visibility",this.isInOutspacePane,void 0)}},i.prototype.toggleFilterLockState=function(t){if(t&&t.stopPropagation(),this.isEditMode){var i=this.viewModel;this.services.visualAuthoring.toggleFilterLock(i.getFilterContainerScope(),i.contract),this.services.telemetryService.logEvent(e.telemetry.EXFilterPaneInteraction,"Lock",this.isInOutspacePane,void 0)}},i.prototype.restoreDefaultFilter=function(){var t=this;this.services.explorationActivity.doActivity((function(){var e=t.viewModel,i=t.viewModel.contract.expression;t.services.visualAuthoring.updateFilter(e.getFilterContainerScope(),e.contract,s.getDefaultValueFilter(i));var r={filter:e.contract,changeType:10,scope:e.getFilterContainerScope()};n.notifyFilterContainerChangedByUser(t.services.eventBridge,r),e.useDefaultFilter=!0,t.updateRestatement()}),(function(i){return t.services.telemetryService.startActivity(i,e.telemetry.EXFilterPaneFilterDefaultRestored)}))},i.prototype.deleteFilter=function(i){var r=this;i&&i.stopPropagation(),this.isApplyAllEnabled()&&n.notifyBufferedFilterChanges(this.services.eventBridge,this.viewModel.getFilterContainerScope().scopeType,this.viewModel.cardType?this.viewModel.cardType.type:null,this.viewModel.id,!1,!0),this.services.explorationActivity.doActivity((function(){var e=r.viewModel.getFilterContainerScope();r.services.visualAuthoring.removeFilter(r.viewModel.contract,e)}),(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXFilterPaneFilterDeleted)})),this.services.telemetryService.logEvent(e.telemetry.EXFilterPaneInteraction,"Delete",this.isInOutspacePane,t.util.getTelemetryViewMode(this.services.viewModeState.getMode()))},i.prototype.onKeyDown=function(e){13===e.keyCode&&this.toggle()},i.prototype.switchCardType=function(e){switch(void 0===e&&(e=this.viewModel.cardType),this.viewModel.cardType=e,this.viewModel.contract.type=e.type,this.viewModel.cardType.type){case o.Advanced:case o.Categorical:case o.TopN:case o.RelativeTime:case o.RelativeDate:this.viewModel.switchType(this.viewModel.cardType.type),this.viewModel.updateViewState()}var t={filter:this.viewModel.contract,changeType:32,scope:this.viewModel.getFilterContainerScope(),source:this.viewModel};n.notifyFilterContainerChangedByUser(this.services.eventBridge,t),this.toggle(!1),this.toggle(!1)},i.prototype.showLinkFieldOptions=function(){return this.viewModel.readOnlyState.expanded&&this.viewModel.canToggleLinkAsAggregation&&!this.isInOutspacePane&&!this.services.viewModeState.getConfig().displayOptions.enableMobileFilters},i.prototype.getFilterClass=function(){var e=[];if(e.push("unselectable"),this.viewModel.cardType)switch(this.viewModel.cardType.type){case o.Visual:e.push("visual");break;case o.Advanced:e.push("advanced");break;case o.Categorical:e.push("categorical");break;case o.TopN:e.push("topN");break;case o.RelativeDate:e.push("relativeDate");break;case o.RelativeTime:e.push("relativeTime")}return this.isInOutspacePane?this.services.featureSwitchService.featureSwitches.useModernFilterPane?e.push("filterOutspaceModern"):e.push("filterOutspaceLegacy"):this.services.featureSwitchService.featureSwitches.useModernFilterPane?e.push("filterModern"):e.push("filterLegacy"),this.isFilterApplied()&&e.push("hasRestateHighlight"),!this.viewModel.canSortManually&&this.isInOutspacePane&&e.push("italicized"),e.join(" ")},i.prototype.rename=function(t){if(t!==this.viewModel.contract.displayName&&(this.viewModel.contract.displayName||t!==this.viewModel.displayName)){this.viewModel.contract.displayName=t;var i=this.viewModel;this.services.visualAuthoring.renameFilter(i.getFilterContainerScope(),i.contract,t),this.services.telemetryService.logEvent(e.telemetry.EXFilterPaneInteraction,"Rename",this.isInOutspacePane,void 0)}},i.prototype.editLabel=function(){this.isEditMode&&this.viewModel.canRenameManually&&this.isInOutspacePane&&(this.viewModel.isEditingLabel=!0)},i.prototype.editLabelModern=function(){this.viewModel.canRenameManually&&this.isInOutspacePane&&(this.viewModel.isEditingLabel=!0)},i.prototype.blurLabel=function(){this.viewModel.isEditingLabel=!1},Object.defineProperty(i.prototype,"restatementLineStyleRule",{get:function(){return!this.useNewFilterPane||this.isFilterExpanded()||this.isEditMode?"trimmedTextWithEllipsis":"multiLineText"},enumerable:!0,configurable:!0}),i.prototype.showContextMenu=function(e){if(this.isSinglePaneOutspacePaneEditMode()){e.preventDefault();var t=this.getMenuitems();this.services.dropdown.showContextMenu(t,void 0,this.onMenuItemSelected.bind(this),!1,void 0,void 0,!0,{anchorElement:$(e.currentTarget)})}},i.prototype.getMenuitems=function(){var e=(this.viewModel.getFilterContainerScope().container.filters,[{type:0,disabled:!this.viewModel.canDeleteManually,text:this.services.localizationService.get("FilterPane_DeleteFilter"),key:{action:0}},{type:0,disabled:!this.canExpand,text:this.viewModel.isFilterExpanded()?this.services.localizationService.get("Collapse"):this.services.localizationService.get("Expand"),key:{action:this.viewModel.isFilterExpanded()?2:1}}]);return this.customSortEnabled&&e.push({type:0,disabled:!this.viewModel.canSortManually,text:this.services.localizationService.get("ItemAction_Move"),key:{action:3},children:[{type:0,disabled:!this.viewModel.canSortManually||0===this.index,text:this.services.localizationService.get("ItemAction_Move_Up"),key:{action:3,moveDirection:0}},{type:0,disabled:!this.viewModel.canSortManually||this.index===this.lastIndex-1,text:this.services.localizationService.get("ItemAction_Move_Down"),key:{action:3,moveDirection:1}},{type:0,disabled:!this.viewModel.canSortManually||0===this.index,text:this.services.localizationService.get("ItemAction_Move_Top"),key:{action:3,moveDirection:2}},{type:0,disabled:!this.viewModel.canSortManually||this.index===this.lastIndex-1,text:this.services.localizationService.get("ItemAction_Move_Bottom"),key:{action:3,moveDirection:3}}]}),e.push({type:1},{type:0,disabled:!this.viewModel.canRenameManually,text:this.services.localizationService.get("ItemAction_Rename"),key:{action:4}},{type:0,disabled:!this.viewModel.canLockManually,text:this.viewModel.isFilterLocked()?this.services.localizationService.get("FilterPane_UnlockFilter"):this.services.localizationService.get("FilterPane_LockFilter"),key:{action:this.viewModel.isFilterLocked()?6:5}},{type:0,disabled:!this.viewModel.canHideManually,text:this.viewModel.isFilterHidden()?this.services.localizationService.get("FilterPane_ShowFilter"):this.services.localizationService.get("FilterPane_HideFilter"),key:{action:this.viewModel.isFilterHidden()?7:8}},{type:0,disabled:!this.viewModel.canClearManually,text:this.services.localizationService.get("FilterPane_ClearFilter"),key:{action:9}}),{items:e}},i.prototype.onMenuItemSelected=function(e){switch(e.action){case 0:this.deleteFilter();break;case 4:this.editLabel();break;case 3:this.customSortEnabled&&this.moveFilterInDirection(e.moveDirection);break;case 1:case 2:this.toggle();break;case 5:case 6:this.toggleFilterLockState();break;case 7:case 8:this.toggleFilterVisibility();break;case 9:this.clearFilter();break;default:return void debug.assertNever(e.action)}},i.prototype.moveFilterInDirection=function(e){var t=this.viewModel.getFilterContainerScope(),i=t.container.filters,r={filterScopeType:t.scopeType,startIndex:this.index,targetIndex:void 0};switch(e){case 0:r.targetIndex=this.index-1;break;case 1:r.targetIndex=this.index+2;break;case 2:r.targetIndex=0;break;case 3:r.targetIndex=i.length;break;default:debug.assertNever(e)}this.moveFilter(r)},i.prototype.updateRestatement=function(){var e=this,t=this.viewModel;if(t.useDefaultFilter)t.setRestatement(a.fromDefault(t.defaultValue.value));else if(t.contract.type===o.Passthrough)t.displayName=t.getRestatement(),t.updateViewState();else if(this.isIncludeExclude()){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){var r=e.viewModel.contract,o=e.services.includeExcludeService.buildViewModel(r.filter,r.type,i,e.services.displayNameService,r.filterExpressionMetadata);t.setRestatement(o.restatement),t.displayName=o.displayName,t.updateViewState()}))}},i.prototype.onPodParameterChanged=function(e){e&&e.filter===this.viewModel.contract&&2===e.type&&(this.viewModel.updateIsLinkedAsAggregation(e.asAggregation),this.updateLinkAsAggregationOnViewModel())},i.prototype.initializeDefaultValue=function(){var e=this.viewModel;(e.hasDefaultValue&&!e.contract.filter||s.isDefaultFilter(e.contract.filter))&&(e.useDefaultFilter=!0,this.updateRestatement())},i.prototype.updateUseNewFilterPaneSettings=function(e){e&&(this.useNewFilterPane=e.settings&&e.settings.useNewFilterPaneExperience||this.isForceMigrationLive())},i.prototype.updateAllowChangeFilterTypeSettings=function(e){e&&e.settings&&(this.allowChangeFilterTypes=e.settings.allowChangeFilterTypes)},Object.defineProperty(i.prototype,"isEditMode",{get:function(){return 1===this.services.viewModeState.getMode()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"singleFilterPaneFS",{get:function(){return this.services.featureSwitchService.featureSwitches.singleFilterPane},enumerable:!0,configurable:!0}),i.prototype.isSinglePaneOutspacePaneEditMode=function(){return this.singleFilterPaneFS&&this.isEditMode&&this.isInOutspacePane},Object.defineProperty(i.prototype,"isFluentDesignEnabled",{get:function(){return this.services.explorationCapabilities.getCapabilities().showFluentDesign&&0===this.services.viewModeState.getMode()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"customSortEnabled",{get:function(){var e=this.viewModel.getFilterContainerScope();return e&&0===e.scopeType?this.services.featureSwitchService.featureSwitches.visualFiltersCustomSort&&this.isEditMode&&this.isInOutspacePane:this.services.featureSwitchService.featureSwitches.filterPaneCustomSort&&this.isEditMode&&this.isInOutspacePane},enumerable:!0,configurable:!0}),i.prototype.isForceMigrationLive=function(){return!!this.services.featureSwitchService.featureSwitches.forceMigrateNewFilterPane},i.prototype.isApplyAllEnabled=function(){var e=this.services.explorationNavigation.getCurrentExploration();return!(!e||!e.slowDataSourceSettings)&&e.slowDataSourceSettings.isApplyAllButtonEnabled},i.prototype.updateFilterCardStyle=function(){var e=this.services.themeService.getVisualStyle(this.services.explorationNavigation.getCurrentExploration().themeCollection);this.viewModel.updateFilterCardStyle(this.services.explorationNavigation.getCurrentSection(),e)},i})();i.FilterCore=p})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.Filter={bindings:{viewModel:"=",isInOutspacePane:"<?",index:"<",lastIndex:"<",moveFilter:"&",searchFiltersInput:"<?"},controller:e.common.createController(t.FilterController),templateUrl:"components/filter/filter.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.contracts.FilterType,o=e.data.SQExprUtils,n=e.explore.util.VisualContainerUtils,a=(function(i){function a(e,r){var o=i.call(this,e,{expanded:!1,canToggleSingleSelect:!1,availableTypes:[],type:e.type})||this;return o.id=a.counter++,o.restatement="",o.displayName="",o.containerScope=r,o.howCreated=0,o.isLinkedAsAggregation=!1,o.filterCapabilities=t.FilterUtils.getFilterCapabilities(e),o}return __extends(a,i),a.prototype.setServices=function(e,t,i){this.visualHostServices=e,this.visualPlugin=t,this.viewModeState=i},a.prototype.isInvalid=function(){return this.invalid},Object.defineProperty(a.prototype,"isVisualFilter",{get:function(){return this.containerScope&&0===this.containerScope.scopeType},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasDefaultValue",{get:function(){return this.defaultValue&&(1===this.howCreated||5===this.howCreated)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isLinkField",{get:function(){return 5===this.howCreated&&!this.contract.isTransient},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canToggleLinkAsAggregation",{get:function(){return this.isLinkField&&!this.isMeasure},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canDeleteManually",{get:function(){return this.filterCapabilities.canDelete||!!this.readOnlyState.invalid},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canClearManually",{get:function(){return this.filterCapabilities.canClear},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasRestatement",{get:function(){return""!==this.restatement&&null!=this.restatement},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canHideManually",{get:function(){return this.filterCapabilities.canHide},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canLockManually",{get:function(){return this.filterCapabilities.canLock},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canRenameManually",{get:function(){return this.filterCapabilities.canRename},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canSortManually",{get:function(){return this.filterCapabilities.canSort},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canExpandManually",{get:function(){return this.filterCapabilities.canEdit&&t.FilterUtils.canExpandManually(this.contract.howCreated,this.contract.isTransient,this.contract.expression,!this.invalid)},enumerable:!0,configurable:!0}),a.prototype.getFilterContainerScope=function(){return this.containerScope},a.prototype.setRestatement=function(e){this.contract.type===this.readOnlyState.type&&(this.restatement=e)},a.prototype.clearRestatement=function(){this.restatement=""},a.prototype.getRestatement=function(){return this.restatement},a.prototype.updateFilterCardStyle=function(e,i){if(i&&this.isInOutspacePane){var r=e&&e.evaluatedObjects&&e.evaluatedObjects.filterCard;this.style=t.FilterUtils.getFilterCardStyle(r,!!this.contract.filter,i)}},Object.defineProperty(a.prototype,"borderColor",{get:function(){return this.style&&this.style.borderColor},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"backgroundColor",{get:function(){return this.style&&this.style.backgroundColor},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"foregroundColor",{get:function(){return this.style&&this.style.foregroundColor},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"inputBoxBorderColor",{get:function(){return this.style&&this.style.inputBoxBorderColor},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"inputBoxBackgroundColor",{get:function(){return this.style&&this.style.inputBoxBackgroundColor},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"inputBoxForegroundColor",{get:function(){return this.style&&this.style.inputBoxForegroundColor},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fontSize",{get:function(){return this.style&&this.style.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fontFamily",{get:function(){return this.style&&this.style.fontFamily},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"visualContainer",{get:function(){if(this.isVisualFilter)return this.containerScope.container},enumerable:!0,configurable:!0}),a.prototype.isFilterLocked=function(){return this.contract.isLockedInViewMode},a.prototype.isFilterHidden=function(){return this.contract.isHiddenInViewMode},a.prototype.isFilterExpanded=function(){return this.readOnlyState.expanded},a.prototype.updateFilterProperties=function(e,i,r){if(this.contract.expression){var a=this.contract.expression;this.isMeasure=o.isMeasure(a),this.discourageAggregation=o.discourageAggregation(a,e),this.valueType=t.FilterUtils.getValueType(a,e),this.formatter=t.FilterUtils.getFormatter(a,e),this.defaultValue=o.getDefaultValue(a,e);var s=5===this.howCreated&&!this.contract.isTransient;if(s||(s=1===o.getAggregateBehavior(a,e)),s)this.isSingleSelectionRequired=!0,this.disableSelectionModeToggle=!0;else{this.contract.isTransient&&(this.isSingleSelectionRequired=!1,this.disableSelectionModeToggle=!0)}}var l=this.containerScope.container;this.hasGroupingScope=l&&n.hasGrouping(l,e),this.invalid=!_.isEmpty(t.FilterUtils.validate(this.contract,e,r)),this.disabled=t.FilterUtils.shouldDisableFilter(this.contract,e,l,r,i)},a.prototype.switchType=function(e){this.readOnlyState.type=e},a.prototype.canVisualize=function(){var e=this.contract;return e.expression&&e.type!==r.Passthrough&&!this.isMeasure},a.prototype.updateViewStateCore=function(t){var i=this.contract,o=!this.invalid;if(t.disabled=this.disabled,t.expanded=i.expanded&&o,t.invalid=!o,_.some(this.availableTypes,(function(e){return e.type===r.Categorical}))&&!t.visual&&i.config){var n=i.config.singleVisual;n&&this.visualHostServices&&this.visualPlugin&&(t.visual={viewport:a.DefaultVisualViewPort,type:e.visuals.plugins.filterSlicer.name,dataTransforms:{objects:n.objects},hostServices:this.visualHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin,themeCollection:{}})}var s=5===this.howCreated&&!this.contract.isTransient;t.canToggleSingleSelect=!s&&!this.contract.isTransient&&!(t.disabled||!t.expanded||!t.visual||!t.visual.data)},a.prototype.updateAvailableTypes=function(t){var i=this.readOnlyState.type;if(i===r.Passthrough)return void(this.availableTypes=[]);var o=[],n=[];!this.valueType||this.valueType.bool||this.isLinkField||o.push({type:r.Advanced,label:e.common.localize.get("FilterPane_Advanced")}),this.isMeasure||(o.push({type:r.Categorical,label:e.common.localize.get("FilterPane_Basic")}),this.valueType&&this.valueType.dateTime&&(o.push({type:r.RelativeDate,label:e.common.localize.get("FilterPane_RelativeDate")}),t&&t.relativeTimeSlicer?o.push({type:r.RelativeTime,label:e.common.localize.get("FilterPane_RelativeTime")}):n.push({type:r.RelativeTime,label:e.common.localize.get("FilterPane_RelativeTime")})),this.isVisualFilter&&o.push({type:r.TopN,label:e.common.localize.get("FilterPane_TopN")})),this.availableTypes=o,this.hiddenTypes=n,this.updateCardType(i)},a.prototype.updateCardType=function(e){var t=this.availableTypes;this.readOnlyState.type=e,this.cardType=_.find(t,(function(t){return t.type===e})),!this.cardType&&this.hiddenTypes&&this.hiddenTypes.length>0&&(this.cardType=_.find(this.hiddenTypes,(function(t){return t.type===e})),this.availableTypes.push(this.cardType))},a.prototype.isSingleSelectDisabled=function(){return this.disableSelectionModeToggle||!this.viewModeState||0===this.viewModeState.getMode()},a.prototype.getDisplayName=function(){return this.contract.displayName?this.contract.displayName:this.displayName},a.prototype.updateIsLinkedAsAggregation=function(e){this.isLinkedAsAggregation=e},a.prototype.getInputPlaceholder=function(){return this.viewModeState&&this.viewModeState.getConfig().displayOptions.enableMobileFilters?e.common.localize.get("TypeHere"):""},a.DefaultVisualViewPort={width:146,height:180,scale:1},a.counter=0,a})(i.ViewModel);i.FilterViewModel=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.contracts.FilterType,a=e.data.SQExprConverter,s=jsCommon.StringExtensions,l=e.visuals.valueFormatter,c=e.data.RelativeFilterType;!(function(r){function u(e,t,i,r,o,a,s,l,u){var p;switch(e.type){case n.TopN:p=y(e,l,r,t,i,s,u);break;case n.Advanced:case n.Categorical:p=f(e,l,r,t,i,s,u);break;case n.RelativeTime:p=m(c.Time,e,l,r,t,i,s,u,!1);break;case n.RelativeDate:p=m(c.Date,e,l,r,t,i,s,u,!1);break;case n.Passthrough:p=g(e,l,r,t,i,u,s);break;case n.Include:case n.Exclude:p=v(e,r,t,i,s);break;default:p=y(e,l,r,t,i,s,u)||m(c.Time,e,l,r,t,i,s,u,!0)||m(c.Date,e,l,r,t,i,s,u,!0)||f(e,l,r,t,i,s,u)||v(e,r,t,i,s)||g(e,l,r,t,i,u,s)}return p.howCreated=e.howCreated,p.updateFilterProperties(t,o,a),p}function p(e){var t;if(e.filter){var r=e.filter.conditions(),o=r[0];o&&(t=i.FilterCardConverter.createAdvFilter(o,null,e.expression))}return!t&&e.expression&&(t=new i.AdvFilterCard(e.expression)),t}function d(e,t,i,r,n,s,l){var c=a.asFieldPattern(e),u={includeVariationSource:!0};return i.getDisplayName(e,t,r,n,0===l?s:void 0,u)||(c?o.getFieldExprName(c):void 0)}function h(e,t,i,r,o,n,a){var s=i.getQualifiedDisplayName(e,t,o);return 5===a||6===a||2===a?s=r.format("FilterCard_Transient_Drill",[s]):7===a?s=r.format("FilterCard_Transient_URL",[s]):n&&(s=r.format("FilterCard_Transient",[s])),s}function v(e,r,o,a,s){var l=new t.services.IncludeExcludeSQExprVisitor(o,a);if(!e.filter)return e.type?new i.FilterViewModel(e,r):void 0;var c=e.filter.conditions();if(!(_.isEmpty(c)||c.length>1)){if(c[0].accept(l),l.dataPoints.length>0){e.type=l.isExclude?n.Exclude:n.Include;var u=new i.FilterViewModel(e,r);return u.displayName=t.FilterUtils.getDisplayNameForIncludeExcludeFilters(s,e.type,l.dataPoints.length),u}}}function g(t,r,o,a,c,u,p){null==t.type&&(t.type=n.Passthrough);var d=new i.FilterViewModel(t,o),h=t.restatement;if((!h||""===h)&&t.filter){var v={includeFieldNamesInFilter:!0};if(h=c.getFilterRestatement(t.filter,a,r,v),d.tooltip=c.getQualifiedFilterRestatement(t.filter,a,r,v),_.isEmpty(h)){var g=e.data.PassthroughFilterPattern.extractParametersFromFilter(t.filter);if(!_.isEmpty(g)){var f,y=p.get("ListJoin_Separator"),m=void 0,C=void 0,S=void 0;u&&(f=u.columnProperties);var w=g.fieldsBeingFiltered.map((function(e){var t=u&&u.query&&u.query.defn.selectNameOf(e);return c.getDisplayName(e,a,r,t,f)})).join(y),b=g.fieldsBeingFiltered.map((function(e){return c.getQualifiedDisplayName(e,a,r,v)})).join(y);if(g.isSubquery&&g.itemCount){var x=l.format(g.itemCount);if(g.orderByField){var E=u&&u.query&&u.query.defn.selectNameOf(g.orderByField),F=c.getDisplayName(g.orderByField,a,r,E,f);S=g.isTop?"FilterRestatement_TopNBy_Drillthrough":"FilterRestatement_BottomNBy_Drillthrough",m=[x,w,F],C=[x,b,F]}}else m=[w],C=[b],S=g.isSubquery?"FilterRestatement_Subquery":"FilterRestatement_Columns";h=s.format.apply(s,[p.get(S)].concat(m)),d.tooltip=s.format.apply(s,[p.get(S)].concat(C))}}}return d.setRestatement(h),d}function f(e,r,o,a,s,l,c,u){var v=p(e);if(v){e.expression||(e.expression=v.field),null==e.type&&(e.filter?e.type=t.FilterUtils.getFilterType(v.field,v.supportsCategorical):e.type=t.FilterUtils.getDefaultFilterType(e.expression,a,e.howCreated)),null==e.type&&(e.type=n.Categorical);var g,f,y=e.expression,m=new i.FilterViewModel(e,o);return c&&(g=c.query&&c.query.defn.selectNameOf(y),f=c.columnProperties),m.displayName=d(y,a,s,r,g,f,o.scopeType),m.tooltip=h(y,a,s,l,r,e.isTransient,e.howCreated),
m}}function y(t,i,r,o,a,s,l){if(0===r.scopeType&&5!==t.howCreated){var c=e.data.TopNFilterPattern.extractParametersFromFilter(t.filter);return c&&C(t,n.TopN,c.fieldBeingFiltered),S(t,n.TopN,r,o,a,s,i,l)}}function m(t,r,o,n,a,s,l,c,u){var p=i.RelativeFilterViewModelUtil.relativeFilterTypeToFilterType(t),d=e.data.RelativeDateFilterPattern.extractParametersFromSemanticFilter(r.filter,t);if(d){if(d.options&&d.options.anchorDate&&u)return;C(r,p,d.field)}return S(r,p,n,a,s,l,o,c)}function C(e,t,i){e.type=t,e.expression=i}function S(e,t,r,o,n,a,s,l){if(e.type===t&&e.expression){var c=new i.FilterViewModel(e,r),u=l&&l.query?l.query.defn.selectNameOf(e.expression):void 0,p=l?l.columnProperties:void 0;return c.displayName=d(e.expression,o,n,s,u,p,r.scopeType),c.tooltip=h(e.expression,o,n,a,s,e.isTransient,e.howCreated),c}}r.convertFilterContainer=u,r.extractAdvFilterCard=p})(r=i.FilterViewModelFactory||(i.FilterViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.explore.services,a=e.data.RestatementHelper,s=e.data.SemanticFilter,l=e.data.SQExpr,c=e.data.SQExprBuilder,u=e.explore.services.toFilterData,p=e.explore.util.VisualContainerUtils,d=e.explore.util.VisualHostServicesUtil,h=jsCommon.EnumExtensions,v=(function(){function e(e,t){this.services=t,this.core=new g(t)}return Object.defineProperty(e.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(e){this.core.viewModel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInOutspacePane",{set:function(e){this.core.isInOutspacePane=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expanded",{set:function(e){this.core.expanded=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentZone",{set:function(e){this.core.currentZone=e},enumerable:!0,configurable:!0}),e.createOptions=function(){return{additionalServices:["aggrOps","displayNameService","conceptualSchemaProxy","featureSwitchService","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationActivity","explorationCapabilities","explorationNavigation","filterGenerator","hostFiltersService","undoRedo","viewModeState","visualAuthoring","visualPlugin","visualQueryGenerator","visualRelationship"]}},e.prototype.$onInit=function(){this.core.viewModel=this.viewModel,this.core.$onInit(),this.modernVisual=this.services.featureSwitchService.featureSwitches.useVisualModern},e.prototype.$onChanges=function(e){this.core.$onChanges(e)},e.prototype.$onDestroy=function(){this.core.$onDestroy()},e})();i.FilterVisualController=v;var g=(function(){function i(e){this.services=e,this.currentZone=this.services.explorationNavigation.getCurrentZone()}return i.prototype.$onInit=function(){var t=this;e.zoneify(this.currentZone,(function(){return t.onInitImpl()}))},i.prototype.$onChanges=function(t){var i=this;e.zoneify(this.currentZone,(function(){return i.onChangesImpl(t)}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll(),this.viewModel.setServices(void 0,this.services.visualPlugin,this.services.viewModeState),this.viewModel.readOnlyState.visual=void 0},i.prototype.onInitImpl=function(){var i=this,a=this.services.singleExecutableDataProxyFactory.create();if(this.visualDataProxyService=n.createExploreVisualDataProxyService(a,this.services.filterGenerator,this.services.promiseFactory,this.services.visualPlugin,this.services.explorationCapabilities,!!this.currentZone),this.crossFilteringHostService=this.createFilteringHostService(),this.requireSingleSelectLabel=this.services.localizationService.get("PageFilter_SingleSelectionRequired"),t.PodUtils.isPodEnabled(this.viewModel.contract,this.viewModel.getFilterContainerScope())&&this.isPodParameter())this.viewModel.isSingleSelectionRequired=!0;else if(this.viewModel.contract.objects){var s=r.getValue(this.viewModel.contract.objects,{objectName:"general",propertyName:"requireSingleSelect"},void 0);s&&s.value&&(this.viewModel.isSingleSelectionRequired=e.data.SQConstantExpr.getBooleanValue(s))}this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(t,r){return e.zoneify(i.currentZone,(function(){return i.onFilterContainerChanged(r)}))})).subscribe(o.explorationLoaded,(function(){return e.zoneify(i.currentZone,(function(){return i.updateSlowDataApplyEnabled()}))})).subscribe(o.sectionObjectsEvaluated,(function(t,r){return e.zoneify(i.currentZone,(function(){i.viewModel.isFilterExpanded()&&i.loadData(!1)}))})).subscribe(o.explorationUnloaded,(function(){return e.zoneify(i.currentZone,(function(){return i.updateSlowDataApplyEnabled()}))})).subscribe(o.applyAllClicked,(function(){return i.onApplyButtonClicked()})).subscribe(o.explorationSlowDataSourceSettingsLoaded,(function(t,r){return e.zoneify(i.currentZone,(function(){(r.isFilterSelectionsButtonEnabledChanged||r.isApplyAllButtonEnabledChanged)&&(i.applyBufferedFilter(),i.updateSlowDataApplyEnabled())}))})),this.updateSlowDataApplyEnabled(),this.init(this.viewModel)},i.prototype.onChangesImpl=function(e){this.isInitialized||e.expanded.currentValue!==!0||(this.init(this.viewModel),this.isInitialized=!0)},i.prototype.init=function(i){var r=this;this.viewModel=i,this.viewModel.setServices(e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return r.persistProperties(e)},e.loadMoreData=function(){return r.loadMoreData()},e.promiseFactory=function(){return r.services.promiseFactory},e.canSelect=function(e){return!0},e.getFilterExpressionMetadata=function(){return r.getFilterExpressionMetadata()},e.setFilterExpressionMetadata=function(e){return r.setFilterExpressionMetadata(e)},e.ignoreDefaultFilter=function(){return r.ignoreDefaultFilter()},e.dataMultiSelectMode=function(){return r.getDataMultiSelectMode()}})),this.services.visualPlugin,this.services.viewModeState),this.getConceptualSchema().then((function(e){if(r.viewModel.updateFilterProperties(e,r.services.visualPlugin,r.services.aggrOps),r.viewModel.updateViewState(),r.viewModel.isSingleSelectionRequired){var t=r.viewModel.getFilterContainerScope();r.isPodParameter()||1!==t.scopeType?r.updateVisualSelectAllState():r.updateRequiredState(!1)}r.viewModel.readOnlyState.expanded&&r.loadData(!1),r.loadRestatement()}))},i.prototype.loadRestatement=function(){var t=this,i=this.viewModel.contract;i.filter?this.getConceptualSchema().then((function(r){var o=e.visuals.plugins.slicer.capabilities,n=u(i.filter,void 0,i),a=t.services.displayNameService.getFilterRestatementForOverlay(n,r,o);!_.isEmpty(a)&&a[0]&&a[0].restatements?t.viewModel.setRestatement(a[0].restatements.join(t.services.localizationService.get("ListJoin_Separator"))):t.viewModel.setRestatement(void 0)})):this.viewModel.setRestatement(void 0)},i.prototype.ignoreDefaultFilter=function(){var e=this.viewModel.contract;return 1!==e.howCreated&&!s.isDefaultFilter(e.filter)},i.prototype.persistProperties=function(e){this.viewModel.contract.config.singleVisual.objects=this.viewModel.readOnlyState.visual.dataTransforms.objects,this.checkAndApplySelfFilterPropertyChanges(e),this.checkAndApplyFilterPropertyChanges(e)},i.prototype.checkAndApplySelfFilterPropertyChanges=function(i){var r,o=e.visuals.plugins.slicer.capabilities,n=this.services.filterGenerator.tryGetSelfFilterProperty(o);if(i&&!_.isEmpty(i.merge)?r=_.has(i.merge[0].properties,n.propertyName):i&&!_.isEmpty(i.remove)&&(r=_.has(i.remove[0].properties,n.propertyName)),r){var a=o.objects,s=this.viewModel.contract.config.singleVisual;t.services.applyPropertyChanges(i,a,s.objects),this.loadData(!1)}},i.prototype.checkAndApplyFilterPropertyChanges=function(t){var i,r,o=this.services.filterGenerator.tryGetFilterPropertyIdentifier(e.visuals.plugins.slicer.capabilities);t?(_.isEmpty(t.merge)||(r=_.has(t.merge[0].properties,o.propertyName),r&&(i=t.merge[0].properties[o.propertyName])),_.isEmpty(t.remove)||(r=r||_.has(t.remove[0].properties,o.propertyName)),r&&!this.bufferPropertyChanges(i)&&this.applyPropertyChanges(i)):this.bufferPropertyChanges(i)||this.applyPropertyChanges(i)},i.prototype.applyPropertyChanges=function(i){var r=this,o=this.viewModel;if(o.useDefaultFilter=!1,!s.isSameFilter(o.contract.filter,i)&&(!s.isAnyFilter(o.contract.filter)||i)){var n=this.viewModel.readOnlyState.visual,a=__assign({},n.data);n.data=a,this.services.undoRedo.register("UpdateFilter",(function(){var n=o.getFilterContainerScope();r.viewModel.contract.type=r.viewModel.readOnlyState.type,r.services.explorationActivity.doActivity((function(){r.services.visualAuthoring.updateFilter(n,o.contract,i);var e=i?2:10,a={filter:o.contract,changeType:e,scope:n,source:o};t.FilterUtils.notifyFilterContainerChangedByUser(r.services.eventBridge,a),r.loadRestatement()}),(function(i){return r.services.telemetryService.startActivity(i,e.telemetry.EXFilterPaneBasicFilterChanged,t.util.getTelemetryFilterScopeType(n.scopeType),t.util.getTelemetryFieldKind(o.contract.expression),t.util.getTelemetryViewMode(r.services.viewModeState.getMode()),r.viewModel.isInOutspacePane)}))}))}},i.prototype.isViewMode=function(){return 0===this.services.viewModeState.getMode()},i.prototype.isFooterVisible=function(){return this.viewModel.readOnlyState.canToggleSingleSelect&&(!this.isInOutspacePane||this.singleFilterPane()&&!this.isViewMode())},i.prototype.singleFilterPane=function(){return this.services.featureSwitchService.featureSwitches.singleFilterPane},i.prototype.updateRequiredState=function(e){void 0===e&&(e=!0);var i=this.viewModel.isSingleSelectionRequired;this.services.visualAuthoring.setRequireSingleSelection(this.viewModel.contract,this.viewModel.getFilterContainerScope(),i),this.updateVisualSelectAllState(),this.triggerDataChanged();var r=this.viewModel;if(e&&i&&r.contract.filter){this.services.visualAuthoring.updateFilter(r.getFilterContainerScope(),r.contract,void 0);var o={filter:r.contract,changeType:10,scope:r.getFilterContainerScope()};t.FilterUtils.notifyFilterContainerChangedByUser(this.services.eventBridge,o)}else e&&this.services.visualAuthoring.updateFilter(r.getFilterContainerScope(),r.contract,r.contract.filter)},i.prototype.isPodParameter=function(){var e=this.services.explorationNavigation.getCurrentExploration(),i=this.services.explorationNavigation.getCurrentSection(),r=this.viewModel.contract.name;return!!(e&&i&&r)&&t.PodUtils.hasParameter(e,i.name,r)},i.prototype.createFilteringHostService=function(){var t=this;return e.Prototype.inherit(d.createQueryVisualHostServices(),(function(e){e.getFilters=function(e,i){return t.services.filterGenerator.calculateFilterContainerInputFilter(t.services.explorationNavigation.getCurrentExploration(),t.services.explorationNavigation.getCurrentSection(),t.viewModel.contract,i,t.viewModel.getFilterContainerScope())},e.getDataSourceVariables=function(){var e=t.services.explorationNavigation.getCurrentExploration();return void 0!==e?e.dataSourceVariables:void 0}}))},i.prototype.loadMoreData=function(){this.visualDataProxyService.canLoadMore()&&this.loadData(!0)},i.prototype.loadData=function(e){var t=this;this.viewModel.isLoading=!0,this.hasQueryError=!1,this.getConceptualSchema().then((function(i){var r=t.services.dataSources.get(),o={dataSources:r,schema:i,config:t.viewModel.contract.config.singleVisual,hostServices:t.crossFilteringHostService,visualQueryGenerator:t.services.visualQueryGenerator,executionType:e?1:0,currentZone:t.currentZone};return t.visualDataProxyService.runQuery(o).then((function(r){var o=t.visualDataProxyService.lastExecutedQuery();t.hasQueryError=!1,t.applyVisualStyling(o.transforms),e===!0?t.onMergeMoreData(r,i,o.transforms):t.onDataChanged(r,i,o.transforms)}),(function(e){t.hasQueryError=!0})).finally((function(){t.viewModel.isLoading=!1}))}))},i.prototype.onDataChanged=function(e,t,i){var r=this.viewModel.readOnlyState.visual;if(e&&e.dataReaderResult&&r){var o={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null,dataViewSource:e&&e.dataViewSource?e.dataViewSource:null},n=p.isSegment(o.dataView);n&&(o.isFirstSegment=n),this.updateVisualState(i,o),this.viewModel.updateViewState(),this.dataLoaded=!0}},i.prototype.onMergeMoreData=function(t,i,r){var o=this.viewModel.readOnlyState.visual;if(t&&t.dataReaderResult&&o){var n=t.dataReaderResult.dataView;if(n){var a=o.data.dataView;e.data.segmentation.DataViewMerger.mergeDataViews(a,n);var s={dataView:a,dataViewSource:t&&t.dataViewSource,isFirstSegment:!1};this.updateVisualState(r,s)}}},i.prototype.updateVisualState=function(e,t){var i=this.viewModel.readOnlyState.visual;i.data=t,i.dataTransforms=e,e&&(this.viewModel.contract.config.singleVisual.objects=e.objects)},i.prototype.onFilterContainerChanged=function(i){var o=this.viewModel,n=o.readOnlyState.visual;if(i.filter===o.contract)if(h.hasFlag(i.changeType,2)){if(10===i.changeType){if(n&&n.visual&&(n.visual.onClearSelection(),n.dataTransforms)){var l=n.dataTransforms.objects,c=e.visuals.slicerProps.general.filter,u=e.visuals.slicerProps.data.isInvertedSelectionMode;o.contract.filter?r.setValue(l,c,null,o.contract.filter):r.deleteProperty(l,c.objectName,null,c.propertyName),r.deleteProperty(l,u.objectName,null,u.propertyName)}o.contract.filter&&!s.isAnyFilter(o.contract.filter)||o.setRestatement(a.fromDataViewScopeIdentities([],!1,o.formatter)),s.isDefaultFilter(o.contract.filter)&&o.setRestatement(a.fromDefault(o.defaultValue.value))}s.isSameFilter(o.contract.filter,i.filter.filter)||(o.readOnlyState.visual.dataTransforms&&(o.contract.config.singleVisual.objects=o.readOnlyState.visual.dataTransforms.objects),this.services.visualAuthoring.updateFilter(o.getFilterContainerScope(),o.contract,i.filter.filter),null!=i.filter.filter&&this.loadData(!1)),this.singleFilterPane()||null==i.filter.filter||o===i.source||this.loadData(!1);var p=this.visualDataProxyService.lastExecutedQuery();p&&(this.applyVisualStyling(p.transforms),this.triggerDataChanged()),this.loadRestatement()}else if(this.dataLoaded&&h.hasFlag(i.changeType,4))this.loadData(!1);else if(h.hasFlag(i.changeType,16))n&&n.visual&&n.visual.update({viewport:t.viewModels.FilterViewModel.DefaultVisualViewPort,type:e.VisualUpdateType.Resize,dataViews:null});else if(h.hasFlag(i.changeType,32)){var d=this.viewModel;d!==i.source&&(d.cardType.type=i.filter.type)}},i.prototype.updateVisualSelectAllState=function(){var t=this.viewModel.readOnlyState.visual;if(t){var i=this.viewModel.isSingleSelectionRequired,o=t.dataTransforms.objects,n=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,a=e.visuals.slicerProps.selection.singleSelect;o||(o={}),r.setValue(o,n,null,c.boolean(!i)),r.setValue(o,a,null,c.boolean(i))}},i.prototype.triggerDataChanged=function(){var e=this.viewModel.readOnlyState.visual;if(e&&e.data){var t={dataView:e.data.dataView,dataViewSource:e.data.dataViewSource,isFirstSegment:e.data.isFirstSegment};e.data=t}},i.prototype.setFilterExpressionMetadata=function(i){var r,o=this.viewModel.contract;if(i&&!_.isEmpty(i.expressions)&&!_.isEmpty(i.cachedValueItems)){var n=e.data.ScopeIdentityExtractor.getKeys(i.cachedValueItems[0].identities[0].expr);(n.length>1||!l.equals(o.expression,n[0]))&&(r=i)}o.cachedValueItems=t.FilterExpressionMetadataUtils.tryGetDisplayNameIdentityPairs(r)},i.prototype.getFilterExpressionMetadata=function(){var e,i=this.viewModel.contract;if(!_.isEmpty(i.cachedValueItems)){var r=i.expression;e=t.FilterExpressionMetadataUtils.convertCacheToFilterExpressionMetadata(r,i.cachedValueItems)}return e},i.prototype.getDataMultiSelectMode=function(){return this.services.viewModeState.getConfig().touchOptions.dataMultiSelectMode},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return e&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual?this.services.conceptualSchemaProxy.get(e):this.services.promiseFactory.reject()},i.prototype.updateSlowDataApplyEnabled=function(){if(this.slowDataApplyEnabled=!1,this.services.featureSwitchService.featureSwitches.slowDataSourceModeEnabled){var e=this.services.explorationNavigation.getCurrentExploration();e&&e.slowDataSourceSettings&&(this.applyAllEnabled=e.slowDataSourceSettings.isApplyAllButtonEnabled,this.slowDataApplyEnabled=e.slowDataSourceSettings.isFilterSelectionsButtonEnabled||this.applyAllEnabled)}},i.prototype.isApplyButtonVisible=function(){return this.slowDataApplyEnabled&&!this.applyAllEnabled},i.prototype.isApplyButtonEnabled=function(){return this.haveBufferedFilter},i.prototype.onApplyButtonClicked=function(){this.slowDataApplyEnabled&&(document.activeElement.blur(),this.applyBufferedFilter())},i.prototype.applyBufferedFilter=function(){if(this.haveBufferedFilter){var e=this.bufferedFilter;this.haveBufferedFilter=!1,this.bufferedFilter=void 0,this.applyPropertyChanges(e)}},i.prototype.bufferPropertyChanges=function(e){return!!this.slowDataApplyEnabled&&(!(!this.haveBufferedFilter&&s.isSameFilter(this.viewModel.contract.filter,e))&&(this.haveBufferedFilter=!0,this.bufferedFilter=e,this.applyAllEnabled&&t.FilterUtils.notifyBufferedFilterChanges(this.services.eventBridge,this.viewModel.getFilterContainerScope().scopeType,t.contracts.FilterType.Visual,this.viewModel.id,!0),!0))},i.prototype.applyVisualStyling=function(t){if(this.viewModel.isInOutspacePane){var i={},o=e.visuals.slicerProps.searchBox,n=e.visuals.slicerProps.items,a={solid:{color:e.data.SQExprBuilder.text(this.viewModel.inputBoxForegroundColor)}},s={solid:{color:e.data.SQExprBuilder.text(this.viewModel.inputBoxBackgroundColor)}},l={solid:{color:e.data.SQExprBuilder.text(this.viewModel.inputBoxBorderColor)}},c={solid:{color:e.data.SQExprBuilder.text(this.viewModel.foregroundColor)}},u=_.toInteger(_.replace(this.viewModel.fontSize,"pt","")),p=e.data.SQExprBuilder.integer(u),d=e.data.SQExprBuilder.text(this.viewModel.fontFamily);r.setValue(i,o.fontColor,null,a),r.setValue(i,o.background,null,s),r.setValue(i,o.borderColor,null,l),r.setValue(i,o.textSize,null,p),r.setValue(i,o.fontFamily,null,d),r.setValue(i,n.fontColor,null,c),r.setValue(i,n.textSize,null,p),r.setValue(i,n.fontFamily,null,d),r.extend(i,t.objects),t.objects=i}},i})();i.FilterVisualCore=g})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.FilterVisual={bindings:{viewModel:"=",expanded:"<",isInOutspacePane:"<?",currentZone:"<?"},controller:e.common.createController(t.FilterVisualController),templateUrl:"components/filterVisual/filterVisual.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.EnumExtensions,o=e.explore.services.events,n=(function(){function e(e,t){this.services=t,this.core=new a(this.services)}return Object.defineProperty(e.prototype,"filterViewModel",{get:function(){return this.core.filterViewModel},set:function(e){this.core.filterViewModel=e},enumerable:!0,configurable:!0}),e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","displayNameService"],scopedDependencies:["includeExcludeService","eventBridge","explorationNavigation","visualAuthoring","dataSources"]}},e.prototype.$onInit=function(){this.core.$onInit()},e.prototype.$onDestroy=function(){this.core.$onDestroy()},e})();i.IncludeExcludeFilterController=n;var a=(function(){function i(e){var t=this;this.isExpanded=!1,this.services=e,this.currentZone=e.explorationNavigation.getCurrentZone(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,i){return t.onFilterContainerChanged(i)})),this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1}}return i.prototype.$onInit=function(){var t=this;e.zoneify(this.currentZone,(function(){return t.onInitImpl()}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.toggleExpand=function(){this.isExpanded=!this.isExpanded},i.prototype.deleteFilter=function(e){var t=this.filterViewModel.getFilterContainerScope();this.services.visualAuthoring.removeFilter(this.filterViewModel.contract,t),e.stopPropagation()},i.prototype.delete=function(e,i){if(1===this.viewModel.points.length)return void this.deleteFilter(e);var r=this.filterViewModel.contract;if(r.filterExpressionMetadata&&!_.isEmpty(r.filterExpressionMetadata.cachedValueItems)){var o=this.viewModel.points[i];t.FilterUtils.removeEntryFromFilterCache(o.columns,o.values,r.filterExpressionMetadata)}this.viewModel.points.splice(i,1),this.services.includeExcludeService.updateFilterContainer(this.filterViewModel,this.viewModel),e.stopPropagation()},i.prototype.onInitImpl=function(){this.updateViewModel()},i.prototype.updateViewModel=function(){var e=this,t=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(t).then((function(t){var i=e.filterViewModel.contract;e.viewModel=e.services.includeExcludeService.buildViewModel(i.filter,i.type,t,e.services.displayNameService,i.filterExpressionMetadata)}))},i.prototype.getFilterLockTooltip=function(){return this.filterViewModel.isFilterLocked()?"FilterPane_FilterLocked":this.filterViewModel.contract.isLockedInViewMode?"FilterPane_UnlockFilter":"FilterPane_LockFilter"},i.prototype.onFilterContainerChanged=function(e){e.filter===this.filterViewModel.contract&&r.hasFlag(e.changeType,2)&&this.updateViewModel()},i.prototype.toggleFilterVisibility=function(e,t){e.stopPropagation();var i=this.filterViewModel;this.services.visualAuthoring.toggleFilterVisibility(i.getFilterContainerScope(),i.contract)},i.prototype.toggleFilterLockState=function(e,i){e.stopPropagation();var r=this.filterViewModel;this.services.visualAuthoring.toggleFilterLock(r.getFilterContainerScope(),r.contract);var o={filter:r.contract,changeType:2,scope:r.getFilterContainerScope()};t.FilterUtils.notifyFilterContainerChangedByUser(this.services.eventBridge,o)},i})();i.IncludeExcludeFilterCore=a})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.IncludeExcludeFilter={templateUrl:"components/includeExcludeFilter/includeExcludeFilter.html",controller:e.common.createController(t.IncludeExcludeFilterController),bindings:{filterViewModel:"<"},controllerAs:"$ctrl"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=(function(){function t(){this.exploreUIShellConfig=e.modules.ExploreUIShellModule}return t})();t.InlineExploreVisualTypesContainerController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.InlineExploreVisualTypesContainer={controller:e.common.createController(e.explore.controllers.InlineExploreVisualTypesContainerController),templateUrl:"components/inlineExploreVisualTypesContainer/inlineExploreVisualTypesContainer.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Background="background",e.Border="border",e.CategoryAxis="categoryAxis",e.ConditionalFormatting="conditionalFormatting",e.General="general",e.Gradient="gradient",e.Labels="labels",e.LockAspect="lockAspect",e.StylePreset="stylePreset",e.VisualHeader="visualHeader",e.VisualTooltip="visualTooltip",e.VisualHeaderTooltip="visualHeaderTooltip",e.Title="title",e.VisualLink="visualLink",e.ValueAxis="valueAxis"})(t=e.PropertyCardNames||(e.PropertyCardNames={}));var i;!(function(e){e.Position="position",e.RevertToDefault="revertToDefault",e.SecPosition="secPosition",e.Slider="slider",e.Show="show",e.SecShow="secShow",e.ShowAxisTitle="showAxisTitle",e.SecShowAxisTitle="secShowAxisTitle",e.TextArea="textarea",e.NumericSelection="numericSelection",e.Selection="selection"})(i=e.PropertySliceNames||(e.PropertySliceNames={}));var r;!(function(e){e.X="x",e.Y="y",e.Width="width",e.Height="height",e.AltText="altText",e.AllowBinnedLineSample="allowBinnedLineSample",e.AllowOverlappingPointsSample="allowOverlappingPointsSample"})(r=e.GeneralPropertyNames||(e.GeneralPropertyNames={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.AngularJSForm,o=e.data.RelativeDateFilterPattern,n=e.data.RelativeDateQualifier,a=jsCommon.Utility,s=e.data.RelativeFilterType,l=(function(){function e(e,t){var i=this;this.services=t;var r=function(e){return i.onFilterChanged({args:e})};this.core=new c(this.services,r),this.core.relativeFilterType=s.Date}return Object.defineProperty(e.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(e){this.core.viewModel=e},enumerable:!0,configurable:!0}),e.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","undoRedo","viewModeState","visualAuthoring","visualPlugin"]}},e.prototype.$onInit=function(){this.core.filterForm=new r(this),this.core.$onInit()},e.prototype.$onDestroy=function(){this.core.$onDestroy()},e})();i.RelativeDateFilterController=l;var c=(function(){function i(t,i){var r=this;this.services=t,this.onFilterChanged=i,this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.applyAllClicked,(function(){return r.applyFilter()})).subscribe(e.explore.services.events.filterContainerChanged,(function(e,t){return r.onFilterContainerChanged(t)}))}return i.prototype.$onInit=function(){var t=this;this.currentZone=this.services.explorationNavigation.getCurrentZone(),e.zoneify(this.currentZone,(function(){return t.onInitImpl()}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.applyFilter=function(){var e=this;if(this.canApplyFilter()){document.activeElement.blur(),this.viewModel.contract.type=t.viewModels.RelativeFilterViewModelUtil.relativeFilterTypeToFilterType(this.relativeFilterType);var i=t.viewModels.RelativeFilterViewModelUtil.computeCommandString(this.relativeFilterType),r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(t){e.services.undoRedo.register(i,(function(){var t=e.vm.getRelativeDateRangeOptions();e.logFilterAppliedTelemetry(t,(function(){var i=o.buildSemanticFilter({field:e.vm.dateField,options:t});e.services.visualAuthoring.updateFilter(e.viewModel.getFilterContainerScope(),e.viewModel.contract,i),e.viewModel.useDefaultFilter=!1,e.filterForm.setPristine(),e.updateRestatement(),e.onFilterChanged({filter:e.viewModel.contract,changeType:2,scope:e.viewModel.getFilterContainerScope(),source:e.viewModel})}))}))}))}},i.prototype.canApplyFilter=function(){return this.viewModel&&!this.viewModel.cardType.invalid&&this.vm&&this.vm.relativeUnit&&this.vm.relativeQualifier&&(this.vm.duration>0||this.vm.relativeQualifier.value===n.Current)&&this.filterForm&&this.filterForm.isDirty()&&this.filterForm.isValid()},i.prototype.isApplyAllEnabled=function(){var e=this.services.explorationNavigation.getCurrentExploration();return!!(e&&e.slowDataSourceSettings&&e.slowDataSourceSettings.isApplyAllButtonEnabled)},i.prototype.onModelChanged=function(){this.isApplyAllEnabled()&&this.filterForm.isDirty()&&t.FilterUtils.notifyBufferedFilterChanges(this.services.eventBridge,this.viewModel.getFilterContainerScope().scopeType,t.contracts.FilterType.RelativeDate,this.viewModel.id,this.canApplyFilter())},i.prototype.onInitImpl=function(){this.viewModel.setServices(void 0,void 0,this.services.viewModeState),this.initializeViewModel(this.viewModel.contract),this.includeTodayLabel=this.services.localizationService.get("RelativeDateFilter_IncludeToday")},i.prototype.initializeViewModel=function(e){var i=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var n=o.extractParametersFromSemanticFilter(e.filter,i.relativeFilterType),a=e.expression||n&&n.field,s=n&&n.options;i.vm=t.viewModels.RelativeFilterViewModelUtil.createRelativeFilterViewModel(i.relativeFilterType,a,i.services.localizationService,s),i.viewModel.updateFilterProperties(r,i.services.visualPlugin,i.services.aggrOps),i.viewModel.updateViewState(),n?i.updateRestatement():(i.filterForm.setDirty(),e.filter||i.clearRestatement())}))},i.prototype.logFilterAppliedTelemetry=function(e,i){var r=t.viewModels.RelativeFilterViewModelUtil.createTelemetryEvent(this.relativeFilterType,this.services,this.viewModel.isInOutspacePane,e);try{i(),r.resolve()}catch(e){throw r.reject(),a.ensureError(e)}},i.prototype.onFilterContainerChanged=function(e){e.filter===this.viewModel.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,10)&&this.initializeViewModel(e.filter),e.filter===this.viewModel.contract&&e.source!==this.viewModel&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&this.initializeViewModel(e.filter)},i.prototype.updateRestatement=function(){var e=this.services.visualTimeSynchronizationService?this.services.visualTimeSynchronizationService.getAnchorTime():void 0;this.viewModel.setRestatement(this.vm.getRestatement(this.viewModel.isFilterExpanded(),e))},i.prototype.clearRestatement=function(){this.viewModel.setRestatement(void 0)},i})();i.RelativeFilterCore=c})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.RelativeDateFilter={templateUrl:"components/relativeFilter/relativeDateFilter/relativeDateFilter.html",controller:e.common.createController(t.RelativeDateFilterController),bindings:{viewModel:"<",onFilterChanged:"&"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=t.contracts.FilterType,n=e.data.RelativeFilterType,a=e.data.RelativeDateQualifier,s=e.data.RelativeDateFilterPattern;!(function(r){function l(e,t,r,o){switch(e){case n.Time:return new i.RelativeFilterViewModel(t,r,o,n.Time);case n.Date:return new i.RelativeFilterViewModel(t,r,o,n.Date);default:return debug.assertNever(e),null}}function c(e){switch(e){case n.Time:return new i.RelativeTimeFilterViewModelComponent;case n.Date:return new i.RelativeDateFilterViewModelComponent;default:return debug.assertNever(e),null}}function u(e,t){switch(e){case n.Time:return!0;case n.Date:return t;default:return debug.assertNever(e),!1}}function p(e){switch(e){case n.Time:return"ApplyRelativeTimeFilter";case n.Date:return"ApplyRelativeDateFilter";default:return debug.assertNever(e),"unknown command"}}function d(e){switch(e){case n.Time:return o.RelativeTime;case n.Date:return o.RelativeDate;default:return debug.assertNever(e),null}}function h(e){switch(e){case o.RelativeTime:return n.Time;case o.RelativeDate:return n.Date;default:return null}}function v(i,r,o,l){switch(i){case n.Time:return r.telemetryService.startEvent(e.telemetry.EXFilterPaneRelativeTimeFilterApplied,a[l.relativeQualifier],l.duration,e.data.RelativeDateUnit[l.relativeUnit],t.util.getTelemetryViewMode(r.viewModeState.getMode()),o);case n.Date:return r.telemetryService.startEvent(e.telemetry.EXFilterPaneRelativeDateFilterApplied,a[l.relativeQualifier],l.duration,e.data.RelativeDateUnit[l.relativeUnit],l.includeToday,s.isCalendarPeriod(l.relativeUnit),t.util.getTelemetryViewMode(r.viewModeState.getMode()),o);default:return debug.assertNever(i),null}}r.createRelativeFilterViewModel=l,
r.createRelativeFilterViewModelComponent=c,r.calculateIncludeToday=u,r.computeCommandString=p,r.relativeFilterTypeToFilterType=d,r.filterTypeToRelativeFilterType=h,r.createTelemetryEvent=v})(r=i.RelativeFilterViewModelUtil||(i.RelativeFilterViewModelUtil={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.AngularJSForm,o=e.explore.util.DragDropTypes,n=e.data.FieldExprPattern,a=t.contracts.FilterType,s=e.data.SQExprBuilder,l=e.data.SQExprConverter,c=e.data.SQExprUtils,u=e.data.TopNFilterPattern,p=(function(){function e(e,t){var i=this;this.services=t;var r=function(e){return i.onFilterChanged({args:e})};this.core=new d(r,this.services)}return Object.defineProperty(e.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(e){this.core.viewModel=e},enumerable:!0,configurable:!0}),e.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","dropdown","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","undoRedo","viewModeState","visualAuthoring","visualPlugin"]}},e.prototype.$onInit=function(){this.core.topNFilterForm=new r(this),this.core.$onInit()},e.prototype.$onDestroy=function(){this.core.$onDestroy()},e})();i.TopNFilterController=p;var d=(function(){function r(e,t){this.onFilterChanged=e,this.services=t,this.topNMaxValue=9999999,this.topNMinValue=1}return r.prototype.$onInit=function(){var t=this;this.currentZone=this.services.explorationNavigation.getCurrentZone(),e.zoneify(this.currentZone,(function(){return t.onInitImpl()})),this.topNEditAriaLabel=this.services.localizationService.get("Top_N_Edit_Aria_Label")},r.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},r.prototype.applyFilter=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r;return __generator(this,(function(o){switch(o.label){case 0:return this.canApplyFilter()?(document.activeElement.blur(),this.viewModel.contract.type=a.TopN,e={fieldBeingFiltered:this.viewModel.contract.expression,isTop:this.vm.targetType.type===i.TopNFilterType.Top,itemCount:this.vm.itemCount,orderByField:this.vm.orderByField},[4,this.services.visualAuthoring.updateTopNFilter(this.viewModel.visualContainer,e,this.viewModel.getFilterContainerScope(),this.viewModel.contract,this.viewModel.isInOutspacePane)]):[2];case 1:return t=o.sent(),t&&(r={filter:this.viewModel.contract,changeType:2,scope:this.viewModel.getFilterContainerScope(),source:this.viewModel},this.viewModel.useDefaultFilter=!1,this.updateRestatement(),this.topNFilterForm.setPristine(),this.onFilterChanged(r)),[2]}}))}))},r.prototype.canApplyFilter=function(){return this.checkDisabled(),!this.viewModel.cardType.invalid&&this.vm&&this.vm.itemCount>0&&null!=this.vm.orderByField&&this.topNFilterForm.isDirty()&&this.topNFilterForm.isValid()},r.prototype.dropFilterTarget=function(){var e=this,r=this.services.dragDataService.getDragContext();if(r&&r.field){var o=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(o).then((function(o){var n=r.field,a=c.isMeasure(n)?n:s.aggregate(n,e.services.aggrOps.defaultAggregate(n,o,!0));e.isValidOrderByExpr(a,o)&&i.TopNFilterViewModelFactory.updateOrderByField(e.vm,a,o,e.services.displayNameService,e.services.localizationService,e.services.aggrOps)&&e.topNFilterForm.setDirty(),e.isApplyAllButtonEnabled()&&t.FilterUtils.notifyBufferedFilterChanges(e.services.eventBridge,e.viewModel.getFilterContainerScope().scopeType,t.contracts.FilterType.TopN,e.viewModel.id,e.canApplyFilter())}))}},r.prototype.getDropAction=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this.services.promiseFactory.defer(),t=0,this.viewModel.cardType.invalid?[3,2]:(i=this.services.dragDataService.getDragContext(),i&&i.field?(r=i.field,o=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(o)]):[3,2]);case 1:n=a.sent(),this.isValidOrderByExpr(r,n)&&!c.isFromVariation(r)&&(t=1),a.label=2;case 2:return e.resolve(t),[2,e.promise]}}))}))},r.prototype.removeOrderBy=function(){i.TopNFilterViewModelFactory.removeOrderByField(this.vm),this.topNFilterForm.setDirty(),this.isApplyAllButtonEnabled()&&t.FilterUtils.notifyBufferedFilterChanges(this.services.eventBridge,this.viewModel.getFilterContainerScope().scopeType,t.contracts.FilterType.TopN,this.viewModel.id,this.canApplyFilter())},r.prototype.selectAggregate=function(e){var r=this;if(e!==this.vm.selectedAggregate){var o=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(o).then((function(t){i.TopNFilterViewModelFactory.updateAggregate(r.vm,e,t,r.services.displayNameService,r.services.localizationService)&&r.topNFilterForm.setDirty()})),this.isApplyAllButtonEnabled()&&t.FilterUtils.notifyBufferedFilterChanges(this.services.eventBridge,this.viewModel.getFilterContainerScope().scopeType,t.contracts.FilterType.TopN,this.viewModel.id,this.canApplyFilter())}},r.prototype.showContextMenu=function(e){var t=this,i={anchorElement:$(e.currentTarget)};this.services.dropdown.showContextMenu(this.vm.availableAggregates,void 0,(function(e){return t.selectAggregate(e.aggregate)}),!1,void 0,void 0,!0,i)},r.prototype.checkDisabled=function(){var t=this,i=this.viewModel.getFilterContainerScope().container;this.viewModel.cardType.invalid=_.some(i.filters,(function(i){return i!==t.viewModel.contract&&e.data.TopNFilterPattern.extractParametersFromFilter(i.filter)}))},r.prototype.initializeViewModel=function(e){var t=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=e&&e.filter&&u.extractParametersFromFilter(e.filter);t.vm=i.TopNFilterViewModelFactory.createViewModel(o,r,t.services.localizationService,t.services.displayNameService,t.services.aggrOps),t.updateRestatement(),t.viewModel.updateFilterProperties(r,t.services.visualPlugin,t.services.aggrOps),t.viewModel.updateViewState()}))},r.prototype.isValidOrderByExpr=function(e,t){var i=l.asFieldPattern(e,t);return!!(c.isMeasure(e)||n.getProperty(i)||i.hierarchyLevel)},r.prototype.onTopNFilterValueUpdate=function(e){var t=this,r=e.filterViewModel,o=e.orderByField;if(r&&r.contract===this.viewModel.contract){var n=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(n).then((function(e){t.isValidOrderByExpr(o,e)&&i.TopNFilterViewModelFactory.updateOrderByField(t.vm,o,e,t.services.displayNameService,t.services.localizationService,t.services.aggrOps)&&t.topNFilterForm.setDirty()}))}},r.prototype.onInitImpl=function(){var i=this;this.initializeViewModel(this.viewModel.contract),this.checkDisabled(),this.dropConfig={accept:o.Field},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})).subscribe(e.explore.services.events.applyAllClicked,(function(){return i.applyFilter()})).subscribe(t.viewModels.FilterEvents.topNFilterOrderByUpdate,(function(e,t){return i.onTopNFilterValueUpdate(t)}))},r.prototype.onFilterContainerChanged=function(e){e.filter===this.viewModel.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,10)&&this.initializeViewModel(e.filter),e.filter===this.viewModel.contract&&e.source!==this.viewModel&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&this.initializeViewModel(e.filter),this.checkDisabled()},r.prototype.updateRestatement=function(){this.viewModel.setRestatement(this.vm.getRestatement(this.services.localizationService))},r.prototype.onKeyUp=function(e){this.isApplyAllButtonEnabled&&(isFinite(e.key)||8===e.keyCode||46===e.keyCode)&&t.FilterUtils.notifyBufferedFilterChanges(this.services.eventBridge,this.viewModel.getFilterContainerScope().scopeType,t.contracts.FilterType.TopN,this.viewModel.id,this.canApplyFilter())},r.prototype.isApplyAllButtonEnabled=function(){var e=this.services.explorationNavigation.getCurrentExploration();return!(!e||!e.slowDataSourceSettings)&&e.slowDataSourceSettings.isApplyAllButtonEnabled},r})();i.TopNFilterCore=d})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.TopNFilter={templateUrl:"components/topNFilter/topNFilter.html",controller:e.common.createController(t.TopNFilterController),bindings:{viewModel:"<",onFilterChanged:"&"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"})(i=t.TopNFilterType||(t.TopNFilterType={}));var r=(function(){function t(e,t,i){this.filterTypes=e,this.targetType=t,this.itemCount=i}return t.prototype.getRestatement=function(t){var i=e.data.TopNFilterHelper;return i?i.getRestatement(t,this):null},t})();t.TopNFilterViewModel=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.TopNFilterPattern;!(function(r){function s(e,t,i,r,o){var n=a.extractParametersFromFilter(e);if(n)return l(n,t,i,r,o)}function l(e,t,r,o,n){var a=!e||e.isTop?i.TopNFilterType.Top:i.TopNFilterType.Bottom,s=v(r),l=new i.TopNFilterViewModel(s,_.find(s,(function(e){return e.type===a})),e&&e.itemCount);return e&&u(l,e.orderByField,t,o,r,n),l}function c(e){e.orderByField=null,e.availableAggregates=null,e.selectedAggregate=null,e.orderByDisplayName=null}function u(e,t,i,r,n,a){return!o.equals(t,e.orderByField)&&(e.orderByField=t,e.availableAggregates=h(t,i,a,n),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,null,null,null,{includeVariationSource:!0}),e.selectedAggregate=o.isAggregation(t)?t.func:null,d(e),!0)}function p(e,t,i,r,o){return e.selectedAggregate!==t&&(e.orderByField=n.setAggregate(e.orderByField,t),e.selectedAggregate=t,d(e),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,null,null,null,{includeVariationSource:!0}),!0)}function d(e){for(var t=0,i=e.availableAggregates.items;t<i.length;t++){var r=i[t];r.checked=r.key.aggregate===e.selectedAggregate}}function h(i,r,o,n){return{items:t.viewModels.MenuItemFactory.createAggregateMenuItems(i,r,o,!1,e.VisualDataRoleKind.Measure,[])}}function v(e){return[{type:i.TopNFilterType.Top,text:e.get("Top")},{type:i.TopNFilterType.Bottom,text:e.get("Bottom")}]}r.createViewModelFromSemanticFilter=s,r.createViewModel=l,r.removeOrderByField=c,r.updateOrderByField=u,r.updateAggregate=p,r.getAvailableAggregates=h})(r=i.TopNFilterViewModelFactory||(i.TopNFilterViewModelFactory={}))})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services,o=e.explore.services.events,n=e.data.SQExpr,a=t.util.VisualContainerUtils,s=(function(){function i(e,t){this.scope=e,this.services=t}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dataProxy","displayNameService","embedModeService","featureSwitchService","networkAvailability","promiseFactory","singleExecutableDataProxyFactory","telemetryService","visualContainerCacheStrategy"],scopedDependencies:["dataSources","eventBridge","explorationCapabilities","explorationNavigation","filterGenerator","resourceLoader","resourceRegistration","scriptVisuals","shell","visualInsightsAnalysisHandler","visualPlugin","visualPluginOps","visualQueryGenerator","visualLifecycleService","visualValidator","cachePolicyProviderService"]}},i.prototype.$onInit=function(){var e=this;this.initializeQueryHandler(),this.initializeVisual(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerChanged,(function(t,i){i&&e.visual&&i.affectContainer(e.visual)&&e.onVisualContainerChanged()})),this.modernVisual=this.services.featureSwitchService.featureSwitches.useVisualModern,this.onVisualContainerChanged(!0,!this.services.networkAvailability.isNetworkAvailable()||void 0)},i.prototype.$onChanges=function(e){this.visualDefinition&&e&&e.visualViewport&&(this.visualDefinition.viewport=this.visualViewport)},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.initializeQueryHandler=function(){var e=this,i={getDataSources:function(){return e.services.dataSources.get()},notifyStart:function(){return e.config.notifyStart()},notifyEnd:function(){return e.config.notifyEnd()},clearErrors:function(){return e.config.clearQueryErrors()},handleErrors:function(t){return e.config.handleQueryErrors(t)},handleWarnings:function(t,i){return e.config.handleQueryWarnings(t,i)},applyUpdate:function(t,i,r){return e.handleQueryResult(t,i,r)},loadMergedData:function(t){return e.setVisualData(t)}};this.queryHandler=r.createVisualContainerQueryHandler(i,this.config.queryVisualHostServices,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.visualPluginOps,this.services.dataProxy,this.services.networkAvailability,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell,t.services.createExploreVisualDataProxyService(this.services.singleExecutableDataProxyFactory.create(),this.services.filterGenerator,this.services.promiseFactory,this.services.visualPlugin,this.services.explorationCapabilities),this.services.visualContainerCacheStrategy,this.services.cachePolicyProviderService,this.services.visualInsightsAnalysisHandler,this.services.explorationCapabilities,this.services.resourceRegistration,this.services.visualLifecycleService)},i.prototype.initializeVisual=function(){var t=this,i=this.services.visualPlugin.getPlugin(a.getVisualType(this.visual)),r=i?i.name:void 0,o=e.data.DataViewObjectDefinitions.getValue(a.getContainerObjectDefinitions(this.visual),{objectName:"stylePreset",propertyName:"name"},void 0);this.visualDefinition={interactivityOptions:this.config.interactivityOptions,type:r,allowInvalidDataView:!0,themeCollection:this.themeCollection,viewport:this.visualViewport,dataTransforms:{objects:a.getObjectDefinitions(this.visual)},hostServices:this.getVisualHostServices(),visualAdapterHostServices:{startProgressBar:function(){return t.config.notifyStart()},stopProgressBar:function(){return t.config.notifyEnd()},getNextDataSegment:function(){return t.getNextDataSegment()}},stylePresetName:o&&n.isConstant(o)&&o.value,additionalObjectUpdates:this.config.additionalObjectUpdates,visualPlugin:this.services.visualPlugin}},i.prototype.onVisualContainerChanged=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(o){switch(o.label){case 0:return this.config.clearQueryErrors(),this.visualDefinition.type=a.getVisualType(this.visual),[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())];case 1:return e=o.sent(),[4,this.services.visualValidator.validate(this.visual,e)];case 2:return(r=o.sent())?(this.config.handleQueryErrors({code:r.code,getDetails:function(){return r.details}}),[2]):(this.services.visualQueryGenerator.shouldExecute(this.visual.config.singleVisual,this.services.dataSources.get())?this.applyUpdate({initialLoad:t,preferCurrentData:!1,allowCache:i}):this.queryHandler.updateNonQueryVisual(this.visual,this.visualDefinition.dataTransforms),[2])}}))}))},i.prototype.applyUpdate=function(e){void 0===e&&(e={});var t=e.initialLoad,i=e.preferCurrentData,r=e.allowCache;this.queryHandler.runQuery({contract:this.visual,viewport:this.visualDefinition.viewport,initialLoad:t,useVisualContainerCache:this.shouldUseCache(),preferCurrentData:i,allowCache:r,currentData:this.visualDefinition.data})},i.prototype.getNextDataSegment=function(){return this.queryHandler.getNextDataSegment({contract:this.visual,viewport:this.visualDefinition.viewport,useVisualContainerCache:this.shouldUseCache()})},i.prototype.loadMoreData=function(){this.queryHandler.loadMoreData({contract:this.visual,currentData:this.visualDefinition.data,useVisualContainerCache:this.shouldUseCache(),viewport:this.visualDefinition.viewport})},i.prototype.shouldUseCache=function(){return a.shouldUseQueryCache(this.visual,this.config.disableQueryCacheUpdates)},i.prototype.handleQueryResult=function(t,i,r){var o=this.visualDefinition;o.dataTransforms=i,r&&(o.dataTransforms=e.Prototype.inherit(o.dataTransforms),o.dataTransforms.objects=r),this.setVisualData(t)},i.prototype.setVisualData=function(t){var i=this.visualDefinition;i.data=t,i.dataAppliedEvent&&(i.dataAppliedEvent.reject(),i.dataAppliedEvent=void 0),i.dataAppliedEvent=this.services.telemetryService.startActivity(this.scope,e.telemetry.EXVisualDataChanged,this.visual.name)},i.prototype.getVisualHostServices=function(){var t=this,i=this.config.visualHostServices;return this.config.noLoadMore||(i=e.Prototype.inherit(i,(function(e){e.loadMoreData=function(){return t.loadMoreData()}}))),i},i})();i.SingleVisualHostController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.SingleVisualHost={templateUrl:"components/singleVisualHost/singleVisualHost.html",bindings:{visual:"<",visualViewport:"<",themeCollection:"<",config:"<"},controller:e.common.createController(t.controllers.SingleVisualHostController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(e,i){this.services=i,this.exploreUIShellConfig=t.modules.ExploreUIShellModule}return i.createOptions=function(){return{additionalServices:["telemetryService"],scopedDependencies:["viewModeState"]}},i.prototype.toggleTaskPane=function(){this.viewModel.isPaneExpanded=!this.viewModel.isPaneExpanded,this.services.telemetryService.logEvent(e.telemetry.EXTogglePaneExpanded,"Task",this.viewModel.isPaneExpanded,t.util.getTelemetryViewMode(this.services.viewModeState.getMode()))},i})();i.TaskPaneController=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.TaskPane={bindings:{viewModel:"<",fieldListConfig:"<"},controller:e.common.createController(t.TaskPaneController),templateUrl:"components/taskPane/taskPane.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){var i=new c(e.warningType,e.propertyId,e.selector,e.objectDiplayName,e.propertyDisplayName,e.valueExpr,null,e.expectedValueType),r={selector:i.selector,warnings:[i]},o=t[i.propertyId.objectName];o?o.push(r):t[i.propertyId.objectName]=[r]}var o=e.explore.services.ActionIdentifier,n=e.common.ArrowVerticalPosition,a=jsCommon.BrowserUtils,s=e.common.constants,l=e.common.events,c=e.data.DataBoundExprWarning,u=e.data.DataBoundObjectQueryExtensionWarning,p=e.data.DataViewObjectDefinitions,d=e.data.DataViewObjectDescriptors,h=t.util.DragDropTypes,v=jsCommon.DragDropUtils,g=e.data.dsr.DsrMessage,f=t.services.events,y=e.explore.FilterExpressionMetadataUtils,m=e.a11y.util.FocusUtility,C=e.explore.util.CanvasVisualsUtility.getDragRestrictElementRect,S=e.helpers,w=e.PbiPromise,b=t.viewModels.PropertySliceNames,x=t.util.QueryGeocodingTracker,E=t.services.selectionUtils,F=e.data.Selector,V=e.data.SemanticFilter,P=e.visuals.SlicerPluginMethods,M=e.data.SQExpr,T=e.data.SQExprUtils,D=e.common.helpers.TelemetryHelper.TelemetryEventManager,A=e.common.controllers.ToolbarOverlay,I=e.common.controllers.TransformRestriction,O=t.contracts.VisualContainer,N=t.util.VisualContainerUtils,L=t.contracts.VisualLink,k=e.visualHost.visualPluginServiceHelpers,R=t.contracts.VisualTitle,B=e.common.Watcher,z="errorInfo",H="disablePin",G=(function(){function e(e,t){this.$scope=e,this.services=t}return e.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","dataProxy","displayNameService","dragDataService","$element","embedModeService","errorService","explorationSerializer","featureSwitchService","geocoder","localizationService","modalDialogService","moduleLoader","networkAvailability","ngZone","overlayService","promiseFactory","screenReaderService","singleExecutableDataProxyFactory","telemetryService","trustedVisual","visualInstanceIdTracking","customVisualsAuthentication","themeService","lazyProviderModern","visualContainerCacheStrategy","globalEventBridge","visualTimeSynchronizationService"],scopedDependencies:["cachePolicyProviderService","clipboard","dataSources","decompositionAuthoringService","drill","drillToDetails","dropdown","expandCollapse","eventBridge","explorationActivity","explorationCapabilities","explorationNavigation","filterGenerator","formFactor","groupingDesignStateService","layoutAuthoring","lazyScoped","performanceAnalyzerService","resourceLoader","resourceRegistration","runningVisuals","scriptVisuals","selection","shell","sort","undoRedo","uiComponent","viewModeState","visibility","visualAuthoring","visualAuthoringOperations","visualContainerMenuFactory","visualHostTooltipServiceFactory","visualInsightsAnalysisHandler","visualLifecycleService","visualPlugin","visualPluginOps","visualQueryGenerator","visualRelationship","visualSync","visualValidator"]}},e.prototype.$onChanges=function(e){this.core&&(e.viewModel&&(this.core.viewModel=e.viewModel.currentValue),e.canvasLayout&&(this.core.canvasLayout=e.canvasLayout.currentValue),e.transformParent&&(this.core.transformParent=e.transformParent.currentValue))},e.prototype.$onInit=function(){this.currentZone=this.services.explorationNavigation.getCurrentZone(),this.core=new U(this.$scope,this.services.$element,this.services),this.core.viewModel=this.viewModel,this.core.canvasLayout=this.canvasLayout,this.core.transformParent=this.transformParent,this.core.currentZone=this.currentZone,this.core.$onInit()},e.prototype.$onDestroy=function(){this.core&&this.core.$onDestroy()},e.prototype.$doCheck=function(){this.core&&this.core.$doCheck()},e.prototype.$postLink=function(){this.core&&this.core.$postLink()},e})();i.VisualContainerController=G;var U=(function(){function i(t,i,r){var o=this;this.$scope=t,this.$element=i,this.services=r,this.lastProgressBarState={progressBarCount:0,detailVisualProgressBarCount:0,hasPendingGeocoding:!1},this.applyUpdateActivity=new D,this.watcher=new B,this.destroyed=!1,this.activeNotificationsCount=0,this.canDeferQuery=!0,this.optionsMenuFactory={createOptionsMenu:function(t,i){return __awaiter(o,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.updateSortSettings()];case 1:return e.sent(),this.updateMenuButtonsState(),[2,this.services.visualContainerMenuFactory.createOptionsMenu(this.viewModel,this.menuOptions,t,i)]}}))}))}}}return i.prototype.$onInit=function(){var t=this;e.zoneify(this.currentZone,(function(){return t.onInitImpl()}))},i.prototype.onInitImpl=function(){var i=this;this.watcher.add(z,(function(){return i.viewModel&&i.viewModel.errorInfo}),(function(){return i.updateDetailVisualVisibility()})),this.watcher.add(H,(function(){return i.viewModel&&i.viewModel.options&&i.viewModel.options.disablePin}),(function(){return i.updateDisablePin()}));var r=this.services.featureSwitchService.featureSwitches.telemetryV2;this.dataProxyService=t.services.createExploreVisualDataProxyService(this.services.singleExecutableDataProxyFactory.create(),this.services.filterGenerator,this.services.promiseFactory,this.services.visualPlugin,this.services.explorationCapabilities,r),this.isExplorationUnloaded=!1,this.isDraggable=!this.viewModel.parentGroup||this.isSelected(),this.queryExecutionServices={getDataSources:function(){return i.services.dataSources.get()},notifyStart:function(){return i.startProgressBar()},notifyEnd:function(){return i.stopProgressBar()},clearErrors:function(){return i.errorManager.clearError()},handleErrors:function(e,t){return i.handleQueryErrors(e,t)},handleWarnings:function(e,t){return i.handleQueryGenWarnings(e,t)},applyUpdate:function(e,t,r,o,n){return i.handleQueryResult(e,t,r,o,n)},loadMergedData:function(e,t){return i.loadMergedData(e,t)}},this.errorManager=t.util.createVisualContainerErrorManager(this.viewModel,(function(){return i.viewModel.getVisualType()}),(function(){return i.viewModel.contract}),{aggrOps:this.services.aggrOps,conceptualSchemaProxy:this.services.conceptualSchemaProxy,dataSources:this.services.dataSources,eventBridge:this.services.eventBridge,errorService:this.services.errorService,featureSwitchService:this.services.featureSwitchService,modalDialogService:this.services.modalDialogService,selection:this.services.selection,telemetryService:this.services.telemetryService,visualAuthoring:this.services.visualAuthoring}),this.initializeVisualContainerQueryHandler(),this.visualHostDropdown={showContextMenu:function(e,t,r){e&&t&&r&&i.services.dropdown.showContextMenu(e,t,r,!1)}},this.visualHostTooltip=this.services.visualHostTooltipServiceFactory.create(this.viewModel.contract,this.queryHandler),this.visualHostDecompositionService=t.util.VisualHostServicesUtil.createVisualHostDecompositionService(this.viewModel.contract,this.services.decompositionService),this.progressBarCount=0,this.detailVisualProgressBarCount=0,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(this.$scope),this.visualContainerDataSelectionService=t.services.createVisualContainerDataSelectionService(this.viewModel,this.services.visualPluginOps),this.viewModel.showWatermark=!1,this.viewModel.options=this.services.explorationCapabilities.getCapabilities().visualContainerOptions,this.endLoadDefer=this.services.promiseFactory.defer(r),this.viewModel.isFooterVisible=function(){return i.isFooterVisible()},this.updateContract("update"),this.menuOptions={canDelete:!1,canExport:!1,canSort:!1,canSearch:!1,canCluster:!1,canSpatialCluster:!1,hasMoreOptions:!1,canEdit:!1,sortSetting:{defaultSortBehavior:!1,sortableFields:[]},canSeeData:!1,canSpotlight:this.canSpotlight(),canAddComment:!1,exportDataDenied:!1},this.sortHelper=e.explore.services.createVisualSortHelper(this.menuOptions.sortSetting,this.viewModel,this.services.sort,this.services.undoRedo,this.services.timeout,this.services.visualAuthoringOperations),this.dropConfig={accept:h.Field,greedy:!1};var o=this.services.explorationNavigation.getCurrentExploration(),n=o&&o.report&&o.report.objectId;this.instanceId=jsCommon.Utility.generateGuid();var a=this.viewModel.contract.config.singleVisual.visualType;this.services.visualInstanceIdTracking.associate(this.instanceId,a),this.visualHostTelemetryService=t.services.createVisualHostTelemetryService(this.services.telemetryService,a,this.instanceId),this.visualHostAuthenticationService=this.services.customVisualsAuthentication,this.setViewModelServices(),this.toolbarManager=new Q(this.$element,this.services),this.disablePin=this.viewModel.options.disablePin,this.resetVisualStyle(),this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.viewModel.updateViewState();var s=this.viewModel.getRunningVisual();s.setReportId(n),s.setAdditionalObjectUpdates((function(e){return i.applyBufferedPropertyChangesToObjects(e)})),s.setIsDisabled(this.services.shell&&this.services.shell.areCustomVisualsDisabledByGroupPolicy()),s.setIsDisabledIfUncertified(this.services.shell&&this.services.shell.areUncertifiedVisualsDisabledByGroupPolicy()),s.setIsInFocus(this.viewModel.isPoppedOut),this.updateSelection(),this.resetPadding(),this.viewModel.showWatermark&&this.endLoadDefer.resolve(null),this.createCanvasLayoutItemOptions(),this.subscribeToEvents();var l=this.viewModel.contract,c=!l.initialLoadCompleted;l.initialLoadCompleted=!0;var u;this.services.networkAvailability.isNetworkAvailable()||(u=!0),this.geocodingTracker=new x({onStartGeocoding:function(){i.updateProgressBarState(),i.services.timeout()},onStopGeocoding:function(){i.updateProgressBarState(),i.services.timeout()}}),this.registerDomEventHandlers(),this.services.featureSwitchService.featureSwitches.useModernVisual?this.onVisualContainerChangedAsync(c,u):this.services.timeout((function(){return i.onVisualContainerChangedAsync(c,u)}))},i.prototype.$onDestroy=function(){this.endLoadDefer.resolve(null),this.canvasLayout.unregisterLayoutItem(this.canvasLayoutItem),this.hideOverlays(),this.toolbarManager&&this.toolbarManager.destroy(),this.subscriptionManager.unsubscribeAll(),this.reloadEmptyVisualSubscriptionManager&&this.reloadEmptyVisualSubscriptionManager.unsubscribeAll(),this.visualHostTooltip.hide({isTouchEvent:!1,immediately:!0}),this.updateContract("destroy"),this.queryHandler.cancelQuery("OnDestroy"),this.viewModel.reset(),this.destroyed=!0,this.clearProgressBarState()},i.prototype.$doCheck=function(){this.watcher.doCheck()},i.prototype.$postLink=function(){var t=this;this.toolbarManager.containerPresent.resolve(void 0),this.services.eventBridge.publishToChannel(e.explore.services.events.visualContainerControllerLinked,{visualContainer:this.viewModel.contract,focusCallback:function(){return t.focus()}})},i.prototype.onVisualReady=function(){this.endLoadDefer.resolve(null),this.services.eventBridge.publishToChannel(f.visualContainerDataRendered,this.viewModel.contract)},i.prototype.getFocusElement=function(){return this.$element.find(".visualContainer")},i.prototype.focus=function(){this.getFocusElement().focus()},i.prototype.registerDomEventHandlers=function(){var e=this,t=this.services.viewModeState.getConfig().displayOptions;if(this.getFocusElement().on("blur",(function(){return e.showSelectionBorder=!1})),!t.visualMouseoverDisabled){var i=this.$element;i.on("mouseenter",(function(){return e.services.timeout((function(){return e.setHover(!0)}))})),i.on("mouseleave",(function(){return e.services.timeout((function(){return e.setHover(!1)}))}))}},i.prototype.initializeVisualContainerQueryHandler=function(){this.queryHandler=t.services.createVisualContainerQueryHandler(this.queryExecutionServices,this.viewModel.hostServices,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.visualPluginOps,this.services.dataProxy,this.services.networkAvailability,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell,this.dataProxyService,this.services.visualContainerCacheStrategy,this.services.cachePolicyProviderService,this.services.visualInsightsAnalysisHandler,this.services.explorationCapabilities,this.services.resourceRegistration,this.services.visualLifecycleService)},i.prototype.computeStyle=function(){var e=this,t=this.viewModel,i=this.services.viewModeState,r=this.services.viewModeState.getConfig(),o=i.getMode(),n=!this.showSelectionBorder&&0===o&&!r.displayOptions.showVisualBordersInViewMode,a=this.getVisualHeaderPlacement(t),s=this.lastComputedStyle||[],l=0,c=function(t){s===e.lastComputedStyle&&(l<s.length&&t===s[l]?++l:s=s.slice(0,l)),s!==e.lastComputedStyle&&s.push(t)};return t.contract.initialLoadCompleted||c("loading"),this.showSelectionBorder&&c("keyFocus"),t.isSelected&&(c("selected"),c("swipeable-blocked")),t.isSelecting&&c("selecting"),0===o?c("readMode"):1===o&&c("editMode"),n&&c("hideBorder"),r.displayOptions.disableFadeout&&c("disableFadeout"),t.isPoppedOut&&c("popOut"),this.services.visibility.isSeeDataMode(this.viewModel.contract.visibility)&&c("seeData"),
4===t.contract.visibility&&c("spotlight"),2===t.contract.detailVisualLayout&&c("seeDataVerticalLayout"),t.isPaddingDisabled&&c("paddingDisabled"),t.visualTitleVisible()||c("noVisualTitle"),this.preventInnerScroll()&&c("preventVisualScrolling"),0===a?c("visualHeaderAbove"):1===a&&c("visualHeaderBelow"),s===this.lastComputedStyle&&l<s.length&&(s=s.slice(0,l)),this.lastComputedStyle=s,s},i.prototype.getVisualHeaderPlacement=function(e){if(!this.services.explorationCapabilities.getCapabilities().visualContainerOptions.useStylableHeader)return 3;if(this.services.viewModeState.getConfig().displayOptions.showMobileVisualContainerHeader)return 2;var i=e.uiScale.y;if(e.isPoppedOut||e.visualTitleVisible()&&i>=t.viewModels.VisualContainer.HeaderInTitleScaleThreshold)return 2;var r=e.position,o={height:r.height,width:r.width,top:r.y,left:r.x};if(o=t.util.CanvasVisualsUtility.addOffsetFromGroup(o,e),o.top*i>=t.viewModels.VisualContainer.VisualContainerHeaderHeight)return 0;var n=this.services.explorationNavigation.getCurrentSection();if(n){if((n.size.height-(o.top+o.height))*i>=t.viewModels.VisualContainer.VisualContainerHeaderHeight)return 1}return 2},i.prototype.onClosePopOut=function(e){e.stopPropagation(),this.closePopOut()},i.prototype.closePopOut=function(){this.applyBufferedPropertyChanges(),this.setPopOutMode(0),2===this.services.viewModeState.getMode()&&this.services.viewModeState.setMode(1),this.viewModel.setEditMode(0)},i.prototype.toggleSelect=function(e,i){var r=this;this.showSelectionBorder=i;var o=this.services.formFactor.getCurrentLayout(),n=1===o||i;t.util.CanvasVisualsUtility.toggleSelectContainer(e,this.viewModel,this.services.selection,this.services.overlayService,n),this.services.timeout((function(){r.services.clipboard.tryPasteFormat()}))},i.prototype.getVisualContainerTabindex=function(){return void 0!==this.viewModel.position.tabOrder&&this.viewModel.position.tabOrder<0?-1:0},i.prototype.getVisualContainerAriaLabel=function(){var e=this.services.localizationService.get("ScreenReader_Fullstop"),t=this.visualLinkProperties&&this.visualLinkProperties.hasVisualLink?e+" "+this.visualLinkProperties.title:"",i=""+this.viewModel.tooltip+t,r=this.getErrorDetails(),o="";return r&&(o=e+" "+this.services.localizationService.format("Visual_Error_Message",r.message)),i+o},i.prototype.getVisualContainerTooltipConfig=function(){return this.visualLinkProperties&&this.visualLinkProperties.hasVisualLink?{tooltipArrowVerticalPosition:n.bottom,tooltipTitle:this.visualLinkProperties.title,tooltipShowOnFocus:!0}:{tooltipDisable:!0}},i.prototype.setHover=function(e){this.isHovering=e,1===this.services.viewModeState.getMode()&&t.util.CanvasVisualsUtility.setHoverForParentGroup(this.viewModel,this.isHovering,this.services.eventBridge)},i.prototype.setHeaderHover=function(e,t){if(this.viewModel.contract.name===t.containerName){this.isHovering=e;var i=this.$element;N.setHoverClass(e,i.find(".visualContainer"))}},i.prototype.onDoubleClick=function(){this.services.viewModeState.getConfig().visualDoubleClickEnabled&&!this.services.visibility.get()&&this.popOutVisualContainer()},i.prototype.onRightClick=function(e){var i=N.getVisualType(this.viewModel.contract),r=this.services.visualPluginOps.isQueryVisual(i)&&!this.services.visualPlugin.isCustomVisual(i);!t.util.EventBubblingUtility.handled(e)&&r&&this.onContextMenu({data:void 0,position:{x:e.pageX,y:e.pageY}},r)},i.prototype.onKeydown=function(t){if(e.events.isKeyboardEventIncomplete(t))return void t.stopImmediatePropagation();if(13===t.keyCode||32===t.keyCode){var i=this.getVisualLink();if(i&&i.show){var r={visualObjects:[{objectName:"",selectorsByColumn:{}}],isCtrlOrMetaKey:a.isCtrlOrMeta(t),position:{x:t.clientX,y:t.clientY}};this.onSelecting(r),1===r.action&&t.stopPropagation()}}},i.prototype.updateVisualLinkProperties=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n,a;return __generator(this,(function(s){switch(s.label){case 0:return e=this.services.viewModeState.getMode(),t=this.getVisualLink(),i=t&&t.show,r=null,i?(o=L.getType(t),o!==L.Drillthrough?[3,2]:[4,this.getDrillthroughActionTooltip(t,e)]):[3,3];case 1:return r=s.sent(),[3,3];case 2:t.tooltip?r=t.tooltip:(n=1===e?"Visual_VisualLink_Click_EditTooltip":"Visual_VisualLink_Click_ViewTooltip",a=void 0,a=o===L.Back?this.services.localizationService.get("Visual_VisualLink_Back_Tooltip"):this.services.localizationService.get("Visual_VisualLink_Bookmark_Tooltip"),r=this.services.localizationService.format(n,[a])),s.label=3;case 3:return this.visualLinkProperties={hasVisualLink:i,title:r},[2]}}))}))},i.prototype.getDrillthroughActionTooltip=function(i,r){return __awaiter(this,void 0,e.Promise,(function(){var e,o,n,a,s,l,c,u,p,s,d,h,s,v,g=this;return __generator(this,(function(f){switch(f.label){case 0:return e=this.services.explorationNavigation.getAllSections(),(o=_.find(e,(function(e){return e.name===i.drillthroughSection})))?(n=o.displayName,[4,this.isVisualEnabled()]):[3,7];case 1:return a=f.sent(),a?i.enabledTooltip?[2,i.enabledTooltip]:(s=1===r?"Visual_VisualLink_Drillthrough_Enabled_EditTooltip":"Visual_VisualLink_Drillthrough_Enabled_ViewTooltip",[2,this.services.localizationService.format(s,[n])]):[3,2];case 2:return i.disabledTooltip?[2,i.disabledTooltip]:[3,3];case 3:return[4,this.services.lazyScoped("drillthrough")];case 4:return l=f.sent(),c=l.getDrillthroughParameters(o.name),u=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(u)];case 5:return p=f.sent(),s="Visual_VisualLink_Drillthrough_Disabled_Tooltip",d=_.map(c,(function(e){return g.services.displayNameService.getDisplayName(e.fieldExpr,p,void 0)})),h=t.services.concatStrings(d,"Generic_Or",{aggregateDisplayNames:void 0,qualifiedDisplayNameTemplate:void 0,showValueAsDisplayNames:void 0,stringResourceProvider:this.services.localizationService}),[2,this.services.localizationService.format(s,[n,h])];case 6:return[3,8];case 7:return s=1===r?"Visual_VisualLink_Click_EditTooltip":"Visual_VisualLink_Click_ViewTooltip",v=this.services.localizationService.get("Visual_VisualLink_Bookmark_Tooltip"),[2,this.services.localizationService.format(s,[v])];case 8:return[2]}}))}))},i.prototype.getVisualLink=function(){var e=this.getVisualCapabilities();if(e&&e.supportsVisualLink){var t=this.viewModel.objects;return t&&t.visualLink}},i.prototype.onShowHeaderTooltip=function(e,t){this.visualHostTooltip.show(e,t,!0)},i.prototype.onHideHeaderTooltip=function(e){this.visualHostTooltip.hide(e)},i.prototype.getVisualCapabilities=function(){return this.services.visualPlugin.capabilities(this.viewModel.getVisualType())},i.prototype.canSpotlight=function(){return!this.viewModel.isPoppedOut&&!this.services.viewModeState.getConfig().displayOptions.disableSpotlight},i.prototype.onTouchend=function(e){this.visualHostTooltip.visible()&&this.services.viewModeState.getConfig().touchOptions.disableTouchendOnTooltip&&e.preventDefault()},i.prototype.getTouchActionState=function(){var e=this.visualHostTooltip.visible();return this.visualHostTooltip.isTouchScreenOptimizedEnabled&&this.visualHostTooltip.isTouchScreenOptimizedEnabled()&&e?"none":"pan-y pan-x"},i.prototype.getContextMenuHandlers=function(){var e=this;return{onSetNodeExpansionState:function(t){return e.setNodeExpansionState(t)},onSetLevelExpansionState:function(t){return e.setLevelExpansionState(t)},onSetHierarchyExpansionState:function(t){return e.setHierarchyExpansionState(t)}}},i.prototype.onContextMenu=function(e,i){if(void 0===i&&(i=!0),this.viewModel.options.showContextMenu){if(1===this.services.viewModeState.getMode()&&!this.isSelected()){var r=t.util.CanvasVisualsUtility.getContainerToSelect(this.viewModel,!0);if(r!==this.viewModel&&t.viewModels.isVisualContainerGroup(r))return void t.util.CanvasVisualsUtility.showContextMenuForGroup(r,e.position,this.services.selection,this.services.visualContainerMenuFactory)}this.contextMenuArgs=e,this.isSelected()||this.selectVisualContainer();var o=this.viewModel.getRunningVisual(),n=o&&_.first(o.getDataViews());this.services.visualContainerMenuFactory.createMenu(this.viewModel.contract,this.contextMenuArgs,this.queryHandler,this.getContextMenuHandlers(),i,this.visualContainerDataSelectionService,n)}},i.prototype.ensureFocus=function(e){m.isFocusInTree($(e.currentTarget))&&t.util.EventBubblingUtility.markAsHandled(e)},i.prototype.setViewModelServices=function(){var t=this;this.viewModel.setServices({getLocalizedString:function(e){for(var i,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return(i=t.services.localizationService).format.apply(i,[e].concat(r))},requestFocus:function(e){return jsCommon.FocusManager.focus(e)},canSelect:function(e){return t.canSelect(e)},onDragStart:function(e){return t.onDragStart(e)},onContextMenu:function(e){return t.onContextMenu(e)},onSelecting:function(e){return t.onSelecting(e)},onSelect:function(e){return t.onSelect(e)},onSwitchFocusModeState:function(e){return t.onSwitchFocusModeState(e)},canExpandCollapse:function(e){return t.canExpandCollapse(e)},setNodeExpansionState:function(e){return t.setNodeExpansionState(e)},getVisualLinkProperties:function(){return t.visualLinkProperties},persistProperties:function(e,i){return t.persistProperties(e,i)},shouldRetainSelection:function(){return t.shouldRetainSelection()},loadMoreData:function(){return t.loadMoreData()},setShouldDeferData:function(e){return t.setShouldDeferData(e)},onCustomSort:function(e){return t.onCustomSort(e.sortDescriptors)},getViewMode:function(){return t.services.viewModeState.getMode()},getEditMode:function(){return t.viewModel.editMode},setWarnings:function(e){return t.setClientWarnings(e)},setToolbar:function(e,i){return t.setToolbar(e&&{element:e,removeOnBlur:_.noopFalse,preferHorizontalLayout:i&&i.preferHorizontalLayout,theme:i&&i.theme})},geocoder:function(){return t.getGeocoderForVisual()},geolocation:function(){return e.visuals.services.createGeolocation()},locale:function(){return e.common.unmappedCultureInfo},promiseFactory:function(){return t.services.promiseFactory},setIdentityDisplayNames:function(e){return _.noop},getIdentityDisplayNames:function(e){},setFilterExpressionMetadata:function(e){return t.setFilterExpressionMetadata(e)},getFilterExpressionMetadata:function(){return t.getFilterExpressionMetadata()},visualCapabilitiesChanged:function(){return t.visualCapabilitiesChanged()},ignoreDefaultFilter:function(){return!1},dropdown:function(){return t.visualHostDropdown},tooltips:function(){return t.visualHostTooltip},telemetry:function(){return t.visualHostTelemetryService},loader:function(){return t.services.moduleLoader},getUIComponentFactory:function(){return t.services.uiComponent.getUIComponentFactory(t.$scope)},applyJsonFilter:function(e,i,r,o){return t.applyJsonFilter(e,i,r,o)},instanceId:this.instanceId,refreshHostData:function(){return t.refreshHostData()},authenticationService:function(){return t.visualHostAuthenticationService},localStorageService:function(){return t.visualHostLocalStorageService},decompositionService:function(){return t.visualHostDecompositionService},getJSONFilter:function(i){return __awaiter(t,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.getJSONFilter(i)];case 1:return[2,e.sent()]}}))}))},onHyperlinkClick:function(e,i){return t.onHyperlinkClick(e,i)},visualTimeSynchronization:function(){return t.services.visualTimeSynchronizationService},isVisualEnabled:function(){return t.isVisualEnabled()},dataMultiSelectMode:function(){return t.getDataMultiSelectMode()}},this.services.visualPlugin,this.services.visualPluginOps,this.services.viewModeState,this.services.formFactor,this.services.visibility,this.services.runningVisuals,this.services.featureSwitchService,this.services.visualAuthoring,this.services.filterGenerator,this.services.themeService,this.services.ngZone,this.services.explorationCapabilities,{getNextDataSegment:function(){return t.getNextDataSegment()},startProgressBar:function(){return t.startProgressBar()},stopProgressBar:function(){return t.stopProgressBar()}})},i.prototype.getFilterExpressionMetadata=function(){var e=this.viewModel.contract.config.singleVisual;if(e.cachedFilterDisplayItems&&_.isEmpty(e.filterExpressionMetadata)){var t=e.query.defn.select();if(!_.isEmpty(t)&&1===t.length){var i=t[0].expr;return y.convertCacheToFilterExpressionMetadata(i,e.cachedFilterDisplayItems)}}return e.filterExpressionMetadata},i.prototype.setFilterExpressionMetadata=function(e){var t,i=this.viewModel.contract.config.singleVisual;if(e&&!_.isEmpty(e.cachedValueItems)&&!_.isEmpty(e.expressions))for(var r=0,o=e.cachedValueItems;r<o.length;r++){var n=o[r],a={data:n.identities};if(y.hasGroupOnKeys([a],i)){t=e;break}}var s=y.tryGetDisplayNameIdentityPairs(t);return s?(i.cachedFilterDisplayItems=s,void(i.filterExpressionMetadata=void 0)):(i.filterExpressionMetadata=t,void(i.cachedFilterDisplayItems=void 0))},i.prototype.getGeocoderForVisual=function(){return this.geocodingTracker.wrapGeocoder(this.services.geocoder)},i.prototype.visualCapabilitiesChanged=function(){this.convertTo(this.viewModel.getVisualType()),this.raiseVisualContainerChanged((function(){return function(){return!0}}))},i.prototype.createCanvasLayoutItemOptions=function(){var i=this,r=function(){i.hideOverlays(),i.isSelected()||i.selectVisualContainer()},n=function(e){1===i.services.selection.getSelectedElements().length&&i.updateDimensions(e)},a=function(e){if(i.isEditable()&&!i.viewModel.isPoppedOut&&1===i.services.selection.getSelectedElements().length){var t=new o(i.viewModel.name,"nudge");i.updateDimensions(e,t),i.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1})}},s=function(){i.hideOverlays(),i.isSelected()||i.selectVisualContainer(),i.services.eventBridge.publishToChannel(l.visualContainerResizeStart)},c=function(e){return i.updateVisualViewport(e)},u=function(e){i.updateDimensions(e),i.services.eventBridge.publishToChannel(l.visualContainerResizeEnd)},p=function(){return i.isExplorationUnloaded},d=function(){var e={top:0,left:0,bottom:1,right:1};if(E.hasMultipleVisualContainerSelection(i.services.selection)){var t=E.getSelectedCanvasItems(i.services.selection);e=C(i.viewModel.contract,i.services.formFactor.getCurrentLayout(),t)||e}return e},h=function(){return i.getPosition(i.viewModel.contract)},v=function(){return i.viewModel.uiScale},g=function(){var r=new e.visuals.Rect;return t.util.CanvasVisualsUtility.addOffsetFromGroup(r,i.viewModel)};this.canvasLayoutItem={dragEnd:n,dragStart:r,nudge:a,resizeStart:s,resizeMove:c,resizeEnd:u,isSuspended:p,getPosition:h,getScale:v,getOffsetFromGroup:g};var f=this.canvasLayout.registerLayoutItem(this.canvasLayoutItem),y=this.services.formFactor.getCurrentLayoutCapabilities();this.transformOptions=__assign({},f,{restriction:I.Custom,resizeHandleDirections:e.common.controllers.TransformHandleDirections.All,getDragRestriction:d,aspectRatioOffset:t.viewModels.VisualContainer.getVisualBodyOffset(y,this.services.explorationCapabilities),preventDefault:"never",getCustomRestrictionSelector:function(){return i.transformParent||"div"},restrictDraw:this.shouldRestrictTransformDraw(),autoScrollParent:this.$element.closest(".displayArea"),transformId:this.viewModel.contract&&this.viewModel.contract.name})},i.prototype.onSwitchFocusModeState=function(e){var t=this.viewModel;e&&1!==t.contract.visibility&&this.popOutVisualContainer(),e||1!==t.contract.visibility||this.closePopOut()},i.prototype.subscribeToEvents=function(){var i=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.events.visualThemeChanged,(function(){return i.onVisualThemeChanged()})).subscribe(f.selectionChanged,(function(){return i.updateSelection()})).subscribe(f.explorationSlowDataSourceSettingsLoaded,(function(e,t){var r=t.isSlicerSelectionsButtonEnabledChanged&&i.isFilterVisual();r&&i.applyBufferedPropertyChanges(),(t.isCrossHighlightingDisabledChanged||r)&&i.onVisualContainerChangedAsync(!1,!0)})).subscribe(f.visualContainerChanged,(function(e,t){t&&t.affectContainer(i.viewModel.contract)&&i.onVisualContainerChangedAsync(!1,t.allowCache,t.cacheResponseOnServer,t.sourceLabelKey)})).subscribe(f.filterContainerChanged,(function(e,t){i.onFilterContainerChanged(t)})).subscribe(f.dataSelectionChanged,(function(e,t){t&&t.affectContainer(i.viewModel.contract)&&i.clearDataSelection()})).subscribe(f.explorationUnloaded,(function(e,t){i.scopeEventManager.unsubscribeAll(),i.isExplorationUnloaded=!0})).subscribe(f.changeViewMode,(function(e,t){return i.onChangeViewMode(t.targetViewMode)})).subscribe(f.visibilityChanged,(function(){var e=i.viewModel.getRunningVisual();e&&e.setIsInFocus(i.viewModel.isPoppedOut),i.updateMenuButtonsState();var t=i.services.visibility.isSeeDataMode(i.viewModel.contract.visibility);i.detailVisualProgressBarCount&&!t&&i.clearDetailVisualProgressBar(),i.viewModel.updateViewState(),N.isScriptVisual(i.viewModel.contract,i.services.visualPlugin)&&i.applyUpdate(),!i.services.explorationNavigation.getCurrentSection().poppedOutElement&&i.isSelected()&&i.focus()})).subscribe(l.canvasItemContainerShowHover,(function(e,t){return i.setHeaderHover(!0,t)})).subscribe(l.canvasItemContainerHideHover,(function(e,t){return i.setHeaderHover(!1,t)})).subscribe(f.dataRefreshTriggered,(function(){return i.onDataRefreshTriggered()})).subscribe(f.explorationContainerReady,(function(){return i.applyUpdate({initialLoad:!0})})).subscribe(f.editModeChanged,(function(e,t){return i.onChangeEditMode(t)})).subscribe(f.toggleSortVisualContainer,(function(e,t){return i.onToggleSort(t)})).subscribe(f.getClusters,(function(e,t){return i.onGetClusters(t)})).subscribe(f.drillthroughActionTriggered,(function(e,t){return i.onDrillthroughActionTriggered(t)})),this.subscribeToBubbling(t.viewModels.DetailVisualEvents.spinnerAction,(function(e,t){if(e.stopPropagation&&e.stopPropagation(),i.services.visibility.isSeeDataMode(i.viewModel.contract.visibility))switch(t){case 0:i.startDetailVisualProgressBar();break;case 1:i.stopDetailVisualProgressBar()}}));var r=this.viewModel.contract.config.singleVisual.visualType;!r||this.services.trustedVisual.canLoadVisual(r)&&this.services.visualPlugin.getPlugin(r)||(this.reloadEmptyVisualSubscriptionManager=this.services.globalEventBridge.createChannelSubscriptionManager().subscribe(e.events.reloadEmptyVisuals,(function(e,t){_.includes(t.visualTypes,r)&&(i.reloadEmptyVisualSubscriptionManager.unsubscribeAll(),i.onVisualContainerChangedAsync())})))},i.prototype.updateContract=function(t){var i=this,r=this.viewModel,o=r.contract.config.singleVisual;"update"===t?(o.getCurrentVisual=function(){return r.getRunningVisual().getAdapter()},o.getCurrentDataViews=function(){return r.getRunningVisual().getDataViews()},o.getErrorDetails=function(){return i.getErrorDetails()},o.getEvaluatedObject=function(e){return r.objects&&r.objects[e]},o.getWarnings=function(){return i.getWarnings()},o.getSelectedDataPoints=function(){return i.getSelectedDataPoints()},o.clearSelectedDataPoints=function(){if(i.selectedDatapoints=void 0,o.getCurrentVisual){var e=o.getCurrentVisual();e&&e.onClearSelection&&e.onClearSelection()}},o.setSelectedDataPoints=function(t){if(o.getCurrentVisual){var n=r.getRunningVisual(),a=o.getCurrentVisual();a&&a.visualHasMethod&&a.visualHasMethod("onRestoreSelection")?n?a.onRestoreSelection({selection:t}):o.pendingSelection=t:i.setClientWarnings([new e.visuals.OnRestoreSelectionNotSupportedWarning]),i.selectedDatapoints=t}},o.customizeConvertFrom=_.noop):"destroy"===t&&(o.getCurrentVisual=void 0,o.getCurrentDataViews=void 0,o.getErrorDetails=void 0,o.getEvaluatedObject=void 0,o.getWarnings=void 0,o.getSelectedDataPoints=void 0,o.clearSelectedDataPoints=void 0,o.setSelectedDataPoints=void 0,o.customizeConvertFrom=void 0)},i.prototype.onFilterContainerChanged=function(e){var t=this.viewModel.contract;if(0!==e.scope.scopeType||e.scope.container===t){var i=!1;switch(e.changeType){case 1:case 0:null!=e.filter&&null!=e.filter.filter&&(i=!0);break;case 10:case 2:i=!0}if(i&&(this.applyUpdate(),0===e.scope.scopeType)){var r=this.services.explorationNavigation.getCurrentSection(),o=this.services.explorationNavigation.getCurrentExploration();this.services.filterGenerator.updateCrossHighlightCollectedFilters(r,o,t),this.services.visualSync.syncVisualFiltersState(t)}}},i.prototype.drop=function(e,t){var i=this.services.dragDataService.getDragContext();if(i&&i.field&&v.isDropOnExpectedTarget(t.draggable,this.viewModel.contract)){E.selectCanvasItem(this.viewModel.contract,this.services.selection);var r=this.services.visualAuthoring.addFieldToVisual(i.field,this.services.dataSources.get(),this.viewModel.contract,"DraggedToVisual");r&&r.catch((function(e){}))}},i.prototype.hasPositionOverride=function(){return null!=this.viewModel.overridePosition},i.prototype.setClientWarnings=function(e){if(_.isEmpty(e))return void(this.warnings=null);if(_.isArray(e)){var t=_.filter(e,(function(e){return!(e instanceof c)}));if(_.isEmpty(t)){this.dataBoundObjectWarnings||(this.dataBoundObjectWarnings={});for(var i=_.filter(e,(function(e){return e instanceof c})),r=0,o=i;r<o.length;r++){var n=o[r],a=n.propertyId.objectName;if(!this.objectIsHidden(a)){var s={selector:n.selector,warnings:[n]},l=this.dataBoundObjectWarnings[a];l?l.push(s):this.dataBoundObjectWarnings[a]=[s]}}}else this.warnings={warnings:t}}else this.warnings=e;if(this.warnings&&!_.isEmpty(this.warnings.warnings)){var u=this.warnings.warnings[0].getMessages(this.services.localizationService),p={message:u.message,displayableErrorInfo:[{errorInfoKey:u.title,errorInfoValue:u.detail}]};this.errorManager.showInfoIcon(p,this.warnings.warnings[0].code)}else this.showDataBoundExprWarning()},i.prototype.setToolbar=function(e){this.toolbarManager.setToolbar(e),this.viewModel.contract.toolbar=e},i.prototype.hideOverlays=function(){this.services.overlayService.hideAllDropdowns(),this.toolbarManager.setVisible(!1)},i.prototype.onVisualThemeChanged=function(){this.resetVisualStyle(),this.onVisualContainerChangedAsync(!1,!0)},i.prototype.shouldRunQueries=function(){return!O.isHidden(this.viewModel.contract.config.singleVisual)},i.prototype.onVisualContainerChangedAsync=function(e,t,i,r){var o=this;if(!this.destroyed&&this.shouldRunQueries()){this.startProgressBar(),this.services.eventBridge.publishToChannel(f.visualContainerDataRenderingStarted,this.viewModel.contract);var n=N.getVisualType(this.viewModel.contract);return k.ensurePlugin(n,this.services.visualPlugin,this.services.moduleLoader,this.services.promiseFactory,void 0!==this.viewModel.currentZone).then((function(n){return __awaiter(o,void 0,w,(function(){var o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:return this.destroyed?[2]:(o=this.viewModel,n=o.contract.config.singleVisual,this.updateContract("update"),[4,this.updateVisualContainerProperties()]);case 1:return l.sent(),this.destroyed?[2]:(this.setToolbar(o.contract.toolbar),a=o.dataViewSource,s=this.viewModel.getRunningVisual(),n.pendingSelection&&(s.setPendingSelection(n.pendingSelection),n.pendingSelection=void 0),a?(this.startPerformanceActivity(),this.queryHandler.visualizeDataViewSource(o.contract,a,s.getViewport(),this.visualContainerPerformanceActivity),o.dataViewSource=null,this.evaluateObjectDefinitions(),this.endPerformanceActivity()):this.services.visualQueryGenerator.shouldExecute(n,this.services.dataSources.get())?this.viewModel.errorInfo||this.applyUpdate({initialLoad:e,preferCurrentData:!1,allowCache:t,cacheResponseOnServer:i,sourceLabel:r}):(this.startPerformanceActivity(),this.resetWarnings(),this.queryHandler.updateNonQueryVisual(o.contract,{objects:n.objects},this.visualContainerPerformanceActivity),this.evaluateObjectDefinitions(),this.endPerformanceActivity()),this.updateVisualContainerThemeableProperties(),[2])}}))}))})).finally((function(){o.destroyed||o.stopProgressBar()}))}},i.prototype.onVisualContainerRefresh=function(){this.applyUpdate({refreshVisual:!0}),this.services.telemetryService.logEvent(e.telemetry.EXRefreshSingleVisual,this.viewModel.id,this.viewModel.contract.name)},i.prototype.onPositionChanged=function(){this.toolbarManager&&this.toolbarManager.containerPositioned.resolve()},i.prototype.updateVisualContainerProperties=function(){return __awaiter(this,void 0,w,(function(){var e,t,i,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this.services.dataSources.get(),e?[4,this.services.conceptualSchemaProxy.get(e)]:[3,2];case 1:t=a.sent(),a.label=2;case 2:return this.errorManager.clearError(),i=this.services.explorationNavigation.getCurrentExploration(),r=i&&i.reportId,[4,this.services.visualValidator.validate(this.viewModel.contract,t,r)];case 3:return o=a.sent(),o&&(this.errorManager.showErrorOverlay(o.details,o.code),this.updateDisablePin()),this.updateDetailVisualVisibility(),n=this.getVisualCapabilities(),n&&n.sorting&&n.sorting.custom?[4,this.updateSortSettings()]:[3,5];case 4:a.sent(),a.label=5;case 5:return this.updateMenuButtonsState(),[2]}}))}))},i.prototype.updateVisualContainerThemeableProperties=function(){this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.updateVisualLinkProperties(),this.resetPadding(),this.viewModel.errorInfo||this.viewModel.updateViewState()},i.prototype.updateDataBoundProperties=function(){if(this.viewModel.contract.config.singleVisual.vcObjects){var t=this.viewModel.contract.config.singleVisual.query,i=this.viewModel.contract.config.singleVisual.vcObjects,r=!1,o=!1,n=!1,a=!1,s=!1;for(var l in i){var c=i[l];if(!_.isEmpty(c))for(var u=0,p=c;u<p.length;u++){var d=p[u],h=d.properties;for(var v in h){var g=h[v],f=e.data.DataBoundExprExtractor.getDataBoundExprs(g,void 0,t?t.defn.select():jsCommon.ArrayExtensions.createWithName());_.isEmpty(f)||(a=!0,"title"===l?r=!0:"background"===l?n=!0:"border"===l?o=!0:"visualLink"===l&&(s=!0))}}}r&&this.resetTitle(),o&&this.resetBorder(),n&&this.resetBackground(),s&&this.updateVisualLinkProperties(),a&&this.viewModel.updateViewState()}},i.prototype.getErrorDetails=function(){if(this.viewModel.errorInfo)return this.viewModel.errorInfo.details},i.prototype.getWarnings=function(){var e;if(e=this.warnings?_.cloneDeep(this.warnings):{},!_.isEmpty(this.dataBoundObjectWarnings)){e.visualObjectWarnings||(e.visualObjectWarnings={});for(var t in this.dataBoundObjectWarnings){var i=e.visualObjectWarnings[t];i?i.push.apply(i,this.dataBoundObjectWarnings[t]):e.visualObjectWarnings[t]=this.dataBoundObjectWarnings[t]}}return e},i.prototype.getSelectedDataPoints=function(){return this.selectedDatapoints},i.prototype.updateMenuButtonsState=function(){var e=this.viewModel,t=this.services.viewModeState.getMode(),i=this.menuOptions;i.canAddComment=this.canAddComment(t),i.canExport=this.canExport(),i.exportDataDenied=!!this.viewModel.options.exportDataDenied,i.canDelete=1===t&&this.services.viewModeState.getConfig().supportsDeletion;var r=i.sortSetting;i.canSort=r.defaultSortBehavior&&!_.isEmpty(r.sortableFields),i.canEdit=this.canEdit(),i.canSpotlight=this.canSpotlight(),i.canSeeData=this.services.drill.canSeeData(this.viewModel.contract)&&!this.services.visibility.isSeeDataMode(this.viewModel.contract.visibility);var o=[],n=this.canSearch().then((function(e){i.canSearch=e}));o.push(n),o.push(this.canCluster().then((function(e){i.canCluster=e.canCluster,i.canSpatialCluster=e.canSpatialCluster}))),this.services.promiseFactory.all(o).then((function(){i.hasMoreOptions=e.options.showMenu&&(i.canExport||i.canDelete||i.canSort||i.canSearch||i.canCluster||i.canSeeData||i.canSpotlight)}))},i.prototype.canEdit=function(){var e=N.getVisualType(this.viewModel.contract),t=this.services.viewModeState.getMode(),i=this.viewModel.editMode,r=this.services.formFactor.getCurrentLayout(),o=0===r&&!this.viewModel.errorInfo&&this.canPopOut();return 1===t&&1!==i&&this.services.visualPluginOps.canEdit(e,o)},i.prototype.canCluster=function(){var t=this,i={canCluster:!1,canSpatialCluster:!1},r=this.viewModel.contract.config.singleVisual,o=this.services.visualPlugin.capabilities(r.visualType);if(!o||!o.grouping||!o.grouping.cluster)return this.services.promiseFactory.resolve(i);var n=o.grouping.cluster,a=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(a).then((function(o){var a=r.query;if(!a||!a.defn||_.some(a.defn.select(),(function(e){return!T.isExprValidForClustering(e.expr)}))||N.hasGroupByItems(a))return i;var s=_.chain(a.defn.select()).map((function(e){return e.expr.getTargetEntity()})).uniq(),l=s.map((function(e){return e.schema})).uniq().value(),c=s.map((function(e){return o.schema(e.schema).entities.withName(e.entity)})).value(),u=_.every(c,(function(e){return e&&e.capabilities&&e.capabilities.supportsClustering}));if(1!==_.size(l)||!u)return i;for(var p=a.projections,d=N.createRoleKindByQueryRef(r.query),h=0,v=n.conditions;h<v.length;h++){var g=v[h],f=e.DataViewAnalysis.checkForConditionErrors(p,g,d,!1);if(_.isEmpty(f))return i.canCluster=1===t.services.viewModeState.getMode(),i.canSpatialCluster=i.canCluster&&t.services.featureSwitchService.featureSwitches.spatialClusteringEnabled,i}return i}))},i.prototype.updateVisualViewport=function(e){var t={width:e.width,height:e.height};this.viewModel.updateVisualViewportForUserResize(t),this.toolbarManager.setVisible(!1)},i.prototype.updateDimensions=function(e,t){var i=this;this.services.undoRedo.register("VisualContainerUpdateDimensions",(function(){var t=i.viewModel,r={x:e.x,y:e.y,z:t.position.z,width:e.width,height:e.height,angle:e.angle,tabOrder:t.position.tabOrder};i.services.layoutAuthoring.moveCanvasItem(i.viewModel,r)}),t),this.toolbarManager.setVisible(!0)},i.prototype.convertTo=function(e){var i=this;this.services.eventBridge.publishToChannel(f.visualConversion,{visualContainer:this.viewModel.contract,newVisualType:e,actionAfterConversion:function(){t.util.VisualContainerUtils.notifyVisualContainersExceptSource(i.services.eventBridge,i.viewModel.contract,"UserAction_EditVisual"),i.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1})}})},i.prototype.getPosition=function(e){var t=e.layouts.withId(this.services.formFactor.getCurrentLayout());return t&&t.position},i.prototype.selectVisualContainer=function(e){E.selectCanvasItem(this.viewModel.contract,this.services.selection,e)},i.prototype.isSelected=function(){return E.isCanvasItemSelected(this.viewModel.contract,this.services.selection)},i.prototype.updateSelection=function(){var e=this.isSelected(),t=this.viewModel;if(t.setSelected(e),!e){var i=t.contract;i&&i.toolbar&&i.toolbar.removeOnBlur()&&this.setToolbar(void 0)}this.isDraggable=!this.viewModel.parentGroup||e,this.toolbarManager.setSelected(e),this.$scope.$emit(s.VisualSelectionOrPositionChangedEventName)},i.prototype.preventInnerScroll=function(){return!this.isSelected()&&this.services.viewModeState.getConfig().touchOptions.touchEventsOnSelectedVisualOnly},i.prototype.clearDataSelection=function(){this.viewModel.contract.config.singleVisual.clearSelectedDataPoints()},i.prototype.onChangeViewMode=function(e){this.updateMenuButtonsState();var t=1===e;this.toolbarManager.setVisible(t),0===e&&this.viewModel.setEditMode(0);var i=this.viewModel.getRunningVisual(),r=i.getAdapter();r&&(this.updateVisualLinkProperties(),r.onViewModeChanged&&r.onViewModeChanged(e))},i.prototype.onChangeEditMode=function(t){var i=this.viewModel;if(f.affectsVisualContainer(t,i.contract)){i.setEditMode(t.editMode),this.updateMenuButtonsState();var r=i.getVisualType(),o=this.services.visualPlugin.capabilities(r);o&&2===o.advancedEditModeSupport?this.services.visibility.set(i.contract,1):r===e.visualHost.EsriVisual&&(this.services.viewModeState.setMode(2),this.services.viewModeState.updateConfig((function(e){e.alwaysPopulatePanes||(e.alwaysPopulatePanes=!0)})),this.services.visibility.set(i.contract,1))}},i.prototype.onToggleSort=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r;return __generator(this,(function(o){switch(o.label){case 0:return e=this.viewModel,f.affectsVisualContainer(t,e.contract)?(i=this.services.dataSources.get(),
[4,this.services.conceptualSchemaProxy.get(i)]):[2];case 1:return r=o.sent(),this.sortHelper.toggleSort(t.sortableField,t.sortDirection,r,t.sortOnDemand),this.announceSortDirection(t.sortableField.displayName,t.sortDirection),[2]}}))}))},i.prototype.onGetClusters=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return e=this.viewModel,f.affectsVisualContainer(t,e.contract)?[4,this.services.lazyScoped("clustering")]:[2];case 1:return i=r.sent(),i.createClusters(this.viewModel,this.services.dataSources.get(),t.useSpatialClustering),[2]}}))}))},i.prototype.onDrillthroughActionTriggered=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return f.affectsVisualContainer(t,this.viewModel.contract)?(e=this.services.explorationNavigation.getCurrentSection(),[4,this.services.lazyScoped("drillthrough")]):[2];case 1:return i=a.sent(),r=t.targetSectionName,[4,this.queryHandler.getCachedQueryOrGenerate({contract:this.viewModel.contract})];case 2:return o=a.sent(),[4,i.getForcedMatchSectionInfo(0,r,e.name,this.viewModel.contract,this.selectedDatapoints,o.filterContext)];case 3:return n=a.sent(),!n||_.isEmpty(n.matchedLinkFields)?[2]:(i.applyDrillthroughState({targetSectionName:n.sectionName,targetReportGuid:n.reportObjectId,sectionDisplayName:n.sectionDisplayName,reportDisplayName:n.reportDisplayName,getFilterContext:n.getFilterContext,applyState:n.applyState}),[2])}}))}))},i.prototype.popOutVisualContainer=function(){var e=this.viewModel;this.services.visibility.set(e.contract,1)},i.prototype.canPopOut=function(){return this.services.visualPluginOps.supportsFocusMode(N.getVisualType(this.viewModel.contract))},i.prototype.updateSortSettings=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n,a,s,l,c,u,p,d;return __generator(this,(function(h){switch(h.label){case 0:return e=this.services.dataSources.get(),e?[4,this.services.conceptualSchemaProxy.get(e)]:[3,5];case 1:return t=h.sent(),[4,k.ensurePlugin(this.viewModel.contract.config.singleVisual.visualType,this.services.visualPlugin,this.services.moduleLoader,this.services.promiseFactory)];case 2:return h.sent(),i=this.viewModel.contract,r=i.config.singleVisual,o=r?this.services.visualPlugin.capabilities(r.visualType):void 0,n=r&&r.query,a=[],n&&o?[4,this.queryHandler.getCachedQueryOrGenerate({contract:i})]:[3,4];case 3:s=h.sent();try{a=this.services.sort.getSortableFields({query:n,schema:t,visualType:r.visualType,columnProperties:r.columnProperties,compiledMappings:void 0===s?[]:s.compiledMappings})}catch(e){return[2]}if(!_.isEmpty(a))for(l=0,c=a;l<c.length;l++)u=c[l],u.active=u.active&&0===u.orderByIndex;h.label=4;case 4:p=!!o&&!!o.sorting&&!!o.sorting.default,this.sortHelper.resetSortSettings(a,p),d=_.findIndex(this.menuOptions.sortSetting.sortableFields,(function(e){return e.active})),d>=0&&(this.viewModel.readOnlyState.actualSortDirection=this.menuOptions.sortSetting.sortableFields[d].sortDirection),h.label=5;case 5:return[2]}}))}))},i.prototype.resetVisualStyle=function(){var e=this.services.explorationNavigation.getCurrentExploration();e&&this.viewModel.setThemeCollection(e.themeCollection)},i.prototype.resetPadding=function(){var e=this.viewModel.contract.config.singleVisual,t=this.services.visualPlugin.capabilities(e.visualType);this.viewModel.isPaddingDisabled=t&&t.suppressDefaultPadding},i.prototype.resetBackground=function(){var e=this.viewModel,t=e.objects&&e.objects.background;t&&t.show?e.visualBackground={colorRGB:N.getVisualBackgroundColor(t)}:e.visualBackground=null},i.prototype.resetAspectRatio=function(){var e=this.viewModel,t=e.objects&&e.objects.lockAspect;e.lockAspectRatio=!(!t||!t.show)},i.prototype.resetBorder=function(){var i=this.viewModel,r=i.objects&&i.objects.border,o=e.visuals.VisualBorderUtil.getDefaultValues(),n=N.getVisualBorder(r,o);i.visualBorder=n.show?new t.viewModels.VisualBorder(n):null},i.prototype.resetTitle=function(){var e=this,t=this.viewModel,i=t.contract.config.singleVisual,r=this.services.visualPlugin.capabilities(i.visualType),o=this.services.dataSources.get();this.startProgressBar();var n=t.objects&&t.objects.title;r&&!R.isHidden(n,r.suppressDefaultTitle)&&o?this.services.conceptualSchemaProxy.get(o).then((function(o){e.services.displayNameService&&(n=e.services.displayNameService.getVisualTitle(n,i,o,r),t.setVisualTitle(n),t.updateViewState())})).finally((function(){e.stopProgressBar()})):(t.visualTitle=void 0,this.stopProgressBar())},i.prototype.hasMultipleScopeIds=function(e){if(!(e&&e.data&&e.data.length>0))return!1;if(e.data.length>1)return!0;if(!e.data[0])return!1;var t=e.data[0];return!!t.expr&&8===t.expr.kind},i.prototype.canSelect=function(i){var r,o=this,n=e.extensibility.legacy.isOldSelectEventArgs(i);if(r=n?e.extensibility.legacy.getSelectors(i):_.map(i.visualObjects,(function(e){return F.convertSelectorsByColumnToSelector(e.selectorsByColumn)})),r.length>1&&r.some((function(e){return o.hasMultipleScopeIds(e)}))){if(i.visualObjects){var a=this.viewModel.contract.config.singleVisual,s=_.map(i.visualObjects,(function(e){return e.selectorsByColumn})),l=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0);if(l&&l.supportsMultiTableTupleFilters)return!0;if(t.utils.GroupUtils.canGroup(s,a.query))return!0}return!1}return!0},i.prototype.canExpandCollapse=function(e){var t=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0);return this.services.expandCollapse.isSupported(t,this.viewModel.contract,e)},i.prototype.setNodeExpansionState=function(e){var t=this;this.raiseDrillUserAction(),e.isCollapse?this.services.undoRedo.register("CollapseNode",(function(){return t.services.expandCollapse.collapseNode(t.viewModel.contract,e.dataRoles,e.data)})):this.services.undoRedo.register("ExpandNode",(function(){return t.services.expandCollapse.expandNode(t.viewModel.contract,e.dataRoles,e.data)})),this.reloadDataSegment(e.nodeIndex),this.raiseDrillModeChanged(),this.raiseExpandCollapseAction()},i.prototype.setLevelExpansionState=function(e){var t=this;this.raiseDrillUserAction();var i=F.convertSelectorsByColumnToSelector(e.data).data;e.isCollapse?this.services.undoRedo.register("CollapseLevel",(function(){return t.services.expandCollapse.collapseLevel(t.viewModel.contract,e.dataRoles,i.length-1)})):this.services.undoRedo.register("ExpandLevel",(function(){return t.services.expandCollapse.expandLevel(t.viewModel.contract,e.dataRoles,i.length-1)})),this.onVisualContainerChangedAsync(!1),this.raiseDrillModeChanged(),this.raiseExpandCollapseAction()},i.prototype.setHierarchyExpansionState=function(e){var t=this;this.raiseDrillUserAction(),e.isCollapse?this.services.undoRedo.register("CollapseAll",(function(){return t.services.expandCollapse.collapseAll(t.viewModel.contract,e.dataRoles)})):this.services.undoRedo.register("ExpandAll",(function(){return t.services.expandCollapse.expandAll(t.viewModel.contract,e.dataRoles)})),this.onVisualContainerChangedAsync(!1),this.raiseDrillModeChanged(),this.raiseExpandCollapseAction()},i.prototype.raiseDrillUserAction=function(){this.services.eventBridge.publishToChannel(t.services.events.userActionTriggered,{source:"UserAction_Drill"})},i.prototype.raiseDrillModeChanged=function(){this.services.eventBridge.publishToChannel(f.drillModeChanged,{visualContainer:this.viewModel.contract})},i.prototype.raiseExpandCollapseAction=function(){this.services.eventBridge.publishToChannel(f.parentExpandCollapseAction,{visualContainer:this.viewModel.contract})},i.prototype.raiseVisualContainerChanged=function(e){this.services.eventBridge.publishToChannel(f.visualContainerChanged,{affectContainer:e(this.viewModel.contract)})},i.prototype.onDragStart=function(e){},i.prototype.shouldRetainSelection=function(){return this.isDrillEnabled()},i.prototype.isDrillEnabled=function(){var e=this.viewModel.contract,t=this.services.drill;if(e&&e.drillMode)return t.isDrillModeEnabled(e,1)||t.isDrillModeEnabled(e,2)||t.isDrillModeEnabled(e,3)},i.prototype.drill=function(e,t,i,r){var o=this.viewModel.contract,n=this.services.dataSources.get();switch(o.drillMode){case 1:this.services.visualAuthoring.drillDown(t,o,n,r);break;case 2:this.services.drillToDetails.drillToDetails(t,o,n);break;case 3:e||this.services.visualContainerMenuFactory.createDrillthroughMenu(o,t,i,this.queryHandler)}},i.prototype.executeVisualLink=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var r,o,n,a,s,l,c,u,d,h,v,g,y,m,C,S,w=this;return __generator(this,(function(b){switch(b.label){case 0:return this.raiseVisualLinkButtonClickedEvent(),r=L.getType(t),i&&r!==L.WebUrl?[2]:r!==L.Back?[3,1]:(this.services.explorationActivity.doActivity((function(){return w.services.explorationNavigation.back()}),(function(t){return w.services.telemetryService.startActivity(t,e.telemetry.EXNavigateBack)})),[3,10]);case 1:return r!==L.Bookmark?[3,3]:(o=t.bookmark,o?[4,this.services.lazyScoped("bookmark")]:[2]);case 2:return n=b.sent(),n.applyByName(o),[3,10];case 3:return r!==L.Qna?[3,5]:(a=this.services.explorationNavigation.getCurrentExploration(),s=this.services.explorationNavigation.getCurrentSection(),[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())]);case 4:return l=b.sent(),c=this.viewModel.contract,u=p.getObjectDefinition(c.config.singleVisual.vcObjects,"visualLink",void 0),d=this.services.filterGenerator.calculateVisualContainerFilter(a,s,c,l,!0),h=d&&d.dataFiltersUnmerged,this.services.eventBridge.publishToChannel(f.showQnaPopout,{visualLink:u,sourceFilters:_.map(h,(function(e){return e.filter}))}),[3,10];case 5:return r!==L.WebUrl?[3,6]:(v=t.webUrl,jsCommon.UrlUtils.isValidHttpUrl(v)&&(g=window.open(v,"_blank","noopener,noreferrer"),g&&g.focus()),[3,10]);case 6:return r!==L.PageNavigation?[3,7]:(y=this.services.explorationNavigation.getAllSections(),m=_.findIndex(y,(function(e){return e.name===t.navigationSection})),this.services.explorationNavigation.updateActiveSection({targetSectionIndex:m}),[3,10]);case 7:return r!==L.Drillthrough?[3,9]:(C=t.drillthroughSection,[4,this.getVisualContainerForDrillthrough(C)]);case 8:return(S=b.sent())?(this.services.eventBridge.publishToChannel(f.drillthroughActionTriggered,{targetSectionName:C,visualContainer:S}),[3,10]):[2];case 9:debug.assertNever(r),b.label=10;case 10:return[2]}}))}))},i.prototype.onSelecting=function(t){var i=this.getVisualLink();if(i&&i.show){var r=this.services.viewModeState.getMode(),o=this.services.explorationCapabilities.getCapabilities();return void((o.allowVisualLinks||o.allowWebUrlVisualLinks)&&(0===r||1===r&&t.isCtrlOrMetaKey)&&(t.action=1,this.executeVisualLink(i,!o.allowVisualLinks&&o.allowWebUrlVisualLinks)))}if(this.isDrillEnabled()){this.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1});var n=void 0,a=e.extensibility.legacy.isOldSelectEventArgs(t);if(n=a?e.extensibility.legacy.getSelectorsByColumn(t):_.map(t.visualObjects,(function(e){return e.selectorsByColumn})),!_.isEmpty(n)){var s=_.isEmpty(t.dataRoles)?void 0:_.head(t.dataRoles);return this.drill(a,n,t.position,s),void(t.action=1)}}t.action=0},i.prototype.onSelect=function(e){this.bufferOnSelect(e)||this.applySelect(e)},i.prototype.getHyperlinkClickBehavior=function(){var e=this.services.explorationCapabilities.getCapabilities().hyperlinkClickBehavior;return e?e:0},i.prototype.onHyperlinkClick=function(e,t){var i=this.getHyperlinkClickBehavior();switch(i){case 0:break;case 1:this.raiseDataHyperlinkClickEvent(e);break;case 2:t.preventDefault(),this.raiseDataHyperlinkClickEvent(e);break;default:debug.assertNever(i)}},i.prototype.raiseDataHyperlinkClickEvent=function(e){var t={url:e,visualContainer:this.viewModel.contract};this.services.eventBridge.publishToChannel(f.dataHyperlinkClicked,t)},i.prototype.applySelect=function(t){var i,r=this,o=e.extensibility.legacy.isOldSelectEventArgs(t);i=o?e.extensibility.legacy.getSelectorsByColumn(t):_.map(t.visualObjects,(function(e){return e.selectorsByColumn})),!_.isEmpty(i)&&this.isDrillEnabled()?(this.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1}),this.drill(!0,i,void 0)):this.services.explorationActivity.doActivity((function(){var n;n=o?e.extensibility.legacy.getSelectors(t):_.map(i,(function(e){return F.convertSelectorsByColumnToSelector(e)}));var a=_.size(t.visualObjects)!==_.size(r.selectedDatapoints)||_.some(t.visualObjects,(function(e,t){return!F.equalsSelectorsByColumn(e.selectorsByColumn,r.selectedDatapoints[t])}));r.selectedDatapoints=t.visualObjects?_.map(t.visualObjects,(function(e){return e.selectorsByColumn})):void 0;var s;try{s=r.getDataViewDataPointDescription(n)}catch(e){}r.viewModel.hostServices.selectDataPoint(r.services.filterGenerator,i,t.multiSelect,s),a&&r.raiseDataPointsSelectedEvent(n)}),(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXSelectDataPoint,r.viewModel.getVisualType(),r.viewModel.contract.name)}))},i.prototype.getDataViewDataPointDescription=function(e){if(!_.isEmpty(e)&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual&&this.viewModel.getRunningVisual()&&!_.isEmpty(this.viewModel.getRunningVisual().getDataViews())){var t=this.viewModel.getRunningVisual().getDataViews()[0],i=this.viewModel.contract.config.singleVisual;return y.getSelectorsMetadata(e,i,t)}},i.prototype.raiseDataPointsSelectedEvent=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.visualContainerDataSelectionService.getSelectedValues(o);t.push({selector:o,values:n})}var a={dataPointsDescriptions:t,visualContainer:this.viewModel.contract,visualTitleText:this.viewModel.visualTitle?this.viewModel.visualTitle.text:null};this.services.eventBridge.publishToChannel(f.dataPointsSelected,a)},i.prototype.raiseVisualLinkButtonClickedEvent=function(){var e=this.getVisualCapabilities();if(e&&e.supportsVisualLink){var t=this.viewModel.objects,i={title:t.title&&t.title.text,id:this.viewModel.contract&&this.viewModel.contract.name,type:t.visualLink&&t.visualLink.type&&t.visualLink.type.toString(),bookmark:t.visualLink&&t.visualLink.bookmark&&t.visualLink.bookmark.toString()};this.services.eventBridge.publishToChannel(f.visualLinkButtonClicked,i)}},i.prototype.startPerformanceActivity=function(){this.visualContainerPerformanceActivity&&(this.visualContainerPerformanceActivity.reject(),this.visualContainerPerformanceActivity=void 0),this.services.performanceAnalyzerService&&this.services.performanceAnalyzerService.isRecording()&&(this.visualContainerPerformanceActivity=this.services.performanceAnalyzerService.startVisualContainerActivity(this.viewModel.contract))},i.prototype.endPerformanceActivity=function(e){void 0===e&&(e=!1),this.visualContainerPerformanceActivity&&(e?this.visualContainerPerformanceActivity.reject():this.visualContainerPerformanceActivity.resolve(),this.visualContainerPerformanceActivity=void 0)},i.prototype.startProgressEvent=function(){this.progressTransitionEvent&&this.progressTransitionEvent.resolve();var t=this.viewModel.contract&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual&&this.viewModel.contract.config.singleVisual.visualType;this.progressTransitionEvent=this.services.telemetryService.startActivity(this.$scope,e.telemetry.EXRenderExplorationVisual,t,this.viewModel.contract.name),this.services.eventBridge.publishToChannel(f.visualContainerLoadingStarted,this.viewModel.contract.name)},i.prototype.endProgressEvent=function(){this.progressTransitionEvent&&(this.progressTransitionEvent.resolve(),this.progressTransitionEvent=null),this.services.eventBridge.publishToChannel(f.visualContainerLoadingStopped,this.viewModel.contract.name)},i.prototype.startDetailVisualProgressBar=function(){1===++this.detailVisualProgressBarCount&&this.updateProgressBarState()},i.prototype.stopDetailVisualProgressBar=function(){--this.detailVisualProgressBarCount<=0&&this.updateProgressBarState()},i.prototype.clearDetailVisualProgressBar=function(){this.detailVisualProgressBarCount=0,this.updateProgressBarState()},i.prototype.startProgressBar=function(){1===++this.progressBarCount&&this.updateProgressBarState()},i.prototype.stopProgressBar=function(){--this.progressBarCount<=0&&this.updateProgressBarState()},i.prototype.clearProgressBarState=function(){this.applyProgressBarState({progressBarCount:0,detailVisualProgressBarCount:0,hasPendingGeocoding:!1}),this.resetLoadState()},i.prototype.resetLoadState=function(){var e=this;this.activeNotificationsCount>0&&this.services.lazyScoped("loadProgressNotification").then((function(t){for(;e.activeNotificationsCount>0;)t.endLoad(),e.activeNotificationsCount--}))},i.prototype.updateProgressBarState=function(){this.destroyed||this.applyProgressBarState({progressBarCount:this.progressBarCount,detailVisualProgressBarCount:this.detailVisualProgressBarCount,hasPendingGeocoding:this.geocodingTracker&&this.geocodingTracker.hasPendingGeocoding()})},i.prototype.applyProgressBarState=function(t){var i=this,r=this.lastProgressBarState,o=r.progressBarCount>0||r.detailVisualProgressBarCount>0,n=t.progressBarCount>0||t.detailVisualProgressBarCount>0,a=o||r.hasPendingGeocoding,s=n||t.hasPendingGeocoding;s!==a&&(s?this.services.lazyScoped("loadProgressNotification").then((function(e){i.destroyed||(e.beginLoad(),i.activeNotificationsCount++)})):this.endLoadDefer.promise.finally((function(){return __awaiter(i,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.services.lazyScoped("loadProgressNotification")];case 1:return e=t.sent(),this.destroyed||(e.endLoad(),this.activeNotificationsCount--),[2]}}))}))})),this.viewModel.showProgressBar=s),n!==o&&(n?this.startProgressEvent():this.endProgressEvent()),this.lastProgressBarState=t},i.prototype.updateDisablePin=function(){this.disablePin=this.viewModel.options.disablePin||this.shouldBlockPinButtonForScriptVisual()},i.prototype.shouldBlockPinButtonForScriptVisual=function(){var t=this.viewModel.contract,i=this.services.explorationNavigation.getCurrentExploration(),r=i&&i.reportId,o=N.getVisualType(t),n=e.explore.util.ScriptVisualsUtil.getScriptVisualType(o);return this.services.viewModeState.getConfig().supportsPinning&&this.services.scriptVisuals.shouldBlockScriptVisual(n,r)},i.prototype.evaluateObjectDefinitions=function(){var e=this.services.explorationNavigation.getCurrentExploration(),t=e&&e.themeCollection,i=this.services.featureSwitchService.featureSwitches.propertyEvaluationWarnings&&this.isEditable();if(!this.services.featureSwitchService.featureSwitches.exprBoundVisualTitle){var r=N.evaluateObjectDefinitions(t,this.services.themeService,this.viewModel.contract,this.services.featureSwitchService.featureSwitches,i);this.viewModel.objects=r.dataViewObjects;var o=r.warnings;return void(o&&this.setClientWarnings(o))}var n,a,s=this.viewModel.getRunningVisual();if(s){var l=s.getDataTransforms();l&&(a=l.selects);var c=s.getData();c&&(n=c.dataView)}var u=N.evaluateObjectDefinitions(t,this.services.themeService,this.viewModel.contract,this.services.featureSwitchService.featureSwitches,i,n,a);this.viewModel.objects=u.dataViewObjects;var p=u.warnings;p&&this.setClientWarnings(p)},i.prototype.onDataRefreshTriggered=function(){(!this.services.visibility.get()||this.viewModel&&1===this.viewModel.contract.visibility)&&this.applyUpdate({initialLoad:!1,preferCurrentData:!1,allowCache:!1,refreshVisual:!0,requestPriority:1,queryOperationName:"AutoPageRefresh"})},i.prototype.applyUpdate=function(t){var i=this;void 0===t&&(t={});var r=t.initialLoad,o=t.preferCurrentData,n=t.allowCache,a=t.cacheResponseOnServer,s=t.refreshVisual,l=t.requestPriority,c=t.queryOperationName,u=t.sourceLabel;this.applyUpdateActivity.start((function(){return i.services.telemetryService.startActivity(i.$scope,e.telemetry.EXVisualContainerApplyUpdate,i.viewModel.contract.name)})),this.startPerformanceActivity();try{var p=this.viewModel,d=p.contract,h=p.getRunningVisual();this.evaluateObjectDefinitions(),h&&this.queryHandler.runQuery({contract:d,viewport:h.getViewport(),initialLoad:r,useVisualContainerCache:!s&&p.shouldUseCache(),preferCurrentData:o,allowCache:!s&&n,cacheResponseOnServer:a,currentData:h.getData(),geocodingTracker:this.geocodingTracker,performanceActivity:this.visualContainerPerformanceActivity,currentZone:this.currentZone,canDefer:this.canDeferQuery,requestPriority:l,queryOperation:c,interactiveQueryCachingSetting:N.getVisualQueryCachingSettings(this.services.featureSwitchService.featureSwitches.expandQueryCaching,u,c)})||this.applyUpdateActivity.resolve();var v=this.services.visualPlugin.getPlugin(p.getVisualType());v&&v.isDeprecated?this.errorManager.showDeprecationWarning():this.errorManager.clearDeprecationWarning(),this.endPerformanceActivity()}catch(e){throw this.applyUpdateActivity.reject({errorCode:"Exception",errorMessage:e&&e.name}),this.endPerformanceActivity(!0),e}},i.prototype.loadMergedData=function(t,i){var r=this.viewModel.getRunningVisual();r&&r.setData(t,this.services.telemetryService.startActivity(this.$scope,e.telemetry.EXVisualDataChanged,this.viewModel.contract.name),i?i.rootActivity.createChildActivity("Render"):void 0),i&&(i.queryActivity.addChildActivities(t.performanceActivities),i.queryActivity.resolve())},i.prototype.handleQueryResult=function(t,i,r,o,n){void 0===n&&(n=!1);try{var a=this.viewModel.getRunningVisual();if(!a)return;r&&(i=e.Prototype.inherit(i),i.objects=r),a.setDataTransforms(i);var s=o&&!n&&!this.viewModel.showWatermark&&!this.services.visualPluginOps.isAnalysisVisual(a.getType())&&!this.services.visualPluginOps.isQnaVisual(a.getType());a.setData(t,this.services.telemetryService.startActivity(this.$scope,e.telemetry.EXVisualDataChanged,this.viewModel.contract.name),s?o.rootActivity.createChildActivity("Render"):void 0),this.evaluateObjectDefinitions(),this.updateDataBoundProperties()}finally{this.applyUpdateActivity.resolve(),o&&!n&&(o.queryActivity.addChildActivities(t.performanceActivities),o.queryActivity.resolve())}var l=this.viewModel;l&&l.contract&&l.contract.cachedData&&l.contract.cachedData.dataUpdatedTime&&(l.lastUpdateAttemptTime=(new Date).toLocaleString())},i.prototype.handleQueryErrors=function(t,i){var r=t&&t.source?t.source:void 0;if(this.applyUpdateActivity.reject({errorCode:"Error",errorSource:r}),i&&i.queryActivity.reject(),t||(t=new X),!t.ignorable||t.ignorable!==!0){var o,n,a=this.viewModel.getRunningVisual();if(t instanceof e.DsrClientError){var l=t,c=l.powerBiErrorDetails,u=l.AdditionalErrorMessages;if(c)try{var p=JSON.parse(c);n={error:p.error,showNotification:!0}}catch(e){}if(u)for(var d=0,h=u.length;d<h;d++){var v=u[d];if(v.Code&&v.Message){var g=v.Code,f=v.Message;if(g===s.serverErrors.onPremiseServiceException)try{var p=JSON.parse(f);n={error:p.error,showNotification:!0}}catch(e){}}}}var y=t.getDetails(e.common.localize);if(o){y.displayableErrorInfo.length>0&&(y.displayableErrorInfo[0].errorInfoValue=e.common.localize.get(e.ServiceErrorHelper.serverErrorPrefix+o.code)),y.displayableErrorInfo.push({errorInfoKey:e.common.localize.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:o.code});var m=S.PowerBIServiceExceptionErrorHelper.generateErrorMessage(o);if(m&&m.displayableErrorInfo)for(var C=0,w=m.displayableErrorInfo;C<w.length;C++){var b=w[C];y.displayableErrorInfo.push(b)}}if(N.isScriptVisual(this.viewModel.contract,this.services.visualPlugin)){var x=N.getVisualType(this.viewModel.contract),E=e.explore.util.ScriptVisualsUtil.getScriptVisualType(x);y=this.services.scriptVisuals.overrideEmbeddedErrorDetails(E,y)||y}this.publishVisualErrorEvent(y,t.code,t.requestId,this.viewModel.visualTitle&&this.viewModel.visualTitle.text,n),this.errorManager.showErrorOverlay(y,t.code,t.requestId,t.source),a&&a.setData(null)}},i.prototype.publishVisualErrorEvent=function(t,i,r,o,n){var a,s;if(t.debugErrorInfo)for(var l=0,c=t.debugErrorInfo;l<c.length;l++){var u=c[l];u.errorInfoKey===e.ClientErrorStrings.ErrorCode?a=u.errorInfoValue:u.errorInfoKey===e.ClientErrorStrings.ErrorDetails&&(s=u.errorInfoValue)}var p={code:n&&n.error.code||a||i,message:n&&n.error.message||s||t.message,details:[r],target:o,"pbi.error":n&&n.error["pbi.error"]},d={error:p,showNotification:n&&n.showNotification};this.services.eventBridge.publishToChannel(f.reportVisualError,d)},i.prototype.handleQueryGenWarnings=function(t,i){if(this.resetWarnings(),!_.isEmpty(t)){for(var o,n=_.some(t,(function(t){return t instanceof e.data.dsr.DsrLimitsWarning})),a=0,s=t;a<s.length;a++){var l=s[a];if(l.columnNameFromIndex=function(e){var t=i.selects;return t.length<=e?null:t[e].displayName},l instanceof u){if(this.objectIsHidden(l.propertyId.objectName))continue;r(l,this.dataBoundObjectWarnings)}else o||(o=l)}if(o){var c=o.getDetails(e.common.localize);o instanceof e.data.dsr.DsrLimitsWarning?this.errorManager.showInfoIcon(c,o.code):o instanceof g&&o.isTransformMessage()?this.errorManager.showTransformWarningIcon(c,o.code,n):this.errorManager.showWarningIcon(c,o.code)}else this.isEditable()&&this.showDataBoundExprWarning()}},i.prototype.showDataBoundExprWarning=function(){return __awaiter(this,void 0,w,(function(){var e,t,i,r,o,n,a;return __generator(this,(function(s){switch(s.label){case 0:if(_.isEmpty(this.dataBoundObjectWarnings)||!this.isEditable())return[2];e=function(e){var i,r,o,n,a,s,l,u,p;return __generator(this,(function(d){switch(d.label){case 0:return i=t.dataBoundObjectWarnings[e],r=i[0].warnings[0],r instanceof c?[3,1]:[3,3];case 1:return o=t.services.dataSources.get(),[4,t.services.conceptualSchemaProxy.get(o)];case 2:return n=d.sent(),a=t.getVisualCapabilities(),s=t.services.displayNameService,l=function(e){return s.getDisplayName(e,n,a)},u=r.getMessages(t.services.localizationService,l),p={message:u.title,displayableErrorInfo:[{errorInfoKey:u.title,errorInfoValue:u.detail}]},t.errorManager.showWarningIcon(p,r.code),[2,{value:void 0}];case 3:return[2]}}))},t=this,i=[];for(r in this.dataBoundObjectWarnings)i.push(r);o=0,s.label=1;case 1:return o<i.length?(n=i[o],[5,e(n)]):[3,4];case 2:if(a=s.sent(),"object"==typeof a)return[2,a.value];s.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},i.prototype.getNextDataSegment=function(){this.services.eventBridge.publishToChannel(t.services.events.userActionTriggered,{source:"UserAction_Scroll"}),this.startPerformanceActivity();var e=this.viewModel,i=e.contract,r=e.getRunningVisual(),o=this.queryHandler.getNextDataSegment({contract:i,viewport:r&&r.getViewport(),useVisualContainerCache:e.shouldUseCache(),performanceActivity:this.visualContainerPerformanceActivity}).then((function(e){var t=__assign({},e);if(e&&e.performanceActivityContext){var i=e.performanceActivityContext;t.performanceActivityContext=void 0,t.performanceActivity=i.rootActivity.createChildActivity("Render"),i.queryActivity.addChildActivities(e.result&&e.result.dataReaderResult&&e.result.dataReaderResult.performanceActivities),i.queryActivity.resolve()}return t}));return this.endPerformanceActivity(),o},i.prototype.loadMoreData=function(){if(this.queryHandler.canLoadMoreData()){this.services.eventBridge.publishToChannel(t.services.events.userActionTriggered,{source:"UserAction_Scroll"}),this.startPerformanceActivity();var e=this.viewModel,i=e.contract,r=e.getRunningVisual();this.queryHandler.loadMoreData({contract:i,currentData:r&&r.getData(),useVisualContainerCache:e.shouldUseCache(),viewport:r&&r.getViewport(),performanceActivity:this.visualContainerPerformanceActivity}),this.endPerformanceActivity()}},i.prototype.setShouldDeferData=function(e){this.canDeferQuery!==e&&(this.canDeferQuery=e,e||this.applyUpdate())},i.prototype.reloadDataSegment=function(e){this.startPerformanceActivity();var t=this.viewModel,i=t.contract,r=t.getRunningVisual();this.queryHandler.reloadDataSegment({contract:i,currentData:r&&r.getData(),useVisualContainerCache:t.shouldUseCache(),viewport:r&&r.getViewport(),performanceActivity:this.visualContainerPerformanceActivity},e),this.endPerformanceActivity()},i.prototype.resetWarnings=function(){this.dataBoundObjectWarnings={},this.warnings=null},i.prototype.persistProperties=function(e,t){var i=this.bufferPropertyChanges(_.isArray(e)?{replace:e}:e);i&&this.applyPropertyChanges(i,t)},i.prototype.applyPropertyChanges=function(t,i){var r=this,o=function(){var e=r.viewModel;r.services.visualAuthoring.persistProperties(t,e.contract,i===!0)&&(r.applyUpdate({preferCurrentData:!0}),r.updateVisualContainerProperties(),r.updateVisualContainerThemeableProperties())};this.isFilterChange(t)?this.services.explorationActivity.doActivity(o,(function(t){return r.services.telemetryService.startActivity(t,e.telemetry.EXApplySlicer,r.viewModel.contract.name)})):o()},i.prototype.isFilterChange=function(e){function t(e){return!!_.find(e,(function(e){return!e.selector&&e.objectName===o.objectName&&e.properties&&null!=e.properties[o.propertyName]}))}function i(e){return e&&(t(e.merge)||t(e.replace)||t(e.remove))}if(!e)return!1;var r=this.getVisualCapabilities(),o=d.findFilterOutput(r.objects);return!!o&&(_.isArray(e)?!!_.find(e,(function(e){return i(e)})):i(e))},i.prototype.applyJsonFilter=function(t,i,r,o){return void 0===o&&(o=0),__awaiter(this,void 0,e.Promise,(function(){var e,n,a,s,l,c,u,p,d,h;return __generator(this,(function(v){switch(v.label){case 0:return[4,this.getJsonFilterParser()];case 1:return e=v.sent(),n=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(n)];case 2:return a=v.sent(),[4,e.tryConvertJsonFilterArrayToFilterDataArray(t,a)];case 3:return s=v.sent(),l=_.map(s,(function(e){return e.filter})),c=_.map(s,(function(e){return e.filterExpressionMetadata})),u=V.merge(l),p={},p[r]=u,d={},d=0===o?{merge:[{objectName:i,properties:p,selector:void 0}]}:{remove:[{objectName:i,properties:p,selector:void 0}]},this.persistProperties(d),h=this.viewModel.contract.config.singleVisual,h.filterExpressionMetadata=y.mergeFilterExpressionMetadataArray(c),this.raiseVisualContainerChanged(N.contractUnEqualityComparator),[2]}}))}))},i.prototype.getJSONFilter=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o;return __generator(this,(function(n){switch(n.label){case 0:return t?(e=this.services.dataSources.get(),[4,this.getJsonFilterParser()]):[2];case 1:return i=n.sent(),[4,this.services.conceptualSchemaProxy.get(e)];case 2:return r=n.sent(),o=this.viewModel.contract.config.singleVisual,[4,i.tryCreateJSONFilter(t,r,o.filterExpressionMetadata)];case 3:return[2,n.sent()]}}))}))},i.prototype.onCustomSort=function(e){var t=this.sortHelper.applySortByFields(e);this.services.overlayService.hideAllDropdowns();var i=_.first(t);i&&this.announceSortDirection(i.displayName,i.sortDirection)},i.prototype.announceSortDirection=function(e,t){if(e)switch(t){case 1:this.services.screenReaderService.alertPolite(this.services.localizationService.format("DataGrid_ColumnSortedAscending",e));break;case 2:default:this.services.screenReaderService.alertPolite(this.services.localizationService.format("DataGrid_ColumnSortedDescending",e))}},i.prototype.updateDetailVisualVisibility=function(){var e=this.viewModel.contract;this.services.visibility.isSeeDataMode(e.visibility)&&!this.services.drill.canSeeData(e)&&this.setPopOutMode(1)},i.prototype.setPopOutMode=function(e){0===e?this.services.visibility.clear():this.services.visibility.set(this.viewModel.contract,e)},i.prototype.isHeaderVisible=function(){var e=this.services;if(!e.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeader())return!1;var t=e.viewModeState.getConfig(),i=t.displayOptions,r=this.viewModel;if(i.hideInFocusTileMenu&&r.isPoppedOut||i.hideTileMenu||r.options.hideHeader)return!1;if(0===this.services.viewModeState.getMode()){var o=r.objects&&r.objects.visualHeader;if((o&&o.show)===!1)return!1}var n=E.getSelectedVisual(this.services.selection),a=t.showRelationships&&n&&e.visualRelationship.supportsAnyFilterAction(n);return this.isSelected()||this.isHovering||a},i.prototype.canRemoveFromLayout=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canRemoveVisualFromLayout()&&!this.isHeaderVisible();
},i.prototype.removeVisualFromLayout=function(){this.services.eventBridge.publishToChannel(f.removeVisualContainerFromLayout,this.viewModel.contract)},i.prototype.isPopOutBarVisible=function(){return this.viewModel.isPoppedOut&&!this.services.viewModeState.getConfig().displayOptions.hideInFocusBar},i.prototype.isVisualHidden=function(){return this.viewModel&&this.services.visibility.isSeeDataMode(this.viewModel.contract.visibility)&&this.services.viewModeState.getConfig().displayOptions.showDetailVisualOnFullScreen},i.prototype.onHeaderDestroy=function(){this.viewModel.insetHeaderSize&&(this.viewModel.insetHeaderSize=void 0,this.viewModel.updateViewState())},i.prototype.onHeaderResize=function(e,t){var i;2===this.getVisualHeaderPlacement(this.viewModel)&&(i={width:e,height:t}),_.isEqual(this.viewModel.insetHeaderSize,i)||(this.viewModel.insetHeaderSize=i,this.viewModel.updateViewState())},i.prototype.shouldRestrictTransformDraw=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()},i.prototype.isEditable=function(){return 1===this.services.viewModeState.getMode()},i.prototype.isInViewMode=function(){return 0===this.services.viewModeState.getMode()},i.prototype.canAddComment=function(e){var t=this.services.explorationCapabilities.getCapabilities(),i=this.services.explorationNavigation.getCurrentSection();return 0===e&&t.annotationsEnabled&&!i.transient},i.prototype.canExport=function(){var e=!1,t=!1,i=!!this.services.viewModeState.getConfig().supportsExportData,r=this.viewModel;if(null!=r){t=r.showWatermark;var o=r.contract&&r.contract.config,n=o&&o.singleVisual&&o.singleVisual.visualType;jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(n)||(e=this.services.visualPluginOps.isQueryVisual(n))}return i&&e&&!t},i.prototype.canSearch=function(){var e=this,t=this.viewModel;if(t){var i=N.getVisualType(t.contract);if(this.services.visualPluginOps.supportVisualSearch(i)){var r=this.services.dataSources.get();if(r)return this.services.conceptualSchemaProxy.get(r).then((function(i){return!!N.containSearchableField(t.contract,e.services.visualPlugin,i)}))}}return this.services.promiseFactory.resolve()},i.prototype.refreshHostData=function(){var t=N.getVisualType(this.viewModel.contract);this.services.telemetryService.logEvent(e.telemetry.EXRefreshHostData,t,this.viewModel.contract.name),this.services.eventBridge.publishToChannel(f.refreshExploration)},i.prototype.subscribeToBubbling=function(e,t){this.scopeEventManager.subscribe(e.name,t)},i.prototype.isLockObjects=function(){return this.services.viewModeState.getViewState().lockObjects},i.prototype.slowDataApplyEnabled=function(){if(!this.services.featureSwitchService.featureSwitches.slowDataSourceModeEnabled)return!1;var e=this.services.explorationNavigation.getCurrentExploration();return!!(e&&e.slowDataSourceSettings&&e.slowDataSourceSettings.isSlicerSelectionsButtonEnabled)},i.prototype.isFilterVisual=function(){var e=this.viewModel,t=e&&e.readOnlyState;return t&&t.isFilterVisual},i.prototype.isFooterVisible=function(){return this.isApplyButtonVisible()},i.prototype.isApplyButtonVisible=function(){return this.slowDataApplyEnabled()&&this.isFilterVisual()},i.prototype.isApplyButtonEnabled=function(){return!_.isEmpty(this.bufferedFilterChanges)},i.prototype.onApplyButtonClicked=function(){this.applyBufferedPropertyChanges()},i.prototype.applyBufferedPropertyChanges=function(){var e=this.bufferedFilterChanges,t=this.bufferedFilterSelect;this.bufferedFilterChanges=void 0,this.bufferedFilterSelect=void 0,null!=e&&this.applyPropertyChanges(e,!1),null!=t&&this.applySelect(t)},i.prototype.bufferOnSelect=function(e){return!(!this.slowDataApplyEnabled()||!this.isFilterVisual())&&(this.bufferedFilterSelect=e,!0)},i.prototype.bufferPropertyChanges=function(e){if(!this.slowDataApplyEnabled()||!this.isFilterVisual())return e;null==this.bufferedFilterChanges&&(this.bufferedFilterChanges=[]),this.bufferedFilterChanges.push(e);var t=this.viewModel.contract.config.singleVisual,i=t.objects;i=i?p.clone(i):{};var r=P.getSlicerModeDefinition(i),o=this.getVisualCapabilities(),n=d.findSelfFilter(o.objects),a=n&&p.getValue(i,n,void 0),s=new j;if(!this.applyBufferedPropertyChangesToObjects(i,s.toCallback())&&1===this.bufferedFilterChanges.length)return this.bufferedFilterChanges=void 0,e;var l=s.getChanges(),c=!l;if(this.bufferedFilterChanges=[l||{}],!c&&"slicer"===t.visualType)if(r){var u=P.getSlicerModeDefinition(i);M.equals(r,u)||(c=!0)}else{var h=d.findFilterOutput(o.objects),v=h&&p.getValue(i,h,void 0);v||(c=!0)}if(!c&&n){var g=p.getValue(i,n,void 0);(a?g&&V.isSameFilter(a,g):!g)||(c=!0)}return c?void this.applyBufferedPropertyChanges():void this.applyUpdate({preferCurrentData:!0})},i.prototype.applyBufferedPropertyChangesToObjects=function(e,i){var r=!1;if(null!=this.bufferedFilterChanges)for(var o=0,n=this.bufferedFilterChanges;o<n.length;o++){var a=n[o];t.services.applyPropertyChanges(a,this.getVisualCapabilities().objects,e,i)&&(r=!0)}return r},i.prototype.getDataMultiSelectMode=function(){return this.services.viewModeState.getConfig().touchOptions.dataMultiSelectMode},i.prototype.getJsonFilterParser=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.services.moduleLoader.require({javascript:"JSONFilter/services/jsonFilterParser"})];case 1:return e=i.sent(),[4,e.create(this.services.promiseFactory,this.services.moduleLoader,null,this.services.lazyProviderModern)];case 2:return t=i.sent(),[2,t]}}))}))},i.prototype.objectIsHidden=function(e){var t=this.viewModel.objects&&this.viewModel.objects[e];if(t)return t.hasOwnProperty(b.Show)&&!t[b.Show];var i=p.getValue(this.viewModel.contract.config.singleVisual.objects,{objectName:e,propertyName:b.Show},null);return void 0!==i&&M.isConstant(i)&&!i.value},i.prototype.getVisualContainerForDrillthrough=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,l,c;return __generator(this,(function(u){switch(u.label){case 0:return e=this.services.explorationNavigation.getCurrentSection(),e.crossFilterSource&&e.crossFilterSource.highlight?[4,this.services.lazyScoped("drillthrough")]:[2];case 1:i=u.sent(),o=0,n=e.crossFilterSource.highlight,u.label=2;case 2:return o<n.length?(a=n[o],s=N.getVisualType(a.sourceVisualContainer),l=this.services.visualPluginOps.isQueryVisual(s),l?[4,i.getForcedMatchSectionInfo(0,t,e.name,a.sourceVisualContainer,a.selection,void 0)]:[3,4]):[3,5];case 3:if(c=u.sent(),!c||_.isEmpty(c.matchedLinkFields))return[3,4];if(r)return[2];r=a.sourceVisualContainer,u.label=4;case 4:return o++,[3,2];case 5:return[2,r]}}))}))},i.prototype.isVisualEnabled=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r;return __generator(this,(function(o){switch(o.label){case 0:return e=this.getVisualLink(),(t=e&&e.show)?(i=L.getType(e),i!==L.Drillthrough?[3,2]:_.isEmpty(e.drillthroughSection)?[2,!1]:[4,this.getVisualContainerForDrillthrough(e.drillthroughSection)]):[2,!0];case 1:if(r=o.sent(),!r)return[2,!1];o.label=2;case 2:return[2,!0]}}))}))},i})();i.VisualContainerCore=U;var j=(function(){function e(){this.propertyChanges={}}return e.prototype.getChanges=function(){var e,t=function(t){for(var r=function(i){var r=i.selector;for(var o in i.properties){var n=i.properties[o];if(n.oldDef!==n.newDef&&!p.propertiesAreEqual(n.oldDef,n.newDef))if(e||(e={}),n.newDef){e.merge||(e.merge=[]);var a=_.find(e.merge,(function(e){return e.objectName===t&&F.equals(e.selector,r)}));a||e.merge.push(a={objectName:t,selector:r,properties:{}}),a.properties[o]=n.newValue}else{e.remove||(e.remove=[]);var s=_.find(e.remove,(function(e){return e.objectName===t&&F.equals(e.selector,r)}));s||e.remove.push(s={objectName:t,selector:r,properties:{}}),s.properties[o]=void 0}}},o=0,n=i.propertyChanges[t];o<n.length;o++){r(n[o])}},i=this;for(var r in this.propertyChanges)t(r);return e},e.prototype.toCallback=function(){var e=this;return function(t,i,r,o,n,a){var s=e.propertyChanges[t];s||(s=e.propertyChanges[t]=[]);var l=_.find(s,(function(e){return F.equals(e.selector,i)}));l||s.push(l={selector:i,properties:{}});var c=l.properties[r];c?(c.newDef=n,c.newValue=a):c=l.properties[r]={oldDef:o,newDef:n,newValue:a}}},e})(),X=(function(e){function t(){return e.call(this,"VisualDataProxyExecutionUnknownError")||this}return __extends(t,e),t})(e.UnknownClientError),Q=(function(){function t(t,i){var r=this;this.context=t,this.services=i,this.containerPresent=new e.PbiDeferred,this.containerPositioned=new e.PbiDeferred,w.all([this.containerPresent.promise,this.containerPositioned.promise]).then((function(){r.enabled=!0,r.toolbar&&(r.updateToolbarOverlay(),r.setVisible(r.visible))}))}return t.prototype.setToolbar=function(e){this.toolbar=e,e||this.setVisible(!1),this.enabled&&(this.updateToolbarOverlay(),this.toolbar&&this.setVisible(!0))},t.prototype.setSelected=function(e){this.selected=e,this.setVisible(e)},t.prototype.setVisible=function(e){if(e=e&&this.selected&&1===this.services.selection.getSelectedElements().length&&1===this.services.viewModeState.getMode()){e=this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualToolbar()}this.visible=e;var t=this.toolbar;if(this.enabled&&this.toolbarOverlay){e!==this.toolbarOverlay.isVisible()&&(this.toolbarOverlay.setVisibility(e),t&&t.visibleChangedCallback&&t.visibleChangedCallback(e)),e&&this.toolbarOverlay.repositionToolbar()}},t.prototype.destroy=function(){this.toolbarOverlay&&(this.toolbarOverlay.destroy(),this.toolbarOverlay=void 0),this.toolbar=void 0,this.visible=!1,this.enabled=!1,this.selected=void 0},t.prototype.updateToolbarOverlay=function(){var e=this.toolbar,t=this.toolbarOverlay;if(e||t){var i;if(e&&null!=e.theme)switch(e.theme){case"darkTheme":case"lightTheme":case"neutralGrayTheme":i=e.theme}var r={layout:"overlayedToolbar",theme:i,preferHorizontalLayout:e&&e.preferHorizontalLayout};if(t)t.setToolbar(e&&e.element),t.updateOptions(r);else{var o=this.context.find(".visualContainer");this.toolbarOverlay=A.create(o,e.element,r)}}},t})()})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.VisualContainer={bindings:{viewModel:"<",canvasLayout:"<",transformParent:"<"},controller:e.common.createController(t.VisualContainerController),controllerAs:"$ctrl",templateUrl:"components/visualContainer/visualContainer.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.VisualContainerHeader={templateUrl:"components/visualContainerHeader/visualContainerHeader.html",bindings:{visual:"<",menuOptions:"<",disablePin:"<",showWarningDetails:"&",showTransformWarningDetails:"&",showInfoDetails:"&",onVisualContainerChanged:"&",onHeaderDestroy:"&",onHeaderResize:"&",optionsMenuFactory:"<",onVisualContainerRefresh:"&",onShowTooltip:"&",onHideTooltip:"&"}}})(t=e.components||(e.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e,t,i,r){void 0===r&&(r=!1),this.localizationService=e,this.explorationCapabilities=t,this.dropdown=i,this.showIcons=r,this.allCommands=[]}return t.prototype.create=function(t,i,r){return __awaiter(this,void 0,e.Promise,(function(){var e,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this,[4,this.createItems(t)];case 1:return e.menuItems=a.sent(),o=this.explorationCapabilities.getCapabilities(),n=o&&o.shouldUseMenuScrollbars,this.dropdown.showContextMenu(this.menuItems,i,this.select.bind(this),!1,void 0,n,!0,r),[2]}}))}))},t.prototype.getItems=function(){return this.menuItems},t.prototype.createItems=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return e=[],[4,this.createMenuItemsFromCommands(t,e)];case 1:return i=r.sent(),_.isEmpty(i)?[2,this.createNoAvailableActionsMenu(this.localizationService)]:(this.allCommands=e,[2,{items:i}])}}))}))},t.prototype.select=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return e=this.allCommands[t],[4,e.execute()];case 1:return i.sent(),[2]}}))}))},t.prototype.createNoAvailableActionsMenu=function(e){var t=[],i=e.get("VisualContainer_ContextMenu_NoAvailableActions"),r=this.createMenuItem(null,i,null);return r.disabled=!0,t.push(r),{items:t}},t.prototype.createMenuItemsFromCommands=function(t,i){return void 0===i&&(i=[]),__awaiter(this,void 0,e.Promise,(function(){var e,r,o,n,a,s,l,c,u,p;return __generator(this,(function(d){switch(d.label){case 0:if(_.isEmpty(t))return[2];e=[],r=0,o=t,d.label=1;case 1:return r<o.length?(n=o[r],[4,n.isVisible()]):[3,11];case 2:return d.sent()?(a=void 0,s=void 0,n.getToolTip?[4,n.getToolTip(this.localizationService)]:[3,4]):[3,10];case 3:s=d.sent(),d.label=4;case 4:return c=n.isDisabled,c?[4,n.isDisabled()]:[3,6];case 5:c=d.sent(),d.label=6;case 6:return l=c,l?[3,9]:[4,n.getChildren()];case 7:return u=d.sent(),[4,this.createMenuItemsFromCommands(u,i)];case 8:a=d.sent(),d.label=9;case 9:i.push(n),p=this.createMenuItem(i.length-1,n.title(this.localizationService),l,a,n.glyph,n.selected,n.customIcon,s),e.push(p),d.label=10;case 10:return r++,[3,1];case 11:return[2,e]}}))}))},t.prototype.createMenuItem=function(e,t,i,r,o,n,a,s){return{key:e,text:t,type:0,children:r,icon:o,selected:n,customIcon:a,showIcon:this.showIcons,disabled:i,tooltip:s}},t})();t.VisualContainerContextMenu=i})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.ArrowVerticalPosition,o=t.services.events,n=t.services.selectionUtils,a=e.explore.util.VisualContainerUtils,s=(function(){function i(e,t){this.services=t,this.filterTitle=this.services.localizationService.get("VisualRelationships_DataFilter"),this.filterTooltipConfig={tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.filterTitle,tooltipShowOnFocus:!0},this.highlightTitle=this.services.localizationService.get("VisualRelationships_HighlightFilter"),this.highlightTooltipConfig={tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.highlightTitle,tooltipShowOnFocus:!0},this.noneTitle=this.services.localizationService.get("None"),this.noneTooltipConfig={tooltipArrowVerticalPosition:r.bottom,tooltipTitle:this.noneTitle,tooltipShowOnFocus:!0}}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","localizationService","telemetryService"],scopedDependencies:["dataSources","eventBridge","selection","viewModeState","visualAuthoring","visualRelationship"]}},i.prototype.$onInit=function(){var e=this;this.loadVisualRelationshipFilterAction(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){return e.loadVisualRelationshipFilterAction()})).subscribe(o.visualTypeChanged,(function(){return e.loadVisualRelationshipFilterAction()})).subscribe(o.explorationSlowDataSourceSettingsLoaded,(function(t,i){return i.isCrossHighlightingDisabledChanged&&e.loadVisualRelationshipFilterAction()}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.setVisualRelationshipFilterAction=function(i,r){i&&i.stopPropagation&&i.stopPropagation();var o=n.getSelectedVisual(this.services.selection);this.visual.hostServices.setVisualRelationshipFilterAction(o,this.visual.contract,r,this.services.visualAuthoring),this.services.telemetryService.logEvent(e.telemetry.EXVisualRelationshipOverride,a.getVisualType(o),a.getVisualType(this.visual.contract),t.contracts.VisualRelationshipFilterActionUtil.toString(r)),this.filterAction=r,this.onVisualContainerChanged()},i.prototype.loadVisualRelationshipFilterAction=function(){var e=this,t=n.getSelectedVisual(this.services.selection);if(t){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){var r=e.visual.hostServices.getVisualRelationshipFilterAction(t,e.services.visualRelationship,i);0===r&&(r=e.services.visualRelationship.defaultFilterAction(t,e.visual.contract)),e.filterAction=r}))}},i.prototype.supportsVisualRelationshipFilterAction=function(e){var t=n.getSelectedVisual(this.services.selection);return this.services.visualRelationship.supportsFilterActionTarget(t,this.visual.contract,e)},i})();i.VisualContainerRelationshipFiltersController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerRelationshipFilters={templateUrl:"components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",bindings:{visual:"<",onVisualContainerChanged:"&"},controller:e.common.createController(t.controllers.VisualContainerRelationshipFiltersController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.explore.modules,a=e.visuals.plugins,s=t.services.selectionUtils,l=e.data.SQExprBuilder,c=t.util.VisualContainerUtils,u=(function(){function i(t,i){var r=this;this.$scope=t,this.services=i,this.$scope.viewModeState=i.viewModeState,this.$scope.setActiveSection=function(e){return r.setActiveSection(e)},this.$scope.setActivePagePaneSection=function(e){return r.setActivePagePaneSection(e)},this.$scope.toggleEffectClasses=function(e,t,i){return r.toggleEffectClasses(e,t,i)},this.$scope.toggle=function(){return r.toggle()},this.$scope.exploreUIShellConfig=n.ExploreUIShellModule,this.$scope.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.$scope.useNewFilterPane=!1,this.$scope.isOutspacePaneVisible=!1,this.$scope.personalVisualizationPanePrepared=!1,this.$scope.toggleOutspacePaneVisibility=function(){return r.toggleOutspacePaneVisibility()},this.$scope.showFilterPane=function(){return r.showFilterPane()},this.$scope.showNonPersonalVisualizationPane=function(){return r.showNonPersonalVisualizationPane()},this.$scope.useModernFilterPane=this.services.featureSwitchService.featureSwitches.useModernFilterPane;var a=this.services.explorationCapabilities.getCapabilities().showFluentDesign||this.services.featureSwitchService.featureSwitches&&this.services.featureSwitchService.featureSwitches.paneColorRefresh,s=a?"_paneColorRefresh":"";this.$scope.getSectionIconSymbolId=function(e){return"visualizationPane"+_.upperFirst(e)+s},this.$scope.sectionIconSheetName="visualizationPaneIcons"+s,this.updateAll();var l=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){r.updateSections(),r.updateHeader(),r.updatePagePaneSections()})).subscribe(o.visualTypeChanged,(function(){r.updateSections(),r.updateHeader(),r.updatePagePaneSections()})).subscribe(o.explorationLoaded,(function(){return r.onExplorationLoaded()})).subscribe(o.explorationObjectsLoaded,(function(e,t){return r.updateIsOutspacePaneVisible(t.evaluatedObjects)})).subscribe(o.explorationSettingsLoaded,(function(e,t){if(t.useNewFilterPaneExperienceChanged){var i=r.services.explorationNavigation.getCurrentExploration();r.updateUseNewFilterPaneSettings(i),r.updateIsOutspacePaneVisible(i.evaluatedObjects)}})).subscribe(o.preparePersonalVisuals,(function(){r.preparePersonalVisualizationPane()})).subscribe(o.explorationContainerReady,(function(){return r.updateAll()})),c=this.services.globalEventBridge.createChannelSubscriptionManager().subscribe(e.host.global.events.SignInStatusChangedEvent,(function(){r.services.favoriteVisualLoader.reset(r.services.visualPlugin),r.services.visualPaneSettingsService.reset(),r.preparePersonalVisualizationPane()}));this.$scope.$watchGroup(["viewModeState.getMode()","viewModeState.getConfig().alwaysPopulatePanes"],(function(){return r.updateAll()})),this.$scope.$on("$destroy",(function(){l.unsubscribeAll(),c.unsubscribeAll()})),this.initializeHighContrastRules(),this.preparePersonalVisualizationPane()}return Object.defineProperty(i.prototype,"viewModel",{set:function(e){this.$scope.viewModel=e},enumerable:!0,configurable:!0}),i.createOptions=function(){return{additionalServices:["highContrastCssGenerationService","featureSwitchService","localizationService","telemetryService","promiseFactory","favoriteVisualLoader","visualPaneSettingsService","svgProvider","globalEventBridge"],scopedDependencies:["eventBridge","explorationCapabilities","selection","viewModeState","visualPlugin","visualPluginOps","explorationNavigation","undoRedo"]}},i.prototype.$onInit=function(){this.$scope.focusedSection=this.$scope.viewModel.activeSection;var e=this.services.explorationNavigation.getCurrentExploration();e&&(this.updateUseNewFilterPaneSettings(e),this.updateIsOutspacePaneVisible(e.evaluatedObjects))},i.prototype.showFilterPane=function(){return!this.services.featureSwitchService.featureSwitches.forceMigrateNewFilterPane&&(!this.services.featureSwitchService.featureSwitches.singleFilterPane||!this.$scope.useNewFilterPane)},i.prototype.showNonPersonalVisualizationPane=function(){var e=this;return _.some(this.services.visualPlugin.getConvertibleVisuals(),(function(t){var i=!1,r=e.services.featureSwitchService.featureSwitches.userFavoriteResourcePackagesEnabled&&t.custom&&t.favoriteId,o=e.services.featureSwitchService.featureSwitches.userFavoriteResourcePackagesEnabled&&t.custom&&!t.favoriteId,n=e.services.featureSwitchService.featureSwitches.tenantOutOfBoxVisualsEnabled&&t.custom&&t.isOutOfBox,a=e.services.featureSwitchService.featureSwitches.personalVisualizationPaneEnabled&&e.services.visualPaneSettingsService.isUnpinnedVisual(t.name);return t.custom&&!n&&o?i=!0:a&&!r&&(i=!0),i}))},i.prototype.preparePersonalVisualizationPaneServices=function(){var e=this,t=[];return this.services.featureSwitchService.featureSwitches.userFavoriteResourcePackagesEnabled&&t.push(this.services.favoriteVisualLoader.ensureFavoriteVisualResources(this.services.visualPlugin)),this.services.featureSwitchService.featureSwitches.tenantOutOfBoxVisualsEnabled&&t.push(this.services.favoriteVisualLoader.ensureOutOfBoxVisuals(this.services.visualPlugin)),this.services.promiseFactory.allSettled(t).finally((function(){if(e.services.featureSwitchService.featureSwitches.personalVisualizationPaneEnabled)return e.services.visualPaneSettingsService.updateVisuals()}))},i.prototype.preparePersonalVisualizationPane=function(){var e=this;this.preparePersonalVisualizationPaneServices().finally((function(){e.$scope.personalVisualizationPanePrepared=!0,e.services.eventBridge.publishToChannel(o.visualPluginsChanged)}))},i.prototype.initializeHighContrastRules=function(){this.services.highContrastCssGenerationService.addRule(".themeableElement .navMarker","{ background: @foregroundColor !important; }"),this.services.highContrastCssGenerationService.addRule(".themeableElement .visualizationPane .pivotNav li:focus, .themeableElement .visualizationPane .pivotNav li:hover","{ background-color: @selectedBackgroundColor !important; }"),this.services.highContrastCssGenerationService.addRule(".themeableElement .propertyPaneContents .inputField .inputFieldInSlice:hover, \n            .themeableElement .propertyPaneContents .inputField .inputRange:hover, .themeableElement .propertyPaneContents .inputField \n            .themeableElement .inputUpDown:hover, .themeableElement .propertyPaneContents .inputField .paragraph:hover, \n            .themeableElement .propertyPaneContents .inputField .select-element:hover, .themeableElement .propertyPaneContents .inputField .selection-box:hover, \n            .themeableElement .propertyPaneContents .inputField .ui-widget:hover","{ border-color: @selectedBackgroundColor !important; }"),this.services.highContrastCssGenerationService.addRule(".themeableElement .propertyPaneContents .inputField .clearAll","{ border-color: transparent !important; }")},i.prototype.toggleEffectClasses=function(e,t,i){var r=i?"hover":"focus";this.services.svgProvider.toggleCssClasses(t,r,this.$scope.sectionIconSheetName,this.$scope.getSectionIconSymbolId(e))},i.prototype.setActiveSection=function(e){this.$scope.viewModel.previousSection=this.$scope.viewModel.activeSection,this.$scope.viewModel.activeSection=e,this.updateShowHideElements()},i.prototype.setActivePagePaneSection=function(e){this.$scope.viewModel.previousPageSection=this.$scope.viewModel.activePageSection,this.$scope.viewModel.activePageSection=e,this.updateShowHideElements()},i.prototype.updateAll=function(){var e=this.$scope.viewModeState.getMode();this.$scope.isEditing=1===e,this.$scope.populatePanes=this.$scope.isEditing||this.$scope.viewModeState.getConfig().alwaysPopulatePanes,this.$scope.showVisualTypes=this.$scope.populatePanes,this.$scope.viewModel&&(this.updateShowHideElements(),this.updateSections(),this.updatePagePaneSections(),this.updateHeader(),this.updateExplorationVisuals())},i.prototype.updateExplorationVisuals=function(){if(this.$scope.isEditing){this.services.visualPaneSettingsService.resetExplorationVisuals();var e=this.services.explorationNavigation.getCurrentExploration();if(e)for(var t=0,i=e.sections;t<i.length;t++)for(var r=i[t],o=0,n=r.visualContainers;o<n.length;o++){var a=n[o];this.services.visualPaneSettingsService.addExplorationVisual(a.config.singleVisual.visualType)}}},i.prototype.updateShowHideElements=function(){var e=this.$scope.viewModel.activeSection,i=this.$scope.viewModel.activePageSection,r=this.$scope.populatePanes,o=this.getSelectedVisual();o?this.$scope.showVisualTypes=r&&(t.contracts.isVisualContainerGroup(o)||this.services.visualPluginOps.canConvertVisual(o)):this.$scope.showVisualTypes=r,this.$scope.showFieldWellOrFilters=!e&&!i||e===t.viewModels.VisualizationPaneSectionType.Fields||i===t.viewModels.PagePaneSectionType.Fields,this.$scope.showFieldWell=r&&(e===t.viewModels.VisualizationPaneSectionType.Fields||i===t.viewModels.PagePaneSectionType.Fields),this.$scope.showPropertyPane=r&&e===t.viewModels.VisualizationPaneSectionType.Format,this.$scope.showPagePropertyPane=r&&i===t.viewModels.PagePaneSectionType.Format&&!this.$scope.isNonQueryVisual,this.$scope.showAnalyticsPane=r&&e===t.viewModels.VisualizationPaneSectionType.Analytics,this.$scope.showDrillthroughPane=this.$scope.showFieldWellOrFilters},i.prototype.updateSections=function(){var e=this.getSelectedVisual(),i=this.$scope.viewModel,r=c.getVisualType(e),o=this.services.visualPluginOps,n=e&&t.contracts.isVisualContainer(e)&&o.isSupportedVisual(e),a=r&&o.isQueryVisual(r);if(this.$scope.isNonQueryVisual=void 0!==e&&!a,i.sections=[],!e||!t.contracts.isVisualContainerGroup(e)&&!n)return void this.setActiveSection(void 0);if(this.$scope.isEditing&&this.$scope.isNonQueryVisual)this.setActiveSection(t.viewModels.VisualizationPaneSectionType.Format);else{var s=i.activeSection;this.$scope.isEditing&&void 0!==s||this.setActiveSection(t.viewModels.VisualizationPaneSectionType.Fields),i.sections.push({sectionType:t.viewModels.VisualizationPaneSectionType.Fields,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"})}(t.contracts.isVisualContainerGroup(e)||o.canFormatVisual(e))&&(i.sections.push({sectionType:t.viewModels.VisualizationPaneSectionType.Format,displayName:this.services.localizationService.get("Format"),cssClass:"format"}),i.sections.push({sectionType:t.viewModels.VisualizationPaneSectionType.Analytics,displayName:this.services.localizationService.get("VisualizationPane_Section_Analytics"),cssClass:"analytics"}))},i.prototype.updatePagePaneSections=function(){var e=this.getSelectedVisual(),i=this.$scope.viewModel;return i.pagePaneSections=[],e?void this.setActivePagePaneSection(void 0):(this.$scope.isEditing&&void 0!==i.activePageSection||this.setActivePagePaneSection(t.viewModels.PagePaneSectionType.Fields),i.pagePaneSections.push({sectionType:t.viewModels.PagePaneSectionType.Fields,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"}),void i.pagePaneSections.push({sectionType:t.viewModels.PagePaneSectionType.Format,displayName:this.services.localizationService.get("Format"),cssClass:"format"}))},i.prototype.updateHeader=function(){var e;if(this.$scope.populatePanes){var i=this.getSelectedVisual();if(i&&t.contracts.isVisualContainer(i)){var r=i.config.singleVisual.visualType;r===a.basicShape.name?e="VisualizationPane_Shape":r===a.image.name&&(e="VisualizationPane_Image")}e=e||"VisualizationPane_Title"}else e="VisualizationPane_Filters";this.$scope.viewModel.header=this.services.localizationService.get(e)},i.prototype.toggle=function(){this.$scope.viewModel.isPaneExpanded=!this.$scope.viewModel.isPaneExpanded,this.services.telemetryService.logEvent(e.telemetry.EXTogglePaneExpanded,"Visualization",this.$scope.viewModel.isPaneExpanded,t.util.getTelemetryViewMode(this.services.viewModeState.getMode()))},i.prototype.getSelectedVisual=function(){return s.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection)},i.prototype.toggleOutspacePaneVisibility=function(){var t=this;this.$scope.isOutspacePaneVisible=!this.$scope.isOutspacePaneVisible;var i=l.boolean(this.$scope.isOutspacePaneVisible),n=this.services.explorationNavigation.getCurrentExploration();this.services.undoRedo.register("ToggleOutspacePaneVisibility",(function(){void 0===n.objects&&(n.objects={}),r.setValue(n.objects,{objectName:"outspacePane",propertyName:"visible"},null,i),t.services.eventBridge.publishToChannel(o.explorationObjectsChanged)})),this.services.telemetryService.logEvent(e.telemetry.EXImprovedFilterExperienceToggleOutspacePaneVisibility,this.$scope.isOutspacePaneVisible)},i.prototype.onExplorationLoaded=function(){var e=this.services.explorationNavigation.getCurrentExploration();e&&this.updateUseNewFilterPaneSettings(e)},i.prototype.updateIsOutspacePaneVisible=function(t){var i=t&&t.outspacePane;this.$scope.isOutspacePaneVisible=this.$scope.useNewFilterPane&&e.DataViewObject.getValue(i,"visible",!0)},i.prototype.updateUseNewFilterPaneSettings=function(e){this.$scope.useNewFilterPane=e.settings&&e.settings.useNewFilterPaneExperience},i})();i.VisualizationPaneController=u})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.VisualizationPane={bindings:{viewModel:"<"},controller:e.common.createController(t.VisualizationPaneController),templateUrl:"components/visualizationPane/visualizationPane.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.CssConstants.createClassAndSelector,o=e.visuals.DataItemTooltip,n=t.contracts.VisualTooltip,a=r("data-item-tooltip-container"),s=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.pointerDownHandler=function(e){var t=e.originalEvent;t&&"touch"===t.pointerType&&(t.tooltip=!0)},this.canvasMask=new h(function(e,t){return i.canvasMaskTransit(e,t)})}return e.prototype.showCanvasSection=function(){return this.getTooltipType()===n.Canvas&&!this.contentSectionHidden},e.prototype.showDefaultSection=function(){return this.getTooltipType()===n.Default&&!this.contentSectionHidden},e.prototype.showLoadingSection=function(){return this.isLoadingDelayed&&this.getTooltipType()===n.Canvas},e.createOptions=function(){return{additionalServices:["$element"],scopedDependencies:[]}},e.prototype.$onChanges=function(e){if(this.contentSectionHidden=!1,e.tooltipData){e.tooltipShown&&e.tooltipShown.currentValue&&this.canvasMask.goto(l.Shown),this.updateView(e.tooltipData.currentValue)}(e.tooltipDataItems&&!e.tooltipDataItems.isFirstChange()||e.tooltipData&&!e.tooltipData.isFirstChange())&&this.updateDataItemTooltip(this.tooltipDataItems,this.tooltipData&&this.tooltipData.tooltipStyle,this.tooltipData&&this.tooltipData.discoverabilityText);
},e.prototype.$onInit=function(){this.tooltipData||(this.requestedTooltipType=n.Default),this.isLoading=!1;var e=this.services.$element.find(a.selector),t=this.dataItemTooltip=new o;e.append(t.create()),this.dataItemTooltip.update({items:this.tooltipDataItems,bounds:{height:window.innerHeight,width:window.innerWidth},style:this.tooltipData&&this.tooltipData.tooltipStyle,discoverabilityText:this.tooltipData&&this.tooltipData.discoverabilityText}),this.services.$element.on("pointerdown",this.pointerDownHandler)},e.prototype.$onDestroy=function(){this.subscriptionManager&&(this.subscriptionManager.unsubscribeAll(),this.subscriptionManager=null),this.services.$element.off("pointerdown",this.pointerDownHandler)},e.prototype.getTooltipType=function(){return this.requestedTooltipType},e.prototype.showChildMenu=function(e){this.contentSectionHidden=e},e.prototype.updateView=function(e){e||(e={filterContext:void 0,identities:void 0,sectionName:void 0,tooltipType:n.Default,tooltipStyle:void 0,discoverabilityText:void 0}),this.requestedTooltipType=this.explorationContract?e.tooltipType:n.Default,this.filterContext=e.filterContext,this.identities=e.identities,this.sectionName=e.sectionName,this.tooltipStyle=e.tooltipStyle,this.discoverabilityText=e.discoverabilityText},e.prototype.updateDataItemTooltip=function(e,t,i){this.dataItemTooltip.update({items:e,bounds:{height:window.innerHeight,width:window.innerWidth},style:t,discoverabilityText:i})},e.prototype.onCanvasReady=function(){this.canvasMask.accept(d.CanvasIdle),this.onMove&&this.onMove()},e.prototype.onCanvasBusy=function(){this.canvasMask.accept(d.CanvasBusy)},e.prototype.canvasMaskTransit=function(e,t){var i=this;switch(e){case l.Shown:this.isLoadingDelayed=!1,this.waitingToShowLoadingTimer&&(clearTimeout(this.waitingToShowLoadingTimer),this.waitingToShowLoadingTimer=void 0);break;case l.WaitingToShow:this.waitingToShowTimer&&(clearTimeout(this.waitingToShowTimer),this.waitingToShowTimer=void 0);break;case l.WaitingToHide:this.waitingToHideTimer&&(clearTimeout(this.waitingToHideTimer),this.waitingToHideTimer=void 0)}switch(t){case l.Shown:this.setIsLoading(!0),this.waitingToShowLoadingTimer=setTimeout((function(){i.waitingToShowLoadingTimer=void 0,i.isLoadingDelayed=!0}),p);break;case l.WaitingToShow:this.waitingToShowTimer=setTimeout((function(){i.waitingToShowTimer=void 0,i.canvasMask.accept(d.WaitingToShowElapsed)}),c);break;case l.Hidden:this.setIsLoading(!1);break;case l.WaitingToHide:this.waitingToHideTimer=setTimeout((function(){i.waitingToHideTimer=void 0,i.canvasMask.accept(d.WaitingToHideElapsed)}),u)}},e.prototype.setIsLoading=function(e){this.isLoading=e,this.scope.$applyAsync()},e})();i.VisualTooltipController=s;var l,c=50,u=50,p=1e3;!(function(e){e[e.Hidden=0]="Hidden",e[e.WaitingToShow=1]="WaitingToShow",e[e.Shown=2]="Shown",e[e.WaitingToHide=3]="WaitingToHide"})(l=i.CanvasMaskState||(i.CanvasMaskState={}));var d;!(function(e){e[e.CanvasBusy=0]="CanvasBusy",e[e.CanvasIdle=1]="CanvasIdle",e[e.WaitingToShowElapsed=2]="WaitingToShowElapsed",e[e.WaitingToHideElapsed=3]="WaitingToHideElapsed"})(d=i.CanvasMaskEvent||(i.CanvasMaskEvent={}));var h=(function(){function e(e,t){void 0===t&&(t=l.Hidden),this.transit=e,this.state=t}return e.prototype.goto=function(e){var t=this.state;t!==e&&(this.transit(t,e),this.state=e)},e.prototype.accept=function(e){var t=this.state;switch(t){case l.Hidden:switch(e){case d.CanvasBusy:t=l.WaitingToShow;break;case d.CanvasIdle:break;case d.WaitingToHideElapsed:case d.WaitingToShowElapsed:}break;case l.WaitingToShow:switch(e){case d.CanvasBusy:break;case d.CanvasIdle:t=l.Hidden;break;case d.WaitingToShowElapsed:t=l.Shown;break;case d.WaitingToHideElapsed:}break;case l.Shown:switch(e){case d.CanvasBusy:break;case d.CanvasIdle:t=l.WaitingToHide;break;case d.WaitingToShowElapsed:case d.WaitingToHideElapsed:}break;case l.WaitingToHide:switch(e){case d.CanvasBusy:t=l.Shown;break;case d.CanvasIdle:break;case d.WaitingToShowElapsed:break;case d.WaitingToHideElapsed:t=l.Hidden}}this.goto(t)},e})();i.CanvasMaskStateMachine=h})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.VisualTooltip={templateUrl:"components/visualTooltip/visualTooltip.html",controller:e.common.createController(t.VisualTooltipController),bindings:{explorationContract:"<",explorationCapabilities:"<",onHide:"&",onMove:"&?",showActionBar:"<",tooltipData:"<",tooltipDataItems:"<",tooltipDataSources:"<",tooltipShown:"<",actionsProvider:"<",sectionDisplayOption:"<?"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t){return new a(e,t)}function r(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function o(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}var n=e.util.CanvasVisualsUtility;t.createCanvasLayout=i;var a=(function(){function e(e,t){this.canvasScale=e,this.options=t,this.items=[]}return e.prototype.registerLayoutItem=function(e){var t=this;return this.items.push(e),{onDragStart:function(i){return t.dragStart(e,i)},onDragMove:function(i){return t.dragMove(e,i)},onDragEnd:function(i){return t.dragEnd(e,i)},onNudge:function(i,r){return t.nudge(e,i,r)},onResizeStart:function(i){return t.resizeStart(e,i)},onResizeMove:function(i){return t.resizeMove(e,i)},onResizeEnd:function(i){return t.resizeEnd(e,i)},getIntermediateDimensions:function(i){return t.getIntermediateDimensions(e,i)}}},e.prototype.unregisterLayoutItem=function(e){_.pull(this.items,e)},e.prototype.dragEnd=function(e,t){this.canProcess(e)&&(e.dragEnd(this.getNormalizedPosition(e,t)),this.strategy.onDragEnd&&this.strategy.onDragEnd(),this.options&&this.options.onDragEnd&&this.options.onDragEnd(e,t))},e.prototype.dragStart=function(e,t){this.canProcess(e)&&(this.strategy.onDragStart&&this.strategy.onDragStart(),t=this.getIntermediateDimensions(e,t),e.dragStart(t),this.options&&this.options.onDragStart&&this.options.onDragStart(e,t))},e.prototype.dragMove=function(e,t){this.canProcess(e)&&this.options&&this.options.onDragMove&&this.options.onDragMove(e,t)},e.prototype.nudge=function(e,t,i){this.canProcess(e)&&e.nudge(this.getNormalizedPosition(e,t,i))},e.prototype.resizeStart=function(e,t){this.canProcess(e)&&(this.strategy.onResizeStart&&this.strategy.onResizeStart(r(t)),t=this.getIntermediateDimensions(e,t),e.resizeStart(t))},e.prototype.resizeMove=function(e,t){this.canProcess(e)&&(t=this.getIntermediateDimensions(e,t),e.resizeMove(t))},e.prototype.resizeEnd=function(e,t){this.canProcess(e)&&(e.resizeEnd(this.getNormalizedPosition(e,t)),this.strategy.onResizeEnd&&this.strategy.onResizeEnd())},e.prototype.setStrategy=function(e){this.strategy=e},e.prototype.setCanvasSize=function(e){this.canvasSize=e},e.prototype.getDropPosition=function(e,t,i){var r=i;if(!r){var o=this.canvasScale.getDisplayAreaScaleFactor();r={x:o,y:o}}return this.strategy.getNearestDropPosition({item:null,allItems:this.items,rawItemPosition:{left:e,top:t,width:0,height:0},canvasSize:this.canvasSize,canvasScale:r})},e.prototype.getNextFreePosition=function(){var e=this.canvasScale.getDisplayAreaScaleFactor(),t={x:e,y:e};return this.strategy.getNearestDropPosition({item:null,allItems:this.items,rawItemPosition:{left:0,top:0,width:0,height:0},canvasSize:this.canvasSize,canvasScale:t,getNextFree:!0})},e.prototype.getIntermediateDimensions=function(e,t){if(this.strategy.isEnforcedForIntermediateStates()){var i=r(this.getScaledPosition(e,t));return o(this.strategy.getHostRectFromScaled(i))}return t},e.prototype.getScaledPosition=function(e,t,i){var a=e.getScale(),s={x:!_.isFinite(t.x),y:!_.isFinite(t.y),width:!_.isFinite(t.width),height:!_.isFinite(t.height)},l=e.getPosition(),c=n.convertToScaledPosition(l,a,!1);if(s.x||s.y||s.width||s.height){var u=this.strategy.getHostRectFromScaled(r(c));t=__assign({},t),s.x&&(t.x=u.left),s.y&&(t.y=u.top),s.width&&(t.width=u.width),s.height&&(t.height=u.height)}var p=r(t),d=this.strategy.getNearestValidPosition({item:e,allItems:this.items,canvasSize:this.canvasSize,canvasScale:a,rawItemPosition:p,nudge:i});return d?o(d):c},e.prototype.getNormalizedPosition=function(e,t,i){var a=this.getScaledPosition(e,t,i);return o(n.convertFromScaledRect(r(a),e.getScale()))},e.prototype.canProcess=function(e){return!!e&&!e.isSuspended()&&_.includes(this.items,e)},e})();t.CanvasLayout=a})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){var n=i(e,o);return{width:l(r,n.width,o.colSpacing),height:l(t,n.height,o.rowSpacing)}}function i(e,t){var i=t.cols,r=t.rows,o=t.rowSpacing,n=t.colSpacing,a=n*(i+1),s=o*(r+1),l=Math.floor((e.width-a)/i),c=Math.floor((e.height-s)/r);return{width:l,height:c}}function r(e,t,r){for(var o=i(e,t),n=t.cols,a=t.rows,s=t.rowSpacing,l=t.colSpacing,c=r.width,u=r.height,p=o.width,d=o.height,h=Math.ceil(c/(p+l)),v=Math.ceil(u/(d+s)),g=[],f=0,y=0;y<=a-v;++y){f+=s;for(var m=0,C=0;C<=n-h;++C)m+=l,g.push({left:m,top:f,width:c,height:u}),m+=p;f+=d}return g}function o(e,t,i,r){return[n(t,e,r),i]}function n(e,t,r){var o=i(t,e),n=e.rowSpacing,l=e.colSpacing,c=o.width,u=o.height;return{left:a(r.left,c,l),top:a(r.top,u,n),width:s(r.width,c,l),height:s(r.height,u,n)}}function a(e,t,i){var r=e+t/2;return r-=1,c(Math.floor(r/(t+i)),t,i)}function s(e,t,i){var r=e+t/2+i,o=Math.floor(r/(t+i));return o=Math.max(1,o),l(o,t,i)}function l(e,t,i){return e*t+Math.max(0,e-1)*i}function c(e,t,i){return e*t+e*i+i}e.getSpanSize=t,e.getCellSize=i,e.getAllSlots=r,e.getAllResizeSlots=o})(t=e.CanvasLayoutGrid||(e.CanvasLayoutGrid={}))})(t=e.canvas||(e.canvas={}))})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r;!(function(i){function r(e,t,i,r){if(void 0===r&&(r=!1),!r){var n=_.chain(i).without(t).map((function(e){return a.visualPositionToRect(e.getPosition())})).value();_.remove(e,(function(e){return _.some(n,(function(t){return o(t,e)}))}))}return e}function o(e,t){return!(t.left>=e.left+e.width||e.left>=t.left+t.width||t.top>=e.top+e.height||e.top>=t.top+t.height)}function n(e,t){return l.getDistance(c.getCentroid(e),c.getCentroid(t))}var a=t.util.CanvasDisplayUtility,s=t.util.CanvasVisualsUtility,l=e.visuals.shapes.Point,c=e.visuals.shapes.Rect,u=(function(){function e(e,t,i){void 0===t&&(t={width:3,height:3}),void 0===i&&(i=!1),this.options=e,this.defaultNewCellSize=t,this.enableGridVisualOverlaying=i}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=c.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=c.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(e){var t=e.rawItemPosition,i=this.options.offset;i&&(t=c.add(e.rawItemPosition,i));var r,o=s.convertFromScaledRect(t,e.canvasScale),l=!1;e.item&&(r=a.visualPositionToRect(e.item.getPosition()),l=o.width!==r.width||o.height!==r.height);var u,p;if(l)u=this.getAvailableResizeRects(e.item,e.allItems,e.canvasSize,r,o,this.enableGridVisualOverlaying),p=u[0];else{if(u=this.getAvailableRects(e.item,e.allItems,e.canvasSize,o,this.enableGridVisualOverlaying),_.isEmpty(u))return;p=_.minBy(u,(function(e){return n(e,o)}))}if(p)return s.convertToScaledRect(p,e.canvasScale)},e.prototype.getNearestDropPosition=function(e){var t=i.CanvasLayoutGrid.getSpanSize(e.canvasSize,this.defaultNewCellSize.width,this.defaultNewCellSize.height,this.options);if(e.getNextFree){return this.getAvailableRects(e.item,e.allItems,e.canvasSize,{left:0,top:0,width:t.width,height:t.height})[0]}var r=c.getCentroid(e.rawItemPosition);this.options.offset&&(r.x-=this.options.offset.left,r.y-=this.options.offset.top),r.x/=e.canvasScale.x,r.y/=e.canvasScale.y;var o=this.defaultNewCellSize.width,a=this.defaultNewCellSize.height,s=function(){t=i.CanvasLayoutGrid.getSpanSize(e.canvasSize,o,a,l.options);var s={left:r.x-t.width/2,top:r.y-t.height/2,width:t.width,height:t.height},u=l.getAvailableRects(e.item,e.allItems,e.canvasSize,s,l.enableGridVisualOverlaying);return _.isEmpty(u)||(_.remove(u,(function(e){return!c.containsPoint(e,r)})),_.isEmpty(u))?(--o,void--a):{value:_.minBy(u,(function(e){return n(e,s)}))}},l=this;do{var u=s();if("object"==typeof u)return u.value}while(o>=1&&a>=1)},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e.prototype.getAvailableRects=function(e,t,o,n,a){return void 0===a&&(a=!1),r(i.CanvasLayoutGrid.getAllSlots(o,this.options,n),e,t,a)},e.prototype.getAvailableResizeRects=function(e,t,o,n,a,s){return void 0===s&&(s=!1),r(i.CanvasLayoutGrid.getAllResizeSlots(o,this.options,n,a),e,t,s)},e})();i.CanvasLayoutGridStrategy=u,i.isIntersecting=o})(r=i.canvas||(i.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){function i(e,t){if(!e.visual.canvas)return{};var i={};return i.canvas=!0,c.hasFlag(t,1)&&(i.left=!0),c.hasFlag(t,2)&&(i.center=!0),c.hasFlag(t,4)&&(i.right=!0),i}function r(e,t){var i=_.minBy(t,(function(t){return Math.abs(t.newLeftPosition-e.left)}));return{offset:i.newLeftPosition-e.left,newLeftPosition:i.newLeftPosition,distance:Math.abs(i.newLeftPosition-e.left),aligments:i.alignments}}function o(e,t,i){function r(e,t,i){o[e]||(o[e]={newLeftPosition:e,alignments:[]});var r=_.last(o[e].alignments);r&&r.visual===t?r.snappedToVisualPoints|=i:o[e].alignments.push({visual:t,snappedToVisualPoints:i})}for(var o={},n=0,a=t;n<a.length;n++){var s=a[n],l=s.left+s.width;if(c.hasFlag(i,4)&&(r(s.left-e.width,s,1),r(s.horizontalCenter-e.width,s,2),r(l-e.width,s,4)),c.hasFlag(i,2)){var u=e.horizontalCenter-e.left;r(s.left-u,s,1),r(s.horizontalCenter-u,s,2),r(l-u,s,4)}c.hasFlag(i,1)&&(r(s.left,s,1),r(s.horizontalCenter,s,2),r(l,s,4))}return _.values(o)}function n(e){return s(__assign({},e,{verticalCenter:e.top+e.height/2,horizontalCenter:e.left+e.width/2}))}function a(e){var t=e.getPosition(),i=e.getScale(),r=e.getOffsetFromGroup();return n({top:(t.y+r.top)*i.y,left:(t.x+r.left)*i.x,width:t.width*i.x,height:t.height*i.y})}function s(e){return{canvas:e.canvas,top:Math.round(e.top),left:Math.round(e.left),width:Math.round(e.width),height:Math.round(e.height),verticalCenter:Math.round(e.verticalCenter),horizontalCenter:Math.round(e.horizontalCenter)}}function l(e){return{canvas:e.canvas,top:e.left,left:e.top,width:e.height,height:e.width,horizontalCenter:e.verticalCenter,verticalCenter:e.horizontalCenter}}var c=jsCommon.EnumExtensions,u=e.visuals.shapes.Rect;t.smartGuideSnappingDistance=6,t.smartGuidePadding=6;var p=".smartguidestrategy",d=(function(){function s(e,t,i){this.baseStrategy=e,this.selectionService=t,this.guidesViewModel=i}return s.prototype.onDragStart=function(){this.draggingMultipleVisuals=this.selectionService.getSelectedElements().length>1,this.onStart()},s.prototype.onDragEnd=function(){this.draggingMultipleVisuals=void 0,this.onEnd()},s.prototype.onResizeStart=function(e){this.resizing=!0,this.initialResizeDimensions=n(this.getScaledRectFromHost(__assign({},e))),this.onStart()},s.prototype.onResizeEnd=function(){this.resizing=!1,this.initialResizeDimensions=void 0,this.onEnd()},s.prototype.getScaledRectFromHost=function(e){return this.baseStrategy.getScaledRectFromHost(e)},s.prototype.getHostRectFromScaled=function(e){return this.baseStrategy.getHostRectFromScaled(e)},s.prototype.getNearestValidPosition=function(e){return this.paused||e.nudge||this.draggingMultipleVisuals?this.baseStrategy.getNearestValidPosition(e):(e.rawItemPosition=this.alignObject(e),this.baseStrategy.getNearestValidPosition(e))},s.prototype.getNearestDropPosition=function(e){return this.baseStrategy.getNearestDropPosition(e)},s.prototype.isEnforcedForIntermediateStates=function(){return!0},s.prototype.onEnd=function(){this.removeKeyListeners(),this.guidesViewModel.guides=[]},s.prototype.onStart=function(){this.addKeyListeners()},s.prototype.addKeyListeners=function(){var e=this,t=function(e){if(18===e.keyCode)return e.stopPropagation(),e.preventDefault(),!0};$(window).on("keydown"+p,(function(i){t(i)&&(e.paused=!0,e.guidesViewModel.guides=[])})),$(window).on("keyup"+p,(function(i){t(i)&&(e.paused=!1)}))},s.prototype.removeKeyListeners=function(){$(window).off(p)},s.prototype.alignObject=function(t){this.guidesViewModel.guides=[];var i=t.item?t.item.getOffsetFromGroup():new e.visuals.Rect,r=u.add(__assign({},t.rawItemPosition),i),o=n(this.getScaledRectFromHost(r)),s=_.chain(t.allItems).filter((function(e){return e!==t.item})).map((function(e){return a(e)})).value(),l=t.canvasScale,c=t.canvasSize;s.push(n({left:0,width:c.width*l.x,top:0,height:c.height*l.y,canvas:!0})),this.resizing?this.alignResize(o,s):this.alignDrag(o,s);var p=this.getHostRectFromScaled({top:o.top,left:o.left,width:o.width,height:o.height});return u.subtract(p,i)},s.prototype.alignDrag=function(e,i){var n,a,s=r(e,o(e,i,7)),c=s.distance<=t.smartGuideSnappingDistance;c&&(e.left+=s.offset);var u=l(e),p=i.map((function(e){return l(e)})),d=r(u,o(u,p,7)),h=d.distance<=t.smartGuideSnappingDistance;if(h&&(e.top+=d.offset,u.left+=d.offset),c&&(n=this.guidesViewModel.guides).push.apply(n,this.createVerticalGuides(e,s.aligments)),h){var v=this.createVerticalGuides(u,d.aligments);(a=this.guidesViewModel.guides).push.apply(a,v.map((function(e){return{top:e.left,left:e.top,width:e.height,class:e.class}})))}},s.prototype.alignResize=function(e,t){var i,r;if(!_.isEqual(e,this.initialResizeDimensions)){var o=this.alignResizeLeftRight(this.initialResizeDimensions,e,t);(i=this.guidesViewModel.guides).push.apply(i,o);var n=l(e),a=l(this.initialResizeDimensions),s=t.map((function(e){return l(e)})),c=this.alignResizeLeftRight(a,n,s);if(!_.isEmpty(c)){var u=l(n);e.top=u.top,e.height=u.height,(r=this.guidesViewModel.guides).push.apply(r,c.map((function(e){return{left:e.top,top:e.left,width:e.height,class:e.class}})))}}},s.prototype.alignResizeLeftRight=function(e,i,n){var a=i.left===e.left&&i.width!==e.width,s=i.left!==e.left;if(!s&&!a)return[];var l=s?1:4,c=r(i,o(i,n,l));return c.distance<=t.smartGuideSnappingDistance?(s?(i.width-=c.offset,i.left=c.newLeftPosition):i.width+=c.offset,this.createVerticalGuides(i,c.aligments)):[]},s.prototype.createVerticalGuides=function(e,r){function o(t,r,o){n[t]||(n[t]={left:t,top:e.top,bottom:e.top+e.height,classes:{}}),n[t].top=Math.min(n[t].top,r.visual.top),n[t].bottom=Math.max(n[t].bottom,r.visual.top+r.visual.height),n[t].classes=_.assign(n[t].classes,i(r,o))}for(var n={},a=0,s=r;a<s.length;a++){var l=s[a],u=c.hasFlag(l.snappedToVisualPoints,1),p=c.hasFlag(l.snappedToVisualPoints,4);u&&o(l.visual.left,l,1),p&&o(l.visual.left+l.visual.width,l,4),(!u&&!p||l.visual.canvas)&&c.hasFlag(l.snappedToVisualPoints,2)&&o(l.visual.horizontalCenter,l,2)}var d=[];for(var h in n){var v=n[h],g=v.top,f={top:g,left:v.left,width:1,height:v.bottom-g};d.push({top:f.top-t.smartGuidePadding,left:f.left,height:f.height+2*t.smartGuidePadding,class:Object.keys(v.classes).join(" ")})}return d},s})();t.SmartGuideStrategy=d})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.visuals.shapes.Rect,o=(function(){function e(e,t){this.offset=e,this.layoutAuthoring=t}return e.prototype.getScaledRectFromHost=function(e){return r.add(e,this.offset)},e.prototype.getHostRectFromScaled=function(e){return r.subtract(e,this.offset)},e.prototype.getNearestValidPosition=function(e){return r.add(e.rawItemPosition,this.offset)},e.prototype.getNearestDropPosition=function(e){var t={x:e.rawItemPosition.left+e.rawItemPosition.width/2,y:e.rawItemPosition.top+e.rawItemPosition.height/2};t.x-=this.offset.left,t.y-=this.offset.top,t.x/=e.canvasScale.x,t.y/=e.canvasScale.y;var r=_.map(e.allItems,(function(e){return i.visualPositionToRect(e.getPosition())}));return _.isEmpty(r)&&(t.x-=i.DefaultVisualPosition.width/2,t.y-=i.DefaultVisualPosition.height/2),this.layoutAuthoring.getLayoutForNewVisualContainerWithRects(r,t,e.canvasSize)},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e})();t.DefaultLayoutStrategy=o})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.explore.util.DotGridUtil,o=e.visuals.shapes.Rect,n=e.common.controllers.TransformNudgeDirection,a=(function(){function t(e){this.options=e}return t.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=o.add(e,t)),e},t.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=o.subtract(e,t)),e},t.prototype.getNearestValidPosition=function(i){var r=o.add(i.rawItemPosition,this.options.offset),a=i.canvasScale;if(i.nudge&&i.item){var s=i.item.getPosition(),l=s.x,c=s.y;i.nudge.direction===n.Left||i.nudge.direction===n.Right?l=t.applyNudge(l,this.options.layoutX.UnitDivisions,i.nudge.direction===n.Left,i.nudge.bigNudge):i.nudge.direction!==n.Up&&i.nudge.direction!==n.Down||(c=t.applyNudge(c,this.options.layoutY.UnitDivisions,i.nudge.direction===n.Up,i.nudge.bigNudge)),r.left=l*a.x,r.top=c*a.y}var u=this.getNearestUnscaledGridRect(r,a,i.item?i.item.getOffsetFromGroup():new e.visuals.Rect);return{left:u.left*a.x,top:u.top*a.y,width:u.width*a.x,height:u.height*a.y}},t.applyNudge=function(e,t,i,o){e=Math.round(e);var n=o?r.CanvasLayout.UnitLength:r.CanvasLayout.UnitLength/t,a=n*(i?Math.floor:Math.ceil)(e/n);return a===e&&(a+=i?-n:n),a},t.prototype.getNearestDropPosition=function(t){var r=o.getCentroid(t.rawItemPosition);r.x-=this.options.offset.left,r.y-=this.options.offset.top,r.x/=t.canvasScale.x,r.y/=t.canvasScale.y;var n=_.map(t.allItems,(function(e){return o.add(i.visualPositionToRect(e.getPosition()),e.getOffsetFromGroup())}));_.isEmpty(n)&&(r.x-=i.DefaultVisualPosition.width/2,r.y-=i.DefaultVisualPosition.height/2);var a=t.item?t.item.getOffsetFromGroup():new e.visuals.Rect;r.x+=a.left,r.y+=a.top;var s=this.options.layoutAuthoring.getLayoutForNewVisualContainerWithRects(n,r,t.canvasSize);return s=o.subtract(s,a),s=this.getNearestUnscaledGridRect(s,{x:1,y:1},t.item?t.item.getOffsetFromGroup():new e.visuals.Rect)},t.prototype.getNearestUnscaledGridRect=function(e,i,r){var o=this.getNearestUnscaledGridPoint({x:e.left,y:e.top},i),n=this.getNearestUnscaledGridPoint({x:e.left+e.width,y:e.top+e.height},i),a=this.options.limits;if(a){var s=t.limitAdjustment(o.x,n.x,a.left-r.left,a.width);0!==s&&(o.x+=s,n.x+=s);var l=t.limitAdjustment(o.y,n.y,a.top-r.top,a.height);0!==l&&(o.y+=l,n.y+=l)}return{left:o.x,top:o.y,width:n.x-o.x,height:n.y-o.y}},t.limitAdjustment=function(e,t,i,r){if(e<i)return i-e;var o=i+r;return t>o?o-t:0},t.prototype.getNearestUnscaledGridPoint=function(e,i){return{x:t.getNearestUnscaledGridCoordinate(this.options.layoutX,e.x,i.x),y:t.getNearestUnscaledGridCoordinate(this.options.layoutY,e.y,i.y)}},t.getNearestUnscaledGridCoordinate=function(e,t,i){var o=t/i,n=r.CanvasLayout.UnitLength/e.UnitDivisions;return Math.round(o/n)*n},t.prototype.isEnforcedForIntermediateStates=function(){return!0},t})();t.DotGridLayoutStrategy=a})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.$scope=e,this.errorService=this.$scope.errorService,this.modalDialog=this.errorService.control(),this.$scope.deleteVisual=function(){return t.deleteVisual()},this.$scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.deleteVisual=function(){this.closeDialog(),this.$scope.deleteVisualService.deleteCustomVisuals(this.$scope.explorationContract,this.$scope.customVisuals)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.DeleteVisualWarningDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){var r=this;this.services=i,this.$scope=t,this.errorService=this.services.errorService,this.modalDialog=this.errorService.control(),this.$scope.acceptTermsOfService=function(){return r.notifyConsentChanged(!0)},this.$scope.rejectTermsOfService=function(){return r.notifyConsentChanged(!1)},this.$scope.learnMoreLink=e.models.EsriLearnMoreUrl,this.$scope.byClickingText=this.services.localizationService.format("EsriConsentDialog_ByClicking",['<a href="https://go.microsoft.com/fwlink/?LinkID=826322" target="_blank">'+this.services.localizationService.get("Terms")+"</a>",'<a href="https://go.microsoft.com/fwlink/?LinkID=826323" target="_blank">'+this.services.localizationService.get("PrivacyPolicy")+"</a>"])}return t.createOptions=function(){return{additionalServices:["errorService","localizationService"]}},t.createAndShowEsriConsentDialog=function(t,i,r,o){var n=t.defer(),a=i.$new(!0);a.errorService=r,a.esriConsentDialogCallback=function(t){n.promise.then((function(){return i.$emit(e.explore.constants.trustedVisualConsentStateChangedEventName)})),n.resolve(t)};var s={dialogName:void 0,isDismissable:!0,scope:a,template:"<esri-consent-dialog></esri-consent-dialog>",dialogCssClass:"esriConsentDialog"};return o.showLegacyWebModalDialog(s),n.promise},t.prototype.notifyConsentChanged=function(e){this.closeDialog(),this.$scope.esriConsentDialogCallback(e)},t.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},t})();t.EsriConsentDialogController=i})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.$scope=e,this.services=t,this.$scope.eventBridge=this.services.eventBridge,this.$scope.schemaItemActivationService=this.services.schemaItemActivation}return e.createOptions=function(){return{scopedDependencies:["eventBridge","schemaItemActivation"]}},e})();e.ModelingContextChangerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)?"":e.length>=260?t.get("ReportAppBar_SaveError_TooLong"):null}function i(e,i,r,o,n){var a=$.Deferred();n=n||i.get("ModalDialog_Save");var s=e.control();o=o||i.get("ReportAppBar_SaveAsDialogInstructions");var l='<div class="content"><label class="message instructions" for="explorationSaveAsName"></label><input type="text" id="explorationSaveAsName" class="explorationSaveAsName" /><div class="errorMessage"></div></div>',c=$(l);c.find(".message").text(o);var u=c.find(".explorationSaveAsName"),p=[new InJs.ModalDialogAction(n,function(e,t){var i=jsCommon.StringExtensions.trimWhitespace(u.val());s.hideDialog(),a.resolve(i)}),new InJs.ModalDialogAction(i.get("ModalDialog_Cancel"),function(e,t){s.hideDialog(),a.reject()})];return r=r||i.get("ReportAppBar_SaveAsDialogTitle"),s.showCustomDialog(r,c,p,(function(e){e.parent().find('input[value = "'+n+'"]').prop("disabled",!0),u.focus().on("change keyup paste mouseup",(function(r){var o=t($(r.target).val(),i);e.parent().find('input[value = "'+n+'"]').prop("disabled",null!==o),e.parent().find(".errorMessage").text(o)})).on("keyup",(function(e){13===e.which&&null===t($(e.target).val(),i)?p[0].actionCallback(null,null,null):27===e.which&&p[1].actionCallback(null,null,null)}))}),!0,null,null,null,null,null,null,null,null,null,null,!0),a}e.validateReportName=t,e.showSaveAsDialog=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){for(var i=v.filterTransient(t),r=v.filterTransient(e),n=i.length-1;n>=0;n--){var a=i[n],s=r[n];a.id=s.id,a.objectId=s.objectId,o(a.visualContainerGroups,s.visualContainerGroups)}}function o(e,i){for(var r=e.length-1;r>=0;r--){var n=e[r],a=i[r];n.id=a.id,t.contracts.isVisualContainerGroup(n)&&t.contracts.isVisualContainerGroup(a)&&o(n.children,a.children)}}function n(e,t){if(e&&e.sections){var i=e.sections,r=_.findIndex(i,(function(e){return e.name===t}));return r!==-1?r:void 0}}function a(e,t){if(!e||!e.sections)return-1;var i=e.sections;return _.findIndex(i,(function(e){return e===t}))}function s(e,t){return e&&e.sections?h.findWithId(e.sections,t):null}function l(e,t){if(!e||!e.sections)return-1;var i=e.sections;return _.findIndex(i,(function(e){return e.id===t}))}function c(e,t){for(var i=1,r=t.format("Explore_Section_Page",[i.toFixed()]);_.findLastIndex(e,(function(e){return e.displayName===r}))>=0;)r=t.format("Explore_Section_Page",[(++i).toFixed()]);return r}function u(e,t){for(var i=e.sections,r=0,o=i;r<o.length;r++){var n=o[r];n.displayName||(n.displayName=c(e.sections,t))}}function p(e){return _.filter(e,(function(e){return!d(e)}))}function d(e){return!!(1&e.visibility)}var h=jsCommon.ArrayExtensions,v=e.explore.contracts.Section;i.synchronizeSectionsIds=r,i.findSectionIndexForSectionName=n,i.findSectionIndexForSection=a,i.findSectionById=s,i.findSectionIndexForSectionId=l,i.getNextSectionDisplayNameWithIndex=c,i.fillDefaultSectionDisplayNames=u,i.getVisibleSections=p,i.isSectionHidden=d})(i=t.SectionUtils||(t.SectionUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(e,t){this.modalDialogService=e,this.localizationService=t}return i.prototype.show=function(i,r,o,n,a,s,l){var c=t.viewModels.ExportDataDialogViewModelFactory.create(this.localizationService,i,r,o,n,a,s,l),u={viewModel:c},p={dialogName:"ExportDataDialog",definitionTemplateCachePath:"dialogs/exportDataDialog/exportDataDialogDefinition.html",bindings:u,lazyModuleDependencies:[e.explore.modules.ExploreUIDialogsModule]};return this.modalDialogService.showWebModalDialog(p)},i})();i.ExportDataDialogBuilder=r})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){this.modalDialogService=e}return t.prototype.show=function(){var t={bindings:void 0,definitionTemplateCachePath:"dialogs/hotkeyDialog/hotkeyDialogDefinition.html",dialogName:"HotkeyDialog",lazyModuleDependencies:[e.explore.modules.ExploreUIDialogsModule]};return this.modalDialogService.showHostModalDialog(t)},t})();t.HotkeyDialogBuilder=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){this.modalDialogService=e}return t.prototype.show=function(t,i,r,o,n){var a={config:{titleText:i,messageText:r,okButtonText:o,learnMoreLink:n}},s={dialogName:t,definitionTemplateCachePath:"dialogs/learnMoreDialog/learnMoreDialogDefinition.html",bindings:a,lazyModuleDependencies:[e.explore.modules.ExploreUIDialogsModule]};return this.modalDialogService.showHostModalDialog(s)},t})();t.LearnMoreDialogBuilder=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.require="ngModel",this.restrict="E",this.scope={validators:"=",placeholder:"<",inputType:"@",labelId:"<?",isDisabled:"<?"},this.templateUrl="views/inputFields/propertyPaneTextBox.html",this.link=function(e,i,r,o){o.$render=function(){e.sliceValue=o.$viewValue},e.maxLength=e.validators&&e.validators.url?2048:250,e.onKeydown=function(e){e.which===$.ui.keyCode.DELETE&&e.stopPropagation();
},e.onChange=function(){e.inputForm&&!e.inputForm.$invalid&&o.$setViewValue(e.sliceValue)},e.getErrorMessage=function(){var i,r=e.inputForm.$error;return r&&(r.decimal||r.number?i=t.localizationService.get("Validation_NotANumber"):r.min?i=t.localizationService.get("Validation_NumberBelowMin"):r.max?i=t.localizationService.get("Validation_NumberAboveMax"):r.integer?i=t.localizationService.get("Validation_NumberNotInteger"):r.required?i=t.localizationService.get("Validation_Empty"):r.url&&(i=t.localizationService.get("Validation_NotAUrl"))),{tooltipDescription:i,tooltipDisable:_.isEmpty(r)}}},this.localizationService=e}return e})();e.PropertyPaneTextBox=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.DeleteVisualWarningDialogController),this.templateUrl="views/deleteVisualWarningDialog.html"}return i})();i.DeleteVisualWarningDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.EsriConsentDialogController),this.templateUrl="views/esriConsentDialog.html"}return i})();i.EsriConsentDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(i,r,H){function G(){return 1===xe.getMode()}function U(){return 0!==ye.getCurrentLayout()&&G()}function j(){return Y&&0===ye.getCurrentLayout()}function X(){r.highContrastCssGenerationService.addRule(".themeableElement .canvasBackdrop","{ background-color: @foregroundColor !important; }")}function Q(){return 0!==ye.getCurrentLayout()&&G()}function W(){return a.getAutoLayoutVisualVCHeader(ye,ve)}function q(){var e=ge.getCurrentExploration(),t=e&&e.evaluatedObjects&&e.evaluatedObjects.outspacePane&&e.evaluatedObjects.outspacePane.expanded;return void 0===t||t}function K(){return ve.getCapabilities().showFluentDesign&&0===xe.getMode()}var Z,J,Y,ee,te,ie,re,oe,ne,ae,se=C.DefaultCanvasUiScale,le=!1,ce=null,ue={width:0,height:0},pe=new E,de=r.canvasScale,he=r.eventBridge,ve=r.explorationCapabilities,ge=r.explorationNavigation,fe=r.featureSwitchService,ye=r.formFactor,me=r.layoutAuthoring,Ce=r.selection,Se=r.settingsService,we=r.telemetryService,be=r.themeService,xe=r.viewModeState,Ee=r.visibility,Fe=he.createChannelSubscriptionManager(),Ve=!1;r.visualPlugin.ensureBuiltInPlugins().then((function(){Ve=!0}));var Pe={autoLayoutVisualPadding:C.AutoLayoutVisualPadding,scrollbarOffset:C.ScrollbarOffset};return new(function(){function E(){var e=this;this.filterPaneScaledWidth=C.DefaultOutspacePaneWidth,this.calculatePrintStyles=function(e){var t=ie.viewModeState.getConfig().printProperties,i=e.width()+t.containerPixelPadding,r=e.height(),o=d.getPrintTargetViewPort(e);if(!t.useSectionDisplayOption||0===ie.canvasScale.getDisplayOption()){var n=e.find("transform.visualContainerTransform");if(n.length>0){var a=0,s=0;n.each((function(e,t){var i=$(t),r=i.position(),o=Math.max(0,r.left),n=Math.max(0,r.top);a=Math.max(a,o+i.width()),s=Math.max(s,n+i.height())}));var l=d.calculateScaleFactor({width:i,height:r},{width:a,height:s},!0);i*=l,r*=l}}var c=d.calculateScaleFactor({width:i,height:r},o),u=i*c,p=r*c,h=(o.width-u)/2,v=(o.height-p)/2;return{width:i+"px !important",height:r+"px !important",transform:"translate("+h+"px, "+v+"px) scale("+c+") !important","-webkit-transform":"translate("+h+"px, "+v+"px) scale("+c+") !important","transform-origin":"left top !important","-webkit-transform-origin":"left top !important",left:"auto !important",top:"auto !important",right:"auto !important",bottom:"auto !important",margin:"0 !important"}},this.disableAnimations=!0,ie={canvasScale:de,viewModeState:xe,formFactor:ye,eventBridge:he,explorationCapabilities:ve},J=Se.getShowGridlines(),Y=Se.getSnapToGrid(),this.dropConfig={accept:f.Field+" "+f.VisualContainerThumbnail},re=!1,this.isOutspacePaneVisible=!1,this.outspaceBackground={},this.canvasBackground={},this.subscribeToEvents(),pe.add(A,(function(){return e.size}),(function(t){if(t){var i=de.getDisplayOption();e.useResponsiveLayout=t.width<=C.ResponsiveLayoutMaxWidthBreakpoint&&e.viewModel&&e.viewModel.contract&&0===i,e.updateSize(),e.evaluateObjects(),e.resetThemableProperties(),he.publishToChannel(m.canvasSizeChangedEvent)}}));var i={onDragStart:function(e,t){Z={x:t.x,y:t.y,width:t.width,height:t.height},le=!0},onDragMove:function(t,i){r.ngZone.run((function(){return e.moveSelectedContainersWrapper(i)}))}};this.layout=t.controllers.createCanvasLayout(de,i);var o=function(){e.scaleVisualContainersToCanvas(se),e.viewModel&&r.lazyScoped("loadProgressNotification").then((function(t){t.register(e),t.reset()}))};pe.add(I,(function(){return e.viewModel&&e.viewModel.visualContainerGroups}),o),r.lazyScoped("loadProgressNotification").then((function(t){t.register(e)})),X()}return Object.defineProperty(E.prototype,"canvasOptions",{get:function(){return this._canvasOptions||Pe},set:function(e){this._canvasOptions=e},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"isEditMode",{get:function(){return G()},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"isMobileLayoutAuthoring",{get:function(){return U()},enumerable:!0,configurable:!0}),E.prototype.$onInit=function(){this.updateCanvasLayoutSize(),this.updateLayoutStrategy();var e=ge&&ge.getCurrentExploration();e&&this.updateIsOutspacePaneVisible(e),this.outerViewport=ue},E.prototype.$onDestroy=function(){Fe.unsubscribeAll()},E.prototype.$doCheck=function(){pe.doCheck()},E.prototype.showOutspaceImage=function(){return this.canShowOutspaceImage()&&!!this.outspaceBackground.imageSource},E.prototype.showBackgroundImage=function(){return!this.hideBackgroundImage()&&!!this.canvasBackground.imageSource},E.prototype.showBoxGrid=function(){return ye.getCurrentLayoutCapabilities().canShowLayoutGrid()&&1===ye.getCurrentLayout()},E.prototype.showDotGrid=function(){return J&&ye.getCurrentLayoutCapabilities().canShowLayoutGrid()&&0===ye.getCurrentLayout()},E.prototype.useContainerRepeat=function(){return 0===ye.getCurrentLayout()},E.prototype.clearSelection=function(e){xe.getViewState().preventSelectionClearing||t.util.EventBubblingUtility.handled(e)||(Ce.clearSelection(),r.overlayService.hideAllDropdowns(),r.clipboard.clearFormatData())},E.prototype.canvasResized=function(e,t){var i=this,r=function(e,t){i.outerViewport={width:e,height:t},e===ue.width&&t===ue.height||(ue.width=e,ue.height=t,i.forceSyncSizeUpdates?i.updateCanvasFit():window.requestAnimationFrame((function(){i.updateCanvasFit()})))};return this.forceSyncSizeUpdates?r(e,t):(oe||(oe=_.throttle((function(e,t){return r(e,t)}),D)),void oe(e,t))},E.prototype.canvasPinchStart=function(e){r.hostTooltip&&r.hostTooltip.hide({isTouchEvent:!0,immediately:!0}),1===e&&a.storeOverflowValuesAndChange(H,jsCommon.CssConstants.visibleValue),ee=e},E.prototype.canvasPinchEnd=function(e){1===e&&a.restoreOverflowValues(H);var t;t=void 0===ee||e===ee?0:e>ee?1:2,he.publishToChannel(m.canvasPinched,{direction:t})},E.prototype.canvasWatermarkEnabled=function(){return xe.getConfig().displayOptions.canShowCanvasWatermark},E.prototype.showMobileNotificationBar=function(){return 0!==xe.getConfig().displayOptions.mobileBookmarksMenuDisplay},E.prototype.getUnscaledDisplayAreaProportion=function(){var e=1;return this.shouldShowOutspacePane()&&this.viewModel&&(e=this.viewModel.width/(this.viewModel.width+this.getFilterPaneContractWidth())),e},E.prototype.getFilterPaneContractWidth=function(){if(!this.shouldShowOutspacePane())return 0;var e=this.viewModel,t=C.OutspacePaneCollapsedWidth;return q()&&(t=e.filterPaneContractWidth),t},E.prototype.calculateFilterPaneScaledWidth=function(){if(q()){if(null!=this.viewModel){var e=H.get(0).getBoundingClientRect();this.filterPaneUnscaledHeight=e.height;var t=de.getDisplayOption();switch(t){case 2:this.filterPaneScaledWidth=e.width*(1-this.getUnscaledDisplayAreaProportion());break;case 1:var i=this.getUnscaledDisplayAreaProportion(),r=e.width*i/this.viewModel.width,o=W(),n=a.getFitToPageScaleY(this,xe,o);r<n?this.filterPaneScaledWidth=e.width*(1-i):this.filterPaneScaledWidth=this.getFilterPaneContractWidth()*n;break;case 3:case 4:case 0:this.filterPaneScaledWidth=this.getFilterPaneContractWidth();break;default:null!=t&&debug.assertNever(t)}}}else this.filterPaneScaledWidth=C.OutspacePaneCollapsedWidth,this.filterPaneUnscaledHeight=void 0},E.prototype.getVerticalAlignmentSetting=function(){if(!U())return a.getVerticalAlignmentSetting(this,fe,ge)},E.prototype.shouldShowOutspacePane=function(){if(this.disableOutspacePane||U()||!ve.getCapabilities().showVisualizationPane||!this.viewModel)return!1;if(this.viewModel.contract&&this.viewModel.contract.objects&&this.viewModel.contract.objects.outspacePane&&void 0===this.viewModel.contract.evaluatedObjects)return!1;var e;e=re||K()||this.isForceMigrationLive(),e&&(e=e&&this.isOutspacePaneVisible,!e&&fe.featureSwitches.singleFilterPane&&(e=G()));var t=ge&&ge.getCurrentExploration(),i=t&&t.settings;return e&&i&&(e=e&&!t.settings.filterPaneHiddenInEditMode),e},E.prototype.isForceMigrationLive=function(){return!!r.featureSwitchService.featureSwitches.forceMigrateNewFilterPane},E.prototype.resetThemableProperties=function(){var t=this,i=ge.getCurrentZone();e.zoneify(i,(function(){t.updateAndApplyCanvasOutspaceOrBackground(1),t.updateAndApplyCanvasOutspaceOrBackground(2),t.updateDotGridLayout()}))},E.prototype.updateIsOutspacePaneVisible=function(t){this.updateUseNewFilterPaneSettings(t);var i=t&&t.evaluatedObjects&&t.evaluatedObjects.outspacePane;this.isOutspacePaneVisible=e.DataViewObject.getValue(i,"visible",!0)},E.prototype.evaluateObjects=function(){var e=ge.getCurrentExploration();if(this.viewModel&&e){var i=e.themeCollection,r=t.constants.SectionComponentType,o=this.viewModel.contract;c.evaluateObjects(o,w.objectDescriptors,r,i,be,fe),he.publishToChannel(m.sectionObjectsEvaluated,ge.getCurrentSection())}},E.prototype.shouldTrackLoadProgress=function(){var e=!1;if(this.viewModel&&this.viewModel.visualContainers.length>0){var t=r.dataSources.get();if(t)for(var i=0,o=this.viewModel.visualContainers;i<o.length;i++){var n=o[i];if(r.visualQueryGenerator.shouldExecute(n.contract.config.singleVisual,t)||r.visualPluginOps.isAnalysisVisual(n.contract.config.singleVisual.visualType)||r.visualPluginOps.isQnaVisual(n.contract.config.singleVisual.visualType)){e=!0;break}}}return e},E.prototype.cancelTracking=function(e){if(this.viewModel&&this.viewModel.visualContainers.length>0)for(var t=0,i=this.viewModel.visualContainers;t<i.length;t++){var o=i[t];o.showProgressBar&&(o.errorInfo={details:{message:e,displayableErrorInfo:null},fixableError:0,code:"VisualLoadingCanceled",hideSeeDetails:!0})}r.lazyScoped("loadProgressNotification").then((function(e){e.cancelTracking()}))},E.prototype.onPrintStarting=function(){ne=this.canvasOptions,this.canvasOptions=__assign({},ne,{disableDeferredRendering:!0})},E.prototype.onPrintFinished=function(){this.canvasOptions=ne},E.prototype.subscribeToEvents=function(){var t,o=this;Fe.subscribe(e.events.visualThemeChanged,(function(e,t){o.evaluateObjects(),o.resetThemableProperties()})).subscribe(m.explorationLoaded,(function(){return o.onExplorationLoaded()})).subscribe(m.explorationObjectsLoaded,(function(e,t){return o.updateIsOutspacePaneVisible(t)})).subscribe(m.explorationObjectsChanged,(function(e){return o.updateCanvasFit()})).subscribe(m.explorationUnloaded,(function(e,t){return o.onExplorationUnloaded()})).subscribe(m.sectionObjectsChanged,(function(e,t){o.evaluateObjects(),o.resetThemableProperties(),o.updateSizeAndFitOption()})).subscribe(m.canvasDisplayChanged,(function(e,t){return o.applyFitOption(t)})).subscribe(m.canvasDimensionChanged,(function(e,t){return o.updateCanvasDimension(t)})).subscribe(m.canvasZoomChanged,(function(e,t){return o.applyZoom(t)})).subscribe(m.align,(function(e,t){return o.alignVisuals(t)})).subscribe(m.visibilityChanged,(function(){return o.onPopOutModeChanged()})).subscribe(m.clipboardDataUpdated,(function(){return o.onClipboardDataUpdated()})).subscribe(m.formFactorChanged,(function(){return o.onFormFactorChanged()})).subscribe(m.canvasLayoutChanged,(function(){return o.onCanvasLayoutChanged()})).subscribe(m.sectionLayoutRemoved,(function(){return o.onSectionLayoutRemoved()})).subscribe(m.deleteVisualContainer,(function(e,t){return r.visualAuthoring.deleteVisualContainer(t,o.viewModel)})).subscribe(e.common.events.printStarting,(function(){return o.onPrintStarting()})).subscribe(e.common.events.printFinished,(function(){return o.onPrintFinished()})).subscribe(m.explorationSettingsLoaded,(function(e,t){return o.onExplorationSettingsLoaded(t)})).subscribe(m.removeVisualContainerFromLayout,(function(e,t){me.removeLayoutFromVisualContainer(o.viewModel,t)})).subscribe(m.explorationContainerReady,(function(){we&&(ce&&(ce.reject(),ce=null),ce=we.startActivity(i,e.telemetry.EXLoadExplorationVisuals,null))})).subscribe(m.visualThumbnailDoubleClicked,(function(e,t){o.addDefaultLayoutToVisualContainer(t)})),pe.add(O,(function(){return Se.getShowGridlines()}),(function(){return o.onShowGridlinesChanged()})),pe.add(N,(function(){return Se.getSnapToGrid()}),(function(){return o.onSnapToGridChanged()})),pe.add(L,(function(){return Se.getLockObjects()}),(function(){return o.onLockObjectsChanged()})),pe.add(k,(function(){return Se.getShowSmartGuides()}),(function(){return o.onShowSmartGuidesChanged()})),pe.add(R,(function(){return o.viewModel&&o.viewModel.contract&&o.viewModel.contract.size}),(function(e){e&&(a.updateCanvasSize(o,e.width,e.height),o.updateCanvasFit())})),pe.add(B,(function(){return o.useResponsiveLayout}),(function(){H.scrollTop(0)}));var n=function(){var i=ge.getCurrentZone();e.zoneify(i,(function(){t=void 0,ce&&(ce.resolve(),ce=null),document.activeElement||H.focus(),he.publishToChannel(m.exploreCanvasVisualRendered)}))};Fe.subscribe(m.visualContainerDataRenderingStarted,(function(e,i){if(t){var r=i&&i.config&&i.config.singleVisual&&i.config.singleVisual.visualType,o=_.findIndex(t,i);o===-1?jsCommon.Trace.error("Unexpected visualContainerDataRenderingStarted received: "+r):(_.pullAt(t,o),0===t.length&&n())}})),pe.add(z,(function(){return o.viewModel&&o.viewModel.visualContainers}),(function(e,i,r){if(!r||e){if(t=_.map(o.visibleVisualContainers(),(function(e){return e.contract})),ce){var a=t;Object.defineProperty(ce.event.info,"visualTypesRemaining",{get:function(){return _.map(a,(function(e){return x.getVisualType(e)})).join(",")}})}0===t.length&&n()}})),i.$on(e.common.constants.visualCancelLoadEventName,(function(e,t){return o.cancelTracking(t)}))},E.prototype.onExplorationSettingsLoaded=function(t){if(t.useNewFilterPaneExperienceChanged){var i=ge.getCurrentExploration();this.updateIsOutspacePaneVisible(i),we.logEvent(e.telemetry.EXImprovedFilterExperienceToggleReportSetting,re),this.updateCanvasFit()}},E.prototype.onSectionLayoutRemoved=function(){var t=ye.getCurrentLayout();_.remove(this.viewModel.visualContainers,(function(e){return!e.contract.layouts.withId(t)})),this.viewModel.visualContainerGroups=e.ItemGroupingManager.removeBy(this.viewModel.visualContainerGroups,(function(e){return!e.contract.layouts.withId(t)})),he.publishToChannel(m.canvasChanged)},E.prototype.onShowGridlinesChanged=function(){J=Se.getShowGridlines(),this.updateCanvasFit()},E.prototype.onSnapToGridChanged=function(){Y=Se.getSnapToGrid(),this.updateLayoutStrategy()},E.prototype.onShowSmartGuidesChanged=function(){this.updateLayoutStrategy()},E.prototype.onLockObjectsChanged=function(){if(1===xe.getMode()){var e=Se.getLockObjects();xe.getViewState().lockObjects=e,this.updateGridLayout()}},E.prototype.applyFitOption=function(e){de.setDisplayOption(e),3===e&&this.updateCanvasFit(1),this.updateCanvasFit()},E.prototype.applyZoom=function(e){fe.featureSwitches.canvasZoom&&(de.setDisplayOption(3),this.updateCanvasFit(e))},E.prototype.updateCanvasFit=function(e){var t=this;r.ngZone.run((function(){t.calculateFilterPaneScaledWidth(),t.evaluateObjects();var i=t.getVerticalAlignmentSetting();fe.featureSwitches.canvasZoom?(e||3!==de.getDisplayOption()||(e=de.getDisplayAreaScaleFactor()),a.applyFitOption(t,H,ie,i,e)):a.applyFitOption(t,H,ie,i)}))},E.prototype.moveSelectedContainersWrapper=function(e){var t=this;Ce.getSelectedElements().length>1&&ye.getCurrentLayoutCapabilities().canMoveMultipleVisuals()&&(le?(le=!1,r.undoRedo.register("MoveSelectedVisualContainers",(function(){t.moveSelectedContainers(e)}))):this.moveSelectedContainers(e))},E.prototype.alignVisuals=function(e){var t={width:this.viewModel.width,height:this.viewModel.height};me.alignSelectedVisuals(e.alignmentType,t,c.getSelectedCanvasItemViewModels(this.viewModel,Ce)),i.$broadcast(p.VisualSelectionOrPositionChangedEventName)},E.prototype.moveSelectedContainers=function(e){var t=Z,i={x:t.x-e.x,y:t.y-e.y,width:0,height:0},r=c.convertFromScaledPosition(i,se),o=this.viewModel.visualContainerGroups;this.moveSelectedCanvasItemContainers(o,r),t.x=e.x,t.y=e.y},E.prototype.moveSelectedCanvasItemContainers=function(e,i){for(var r=0,o=e;r<o.length;r++){var n=o[r];if(n.isSelected){var a=_.cloneDeep(n.position);a.x-=i.x,a.y-=i.y,me.moveCanvasItem(n,a)}else{if(!t.viewModels.isVisualContainerGroup(n))continue;this.moveSelectedCanvasItemContainers(n.children,i)}}},E.prototype.updateCanvasDimension=function(e){var i=this;r.undoRedo.register("UpdateCanvasDimension",(function(){i.viewModel.contract.size=e;var o=ge.getCurrentExploration(),n=ge.getCurrentSection(),s=a.isCortanaPageSize(e);t.PodUtils.setCortanaEnabled(o,n.name,s,r.linguisticSchemaProxy)}))},E.prototype.onPopOutModeChanged=function(){this.hasPopOut=!!Ee.get(),this.updateSizeAndFitOption(),this.evaluateObjects(),this.resetThemableProperties()},E.prototype.onCanvasLayoutChanged=function(){this.updateSizeAndFitOption()},E.prototype.onFormFactorChanged=function(){r.overlayService.hideAllDropdowns(),this.updateSizeAndFitOption(),this.updateLayoutStrategy(),this.evaluateObjects(),this.resetThemableProperties()},E.prototype.updateAndApplyCanvasOutspaceOrBackground=function(e){var t=ge.getCurrentExploration();if(this.viewModel&&t){var i=this.viewModel.contract.evaluatedObjects,o=t.themeCollection,n=be.getVisualStyle(o);a.updateAndApplyBackground(e,this,H,i,fe,r.resourceLoader,ge,r.promiseFactory,ye,xe,n,de),2===e&&a.setDisplayAreaBackground(this,i,n)}},E.prototype.updateSizeAndFitOption=function(){this.viewModel&&(this.updateCanvasFit(),this.updateSize())},E.prototype.updateLayoutStrategy=function(){var e,i=ye.getCurrentLayout(),r=ye.getCurrentLayoutCapabilities(),o=t.viewModels.VisualContainer.getVisualBodyOffset(r,ve);switch(i){case 1:var n=fe.featureSwitches.useNewPhoneCanvasGrid?t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout:t.viewModels.FixedPhoneCanvasSettings.phoneGridLayoutLegacy;e=new l({rows:n.rowCount,cols:n.columnCount,rowSpacing:M,colSpacing:P},n.newVisualCellCount,fe.featureSwitches.useNewPhoneCanvasGrid);break;default:if(j()){var a=void 0,s=void 0,c=this.dotGridViewModel,u=this.canvasLayoutSize;c?(a=c.layoutX,s=c.layoutY):(a=g.getLayoutForScreen(se.x*u.width,u.width),s=g.getLayoutForScreen(se.y*u.height,u.height));e=new v({layoutX:a,layoutY:s,offset:o,layoutAuthoring:me,limits:{left:0,top:0,width:u.width,height:u.height}})}else e=new h(o,me)}fe.featureSwitches.redlineAlignment&&0===i&&Se.getShowSmartGuides()&&(this.smartGuideViewModel=this.smartGuideViewModel||{guides:[]},e=new b(e,Ce,this.smartGuideViewModel)),this.layout.setStrategy(e),this.updateGridLayout()},E.prototype.adjustScaleForLayout=function(e){return this.showDotGrid()?g.adjustScaleForGrid(e,this.canvasLayoutSize):e},E.prototype.updateGridLayout=function(){this.viewModel&&(this.updateBoxGridLayout(),this.updateDotGridLayout())},E.prototype.updateDotGridLayout=function(){var t=ge.getCurrentExploration();if(t){var i=this.canvasLayoutSize,r=this.dotGridViewModel,o=!r,n=g.getLayoutForScreen(se.x*i.width,i.width),a=r&&r.layoutX;o||(o=!g.sameLayout(n,a));var s=g.getLayoutForScreen(se.y*i.height,i.height),l=r&&r.layoutY;o||(o=!g.sameLayout(s,l));var c=be.getVisualStyle(t.themeCollection),p=u.getThemeColor(c,e.visuals.ForegroundColorName),d=r&&r.color;o||(o=p!==d),o&&(this.dotGridViewModel={layoutX:n,layoutY:s,color:p})}},E.prototype.updateBoxGridLayout=function(){var e=ge.getCurrentExploration();if(e){var i,r=fe.featureSwitches.useNewPhoneCanvasGrid?t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout:t.viewModels.FixedPhoneCanvasSettings.phoneGridLayoutLegacy;switch(ye.getCurrentLayout()){case 1:var o={rows:r.rowCount,cols:r.columnCount,rowSpacing:M,colSpacing:P},n=s.getCellSize({width:this.viewModel.width,height:this.viewModel.height},o),a=be.getVisualStyle(e.themeCollection);i={columnCount:r.columnCount,rowCount:r.rowCount,layout:{horizontal:{margin:P,gutter:P,size:n.width},vertical:{margin:M,gutter:M,size:n.height}},style:{color:u.getThemeColor(a,T),fullOpacity:a.isHighContrast},newVisualCellCount:r.newVisualCellCount};break;default:i=void 0}this.boxGridLayout=i}},E.prototype.updateSize=function(){var e=this.size;if(this.viewModel=this.viewModel,e&&this.viewModel){if(0===de.getDisplayOption()){var t=xe.getConfig(),i=t.displayOptions.hideTileMenu?e.height:e.height-W();se={x:e.width/this.viewModel.width,y:i/this.viewModel.height}}else{var r=de.getDisplayAreaScaleFactor();se={x:r,y:r}}this.scaleVisualContainersToCanvas(se),this.updateCanvasLayoutSize(),this.updateLayoutStrategy()}},E.prototype.updateCanvasLayoutSize=function(){var e=this.viewModel;e?this.canvasLayoutSize={width:e.width,height:e.height}:this.canvasLayoutSize=V,this.layout.setCanvasSize(this.canvasLayoutSize),this.updateGridLayout()},E.prototype.scaleVisualContainersToCanvas=function(e){var i=this;if(this.viewModel){var r=this.viewModel.visualContainers,o=Ee.get(),n=de.getDisplayOption(),a=this.viewModel.contract.size&&(3!==n&&0!==n||3===n&&1!==de.getDisplayAreaScaleFactor());if(t.viewModels.traverseVisualContainerGroups(this.viewModel.visualContainerGroups,(function(t){i.renderScaleForContainer(t,e,a,o)})),this.useResponsiveLayout&&!o)for(var s=0,l=_.sortBy(r,(function(e){return e.position.y*i.viewModel.width+e.position.x})),c=0,u=l;c<u.length;c++){var p=u[c],d=p.getScaledPosition();s+=20,p.overridePosition={width:this.size.width-2*C.AutoLayoutVisualSkittlesRightPadding,height:d.height,x:C.AutoLayoutVisualSkittlesRightPadding,y:s},s+=Math.round(d.height),p.updateViewState()}}},E.prototype.renderScaleForContainer=function(e,i,r,o){if(e.uiScale=i,e.enableVisualScaling=r,!e.isPositioned){var n=this.getEmptyRawCanvasSpaces();n.z=e.position.z,me.moveCanvasItem(e,n)}t.viewModels.isVisualContainer(e)?(o?this.setVisualContainerSizeForPopOutMode(e):this.useResponsiveLayout||(e.overridePosition=null,e.updateViewState()),this.canvasOptions.disableDeferredRendering&&(e.allowDeferredRendering=!1)):e.updateViewState()},E.prototype.setVisualContainerSizeForPopOutMode=function(e){if(e.isPoppedOut){var i=ye.getCurrentLayoutCapabilities(),r=t.viewModels.VisualContainer.getVisualBodyOffset(i,ve),o=this.size.height,n=this.size.width;if(0!==de.getDisplayOption()){var a=de.getDisplayAreaScaleFactor();o=this.viewModel.height*a-r.height,n=this.viewModel.width*a-r.width}e.overridePosition={width:n,height:o,x:-r.left,y:-r.top},e.updateViewState()}},E.prototype.onExplorationLoaded=function(){var t=this,i=ge.getCurrentZone();e.zoneify(i,(function(){t.evaluateObjects(),t.resetThemableProperties(),t.applyFitToPageIfAny(),t.updateUseNewFilterPaneSettings(ge.getCurrentExploration())}))},E.prototype.applyFitToPageIfAny=function(){var e=this;jsCommon.QueryStringUtil.getQueryStringValue("loadFitToPage")&&setTimeout((function(){e.applyFitOption(1)}),0)},E.prototype.onExplorationUnloaded=function(){r.globalEventBridge.publishToChannel(e.common.events.explorationUnloaded)},E.prototype.isCanvasBackdropVisible=function(){return ye.getCurrentLayoutCapabilities().canShowCanvasBackdrop()},E.prototype.useCanvasBackdropLegacy=function(){return!fe.featureSwitches.useNewPhoneCanvasGrid},E.prototype.getEmptyRawCanvasSpaces=function(){if(this.size){var e={x:0,y:0,width:this.viewModel.width,height:this.viewModel.height},t=_.map(this.viewModel.visualContainers,(function(e){var t=e.position;return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}})),i=r.layoutInsertionHelper.getEmptySpaces(e,t);if(i.length>0){var o=i[0];o.height=Math.min(o.height,C.AutoLayoutMaxSpaceHeight),o.width=Math.min(o.width,C.AutoLayoutMaxSpaceWidth);var n=this.canvasOptions.autoLayoutVisualPadding,s=W();if(o.x+=n,o.y+=s,o.width-=2*n,o.height-=2*n,!_.some(this.viewModel.visualContainers,(function(e){return e.isPositioned})))return o;var l={x:o.x+o.width/2,y:o.y+o.height/2},c=me.getLayoutForNewVisualContainerWithRects(_.map(t,a.visualPositionToRect),l,e);return a.rectToVisualPosition(c)}}return __assign({},a.DefaultVisualPosition)},E.prototype.drop=function(e,i){var o=this,n=r.dragDataService.getDragContext();if(n){var s={left:0,top:0};if(e.target){var l=$(e.target).find(a.VisualContainerHostSelector.selector);l&&(s=l.offset())}var u,p=e.pageX-s.left,d=e.pageY-s.top;if(0===de.getDisplayOption()&&(u=se),n.field){var h=ye.getCurrentLayoutCapabilities(),v=t.viewModels.VisualContainer.getVisualBodyOffset(h,ve),g=p,f=d;ye.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(f-=v.top);var m=u;if(!m){var C=de.getDisplayAreaScaleFactor();m={x:C,y:C}}var S=g/m.x,w=f/m.y;if(y.tryFindChildDropTarget(i.draggable,(function(){return o.getVisualContainerFromCoordinate(S,w)})))return}var b=this.layout.getDropPosition(p,d,u);if(b){var x=a.rectToVisualPosition(b);if(n.field){var E=this.viewModel.contract,F=E.visualContainerGroups;x.z=c.getZIndexForNewCanvasItem(F,ye.getCurrentLayout()),this.addVisual(n.field,x)}else if(n.source){var V=n.source;me.addLayoutToVisualContainer(this.viewModel,V,x)}}}},E.prototype.addDefaultLayoutToVisualContainer=function(e){var t;0===de.getDisplayOption()&&(t=se);var i=this.layout.getNextFreePosition();if(i){var r=a.rectToVisualPosition(i),o=e.visualContainer;me.addLayoutToVisualContainer(this.viewModel,o,r)}},E.prototype.getVisualContainerFromCoordinate=function(e,t){var i={x:e,y:t},r=this.viewModel.visualContainers,a=_.filter(r,(function(e){return S.containsPoint(o(e),i)}));if(!_.isEmpty(a)){return _.maxBy(a,(function(e){return n(e)})).contract}},E.prototype.addVisual=function(t,i){var o=r.dataSources.get();o&&r.visualAuthoring.addVisualContainer({expr:t,dataSources:o,allowAggregate:!0},this.viewModel,i).then((function(t){we.logEvent(e.telemetry.EXCreateVisual,"DraggedToCanvas",x.getVisualType(t),t.name)}))},E.prototype.onKeyDown=function(t){return e.events.isKeyboardEventIncomplete(t)?void t.stopImmediatePropagation():r.canvasKeyHandler.onKeyDown(t,this.viewModel)},E.prototype.onClipboardDataUpdated=function(){this.updateCanvasCursor()},E.prototype.updateCanvasCursor=function(){var e=r.clipboard.canPasteFormat();this.setCursorClass(e?F:void 0)},E.prototype.setCursorClass=function(e){te=e},E.prototype.shouldDisableZoom=function(){return xe.getConfig().touchOptions.disableTouchZoom},E.prototype.getExploreCanvasClass=function(){var e=[];return this.disableAnimations&&e.push("disableAnimations"),this.useResponsiveLayout&&e.push("responsive"),Ee.get(4)?e.push("hasSpotlight"):Ee.get()&&(e.push("popOut"),Ee.get(10)&&e.push("seeData")),te&&e.push(te),this.shouldDisableZoom()&&e.push("disableTouchZoom"),Q()&&e.push("scrollablePhoneAuthoring"),ve.getCapabilities().visualContainerOptions.useStylableHeader&&e.push("stylableVisualContainerHeader"),0===ye.getCurrentLayout()?e.push("master-form-factor"):e.push("phone-form-factor"),e.join(" ")},E.prototype.canSwipe=function(){var e=xe.getConfig(),i=ge&&ge.getAllSections(),r=i&&t.SectionUtils.getVisibleSections(i).length>1;return!(!e.touchOptions.isCanvasSwipeable||this.hasPopOut||!r||this.disableCanvasTouchInteraction)},E.prototype.canPinch=function(){return!(xe&&xe.getConfig().touchOptions.disableCanvasPinch||this.disableCanvasTouchInteraction)},E.prototype.canScroll=function(){return!this.disableCanvasTouchInteraction},E.prototype.canShowOutspaceImage=function(){return!xe.getConfig().displayOptions.hideOutspaceImage},E.prototype.hideBackgroundImage=function(){return xe.getConfig().displayOptions.hideBackgroundImage||G()&&1===ye.getCurrentLayout()},E.prototype.showQna=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return t.target===t.currentTarget&&(t.stopPropagation&&t.stopPropagation(),he.publishToChannel(m.addQnaContainer,{pointOfInterest:{x:t.offsetX/se.x,y:t.offsetY/se.y},creationSource:6})),[2]}))}))},E.prototype.updateUseNewFilterPaneSettings=function(e){re=e&&e.settings&&e.settings.useNewFilterPaneExperience},E.prototype.visibleVisualContainers=function(){var e=Ve&&this.viewModel&&(_.isEmpty(this.viewModel.visualContainerGroups)?this.viewModel.visualContainers:this.viewModel.visualContainerGroups);if(_.isEmpty(e))ae=void 0;else{if(ae){var i=0;t.viewModels.traverseVisualContainerGroups(e,(function(e){t.viewModels.isVisualContainer(e)&&ae&&(i>=ae.length||ae[i]!==e?ae=void 0:++i)}),{visibleOnly:!0}),ae&&i<ae.length&&(ae=void 0)}ae||(ae=[],t.viewModels.traverseVisualContainerGroups(e,(function(e){t.viewModels.isVisualContainer(e)&&ae.push(e)}),{visibleOnly:!0}))}return ae},E.prototype.isPenAnnotationsEnabled=function(){return xe.getConfig().enablePenAnnotation},E}())}function o(e){var t=e.overridePosition||e.position,i={height:t.height,width:t.width,top:t.y,left:t.x};return c.addOffsetFromGroup(i,e)}function n(t){return 0!==t.contract.visibility?e.common.constants.MaxSupportedZIndexValue:t.position.z}var a=e.explore.util.CanvasDisplayUtility,s=e.explore.controllers.canvas.CanvasLayoutGrid,l=e.explore.controllers.canvas.CanvasLayoutGridStrategy,c=t.util.CanvasVisualsUtility,u=e.visuals.ColorHelper,p=e.common.constants,d=e.common.helpers.ContainerPrinterHelper,h=e.explore.controllers.canvas.DefaultLayoutStrategy,v=e.explore.controllers.canvas.DotGridLayoutStrategy,g=e.explore.util.DotGridUtil,f=e.explore.util.DragDropTypes,y=jsCommon.DragDropUtils,m=e.explore.services.events,C=e.explore.constants.ExploreCanvasConstants,S=e.visuals.shapes.Rect,w=e.explore.contracts.Section,b=e.explore.controllers.canvas.SmartGuideStrategy,x=e.explore.util.VisualContainerUtils,E=e.common.Watcher,F="brush-cursor",V={width:0,height:0},P=0,M=0,T="foregroundNeutralDark",D=300,A="size",I="visualContainers",O="getShowGridlines",N="getSnapToGrid",L="getLockObjects",k="getShowSmartGuides",R="contractSize",B="useResponsiveLayout",z="visualContainersOnLoad",H=(function(){function e(e,t){this.viewModeState=t.viewModeState,this.core=r(e,t,t.$element.find(".exploreCanvas")),e.C=this.core,e.useModernVisual=t.featureSwitchService.featureSwitches.useModernVisual}return Object.defineProperty(e.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(e){this.core.viewModel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disablePrint",{get:function(){return this.core.disablePrint},set:function(e){this.core.disablePrint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvasOptions",{get:function(){return this.core.canvasOptions},set:function(e){this.core.canvasOptions=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableOutspacePane",{get:function(){return this.core.disableOutspacePane},set:function(e){this.core.disableOutspacePane=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forceSyncSizeUpdates",{get:function(){return this.core.forceSyncSizeUpdates},set:function(e){this.core.forceSyncSizeUpdates=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableCanvasTouchInteraction",{get:function(){return this.core.disableCanvasTouchInteraction;
},set:function(e){this.core.disableCanvasTouchInteraction=e},enumerable:!0,configurable:!0}),e.createOptions=function(){return{additionalServices:["$element","dragDataService","featureSwitchService","globalEventBridge","highContrastCssGenerationService","hostTooltip","layoutInsertionHelper","lazySync","ngZone","overlayService","promiseFactory","settingsService","telemetryService","themeService"],scopedDependencies:["canvasKeyHandler","canvasScale","clipboard","dataSources","eventBridge","explorationCapabilities","explorationNavigation","formFactor","layoutAuthoring","visibility","resourceLoader","selection","undoRedo","viewModeState","visualAuthoring","visualPlugin","visualPluginOps","visualQueryGenerator","lazyScoped"]}},e.prototype.$onInit=function(){this.core.$onInit()},e.prototype.$onDestroy=function(){this.core.$onDestroy()},e.prototype.$doCheck=function(){this.core.$doCheck()},e.prototype.shouldTrackLoadProgress=function(){return this.core.shouldTrackLoadProgress()},e})();i.ExploreCanvasController=H,i.createExploreCanvasCore=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.ExploreCanvas={templateUrl:"components/exploreCanvas/exploreCanvas.html",bindings:{viewModel:"=",disablePrint:"=",canvasOptions:"=?",disableOutspacePane:"<?",forceSyncSizeUpdates:"<?",disableCanvasTouchInteraction:"<?"},controller:e.common.createController(t.ExploreCanvasController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.replace=!0,this.scope={classes:"@",ngModel:"<",ngChange:"&",options:"<",expression:"@",label:"@"},this.templateUrl="views/jqSelect.html"}return e})();e.JqSelect=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=(function(){function i(){this.restrict="A",this.controller=e.common.createController(t.controllers.ModelingContextChangerController),this.link=function(e,t,i){var o=e.eventBridge.createChannelSubscriptionManager().subscribe(r.schemaItemActivationChanged,(function(){e.schemaItemActivationService.getActiveItem()?t.on("click",(function(){e.eventBridge.publishToChannel(r.modelingContextChanged)})):t.off("click")}));e.$on("$destroy",(function(){return o.unsubscribeAll()}))}}return i})();i.ModelingContextChanger=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="A",this.require="ngModel",this.scope={pbiValidate:"="},this.link=function(t,i,r,o){t.pbiValidate&&(o.$validators.required=function(e,i){return null==i||!t.pbiValidate.required||""!==i},o.$validators.min=function(i,r){return e.isLargerOrEqual(r,t.pbiValidate.min)},o.$validators.max=function(i,r){return e.isLargerOrEqual(t.pbiValidate.max,r)},o.$validators.decimal=function(e,i){return null==i||!t.pbiValidate.decimal||_.isFinite(Number(i))},o.$validators.integer=function(e,i){if(null==i||!t.pbiValidate.integer)return!0;var r=Number(i);return _.isFinite(r)&&Math.floor(r)===r},o.$validators.url=function(e,i){return null==i||!t.pbiValidate.url||jsCommon.UrlUtils.isValidHttpUrl(i)})}}return e.isLargerOrEqual=function(e,t){if(null==e||null==t||""===e||""===t)return!0;var i=Number(e),r=Number(t);return!_.isFinite(i)||!_.isFinite(r)||i>=r},e})();e.PbiValidate=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){var e=this;this.restrict="A",this.scope={viewModel:"=?",sectionNumber:"=?",navMarkerParent:"@",autoWidth:"<?"},this.link=function(t,i){null!=t.viewModel?(t.$watch("viewModel.activePageSection",(function(r){if(null!=r){var o=e.getPageSectionIndexes(t.viewModel,r),n=o[0],a=o[1];e.animateSectionSlide(t,i,n,a)}})),t.$watch("viewModel.activeSection",(function(r){if(null!=r){var o=e.getSectionIndexes(t.viewModel,r),n=o[0],a=o[1];e.animateSectionSlide(t,i,n,a)}})),t.$watch("viewModel.sections.length",(function(r,o){if(0!==r&&r!==o){var n=e.getSectionIndexes(t.viewModel,t.viewModel.activeSection),a=n[0],s=n[1];e.animateSectionSlide(t,i,a,s)}}))):null!=t.sectionNumber&&t.$watch("sectionNumber",(function(r){null!=r&&e.animateSectionSlide(t,i,r,Number(!r))}))}}return e.prototype.animateSectionSlide=function(e,t,i,r){i<r?t.css({right:"200%"}).animate({right:0},200):i>r&&t.css({"margin-left":"200%"}).animate({"margin-left":0},200);var o=$("."+e.navMarkerParent+".navMarker");e.autoWidth?0===i?o.css({"margin-left":o.width()+"px","margin-right":"auto"}).animate({"margin-left":"0"},200):o.css({"margin-right":o.width()+"px","margin-left":"auto"}).animate({"margin-right":"0"},200):o.animate({"margin-left":o.width()*i+"px"},200)},e.prototype.getSectionIndexes=function(e,t){var i=[],r=e.previousSection;return e.sections.forEach((function(e,o){if(e.sectionType===t?i[0]=o:e.sectionType===r&&(i[1]=o),2===i.length)return i})),i},e.prototype.getPageSectionIndexes=function(e,t){var i=[],r=e.previousPageSection;return e.pagePaneSections.forEach((function(e,o){if(e.sectionType===t?i[0]=o:e.sectionType===r&&(i[1]=o),2===i.length)return i})),i},e})();e.SectionAnimationSlider=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.CssConstants.createClassAndSelector,i=(function(){function e(){this.restrict="A",this.scope={sectionLength:"<",currentSection:"=",setActiveSectionFunction:"&"},this.link=function(e,i){i.on("keydown",(function(i){var r=t("sectionTab"),o=e.sectionLength;switch(i.keyCode){case $.ui.keyCode.LEFT:case $.ui.keyCode.UP:var n=(e.currentSection-1+o)%o;e.setActiveSectionFunction({nextSection:n}),$(i.target).parent("ul").find(r.selector).eq(n).focus(),i.stopPropagation();break;case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:n=(e.currentSection+1)%o,e.setActiveSectionFunction({nextSection:n}),$(i.target).parent("ul").find(r.selector).eq(n).focus(),i.stopPropagation()}}))}}return e})();e.SectionTabKeyHandler=i})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={initLimit:"=",totalItemsAmount:"="},this.templateUrl="views/virtualList.html",this.link=function(e,t){var i=0,r=10;e.limitItems=+e.initLimit,e.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1};var o=t.find(".virtual-list"),n=2*t.height();o.scroll((function(){var a=o.scrollTop();n||(n=2*t.height()),a+n>o.height()&&e.totalItemsAmount>=e.limitItems&&a>i&&(i=a,e.limitItems+=r,e.$digest())}))}}return e})();e.VirtualList=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(){var e=jsCommon.QueryStringUtil.getQueryStringValue("openReportSource");return e?r[e]||r.Invalid:r.Normal}var r=e.telemetry.OpenExplorationSource;t.GetOpenExplorationSource=i;var o=(function(){function t(){}return t.HasUnsupportedExploreVisuals=function(t,i){var r=!1;if(t){var o=t.sections;if(o)for(var n=0,a=o.length;n<a;n++){var s=o[n],l=s.visualContainers;if(l)for(var c=0,u=l.length;c<u;c++){var p=l[c],d=p.config.singleVisual.visualType;if(d&&!i.getPlugin(d)){if(t.resourcePackages){if(t.resourcePackages.some((function(e){return e.name===d})))continue;if(e.visualHost.CustomVisualsUtils.isOrganizationalCustomVisual(d))continue}r=!0;break}}}}return r},t.IsReportSavedAsExploration=function(e){return e.hasExploration||!e.reportUrl},t.shouldDisplayErrorAsNotificationBar=function(t){return t===e.DMTS_NoGatewayWithAllDatasourcesToBindError||t===e.DMTS_MultipleGatewaysWithAllDatasourcesToBindError||t===e.DMTS_DatasourceHasNoCredentialError||t===e.DM_GWPipeline_Client_GatewayUnreachable||t===e.DM_GWPipeline_Client_OAuthTokenRefreshFailedError||t===e.DMTS_UserLostPermissionToDatasourceError||t===e.DMTS_UserNotFoundInADGraphError||t===e.DM_GWPipeline_Gateway_DataSourceAccessError||t===e.DM_GWPipeline_Gateway_DatabaseConnectError||t===e.DM_GWPipeline_Gateway_ServerUnreachable||t===e.DM_GWPipeline_Gateway_ImpersonationError||t===e.DM_GWPipeline_Gateway_InvalidMashupConnectionString||t===e.DM_GWPipeline_Gateway_DatabaseLoginError||t===e.DM_GWPipeline_Gateway_SqlTimeoutException||t===e.DM_GWPipeline_Gateway_AdomdTimeoutException||t===e.DM_GWPipeline_Gateway_InvalidObjectNameException||t===e.DM_GWPipeline_Gateway_ConnectionBrokenException||t===e.DM_GWPipeline_Gateway_MemoryError||t===e.DM_GWPipeline_Gateway_MissingStructureError||t===e.DM_GWPipeline_Gateway_UnprocessedStructureError||t===e.DM_GWPipeline_Gateway_ModelLoadError||t===e.DM_GWPipeline_Gateway_CancellationError||t===e.DM_GWPipeline_Gateway_QueryExecutionError||t===e.DM_GWPipeline_Gateway_RecalculationRequiredError||t===e.DM_GWPipeline_Gateway_AdomdConnectError||t===e.DM_GWPipeline_Gateway_MashupDataAccessError||t===e.RS_CannotRetrieveModel||t===e.RS_AccessDeniedDueToRLSGroup||t===e.RS_AccessDenied},t})();t.ReportUtility=o})(i=t.helpers||(t.helpers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.spinnerAction={name:"spinnerAction"}})(t=e.DetailVisualEvents||(e.DetailVisualEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.constants.ExploreCanvasConstants;t.FixedPhoneCanvasSettings={phoneWidth:i.PhoneAuthoringViewportWidth,phoneHeight:i.PhonePortraitCanvasHeight,phoneGridLayout:{columnCount:i.PhonePortraitColumnCount,rowCount:i.PhonePortraitRowCount,newVisualCellCount:{width:9,height:9}},phoneGridLayoutLegacy:{columnCount:i.PhonePortraitColumnCountLegacy,rowCount:i.PhonePortraitRowCountLegacy,newVisualCellCount:{width:3,height:3}}};var r=(function(){function e(e,t){void 0===t&&(t=0),this.selectedVisualOriginalPosition=-1,this.contract=e,this.canvasLayout=t}return Object.defineProperty(e.prototype,"width",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.width:t.FixedPhoneCanvasSettings.phoneWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.height:t.FixedPhoneCanvasSettings.phoneHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterPaneContractWidth",{get:function(){var e=this.contract.evaluatedObjects&&this.contract.evaluatedObjects.outspacePane&&this.contract.evaluatedObjects.outspacePane.width;return null!=e?e:i.DefaultOutspacePaneWidth},enumerable:!0,configurable:!0}),e})();t.ExploreCanvas=r})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){function i(){return r.createNavigationMenuItems()}t.createNavigationMenuItems=i;var r;!(function(t){function i(){return{items:[r("Duplicate_page",0),r("Rename_page",1),r("Delete_page",2),r("Hide_page",3)]}}function r(t,i){return{key:i,text:e.common.localize.get(t),type:0}}t.createNavigationMenuItems=i})(r||(r={}))})(i=t.ExplorationContainerViewModelFactory||(t.ExplorationContainerViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i,r,o,n,a,s){var l=0===r;return{options:[e.get("ModalDialog_ExportDataSummarized"),e.get("ModalDialog_ExportDataUnderlying")],dataType:0,dataFormat:l&&i?(0).toString():1..toString(),isExlFormatDisabled:!(l&&i),isUnderlyingDisabled:!o,exportDataMode:n,isCsvFormatDisabled:!t,exportXlsxUnsupportedType:r,isExploreAuthorized:a,artifactId:s}}e.create=t})(t=e.ExportDataDialogViewModelFactory||(e.ExportDataDialogViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=jsCommon.EnumExtensions,r=e.data.SQExpr,o=e.data.SQExprConverter,n=e.data.FieldExprPattern;t.getIconClassName=function(e,t,i){var r=t?"_paneColorRefresh":"",o=e.fieldType;if(1===o)return"fieldListFolder"+r;if(5===o)return"none";if(2===o)return"fieldListHierarchy"+r;if(1===e.contract.queryable)return"fieldListError"+r;if(1===e.kind)return e.contract.measure&&e.contract.measure.kpi&&4===e.fieldType?"fieldListKpi"+r:"fieldListMeasure"+r;if(void 0!==e.contract.type&&void 0!==e.contract.type.geography)return"fieldListGeoData"+r;if(0===e.kind){var n=e.contract.column;if(n){if(n.parameterMetadata)return"fieldListParameter"+r;if(n.groupingMetadata)return"fieldListGroup"+r;if(n.calculated)return e.type&&e.type.numeric?"fieldListNumericCalculatedColumn"+r:"fieldListCalculatedColumn"+r;if(!_.isEmpty(n.variations)&&e.type.dateTime)return"fieldListCalendar"+r}if(e.idOnEntityKey)return"fieldListIdentity"+r}return e.type&&e.type.numeric&&1!==e.defaultAggregate&&i?"fieldListNumeric"+r:"none"};var a=(function(){function e(e){this.contract=e,this.showCheckboxes=!0,this.entities=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return this.contract.capabilities.canEdit&&!this.disableEditing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canCreateColumn",{get:function(){return this.canEdit&&this.contract.capabilities.supportsCalculatedColumns!==!1},enumerable:!0,configurable:!0}),e.prototype.findEntity=function(e){return _.find(this.entities,(function(t){return t.name===e}))},e.prototype.findFields=function(e,t,i){var r=this.findEntity(e);if(r)return r.findFields(t,i)},e.prototype.findHierarchies=function(e,t,i){var r=this.findEntity(e);if(r)return r.findHierarchies(t,i)},e.prototype.findKpis=function(e,t,i){var r=this.findEntity(e);if(r)return r.findKpis(t,i)},e.prototype.findKpiMeasures=function(e,t,i){var r=this.findEntity(e);if(r)return r.findKpiMeasures(t,i)},e.prototype.findItems=function(e){var t=[];if(r.isTransformOutputRoleRef(e))return t;var i=o.asFieldPattern(e),a=n.toFieldExprEntityItemPattern(i);if(i){var s=i.hierarchyLevel||i.hierarchyLevelAggr;if(s){var l=this.findHierarchies(a.entity,s.name,s.schema);if(l)for(var c=0,u=l;c<u.length;c++){var p=u[c];t.push(p);for(var h=0,v=p.hierarchyLevels;h<v.length;h++){var g=v[h];g.name===s.level&&t.push(g)}}}else if(i.columnHierarchyLevelVariation){var f=i.columnHierarchyLevelVariation.source.name,y=this.findFields(a.entity,f,a.schema);if(!y)return t;for(var m=0,C=y;m<C.length;m++){var S=C[m];t.push(S);var w=S.properties;if(w)for(var b=0,x=w;b<x.length;b++){var E=x[b];if(E instanceof d&&E.name===i.columnHierarchyLevelVariation.level.name){t.push(E);for(var F=0,V=E.hierarchyLevels;F<V.length;F++){var g=V[F];g.name===i.columnHierarchyLevelVariation.level.level&&t.push(g)}}}}}else{var f=n.getPropertyName(i),y=this.findFields(a.entity,f,a.schema)||this.findKpiMeasures(a.entity,f,a.schema);if(!y)return t;for(var P=0,M=y;P<M.length;P++){var S=M[P];t.push(S)}}}return t},e.prototype.getMenuItems=function(e,t){return this.menuItemFactory.createSchemaMenuItems(this,e,t)},e.getUniqueId=function(){return e._uid++},e._uid=0,e})();t.FieldListConceptualModel=a;var s=(function(){function e(e,t,i){this.hasCheckedProperties=!1,this.contract=e,this.contractSchema=t,this.schema=i,this.properties=[],this.columnsAndMeasures=[],this.hierarchies=[],this.displayFolders=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.displayNameOverride||this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this.contract.description},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorMessage",{get:function(){return this.contract.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"calculated",{get:function(){return this.contract.calculated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iconClassName",{get:function(){return 1===this.contract.queryable?"fieldListError":this.calculated?"fieldListEntityCalculated":this.isMeasureGroup?"fieldListMeasureGroup":void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return i.hasFlag(this.contract.visibility,1)&&_.every(this.properties,(function(e){return!e.isExtension||e.hidden}))},set:function(e){e?this.contract.visibility=i.setFlag(this.contract.visibility,1):this.contract.visibility=i.resetFlag(this.contract.visibility,1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return this.contractSchema.capabilities.canEdit&&!this.schema.disableEditing&&!t.FieldListViewModelUtils.isAbandoned(this.contract)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"private",{get:function(){return i.hasFlag(this.contract.visibility,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showAsVariationsOnly",{get:function(){return i.hasFlag(this.contract.visibility,2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showHidden",{get:function(){return this.schema.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMenu",{get:function(){return this.schema.menuItemFactory.hasEntityMenu()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRefresh",{get:function(){return this.canEdit&&this.contract.capabilities.canRefresh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEditEntity",{get:function(){return this.canEdit&&!this.calculated&&this.contract.capabilities.canEditSource},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canDelete",{get:function(){return this.canEdit&&this.contract.capabilities.canDelete},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRename",{get:function(){return this.canEdit&&this.contract.capabilities.canRename},enumerable:!0,configurable:!0}),e.prototype.findFields=function(e,t){return this.findFieldsByType(e,t,0)},e.prototype.findKpis=function(e,t){return this.findFieldsByType(e,t,4)},e.prototype.findKpiMeasures=function(e,t){return this.findFieldsByType(e,t,5)},e.prototype.findHierarchies=function(e,t){return this.findFieldsByType(e,t,2)},e.prototype.findFieldsByType=function(e,t,i){var r=[];2===i?r.push.apply(r,_.filter(this.hierarchies,(function(i){return i.name===e&&i.schema.name===t}))):r.push.apply(r,_.filter(this.properties,(function(r){return r.name===e&&r.fieldType===i&&r.schemaName===t})));for(var o=0,n=this.displayFolders;o<n.length;o++)for(var a=n[o],s=0,l=_.filter(a.getAllChildren(),(function(t){return t.name===e&&t.fieldType===i}));s<l.length;s++){var c=l[s];r.indexOf(c)<0&&r.push(c)}if(!_.isEmpty(r))return r},Object.defineProperty(e.prototype,"userEntity",{get:function(){return this.schema.showNonUserEntities||!(this.private||this.showAsVariationsOnly)},enumerable:!0,configurable:!0}),e.prototype.getMenuItems=function(){return this.schema.menuItemFactory.createEntityMenuItems(this)},e})();t.FieldListConceptualEntity=s;var l=(function(){function e(e,t,i){this.hasCheckedChildren=!1,this.contract=e,this.schema=t,this.entity=i,this.id=a.getUniqueId()}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schemaName",{get:function(){return this.schema.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.displayNameOverride||this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this.contract.description},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorMessage",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return!this.parent||this.parent.expanded&&this.parent.visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.contract.hidden},set:function(e){this.contract.hidden=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showHidden",{get:function(){return this.entity.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return!this.variation&&this.schema.capabilities.canEdit&&!this.entity.schema.disableEditing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableDragging",{get:function(){return this.entity.schema.disableDragging},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showCheckboxes",{get:function(){return this.entity.schema.showCheckboxes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMenu",{get:function(){return this.entity.schema.menuItemFactory.hasPropertyMenu()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExtension",{get:function(){return!1},enumerable:!0,configurable:!0}),e})();t.FieldListConceptualItem=l;var c=(function(e){function t(t,i,r,o,n){var a=e.call(this,t,i,r)||this;return a.children=[],a.originalEntity=o,a.variation=n,a.expanded=!1,a.draggable=!a.disableDragging,a.fieldType=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return this.contract.column?this.contract.column.defaultAggregate:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.contract.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!!this.contract.column&&this.contract.column.idOnEntityKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorMessage",{get:function(){return this.contract.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return this.canEdit&&this.contract.canDelete!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canAddToFilter",{get:function(){return!this.contract.measure||!this.schema.capabilities.limitMultiColumnFiltersToQueryGroupColumns},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.children},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(e,t){return this.entity.schema.menuItemFactory.createPropertyMenuItems(this,e,t)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.template=this.template,e},t})(l);t.FieldListConceptualProperty=c;var u=(function(e){function t(t,i,r){return e.call(this,t,i,r)||this}return __extends(t,e),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExtension",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(e,t){return this.entity.schema.menuItemFactory.createExtensionMeasureMenuItems(this,e,t)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.template=this.template,e},t})(c);t.FieldListConceptualExtensionMeasure=u;var p=(function(e){function t(t,i,r,o,n,a){var s=this;return s=e.call(this,t.column,i,o)||this,s.originalEntity=n,s.variation=a,s.hierarchyLevelContract=t,s.parent=r,s.fieldType=3,s}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return this.parent.hidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.hierarchyLevelContract.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this.displayNameOverride||this.hierarchyLevelContract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.hierarchyLevelContract.description},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return!this.variation&&this.canEdit&&this.hierarchyLevelContract.canDelete!==!1},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(e,t){return this.entity.schema.menuItemFactory.createHierarchyLevelMenuItems(this,e,t)},t.prototype.clone=function(e){var i=e||this.parent,r=new t(this.hierarchyLevelContract,this.schema,i,this.entity);return r.template=this.template,r},t})(c);t.FieldListConceptualHierarchyLevel=p;var d=(function(e){function t(t,i,r,o,n){var a=e.call(this,t,i,r)||this;return a.expanded=!1,a.hierarchyLevels=[],a.originalEntity=o,a.variation=n,a.draggable=!a.disableDragging,a.fieldType=2,a}return __extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return!this.variation&&this.canEdit&&this.contract.canDelete!==!1},enumerable:!0,configurable:!0}),t.prototype.findLevel=function(e,t){return _.find(this.hierarchyLevels,(function(t){return t.name===e}))},t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createHierarchyMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.hierarchyLevels=_.map(this.hierarchyLevels,(function(t){return t.clone(e)})),e.template=this.template,e},t})(l);t.FieldListConceptualHierarchy=d;var h=(function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.expanded=!1,o.kpiMeasures=[],o.fieldType=4,o}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createKpiMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.kpiMeasures=_.map(this.kpiMeasures,(function(t){return t.clone(e)})),e.template=this.template,e},t})(l);t.FieldListConceptualKpi=h;var v=(function(e){function t(t,i,r,o,n,a){var s=this;return s=e.call(this,t,i,n)||this,s.kpiType=r,s.parent=o,s.locOptions=a,s.draggable=!s.disableDragging,s.fieldType=5,s}return __extends(t,e),Object.defineProperty(t.prototype,"displayName",{get:function(){var e;switch(this.kpiType){case 2:e=this.locOptions.KpiValueDisplayName;break;case 1:e=this.locOptions.KpiGoalDisplayName;break;case 0:e=this.locOptions.KpiStatusDisplayName;break;case 3:e=this.locOptions.KpiTrendDisplayName}return this.displayNameOverride||e||this.contract.displayName},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createKpiMeasureMenuItems(this)},t.prototype.clone=function(e){var i=e||this.parent,r=new t(this.contract,this.schema,this.kpiType,i,this.entity,this.locOptions);return r.template=this.template,r},t})(c);t.FieldListConceptualKpiMeasure=v;var g=(function(e){function t(t,i,r,o,n){var a=e.call(this,t,o,n)||this;a.expanded=!1,a.parent=r,a.children=i,a.fieldType=1;for(var s=0,l=i;s<l.length;s++){l[s].parent=a}return a}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return!_.some(this.children,(function(e){return!e.hidden}))},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMenu",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return{items:[]}},t.prototype.clone=function(){},t.prototype.getAllChildren=function(){for(var e=[],t=0,i=this.children;t<i.length;t++){var r=i[t];e.push(r),1===r.fieldType&&e.push.apply(e,r.getAllChildren())}return e},t})(l);t.FieldListConceptualDisplayFolder=g})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.fieldListAction={name:"fieldListAction"}})(t=e.FieldListEvents||(e.FieldListEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i){return new l(e,t,i)}var o=e.explore.utils.GroupUtils,n=e.explore.util.HierarchyUtils;i.createFieldListMenuItemFactory=r;var a;!(function(e){function t(){return{type:1,checked:!1}}function i(e,t,i,r){return{text:i.getOptional(e)||e,key:t,type:0,checked:r}}e.createItemSeparator=t,e.createFieldListMenuItem=i})(a=i.FieldListMenuItemViewModelGenerator||(i.FieldListMenuItemViewModelGenerator={}));var s;!(function(e){e[e.Check=0]="Check",e[e.Uncheck=1]="Uncheck",e[e.HierarchyCreate=2]="HierarchyCreate",e[e.HierarchyAddTo=3]="HierarchyAddTo",e[e.Create=4]="Create",e[e.PageRefresh=5]="PageRefresh",e[e.Entity=6]="Entity",e[e.Copy=7]="Copy",e[e.Edit=8]="Edit",e[e.Hidden=9]="Hidden",e[e.ExpandCollapse=10]="ExpandCollapse",e[e.Groups=11]="Groups",e[e.AddToFilters=12]="AddToFilters",e[e.AddToDrillthrough=13]="AddToDrillthrough",e[e.TopN=14]="TopN"})(s||(s={}));var l=(function(){function e(e,t,i){this.localizationService=e,this.featureSwitchService=t,this.groupingDesignStateService=i}return e.prototype.createSchemaMenuItems=function(e,t,i){var r=this.canAuthorReportMeasuresOnSchema(e.contract);return this.createMenuItems({canViewHidden:e.canEdit||r,canUnHideAll:e.canEdit||r,canExpandCollapseAll:!0,showHidden:e.showHidden,isVisualSelected:t,visualFilters:i})},e.prototype.createEntityMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e),i=this.createMenuSections({canDelete:e.canDelete,canRename:e.canRename,canViewHidden:e.schema.canEdit||t,canUnHideAll:e.schema.canEdit||t,canExpandCollapseAll:!0,isEntity:!0,canRefresh:e.canRefresh,canHide:e.schema.canEdit,canEditEntity:e.canEditEntity,canCreateColumn:e.schema.canCreateColumn,canCreateMeasure:e.canEdit||this.canCreateNewReportMeasureOnEntity(e),hidden:e.hidden,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e),canShowIncrementalRefreshPolicy:e.canEditEntity&&this.featureSwitchService.featureSwitches.showIncrementalRefreshPolicy,canShowManageAggregations:e.canEditEntity&&this.featureSwitchService.featureSwitches.showManageAggregations,canShowChangeDetection:this.isChangeDetectionSupported(e)});return this.canMarkCustomDateTable(e)&&this.createCustomDateTableSection(i,e),{items:this.getMenuItemsAndSeparators(i)}},e.prototype.createHierarchyMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity);return this.createMenuItems({canDelete:e.canDelete,canRename:e.canEdit,canAddField:e.entity.schema.showCheckboxes&&!e.checked,canRemoveField:e.checked,canHide:e.canEdit&&e.entity.schema.canEdit,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden
})},e.prototype.createHierarchyLevelMenuItems=function(e,t,i){var r=this.canAuthorReportMeasuresOnEntity(e.entity),o=e.parent.contract.levels;return this.createMenuItems({canAddToFilter:!0,isVisualSelected:t,visualFilters:i,canAddField:e.entity.schema.showCheckboxes&&!e.checked,canRemoveField:e.checked,canDelete:e.canDelete,canRename:e.canEdit,canMoveUp:e.canEdit&&_.head(o).name!==e.hierarchyLevelContract.name,canMoveDown:e.canEdit&&_.last(o).name!==e.hierarchyLevelContract.name,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||r,canUnHideAll:e.entity.schema.canEdit||r,canExpandCollapseAll:!0,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e.entity),canShowChangeDetection:!1})},e.prototype.createPropertyMenuItems=function(e,t,i){var r=this.canAuthorReportMeasuresOnEntity(e.entity),n=this.createMenuSections({canAddToFilter:e.canAddToFilter,isVisualSelected:t,visualFilters:i,canAddField:e.entity.schema.showCheckboxes&&!e.checked,canRemoveField:e.checked,canDelete:this.canDeleteProperty(e),canRename:e.canEdit,canHide:e.canEdit,canGroup:e.canEdit&&this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&0===e.kind&&o.canPropertyBeGrouped(e.contract)&&e.schema.capabilities.supportsGrouping!==!1,canEditGroups:e.canEdit&&this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&o.isGroupOrBinColumn(e.entity.name,e.contract,this.groupingDesignStateService)&&e.schema.capabilities.supportsGrouping!==!1,canEditClustering:e.canEdit&&this.groupingDesignStateService&&o.isClusteringColumn(e.entity.name,e.contract,this.groupingDesignStateService)&&e.schema.capabilities.supportsGrouping!==!1,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||r,canUnHideAll:e.entity.schema.canEdit||r,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e.entity),canShowChangeDetection:this.isChangeDetectionSupported(e.entity)});return e.entity.canEdit&&1!==e.kind&&this.createHierarchyMenuSections(e,n),{items:this.getMenuItemsAndSeparators(n)}},e.prototype.canDeleteProperty=function(e){return e.canDelete&&!(e.entity&&e.entity.calculated&&e.contract.column&&!e.contract.column.calculated)},e.prototype.canCreateNewReportMeasureOnEntity=function(e){return this.canAuthorReportMeasuresOnEntity(e)&&!i.FieldListViewModelUtils.isAbandoned(e.contract)},e.prototype.canAuthorReportMeasuresOnEntity=function(e){return e.contractSchema.isExtensionSchema?e.contractSchema.capabilities.canEdit:this.canAuthorReportMeasuresOnSchema(e.contractSchema)},e.prototype.canAuthorReportMeasuresOnSchema=function(e){return e.capabilities.isExtendable},e.prototype.createExtensionMeasureMenuItems=function(e,t,i){return this.createPropertyMenuItems(e,t)},e.prototype.createKpiMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity);return this.createMenuItems({canDelete:e.canEdit,canRename:e.canEdit,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.createKpiMeasureMenuItems=function(e){return this.createMenuItems({canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.hasPropertyMenu=function(){return!0},e.prototype.hasEntityMenu=function(){return!0},e.prototype.createMenuItems=function(e){return{items:this.getMenuItemsAndSeparators(this.createMenuSections(e))}},e.prototype.createMenuSections=function(e){var i=[];if(e.canAddToFilter){var r=this.addMenuItem(i,s.AddToFilters,"FieldListMenuItem_AddToFilters",void 0),o=[a.createFieldListMenuItem("FieldListMenuItem_PageLevelFilters",{action:25},this.localizationService),a.createFieldListMenuItem("FieldListMenuItem_ReportLevelFilters",{action:26},this.localizationService)];e.isVisualSelected&&o.unshift(a.createFieldListMenuItem("FieldListMenuItem_VisualLevelFilters",{action:24},this.localizationService)),r.children=o,this.addMenuItem(i,s.AddToDrillthrough,"FieldListMenuItem_AddToDrillthrough",27)}if(e.canAddField&&this.addMenuItem(i,s.Check,"FieldListMenuItem_Check",28),e.visualFilters&&e.visualFilters.length>0){for(var n=[],l=0,c=e.visualFilters;l<c.length;l++){var u=c[l];u.contract&&u.contract.type===t.contracts.FilterType.TopN&&n.push(a.createFieldListMenuItem(u.displayName,{action:31,filter:u},this.localizationService))}if(n&&n.length>0){this.addMenuItem(i,s.TopN,"FieldListMenuItem_AddToTopNByValue",void 0).children=n}}return e.canRemoveField&&this.addMenuItem(i,s.Uncheck,"FieldListMenuItem_Uncheck",29),e.canCreateMeasure&&this.addMenuItem(i,s.Create,"FieldListMenuItem_NewMeasure",9),e.canCreateColumn&&this.addMenuItem(i,s.Create,"FieldListMenuItem_NewColumn",12),e.canCreateQuickCalcMeasure&&this.addMenuItem(i,s.Create,"QuickCalc_NewMeasure",18),e.canShowChangeDetection&&this.addMenuItem(i,s.PageRefresh,"ChangeDetection",32),e.isEntity&&(e.canRefresh&&this.addMenuItem(i,s.Entity,"FieldListMenuItem_RefreshEntity",5),e.canEditEntity&&this.addMenuItem(i,s.Entity,"FieldListMenuItem_EditEntity",8),e.canShowIncrementalRefreshPolicy&&this.addMenuItem(i,s.Entity,"Incremental_Refresh_Label_Generic",22),e.canShowManageAggregations&&this.addMenuItem(i,s.Entity,"ManageAggregations",23),e.canCopyTable&&this.addMenuItem(i,s.Copy,"DataExplorerFieldListMenuItem_CopyTable",19)),e.canMoveUp&&this.addMenuItem(i,s.Edit,"FieldListMenuItem_MoveUp",6),e.canMoveDown&&this.addMenuItem(i,s.Edit,"FieldListMenuItem_MoveDown",7),e.canRename&&this.addMenuItem(i,s.Edit,"ItemAction_Rename",3),e.canDelete&&this.addMenuItem(i,s.Edit,"Delete",4),e.canHide&&this.addMenuItem(i,s.Edit,"FieldListMenuItem_Hide",0,e.hidden),e.canHideInReportView&&this.addMenuItem(i,s.Edit,"FieldListMenuItem_HideInReportView",0,e.hidden),(e.canUnHideAll||e.canViewHidden)&&(e.canViewHidden&&this.addMenuItem(i,s.Hidden,"FieldListMenuItem_ViewHidden",1,e.showHidden),e.canUnHideAll&&this.addMenuItem(i,s.Hidden,"FieldListMenuItem_UnHideAll",2)),e.canExpandCollapseAll&&(this.addMenuItem(i,s.ExpandCollapse,"FieldListMenuItem_CollapseAll",13),this.addMenuItem(i,s.ExpandCollapse,"FieldListMenuItem_ExpandAll",14)),e.canGroup&&this.addMenuItem(i,s.Groups,"ContextMenuItem_CreateGroups",15),e.canEditGroups&&this.addMenuItem(i,s.Groups,"ContextMenuItem_EditGroups",16),e.canEditClustering&&this.addMenuItem(i,s.Groups,"Clustering_EditClusters",17),i},e.prototype.createHierarchyMenuSections=function(e,t){var r=e.contract,o=e.entity.contract.hierarchies;if(this.addMenuItem(t,s.HierarchyCreate,"FieldListMenuItem_NewHierarchy",10),!_.isEmpty(o)){var a=o.slice(0);n.sortHierarchies(a);var l=i.FieldListViewModelUtils.getHierarchyLevelDictionary(o),c=_.filter(a,(function(e){var t=l[e.name];return!(t&&t[r.name])})),u=_.map(c,(function(e){return{text:e.displayName,key:{action:11,hierarchyName:e.name},type:0,checked:!1}}));if(!_.isEmpty(u)){this.addMenuItem(t,s.HierarchyAddTo,"FieldListMenuItem_AddToHierarchy",void 0).children=u}}return t},e.prototype.createCustomDateTableSection=function(e,t){var i=this.addMenuItem(e,s.Edit,"MarkAsDateTable",void 0),r=a.createFieldListMenuItem("MarkAsDateTable",{action:20},this.localizationService,t.contract.isDateTable),o=a.createFieldListMenuItem("DateTableSettings",{action:21},this.localizationService,!1);return o.disabled=!t.contract.isDateTable,i.children=[r,o],e},e.prototype.addMenuItem=function(e,t,i,r,o){var n=a.createFieldListMenuItem(i,void 0!==r?{action:r}:void 0,this.localizationService,o);return this.addMenuItems(e,t,[n]),n},e.prototype.addMenuItems=function(e,t,i){var r=e[t];r||(r=[],e[t]=r),r.push.apply(r,i)},e.prototype.getMenuItemsAndSeparators=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];_.size(o)>0&&(t.length>0&&t.push(a.createItemSeparator()),t.push.apply(t,o))}return t},e.prototype.isQuickMeasureSupported=function(e){return e.schema.canEdit||e.contractSchema.capabilities.isExtendable},e.prototype.isChangeDetectionSupported=function(e){return e.schema.canEdit&&e.contractSchema.capabilities.supportsFastRefresh&&this.featureSwitchService.featureSwitches.realTimeRefresh&&this.featureSwitchService.featureSwitches.changeDetection},e.prototype.canMarkCustomDateTable=function(e){return!!e.schema.canEdit&&_.some(e.contract.properties,(function(e){return e.type.dateTime}))},e})();i.FieldListMenuItemFactory=l})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}e.DefaultPropertyTemplate="Default",e.FolderPropertyTemplate="Folder",e.KpiPropertyTemplate="Kpi",e.HierarchyPropertyTemplate="Hierarchy",e.LeafPropertyTemplate="Leaf",e.createFieldListPropertyTemplateGenerator=t;var i=(function(){function t(){}return t.prototype.getTemplate=function(t){switch(t.fieldType){case 0:return this.getTemplateUri(e.DefaultPropertyTemplate);case 1:return this.getTemplateUri(e.FolderPropertyTemplate);case 4:return this.getTemplateUri(e.KpiPropertyTemplate);case 2:return this.getTemplateUri(e.HierarchyPropertyTemplate);case 5:case 3:return this.getTemplateUri(e.LeafPropertyTemplate);default:return this.getTemplateUri(e.DefaultPropertyTemplate)}},t.prototype.getTemplateUri=function(e){return"views/fieldListProperty"+e+".html"},t})();e.FieldListPropertyTemplateGenerator=i})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){return new i(e,t,r,o)}e.createFieldListViewModelFactory=t;var i=(function(){function t(e,t,i,r){this.menuItemFactory=e,this.propertyTemplateGenerator=t,this.localizationService=i,this.featureSwitchService=r}return Object.defineProperty(t.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),t.prototype.createModel=function(t,i,r,o){var n,a=t.schemas,s=e.FieldListViewModelUtils.getExtensions(a);a=e.FieldListViewModelUtils.sortExtensionSchemasAtEnd(a);for(var l=0,c=a;l<c.length;l++){var u=c[l];n=this.convertConceptualSchema(u,i,n,s,r,o)}return e.FieldListViewModelOperations.expandIfSingleEntity(n.entities),n},t.prototype.convertConceptualSchema=function(t,i,r,o,n,a){var s,l=this;r=r||new e.FieldListConceptualModel(t),r.disableDragging=a;var c=_.filter(t.entities,(function(t){return!e.FieldListViewModelUtils.isExtension(t)||e.FieldListViewModelUtils.isAbandoned(t)})),u=_.map(c,(function(e){return l.convertConceptualEntity(e,t,r,o)}));return(s=r.entities).push.apply(s,u),r.showNonUserEntities=i,r.disableEditing=n,r.menuItemFactory=this.menuItemFactory,r},t.prototype.convertConceptualEntity=function(t,i,r,o){var n,a=this,s=new e.FieldListConceptualEntity(t,i,r);if(s.properties=[],t.properties&&!e.FieldListViewModelUtils.isExtension(t))for(var l=0,c=t.properties;l<c.length;l++){var u=c[l];if(u.measure&&u.measure.kpi){var p=this.convertConceptualKpi(u,i,s);s.columnsAndMeasures.push(p),s.properties.push(p)}else if(!u.kpiValue){var p=this.convertConceptualProperty(u,i,s);s.columnsAndMeasures.push(p),s.properties.push(p)}}if(s.isMeasureGroup=e.FieldListViewModelUtils.isMeasureGroup(t.properties),s.expanded=!1,t.hierarchies&&t.hierarchies.length>0){s.hierarchies=_.map(t.hierarchies,(function(e){return a.convertConceptualHierarchy(e,i,s)}));for(var d=0,h=s.hierarchies;d<h.length;d++){var v=h[d];s.properties.push(v)}}if(!_.isEmpty(t.displayFolders)){var g;s.displayFolders=_.map(t.displayFolders,(function(e){return a.convertConceptualDisplayFolder(e,i,g,s)})),(n=s.properties).push.apply(n,s.displayFolders)}if(o){var f=e.FieldListViewModelUtils.getExtensionKey(i.name,t.name),y=o.entities[f];if(y)for(var m=0,C=y;m<C.length;m++)for(var S=C[m],w=0,b=S.entity.properties;w<b.length;w++){var u=b[w],x=this.convertConceptualExtensionMeasure(u,S.schema,s);s.properties.push(x)}}return e.FieldListViewModelUtils.sortProperties(s.properties),e.FieldListViewModelUtils.removeDuplicateProperties(s.properties,s.displayFolders),e.FieldListViewModelUtils.flattenFolders(s),e.FieldListViewModelUtils.updatePropertiesWithChildren(s),s},t.prototype.convertConceptualDisplayFolder=function(e,t,i,r){for(var o={},n={},a=0,s=r.properties;a<s.length;a++){var l=s[a];3===l.fieldType||2===l.fieldType?n[l.name]=l:o[l.name]=l}return this.convertConceptualDisplayFolderCore(e,t,i,o,n,r)},t.prototype.convertConceptualDisplayFolderCore=function(t,i,r,o,n,a){for(var s=[],l=0,c=t.properties;l<c.length;l++){var u=c[l];if(u){var p=o[u.name];p&&s.push(p.clone())}}for(var d=0,h=t.hierarchies;d<h.length;d++){var v=h[d];if(v){var p=n[v.name];p&&s.push(p.clone())}}var g=new e.FieldListConceptualDisplayFolder(t,s,r,i,a);g.template=this.propertyTemplateGenerator.getTemplate(g);for(var f=0,y=t.displayFolders;f<y.length;f++){var m=y[f];g.children.push(this.convertConceptualDisplayFolderCore(m,i,g,o,n,a))}return e.FieldListViewModelUtils.sortProperties(g.children),g},t.prototype.convertConceptualHierarchy=function(t,i,r,o,n){var a=new e.FieldListConceptualHierarchy(t,i,r,o,n);a.template=this.propertyTemplateGenerator.getTemplate(a),a.hierarchyLevels=[];for(var s=0,l=t.levels;s<l.length;s++){var c=l[s];a.hierarchyLevels.push(this.convertConceptualHierarchyLevel(c,i,a))}return a},t.prototype.convertConceptualHierarchyLevel=function(t,i,r){var o=new e.FieldListConceptualHierarchyLevel(t,i,r,r.entity,r.originalEntity,r.variation);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualProperty=function(t,i,r){var o=new e.FieldListConceptualProperty(t,i,r);o.template=this.propertyTemplateGenerator.getTemplate(o);for(var n=0,a=e.FieldListViewModelUtils.getPropertyVariations(t);n<a.length;n++){var s=a[n];o.children.push(this.convertConceptualVariationHierarchy(s,i,o))}return o},t.prototype.convertConceptualVariationHierarchy=function(e,t,i){var r=this.convertConceptualHierarchy(e.defaultHierarchy,t,i.entity,e.navigationProperty.targetEntity,e.name);return r.parent=i,r},t.prototype.convertConceptualExtensionMeasure=function(t,i,r){var o=new e.FieldListConceptualExtensionMeasure(t,i,r);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualKpi=function(t,i,r){var o=new e.FieldListConceptualKpi(t,i,r);o.template=this.propertyTemplateGenerator.getTemplate(o);var n={};n.KpiValueDisplayName=this.localizationService.get("KpiValueFieldListDisplayName"),n.KpiStatusDisplayName=this.localizationService.get("KpiStatusFieldListDisplayName"),n.KpiGoalDisplayName=this.localizationService.get("KpiGoalFieldListDisplayName"),n.KpiTrendDisplayName=this.localizationService.get("KpiTrendFieldListDisplayName");var a=t.measure.kpi,s=a.goal,l=a.status,c=a.trend;return o.kpiMeasures=[],o.kpiMeasures.push(this.convertConceptualKpiMeasure(t,i,2,o,r,n)),s&&o.kpiMeasures.push(this.convertConceptualKpiMeasure(s,i,1,o,r,n)),l&&o.kpiMeasures.push(this.convertConceptualKpiMeasure(l,i,0,o,r,n)),c&&o.kpiMeasures.push(this.convertConceptualKpiMeasure(c,i,3,o,r,n)),o},t.prototype.convertConceptualKpiMeasure=function(t,i,r,o,n,a){var s=new e.FieldListConceptualKpiMeasure(t,i,r,o,n,a);return s.template=this.propertyTemplateGenerator.getTemplate(s),s},t})()})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.explore.util.ModelAuthoringUtility;!(function(i){function o(e){return _.find(e,(function(e){return!e.hidden}))&&!_.find(e,(function(e){return!e.hidden&&1!==e.kind&&2!==e.kind}))}function n(e){for(var t={entities:{}},i=0,r=e;i<r.length;i++){var o=r[i];if(l(o))for(var n=o.extends,a=0,c=o.entities;a<c.length;a++){var u=c[a];if(l(u)){var p={schema:o,entity:u},d=s(n,u.name),h=t.entities[d];h?h.push(p):(h=[p],t.entities[d]=h)}}}return t}function a(e){var t=_.filter(e,(function(e){return!l(e)})),i=_.filter(e,(function(e){return l(e)}));return _.union(t,i)}function s(e,t){return JSON.stringify({e:t})}function l(e){return e.hasOwnProperty("extends")}function c(e){return e.isAbandoned}function u(e){for(var t=e.properties,i=[],r=0,o=t;r<o.length;r++){p(i,o[r])}e.properties=i}function p(e,i){if(e.push(i),(i instanceof t.FieldListConceptualKpi||i instanceof t.FieldListConceptualHierarchy||i instanceof t.FieldListConceptualProperty)&&!_.isEmpty(i.properties))for(var r=0,o=i.properties;r<o.length;r++){var n=o[r];p(e,n)}}function d(e){e&&e.sort((function(e,t){return h(e.displayName,t.displayName)}))}function h(e,t){return e=(e||"").toLocaleUpperCase(),t=(t||"").toLocaleUpperCase(),e.localeCompare(t)}function v(e,t){if(!_.isEmpty(e)){var i={};g(t,i),_.remove(e,(function(e){return 1!==e.fieldType&&i[e.name]}))}}function g(e,t){if(!_.isEmpty(e)){for(var i=[],r=0,o=e;r<o.length;r++)for(var n=o[r],a=0,s=n.children;a<s.length;a++){var l=s[a];1===l.fieldType?i.push(l):t[l.name]=l}g(i,t)}}function f(e){var t=[];y(e.properties,t),e.properties=t}function y(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(t.push(o),1===o.fieldType){y(o.children,t)}}}function m(e,t){return _.find(e.entities,(function(e){return e.contract===t}))}function C(e){var t={};if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i],n={};t[o.name]=n;for(var a=0,s=o.levels;a<s.length;a++){var l=s[a];n[l.column.name]=l}}return t}function S(e){var t=[];if(e.column&&e.column.variations)for(var i=0,r=e.column.variations;i<r.length;i++){var o=r[i],n=o.navigationProperty.targetEntity,a=o.defaultHierarchy;n&&n.hierarchies&&a&&!a.hidden&&t.push(o)}return t}function w(t,i,o,n,a,s){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(l){switch(l.label){case 0:n.displayNameOverride=s,l.label=1;case 1:return l.trys.push([1,,5,6]),e=r.rename(a,s,o),e?[4,e]:[3,4];case 2:return l.sent(),[4,t.get(i.get())];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:return n.displayNameOverride=null,[7];case 6:return[2]}}))}))}i.isMeasureGroup=o,i.getExtensions=n,i.sortExtensionSchemasAtEnd=a,i.getExtensionKey=s,i.isExtension=l,i.isAbandoned=c,i.updatePropertiesWithChildren=u,i.sortProperties=d,i.compareAlphabeticallyIgnoreCase=h,i.removeDuplicateProperties=v,i.flattenFolders=f,i.findTargetEntityViewModel=m,i.getHierarchyLevelDictionary=C,i.getPropertyVariations=S,i.applyItemRename=w})(i=t.FieldListViewModelUtils||(t.FieldListViewModelUtils={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t,i,r,o,s,l){return new n(i,new a,o,s,l,r).mergeFieldList(e,t)}function r(e){return!!e.measure&&!!e.measure.kpi}function o(e){return!!e.kpiValue}t.mergeModel=i;var n=(function(){function t(e,t,i,r,o,n){this.factory=e,this.sorter=t,this.showNonUserEntities=i,this.disableEditing=r,this.disableDragging=o,this.schemaChanges=n?n.changes:[]}return t.prototype.mergeFieldList=function(e,t){return e&&t||(e={schema:void 0,isLoaded:!1}),t&&_.some(t.schemas)&&(e.schema=this.mergeSchemas(e,t),e.isLoaded=!0),e},t.prototype.mergeSchemas=function(t,i){var r=t.schema;if(r){var o=e.FieldListViewModelUtils.getExtensions(i.schemas),n=e.FieldListViewModelUtils.sortExtensionSchemasAtEnd(i.schemas);r.contract=_.find(n,(function(t){return!e.FieldListViewModelUtils.isExtension(t)}));for(var a=new l(r.entities),s=0,c=n;s<c.length;s++)for(var u=c[s],p=0,d=u.entities;p<d.length;p++){var h=d[p];if(!e.FieldListViewModelUtils.isExtension(h)||e.FieldListViewModelUtils.isAbandoned(h)){var v=this.mergeEntity(r,u,h,o);u===r.contract&&a.add.apply(a,v)}}r.entities=a.merge(),this.sorter.sortEntities(r.entities),e.FieldListViewModelOperations.expandIfSingleEntity(r.entities)}else r=this.factory.createModel(i,this.showNonUserEntities,this.disableEditing,this.disableDragging);return r},t.prototype.mergeEntity=function(t,i,r,o){var n=this.findEntityVm(t,r);if(n){n.contract=r;var a=new l(n.properties),c=new l(n.columnsAndMeasures),u=new l(n.hierarchies),p=new s(n,this.schemaChanges);if(!e.FieldListViewModelUtils.isExtension(r))for(var d=0,h=r.properties;d<h.length;d++){var v=h[d],g=this.mergePropertyMeasureOrKpi(n,i,v,p);a.add.apply(a,g),c.add.apply(c,g)}for(var f=0,y=r.hierarchies;f<y.length;f++){var m=y[f],C=this.mergeHierarchy(n,i,m,p);a.add.apply(a,C),u.add.apply(u,C)}var S=o.entities[e.FieldListViewModelUtils.getExtensionKey(i.name,r.name)];if(S)for(var w=0,b=S;w<b.length;w++)for(var x=b[w],E=0,F=x.entity.properties;E<F.length;E++){var v=F[E],V=this.mergeExtensionMeasure(n,x.schema,v,p);a.add.apply(a,V),c.add.apply(c,V)}n.columnsAndMeasures=c.merge((function(e){return!e.parent})),n.hierarchies=u.merge((function(e){return!e.parent})),n.properties=a.merge((function(e){return!e.parent})),this.mergeDisplayFolders(n,r.displayFolders),this.sorter.sortProperties(n.properties),e.FieldListViewModelUtils.removeDuplicateProperties(n.properties,n.displayFolders),e.FieldListViewModelUtils.flattenFolders(n),e.FieldListViewModelUtils.updatePropertiesWithChildren(n)}else n=this.factory.convertConceptualEntity(r,i,t,o);return[n]},t.prototype.findEntityVm=function(t,i){var r=i.name,o=_.find(this.schemaChanges,(function(e){return e.entityRename&&e.entityRename.after===i.name}));o&&(r=o.entityRename.before);var n=t.findEntity(r);return n&&e.FieldListViewModelUtils.isAbandoned(n.contract)!==e.FieldListViewModelUtils.isAbandoned(i)?null:n},t.prototype.mergePropertyMeasureOrKpi=function(t,i,n,a){if(!e.FieldListViewModelUtils.isExtension(n)){if(r(n))return this.mergeKpi(t,i,n,a);if(!o(n))return this.mergeProperty(t,i,n,a)}},t.prototype.mergeProperty=function(t,i,r,o){var n=o.findVms(i.name,r.name,0);if(n=_.filter(n,(function(e){return!e.isExtension})),_.isEmpty(n))n=[this.factory.convertConceptualProperty(r,i,t)];else for(var a=0,s=n;a<s.length;a++){var c=s[a];c.contract=r;for(var u=new l(c.children),p=0,d=e.FieldListViewModelUtils.getPropertyVariations(r);p<d.length;p++){var h=d[p];u.add(this.mergeVariationHierarchy(c,i,h))}c.children=u.merge()}return n},t.prototype.mergeVariationHierarchy=function(t,i,r){var o=_.find(t.children,(function(t){return t instanceof e.FieldListConceptualHierarchy&&t.variation===r.name}));return o?this.updateHierarchyVm(t.entity,o,r.defaultHierarchy,i):o=this.factory.convertConceptualVariationHierarchy(r,i,t),o},t.prototype.mergeExtensionMeasure=function(e,t,i,r){var o=r.findVms(t.name,i.name,0);return o=_.filter(o,(function(e){return e.isExtension})),_.isEmpty(o)?o=[this.factory.convertConceptualExtensionMeasure(i,t,e)]:_.forEach(o,(function(e){return e.contract=i})),o},t.prototype.mergeKpi=function(e,t,i,r){var o=r.findVms(t.name,i.name,4);if(_.isEmpty(o))o=[this.factory.convertConceptualKpi(i,t,e)];else for(var n=0,a=o;n<a.length;n++){var s=a[n];s.contract=i;var c=new l(s.kpiMeasures);c.add(this.mergeKpiMeasure(s,i,2)),i.measure.kpi.goal&&c.add(this.mergeKpiMeasure(s,i.measure.kpi.goal,1)),i.measure.kpi.status&&c.add(this.mergeKpiMeasure(s,i.measure.kpi.status,0)),i.measure.kpi.trend&&c.add(this.mergeKpiMeasure(s,i.measure.kpi.trend,3)),_.some(c,(function(e){return null===e}))?s.kpiMeasures=this.factory.convertConceptualKpi(i,t,e).kpiMeasures:s.kpiMeasures=c.merge()}return o},t.prototype.mergeKpiMeasure=function(e,t,i){var r=_.find(e.kpiMeasures,(function(e){return e.kpiType===i}));return r?(r.contract=t,r):null},t.prototype.mergeHierarchy=function(e,t,i,r){var o=r.findVms(t.name,i.name,2);if(_.isEmpty(o)){var n=this.factory.convertConceptualHierarchy(i,t,e);_.some(this.schemaChanges,(function(t){return t.hierarchyCreate&&t.hierarchyCreate.entity===e.name&&t.hierarchyCreate.name===n.name}))&&(n.expanded=!0),o=[n]}else for(var a=0,s=o;a<s.length;a++){var l=s[a];this.updateHierarchyVm(e,l,i,t)}return o},t.prototype.updateHierarchyVm=function(e,t,i,r){t.contract=i;for(var o=_.keyBy(t.hierarchyLevels,(function(e){return e.name})),n=new l(t.hierarchyLevels),a=0,s=i.levels;a<s.length;a++){var c=s[a],u=this.mergeHierarchyLevel(e,t,r,c,o);n.add(u)}t.hierarchyLevels=n.merge()},t.prototype.mergeHierarchyLevel=function(e,t,i,r,o){var n=this.findHierarchyLevel(e,t,i,r,o);return n?(n.contract=r.column,n.hierarchyLevelContract=r):n=this.factory.convertConceptualHierarchyLevel(r,i,t),n},t.prototype.findHierarchyLevel=function(e,t,i,r,o){var n=r.name,a=_.find(this.schemaChanges,(function(i){return i.hierarchyLevelRename&&i.hierarchyLevelRename.entity===e.contract.name&&i.hierarchyLevelRename.hierarchy===t.contract.name&&i.hierarchyLevelRename.after===n}));return a&&(n=a.hierarchyLevelRename.before),o[n]},t.prototype.mergeDisplayFolders=function(e,t){for(var i,r=new l(e.displayFolders),o=_.keyBy(e.displayFolders,(function(e){return e.name})),n=0,a=t;n<a.length;n++){var s=a[n];r.add(this.mergeDisplayFolder(e,void 0,s,o))}e.displayFolders=r.merge(),(i=e.properties).push.apply(i,e.displayFolders)},t.prototype.mergeDisplayFolder=function(e,t,i,r){var o=r[i.name];if(o){o.contract=i;var n=new l(o.children);if(i.properties)for(var a=_.filter(o.children,(function(e){return 1!==e.fieldType&&2!==e.fieldType})),s=_.keyBy(a,(function(e){return e.name})),c=0,u=i.properties;c<u.length;c++){var p=u[c],d=s[p.name];if(!d){var h=_.head(e.findFields(p.name,o.schemaName))||_.head(e.findKpis(p.name,o.schemaName));d=h.clone(),d.parent=o}n.add(d)}if(i.hierarchies)for(var v=_.filter(o.children,(function(e){return 2===e.fieldType})),s=_.keyBy(v,(function(e){return e.name})),g=0,f=i.hierarchies;g<f.length;g++){var y=f[g],m=s[y.name];if(!m){var C=_.head(e.findHierarchies(y.name,o.schemaName));m=C.clone(),m.parent=o}n.add(m)}if(i.displayFolders)for(var S=_.filter(o.children,(function(e){return 1===e.fieldType})),s=_.keyBy(S,(function(e){return e.name})),w=0,b=i.displayFolders;w<b.length;w++){var x=b[w];n.add(this.mergeDisplayFolder(e,o,x,s))}o.children=n.merge(),this.sorter.sortProperties(o.children)}else o=this.factory.convertConceptualDisplayFolder(i,e.contractSchema,t,e);return o},t})(),a=(function(){function t(){}return t.prototype.sortEntities=function(e){},t.prototype.sortProperties=function(t){t&&t.sort((function(t,i){return e.FieldListViewModelUtils.compareAlphabeticallyIgnoreCase(t.displayName,i.displayName)}))},t})(),s=(function(){function e(e,t){this.vmLookup=this.getPropertiesDictionary(e),this.renames=this.getRenamesDictionary(e,t)}return e.prototype.findVms=function(e,t,i){var r=this.getKey(e,t,i),o=this.renames[r]||r;return this.vmLookup[o]},e.prototype.getPropertiesDictionary=function(e){for(var t=this,i=_.clone(e.properties),r=0,o=e.columnsAndMeasures;r<o.length;r++){var n=o[r];i.push(n)}for(var a=0,s=e.hierarchies;a<s.length;a++){var l=s[a];i.push(l)}for(var c=0,u=e.displayFolders;c<u.length;c++){var p=u[c];i.push(p),i.push.apply(i,p.getAllChildren())}return i=_.uniq(i),_.groupBy(i,(function(e){return t.getVmKey(e)}))},e.prototype.getRenamesDictionary=function(e,t){for(var i={},r=_.filter(t,(function(t){return t.propertyRename&&t.propertyRename.entity===e.name})),o=0,n=r;o<n.length;o++){var a=n[o],s=this.getFieldType(a.propertyRename.objectType),l=this.getKey(a.propertyRename.schema,a.propertyRename.before,s);i[this.getKey(a.propertyRename.schema,a.propertyRename.after,s)]=l}return i},e.prototype.getVmKey=function(e){return this.getKey(e.schemaName,e.name,e.fieldType)},e.prototype.getKey=function(e,t,i){return t+":"+i+(e?"|"+e:"")},e.prototype.getFieldType=function(e){switch(e){default:return 0;case"KPI":return 4;case"Hierarchy":return 2;case"Level":return 3}},e})(),l=(function(){function e(e){this.oldItems=e,this.newItems=[]}return e.prototype.add=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return!!t&&(t=_.filter(t,(function(e){return!!e})),(e=this.newItems).push.apply(e,t),!0)},e.prototype.merge=function(e){e&&(this.newItems=_.filter(this.newItems,e));var t=this.oldItems;return t?t.splice.apply(t,[0,t.length].concat(this.newItems)):_.isEmpty(this.newItems)||(t=this.newItems),t},e})()})(t=e.FieldListViewModelMerger||(e.FieldListViewModelMerger={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.services.schemaItemActivationUtils,a=e.data.SQExprBuilder;!(function(e){function t(e){return e.supported&&(!e.hidden||e.showHidden)}e.isFieldVisible=t})(r=i.FieldListUtils||(i.FieldListUtils={}));var s;!(function(t){function i(e,t,i,r){var o=f(r);if(o)return l(e,o),n.setActiveSchemaItem(t,o,i),o}function r(e,t){for(var i=0,r=e.entities;i<r.length;i++){var o=r[i];o.expanded=t;for(var n=0,a=o.properties;n<a.length;n++){var s=a[n];2!==s.fieldType&&4!==s.fieldType&&1!==s.fieldType||(s.expanded=t)}}}function s(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n.entity){var a=t.findEntity(n.entity);a&&(a.expanded=!0)}}function l(e,i){s(e,i),t.updateSelection(e,i)}function c(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n&&n.entity){var a;if(o.hasFieldExprName(r))a=t.findFields(n.entity,o.getPropertyName(r),n.schema);else if(r.hierarchy)a=t.findHierarchies(n.entity,o.getHierarchyName(r),n.schema);else{var s=t.findEntity(n.entity);s&&(a=[s])}if(a){for(var l=_.head(a).hidden,c=!l,u=0,p=a;u<p.length;u++){p[u].hidden=c}return c}}}function u(e){e.showHidden=!e.showHidden}function p(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.canEdit&&r.hidden&&(r.hidden=!1);for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.canEdit&&a.hidden&&(a.hidden=!1)}}}function d(e){for(var t=0,i=e.entities;t<i.length;t++)for(var r=i[t],o=0,n=r.properties;o<n.length;o++){var a=n[o],s=a;s.supported=!(s.type&&s.type.binary)}}function h(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.selected=!1;for(var o=0,n=r.properties;o<n.length;o++){n[o].selected=!1}}}function v(i,r){t.clearSelection(i);var n=e.data.SQExprConverter.asFieldPattern(r);if(n){var a=o.toFieldExprEntityItemPattern(n);if(a.entity)if(o.hasFieldExprName(n)){var s=i.findFields(a.entity,o.getPropertyName(n),a.schema);if(s)for(var l=0,c=s;l<c.length;l++){var u=c[l];u.selected=!0}}else{var p=i.findEntity(a.entity);p&&(p.selected=!0)}}}function g(e){var t=_.filter(e,(function(e){return e.userEntity&&!e.hidden}));1===t.length&&(t[0].expanded=!0)}function f(e){if(null!=e&&!_.isEmpty(e.changes)){var t=_.filter(e.changes,(function(e){return e.newMeasureCreated||e.newCalculatedColumnCreated||e.measureMove||e.newCalculatedTableCreated||e.newBins||e.newGroups}));if(1===t.length){var i,r,o,n,s=t[t.length-1];return s.newMeasureCreated?(i=s.newMeasureCreated.schema,r=s.newMeasureCreated.entity,n=s.newMeasureCreated.name,a.measureRef(a.entity(i,r),n)):s.newCalculatedColumnCreated?(i=s.newCalculatedColumnCreated.schema,r=s.newCalculatedColumnCreated.entity,o=s.newCalculatedColumnCreated.name,a.columnRef(a.entity(i,r),o||n)):s.newCalculatedTableCreated?(i=s.newCalculatedTableCreated.schema,r=s.newCalculatedTableCreated.entity,a.entity(i,r)):s.measureMove?(i=s.measureMove.schema,r=s.measureMove.destination,n=s.measureMove.property,a.measureRef(a.entity(i,r),n)):s.newBins?(i=s.newBins.schema,r=s.newBins.entity,o=s.newBins.name,a.columnRef(a.entity(i,r),o)):s.newGroups?(i=s.newGroups.schema,r=s.newGroups.entity,o=s.newGroups.name,a.columnRef(a.entity(i,r),o)):void 0}}}t.applyModelChanges=i,t.collapseOrExpandAllEntities=r,t.expandEntity=s,t.expandEntityAndSelect=l,t.toggleHide=c,t.toggleShowHidden=u,t.unhideAll=p,t.updateSupportedProperties=d,t.clearSelection=h,t.updateSelection=v,t.expandIfSingleEntity=g})(s=i.FieldListViewModelOperations||(i.FieldListViewModelOperations={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=e.explore.utils.GroupUtils,a=e.data.SQExprBuilder,s=e.data.SQExprUtils,l=e.data.SQHierarchyExprUtils,c=e.explore.util.VisualContainerUtils;
!(function(i){function r(e,t,i,r,n,a,s){var l=new v(e,n,a,t,i,r,s);return o.visit(e,l)}function u(e){return{type:0}}function p(e,t,i,r,n,a,s,l,c,u){return{items:o.visit(e.expr,new g(e,t,i,r,n,a,s,l,c,u))}}function d(e,t){var i=e.getConceptualProperty(t);return i&&1===i.kind}var h="Aggregate_";i.createAggregateMenuItems=r;var v=(function(){function i(e,t,i,r,o,n,a){this.sqExpr=e,this.dataRoleKind=t,this.requiredTypes=i,this.schema=r,this.aggrOps=o,this.hasHierarchyLevels=n,this.property=a}return i.prototype.visitEntity=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnHierarchyVariation=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnHierarchyLevelVariation=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnSubquery=function(e){return[]},i.prototype.visitColumnAggrSubquery=function(e){return[]},i.prototype.visitEntityAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchy=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevel=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevelAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitMeasure=function(e){return[]},i.prototype.visitPercentOfGrandTotal=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItemsForPercentOfTotal(t)},i.prototype.visitPercentOfRoleTotal=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItemsForPercentOfTotal(t)},i.prototype.visitPercentile=function(e){return[]},i.prototype.visitSelectRef=function(e){return[]},i.prototype.visitFilteredEval=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItems(t)},i.prototype.createMenuItemsForPercentOfTotal=function(e){var t=a.removeAggregate(e,this.schema).getMetadata(this.schema);if(!t)return[];var i=t.type,r=i.text||i.dateTime||i.duration?[3,4]:[];return this.createMenuItems(e,r)},i.prototype.createMenuItems=function(t,i){void 0===i&&(i=[]);var r=[];if(!this.hasHierarchyLevels&&_.isEmpty(t.validate(this.schema,this.aggrOps))&&!s.discourageAggregation(t,this.schema)){var o=this.dataRoleKind===e.VisualDataRoleKind.Grouping,n=this.dataRoleKind===e.VisualDataRoleKind.GroupingOrMeasure,a=o?[]:this.aggrOps.getSupportedAggregates(t,this.schema,this.requiredTypes);a=_.difference(a,i),n&&!d(t,this.schema)&&r.push(this.createRemoveAggregateMenuItem());for(var l=0,c=a;l<c.length;l++){var u=c[l];r.push(this.createAggregateMenuItem(u))}}return r},i.prototype.createAggregateMenuItem=function(i){var r=u(this.property);r.key={action:2,aggregate:i};var o=a.removeAggregate(this.sqExpr,this.schema).getMetadata(this.schema),n=t.services.getAggregateKey(i,o);return r.text=e.common.localize.get(h+n),r},i.prototype.createRemoveAggregateMenuItem=function(){var t=u(this.property);return t.key={action:1},t.text=e.common.localize.get("FieldWell_RemoveAggregate"),t},i.prototype.visitTransformOutputRoleRef=function(e){return[]},i})(),g=(function(){function t(e,t,i,r,o,n,a,s,l,c){this.property=e,this.bucket=t,this.buckets=i,this.dataRole=r,this.schema=o,this.aggrOps=n,this.visual=a,this.featureSwitchService=s,this.groupingDesignStateService=l,this.showValueAsService=c,this.property.interactivityOptions.isEditableField?this.menuItems=[this.createDeleteMenuItem(),this.createRenameMenuItem()]:this.menuItems=[this.createDeleteMenuItem()],this.bucket.properties.length>1&&this.menuItems.push(this.createMoveGroupMenuItem()),this.buckets.length>1&&this.menuItems.push(this.createMoveToGroupMenuItem()),this.createConditionalFormattingOptions()}return t.prototype.createConditionalFormattingOptions=function(){var t=this;!_.isEmpty(this.property.conditionalFormattingRepetitions)&&this.visual&&(this.conditionalFormattingOptions=this.property.conditionalFormattingRepetitions.map((function(i){return{repetition:i,propertyDefinition:e.VisualObjectRepetition.getDefinition(t.visual.objects,i)}})))},t.prototype.visitEntity=function(e){return this.menuItems},t.prototype.visitColumn=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitColumnAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumn=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumnAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitColumnHierarchyVariation=function(e){return this.menuItems},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.source.schema),this.addQuickCalcMenuItem(e.source.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitColumnSubquery=function(e){return this.menuItems},t.prototype.visitColumnAggrSubquery=function(e){return this.menuItems},t.prototype.visitEntityAggr=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitHierarchy=function(e){return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addShowAllMenuItem(_.head(this.property.hierarchyLevels).expr),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevel=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevelAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitMeasure=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitPercentile=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.menuItems},t.prototype.visitSelectRef=function(e){return[]},t.prototype.visitTransformOutputRoleRef=function(e){return[]},t.prototype.visitPercentOfGrandTotal=function(e){return this.addPercentTotalMenuItems(e.baseExpr)},t.prototype.visitPercentOfRoleTotal=function(e){return this.addPercentTotalMenuItems(e.baseExpr)},t.prototype.visitFilteredEval=function(e){return this.addFilteredEvalMenuItems()},t.prototype.addFilteredEvalMenuItems=function(){return this.addAggregateMenuItems(),this.menuItems},t.prototype.addPercentTotalMenuItems=function(e){var t=a.fieldExpr(e);this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(o.getSchema(e)),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels);var i=o.getProperty(e);return i&&this.addVariationsMenuItems(i),this.menuItems},t.prototype.addAggregateMenuItems=function(){var e,t=r(this.property.expr,this.schema,this.aggrOps,!_.isEmpty(this.property.hierarchyLevels),this.dataRole.kind,this.dataRole.requiredTypes,this.property);_.isEmpty(t)||(this.menuItems.push(this.createSeparatorMenuItem()),(e=this.menuItems).push.apply(e,t))},t.prototype.addConditionalFormattingMenuItems=function(e){if(!_.isEmpty(this.conditionalFormattingOptions)){if(e.getMetadata(this.schema)){c.hasGroupByItems(this.visual.query)||(this.menuItems.push(this.createSeparatorMenuItem()),this.addSetConditionalFormattingMenuItem(),this.addRemoveConditionalFormattingMenuItem())}}},t.prototype.addSetConditionalFormattingMenuItem=function(){if(!_.isEmpty(this.conditionalFormattingOptions)){var t=u(this.property);t.text=e.common.localize.get("FieldWell_ConditionalFormatting"),this.menuItems.push(t);for(var i=t.children=[],r=0,o=this.conditionalFormattingOptions;r<o.length;r++){var n=o[r];i.push(this.createConditionalFormattingMenuItem(n.repetition.propertyDescriptor.displayName,12,n))}}},t.prototype.addRemoveConditionalFormattingMenuItem=function(){if(!_.isEmpty(this.conditionalFormattingOptions)){var t=u(this.property);t.text=e.common.localize.get("FieldWell_RemoveConditionalFormatting"),this.menuItems.push(t);if(!_.some(this.conditionalFormattingOptions,(function(e){return null!=e.propertyDefinition})))return void(t.disabled=!0);var i=t.children=[];i.push(this.createConditionalFormattingMenuItem(e.data.createDisplayNameGetter("FieldWell_ConditionalFormatting_All"),13));for(var r=0,o=this.conditionalFormattingOptions;r<o.length;r++){var n=o[r],a=this.createConditionalFormattingMenuItem(n.repetition.propertyDescriptor.displayName,14,n);a.disabled=null==n.propertyDefinition,i.push(a)}}},t.prototype.createConditionalFormattingMenuItem=function(t,i,r){var o=u(this.property);return o.key={action:i,conditionalFormattingOptions:r},o.text=e.data.getDisplayName(t,e.common.localize),o},t.prototype.addShowAllMenuItem=function(t){var i=s.isMeasure(t);c.hasGroupByItems(this.visual.query)||(this.dataRole.kind===e.VisualDataRoleKind.Grouping||this.dataRole.kind===e.VisualDataRoleKind.GroupingOrMeasure&&!i)&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createShowAllMenuItem()))},t.prototype.addHierarchiesMenuItems=function(e){if(!_.isEmpty(e)){var t=_.head(e),i=l.expandExpr(this.schema,t.expr.arg);i instanceof Array&&i.length===e.length||this.bucket.supportsMultipleItems&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createRestoreHierarchyMenuItem()))}},t.prototype.addShowValueAsMenuItem=function(t){if(_.isEmpty(this.property.hierarchyLevels)&&this.property.expr.getConceptualProperty(this.schema)){var i=this.schema.schema(t),r=i&&i.capabilities.supportsScopedEval;if(!c.hasGroupByItems(this.visual.query)&&r&&this.dataRole.kind!==e.VisualDataRoleKind.Grouping){var o=this.property.expr,n=this.showValueAsService.createShowValueAsMenuItems(o,this.schema,this.visual.visualType);_.isEmpty(n)||(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createShowValueAsMenuItem(n)))}}},t.prototype.addQuickCalcMenuItem=function(e){if(this.property.expr.getConceptualProperty(this.schema)){var t=this.schema.schema(e);(t&&t.capabilities.canEdit&&!t.isExtensionSchema||this.canAuthorReportMeasuresOnSchema(t))&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createQuickCalcMenuItem()))}},t.prototype.canAuthorReportMeasuresOnSchema=function(e){return e.capabilities.isExtendable||e.isExtensionSchema},t.prototype.addVariationsMenuItems=function(t){var i,r=a.fromColumn(t),o=r.getConceptualProperty(this.schema);if(o){var n=o.column;if(n&&!_.isEmpty(n.variations)){for(var s=a.entity(t.schema,t.entity),l=this.createVariationMenuItem(o.displayName,r),c=[],u=0,p=n.variations;u<p.length;u++){var d=p[u];if(d.navigationProperty&&d.navigationProperty.targetEntity){var h=d.navigationProperty.targetEntity;if(this.dataRole.kind!==e.VisualDataRoleKind.Measure)for(var v=_.filter(h.hierarchies,(function(e){return!e.hidden})),g=0,f=v;g<f.length;g++){var y=f[g],m=a.hierarchy(a.propertyVariationSource(s,d.name,o.name),y.name);c.push(this.createVariationMenuItem(y.name,m))}for(var C=a.entity(s.schema,h.name),S=_.filter(h.properties,(function(e){return!e.hidden})),w=0,b=S;w<b.length;w++){var x=b[w],E=a.columnRef(C,x.name);c.push(this.createVariationMenuItem(x.displayName,E))}}}_.isEmpty(c)||(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(l),(i=this.menuItems).push.apply(i,c))}}},t.prototype.addGroupsMenuItems=function(e){var t,i=this.schema.schema(e.schema);if((i&&i.capabilities.canEdit&&i.capabilities.supportsGrouping)!==!1){var r=this.featureSwitchService.featureSwitches.enableGroupAuthoring,o=[],a=this.property.expr.getConceptualProperty(this.schema);r&&(!n.canExprBeGrouped(this.schema,this.property.expr)||this.property.hierarchyLevels&&this.property.hierarchyLevels.length>0||o.push(this.createGroupsMenuItem()),n.isGroupOrBinColumn(e.entity,a,this.groupingDesignStateService)&&o.push(this.createEditGroupsMenuItem())),n.isClusteringColumn(e.entity,a,this.groupingDesignStateService)&&o.push(this.createEditClusteringMenuItem()),o.length>0&&(this.menuItems.push(this.createSeparatorMenuItem()),(t=this.menuItems).push.apply(t,o))}},t.prototype.createShowValueAsMenuItem=function(t){var i=u(this.property);return i.key={action:4},i.text=e.common.localize.get("FieldWell_ShowValueAs"),i.children=t,i},t.prototype.createQuickCalcMenuItem=function(){var t=u(this.property);return t.key={action:6},t.text=e.common.localize.get("QuickCalc_NewMeasure"),t},t.prototype.createGroupsMenuItem=function(){var t=u(this.property);return t.key={action:8},t.text=e.common.localize.get("ContextMenuItem_CreateGroups"),t},t.prototype.createEditGroupsMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("ContextMenuItem_EditGroups"),t.key={action:9},t},t.prototype.createEditClusteringMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("Clustering_EditClusters"),t.key={action:10},t},t.prototype.createRestoreHierarchyMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("FieldWell_RestoreHierarchy"),t.key={action:11},t},t.prototype.createVariationMenuItem=function(e,t){var i=u(this.property);return i.text=e,i.key={action:7,variationExpr:t},i},t.prototype.createShowAllMenuItem=function(){var t=u(this.property);return t.key={action:3},t.text=e.common.localize.get("FieldWell_ShowAll"),t},t.prototype.createDeleteMenuItem=function(){var t=u(this.property);return t.key={action:0},t.text=e.common.localize.get("FieldWell_Remove"),t},t.prototype.createSeparatorMenuItem=function(){var e=u(this.property);return e.type=1,e},t.prototype.createRenameMenuItem=function(){var t=u(this.property);return t.key={action:15},t.text=e.common.localize.get("ItemAction_Rename"),t},t.prototype.createMoveToBucketsMenuItem=function(){for(var e=[],t=0,i=this.buckets;t<i.length;t++){var r=i[t];if(!this.bucket.equals(r)){var o=u(this.property);o.text=r.displayName,o.key={action:18,moveFieldBucketOptions:{role:r.role,targetIndex:r.properties?r.properties.length:0,displayName:r.displayName}},e.push(o)}}return e},t.prototype.createMoveToGroupMenuItem=function(){var t=u(this.property);return t.key={action:19},t.text=e.common.localize.get("ItemAction_MoveTo"),t.children=this.createMoveToBucketsMenuItem(),t},t.prototype.createMoveUpMenuItem=function(){var t=u(this.property);t.text=e.common.localize.get("ItemAction_Move_Up");var i={action:16},r=this.findFieldPropertyIndexInBucket();if(r<=0)t.disabled=!0;else{var o=this.bucket.properties[r-1];i.moveFieldPropertyOptions={role:o.role,startIndex:o.startIndex,hierarchyLevelsLength:o.hierarchyLevels?o.hierarchyLevels.length:0}}return t.key=i,t},t.prototype.createMoveDownMenuItem=function(){var t=u(this.property);t.text=e.common.localize.get("ItemAction_Move_Down");var i={action:17},r=this.findFieldPropertyIndexInBucket();if(r>=this.bucket.properties.length-1)t.disabled=!0;else{var o=this.bucket.properties[r+1];i.moveFieldPropertyOptions={role:o.role,startIndex:o.startIndex,hierarchyLevelsLength:o.hierarchyLevels?o.hierarchyLevels.length:0}}return t.key=i,t},t.prototype.createMoveToTopMenuItem=function(){var t=u(this.property);t.text=e.common.localize.get("ItemAction_Move_Top");var i={action:16},r=this.bucket.properties[0];return this.property.equals(r)?t.disabled=!0:i.moveFieldPropertyOptions={role:r.role,startIndex:r.startIndex,hierarchyLevelsLength:r.hierarchyLevels?r.hierarchyLevels.length:0},t.key=i,t},t.prototype.createMoveToBottomMenuItem=function(){var t=u(this.property);t.text=e.common.localize.get("ItemAction_Move_Bottom");var i={action:17},r=this.bucket.properties[this.bucket.properties.length-1];return this.property.equals(r)?t.disabled=!0:i.moveFieldPropertyOptions={role:r.role,startIndex:r.startIndex,hierarchyLevelsLength:r.hierarchyLevels?r.hierarchyLevels.length:0},t.key=i,t},t.prototype.findFieldPropertyIndexInBucket=function(){var e=this;return _.findIndex(this.bucket.properties,(function(t){return e.property.equals(t)}))},t.prototype.createMoveGroupMenuItem=function(){var t=u(this.property);return t.key={action:19},t.text=e.common.localize.get("ItemAction_Move"),t.children=[this.createMoveUpMenuItem(),this.createMoveDownMenuItem(),this.createMoveToTopMenuItem(),this.createMoveToBottomMenuItem()],t},t})();i.createDropDownItems=p})(r=i.MenuItemFactory||(i.MenuItemFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this.kind=e,this.name=i.format(t,r)}return e})();e.ShowValueAsCalculation=t;var i=(function(e){function t(t){return e.call(this,void 0,"ShowValueAs_Calculation_None",t)||this}return __extends(t,e),t})(t);e.ShowValueAsNoCalculation=i;var r=(function(e){function t(t){return e.call(this,0,"ShowValueAs_Calculation_PercentOfGrandTotal",t)||this}return __extends(t,e),t})(t);e.ShowValueAsPercentOfGrandTotalCalculation=r;var o=(function(e){function t(t,i,r){var o=e.call(this,1,"ShowValueAs_Calculation_PercentOfRoleTotal",t,r)||this;return o.roles=i,o}return __extends(t,e),t})(t);e.ShowValueAsPercentOfRoleTotalCalculation=o})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.models.ApplyStyle,o=jsCommon.ArrayExtensions,n=e.visuals.plugins,a=e.data.SQExpr,s=jsCommon.StringExtensions,l=e.explore.util.VisualContainerUtils,c=(function(){function e(){var e=this;this.sections=[],this.activeSection=i.VisualizationPaneSectionType.Fields,this.previousSection=i.VisualizationPaneSectionType.Fields,this.pagePaneSections=[],this.activePageSection=i.PagePaneSectionType.Fields,this.previousPageSection=i.PagePaneSectionType.Fields,this.isPaneExpanded=!1,this.visualPluginFilter=function(t,i,r){return e.isPersonalVisualizationPaneVisual(t,i,r)},this.nonPersonalVisualizationPaneFilter=function(t,i,r){return!e.isPersonalVisualizationPaneVisual(t,i,r)}}return Object.defineProperty(e.prototype,"activeSectionIndex",{get:function(){var e=this,t=_.findIndex(this.sections,(function(t){return t.sectionType===e.activeSection}));return t!==-1?t:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activePageSectionIndex",{get:function(){var e=this,t=_.findIndex(this.pagePaneSections,(function(t){return t.sectionType===e.activePageSection}));return t!==-1?t:0},enumerable:!0,configurable:!0}),e.prototype.isPersonalVisualizationPaneVisual=function(e,t,i){var r=!0,o=t&&t.featureSwitches.userFavoriteResourcePackagesEnabled&&e.custom&&e.favoriteId,n=t&&t.featureSwitches.userFavoriteResourcePackagesEnabled&&e.custom&&!e.favoriteId,a=t&&t.featureSwitches.tenantOutOfBoxVisualsEnabled&&e.custom&&e.isOutOfBox,s=t&&t.featureSwitches.personalVisualizationPaneEnabled&&i.isUnpinnedVisual(e.name);return e.custom&&!a&&n?r=!1:s&&!o&&(r=!1),r},e})();i.VisualizationPaneViewModel=c;var u;!(function(u){function p(){return{exploration:null,options:null,taskPane:v(),visualizationPane:g(),sectionStatus:{currentSectionNumber:-1,isEditing:!1},isNavPaneCollapsed:!0,performancePane:h("PerformanceAnalyzerPane_Title","PerformanceAnalyzerPane_Close"),bookmarksPane:h("ExplorationBookmarksPane_Title","ExplorationBookmarksPane_Close"),canvasItemsPane:h("ExplorationCanvasItemsPane_Title","ExplorationCanvasItemsPane_Close"),syncGroupPane:h("SyncGroupPane_Title")}}function d(e){return{contract:e,selected:!1,displayName:e.displayName,menuItems:i.ExplorationContainerViewModelFactory.createNavigationMenuItems()}}function h(e,t){return{isPaneVisible:!1,isPaneExpanded:!0,title:e,closePaneLabel:t}}function v(){return{isPaneExpanded:!0}}function g(){return new c}function f(e){return{visuals:e}}function y(e){return S(_.filter(e,(function(e){return e.custom})))}function m(t,i,r){var o=e.common.localize,a=D(i);switch(t){case n.table.name:case n.tableEx.name:return{class:"table",title:a};case n.matrix.name:case n.pivotTable.name:return{class:"matrix",title:a};case n.scatterChart.name:return{class:"scatter",title:a};case n.barChart.name:return{class:"columnHoriz",title:a};case n.clusteredBarChart.name:return{class:"clusteredBarHoriz",title:a};case n.hundredPercentStackedBarChart.name:return{class:"column100Horiz",title:a};case n.ribbonChart.name:return{class:"ribbon",title:a};case n.columnChart.name:return{class:"columnVert",title:a};case n.clusteredColumnChart.name:return{class:"clusteredBarVert",title:a};case n.dataDotClusteredColumnComboChart.name:return{class:"dataDotClusteredColumnCombo",title:a};case n.dataDotStackedColumnComboChart.name:return{class:"dataDotStackedColumnCombo",title:a};case n.hundredPercentStackedColumnChart.name:return{class:"column100Vert",title:a};case n.realTimeLineChart.name:case n.lineChart.name:return{class:"line",title:a};case n.areaChart.name:return{class:"area",title:a};case n.stackedAreaChart.name:return{class:"stackedArea",title:a};case n.lineClusteredColumnComboChart.name:return{class:"lineClusteredColumnCombo",title:a};case n.lineStackedColumnComboChart.name:return{class:"lineStackedColumnCombo",title:a};case n.pieChart.name:return{class:"pie",title:a};case n.treemap.name:return{class:"tree",title:a};case n.sunburst.name:return{class:"sunburst",title:a};case n.map.name:return{class:"map",title:a};case n.filledMap.name:return{class:"filledMap",title:a};case n.azureMap.name:return{class:"azureMap",title:a};case n.shapeMap.name:return{class:"shapeMap",title:a};case n.funnel.name:return{class:"funnel",title:a};case n.gauge.name:return{class:"gauge",title:a};case n.multiRowCard.name:return{class:"card",title:a};case n.card.name:return{class:"calloutCard",title:a};case n.waterfallChart.name:return{class:"waterfall",title:a};case n.slicer.name:return{class:"slicerVert",title:a};case n.donutChart.name:return{class:"donut",title:a};case n.kpi.name:return{class:"kpi",title:a};case n.scriptVisual.name:return{class:"rScriptImageVisual",title:a};case n.pythonVisual.name:return{class:"pythonImageVisual",title:a};case n.debugVisual.name:return{class:"debugger",title:a};case n.textbox.name:return{class:"narrativeTextbox",title:a};case n.basicShape.name:case n.actionButton.name:case n.image.name:return{class:null,title:a};case n.keyDriversVisual.name:return{class:"keyDrivers",title:a};case n.qnaVisual.name:return{class:"qna",title:a};case n.decompositionTreeVisual.name:return{class:"decompositionTree",title:a};default:if(r&&r.isTrustedVisual(t)){var s=r.getVisualTypeOptions(t);if(s)return{class:s.class,title:s.titleKey?o.get(s.titleKey):t,watermarkKey:s.watermarkKey}}return}}function C(e,t){return m(e.name,e.titleKey,t)||{class:e.class,title:e.name}}function S(e,t,i,r,o){for(var n=[],a=0,s=e;a<s.length;a++){var l=s[a];r&&!r(l,t,i)||n.push(w(l,t,i,o))}return n}function w(t,i,r,o){var n=e.common.localize,a=n.get("AddToFavorites_ContextMenu"),s=n.get("RemoveFromFavorites_ContextMenu"),l=n.get("AboutVisualDialog_About"),c={plugin:t,enabled:!0,active:!1,menuItems:[]},u=C(t,o);c.class=u.class,c.title=u.title,u.watermarkKey&&(t.watermarkKey=u.watermarkKey);var p=i&&i.featureSwitches.userFavoriteResourcePackagesEnabled&&t.custom&&t.favoriteId,d=i&&i.featureSwitches.userFavoriteResourcePackagesEnabled&&t.custom&&!t.favoriteId,h=i&&i.featureSwitches.tenantOutOfBoxVisualsEnabled&&t.custom&&t.isOutOfBox,v=i&&i.featureSwitches.personalVisualizationPaneEnabled&&r.isUnpinnedVisual(t.name),g=i&&i.featureSwitches.personalVisualizationPaneEnabled&&!r.isUnpinnedVisual(t.name),f=null;t.custom&&p?f=b(s,4):t.custom&&!h&&d?f=b(a,3):v?f=b(a,7):t.custom&&!h||!g||(f=b(s,6)),f&&c.menuItems.push(f),t.custom&&(c.title=t.displayName||t.name.match(/([A-z\s]+)/g)[0]);var y=b(l,5);return c.menuItems.push(y),c.tooltipConfig={tooltipTitle:c.title,tooltipShowOnFocus:!0},c}function b(e,t){return{text:e,hasGlyph:!1,labelClass:"visualContextMenu itemLabel",action:t,type:DropDownMenuItemType.Item,checked:!1,hrefTarget:jsCommon.DOMConstants.selfValue}}function x(e,t,i){i.hostServices={getFilters:function(r,o){return r.calculateVisualContainerFilter(e,t,i.contract,o)},getDataSourceVariables:function(){return e.dataSourceVariables},getVisualRelationshipFilterAction:function(e,r,o){return r.relationshipFilterAction(t,e,i.contract,o)},selectDataPoint:function(r,o,n,a){r.setFilterOnSelectData(e,o,t,i.contract,n,a)},setVisualRelationshipFilterAction:function(e,i,r,o){return o.setVisualRelationship(t,e,i,r)}}}function E(e,t,i,r){var o,n=_.map(e.sections,d),a=e.sections;if(a&&a.length>0){var s=void 0!==i?i:0;if(s<a.length){o=F(e,a[s],t,r);for(var l=a.length-1;l>=0;--l)n[l].selected=l===s}}return{contract:e,sections:n,exploreCanvas:o}}function F(e,t,r,n){var a=new i.ExploreCanvas(t,r);if(t.visualContainers&&(a.visualContainers=o.extendWithId(_(t.visualContainers).map((function(e){return M(e,r,n)})).filter((function(e){return!!e})).value()),a.visualContainerGroups=V(t.visualContainerGroups,a.visualContainers,r,n),!_.isEmpty(a.visualContainers)))for(var s=a.visualContainers,l=0,c=s;l<c.length;l++){var u=c[l];x(e,t,u)}return a}function V(e,i,r,o){for(var n=[],a=function(e){if(t.contracts.isVisualContainer(e)){var a=_.find(i,(function(t){return t.contract===e}));a&&n.push(a)}else{var s=P(e,V(e.children,i,r,o));s&&n.push(s)}},s=0,l=e;s<l.length;s++){a(l[s])}return n}function P(e,t,r){if(void 0===r&&(r=0),e.layouts.withId(r)){for(var o=new i.VisualContainerGroup(e,r,t),n=0,a=t;n<a.length;n++)a[n].parentGroup=o;return o}}function M(e,t,o){void 0===t&&(t=0);var n=new r,a=e.layouts.withId(t);if(a){var s=a.position;return n.position({y:s.y,x:s.x}),n.zIndex(s.z||0),n.viewport({height:s.height,width:s.width}),new i.VisualContainer(e,n,t,o)}}function T(e,t,i,r){var o=M(i,r);if(o)return x(e,t,o),o}function D(t){return e.data.getDisplayName(t,e.common.localize)}function A(){return{schema:null,isLoaded:!1}}function I(e,t){return void 0===t&&(t=!0),{isVisualVisible:!1,reportFilters:t?[]:null,pageFilters:[],drillthroughFilters:[],visualFilters:[],activeFilterPane:void 0,addFilterLabel:e.get("FieldDropZone_AddFields"),addDrillthroughFilterLabel:e.get("FieldDropZone_DrillthroughLink_Watermark")}}function O(e,t,r,o,n,s,c,u,p,d,h){for(var v,g=t.filters||[],f=[],y={container:t,scopeType:0},m=!d||!d.featureSwitches.singleFilterPane,C=l.getAutoVisualFilterContainers(t,s,c,r,u,m),S=l.getAutoCrossDrillVisualFilterContainers(e,t,c,r),w=function(e){return i.FilterViewModelFactory.convertFilterContainer(e,r,o,y,n,u,p,l.getVisualCapabilities(t,n),t.config.singleVisual)},b=function(e){var t=w(e);if(f.push(t),C){var i=_.findIndex(C,(function(t){return a.equals(t.expression,e.expression)}));i===-1?0===e.howCreated&&(t.howCreated=e.howCreated=1):(1===e.howCreated&&(t.howCreated=e.howCreated=0),d&&d.featureSwitches.filterPaneCustomSort?2!==e.howCreated&&C.splice(i,1):C.splice(i,1))}},x=0,E=g;x<E.length;x++){b(E[x])}C=C||[],S=S||[];var F=S;if(h&&(F=F.concat(C),d&&d.featureSwitches.visualFiltersCustomSort&&(_.isEmpty(y.container.filters)&&(y.container.filters=[]),(v=y.container.filters).push.apply(v,C))),F)for(var V=0,P=F;V<P.length;V++){var M=P[V],T=w(M);T.howCreated=M.howCreated,f.push(T)}return f.sort(k),f}function N(t,r,o,n,a,s,l,c){var u=[];if(!t||!t.container||!t.container.filters)return u;for(var p=0,d=t.container.filters;p<d.length;p++){var h=d[p];if(null==c||h.howCreated===c){h.name||(h.name=e.explore.FilterUtils.getNextFilterName(t.container.filters));var v=i.FilterViewModelFactory.convertFilterContainer(h,r,o,t,n,a,s,l,null);u.push(v)}}return u.sort(k),u}function L(e){return _.map(e,(function(e){return s.replaceAll(e,B,z)})).join(B)}function k(e,t){var i=e.getDisplayName()?-1:1,r=t.getDisplayName()?-1:1;if(i!==r)return i-r;var o=e.getDisplayName()||e.getRestatement()||"",n=t.getDisplayName()||t.getRestatement()||"";return o.localeCompare(n)}function R(e,t){var i=void 0===e.contract.ordinal?1:-1,r=void 0===t.contract.ordinal?1:-1;return i===-1&&r===-1?e.contract.ordinal-t.contract.ordinal:i-r}var B="-",z="\\"+B;u.createExplorationContainer=p,u.convertSectionToViewModel=d,u.createExplorePane=h,u.createTaskPane=v,u.createVisualizationPane=g,u.createVisualTypesContainer=f,u.getCustomVisualTypes=y,u.getVisualTypeInfoByName=m,u.getVisualTypeInfo=C,u.getAvailableVisualTypes=S,u.getVisualType=w,u.convertExploration=E,u.convertSectionToExploreCanvas=F,u.convertVisualContainerGroups=V,u.convertVisualContainerGroup=P,u.convertVisualContainerStandalone=M,u.convertVisualContainer=T,u.getDisplayName=D,u.createFieldList=A,u.createFilterPane=I,u.createVisualFilters=O,u.createFilters=N,u.createUniqueId=L,u.sortFilterByDisplayName=k,u.sortFilterByOrdinal=R})(u=i.ViewModelFactory||(i.ViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){e&&(this.color=e.color.solid.color,this.visible=e.show,this.radius=e.radius)}return Object.defineProperty(t.prototype,"thickness",{get:function(){return t.Width},enumerable:!0,configurable:!0}),t.prototype.getNumericPaddingFromBorder=function(){return t.calculatePadding(this.radius)},t.prototype.getBorderStyle=function(){if(this.visible)return t.Width+"px "+t.Style+" "+e.common.utils.ColorUtility.hexToRGBString(this.color)},t.prototype.getPaddingFromBorder=function(){var e=t.calculatePadding(this.radius);if(this.visible)return e+"px"},t.prototype.getBorderRadius=function(){if(this.visible)return(this.radius||e.visuals.VisualBorderUtil.DefaultRadius)+"px"},t})();t.VisualBorder=i,(function(e){function t(t){return Math.ceil(t-t*e.paddingMultiple)}e.Width=1,e.Style="solid",e.DefaultPadding=0,e.paddingMultiple=Math.sin(45*(Math.PI/180)),e.calculatePadding=t})(i=t.VisualBorder||(t.VisualBorder={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i){for(var n=i&&i.visibleOnly,a=0,s=e;a<s.length;a++){var l=s[a];n&&l.isHidden||(t(l),o(l)&&r(l.children,t,i))}}function o(e){return!!e.children}function n(e){return!e.children}var a=e.common.models.ApplyStyle,s=t.util.CanvasVisualsUtility,l=e.explore.constants.ExploreCanvasConstants,c=e.explore.util.VisualContainerUtils,u=(function(){
function t(e,t,i){this.contract=e,this.currentCanvasLayout=t,this.children=i,this.uiScale=l.DefaultCanvasUiScale}return t.prototype.setSelected=function(e){this.isSelected=e},Object.defineProperty(t.prototype,"id",{get:function(){return this.contract.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.contract.isHidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){var e=this.currentCanvasLayout;return this.contract.layouts.withId(e).position},set:function(e){var t=this.currentCanvasLayout;this.contract.layouts.withId(t).position=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPositioned",{get:function(){var e=this.position;return 0!==e.width&&0!==e.height},enumerable:!0,configurable:!0}),t.prototype.startResize=function(){this.originalPosition=this.position;for(var e=0,t=this.children;e<t.length;e++){t[e].startResize()}},t.prototype.getScaledPosition=function(){return this.scaledPosition||this.convertToScaledPosition(this.position)},t.prototype.convertToScaledPosition=function(e){return s.convertToScaledPosition(e,this.uiScale,!0)},t.prototype.updateViewportForUserResize=function(e){var t=this.convertToScaledPosition(__assign({},e,{x:0,y:0}));this.updateStyle(t)},t.prototype.updateViewState=function(){this.scaledPosition=this.convertToScaledPosition(this.position);var t=e.Prototype.inherit(this.scaledPosition);this.updateStyle(t),this.setTooltip()},t.prototype.updateStyle=function(e){this.applyStyle||(this.applyStyle=new a);var t=c.getVisualStyleAttributes(e,void 0,this.background&&this.background.colorRGB,this.border&&this.border.getBorderStyle(),this.border&&this.border.getBorderRadius(),this.border&&this.border.getPaddingFromBorder());this.applyStyle.addAttributes(t),this.applyStyle.apply()},t.prototype.setTooltip=function(){var e=c.getVisualType(this.contract),t=this.contract.displayName,i=this.contract.evaluatedObjects&&this.contract.evaluatedObjects.general&&this.contract.evaluatedObjects.general.altText||"";this.tooltip=t+" "+e+" "+i},t.prototype.clone=function(){var e=new t(this.contract,this.currentCanvasLayout,this.children);return e=_.assign(e,this)},t})();i.VisualContainerGroup=u,i.traverseVisualContainerGroups=r,i.isVisualContainerGroup=o,i.isVisualContainer=n})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){switch(e.keyCode){case 122:return e.altKey&&e.shiftKey?0:void 0;case 70:return a.isCtrlOrMeta(e)?1:void 0}}var o,n=e.common.models.ApplyStyle,a=jsCommon.BrowserUtils,s=jsCommon.Color,l=e.visuals.ColorHelper,c=jsCommon.CssConstants,u=e.data.DataViewObjectDescriptors,p=t.util.DetailVisualUtils,d=e.explore.constants.ExploreCanvasConstants,h=e.a11y.util.FocusUtility,v=e.visuals.FontProperties,g=jsCommon.KeyUtils,f=e.TextMeasurementService,y=e.explore.util.VisualContainerUtils,m=t.contracts.VisualLink,C=t.contracts.VisualTitle,S=jsCommon.WordBreaker,w=3,b={key:void 0,defaultValue:!0,forceVisible:(o={},o[1]=!0,o)},x={visualInformationButton:__assign({},b,{key:"showVisualInformationButton"}),visualWarningButton:__assign({},b,{key:"showVisualWarningButton"}),visualErrorButton:__assign({},b,{key:"showVisualErrorButton"}),drillRoleSelector:__assign({},b,{key:"showDrillRoleSelector"}),drillUpButton:__assign({},b,{key:"showDrillUpButton"}),drillToggleButton:__assign({},b,{key:"showDrillToggleButton"}),drillDownLevelButton:__assign({},b,{key:"showDrillDownLevelButton"}),drillDownExpandButton:__assign({},b,{key:"showDrillDownExpandButton"}),pinButton:__assign({},b,{key:"showPinButton"}),filterRestatementButton:__assign({},b,{key:"showFilterRestatementButton"}),focusModeButton:__assign({},b,{key:"showFocusModeButton"}),copyVisualImageButton:__assign({},b,{key:"showCopyVisualImageButton"}),seeDataLayoutToggleButton:__assign({},b,{key:"showSeeDataLayoutToggleButton"}),optionsMenu:__assign({},b,{key:"showOptionsMenu"}),commentButton:__assign({},b,{key:"showCommentButton"}),tooltipButton:{key:"showTooltipButton",defaultValue:!1},personalizeVisualButton:__assign({},b,{key:"showPersonalizeVisualButton"})},E=(function(o){function b(e,t,i,r){var n=o.call(this,e,{footerStyle:null,headerBackgroundStyle:null,headerForegroundStyle:null,headerItemContainerStyle:null,popOutBarSubtitle:"",popOutBarTitle:"",position:null,style:t,titleStyle:null,visualViewportStyle:null})||this;return n.uiScale=d.DefaultCanvasUiScale,n.currentCanvasLayout=i,n.currentEditMode=0,n.visualTitleWrapped=[],n.currentZone=r,n}return __extends(b,o),b.prototype.getRunningVisual=function(){return this.runningVisual},b.prototype.setThemeCollection=function(e){this.themeCollection=e,this.runningVisual&&this.runningVisual.setThemeCollection(e),this.runningDetailVisual&&this.runningDetailVisual.setThemeCollection(e)},b.prototype.startResize=function(){this.originalPosition=this.position},b.prototype.getVisualType=function(){return y.getVisualType(this.contract)},b.getVisualBodyOffset=function(e,t){return b.useStylableHeader(t)||e.canShowVisualContainerHeaderInset()?{top:0,height:0,width:0,left:0}:{top:this.VisualContainerHeaderHeight,height:-this.VisualContainerHeaderHeight,width:0,left:0}},Object.defineProperty(b.prototype,"id",{get:function(){return this.contract.id},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"position",{get:function(){var e=this.currentCanvasLayout;return this.contract.layouts.withId(e).position},set:function(e){var t=this.currentCanvasLayout;this.contract.layouts.withId(t).position=e},enumerable:!0,configurable:!0}),b.prototype.getScaledPosition=function(){return this.convertToScaledPosition(this.position)},Object.defineProperty(b.prototype,"editMode",{get:function(){return this.currentEditMode},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"headerMaxLines",{get:function(){return this.isTitleWrappingEnabled?w:1},enumerable:!0,configurable:!0}),b.prototype.setEditMode=function(t){this.currentEditMode=t,this.updateVisual(this.runningVisual,this.runningVisual.getViewport(),e.VisualUpdateType.ViewMode)},Object.defineProperty(b.prototype,"isPositioned",{get:function(){var e=this.position;return 0!==e.width&&0!==e.height},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isPoppedOut",{get:function(){var e=this.contract.visibility;return null!=e&&0!==e&&4!==e},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isHidden",{get:function(){return t.contracts.VisualContainer.isHidden(this.contract.config.singleVisual)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isTitleWrappingEnabled",{get:function(){return this.visualTitle&&!!this.visualTitle.titleWrap},enumerable:!0,configurable:!0}),b.prototype.visualTitleVisible=function(){var e=this.contract.config.singleVisual,t=this.objects&&this.objects.title,i=t&&t.text,r=this.visualPlugin&&this.visualPlugin.capabilities(e.visualType),o=!1;return t&&i?o=!0:this.visualTitle&&this.visualTitle.text&&(o=!0),!C.isHidden(t,r&&r.suppressDefaultTitle)&&r&&(!r.suppressDefaultTitle||r.suppressDefaultTitle&&i)&&""!==i&&o&&!this.isPoppedOut},b.prototype.supportsKeyboardNavigation=function(){var e=this.contract.config.singleVisual,t=this.visualPlugin&&this.visualPlugin.capabilities(e.visualType);return t&&t.supportsKeyboardFocus},b.prototype.setServices=function(e,i,r,o,n,a,s,l,c,u,p,d,h,v){l.featureSwitches.visualsOutsideNgZone?this.visualHostServices=t.helpers.VisualHostInsideZoneAdapter.wrapHostServices(e,d):this.visualHostServices=e,this.visualAdapterHostServices=v,this.visualPlugin=i,this.visualPluginOps=r,this.viewModeState=o,this.formFactor=n,this.visibility=a,this.featureSwitchService=l,this.runningVisuals=s,this.explorationCapabilities=h,this.visualAuthoring=c,this.filterGenerator=u,this.themeService=p},b.prototype.setSelected=function(e){this.isSelected=e},b.prototype.handleKeyDown=function(e){switch(r(e)){case 0:this.visibility.set(this.contract,8);break;case 1:this.toggleVisualSearch(e)}if(this.isTextboxVisual()&&this.shouldHandleKeydown(e)){return this.getTextboxVisual().focus()}},b.prototype.toggleVisualSearch=function(e){if(this.contract&&this.contract.config&&this.contract.config.singleVisual){var t=this.contract.config.singleVisual.visualType,i=this.visualPlugin&&this.visualPlugin.capabilities(t);i&&this.filterGenerator.tryGetSelfFilterEnabledProperty(i)&&(this.visualAuthoring.toggleSlicerVisualSearch(this.contract,this.filterGenerator,this.visualPlugin),e.preventDefault(),e.stopPropagation())}},b.prototype.shouldHandleKeydown=function(e){if(!this.runningVisual)return!1;if(0===this.viewModeState.getMode())return!1;var t=e.keyCode;if(g.isArrowKey(t)||g.isNudgeModifierKey(t))return!1;if(27===t||9===t||18===t||a.isCtrlOrMeta(e))return!1;var i=this.contract.toolbar&&this.contract.toolbar.element;return!i||!h.isFocusInTree(i)},b.prototype.setVisualTitle=function(e){this.visualTitle=e;var t="",i="";e&&(e.titleComponents&&e.titleComponents.title?t=e.titleComponents.title:e.text&&(t=e.text),e.titleComponents&&e.titleComponents.subtitle&&(i=e.titleComponents.subtitle)),this.readOnlyState.popOutBarTitle=t,this.readOnlyState.popOutBarSubtitle=i},b.prototype.setTooltip=function(){var e=y.getVisualType(this.contract),t=this.getVisualLinkTypeLabel(e)||"",r=this.visualPlugin&&this.visualPlugin.getPlugin(e);if(r){e=i.ViewModelFactory.getVisualType(r).title}var o=this.visualTitle,n=o&&o.text||"",a="",s=this.objects&&this.objects.general&&this.objects.general.altText;s&&(a=" "+s),this.tooltip=n+" "+t+e+a},b.prototype.getVisualLinkTypeLabel=function(e){var t=this.visualPlugin&&this.visualPlugin.capabilities(e);if(t&&t.supportsVisualLink){var r=this.objects&&this.objects.visualLink;if(r&&r.show){var o=m.getType(r),n=_.find(m.Type.members(),(function(e){return e.value===o})).displayName;return i.ViewModelFactory.getDisplayName(n)+" "}}},b.prototype.setHeaderTooltip=function(){var e=this.objects&&this.objects.visualHeader,t=this.objects&&this.objects.visualHeaderTooltip;return e&&e.showTooltipButton&&t?void(this.headerTooltip=t):void(this.headerTooltip=void 0)},b.prototype.redrawVisual=function(){this.runningVisual&&this.updateVisual(this.runningVisual,this.runningVisual.getViewport(),e.VisualUpdateType.Resize)},b.prototype.updateVisualViewportForUserResize=function(t){var i=this.themeService&&this.themeService.getVisualStyle(this.themeCollection),r=this.runningVisual;this.enableVisualScaling?(t.width/=this.uiScale.x,this.visualBorder&&(t.width-=2*this.visualBorder.thickness),this.useStylableHeader()||(t.height-=b.VisualContainerHeaderHeight),t.height/=this.uiScale.y,this.visualBorder&&(t.height-=2*this.visualBorder.thickness)):this.useStylableHeader()||(t.height-=b.VisualContainerHeaderHeight),this.isFooterVisible&&this.isFooterVisible()&&(t.height-=b.VisualContainerFooterHeight);var o=this.getVisualViewport(t.width,t.height,1,i);r&&this.updateVisual(r,o,e.VisualUpdateType.Resize,1),this.hasDetailVisual()&&this.updateVisual(this.runningDetailVisual,o,e.VisualUpdateType.Resize,1),this.applyVisualBodyStyle(this.readOnlyState,t),this.applyFooterStyle(this.readOnlyState,t.width);var n=this.position,a=this.overridePosition||this.convertToScaledPosition(n);this.applyTitleStyle(this.readOnlyState,a.width,i)},b.prototype.shouldUseCache=function(){return y.shouldUseQueryCache(this.contract,this.options.disableQueryCacheUpdates)},b.prototype.adjustForVisualContainerHeader=function(e,t){this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(e.y+=t,e.height-=t)},b.prototype.convertToScaledPosition=function(e){var i=this.viewModeState&&this.viewModeState.getConfig().displayOptions.disablePixelValueRounding,r=t.util.CanvasVisualsUtility.convertToScaledPosition(e,this.uiScale,!i);return this.adjustForVisualContainerHeader(r,this.useStylableHeader()?0:-b.VisualContainerHeaderHeight),r},b.prototype.reset=function(){var t=this.visual;t&&(t.data=void 0,t.dataTransforms=void 0,t.hostServices=e.visuals.defaultVisualHostServices,t.visualAdapterHostServices={getNextDataSegment:function(){return new e.Promise(function(e,t){return t(new Error("Visual reset"))})},startProgressBar:_.noop,stopProgressBar:_.noop},this.visualHostServices=void 0,this.visualAdapterHostServices=void 0),this.runningVisuals&&this.runningVisuals.removeVisual(this.contract),this.runningVisual=void 0},b.prototype.updateViewStateCore=function(t){var r=this.viewModeState&&this.viewModeState.getConfig(),o=r&&r.displayOptions,n=this.themeService&&this.themeService.getVisualStyle(this.themeCollection),a=this.contract,s=this.position,l=this.overridePosition||this.convertToScaledPosition(s),c=e.Prototype.inherit(l),d=!this.useStylableHeader()||this.isPoppedOut;if(this.enableVisualScaling?this.overridePosition?(d&&(c.height-=b.VisualContainerHeaderHeight),c.height/=this.uiScale.y,c.width/=this.uiScale.x):(c=e.Prototype.inherit(s),this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()&&d&&(c.height-=b.VisualContainerHeaderHeight/this.uiScale.y)):d&&(c.height-=b.VisualContainerHeaderHeight),this.isFooterVisible&&this.isFooterVisible()&&(c.height-=b.VisualContainerFooterHeight),this.isPoppedOut&&(!o||!o.hideInFocusBar)){var h=i.VisualContainer.PopOutBarHeight;this.enableVisualScaling&&(h/=this.uiScale.y),c.height-=h}var v=this.getVisualViewport(c.width,c.height,this.uiScale.x,n),g=a.config.singleVisual;if(t.isFilterVisual=!1,g){this.showWatermark=!1,this.canPin=!0;var f=g.visualType,y=this.visualPlugin&&this.visualPlugin.capabilities(f);if(y&&(t.isFilterVisual=null!=u.findFilterOutput(y.objects)),g.query){var m=g.query.defn;if(m){var C=m.orderBy();t.actualSortDirection=C&&C.length?C[0].direction:void 0}}else this.visualPluginOps&&this.visualPluginOps.isQueryVisual(f)&&"debugVisual"!==f&&(this.canPin=!1,this.viewModeState&&1===this.viewModeState.getMode()?this.showWatermark=!y||!y.supportsLandingPage:this.showWatermark=!0);this.updateVisualDefinition(v),!this.runningVisual&&this.visual&&(this.runningVisual=this.wrapRunningVisual(this.visual),this.runningVisuals.setVisual(this.contract,this.runningVisual)),this.hasDetailVisual()?t.detailVisual||(t.detailVisual={parentContract:this.contract,visual:{viewport:p.getDetailVisualViewport(v,this.contract.detailVisualLayout),themeCollection:this.themeCollection,allowInvalidDataView:!0,hostServices:null},hasData:!1},this.runningDetailVisual||(this.runningDetailVisual=this.wrapRunningVisual(t.detailVisual.visual))):(t.detailVisual=null,this.runningDetailVisual=void 0),this.setViewport(t,v)}t.position=__assign({},l,{z:null!=this.zIndexOverride?this.zIndexOverride:s.z||0,angle:s.angle||0}),this.applyTitleStyle(t,l.width,n),this.applyVisualBodyStyle(t,c),this.applyFooterStyle(t,c.width),this.applyHeaderStyle(t),this.setHeaderItemVisibility(t),this.setTooltip(),this.setHeaderTooltip()},b.prototype.isHeaderItemVisible=function(e){return!this.readOnlyState.itemVisibility||this.readOnlyState.itemVisibility[e]},b.prototype.isDeprecationWarningVisible=function(){return 1===this.viewModeState.getMode()&&void 0!==this.customVisualDeprecatedWarningInfo},b.prototype.isWarningVisible=function(){return this.isHeaderItemVisible("visualWarningButton")&&void 0!==this.warningInfo},b.prototype.isErrorVisible=function(){return this.isHeaderItemVisible("visualErrorButton")&&void 0!==this.transformWarningInfo},b.prototype.isInfoVisible=function(){return this.isHeaderItemVisible("visualInformationButton")&&void 0!==this.visualInfo},b.prototype.isHeaderTooltipVisible=function(){return this.isHeaderItemVisible("tooltipButton")},b.prototype.isAnyIconVisible=function(){return this.isDeprecationWarningVisible()||this.isWarningVisible()||this.isErrorVisible()||this.isInfoVisible()||this.isHeaderTooltipVisible()},b.prototype.anyHeaderItemVisible=function(e){if(e)for(var t=0,i=e;t<i.length;t++){var r=i[t];if(this.isHeaderItemVisible(r))return!0}return!1},b.prototype.isTextboxVisual=function(){return this.contract.config.singleVisual.visualType===e.visuals.plugins.textbox.name},b.prototype.getTextboxVisual=function(){var e=this.runningVisual&&this.runningVisual.getAdapter();return e?e.unwrap?e.unwrap():e:void 0},b.prototype.isAnalysisVisual=function(){var e=this.contract.config.singleVisual.visualType;return this.visualPluginOps.isAnalysisVisual(e)},b.prototype.isQnaVisual=function(){var e=this.contract.config.singleVisual.visualType;return this.visualPluginOps.isQnaVisual(e)},b.prototype.setHeaderItemVisibility=function(e){var t=e.itemVisibility;t||(t=e.itemVisibility={});var i=this.viewModeState&&this.viewModeState.getMode(),r=this.useStylableHeader()?this.objects&&this.objects.visualHeader:void 0;for(var o in x){var n=x[o],a=n.key,s=n.defaultValue,l=n.forceVisible,c=void 0;if(l&&void 0!==l[i])c=l[i];else{var u=r&&r[a];c=void 0!==u?u:s}t[o]=c}},b.prototype.applyHeaderStyle=function(e){var t=this.useStylableHeader()?this.objects&&this.objects.visualHeader:void 0;this.applyItemContainerStyle(e,t),this.applyHeaderBackgroundStyle(e,t),this.applyHeaderForegroundStyle(e,t)},b.prototype.applyItemContainerStyle=function(e,t){var i={"background-color":"","border-color":""};if(this.useStylableHeader()&&t&&(t.background||null!=t.transparency||null!=t.border)){var r=t.background&&t.background.solid?s.parseColorString(t.background.solid.color):{R:255,G:255,B:255},o=t.border&&t.border.solid?s.parseColorString(t.border.solid.color):r;null!=t.transparency?o.A=r.A=1-t.transparency/100:(null==r.A&&(r.A=1),null==o.A&&(o.A=1)),i["background-color"]=s.rgbString(r),i["border-color"]=s.rgbString(o)}e.headerItemContainerStyle||(e.headerItemContainerStyle=new n),e.headerItemContainerStyle.addAttributes(i),e.headerItemContainerStyle.apply()},b.prototype.applyHeaderBackgroundStyle=function(e,t){var i={"background-color":""};if(this.useStylableHeader()&&t&&(t.background||null!=t.transparency)){var r=t.background&&t.background.solid?s.parseColorString(t.background.solid.color):b.VisualHeaderBackgroundColor;null!=t.transparency?r.A=1-t.transparency/100:null==r.A&&(r.A=1-b.VisualHeaderTransparency/100),i["background-color"]=s.rgbString(r)}e.headerBackgroundStyle||(e.headerBackgroundStyle=new n),e.headerBackgroundStyle.addAttributes(i),e.headerBackgroundStyle.apply()},b.prototype.applyHeaderForegroundStyle=function(e,t){var i={color:""};this.useStylableHeader()&&t&&t.foreground&&t.foreground.solid&&(i.color=t.foreground.solid.color),e.headerForegroundStyle||(e.headerForegroundStyle=new n),e.headerForegroundStyle.addAttributes(i),e.headerForegroundStyle.apply()},b.prototype.applyVisualBodyStyle=function(e,t){e.visualViewportStyle||(e.visualViewportStyle=new n);var i=y.getVisualStyleAttributes(t,this.enableVisualScaling?this.uiScale.x:void 0,this.visualBackground&&this.visualBackground.colorRGB,this.visualBorder&&this.visualBorder.getBorderStyle(),this.visualBorder&&this.visualBorder.getBorderRadius(),this.visualBorder&&this.visualBorder.getPaddingFromBorder());e.visualViewportStyle.addAttributes(i),e.visualViewportStyle.apply()},b.prototype.applyFooterStyle=function(e,t){if(this.isFooterVisible&&this.isFooterVisible()){var i={};e.footerStyle||(e.footerStyle=new n);var r=this.enableVisualScaling?this.uiScale.x:1;i.transform="scale("+r+")",i.width=t+"px",e.footerStyle.addAttributes(i),e.footerStyle.apply()}},b.prototype.applyTitleStyle=function(e,t,i){var r={};if(this.visualTitleVisible()){r[c.visibilityProperty]=c.visibleValue;var o=this.objects&&this.objects.title||{},a=this.getTitleFontProperties(o,i);r[c.fontSizeProperty]=a.size.pt+"pt"||"",r[c.fontFamilyProperty]=""+a.family||"",r[c.fontWeightProperty]=""+a.weight,r[c.colorProperty]=""+a.color||"",r[c.textAlignProperty]=o.alignment?o.alignment:"",r[c.backgroundColorProperty]=o.background&&o.background.solid&&o.background.solid.color||"";var s=this.isTitleWrappingEnabled?this.visualTitleWrapped.length:1;if(r[c.heightProperty]=s*y.getTitleHeight(a),this.insetHeaderSize){if(!this.isTitleWrappingEnabled){var l=(t-this.insetHeaderSize.width)/this.uiScale.x;r[c.widthProperty]=l+"px"}}else r[c.widthProperty]=""}else r[c.visibilityProperty]=c.hiddenValue;e.titleStyle||(e.titleStyle=new n),e.titleStyle.addAttributes(r),e.titleStyle.apply()},b.prototype.updateVisualDefinition=function(e){var t=this.contract.config.singleVisual,i=t.visualType;if(this.visual){var r=this.visual;r.type!==t.visualType&&(r.data=null),r.type=i,r.stylePresetName=this.objects&&this.objects.stylePreset&&this.objects.stylePreset.name,r.hostServices=this.visualHostServices,r.visualAdapterHostServices=this.visualAdapterHostServices,r.orderIndependentSelectorMatching=t.queryOptions&&t.queryOptions.keepProjectionOrder,this.visualPluginOps&&(this.visual.visualRequiresData=this.visualPluginOps.isQueryVisual(i)),this.visual.visualHasData=!!t.query,this.visual.currentZone=this.currentZone}else this.visualHostServices&&(this.visual={viewport:e,type:i,dataTransforms:{objects:t.objects},hostServices:this.visualHostServices,visualAdapterHostServices:this.visualAdapterHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0,isVisualInteractive:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin,themeCollection:this.themeCollection,orderIndependentSelectorMatching:t.queryOptions&&t.queryOptions.keepProjectionOrder},this.visualPluginOps&&(this.visual.visualRequiresData=this.visualPluginOps.isQueryVisual(i)),this.visual.visualHasData=!!t.query)},b.prototype.setViewport=function(e,t){this.runningVisual&&this.setVisualViewport(this.runningVisual,t),this.runningDetailVisual&&this.setVisualViewport(this.runningDetailVisual,p.getDetailVisualViewport(t,this.contract.detailVisualLayout))},b.prototype.setVisualViewport=function(e,t){if(e&&t){var i=e.getViewport();i.height===t.height&&i.width===t.width&&i.scale===this.uiScale.x||e.setViewport(__assign({},t,{scale:this.enableVisualScaling?this.uiScale.x:1}))}},b.prototype.getVisualViewport=function(e,t,r,o){var n=0;this.visualBorder&&this.visualBorder.visible&&(n=this.visualBorder.getNumericPaddingFromBorder());var a=this.isPaddingDisabled?2*n:i.VisualContainer.VisualContainerPaddingRight+i.VisualContainer.VisualContainerPaddingLeft+2*n,s=this.isPaddingDisabled?2*n:i.VisualContainer.VisualContainerPaddingTop+i.VisualContainer.VisualContainerPaddingBottom+2*n,l=0,c=e-a;if(this.visualTitleVisible()){var u=this.getTitleFontProperties(this.visualTitle,o);this.updateVisualTitleWrapping(c,u),l=y.getTitleHeight(u),l*=this.visualTitleWrapped.length||1}var p=t-s-l,d=this.viewModeState&&this.viewModeState.getConfig().displayOptions.showDetailVisualOnFullScreen;if(this.hasDetailVisual()&&!d){1===(this.contract.detailVisualLayout||1)?(p-=s,p/=2):(c-=a,c/=2)}return{width:Math.max(c,0),height:Math.max(p,0),scale:r}},b.prototype.getTitleFontProperties=function(i,r){var o=l.create(r);return e.visuals.FontProperties.createFromObjectOrStyle(i,{color:"fontColor",family:"fontFamily",size:"fontSize"},o,r,void 0,t.util.VisualContainerUtils.DefaultTitleTextClass,t.util.VisualContainerUtils.DefaultTitleFontProperties)},b.prototype.updateVisual=function(e,t,i,r){if(e&&t){var o=e.getAdapter();o&&o.update({viewport:t,suppressAnimations:!0,dataViews:e.getDataViews(),type:i,resizeMode:r,viewMode:this.visualHostServices.getViewMode(),editMode:this.editMode})}},b.prototype.updateVisualTitleWrapping=function(e,t){if(this.visualTitle&&this.visualTitle.text){var i=v.toTextProperties(t),r=new n;if(r.addAttributes({width:e+"px"}),1===this.headerMaxLines)return void(this.visualTitleWrapped=[{text:this.visualTitle.text.trim(),style:r}]);var o=S.splitByWidth(this.visualTitle.text,i,f.measureSvgTextWidth,e,this.headerMaxLines,null,!0);this.visualTitleWrapped=o.map((function(e){return{text:e.trim(),style:r}}))}},b.prototype.hasDetailVisual=function(){return 2===this.contract.visibility||8===this.contract.visibility},b.prototype.useStylableHeader=function(){return b.useStylableHeader(this.explorationCapabilities)},b.useStylableHeader=function(e){return e&&e.getCapabilities().visualContainerOptions.useStylableHeader},b.prototype.wrapRunningVisual=function(t){var i=this,r={getType:function(){return t.type},setType:function(e){return t.type=e},getViewport:function(){return t.viewport},setViewport:function(o,n){t.viewport=o,n&&i.updateVisual(r,o,e.VisualUpdateType.Resize)},getData:function(){return t.data},getAdapter:function(){return t.visual},getDataViews:function(){return t.dataViews},setDataViews:function(e){return t.dataViews=e},getDataTransforms:function(){return t.dataTransforms},setThemeCollection:function(e){return t.themeCollection=e},getIsInFocus:function(){return t.isInFocus},setIsInFocus:function(e){return t.isInFocus=e},setData:function(e,i,r){t.data=e,t.dataAppliedEvent&&(t.dataAppliedEvent.reject(),t.dataAppliedEvent=void 0),t.performanceActivity&&(t.performanceActivity.reject(),t.performanceActivity=void 0),t.dataAppliedEvent=i,t.performanceActivity=r},setDataTransforms:function(e){return t.dataTransforms=e},setPendingSelection:function(e){return t.pendingSelection=e},hasPendingSelection:function(){return!!t.pendingSelection},setAdditionalObjectUpdates:function(e){return t.additionalObjectUpdates=e},setIsDisabled:function(e){return t.isDisabled=e},getIsDisabled:function(){return t.isDisabled},setIsDisabledIfUncertified:function(e){return t.isDisabledIfUncertified=e},getIsDisabledIfUncertified:function(){return t.isDisabledIfUncertified},setReportId:function(e){return t.reportId=e}};return r},b.VisualContainerHeaderHeight=20,b.VisualContainerFooterHeight=34,b.VisualContainerPadding=5,b.VisualContainerPaddingTop=5,b.VisualContainerPaddingRight=5,b.VisualContainerPaddingBottom=5,b.VisualContainerPaddingLeft=5,b.PopOutBarHeight=40,b.HeaderInTitleScaleThreshold=.9,b.VisualHeaderBackgroundColor={R:255,G:255,B:255},b.VisualHeaderTransparency=0,b})(i.ViewModel);i.VisualContainer=E})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Fields=0]="Fields",e[e.Format=1]="Format",e[e.Analytics=2]="Analytics"})(t=e.VisualizationPaneSectionType||(e.VisualizationPaneSectionType={}));var i;!(function(e){e[e.Fields=0]="Fields",e[e.Format=1]="Format"})(i=e.PagePaneSectionType||(e.PagePaneSectionType={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,v,g,f,y,m){return new h(t,i,r,e,o,n,a,s,l,c,u,p,d,v,g,f,y,m)}function o(e,t){return!!e&&!!t&&t.container===e&&0===t.scopeType}var n=e.visuals.ActionButtonType,a=e.data.DataViewObjectDefinitions,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SemanticFilter,u=e.explore.util.VisualContainerUtils,p=e.explore.contracts.VisualLink,d=e.visuals.plugins;i.createVisualAuthoring=r,i.DefaultActionButtonPosition={x:0,y:0,width:100,height:40};var h=(function(){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y){this.schemaProxy=e,this.telemetry=t,this.explorationNavigationService=i,this.visualPluginService=r,this.selectionService=o,this.explorationSerializer=n,this.eventBridge=a,this.promiseFactory=s,this.undoRedoService=l,this.featureSwitchService=c,this.filterGenerator=u,this.formFactorProvider=p,this.layoutAuthoring=d,this.viewModeState=h,this.dataSource=v,this.linguisticSchemaProxy=g,this.visualAuthoringOperations=f,this.visualSync=y}return r.prototype.addFieldToVisual=function(e,t,i,r){var o=this;return this.registerUndoableAction(t,(function(t){var n=function(i){return o.visualAuthoringOperations.addFieldToVisual(t,e,i,r)};return o.runVisualContainerUpdateAction(n,[i])}),"AddFieldToVisual")},r.prototype.addFieldInRole=function(e,t,i,r,o,n,a){var s=this;return this.registerUndoableAction(i,(function(i){var l=function(r){return s.visualAuthoringOperations.addFieldInRole(i,e,t,r,o,n,a)};return s.runVisualContainerUpdateAction(l,[r])}),"AddFieldInRole")},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(e,(function(e){var a=function(t){return n.visualAuthoringOperations.expandHierarchy(e,t,i,r,o)};return n.runVisualContainerUpdateAction(a,[t])}),"ExpandHierarchy")},r.prototype.removeField=function(e,t){var r=this;return this.registerUndoableAction(e,(function(e){var o=function(i){return r.visualAuthoringOperations.removeField(t,e,[i])},n=i.selectionUtils.getSelectedVisualContainers(r.selectionService);return r.runVisualContainerUpdateAction(o,n)}),"RemoveField")},r.prototype.removeProjection=function(e,t){var r=this;return this.undoRedoService.register("RemoveProjection",(function(){var o=function(i){return r.visualAuthoringOperations.removeProjection(e,t,i)},n=i.selectionUtils.getSelectedVisual(r.selectionService);return r.runVisualContainerUpdateAction(o,[n])}))},r.prototype.removeInvalidExpressions=function(e,t){var i=this;return this.registerUndoableAction(t,(function(t){return i.visualAuthoringOperations.removeInvalidExpressions(t,e)}),"RemoveInvalidExpressions")},r.prototype.moveProjection=function(e,t,r,o,n,a){var s=this;return this.registerUndoableAction(a,(function(a){var l=function(i){return s.visualAuthoringOperations.moveProjection(a,e,t,r,o,n,i)},c=i.selectionUtils.getSelectedVisual(s.selectionService);return s.runVisualContainerUpdateAction(l,[c])}),"MoveProjection")},r.prototype.drillDownLevel=function(e,t,i){var r=this;this.undoRedoService.register("DrillDownLevel",(function(){return r.visualAuthoringOperations.drillDownLevel(e,t,i)}))},r.prototype.replaceProjection=function(e,t,i,r,o){var n=this;return this.schemaProxy.get(o).then((function(o){return n.undoRedoService.register("ReplaceProjection",(function(){var a=function(r){return n.visualAuthoringOperations.replaceProjection(o,e,t,i,r)};return n.runVisualContainerUpdateAction(a,[r])}))}))},r.prototype.drillDown=function(e,t,i,r){var o=this;return this.registerUndoableAction(i,(function(i){return o.visualAuthoringOperations.drillDown(i,e,t,r)}),"DrillDown")},r.prototype.drillUp=function(e,t){var i=this;this.undoRedoService.register("DrillUp",(function(){return i.visualAuthoringOperations.drillUp(e,t)}))},r.prototype.toggleDrillFilterOtherVisualsSetting=function(){var e=this,t=i.selectionUtils.getSelectedVisual(this.selectionService);if(t){var r=!t.drillFilterOtherVisuals;this.undoRedoService.register("SetDrillFilterOtherVisualsSetting",(function(){return e.visualAuthoringOperations.setDrillFilterOtherVisualsSetting(r)}))}},r.prototype.setDrillFilterOtherVisualsSetting=function(e){var t=this;this.undoRedoService.register("SetDrillFilterOtherVisualsSetting",(function(){return t.visualAuthoringOperations.setDrillFilterOtherVisualsSetting(e)}))},r.prototype.setAggregate=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(o,(function(o){return n.visualAuthoringOperations.setAggregate(o,e,t,i,r)}),"SetAggregate")},r.prototype.removeAggregate=function(e,t,i,r){var o=this;return this.registerUndoableAction(r,(function(r){return o.visualAuthoringOperations.removeAggregate(r,e,t,i)}),"RemoveAggregate")},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.setPercentOfGrandTotal(r,e,t,i)}))},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.removePercentOfGrandTotal(r,e,t,i)}))},r.prototype.setPercentOfRoleTotal=function(e,t,i,r,o){var n=this;return this.getSchemaAndExecuteAction(o,(function(o){return n.visualAuthoringOperations.setPercentOfRoleTotal(o,e,t,i,r)}))},r.prototype.removePercentOfRoleTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){
return o.visualAuthoringOperations.removePercentOfRoleTotal(r,e,t,i)}))},r.prototype.toggleShowAll=function(e,t){var i=this;this.undoRedoService.register("ToggleShowAll",(function(){i.visualAuthoringOperations.toggleShowAll(e,t)}))},r.prototype.setVariation=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(e,(function(e){var s=function(t){return a.visualAuthoringOperations.setVariation(e,t,i,r,o,n)};return a.runVisualContainerUpdateAction(s,[t])}),"SetVariation")},r.prototype.createVisualContainerConfig=function(e){var t=this;return this.schemaProxy.get(e.dataSources).then((function(i){return t.visualAuthoringOperations.createVisualContainerConfig(i,e)}))},r.prototype.addVisualContainerImage=function(e,t,i,r,o,n){var a=this;this.undoRedoService.register("AddVisualContainerImage",(function(){return a.visualAuthoringOperations.addVisualContainerImageFromData({exploreCanvas:e,position:n},t,o)}))},r.prototype.addVisualContainerShapeVisual=function(e,t,r){var o=this;this.undoRedoService.register("AddVisualContainerBasicShape",(function(){var n;return 1===r&&(n=i.DefaultActionButtonPosition),o.visualAuthoringOperations.addVisualContainerShapeVisual({exploreCanvas:e,position:n},t,r)}))},r.prototype.addVisualContainerTextbox=function(e,t){var i=d&&d.textbox&&d.textbox.name;return this.addEmptyVisualContainer(e,i,t)},r.prototype.addVisualContainer=function(e,t,i){var r=this;return this.schemaProxy.get(e.dataSources).then((function(o){return r.undoRedoService.register("AddVisualContainer",(function(){return r.visualAuthoringOperations.addVisualContainer(o,e,t,i)}))}))},r.prototype.addVisualContainerFromConfig=function(e,t,i){var r=this;return this.undoRedoService.register("AddVisualContainerFromConfig",(function(){return r.visualAuthoringOperations.addVisualContainerFromConfig(e,t,i)}))},r.prototype.addEmptyVisualContainer=function(e,t,i){var r=this;return this.undoRedoService.register("AddEmptyVisualContainer",(function(){return r.visualAuthoringOperations.addEmptyVisualContainer(e,t,i)}))},r.prototype.groupVisualContainers=function(e,t){var i=this;return this.undoRedoService.register("GroupVisualContainers",(function(){return i.visualAuthoringOperations.groupVisualContainers(e,t)}))},r.prototype.mergeVisualContainerGroups=function(e,t){var i=this;return this.undoRedoService.register("MergeVisualContainerGroups",(function(){return i.visualAuthoringOperations.mergeVisualContainerGroups(e,t)}))},r.prototype.ungroupVisualContainers=function(e,t){var i=this;return this.undoRedoService.register("UngroupVisualContainers",(function(){return i.visualAuthoringOperations.ungroupVisualContainers(e,t)}))},r.prototype.moveCanvasItemInTree=function(e,t,i,r){var o=this;return this.undoRedoService.register("MoveCanvasItemContainerInTree",(function(){return o.visualAuthoringOperations.moveCanvasItemInTree(e,t,i,r)}))},r.prototype.copyCanvasItem=function(e,t,i){var r=this.explorationSerializer.deserializeCanvasItem(e);r.id=100;var o=this.formFactorProvider.getCurrentLayout(),n=r.layouts.withId(o),a=n.position;return n.position={height:a.height,width:a.width,x:Math.max(0,t?t-a.width/2:0),y:Math.max(0,i?i-a.height/2:0),z:a.z,tabOrder:a.tabOrder},r},r.prototype.addConfigToCategoricalFilters=function(e,t,i){var r=_.filter(e,(function(e){return!e.isInvalid()&&e.canVisualize()}));if(r)for(var o=0,n=r;o<n.length;o++){var a=n[o];this.createFilterVisualContainerConfig(a.contract,i,t)}},r.prototype.createVisualFilters=function(e,t,i,r,o){return this.visualAuthoringOperations.createVisualFilters(e,t,i,r,o)},r.prototype.setFilterSortType=function(e,t,i){var r=this;return this.registerUndoableAction(e,(function(e){return r.visualAuthoringOperations.setFilterSortType(e,t,i)}),"setFilterSortType")},r.prototype.moveFilter=function(e,t,i,r){var o=this;return this.registerUndoableAction(e,(function(e){return o.visualAuthoringOperations.moveFilter(e,t,i,r)}),"moveFilter")},r.prototype.addFilter=function(e,t,i,r){var o=this;return this.registerUndoableAction(i,(function(n){return o.visualAuthoringOperations.addFilter(n,e,t,i,!1,r)}),"AddFilter")},r.prototype.addDrillthroughFilter=function(e,t,r){var o=this;return this.registerUndoableAction(r,(function(a){o.visualAuthoringOperations.addFilter(a,e,t,r,!0);var s=o.explorationNavigationService.getCurrentSection();if(!o.shouldAddBackButton(s))return!0;var l=i.DefaultActionButtonPosition,c=o.explorationNavigationService.getCurrentExploreCanvas();return c&&o.visualAuthoringOperations.addVisualContainerShapeVisual({exploreCanvas:c,position:l,select:!1},n.back,1),!0}),"AddDrillthroughFilter")},r.prototype.shouldAddBackButton=function(e){return e&&1!==e.type&&!this.hasBackButton(e)},r.prototype.runVisualContainerUpdateAction=function(e,t){if(_.isEmpty(t))return!1;for(var i=!1,r=[],o=0,n=t;o<n.length;o++){var a=n[o];if(a&&_.indexOf(r,a)===-1&&e(a)){r.push(a);for(var s=0,l=this.visualSync.getVisualsAffectByFieldChanges(a);s<l.length;s++){var c=l[s];e(c),r.push(c)}i=!0}}return i},r.prototype.hasBackButton=function(t){return _.some(t.visualContainers,(function(t){var i,r=e.data.DataViewObjectDefinitions.getObjectDefinition(t.config.singleVisual.vcObjects,"visualLink",void 0),o=r&&r.properties;return o&&(i={show:o.show&&o.show.value,bookmark:o.bookmark&&o.bookmark.value,type:o.type&&o.type.value}),i&&i.show&&p.getType(i)===p.Back}))},r.prototype.removeFilter=function(i,r){var n=this;return this.undoRedoService.register("RemoveFilter",(function(){var a=2===i.howCreated,s=n.visualAuthoringOperations.removeFilter(i,r);return s&&a&&o(r.container,r)&&n.updateCrossDrillFromVisualContainer(r.container),n.telemetry.logEvent(e.telemetry.EXRemoveFilter,t.util.getTelemetryFilterType(i.type),t.util.getTelemetryFilterScopeType(r.scopeType),i.expression&&t.util.getTelemetryFieldKind(i.expression),t.util.getTelemetryViewMode(n.viewModeState.getMode())),s}))},r.prototype.clearFilter=function(i,r){var o=this;return this.undoRedoService.register("ClearFilter",(function(){o.telemetry.logEvent(e.telemetry.EXClearFilter,t.util.getTelemetryFilterType(r.type),t.util.getTelemetryFilterScopeType(i.scopeType),t.util.getTelemetryFieldKind(r.expression),t.util.getTelemetryViewMode(o.viewModeState.getMode())),o.updateFilter(i,r,void 0)}))},r.prototype.toggleFilterVisibility=function(i,r){var o=this;return this.undoRedoService.register("HideFilter",(function(){o.telemetry.logEvent(e.telemetry.EXHideFilter,t.util.getTelemetryFilterType(r.type),t.util.getTelemetryFilterScopeType(i.scopeType),t.util.getTelemetryFieldKind(r.expression),r.isHiddenInViewMode),r.isHiddenInViewMode=!r.isHiddenInViewMode,o.updateFilter(i,r,r.filter)}))},r.prototype.toggleFilterLock=function(i,r){var o=this;return this.undoRedoService.register("lockFilter",(function(){o.telemetry.logEvent(e.telemetry.EXLockFilter,t.util.getTelemetryFilterType(r.type),t.util.getTelemetryFilterScopeType(i.scopeType),t.util.getTelemetryFieldKind(r.expression),r.isLockedInViewMode),r.isLockedInViewMode=!r.isLockedInViewMode,o.updateFilter(i,r,r.filter)}))},r.prototype.renameFilter=function(e,i,r){var o=this;this.undoRedoService.register("renameFilter",(function(){r?i.displayName=r:i&&delete i.displayName,o.updateFilter(e,i,i.filter)}));var n={filter:i,changeType:256,scope:e};t.FilterUtils.notifyFilterContainerChangedByUser(this.eventBridge,n)},r.prototype.updateFilter=function(e,t,i){var r=2===t.howCreated,n=t.filter;t.filter=i;var s=t.config&&t.config.singleVisual;if(s){var l=this.visualPluginService.capabilities(s.visualType),u=this.filterGenerator.tryGetFilterPropertyIdentifier(l);u&&(s.objects||(s.objects={}),null==i?a.deleteProperty(s.objects,u.objectName,null,u.propertyName):a.setValue(s.objects,u,null,i))}r&&!c.isSameFilter(n,i)&&o(e.container,e)&&this.updateCrossDrillFromVisualContainer(e.container);var p=e.container;null==p.filters&&(p.filters=[]),_.indexOf(p.filters,t)===-1&&p.filters.push(t)},r.prototype.updateTopNFilter=function(i,r,o,n,a){var l,c,p=this;if(i){var d=u.getVisualQuery(i);if(d){var h=d.defn.select();l=_.some(h,(function(e){return s.equals(e.expr,r.fieldBeingFiltered,!0,!0)})),c=_.some(h,(function(e){return s.equals(e.expr,r.orderByField,!0,!0)}))}}var v=this.telemetry.startEvent(e.telemetry.EXFilterPaneTopNFilterApplied,r.isTop,r.itemCount,l,c,t.util.getTelemetryViewMode(this.viewModeState.getMode()),a),g=this.dataSource.get();return this.registerUndoableAction(g,(function(t){var i=e.data.TopNFilterPattern.buildFilterFromParameters({fieldBeingFiltered:r.fieldBeingFiltered,isTop:r.isTop,itemCount:r.itemCount,orderByField:r.orderByField});return p.updateFilter(o,n,i),v.resolve(),!0}),"Apply TopN Filter")},r.prototype.createFilterVisualContainerConfig=function(e,t,i){return this.visualAuthoringOperations.createFilterVisualContainerConfig(e,t,i)},r.prototype.raiseVisualContainerChanged=function(e,t){void 0===t&&(t="UserAction_EditVisual"),this.raiseVisualContainersChanged([e],t)},r.prototype.raiseVisualContainersChanged=function(e,t){void 0===t&&(t="UserAction_EditVisual"),this.eventBridge.publishToChannel(i.events.visualContainerChanged,{affectContainer:function(t){return _.some(e,(function(e){return e===t}))},sourceLabelKey:t})},r.prototype.raiseVisualContainerGroupChanged=function(e){this.raiseVisualContainerGroupsChanged([e])},r.prototype.raiseVisualContainerGroupsChanged=function(e){this.eventBridge.publishToChannel(i.events.visualContainerGroupChanged,{affectContainer:function(t){return _.includes(e,t)}})},r.prototype.raiseCanvasItemChanged=function(e,t){void 0===t&&(t="UserAction_EditVisual"),this.raiseCanvasItemsChanged([e],t)},r.prototype.raiseCanvasItemsChanged=function(e,i){void 0===i&&(i="UserAction_EditVisual");var r=[],o=[];t.contracts.traverseVisualContainerGroups(e,(function(e){t.contracts.isVisualContainer(e)?r.push(e):o.push(e)})),_.isEmpty(r)||this.raiseVisualContainersChanged(r,i),_.isEmpty(o)||this.raiseVisualContainerGroupsChanged(o)},r.prototype.convert=function(e,t,i,r){var o=this;return this.registerUndoableAction(t,(function(t){return r&&o.filterGenerator.clearFiltersFromVisualContainers(r.contract,[e],"UserAction_EditVisual"),o.visualAuthoringOperations.convert(t,e,i)}),"VisualConversion")},r.prototype.setOrderBy=function(e,t){var i=e.config.singleVisual;i.query.orderBy(t),i.hasDefaultSort=!1,this.raiseVisualContainerChanged(e)},r.prototype.removeOrderBy=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];e.config.singleVisual.query.removeOrderBy(o)}this.raiseVisualContainerChanged(e)},r.prototype.setPropertyDefinition=function(e,t,i,r,o){var n=this;this.undoRedoService.register("Set Property",(function(){return void 0!==o&&(n.visualAuthoringOperations.removeProperty(e,t,i),i=o),n.visualAuthoringOperations.addProperty(e,t,i,r),n.raiseVisualContainerChanged(e),!0}))},r.prototype.removePropertyDefinition=function(e,t){var i=this;this.undoRedoService.register("Removing Property",(function(){return i.visualAuthoringOperations.removeProperty(e,t.propertyId,t.selector),i.raiseVisualContainerChanged(e),!0}))},r.prototype.addDataBars=function(e,t,i){var r=this;this.undoRedoService.register("Set Data Bars",(function(){return r.visualAuthoringOperations.addProperty(e,t.propertyId,t.selector,i),r.raiseVisualContainerChanged(e),!0}))},r.prototype.removeDataBars=function(e,t){var i=this;this.undoRedoService.register("Removing Data Bars",(function(){return i.visualAuthoringOperations.removeProperty(e,t.propertyId,t.selector),i.raiseVisualContainerChanged(e),!0}))},r.prototype.removeConditionalFormattingAll=function(e,t){var i=this;this.undoRedoService.register("Removing All Conditional Formatting",(function(){if(!_.isEmpty(t))for(var r=0,o=t;r<o.length;r++){var n=o[r];i.visualAuthoringOperations.removeProperty(e,n.propertyId,n.selector)}return i.raiseVisualContainerChanged(e),!0}))},r.prototype.persistProperties=function(e,t,i){var r=this,o=_.isArray(e)?e:[e],n=t.config.singleVisual,a=function(){var e=n.visualType,i=r.visualPluginService.capabilities(e),a=r.filterGenerator.tryGetFilterPropertyIdentifier(i),s=!1,l=function(e,t,i,r,o){a&&e===a.objectName&&a.propertyName===i&&(s=!0)},c=_.reduce(o,(function(e,t){return r.visualAuthoringOperations.persistProperties(t,n,l)&&e}),!0);return s&&u.notifyVisualContainersExceptSource(r.eventBridge,t,"UserAction_ChangeSlicer"),c?(r.visualSync.syncFilterState(t),c):c};return i?a():this.undoRedoService.register("VisualContainerPersistProperties",a)},r.prototype.persistVCProperties=function(e,t){var i=this,r=t.config.singleVisual,o=function(){var o=_.reduce(e,(function(e,t){return i.visualAuthoringOperations.persistVCProperties(t,r)&&e}),!0);return o&&i.raiseVisualContainerChanged(t),o};return this.undoRedoService.register("VisualContainerPersistVCProperties",o)},r.prototype.deleteSelectedVisuals=function(e){for(var i=_.map(this.selectionService.getSelectedElements(),(function(e){return e.canvasItem})),r=!1,o=0,n=i;o<n.length;o++){var a=n[o];a&&(r=this.deleteVisualContainerInternal(a,e)||r)}if(r){var s=_.chain(i).filter((function(e){return t.contracts.isVisualContainer(e)})).map((function(e){return e})).value();this.notifyVisualContainersAndClearSelection(s,e)}},r.prototype.deleteVisualContainer=function(e,t){this.deleteVisualContainerInternal(e,t)&&this.notifyVisualContainersAndClearSelection([e],t)},r.prototype.deleteVisualContainers=function(i,r){var o=this,n=r.sections.filter((function(e){return e.selected}))[0],a=[];r.contract.sections.forEach((function(r){r.name===n.contract.name?i.forEach((function(e){_.some(r.visualContainers,(function(t){return t.config.singleVisual.visualType===e.config.singleVisual.visualType}))&&a.push(e)})):i.forEach((function(i){_.remove(r.visualContainers,(function(e){return i.config.singleVisual.visualType===e.config.singleVisual.visualType})),r.visualContainerGroups=e.ItemGroupingManager.removeBy(r.visualContainerGroups,(function(e){return t.contracts.isVisualContainer(e)&&i.config.singleVisual.visualType===e.config.singleVisual.visualType})),o.visualAuthoringOperations.deleteVisualRelationships(r,i)}))})),a.length>0&&(a.forEach((function(e){o.deleteVisualContainer(e,r.exploreCanvas)})),this.notifyVisualContainersAndClearSelection(a,r.exploreCanvas))},r.prototype.deleteVisualRelationships=function(e,t){this.visualAuthoringOperations.deleteVisualRelationships(e,t)},r.prototype.setVisualRelationship=function(e,t,i,r){var o=this;this.undoRedoService.register("SetVisualRelationship",(function(){return o.visualAuthoringOperations.setVisualRelationship(e,t,i,r)}))},r.prototype.setDisplayNameAlias=function(e,t,i){var r=this,o=t.config.singleVisual;this.undoRedoService.register("SetDisplayNameAlias",(function(){var n=o.columnProperties;if(i){o.columnProperties||(o.columnProperties=n={});var a=n[e];a||(n[e]=a={}),a.displayName=i}else if(n){var a=n[e];a&&delete a.displayName}r.raiseVisualContainerChanged(t)}))},r.prototype.setLinkFieldAsAggregation=function(e,r,o){var n=this;this.undoRedoService.register("Set Link As Aggregation",(function(){if(t.PodUtils.isPodEnabled(e,r)){var a=n.explorationNavigationService.getCurrentExploration(),s=r.container;if(null!=a&&null!=s){t.PodUtils.updateParameter(a,s.name,e.name,o);var l={filter:e,filterName:e.name,type:2,asAggregation:o};n.eventBridge.publishToChannel(i.events.podParameterChanged,l)}}}))},r.prototype.setRequireSingleSelection=function(e,i,r){var o=e.objects,n="requireSingleSelect",s="general";if(o||(e.objects=o={}),r?a.setValue(o,{objectName:s,propertyName:n},null,l.boolean(r)):a.deleteProperty(o,s,null,n),t.PodUtils.isPodEnabled(e,i)){var c=this.explorationNavigationService.getCurrentExploration(),u=i.container;null!=c&&null!=u&&this.updatePodParameter(e,c,u,r)}},r.prototype.updatePodParameter=function(e,r,o,n){if(n){if(5!==e.howCreated&&!t.PodUtils.hasParameter(r,o.name,e.name)){var a={filterName:e.name,type:0,isCausedByCode:!1,fieldExpr:e.expression,asAggregation:!1,isLegacySingleSelection:!0};t.PodUtils.addParameter(r,o.name,e.name,e.expression,a.asAggregation,!0,t.PodUtils.determineType(o)),this.eventBridge.publishToChannel(i.events.podParameterChanged,a)}}else{t.PodUtils.deleteParameter(r,o.name,e.name,this.linguisticSchemaProxy);var a={filterName:e.name,type:1};this.eventBridge.publishToChannel(i.events.podParameterChanged,a)}},r.prototype.setVisibility=function(e,t,r){var o=this;this.undoRedoService.register("Set Visual Containers Visibility",(function(){for(var n=0,a=t;n<a.length;n++){var s=a[n];o.visualAuthoringOperations.setVisibility(s,e,r)}o.visualAuthoringOperations.notifyVisualContainers(t);var l={changedItems:t};o.eventBridge.publishToChannel(i.events.canvasItemHiddenChanged,l)}))},r.prototype.setVisualContainerGroupVisibility=function(e,t,r){var o=this;this.undoRedoService.register("Set Visual Container Group Visibility",(function(){for(var i=0,n=t;i<n.length;i++){var a=n[i];o.visualAuthoringOperations.setVisualContainerGroupVisibility(a,e,r)}})),this.raiseVisualContainerGroupsChanged(t);var n={changedItems:t};this.eventBridge.publishToChannel(i.events.canvasItemHiddenChanged,n)},r.prototype.setVisualContainerGroupDisplayName=function(e,t){var i=this;this.undoRedoService.register("Set Visual Container Group DisplayName",(function(){for(var r=0,o=t;r<o.length;r++){var n=o[r];i.visualAuthoringOperations.setVisualContainerGroupDisplayName(n,e)}})),this.raiseVisualContainerGroupsChanged(t)},r.prototype.updateContainerListOrders=function(e,t,i){var r=this;this.undoRedoService.register("Update Visual Containers for "+i,(function(){r.visualAuthoringOperations.updateContainerListOrders(e,t,i)}))},r.prototype.applyShowValueAs=function(e,t,i){var r=this;return this.registerUndoableAction(e.dataSources,(function(o){if(r.removeShowValueAs(o,e,t))switch(i.kind){case void 0:return!0;case 0:return r.visualAuthoringOperations.setPercentOfGrandTotal(o,e.visualDataRole.name,e.roleIndex,e.visual);case 1:return r.visualAuthoringOperations.setPercentOfRoleTotal(o,i.roles,e.visualDataRole.name,e.roleIndex,e.visual);default:return!1}}),"applying quick calc ")},r.prototype.toggleSlicerVisualSearch=function(e,t,i){var r=this;this.undoRedoService.register("ToggleSearchVisualContainer",(function(){r.visualAuthoringOperations.toggleSlicerVisualSearch(e,t,i)&&r.raiseVisualContainerChanged(e)}))},r.prototype.removeShowValueAs=function(e,t,i){var r;switch(i.kind){case void 0:return!0;case 0:return this.visualAuthoringOperations.removePercentOfGrandTotal(e,t.visualDataRole.name,t.roleIndex,t.visual);case 1:return r=this.visualAuthoringOperations.removePercentOfRoleTotal(e,t.visualDataRole.name,t.roleIndex,t.visual);default:return!1}},r.prototype.registerUndoableAction=function(e,t,i){var r=this;return this.getSchemaAndExecuteAction(e,(function(e){return r.undoRedoService.register(i,(function(){return t(e)}))}))},r.prototype.getSchemaAndExecuteAction=function(e,t){return this.schemaProxy.get(e).then((function(e){return t(e)}))},r.prototype.notifyVisualContainersAndClearSelection=function(e,t){this.filterGenerator.clearFiltersFromVisualContainers(t.contract,e,"UserAction_EditVisual"),this.selectionService.clearSelection()},r.prototype.deleteVisualContainerInternal=function(i,r,o){if(void 0===o&&(o=!1),i){var n=e.ItemGroupingManager.find(i.name,r.visualContainerGroups);if(n){var a=r.contract;if(t.contracts.isVisualContainer(i)&&t.viewModels.isVisualContainer(n)){this.visualAuthoringOperations.deleteVisualRelationships(r.contract,i);var s=r.visualContainers.indexOf(n);r.visualContainers.splice(s,1);var l=a.visualContainers.indexOf(i);a.visualContainers.splice(l,1)}else if(t.contracts.isVisualContainerGroup(i))for(var c=0,u=i.children;c<u.length;c++){var p=u[c];this.deleteVisualContainerInternal(p,r,!0)}if(!o){a.visualContainerGroups=e.ItemGroupingManager.remove(i,a.visualContainerGroups),r.visualContainerGroups=e.ItemGroupingManager.remove(n,r.visualContainerGroups),t.util.CanvasVisualsUtility.syncCanvasItemViewModelsWithContracts(r.visualContainerGroups,a.visualContainerGroups);var d=n.parentGroup&&e.ItemGroupingManager.find(n.parentGroup.name,r.visualContainerGroups);d&&t.viewModels.isVisualContainerGroup(d)&&this.layoutAuthoring.removeCanvasItemFromGroup(d,n)}return!0}}},r.prototype.updateCrossDrillFromVisualContainer=function(e){var t=this.explorationNavigationService.getCurrentExploration(),i=_.find(t.sections,(function(t){return _.includes(t.visualContainers,e)}));i&&this.filterGenerator.updateCrossFilterOnDrill(i,e)},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){function t(t,i,r){var o=_.find(i.visualContainers,(function(e){return e.contract===r}));if(o)return _.pull(i.visualContainers,o),i.visualContainerGroups=e.ItemGroupingManager.remove(o,i.visualContainerGroups),_.remove(r.layouts,(function(e){return e.id===t})).length>0}var i=e.explore.services,r=e.explore.util.CanvasDisplayUtility,o=e.explore.constants.ExploreCanvasConstants,n=e.telemetry,a=e.explore.viewModels,s=e.explore.viewModels.ViewModelFactory,l=e.explore.util.VisualContainerUtils,c=(function(){function c(e,t,i,r,o,n,a,s,l){var c=this;this.telemetryService=e,this.eventBridge=t,this.undoRedoService=i,this.explorationNavigation=r,this.formfactorProvider=o,this.selectionService=n,this.explorationCapabilities=a,this.visualAuthoringLazy=s,this.groupingLayoutManagersLazy=_.map(l,(function(e){return new jsCommon.Lazy(function(){return new e(c)})}))}return Object.defineProperty(c.prototype,"visualAuthoring",{get:function(){return this._visualAuthoring||(this._visualAuthoring=this.visualAuthoringLazy()),this._visualAuthoring},enumerable:!0,configurable:!0}),c.prototype.groupCanvasItems=function(e){var t=this.explorationNavigation.getCurrentExploreCanvas(),i=this.visualAuthoring.groupVisualContainers(t,e);this.getGroupingLayoutManager(i.contract.groupMode).onCreateGroup(i)},c.prototype.ungroupCanvasItems=function(e){var t=this.explorationNavigation.getCurrentExploreCanvas(),i=this.visualAuthoring.ungroupVisualContainers(t,e);this.getGroupingLayoutManager(i.contract.groupMode).onUngroup(i)},c.prototype.mergeVisualContainerGroups=function(t){var i=this.explorationNavigation.getCurrentExploreCanvas(),r=this.visualAuthoring.mergeVisualContainerGroups(i,t),o=e.ItemGroupingManager.find(t[0].name,i.visualContainerGroups);if(o&&a.isVisualContainerGroup(o)){for(var n=this.getGroupingLayoutManager(o.contract.groupMode),s=1;s<r.length;s++)if(r[s]){if(r[s].parentGroup){var l=e.ItemGroupingManager.find(r[s].parentGroup.name,i.visualContainerGroups);if(l){var c=this.getGroupingLayoutManager(l.contract.groupMode);c.onUpdateGroupChildren(l)}}var u=r[s].clone(),p=u.children;u.children=[];for(var d=this.getGroupingLayoutManager(u.contract.groupMode),h=0,v=p;h<v.length;h++){var g=v[h];d.onRemoveChild(u,g,!1),n.onAddChild(o,g,!1)}}n.onUpdateGroupChildren(o)}},c.prototype.moveCanvasItemInTree=function(t,i,r){var o,n=this.explorationNavigation.getCurrentExploreCanvas(),s=t.parentGroup&&t.parentGroup.name;s&&(o=e.ItemGroupingManager.find(s,n.visualContainerGroups));var l=this.visualAuthoring.moveCanvasItemInTree(n,t,i,r),c=l.parentGroup&&l.parentGroup.name;if(s!==c){if(s){var u=e.ItemGroupingManager.find(s,n.visualContainerGroups);u?a.isVisualContainerGroup(u)&&this.removeCanvasItemFromGroup(u,l):this.getGroupingLayoutManager(o.contract.groupMode).onRemoveChild(o,l,!1)}if(c){var p=e.ItemGroupingManager.find(c,n.visualContainerGroups);a.isVisualContainerGroup(p)&&this.addCanvasItemToGroup(p,l)}}},c.prototype.addLayoutToVisualContainer=function(t,r,o){var n=this;this.undoRedoService.register("AddLayoutToVisualContainer",(function(){var a=n.formfactorProvider.getCurrentLayout();r.layouts.push({id:a,position:o});var l=s.convertVisualContainer(n.explorationNavigation.getCurrentExploration(),t.contract,r,a);t.visualContainers.push(l),t.visualContainerGroups=e.ItemGroupingManager.add(t.visualContainerGroups,l),n.eventBridge.publishToChannel(i.events.canvasChanged)}))},c.prototype.removeLayoutFromSelectedVisuals=function(e){var r=this;this.undoRedoService.register("RemoveLayoutFromSelectedVisuals",(function(){for(var o=_.map(r.selectionService.getSelectedElements(),(function(e){return e.canvasItem})),n=r.formfactorProvider.getCurrentLayout(),a=0,s=o;a<s.length;a++){t(n,e,s[a])}r.eventBridge.publishToChannel(i.events.canvasChanged)}))},c.prototype.removeLayoutFromVisualContainer=function(e,r){var o=this;this.undoRedoService.register("RemoveLayoutFromVisualContainer",(function(){t(o.formfactorProvider.getCurrentLayout(),e,r),o.eventBridge.publishToChannel(i.events.canvasChanged)}))},c.prototype.removeLayoutFromSection=function(e,t,r){var o=this,a=0,s=e.visualContainers;this.undoRedoService.register("RemoveLayoutsFromVisualContainers",(function(){for(var e=0,r=s;e<r.length;e++){var n=r[e];_.remove(n.layouts,(function(e){return e.id===t})).length>0&&a++}o.eventBridge.publishToChannel(i.events.sectionLayoutRemoved)})),1===t&&this.telemetryService.logEvent(n.EXRemoveMobileCanvasVisuals,r.reportId,a)},c.prototype.moveCanvasItemFromContract=function(t,i){var r=this.explorationNavigation.getCurrentExploreCanvas(),o=e.ItemGroupingManager.find(t.name,r.visualContainerGroups);if(a.isVisualContainerGroup(o)){var n={width:i.width,height:i.height};this.updateGroupSize(o,n,!1)}this.moveCanvasItem(o,i)},c.prototype.moveCanvasItem=function(e,t,r){void 0===r&&(r=!1),e.position=t,e.updateViewState();var o=this.formfactorProvider.getCurrentLayout();!r&&e.parentGroup&&0===o&&this.getGroupingLayoutManager(e.parentGroup.contract.groupMode).onUpdateGroupChildren(e.parentGroup);var n=e.contract;this.eventBridge.publishToChannel(i.events.canvasItemContainerPositionChanged,{affectContainer:function(e){return e===n}})},c.prototype.updateGroupSize=function(e,t,i){this.getGroupingLayoutManager(e.contract.groupMode).onUpdateGroup(e,t,i)},c.prototype.addCanvasItemToGroup=function(e,t){this.getGroupingLayoutManager(e.contract.groupMode).onAddChild(e,t)},c.prototype.removeCanvasItemFromGroup=function(e,t){this.getGroupingLayoutManager(e.contract.groupMode).onRemoveChild(e,t)},c.prototype.moveContainersHelper=function(e,t,i){for(var r=0,o=e;r<o.length;r++){var n=o[r],a=i?this.getAbsolutePositionToCanvas(n):n.position;t(a),i&&(a=this.getRelativePositionToParentGroup(a,n)),this.moveCanvasItem(n,a)}},c.prototype.getGroupingLayoutManager=function(e){return this.groupingLayoutManagersLazy[e].getValue()},c.prototype.alignSelectedVisuals=function(e,t,i){1===i.length?this.alignSingleVisualContainer(e,t,i[0]):this.alignMultipleVisualContainers(e,t,i)},c.prototype.visualsInLayout=function(e,t){return _.filter(e.visualContainers,(function(e){return _.some(e.layouts,(function(e){return e.id===t}))}))},c.prototype.getAbsolutePositionToCanvas=function(e){var t=this.formfactorProvider.getCurrentLayout(),i=e.contract.parentGroup;return i=i&&i.layouts.withId(t)?i:void 0,l.getAbsoluteVisualContainerPosition(e.position,t,i)},c.prototype.getRelativePositionToParentGroup=function(e,t){var i=this.formfactorProvider.getCurrentLayout();return l.getGroupRelativeVisualContainerPosition(e,t.contract,i)},c.prototype.alignMultipleVisualContainers=function(e,t,i){var r=this;this.undoRedoService.register("AlignMultipleVisualContainers",(function(){var o=_.map(i,(function(e){return r.getAbsolutePositionToCanvas(e)}));switch(e){case 3:var n=_.min(_.map(o,(function(e){return e.y})));r.moveContainersHelper(i,(function(e){return e.y=c.clampYValue(n,e.height,t)}),!0);break;case 4:var a=_.sumBy(o,(function(e){return e.y+e.height/2})),s=a/o.length;r.moveContainersHelper(i,(function(e){return e.y=c.clampYValue(s-e.height/2,e.height,t)}),!0);break;case 5:var l=_.max(_.map(o,(function(e){return e.y+e.height})));r.moveContainersHelper(i,(function(e){return e.y=c.clampYValue(l-e.height,e.height,t)}),!0);break;case 0:var u=_.min(_.map(o,(function(e){return e.x})));r.moveContainersHelper(i,(function(e){return e.x=c.clampXValue(u,e.width,t)}),!0);break;case 1:var p=_.sumBy(o,(function(e){return e.x+e.width/2})),d=p/o.length;r.moveContainersHelper(i,(function(e){return e.x=c.clampXValue(d-e.width/2,e.width,t)}),!0);break;case 2:var h=_.max(_.map(o,(function(e){return e.x+e.width})));r.moveContainersHelper(i,(function(e){return e.x=c.clampXValue(h-e.width,e.width,t)}),!0);break;case 6:r.distributeSpace(i,o,!0,t);break;case 7:r.distributeSpace(i,o,!1,t)}}))},c.prototype.alignSingleVisualContainer=function(e,t,i){var r=this;this.undoRedoService.register("AlignSingleVisualContainer",(function(){var o=i.position,n=t.width,a=t.height;if(i.parentGroup){var s=i.parentGroup.position;s&&(n=s.width,a=s.height)}switch(e){case 3:r.moveContainersHelper([i],(function(e){return e.y=0}),!1);break;case 4:case 7:var l=a/2-o.height/2;r.moveContainersHelper([i],(function(e){return e.y=l}),!1);break;case 5:var c=a-o.height;r.moveContainersHelper([i],(function(e){return e.y=c}),!1);break;case 0:r.moveContainersHelper([i],(function(e){return e.x=0}),!1);break;case 1:case 6:var u=n/2-o.width/2;r.moveContainersHelper([i],(function(e){return e.x=u}),!1);break;case 2:var p=n-o.width;r.moveContainersHelper([i],(function(e){return e.x=p}),!1)}}))},c.prototype.distributeSpace=function(e,t,i,r){for(var o=this,n=i?"x":"y",a=i?"width":"height",s=i?c.clampXValue:c.clampYValue,l=_.min(_.map(t,(function(e){return e[n]}))),u=_.max(_.map(t,(function(e){return e[n]+e[a]}))),p=_.reduce(t,(function(e,t){return e-t[a]}),u-l),d=p/(e.length-1),h=_.sortBy(e,(function(e){return o.getAbsolutePositionToCanvas(e)[n]})),v=l,g=0,f=h;g<f.length;g++){var y=f[g],m=this.getAbsolutePositionToCanvas(y);m[n]=s(v,m[a],r),v+=m[a]+d,m=this.getRelativePositionToParentGroup(m,y),this.moveCanvasItem(y,m)}},c.prototype.getLayoutForNewVisualContainer=function(e,t,i){var o=this.formfactorProvider.getCurrentLayout(),n=r.getAutoLayoutVisualVCHeader(this.formfactorProvider,this.explorationCapabilities),a=_.map(e,(function(e){var t=r.visualPositionToRect(e.layouts.withId(o).position);return t.top-=n,t.height+=n,t})),s=this.getLayoutForNewVisualContainerWithRects(a,t,i);return s.top+=n,s.height-=n,r.rectToVisualPosition(s)},c.prototype.getLayoutForNewVisualContainerWithRects=function(t,i,r){return e.explore.utils.getBestFitRectangle(t,i,{left:0,top:0,width:r.width,height:r.height},o.AutoLayoutMinSpaceWidth,o.AutoLayoutMinSpaceHeight,o.AutoLayoutMaxSpaceWidth,o.AutoLayoutMaxSpaceHeight,o.AutoLayoutVisualPadding)},c.clampXValue=function(e,t,i){return e<0?0:t+e>i.width?i.width-t:e},c.clampYValue=function(e,t,i){return e<0?0:t+e>i.height?i.height-t:e},c})();return{create:function(e,t,i,r,o,n,a,s,l){return new c(e,t,i,r,o,n,a,s,l)}}}e.layoutAuthoringModuleFactory=t})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,c,u){return new l(e,t,i,r,o,n,a,s,c,u)}var o=e.explore.util.CanvasVisualsUtility,n=jsCommon.FocusNavigationUtility,a=e.a11y.util.FocusUtility,s=t.services.selectionUtils;i.createCanvasKeyHandlerService=r;var l=(function(){function e(e,t,i,r,o,n,a,s,l,c){this.clipboardService=e,this.selectionService=t,this.featureSwitchService=i,this.viewModeState=r,this.undoRedoService=o,this.visualAuthoring=n,this.eventBridge=a,this.visibilityService=s,this.formFactor=l,this.layoutAuthoring=c}return e.prototype.onKeyDown=function(e,t){var i=e.which;if(27===i){return!!this.visibilityService.get()?(this.onExitPopOutMode(e,t),this.onClearFormatPainterData(e),this.preventStopAndReturnFalse(e)):(this.onClearSelection(e),void this.onClearFormatPainterData(e))}if(this.isSaveEvent(e))return this.onSave(),this.preventStopAndReturnFalse(e);var r=this.formFactor.getCurrentLayoutCapabilities();if(0!==this.viewModeState.getMode()){if(this.isDeleteEvent(e)&&!this.isFocusedOnTextElement())return r.canRemoveVisualFromLayout()?this.onRemoveFromLayout(e,t):r.canDelete()&&this.onDelete(e,t),this.preventStopAndReturnFalse(e);if(this.isCtrlOrMeta(e)&&!this.isFocusedOnTextElement()){var o=!_.isEmpty(this.selectionService.getSelectedElements());switch(i){case 65:return this.onSelectAll(e,t),this.preventStopAndReturnFalse(e);case 67:return!r.canCutCopyPaste()||!o||(this.onCopy(e),this.preventStopAndReturnFalse(e));case 88:return!r.canCutCopyPaste()||!o||(this.onCut(e),this.preventStopAndReturnFalse(e));case 86:return r.canCutCopyPaste()&&this.onPaste(e),
this.preventStopAndReturnFalse(e);case 89:return this.onRedo(),this.preventStopAndReturnFalse(e);case 90:return this.onUndo(),this.preventStopAndReturnFalse(e);case 191:return this.onShowQna(),this.preventStopAndReturnFalse(e)}}return r.canPassUnhandledKeysToSelectedVisual()?this.allowSelectedVisualContainerToHandle(e,t):void 0}return r.canPassUnhandledKeysToSelectedVisual()?this.allowSelectedVisualContainerToHandle(e,t):void 0},e.prototype.isFocusedOnTextElement=function(){var e=document.activeElement;return n.isElementContentEditable(e)||n.isTextElement(e)},e.prototype.allowSelectedVisualContainerToHandle=function(e,t){if(a.isFocusInTree(".visualContainer")){var i=s.getSelectedVisual(this.selectionService);if(i){var r=o.findVisualContainerViewModel(t.visualContainers,i);if(r)return r.handleKeyDown(e)}}},e.prototype.preventStopAndReturnFalse=function(e){return e&&(e.preventDefault(),e.stopPropagation()),!1},e.prototype.onUndo=function(){this.undoRedoService.undo()},e.prototype.onRedo=function(){this.undoRedoService.redo()},e.prototype.onCopy=function(e){this.canCopyOrCut()&&this.clipboardService.copy()},e.prototype.onCut=function(e){this.canCopyOrCut()&&this.clipboardService.cut()},e.prototype.onPaste=function(e){this.clipboardService.paste()},e.prototype.onRemoveFromLayout=function(e,t){this.layoutAuthoring.removeLayoutFromSelectedVisuals(t)},e.prototype.onDelete=function(e,t){var i=this;this.undoRedoService.register("CanvasKeyDelete",(function(){i.visualAuthoring.deleteSelectedVisuals(t)}))},e.prototype.onClearSelection=function(e){this.selectionService.clearSelection()},e.prototype.onClearFormatPainterData=function(e){this.clipboardService.clearFormatData()},e.prototype.onExitPopOutMode=function(e,t){this.visibilityService.clear()},e.prototype.onSelectAll=function(e,t){var i;i=t.visualContainerGroups?_.map(t.visualContainerGroups,(function(e){return e.contract})):_.map(t.visualContainers,(function(e){return e.contract})),s.selectCanvasItems(i,this.selectionService)},e.prototype.onSave=function(){this.eventBridge.publishToChannel(i.events.saveKeyPressedEvent)},e.prototype.onShowQna=function(){this.eventBridge.publishToChannel(i.events.addQnaContainer,{creationSource:7})},e.prototype.isSaveEvent=function(e){return this.isOnlyCtrlOrMeta(e)&&83===e.which},e.prototype.isDeleteEvent=function(e){return!e.ctrlKey&&46===e.which},e.prototype.canCopyOrCut=function(){return!this.visibilityService.get()},e.prototype.isCtrlOrMeta=function(e){var t=e.ctrlKey,i=e.metaKey;return e&&(t&&!i||!t&&i)},e.prototype.isOnlyCtrlOrMeta=function(e){return this.isCtrlOrMeta(e)&&!e.altKey&&!e.shiftKey},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o,n,a,s){return new i(e,t,r,o,n,a,s)}e.createCanvasScaleService=t;var i=(function(){function t(e,t,i,r,o,n,a){this.eventBridge=e,this.explorationNavigation=t,this.featureSwitchService=i,this.formFactorProvider=r,this.visibility=o,this.viewModeState=n,this.overlayService=a,this.displayAreaScale=1,this.wallpaperScale=1}return t.prototype.setDisplayAreaScaleFactor=function(t){this.displayAreaScale=t,this.featureSwitchService.featureSwitches.canvasZoom&&this.eventBridge.publishToChannel(e.events.canvasZoomScaleUpdated,t)},t.prototype.setWallpaperScaleFactor=function(e){this.wallpaperScale=e},t.prototype.getDisplayAreaScaleFactor=function(){return this.displayAreaScale},t.prototype.getWallpaperScaleFactor=function(){return this.wallpaperScale},t.prototype.getDisplayOption=function(){if(1===this.formFactorProvider.getCurrentLayout()&&1===this.viewModeState.getMode())return 3;if(!!this.visibility.get())return 0;if(null!=this.overrideDisplayOption)return this.overrideDisplayOption;var e=this.explorationNavigation.getCurrentSection();return e?e.size.displayOption:void 0},t.prototype.setDisplayOption=function(e){var t=this.explorationNavigation.getCurrentSection();t&&(this.overlayService.hideAllDropdowns(),t.size.displayOption=e)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new o(e,t,i,r)}var r=e.explore.services.events;t.createDeleteVisualService=i;var o=(function(){function t(e,t,i,r){this.eventBridge=e,this.telemetryService=t,this.visualPluginService=i,this.undoRedoService=r}return t.prototype.deleteCustomVisuals=function(t,i){var o=this;this.undoRedoService.register("DeleteCustomVisual",(function(){i.forEach((function(i){o.telemetryService.logEvent(e.telemetry.EXDeleteCustomViz,i.name),o.visualPluginService.removePlugin(i.name),_.remove(t.resourcePackages,(function(e){return e.name===i.name})),o.eventBridge.publishToChannel(r.deleteCustomVisual,{visual:i})})),o.eventBridge.publishToChannel(r.visualPluginsChanged)}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e){return new r(e)}t.createDetailVisualSpinnerService=i;var r=(function(){function t(e){this.scope=e}return t.prototype.startSpinner=function(){this.scope.$emit(e.viewModels.DetailVisualEvents.spinnerAction.name,0)},t.prototype.stopSpinner=function(){this.scope.$emit(e.viewModels.DetailVisualEvents.spinnerAction.name,1)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i){return new c(e,t,i)}var o=e.explore.util.DrillUtils,n=jsCommon.EnumExtensions,a=t.util.DetailVisualUtils,s=e.visuals.plugins,l=t.util.VisualContainerUtils;i.createDrillService=r;var c=(function(){function t(e,t,i){this.eventBridge=e,this.visualPlugin=t,this.visualPluginOps=i}return t.prototype.getSupportedDrillDirections=function(e,t){var i=this.getProjections(e);if(!i)return 0;var r=t?[t]:[];if(_.isEmpty(r)){var n=e.config.singleVisual,a=this.visualPlugin.capabilities(n.visualType);if(!a||a.drilldown&&a.drilldown.suppresDrillOperations)return 0;r=o.getDrillableRoles(a)}for(var s=0,l=0,c=r;l<c.length;l++){var u=c[l],p=i[u];if(p&&p.activeProjectionRefs){var d=p.all();if(1===d.length)continue;var h=p.activeProjectionRefs,v=this.findActiveProjectionIndexInQueryCollection(d,h);_.isEmpty(h)||v+h.length===d.length||(this.canDrillDownLevel(e,2,u)&&(s|=2),this.canDrillDownLevel(e,3,u)&&(s|=4)),!_.isEmpty(p.activeProjectionRefs)&&(0!==v||h.length>1)&&(s|=1)}}return s},t.prototype.setDrillMode=function(e,t){e&&e.drillMode!==t&&(e.drillMode=t,this.raiseDrillModeChanged(e,t))},t.prototype.canSeeData=function(e){if(!(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query))return!1;var t=l.getVisualType(e),i=e.config.singleVisual;return!(i.getErrorDetails&&!!i.getErrorDetails())&&a.supportsVisualDetails(t,this.visualPlugin,this.visualPluginOps)},t.prototype.canDrillToDetails=function(t,i){if(!t)return!1;var r=l.getVisualQuery(t);if(!r)return!1;var o=l.getVisualType(t);if(o===s.lineChart.name||o===s.areaChart.name||o===s.stackedAreaChart.name)return!1;var n=l.getVisualCapabilities(t,this.visualPlugin);if(!n||n.supportsSelection===!1)return!1;var a=_(l.getSelectExprs(t)).filter((function(t){return e.data.SQExpr.isAggregation(t.expr)})).map((function(e){return e.name})).value();if(_.isEmpty(a))return!1;if(!_.isEmpty(i)&&!_.includes(a,_.head(_.head(i).metadata)))return!1;var c=n.dataRoles;if(_.isEmpty(c))return!1;for(var u=_(c).filter((function(t){return t.kind===e.VisualDataRoleKind.Measure&&0!==t.joinPredicate})).map((function(e){return e.name})).value(),p=0,d=0,h=u;d<h.length;d++){var v=h[d],g=r.projections[v];if(!_.isEmpty(g)){if(p++,p>1)return!1;var f=g.all();if(_.some(f,(function(e){return!_.includes(a,e.queryRef)})))return!1}}return 0!==p},t.prototype.canDrillByDirection=function(e,t,i){if(!e||e.config.singleVisual.getErrorDetails&&!!e.config.singleVisual.getErrorDetails())return!1;var r=this.getSupportedDrillDirections(e,i);return!!r&&n.hasFlag(r,t)},t.prototype.canDrillthrough=function(e){return!!e},t.prototype.isDrillModeEnabled=function(e,t){return!!e&&e.drillMode===t},t.prototype.canDrillDownLevel=function(t,i,r){var o=l.getVisualQuery(t);if(!o)return!1;var n=l.getVisualCapabilities(t,this.visualPlugin);if(!n)return!1;if(n.drilldown&&n.drilldown.suppresDrillOperations)return!1;if(!r)return!1;var a=o.projections[r],s=a.getLastActiveQueryReference();if(!s)return!1;for(var c=_.findIndex(a.all(),(function(e){return e.queryRef===s})),u=function(n){var s=a.all()[n],l=o.defn.select().withName(s.queryRef).expr;if(0===_.filter(t.filters,(function(t){return 2===t.howCreated&&e.data.SQExpr.equals(l,t.expression)})).length)return{value:o.currentDrillMode(r)===i}},p=0;p<c;p++){var d=u(p);if("object"==typeof d)return d.value}return 3!==i||!_.find(o.expansionStates,(function(e){return _.find(e.roles,(function(e){return e===r}))&&e.isStateModified()}))},t.prototype.getProjections=function(e){return e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.projections},t.prototype.findActiveProjectionIndexInQueryCollection=function(e,t){if(!_.isEmpty(t))for(var i=0;i<e.length;i++){for(var r=i,o=0;o<t.length&&r<e.length&&t[o]===e[r].queryRef;)o++,r++;if(o===t.length)return i}return-1},t.prototype.raiseDrillModeChanged=function(e,t){var r={visualContainer:e};this.eventBridge.publishToChannel(i.events.drillModeChanged,r)},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.visualCustomCommand={type:2,name:"visualCustomCommand"},e.preparePersonalVisuals={type:2,name:"preparePersonalVisuals"},e.copyVisualAsImage={type:2,name:"copyVisualAsImage"}})(t=e.events||(e.events={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}e.createExplorationCapabilitiesService=t;var i=(function(){function e(e,t){var i=!t||t.featureSwitches.contentAuthoringUIEnabled,r=!!e&&!!e.isGuestUser,o=!!t&&t.featureSwitches.elevatedGuestsTenantEnabled,n=r&&!o;this.options={shouldSetTabIndexOnExploration:!0,showAppBar:!0,showTaskPane:!0,showVisualizationPane:!0,showNavContentPane:!0,visualContainerOptions:{showMenu:!0,showPin:!0,showContextMenu:!0,disablePin:n||!i,disableQueryCacheUpdates:!1},showBackButtonOnAppBar:!1,disablePin:n||!i,disableSharePointEmbed:r,disableSecurePublishToWeb:r||!i,disableQRGeneration:r,disableSaveAs:n,disableSwitchMode:n||!i,disableAnalyzeInExcel:r,persistentUserStateEnabled:!1,persistentUserStateThrottlingEnabled:!1,defaultPersonalBookmarkEnabled:!1,disableEditVariables:!0,disableChangeDetectionDialog:!0,showCopyVisualImageButton:!1,disableAnchorTime:!1}}return e.prototype.setCapabilities=function(e){_.merge(this.options,e)},e.prototype.getCapabilities=function(){return this.options},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o){return new a(e,t,i,r,o)}var o=jsCommon.FreezeUtility,n=e.common.helpers.TelemetryHelper;i.createFormFactorProvider=r;var a=(function(){function r(e,t,i,r,o){this.canvasLayout=0,this.canvasLayoutCapabilities=this.initializeLayoutCapabilities(),this.eventBridge=e,this.selection=t,this.servicePauser=i,this.viewModeState=r,this.telemetry=o}return r.prototype.getCurrentLayout=function(){return this.canvasLayout},r.prototype.changeFormFactor=function(i,r){this.canvasLayout!==i&&(this.telemetry.logEvent(e.telemetry.EXChangeCanvasLayout,n.getTelemetryCanvasLayout(this.canvasLayout),n.getTelemetryCanvasLayout(i),t.util.getTelemetryViewMode(this.viewModeState.getMode())),this.selection.clearSelection(),this.setCurrentLayout(i),this.applyFormFactor(i,r))},r.prototype.applyFormFactor=function(e,r){var o=this,n=r.exploration.contract,a=n.activeSectionIndex;r.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(n,n.sections[a],this.canvasLayout),this.updateViewModeState();var s={layout:e};setTimeout((function(){return o.eventBridge.publishToChannel(i.events.formFactorChanged,s)}))},r.prototype.getCurrentLayoutCapabilities=function(){return this.canvasLayoutCapabilities[this.canvasLayout]},r.prototype.setCurrentLayout=function(e){this.canvasLayout=e,0===this.canvasLayout?this.servicePauser.resume():this.servicePauser.pause()},r.prototype.updateViewModeState=function(){var e=this.getCurrentLayoutCapabilities();this.viewModeState.updateConfig((function(t){t.displayOptions.showMobilePane=e.canShowMobileVisualizationPane()}))},r.prototype.initializeLayoutCapabilities=function(){var e,t=this,i=function(){return 1===t.viewModeState.getMode()},r=function(){return 0===t.viewModeState.getMode()},n=(e={},e[0]={canMoveMultipleVisuals:_.noopTrue,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopFalse,canShowCanvasOutspace:_.noopTrue,canShowCodePane:_.noopTrue,canShowVisualContainerHeader:_.noopTrue,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopFalse,canShowLayoutGrid:i,canRemoveVisualFromLayout:_.noopFalse,canCutCopyPaste:_.noopTrue,canDelete:_.noopTrue,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:i,canShowVisualToolbar:i},e[1]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:i,canShowCanvasOutspace:_.noopTrue,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:r,canShowVisualContainerHeaderInset:_.noopTrue,canShowMobileVisualizationPane:i,canShowLayoutGrid:i,canRemoveVisualFromLayout:i,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},e[2]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopTrue,canShowCanvasOutspace:_.noopTrue,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:_.noopFalse,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopTrue,canShowLayoutGrid:_.noopFalse,canRemoveVisualFromLayout:_.noopTrue,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},e);return o.deepFreeze(n),n},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n,a){return new s(e,t,i,r,o,n,a)}var r=e.visuals.plugins.multiRowCard,o=e.data.SemanticQuery,n=e.explore.util.VisualHostServicesUtil,a=e.explore.contracts.VisualQuery;t.createGroupQueryService=i;var s=(function(){function i(e,t,i,r,o,n,a){this.conceptualSchemaProxy=i,this.visualQueryGenerator=r,this.promiseFactory=o,this.singleExecutableDataProxyFactory=e,this.filterGenerator=t,this.visualPluginService=n,this.explorationCapabilitiesService=a,this.reset()}return i.prototype.getValuesForColumn=function(t,i,r){var s=this,l=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(c){var u=new a(o.create(),{},[]);u.add(t,"Values"),s.runQueryImpl({dataSources:i,schema:c,config:{visualType:e.visuals.plugins.table.name,query:u},hostServices:n.createQueryVisualHostServices(),visualQueryGenerator:s.visualQueryGenerator,executionType:r?1:0,preferCurrentData:!r,allowCache:!1,isInitialLoad:!r}).then((function(e){s.lastResult=e?{table:e.dataReaderResult.dataView.table,canLoadMore:s.dataProxy.canLoadMore()}:s.lastResult,l.resolve(s.lastResult)}),(function(e){l.reject(e)}))}),(function(e){l.reject(e.clientError)})),l.promise},i.prototype.getAggregatesForColumn=function(e,t){var i=this,s=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(t).then((function(l){var c=new a(o.create(),{},[]),u=r.capabilities.dataRoles[0].name;c.add(e,u),c.setAggregate(u,0,3),c.add(e,u),c.setAggregate(u,1,4),c.add(e,u),c.setAggregate(u,2,5),i.runQueryImpl({dataSources:t,schema:l,config:{visualType:r.name,query:c},hostServices:n.createQueryVisualHostServices(),visualQueryGenerator:i.visualQueryGenerator,executionType:0,preferCurrentData:!1,allowCache:!1}).then((function(e){var t,i=e.dataReaderResult.dataView.table,r=i&&i.rows;if(r&&r.length>0){var o=r[0];t=o?{min:{formatString:i.columns[0].format,value:o[0]},max:{formatString:i.columns[1].format,value:o[1]},count:o[2]}:void 0}s.resolve(t)}),(function(e){s.reject(e)}))}),(function(e){s.reject(e.clientError)})),s.promise},i.prototype.reset=function(){this.conceptualSchemaProxy.clearCache(),this.dataProxy=t.createExploreVisualDataProxyService(this.singleExecutableDataProxyFactory.create(),this.filterGenerator,this.promiseFactory,this.visualPluginService,this.explorationCapabilitiesService)},i.prototype.runQueryImpl=function(e){return this.dataProxy.runQuery(e)},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n){return new v(e,t,i,r,o,n)}var r=e.visuals.DefaultTooltipOptions,o=e.visuals.TouchOptimizedTooltipOptions;t.createHostTooltipService=i;var n="body",a=350,s=350,l=350,c=350,u=500,p='<visual-tooltip tooltip-data="tooltipData" tooltip-data-sources="tooltipDataSources" tooltip-data-items="tooltipDataItems" on-hide="onHide()" on-move="onMove()" actions-provider="actionsProvider" exploration-contract="explorationContract" exploration-capabilities="explorationCapabilities" show-action-bar="showActionBar" section-display-option="sectionDisplayOption" tooltip-shown="tooltipShown"></visual-tooltip>',d='<visual-tooltip-modern [tooltip-data]="tooltipData" [tooltip-data-sources]="tooltipDataSources" [tooltip-data-items]="tooltipDataItems" (on-hide)="onHide()" (on-move)="onMove()" [actions-provider]="actionsProvider" [exploration-contract]="explorationContract" [exploration-capabilities]="explorationCapabilities" [show-action-bar]="showActionBar" [section-display-option]="sectionDisplayOption" [tooltip-shown]="tooltipShown"></visual-tooltip>',h=12,v=(function(){function t(t,i,o,a,s,l){var c=this;this.$compile=t,this.$injector=i,this.$rootScope=o,this.$timeout=a,this.featureSwitchService=s,this.enforceTouchScreenOptimizedTooltip=l,this.hideTooltipHandler=function(e){"touch"!==e.pointerType||e.tooltip||(c.hide({isTouchEvent:!0,immediately:!0}),document.removeEventListener("pointerdown",c.hideTooltipHandler),c.customVisuals.each((function(e,t){t.removeEventListener("pointerdown",c.hideTooltipHandler)})))},this.parentContainer=$(n);var u=this.parentContainer.get(0);this.tooltipContainer=e.visuals.createTooltipContainer(u,r)}return t.prototype.isTouchScreenOptimizedEnabled=function(){return this.enforceTouchScreenOptimizedTooltip||this.featureSwitchService.featureSwitches&&this.featureSwitchService.featureSwitches.touchScreenOptimizedTooltips},t.prototype.show=function(t){var i=this,n=t.isTouchEvent&&this.isTouchScreenOptimizedEnabled(),s=e.Prototype.inherit(n?o:r,(function(e){e.useLightColors=t.useLightColors,e.showImmediatelyAdjacentToClickedArea=t.showImmediatelyAdjacentToClickedArea,e.showAboveClickedArea=t.showTooltipAboveClick}));this.tooltipContainer.setTooltipAppearanceOptions(s),this.clearTooltipTimeout();var c;c=this.tooltipContainer.isVisible()?16:t.isTouchEvent?void 0!==t.showDelay?t.showDelay:l:void 0!==t.showDelay?t.showDelay:a,this.ensureVisualTooltipManager(),this.visualTooltipManager.updateData({dataItems:t.dataItems,dataSources:t.dataSources,explorationContract:t.explorationContract,explorationCapabilities:t.explorationCapabilities,visualTooltipData:t.visualTooltipData});var u=n?2:void 0;this.visualTooltipManager.updateOptions(n,t.visualHostTooltipActionsProvider,u),this.customVisuals=$(document).find(".visual-sandbox"),this.move(t,!1),this.delayedTooltipPromise=this.$timeout((function(){t.isTouchEvent&&(i.customVisuals.each((function(e,t){t.addEventListener("pointerdown",i.hideTooltipHandler)})),document.addEventListener("pointerdown",i.hideTooltipHandler));var e=i.tooltipContainer.isVisible();i.showTooltipContainer(),e?i.startLongPause(t.identities):i.delayedTooltipPromise=i.$timeout((function(){i.move(t,!1),i.startLongPause(t.identities)}))}),c)},t.prototype.showTooltipContainer=function(){this.tooltipContainer.show(),this.visualTooltipManager&&(this.visualTooltipManager.updateTooltipShown(!0),this.visualTooltipManager.applyChanges())},t.prototype.hideTooltipContainer=function(e){this.tooltipContainer.hide(),this.visualTooltipManager&&this.visualTooltipManager.updateTooltipShown(!1,e)},t.prototype.moveTooltipContainer=function(){if(this.previousMoveArgs&&this.previousMoveArgs.isTouchEvent){var e=this.getClickedArea(this.previousMoveArgs.coordinates,this.previousMoveArgs.isTouchEvent);this.tooltipContainer.move(e)}},t.prototype.move=function(e,t){void 0===t&&(t=!0),this.previousMoveArgs=e;var i=this.getClickedArea(e.coordinates,e.isTouchEvent);this.tooltipContainer.move(i),t&&(this.ensureVisualTooltipManager(),this.visualTooltipManager.updateData({dataItems:e.dataItems,dataSources:e.dataSources,explorationContract:e.explorationContract,explorationCapabilities:e.explorationCapabilities,visualTooltipData:e.visualTooltipData}),this.visualTooltipManager.applyChanges()),this.startLongPause(e.identities)},t.prototype.hide=function(t){var i,r=this;i=t.immediately?0:t.isTouchEvent?c:s,this.clearTooltipTimeout(),this.delayedTooltipPromise=this.$timeout((function(){r.ensureVisualTooltipManager(),r.visualTooltipManager.updateOptions(!1,void 0,void 0),r.hideTooltipContainer(t.isTouchEvent),e.visuals.TooltipManager.ToolTipInstance.hide()}),i,!1,t),this.longPauseDebounced&&(this.longPauseDebounced.cancel(),this.longPauseDebounced=void 0)},t.prototype.visible=function(){return this.tooltipContainer.isVisible()},t.prototype.container=function(){return this.parentContainer.get(0)},t.prototype.enabled=function(){return e.visuals.TooltipManager.ShowTooltips},t.prototype.onLongPause=function(e){this.longPauseDebounced=void 0},t.prototype.startLongPause=function(e){var t=this;this.longPauseDebounced||(this.longPauseDebounced=_.debounce((function(){return t.onLongPause(e)}),u)),this.longPauseDebounced()},t.prototype.clearTooltipTimeout=function(){null!=this.delayedTooltipPromise&&(this.$timeout.cancel(this.delayedTooltipPromise),this.delayedTooltipPromise=void 0)},t.prototype.getClickedArea=function(t,i){var r=0,o=t[0],n=t[1];if(i){r=h;var a=r/2;o=Math.max(o-a,0),n=Math.max(n-a,0)}return new e.visuals.Rect(o,n,r,r)},t.prototype.ensureVisualTooltipManager=function(){var e=this;if(!this.visualTooltipManager){this.visualTooltipManager=new g(this.$compile,this.$rootScope,this.$injector.get("globalEventBridge"),this.$injector.get("explorationSerializer"),function(){return e.hideTooltipContainer()},function(){return e.moveTooltipContainer()},function(){e.tooltipContainer.updateContent(null),e.visualTooltipManager=null},this.featureSwitchService);var t=this.visualTooltipManager.$element.get(0);this.tooltipContainer.updateContent(t)}},t})(),g=(function(){function e(e,t,i,r,o,n,a,s){var l=this;this.globalEventBridge=i,this.explorationSerializer=r,this.scope=t.$new(),this.bindings=this.scope,this.bindings.onHide=o,this.bindings.onMove=n;var c=p;s.featureSwitches&&s.featureSwitches.useModernExploreCanvas&&(c=d),this.$element=e(c)(this.scope),this.currentData={explorationContract:void 0,explorationCapabilities:void 0,dataItems:void 0,dataSources:void 0,visualTooltipData:void 0},this.scope.$on("$destroy",(function(){l.$element.remove(),l.globalEventBridgeSubscriptionManager&&l.globalEventBridgeSubscriptionManager.unsubscribeAll(),a()})),this.ensureChangeListener()}return e.prototype.updateData=function(e){void 0===e.dataItems&&void 0===e.dataSources&&void 0===e.explorationContract&&void 0===e.visualTooltipData||(this.currentData={dataItems:void 0!==e.dataItems?e.dataItems:this.currentData.dataItems,dataSources:void 0!==e.dataSources?e.dataSources:this.currentData.dataSources,explorationContract:void 0!==e.explorationContract?e.explorationContract:this.currentData.explorationContract,explorationCapabilities:void 0!==e.explorationCapabilities?e.explorationCapabilities:this.currentData.explorationCapabilities,visualTooltipData:void 0!==e.visualTooltipData?e.visualTooltipData:this.currentData.visualTooltipData})},e.prototype.updateOptions=function(e,t,i){this.bindings.showActionBar=e,this.bindings.actionsProvider=t,this.bindings.sectionDisplayOption=i,this.scope.$applyAsync()},e.prototype.updateTooltipShown=function(e,t){this.bindings.tooltipShown=e,!e&&t&&(this.bindings.explorationContract=void 0),this.scope.$applyAsync()},e.prototype.applyChanges=function(){var e=this.currentData;if(void 0!==e.explorationContract&&(e.explorationContract!==this.originalExploration||!this.cachedExploration)){var t=e.explorationContract;this.originalExploration=t,this.cachedExploration=this.explorationSerializer.deepCopyExploration(t)}var i=this.bindings;i.explorationContract===this.cachedExploration&&i.explorationCapabilities===e.explorationCapabilities&&i.tooltipDataSources===e.dataSources&&i.tooltipData===e.visualTooltipData&&i.tooltipDataItems===e.dataItems||(i.explorationContract=this.cachedExploration,i.explorationCapabilities=e.explorationCapabilities,i.tooltipDataSources=e.dataSources,i.tooltipData=e.visualTooltipData,i.tooltipDataItems=e.dataItems,this.ensureChangeListener(),this.scope.$applyAsync())},e.prototype.ensureChangeListener=function(){var e=this;this.globalEventBridgeSubscriptionManager||(this.globalEventBridgeSubscriptionManager=this.globalEventBridge.createChannelSubscriptionManager().subscribe(t.events.onReportChangedGlobal,(function(t,i){e.cachedExploration=void 0,e.bindings.explorationContract=void 0,e.bindings.explorationCapabilities=void 0,e.bindings.tooltipData=void 0,e.globalEventBridgeSubscriptionManager.unsubscribeAll(),e.globalEventBridgeSubscriptionManager=void 0})))},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n,a,s,l){return new c(s,i,t,r,n,l,a,e,o)}var r=e.explore.services.events,o=e.common.dialog.MessageDialogBuilder,n=e.contracts.ResourcePackageItemType,a=e.explore.util.ResourcePackageUtils;t.createImportVisualService=i;var s="/powerbi/content/visual",l=".pbiviz",c=(function(){function t(e,t,i,r,o,n,a,s,l){this.eventBridge=e,this.modalDialogService=t,this.localizationService=i,this.notificationToast=r,this.telemetryService=o,this.visualPluginService=n,this.upload=a,this.localFileService=s,this.promiseFactory=l}return t.prototype.importWithDialog=function(e){var t=this,i=this.promiseFactory.defer();i.promise.then((function(i){return t.handleImport(e,i)})),this.localFileService.chooseLocalFile(i,l)},t.prototype.handleImport=function(t,i){var r=this,o=e.common.httpService.powerbiRequestOptions();o.retryCount=0,o.headers[e.common.constants.uploadFileSizeHeaderName]=i.size.toString(),this.notifyWhenLoadingCustomVisual("ImportCustomVisualLoadingTitle",0,"PleaseWaitUntilReady");var a=this.telemetryService.startEvent(e.telemetry.EXImportCustomViz,i.name,-1,"");this.upload.post(s,[i],o).then((function(e){var i=e.data;null==i.type&&(i.type=0);for(var o=0,s=i.items;o<s.length;o++){var l=s[o];null==l.type&&(l.type=n.CustomVisualJavascript)}r.import(t,i),a.event.info.resourcePackageId=i.id,a.event.info.resourcePackageName=i.name,a.resolve()}),(function(e){r.showImportErrorDialog();var t=e&&e.error?e.error.code:"-1",i={errorCode:"Import of custom visual failed -> code: "+t};a.reject(i)}))},t.prototype.showImportErrorDialog=function(){var e=new o(this.modalDialogService),t=this.localizationService;e.show("ImportVisualError",{titleText:t.get("ImportVisual_ErrorDialogHeader"),messageText:t.get("ImportVisual_ErrorDialogMessage"),okButtonText:t.get("ImportVisual_Close")})},t.prototype.import=function(e,t){var i=this;return this.visualPluginService.ensurePlugins([t],!0).then((function(){a.ensureResourcePackages(e),_.remove(e.resourcePackages,(function(e){return e.name===t.name})),e.resourcePackages.push(t),i.eventBridge.publishToChannel(r.addCustomVisual,t),i.eventBridge.publishToChannel(r.visualPluginsChanged),i.notificationToast.hide(i.toastNotificationId),i.toastNotificationId=void 0}))},t.prototype.notifyWhenLoadingCustomVisual=function(e,t,i){this.toastNotificationId=this.notificationToast.notify({title:this.localizationService.get(e),message:this.localizationService.get(i),notificationType:3})},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o){return new v(e,t,i,r,o)}var o=e.explore.contracts.FilterType,n=e.explore.FilterExpressionMetadataUtils,a=e.data.Selector,s=e.data.SemanticFilter,l=e.data.SQExpr,c=e.data.SQExprBuilder,u=e.data.SQExprUtils,p=e.visuals.valueFormatter,d=e.data.VariationRewriter,h=e.explore.util.VisualContainerUtils;i.createIncludeExcludeService=r;var v=(function(){function i(e,t,i,r,o){this.eventBridge=e,this.localizationService=t,this.undoRedoService=i,this.telemetry=r,this.viewModeState=o}return i.prototype.setFilter=function(i,r,s,l){var c,u=this,p=_.map(r,(function(e){return a.convertSelectorsByColumnToSelector(e)})),d=_.find(s.filters,(function(e){return e.howCreated===i})),v=2;l&&s.config&&s.config.singleVisual&&(c=n.getSelectorsMetadata(p,s.config.singleVisual,l)),d||(d={howCreated:i,name:t.FilterUtils.getNextFilterName(s.filters),type:3===i?o.Include:o.Exclude,filterExpressionMetadata:c},v=1);var g=d.filter;3===i?g=this.getIncludeFilter(p):(g=this.getExcludeFilter(g,p),2===v&&(c||d.filterExpressionMetadata)&&(d.filterExpressionMetadata=n.mergeFilterExpressionMetadata(d.filterExpressionMetadata,c))),this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){d.filter=g;var r={container:s,scopeType:0};1===v&&(t.FilterUtils.add(r.container,d),u.telemetry.logEvent(e.telemetry.EXAddFilter,3===i?"Include":"Exclude","Visual","Entity",h.hasGroupByItemsInQuery(s),t.util.getTelemetryViewMode(u.viewModeState.getMode())));var o={filter:d,changeType:v,scope:r};t.FilterUtils.notifyFilterContainerChangedByUser(u.eventBridge,o)}))},i.prototype.buildViewModel=function(e,i,r,o,n){for(var a=e?e.where():[],s=[],l=0,c=a;l<c.length;l++){var u=c[l],p=u.condition,d=new g(r,o,n);p.accept(d),s.push.apply(s,d.dataPoints)}return{points:s,filter:e,displayName:t.FilterUtils.getDisplayNameForIncludeExcludeFilters(this.localizationService,i,s.length),restatement:this.getRestatement(s)}},i.prototype.updateFilterContainer=function(e,i){var r=this,o=e.contract,n=o.type,a=this.buildFilter(i,n);this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){var i=e.getFilterContainerScope();o.filter=a;var n={filter:o,changeType:2,scope:i};t.FilterUtils.notifyFilterContainerChangedByUser(r.eventBridge,n)}))},i.prototype.isIncludeExcludeSupported=function(e,t,i,r){if(r)for(var o=_.map(r,(function(e){return a.convertSelectorsByColumnToSelector(e)})),n=0,s=o;n<s.length;n++)for(var c=s[n],p=a.toScopeIdentities(c),h=0,v=p;h<v.length;h++){var g=v[h],f=g.expr;if(l.isNot(f))return!1}if(e&&e.config&&e.config.singleVisual){var y=e.config.singleVisual,m=y.query;if(m){if(i&&t){var C=t.schema(void 0);if(C&&C.capabilities&&C.capabilities.supportsMultiTableTupleFilters)return!0}for(var S=m.defn.select(),w=void 0,b=0,x=S;b<x.length;b++){var E=x[b],F=E.expr;if(!u.isMeasure(F)){F=d.run(F,t);var V=F.getTargetEntity();if(w){if(!l.equals(w,V))return!1}else w=V}}return!0}}return!1},i.prototype.buildFilter=function(t,i){for(var r,n=t.points[0],a=c.inValues(n.columns,[n.values]),s=1;s<t.points.length;s++)n=t.points[s],r=c.inValues(n.columns,[n.values]),a=c.or(a,r);return i===o.Exclude&&(a=c.not(a)),e.data.SemanticFilter.fromSQExpr(a)},i.prototype.getRestatement=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];t.push(o.text)}return t.join(this.localizationService.get("ListJoin_Separator"));
},i.prototype.getIncludeFilter=function(t){var i=a.filterExprsFromSelectors(t);return e.DataViewScopeIdentity.filterFromExprs(i,!1)},i.prototype.getExcludeFilter=function(t,i){var r=a.filterExprsFromSelectors(i);if(t){var o=_.find(t.where(),(function(e){return 16===e.condition.kind}));if(o){for(var n=o.condition,l=n.arg,u=0,p=r;u<p.length;u++){var d=p[u],h=e.data.ScopeIdentityExtractor.getInExpr(d);l=c.or(l,h)}return l=c.not(l),s.fromSQExpr(l)}}return e.DataViewScopeIdentity.filterFromExprs(r,!0)},i})();i.IncludeExcludeService=v;var g=(function(e){function i(t,i,r){var o=e.call(this)||this;return o.schema=t,o.displayName=i,o.metadata=r,o.dataPoints=[],o.isExclude=!1,o}return __extends(i,e),i.prototype.visitNot=function(e){this.isExclude=!0,e.arg.accept(this)},i.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},i.prototype.visitIn=function(e){var r,o=this;if(!_.isEmpty(e.values)){for(var n=[],a=e.args,s=_.map(a,(function(e){return o.displayName.getDisplayName(e,o.schema,null,null,null,{includeVariationSource:!0})})),l=0,c=e.values;l<c.length;l++){var u=c[l],p=s,d=_.map(u,(function(e){return e.value})),h=t.FilterUtils.findValuesInFilterCache(a,u,this.metadata);h&&(p=_.map(h.columns,(function(e){return o.displayName.getDisplayName(e,o.schema,null,null,null,{includeVariationSource:!0})})),d=h.values),n.push({columns:a,values:u,text:i.getDataPointText(p,d)})}(r=this.dataPoints).push.apply(r,n)}},i.getDataPointText=function(e,t){for(var i="",r=0;r<e.length;r++){var o=t[r],n=e[r];i+=p.format(o)+" ("+n+") + "}return i=i.slice(0,i.length-3)},i})(e.data.DefaultSQExprVisitor);i.IncludeExcludeSQExprVisitor=g})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i(150,150)}e.createLayoutInsertionHelper=t;var i=(function(){function e(e,t){this.emptySpaceMinWidth=e,this.emptySpaceMinHeight=t}return e.prototype.getEmptySpaces=function(e,t){for(var i=this.getNonOverlapingRects(e,t),r=this.filterWithMinimumWidth(i),o=[],n=0,a=r;n<a.length;n++){var s=a[n],l=this.extendRect(s,i);l.height>=this.emptySpaceMinHeight&&o.push(l)}return o},e.prototype.extendRect=function(e,t){for(var i,r=!1,o=0,n=t;o<n.length;o++){var a=n[o];if(a!==e){var s=!1,l=!1;if(this.doIntersect(a,e)&&(s=a.y+a.height===e.y,l=a.y===e.y+e.height),!(a.width<e.width))if(l){var c={x:e.x,y:e.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}else if(s){var c={x:e.x,y:a.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}}}return r?this.extendRect(i,t):e},e.prototype.getIntersectingRectangle=function(e,t){var i=Math.max(e.x,t.x),r=Math.min(e.x+e.width,t.x+t.width),o=Math.max(e.y,t.y),n=Math.min(e.y+e.height,t.y+t.height);return i<=r&&o<=n?{x:i,y:o,width:r-i,height:n-o}:null},e.prototype.doIntersect=function(e,t){return!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y)},e.prototype.filterWithArea=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>0&&o.height>0&&t.push(o)}return t},e.prototype.filterWithMinimumWidth=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>=this.emptySpaceMinWidth&&t.push(o)}return t},e.prototype.splitRectangleOnIntersection=function(e,t){var i=this.getIntersectingRectangle(e,t);return i?this.filterWithArea([{x:e.x,y:e.y,width:e.width,height:i.y-e.y},{x:e.x,y:i.y+i.height,width:e.width,height:e.y+e.height-(i.y+i.height)},{x:e.x,y:i.y,width:i.x-e.x,height:i.height},{x:i.x+i.width,y:i.y,width:e.x+e.width-(i.x+i.width),height:i.height}]):[e]},e.prototype.getNonOverlapingRects=function(e,t){if(!t.length)return[];for(var i=[e],r=0,o=t;r<o.length;r++){for(var n=o[r],a=[],s=0,l=i;s<l.length;s++){var c=l[s];a=a.concat(this.splitRectangleOnIntersection(c,n))}i=a}return i},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l){return new p(e,t,i,o,n,a,s,l,r)}var o=jsCommon.ArrayExtensions,n=e.data.QueryProjectionsByRole,a=e.visualHost.utils.ResourcePackageUtils,s=e.visualHost.ThemeUtils,l=jsCommon.Trace,c=e.data.dsr.transformDataQueryToSemanticQueryDataShapeCommand,u=t.util.VisualContainerUtils;i.createPinVisualService=r;var p=(function(){function t(e,t,i,r,o,n,a,s,l){this.conceptualSchemaProxy=e,this.displayNameService=t,this.dataProxy=i,this.resourcePackagesService=r,this.visualQueryGenerator=o,this.visualPlugin=n,this.visualPluginOps=a,this.visualCapabilitiesService=s,this.featureSwitchService=l}return t.prototype.getPinData=function(t,i,r,o,n,a,l,c,p){var d,h=t.config.singleVisual;if(l){var v=l.options.query.command,g=u.describeForPinning(this.displayNameService,c,h.query,h.columnProperties,this.visualPlugin.capabilities(h.visualType),this.featureSwitchService.featureSwitches,n?n.filterMetadata:null),f=g.queryMetadata;d={dataTransforms:l.transforms,dataViewSource:a?a.dataViewSource:null,elements:g.visualElements,query:v,queryMetadata:f,themeCollection:s.cloneThemeCollection(o),tileLayoutType:i,visualContainer:t};e.data.DataViewObjectDefinitions.getValue(t.config.singleVisual.vcObjects,{objectName:"title",propertyName:"text"},void 0)||this.setPinDataHeadings(a,f,d)}else d={dataViewSource:{data:void 0},themeCollection:s.cloneThemeCollection(o),tileLayoutType:i,visualContainer:t};var y=e.explore.dataReaderPlugins.getExplorationDataReaderDataSource(r),m=y&&y.getModelExtensions(),C=y&&y.getDataSourceVariables();return m&&(d.modelExtensions=m),C&&(d.dataSourceVariables=C),this.addResourcePackageIdsToPinData(h.visualType,d,p)},t.prototype.setPinDataHeadings=function(t,i,r){var o,n,a,s=t&&t.dataViewSource&&t.dataViewSource.data.descriptor;if(s){var l=new e.data.dsr.QueryDescription(i,s);o=l.getMeasureRestatements(),n=l.getFilterRestatements(),a=l.getGroupRestatements()}else{for(var c=[],u=[],p=0,d=i.Select;p<d.length;p++){var h=d[p];3===h.Type||1===h.Type?c.push(h.Restatement):4!==h.Type&&2048!==h.Type||u.push(h.Restatement)}u.length>0&&(a=u),c.length>0&&(o=c)}o?r.tileHeading=this.joinList(o):a&&(r.tileHeading=this.joinList(a)),n&&(r.tileFilterDetails=this.joinList(n)),o&&a&&(r.tileSubDisplay=e.common.localize.format("TileHeadings_By",[this.joinList(a)]))},t.prototype.joinList=function(t){return t.join(e.common.localize.get("ListJoin_Separator"))},t.prototype.pinVisualContainer=function(e,t,i,r,o){var n=this;this.getPinDataAsync(e,t,i,r,o).then((function(e){n.handler&&n.handler.pinVisual(e)}),(function(){}))},t.prototype.getPinDataAsync=function(t,i,r,o,n){return __awaiter(this,void 0,e.Promise,(function(){var a,s,l,u,p,d,h,v,g,f;return __generator(this,(function(y){switch(y.label){case 0:return a=i.config.singleVisual,s=a.visualType,l=this.handler,u=s===e.visuals.plugins.image.name?1:0,[4,this.conceptualSchemaProxy.get(t)];case 1:return p=y.sent(),this.visualQueryGenerator.shouldExecute(a,t)&&(h=e.common.GridLayoutConstants.getDefaultGridItemViewport(e.common.GridLayoutConstants.getMediumLandscapeGridItem()),d=this.visualQueryGenerator.execute({config:a,dataSources:t,schema:p,additionalFilters:r,dataWindow:h,ignoreViewportForCache:!0,allowClientSideFilters:!1})),d?(v=d.options.query.command,g=c(v),this.modifyPinnedVisualDataShapeBinding(g.Binding,a.query,p,s),[4,this.dataProxy.execute(d.options)]):[3,3];case 2:return f=y.sent(),[2,this.getPinData(i,u,t,o,r,f,d,p,n)];case 3:return[2,this.getPinData(i,u,t,o,null,null,null,null,n)]}}))}))},t.prototype.canPinVisualType=function(t){return null!=t&&null!=this.visualPlugin.getPlugin(t)&&!this.visualCapabilitiesService.hasFilterCapabilities(t)&&t!==e.visuals.plugins.basicShape.name&&!this.visualPluginOps.isAnalysisVisual(t)&&!this.visualPluginOps.isQnaVisual(t)},t.prototype.setHandler=function(e){this.handler=e},t.prototype.modifyPinnedVisualDataShapeBinding=function(e,i,r,a){if(e){var s=this.visualPlugin.capabilities(a);if(t.isTableOrMatrix(a))return e.DataReduction||(e.DataReduction={}),void(e.DataReduction.Primary={Window:{Count:100}});if(t.supportsScalarCategoryAxis(s)){var l=i.projections,c=i.defn.select();if(e.DataReduction&&(e.DataReduction.Primary&&e.DataReduction.Primary.BinnedLineSample||e.DataReduction.Intersection&&e.DataReduction.Intersection.BinnedLineSample))return;if(!l||_.isEmpty(c))return;var u="Category",p=n.getRole(l,u);if(!p||_.isEmpty(p.all()))return;var d=p.getLastActiveQueryReference()||p.all()[0].queryRef,h=o.findItemWithName(c,d);if(!h)return;var v=h.expr.getMetadata(r);v&&0===v.kind&&v.type.dateTime&&(e.DataReduction||(e.DataReduction={}),e.DataReduction.Primary={Bottom:{}})}}},t.prototype.addResourcePackageIdsToPinData=function(e,t,i){var r=[];if(this.visualPlugin.isCustomVisual(e)){var o=this.resourcePackagesService.getPackage(e);o&&r.push(o.id)}if(i){var n=t.themeCollection;n.customTheme&&this.addResourcePackageIdIfNeeded(i,n.customTheme.type,(function(e){return e.name===n.customTheme.name}),r)}return _.isEmpty(r)||(t.resourcePackageIds=_.uniq(r)),t},t.prototype.addResourcePackageIdIfNeeded=function(e,t,i,r){var o=a.findResourcePackage(e,t);o&&null==o.id&&l.error("Resource package should have an ID"),o&&null!=o.id&&_.find(o.items,i)&&r.push(o.id)},t.supportsScalarCategoryAxis=function(e){return e.objects&&e.objects.categoryAxis&&e.objects.categoryAxis.properties&&void 0!==e.objects.categoryAxis.properties.axisType},t.isTableOrMatrix=function(t){var i=e.visuals.plugins;return t===i.table.name||t===i.matrix.name||t===i.tableEx.name||t===i.pivotTable.name},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o){return new u(e,t,i,r,o)}var o=e.data.FieldExprPattern,n=t.viewModels.ShowValueAsNoCalculation,a=t.viewModels.ShowValueAsPercentOfGrandTotalCalculation,s=t.viewModels.ShowValueAsPercentOfRoleTotalCalculation,l=e.data.SQExprConverter,c=e.data.SQExprUtils;i.createShowValueAsService=r;var u=(function(){function t(e,t,i,r,o){this.localizationService=e,this.promiseFactory=t,this.telemetryService=i,this.visualAuthoring=r,this.visualPlugin=o}return t.prototype.createShowValueAsMenuItems=function(t,i,r){var c=o.getSchema(l.asFieldPattern(t));if(!i.schema(c).capabilities.supportsScopedEval)return[];var u=[];if(this.aggregateSupportsShowValueAs(t,i)){var p=new n(e.common.localize);u.push(this.showValueAsMenuItemBuilder(p));var d=new a(e.common.localize);u.push(this.showValueAsMenuItemBuilder(d));var h=this.visualPlugin.capabilities(r),v=h&&h.dataRoleTotals;if(!_.isEmpty(v))for(var g=0,f=v;g<f.length;g++){var y=f[g],m=new s(this.localizationService,y.roles,e.data.getDisplayName(y.displayName,this.localizationService));u.push(this.showValueAsMenuItemBuilder(m))}}return u},t.prototype.applyShowValueAs=function(t,i,r){return __awaiter(this,void 0,e.Promise,(function(){var o;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.visualAuthoring.applyShowValueAs(t,i,r)];case 1:return o=n.sent(),o&&this.telemetryService.logEvent(e.telemetry.EXChangeQuickCalc,this.showValueAsKindToTelemetryId(i.kind),this.showValueAsKindToTelemetryId(r.kind)),[2]}}))}))},t.prototype.showValueAsMenuItemBuilder=function(e){var t={type:0};return t.key={action:5,showValueAs:e},t.text=e.name,t},t.prototype.aggregateSupportsShowValueAs=function(e,t){var i=e.getMetadata(t);return i&&i.type&&i.type.numeric&&c.isMeasure(e)},t.prototype.showValueAsKindToTelemetryId=function(e){switch(e){case void 0:return"None";case 0:return"PercentOfGrandTotal";case 1:return"PercentOfRoleTotal"}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){return new i(e)}e.createSubscriptionPaneService=t;var i=(function(){function e(e){this.taskPaneSliderService=e}return e.prototype.expandPaneForReportSubscription=function(e,t){this.taskPaneSliderService.isPaneExpanded()||(this.info={reportInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(15,3))},e.prototype.expandPaneForDashboardSubscription=function(e,t){this.info={dashboardInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(15,3)},e.prototype.expandPaneForRdlReportSubscription=function(e,t){this.taskPaneSliderService.isPaneExpanded()||(this.info={rdlReportInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(15,3))},e.prototype.collapseSubscriptionPane=function(){this.taskPaneSliderService.isPaneExpanded()&&(this.taskPaneSliderService.collapsePane(),this.currentSubscriptionGUID=void 0)},e.prototype.getInfo=function(){return this.info},e.prototype.getCurrentSubscriptionGUID=function(){return this.currentSubscriptionGUID},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new a(e,t,i)}var r="uicomponents",o="ColorPicker",n={javascript:"uiComponents"};t.createUIComponentService=i;var a=(function(){function e(e,t,i){this.$compile=e,this.moduleLoader=t,this.promiseFactory=i}return e.prototype.getUIComponentFactory=function(e){return new s(e,this.$compile,this.moduleLoader,this.promiseFactory)},e})(),s=(function(){function t(e,t,i,r){this.$scope=e,this.$compile=t,this.moduleLoader=i,this.promiseFactory=r}return t.prototype.createColorPicker=function(t,i,a,s){return __awaiter(this,void 0,e.Promise,(function(){var l,c=this;return __generator(this,(function(u){return l=this.promiseFactory.defer(),this.moduleLoader.require(n).then((function(){var n=e[r][o],u=new n(c.$scope,c.$compile,t,i,a,s);l.resolve(u)})),[2,l.promise]}))}))},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new n}function i(){return{supportsPinning:void 0,supportsDeletion:void 0,enablePenAnnotation:!1,visualDoubleClickEnabled:!1,displayOptions:{canShowCanvasWatermark:!1,showVisualBordersInViewMode:!1,hideVisualizationPane:!1,hideTileMenu:!1,hideNavigationPane:!1,disableFadeout:!1,showExportDataPane:!1,showMobilePane:!1,hideInFocusBar:!1,hideInFocusTileMenu:!1,visualMouseoverDisabled:!1,hideCanvasSwipeHandles:!1,extendBackgroundToWholeCanvas:!1,hideOutspaceFormatting:!1,hideOutspaceImage:!1,hideBackgroundImage:!1,showVisualAccessibleData:!1,showDetailVisualOnFullScreen:!1,disableSpotlight:!1,enableTooltipActions:!1,showDrillthroughFilters:!1,useMobileExplorationFooter:!1,showTooltipAboveClick:!1,showMobileVisualContainerHeader:!1,preserveScrollPositionOnResize:!1,mobileBookmarksMenuDisplay:0,enableMobileFilters:!1,disablePixelValueRounding:!1},touchOptions:{deselectVisualOnCanvasScroll:!1,disableCanvasScrollOnSelectedVisual:!1,disableTouchZoom:!1,isCanvasSwipeable:!0,swipeOnlyFromEdge:!1,swipeEdgeThreshold:void 0,touchEventsOnSelectedVisualOnly:!1,disableCanvasPinch:!1,disableTouchendOnTooltip:!1,dataMultiSelectMode:0},penProperties:{strokeStyle:r.DefaultPenStrokeStyle,lineWidth:r.DefaultPenLineWidth,opacity:r.DefaultPenOpacity},printProperties:{containerPixelPadding:40,useSectionDisplayOption:!1}}}var r,o=jsCommon.FreezeUtility;!(function(e){e.DefaultPenStrokeStyle="#939598",e.DefaultPenLineWidth=20,e.DefaultPenOpacity=1})(r=e.annotations||(e.annotations={})),e.createViewModeState=t;var n=(function(){function e(){this.config=i(),this.freeze(),this.state={}}return e.prototype.getViewState=function(){return this.state},e.prototype.getConfig=function(){return this.frozenConfig},e.prototype.updateConfig=function(e){e&&(e(this.config),this.config.displayOptions.showMobilePane&&(this.state.bookmarkView=void 0),this.freeze())},e.prototype.getMode=function(){return this.mode},e.prototype.setMode=function(e){this.mode=e},e.prototype.freeze=function(){var e=_.cloneDeep(this.config);o.deepFreeze(e),this.frozenConfig=e},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,C,S,w,b,x,E,F,V){return new y(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,C,S,V,F,w,b,x,E)}var o=e.data.CacheOptions,n=e.common,a=e.data.segmentation.DataViewMerger,s=e.data.services.DataViewTransformActionsSerializer,l=jsCommon.DateExtensions,c=t.util.ExplorationTelemetryUtil,u=e.data.dsr,p=e.explore.services.generateFilterMetadata,d=e.PbiPromise,h=e.visualHost.ResourcePackageReferenceResolver,v=e.explore.util.ResourcePackageUtils,g=e.visualHost.utils.ResourcePackageUtils,f=t.util.VisualContainerUtils;i.createVisualContainerQueryHandler=r;var y=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x,E,F,V){this.queryExecutionServices=e,this.hostServices=i,this.promiseFactory=r,this.conceptualSchemaProxy=o,this.featureSwitchService=n,this.telemetryService=a,this.visualQueryGenerator=s,this.visualPlugin=l,this.visualPluginOps=c,this.embedModeService=d,this.filterGenerator=h,this.scriptVisuals=v,this.displayNameService=g,this.explorationNavigation=f,this.resourceLoader=y,this.eventBridge=m,this.shell=C,this.dataProxyService=S,this.visualLifecycleService=w,this.resourceRegistration=b,this.cachePolicyProviderService=E,this.visualInsightsAnalysisHandler=F,this.explorationCapabilitiesService=V,this.visualDataProxyExecutionService=t.services.createVisualDataProxyExecutionService(r,o,n,s,l,c,u,S,p,x)}return r.prototype.cancelQuery=function(e){this.visualDataProxyExecutionService.cancelQuery(e)},r.prototype.generateApplicationContext=function(e){var t=this.explorationNavigation&&this.explorationNavigation.getCurrentExploration()&&this.explorationNavigation.getCurrentExploration().report,i=t&&t.objectId;return{DatasetId:t&&t.model&&t.model.dbName,Sources:[{ReportId:i,Operation:e}]}},r.prototype.runQuery=function(e){var t=this,i=this.startQueryPerformanceActivity(e.performanceActivity),r=this.queryExecutionServices.getDataSources(),n=e.contract;if(this.shouldBlockVisualQuery(n)||!this.visualQueryGenerator.shouldExecute(n.config.singleVisual,r))return i&&i.queryActivity.resolve(),!1;!e.initialLoad&&this.hostServices&&this.updateCachedData(e);var a,s=this.getDatasetCacheOptions(e,r),l=e.initialLoad;l&&(a=this.startVisualFirstLoadTelemetryEvent(s,r,n.name));var c;this.featureSwitchService.featureSwitches.queryApplicationContext&&(c=this.generateApplicationContext(e.queryOperation));var u=this.visualDataProxyExecutionService.runQuery({dataSources:r,contract:n,viewport:e.viewport,hostServices:this.hostServices,initialLoad:e.initialLoad,useVisualContainerCache:e.useVisualContainerCache,preferCurrentData:e.preferCurrentData,allowCache:e.allowCache,cacheResponseOnServer:e.cacheResponseOnServer,cacheOptions:s,visualFirstLoadEvent:a,performanceActivity:i&&i.queryActivity,canDefer:e.canDefer,requestPriority:e.requestPriority,applicationContext:c}),p=n.config.singleVisual.visualType,d=n.config.singleVisual.objects,h=this.loadResourcePackageReferences(p,d);e.geocodingTracker&&e.geocodingTracker.newQuery(i&&i.rootActivity),this.queryExecutionServices.notifyStart();var v=!1;return u.previewPromise.then((function(e){e&&!v&&t.resolveResourcePackageReferences(p,e.dataProxyQuery.transforms.objects).then((function(r){t.handleQueryResult(n,e.result,e.dataProxyQuery,r,null,null,!0,i)}))})),u.finalPromise.then((function(l){var c=l&&l.result&&l.result.dataReaderResult,u=!!(s&o.AllowCache);c&&u&&a&&(a.event.info.cacheResultFromServer=l.result.dataReaderResult.fromCache);var p=t.getLastRefreshTime(r);if(u&&c&&t.isResultStale(p,l.result.dataReaderResult.timestamp)){var d=!!(s&o.PreventRefresh),h=o.AllowQuery|o.CacheResult;h=d?h|o.PreventRefresh:h,a&&(a.event.info.staleCacheResultFromServer=!0);return t.visualDataProxyExecutionService.runQuery({dataSources:r,contract:n,viewport:e.viewport,hostServices:t.hostServices,initialLoad:e.initialLoad,useVisualContainerCache:!1,preferCurrentData:e.preferCurrentData,allowCache:!1,cacheResponseOnServer:!1,cacheOptions:h,visualFirstLoadEvent:a,performanceActivity:i&&i.queryActivity,requestPriority:e.requestPriority,canDefer:e.canDefer}).finalPromise}return l})).then((function(r){return h.then((function(){t.processQueryResult(e,r,i)}))})).catch((function(e){t.queryExecutionServices.handleErrors(e,i)})).finally((function(){v=!0,l&&a&&a.resolve(),t.queryExecutionServices.notifyEnd()})),!0},r.prototype.startQueryPerformanceActivity=function(e){if(e)return{rootActivity:e,queryActivity:e.createChildActivity("Query")}},r.prototype.startVisualFirstLoadTelemetryEvent=function(t,i,r){var n=this.embedModeService&&this.embedModeService.getEmbedTypeDescription(),a=!!(t&o.AllowCache),s=f.hasOnPremDataSource(i),l=this.telemetryService.startEvent(e.telemetry.EXVisualFirstLoad,void 0,s,void 0,n,a,void 0,void 0,r);return c.addExplorationInfoToEvent(l.event,this.explorationNavigation),l},r.prototype.getCachedQueryOrGenerate=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return(e=this.dataProxyService.lastExecutedQuery())?(this.cachedQueryResult=void 0,[2,e]):(i=this.cachedQueryResult,i?[3,2]:[4,this.generateQuery(t)]);case 1:i=r.sent(),r.label=2;case 2:return[2,i]}}))}))},r.prototype.generateQuery=function(e){return __awaiter(this,void 0,d,(function(){var t,i,r,o;return __generator(this,(function(n){switch(n.label){case 0:return t=this.queryExecutionServices.getDataSources(),[4,this.conceptualSchemaProxy.get(t)];case 1:return i=n.sent(),r={dataSources:t,schema:i,config:e.contract.config.singleVisual,hostServices:this.hostServices,visualQueryGenerator:this.visualQueryGenerator,executionType:0,preferCurrentData:null==e.preferCurrentData||e.preferCurrentData,viewport:e.viewport,allowCache:null==e.allowCache||e.allowCache,cacheOptions:void 0},o=this.visualDataProxyExecutionService.generateQuery(r),this.dataProxyService.lastExecutedQuery()?this.cachedQueryResult=void 0:this.cachedQueryResult=o,[2,o]}}))}))},r.prototype.updateCachedData=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.generateQuery(t)];case 1:return e=o.sent(),i=t.contract,e&&!e.error&&i.cachedData?(i.cachedData.dataUpdatedTime=void 0,r=this.visualPlugin.capabilities(i.config.singleVisual.visualType),i.cachedData.transformsObject=s.serializeDataViewTransformActions(e.transforms,r.objects),i.cachedData.queryObject=e.options.query.command,i.cachedData.dataObject=void 0,[2]):[2]}}))}))},r.prototype.loadMoreData=function(e){var t=this,i=this.startQueryPerformanceActivity(e.performanceActivity);this.queryExecutionServices.notifyStart(),this.getNextDataSegment(e,i).then((function(i){i&&t.mergeMoreData(i.result,i.dataProxyQuery,e.currentData,i.performanceActivityContext)})).catch((function(){i&&i.queryActivity.reject()})).finally((function(){t.queryExecutionServices.notifyEnd()}))},r.prototype.canLoadMoreData=function(){return this.visualDataProxyExecutionService.canLoadMoreData()},r.prototype.getNextDataSegment=function(e,t){var i=this,r=t||this.startQueryPerformanceActivity(e.performanceActivity),o=this.promiseFactory.defer();return this.visualDataProxyExecutionService.canLoadMoreData()?this.visualDataProxyExecutionService.loadMoreData({dataSources:this.queryExecutionServices.getDataSources(),contract:e.contract,hostServices:this.hostServices,viewport:e.viewport,useVisualContainerCache:e.useVisualContainerCache,performanceActivity:e.performanceActivity}).then((function(e){i.handleLoadMoreDataWarnings(e&&e.result,e&&e.dataProxyQuery);var t=e;r&&(t=__assign({},t,{performanceActivityContext:r})),o.resolve(t)}),(function(e){i.queryExecutionServices.handleErrors(e),r&&r.queryActivity.reject(),o.reject(e)})):(r&&r.queryActivity.reject(),o.reject("Cannot load more data")),o.promise},r.prototype.reloadDataSegment=function(e,t){var i=e.currentData&&e.currentData.dataView&&e.currentData.dataView.matrix&&e.currentData.dataView.matrix.rows&&e.currentData.dataView.matrix.rows.root;if(!i)return void this.runQuery(e);var r=this.dataProxyService.getNodeSegment(t);if(!r||0===r.index)return void this.runQuery(e);this.dataProxyService.discardSegmentsFrom(r.index);var o=this.dataProxyService.getLastNodeIndex();a.pruneTree(i,o)?this.loadMoreData(e):this.runQuery(e)},r.prototype.mergeMoreData=function(e,t,i,o){var n=r.getDataProxyQueryExecutionResultWarnings(e,t),s=e&&e.dataReaderResult?e.dataReaderResult.dataView:null;if(s){var l=i.dataView;a.mergeDataViews(l,s);var c={dataView:l,dataViewSource:e&&e.dataViewSource,performanceActivities:e&&e.dataReaderResult&&e.dataReaderResult.performanceActivities,isFirstSegment:!1};_.isEmpty(n)||(c.warnings=n),this.queryExecutionServices.loadMergedData(c,o)}else o&&o.queryActivity.resolve()},r.prototype.visualizeDataViewSource=function(e,t,i,r){var o=this,a=this.startQueryPerformanceActivity(r),s=e.config.singleVisual,l=this.visualPluginOps.targetedDataViewKinds(s.visualType,s.query),c=u.read(l,t.data,n.utils.getDsrReaderSwitches(this.featureSwitchService.featureSwitches)),p=c.error;if(p)return void this.queryExecutionServices.handleErrors(p);var d=this.queryExecutionServices.getDataSources(),h=e&&e.config&&e.config.singleVisual;d&&h&&this.conceptualSchemaProxy.get(d).then((function(r){var n=o.visualQueryGenerator.execute({config:h,dataSources:d,schema:r,additionalFilters:o.hostServices.getFilters(o.filterGenerator,r),restartToken:c.restartToken,dataWindow:i,dataSourceVariables:o.hostServices.getDataSourceVariables(),disableAnchorTime:o.explorationCapabilitiesService.getCapabilities().disableAnchorTime});if(n){var s=o.promiseFactory.defer();s.resolve(n.options),o.handleQueryResult(e,{dataViewSource:t,dataReaderResult:c},{transforms:n.transforms,error:n.error,warnings:n.warnings,options:s.promise},null,{updateContractCache:!0},null,!1,a)}}))},r.prototype.updateNonQueryVisual=function(e,t,i){var r=this,o=this.startQueryPerformanceActivity(i),n={dataView:null,dataViewSource:null};if(t){var a=e.config.singleVisual.visualType,s=e.config.singleVisual.objects;this.queryExecutionServices.notifyStart(),this.resolveResourcePackageReferences(a,s).then((function(e){r.queryExecutionServices.applyUpdate(n,t,e,o)})).finally((function(){r.queryExecutionServices.notifyEnd()}))}else this.queryExecutionServices.applyUpdate(n,t,null,o)},r.prototype.updateContractCache=function(t,i,r){var o=this;if(!t)return this.promiseFactory.reject(null);var n=this.queryExecutionServices.getDataSources();if(!n)return this.promiseFactory.reject(null);var a=t.cachedData&&t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime:null,s=i&&i.dataViewSource?i.dataViewSource.data:void 0,l=r&&r.error;return i&&i.dataReaderResult&&i.dataReaderResult.disallowPersisting&&(a=null,s=null,l=new e.IgnorableClientError("VisualContainerQueryHandler.updateContractCache() cachingError")),this.conceptualSchemaProxy.get(n).then((function(e){return r.options.then((function(i){var n={transforms:r.transforms,error:l,warnings:r.warnings,options:i,compiledMappings:r.compiledMappings};t.cachedData=f.createCacheEntry(o.visualPlugin,o.displayNameService,s,n,e,t.config.singleVisual,o.featureSwitchService.featureSwitches,p(t.filters),a)}))}))},r.prototype.getLastRefreshTime=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];if(r&&r.dsr&&r.dsr.lastRefreshTime)return r.dsr.lastRefreshTime}},r.prototype.processQueryResult=function(e,t,i){var r,o=this;t&&(r={updateContractCache:!0,updateServerCache:t.updateServerVisualContainerCache},this.resolveResourcePackageReferences(e.contract.config.singleVisual.visualType,t.dataProxyQuery.transforms.objects).then((function(n){o.handleQueryResult(e.contract,t&&t.result,t.dataProxyQuery,n,r,e.currentData,!1,i)})))},r.prototype.isResultStale=function(e,t){var i=l.tryDeserializeDate(e),r=l.parseIsoDate(t);return!(!i||!r)&&i>r},r.prototype.getDatasetCacheOptions=function(e,t){var i=e.contract.id,r=e.initialLoad,n=this.visualLifecycleService&&this.visualLifecycleService.has(i);if(this.featureSwitchService.featureSwitches.expandQueryCaching){if(this.isQueryCachingEnabledForAnyDataset(t))return this.cachePolicyProviderService.getInteractiveQueryPolicy(r&&n,e.interactiveQueryCachingSetting)}else if(r&&n&&this.isQueryCachingEnabledForAnyDataset(t))return o.AllowCache|o.AllowQuery|o.CacheResult},r.prototype.isQueryCachingEnabledForAnyDataset=function(e){return!!_.some(e,(function(e){return e.dsr&&e.dsr.isQueryCachingEnabled}))},r.prototype.handleQueryResult=function(e,t,o,n,a,s,l,c){var u=this;void 0===a&&(a={}),void 0===l&&(l=!1),this.queryExecutionServices.clearErrors();var p=r.getDataProxyQueryExecutionResultWarnings(t,o)||[];this.queryExecutionServices.handleWarnings(p,o&&o.transforms);var d;if(t){d={dataView:t&&t.dataReaderResult?t.dataReaderResult.dataView:null,dataViewSource:t&&t.dataViewSource?t.dataViewSource:null,performanceActivities:t&&t.dataReaderResult?t.dataReaderResult.performanceActivities:null},_.isEmpty(p)||(d.warnings=p);var h=f.isSegment(d.dataView);h&&(d.isFirstSegment=h)}else d={dataView:s&&s.dataView,dataViewSource:s&&s.dataViewSource,isFirstSegment:s&&s.isFirstSegment};if(this.queryExecutionServices.applyUpdate(d,o.transforms,n,c,l),a.updateContractCache){var v=t&&t.dataViewSource?t.dataViewSource.data:void 0,g=this.updateContractCache(e,v,o);a.updateServerCache&&g.then((function(){o.options.then((function(t){if(!_.isEmpty(t.query.command)){var r=e.id,o={visualContainerId:r,query:JSON.stringify(t.query.command),dataTransforms:u.getCachedTransformsString(e)};u.eventBridge.publishToChannel(i.events.newQueryCacheResultAvailable,o)}}))}))}},r.prototype.handleLoadMoreDataWarnings=function(e,t){this.queryExecutionServices.clearErrors();var i=r.getDataProxyQueryExecutionResultWarnings(e,t)||[];this.queryExecutionServices.handleWarnings(i,t&&t.transforms)},r.prototype.getCachedTransformsString=function(e){var t=e.cachedData;if(t){var i=t.transformsObject;if(i)return s.serializeTransformActions(i)}},r.prototype.shouldBlockVisualQuery=function(t){var i=this.explorationNavigation.getCurrentExploration(),r=i&&i.reportId,o=f.getVisualType(t),n=e.explore.util.ScriptVisualsUtil.getScriptVisualType(o);return!(!f.isScriptVisual(t,this.visualPlugin)||this.shell.areScriptVisualsApproved()&&!this.scriptVisuals.shouldBlockScriptVisual(n,r))},r.prototype.loadResourcePackageReferences=function(e,t){var i=this,r=this.visualPlugin.capabilities(e),o=r&&r.objects,n=this.explorationNavigation.getCurrentExploration();return h.loadFromDataViewObjects(t,o,(function(){return n?n.resourcePackages:null}),this.resourceLoader,this.promiseFactory,(function(e,t){return i.ensureSharedResource(n,e,t)}))},r.prototype.ensureSharedResource=function(e,t,i){if(this.resourceRegistration){var r=v.ensureResourcePackageType(e,2);g.findItemInPackage(r,t)||this.resourceRegistration.add(t,2,i)}},r.prototype.resolveResourcePackageReferences=function(e,t){var i=this.visualPlugin.capabilities(e),r=i&&i.objects,o=this.explorationNavigation.getCurrentExploration();return h.loadAndResolveFromDataViewObjects(t,r,o?o.resourcePackages:null,this.resourceLoader,this.promiseFactory)},r.getDataProxyQueryExecutionResultWarnings=function(e,t){var i;return t&&!_.isEmpty(t.warnings)&&(i=i?i:[],i.push.apply(i,t.warnings)),e&&e.dataReaderResult&&!_.isEmpty(e.dataReaderResult.warnings)&&(i=i?i:[],i.push.apply(i,e.dataReaderResult.warnings)),i},r})();i.VisualContainerQueryHandler=y})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new n(e,t)}var r=e.data.DataViewQueryEngine,o=e.explore.util.VisualContainerUtils;t.createVisualContainerDataSelectionService=i;var n=(function(){function e(e,t){this.visualContainer=e,this.visualPluginOps=t}return e.prototype.getSelectedValues=function(e){var t=o.getVisualType(this.visualContainer.contract),i=o.getVisualQuery(this.visualContainer.contract),n=this.visualPluginOps.dataViewKinds(t,i);
return r.query(this.getDataViews(),e,n)},e.prototype.getDataViews=function(){var e=this.visualContainer&&this.visualContainer.getRunningVisual();return e&&e.getDataViews()},e})();t.VisualContainerDataSelectionService=n})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x,E,F,V,P,M){return new a(e,t,i,r,o,l,c,u,p,n,d,w,h,v,g,s,f,x,m,b,S,y,C,E,F,V,P,M)}var o=t.components.VisualContainerContextMenu,n=(function(){function t(e,t,i,r,o,n){this.defaultTitleKey=e,this.selectors=t,this.glyph=i,this.commandDisplayOption=r,this.selected=o,this.customIcon=n}return t.prototype.title=function(e){return e&&this.defaultTitleKey?e.get(this.defaultTitleKey):this.defaultTitleKey},t.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2]}))}))},t.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,2!==this.commandDisplayOption]}))}))},t.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,1===this.commandDisplayOption]}))}))},t.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,null]}))}))},t})();i.VisualContainerMenuCommand=n,i.createVisualContainerMenuFactoryService=r;var a=(function(){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,y,m,C,S,w,b,x,E,F,V,P){this.conceptualSchemaProxy=e,this.clipboard=t,this.dataSources=i,this.drill=r,this.expandCollapse=o,this.dropdown=n,this.eventBridge=a,this.explorationCapabilities=s,this.explorationNavigation=l,this.explorationExtensibility=c,this.featureSwitchService=u,this.filterGenerator=p,this.groupAuthoring=d,this.includeExcludeService=h,this.lazyScoped=v,this.drillToDetails=g,this.localizationService=f,this.pluginOps=y,this.promiseFactory=m,this.telemetryService=C,this.viewModeState=S,this.visibility=w,this.visualAuthoring=b,this.overlayService=x,this.undoRedo=E,this.visualPlugin=F,this.selection=V,this.layoutAuthoring=P}return r.prototype.createMenu=function(t,i,r,n,a,s,l){return __awaiter(this,void 0,e.Promise,(function(){var e,c;return __generator(this,(function(u){switch(u.label){case 0:return[4,this.createCommands(t,i,r,n,a,s,l)];case 1:return e=u.sent(),c=new o(this.localizationService,this.explorationCapabilities,this.dropdown),[4,c.create(e,i.position)];case 2:return u.sent(),[2,c]}}))}))},r.prototype.createOptionsMenu=function(t,i,r,n){return __awaiter(this,void 0,e.Promise,(function(){var e,a;return __generator(this,(function(s){switch(s.label){case 0:return e=this.createOptionsCommands(t,i,r),a=new o(this.localizationService,this.explorationCapabilities,this.dropdown,(!0)),[4,a.create(e,void 0,n)];case 1:return s.sent(),[2,a]}}))}))},r.prototype.createDrillthroughMenu=function(t,i,r,n){return __awaiter(this,void 0,e.Promise,(function(){var e,a;return __generator(this,(function(s){switch(s.label){case 0:return e=this.createDrillthroughCommands(t,i,n),a=new o(this.localizationService,this.explorationCapabilities,this.dropdown),[4,a.create([e],r)];case 1:return s.sent(),[2,a]}}))}))},r.prototype.createDrillthroughCommands=function(e,t,r){var o=this.explorationExtensibility.getCommandsDisplayOptions(e.name);return new i.DrillthroughCommandCollection(e,t,"ModeOn",this.drill,this.explorationNavigation,this.lazyScoped,this.pluginOps,r,this.telemetryService,(void 0),o)},r.prototype.createOptionsCommands=function(e,t,r){var o=this.explorationNavigation.getCurrentExploration().settings,n=this.explorationExtensibility.getCommandsDisplayOptions(e.contract.name),a=[new i.AddCommentVisualCommand(e,this.eventBridge,t,n),new i.ToggleSearchCommand(e,this.filterGenerator,this.overlayService,this.undoRedo,this.visualAuthoring,this.visualPlugin,t,n),new i.EnterAdvancedEditModeCommand(e,this.eventBridge,this.overlayService,t,n),new i.ExportVisualDataCommand(e,this.conceptualSchemaProxy,this.dataSources,this.eventBridge,this.featureSwitchService,this.filterGenerator,this.overlayService,t,o,n),new i.SeeDataCommand(e.contract,this.drill,this.visibility,this.pluginOps,(!0),this.viewModeState,n),new i.DeleteVisualContainerCommand(e,this.eventBridge,this.undoRedo,t,n),new i.GetClustersCommand(e,this.eventBridge,t,n),new i.GetSpatialClustersCommand(e,this.eventBridge,t,n),new i.ToggleSpotlightCommand(e,this.visibility,t,n),new i.SortDescendingCommand(e,this.eventBridge,this.overlayService,t,n),new i.SortAscendingCommand(e,this.eventBridge,this.overlayService,t,n),new i.SortByCommandCollection(e,this.eventBridge,this.overlayService,t,n)];return this.getCustomCommands(a,"visualOptionsMenu",e.contract,r,void 0,n)},r.prototype.createNonQueryCommands=function(e){var t=this.explorationExtensibility.getCommandsDisplayOptions(e.name),r=this.explorationNavigation.getCurrentExploration().settings;return[new i.VisualContainerGroupingCommandsCollection(e,this.selection,this.layoutAuthoring,this.viewModeState,this.featureSwitchService,r,t)]},r.prototype.createCommands=function(r,o,n,a,s,l,c){return __awaiter(this,void 0,e.Promise,(function(){var e,u,p,d,h,v,g,f,y,m,C;return __generator(this,(function(S){switch(S.label){case 0:return!s||t.contracts.isVisualContainerGroup(r)?[2,this.createNonQueryCommands(r)]:(e=r,u=o.data,p=o.dataRoles,d=o.nodeIndex,h=o.position,v=[],g=this.explorationExtensibility.getCommandsDisplayOptions(e.name),f=this.explorationNavigation.getCurrentExploration().settings,[4,this.conceptualSchemaProxy.get(this.dataSources.get())]);case 1:return y=S.sent().schema(void 0),this.expandCollapse.isSupported(y&&y.capabilities,e,p)&&this.expandCollapse.isEnabled(e,p)&&(m=this.expandCollapse.getAllowedActions(e,p,u),m&&(v.push(new i.ExpandCollapseCommandsCollection(m,(!1),u,p,d,a,g)),v.push(new i.ExpandCollapseCommandsCollection(m,(!0),u,p,d,a,g)))),v.push(new i.DrillDownCommand(e,u,p,this.dataSources,this.drill,this.visualAuthoring,(void 0),g),new i.DrillToDetailsCommand(e,u,this.drill,this.dataSources,this.drillToDetails,g),new i.SeeDataCommand(e,this.drill,this.visibility,this.pluginOps,(void 0),this.viewModeState,g),new i.DrillDownLevelWithoutCurrentGroupCommand(e,p,this.visualAuthoring,this.drill,g),new i.DrillDownLevelWithCurrentGroupCommand(e,p,this.visualAuthoring,this.drill,g),new i.DrillUpCommand(e,u,p,this.drill,this.visualAuthoring,(void 0),g),new i.CreateGroupCommand(e,u,this.conceptualSchemaProxy,this.dataSources,this.featureSwitchService,this.groupAuthoring,this.promiseFactory,g),new i.IncludeCommand(e,u,this.conceptualSchemaProxy,this.dataSources,this.featureSwitchService,this.includeExcludeService,this.promiseFactory,c,g),new i.ExcludeCommand(e,u,this.conceptualSchemaProxy,this.dataSources,this.featureSwitchService,this.includeExcludeService,this.promiseFactory,c,g),new i.DrillthroughCommandCollection(e,u,"ContextMenu",this.drill,this.explorationNavigation,this.lazyScoped,this.pluginOps,n,this.telemetryService,(void 0),g),new i.InsightsAnalysisCommandsCollection(e,u,h,this.conceptualSchemaProxy,this.dataSources,this.dropdown,this.eventBridge,this.explorationCapabilities,this.explorationNavigation,this.featureSwitchService,this.lazyScoped,this.viewModeState,n,g),new i.VisualContainerGroupingCommandsCollection(e,this.selection,this.layoutAuthoring,this.viewModeState,this.featureSwitchService,f,g)),C=new i.CopyCommandsCollection(e,this.clipboard,this.telemetryService,this.featureSwitchService,this.visibility,this.viewModeState,o,g),C.commandsCount>0&&v.push(C),[2,this.getCustomCommands(v,"visualContextMenu",e,u,l,g)]}}))}))},r.prototype.getCustomCommands=function(e,t,r,o,n,a){var s=this.explorationExtensibility.getCommandExtension();if(!_.isEmpty(s)){var l=_.filter(s,(function(e){return e.extend&&e.extend[t]}));if(!_.isEmpty(l))for(var c=0,u=l;c<u.length;c++){var p=u[c];if(!p.visuals||_.find(p.visuals,(function(e){return e===r.name}))){var d=new i.ExtensionCommand(r,o,p.name,p.extend[t].title||p.title,this.eventBridge,this.explorationExtensibility,p.extend[t].icon||p.icon,n,a);1===p.extend[t].menuLocation?e.unshift(d):e.push(d)}}}return e},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.EnumExtensions,o=e.data.Selector,n=(function(t){function i(e,i,r,o,n,a,s,l){var c=t.call(this,s||"DrillDown",i,"pbi-glyph-drilldowndisabled",l&&l.drill)||this;return c.visualContainer=e,c.roles=r,c.dataSources=o,c.drill=n,c.visualAuthoring=a,c}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return _.isEmpty(this.selectors)?[2]:(this.visualAuthoring.drillDown(this.selectors,this.visualContainer,this.dataSources.get(),_.head(this.roles)),[2])}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=_.isEmpty(this.selectors),e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!a.sent(),a.label=2;case 2:return e?[2,!1]:(i=this.drill.getSupportedDrillDirections(this.visualContainer,_.head(this.roles)),o=r.hasFlag(i,4),n=r.hasFlag(i,2),[2,o||n])}}))}))},i})(i.VisualContainerMenuCommand);i.DrillDownCommand=n;var a=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,a||"DrillUp",void 0,"pbi-glyph-drillup",s&&s.drill)||this;return l.visualContainer=e,l.roles=r,l.drill=o,l.visualAuthoring=n,l}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.visualAuthoring.drillUp(_.head(this.roles),this.visualContainer),[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.isVisible.call(this)];case 1:return o.sent()?(e=this.drill.getSupportedDrillDirections(this.visualContainer,_.head(this.roles)),i=r.hasFlag(e,1),[2,i]):[2,!1]}}))}))},i})(i.VisualContainerMenuCommand);i.DrillUpCommand=a;var s=(function(t){function i(e,i,r,o,n,a){var s=t.call(this,e,void 0,void 0,a&&a.drill)||this;return s.visualContainer=i,s.roles=r,s.drillDirection=o,s.visualAuthoring=n,s}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.visualAuthoring.drillDownLevel(_.head(this.roles),this.visualContainer,this.drillDirection),[2]}))}))},i})(i.VisualContainerMenuCommand);i.DrillDownLevelCommand=s;var l=(function(t){function i(e,i,r,o,n){var a=t.call(this,"DrillDownLevel",e,i,3,r,n)||this;return a.drill=o,a}return __extends(i,t),i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.isVisible.call(this)];case 1:return o.sent()?(e=this.drill.getSupportedDrillDirections(this.visualContainer,_.head(this.roles)),i=r.hasFlag(e,4),[2,i]):[2,!1]}}))}))},i})(s);i.DrillDownLevelWithoutCurrentGroupCommand=l;var c=(function(t){function i(e,i,r,o,n){var a=t.call(this,"DrillDownLevelGrouped",e,i,2,r,n)||this;return a.drill=o,a}return __extends(i,t),i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.isVisible.call(this)];case 1:return o.sent()?(e=this.drill.getSupportedDrillDirections(this.visualContainer,_.head(this.roles)),i=r.hasFlag(e,2),[2,i]):[2,!1]}}))}))},i})(s);i.DrillDownLevelWithCurrentGroupCommand=c;var u=(function(t){function i(e,i,r,o,n,a){var s=t.call(this,"DataPointTable_Show",i,void 0,a&&a.drill)||this;return s.visualContainer=e,s.drill=r,s.dataSources=o,s.drillToDetails=n,s}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return _.isEmpty(this.selectors)?[2]:(e=this.dataSources.get(),this.drillToDetails.drillToDetails(this.selectors,this.visualContainer,e),[2])}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return e=_.isEmpty(this.selectors),e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!r.sent(),r.label=2;case 2:return e?[2,!1]:(i=this.drill.canDrillToDetails(this.visualContainer,this.selectors),[2,i])}}))}))},i})(i.VisualContainerMenuCommand);i.DrillToDetailsCommand=u;var p=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,i?"Collapse":"Expand",r,void 0,s&&s.expandCollapse)||this;return l.allowedActions=e,l.isCollapse=i,l.roles=o,l.nodeIndex=n,l.childCommands=[new d(l.isCollapse,l.allowedActions,l.selectors,l.roles,l.nodeIndex,a,s),new h(l.isCollapse,l.allowedActions,l.selectors,l.roles,l.nodeIndex,a,s),new v(l.isCollapse,l.allowedActions,l.selectors,l.roles,l.nodeIndex,a,s)],l}return __extends(i,t),i.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.isCollapse?[4,t.prototype.isDisabled.call(this)]:[3,2];case 1:return[2,e.sent()||!(this.allowedActions.collapseHierarchy||this.allowedActions.collapseLevel||this.allowedActions.collapseNode)];case 2:return[4,t.prototype.isDisabled.call(this)];case 3:return[2,e.sent()||!(this.allowedActions.expandHierarchy||this.allowedActions.expandLevel||this.allowedActions.expandNode)]}}))}))},i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.childCommands]}))}))},i})(i.VisualContainerMenuCommand);i.ExpandCollapseCommandsCollection=p;var d=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,"ExpandCollapseNode",r,void 0,s&&s.expandCollapse)||this;return l.isCollapse=e,l.allowedActions=i,l.roles=o,l.nodeIndex=n,l.handlers=a,l}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.handlers.onSetNodeExpansionState({data:this.selectors[0],dataRoles:this.roles,isCollapse:this.isCollapse,nodeIndex:this.nodeIndex}),[2]}))}))},i.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||(this.isCollapse?!this.allowedActions.collapseNode:!this.allowedActions.expandNode)]}}))}))},i})(i.VisualContainerMenuCommand);i.ExpandCollapseNodeCommand=d;var h=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,"ExpandCollapseLevel",r,void 0,s&&s.expandCollapse)||this;return l.isCollapse=e,l.allowedActions=i,l.roles=o,l.nodeIndex=n,l.handlers=a,l}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.handlers.onSetLevelExpansionState({data:this.selectors[0],dataRoles:this.roles,isCollapse:this.isCollapse,nodeIndex:this.nodeIndex}),[2]}))}))},i.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||this.isCollapse?!this.allowedActions.collapseLevel:!this.allowedActions.expandLevel]}}))}))},i})(i.VisualContainerMenuCommand);i.ExpandCollapseLevelCommand=h;var v=(function(t){function i(e,i,r,o,n,a,s){var l=t.call(this,"ExpandCollapseAll",r,void 0,s&&s.expandCollapse)||this;return l.isCollapse=e,l.allowedActions=i,l.roles=o,l.nodeIndex=n,l.handlers=a,l}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.handlers.onSetHierarchyExpansionState({data:this.selectors[0],dataRoles:this.roles,isCollapse:this.isCollapse,nodeIndex:this.nodeIndex}),[2]}))}))},i.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||this.isCollapse?!this.allowedActions.collapseHierarchy:!this.allowedActions.expandHierarchy]}}))}))},i})(i.VisualContainerMenuCommand);i.ExpandCollapseHierarchyCommand=v;var g=(function(r){function o(e,t,i,o,n,a,s){var l=r.call(this,"Group_Action",void 0,void 0,s&&s.groupVisualContainers)||this;return l.container=e,l.selection=t,l.viewModeState=o,l.featureSwitchService=n,l.explorationSettings=a,l.childCommands=[new f(l.selection,i,s),new m(l.container,i,s),new y(l.selection,i,s)],l}return __extends(o,r),o.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e=!(this.explorationSettings&&this.explorationSettings.useStylableVisualContainerHeader),e?[3,2]:[4,r.prototype.isVisible.call(this)];case 1:e=!t.sent(),t.label=2;case 2:return e?[2,!1]:[2,1===this.viewModeState.getMode()]}}))}))},o.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,o;return __generator(this,(function(n){switch(n.label){case 0:return e=t.contracts.isVisualContainerGroup(this.container)||!!this.container.parentGroup,o=!i.selectionUtils.hasMultipleVisualContainerSelection(this.selection)&&!e,o?[3,2]:[4,r.prototype.isDisabled.call(this)];case 1:o=n.sent(),n.label=2;case 2:return[2,o]}}))}))},o.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.childCommands]}))}))},o})(i.VisualContainerMenuCommand);i.VisualContainerGroupingCommandsCollection=g;var f=(function(r){function o(e,t,i){var o=r.call(this,"Group_Action",void 0,void 0,i&&i.groupVisualContainers)||this;return o.selection=e,o.layoutAuthoring=t,o}return __extends(o,r),o.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.layoutAuthoring.groupCanvasItems(i.selectionUtils.getSelectedCanvasItems(this.selection)),[2]}))}))},o.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:return e=!1,o=i.selectionUtils.getSelectedCanvasItems(this.selection),o.length>1&&(n=o[0].parentGroup,e=_.every(o,(function(e){return e.parentGroup===n})),a=t.util.CanvasVisualsUtility.getContainerGroupDepth(o),e=e&&a<t.constants.MaxGroupingDepth),s=!e,s?[3,2]:[4,r.prototype.isDisabled.call(this)];case 1:s=l.sent(),l.label=2;case 2:return[2,s]}}))}))},o})(i.VisualContainerMenuCommand);i.GroupVisualContainerCommand=f;var y=(function(r){function o(e,t,i){var o=r.call(this,"Merge",void 0,void 0,i&&i.groupVisualContainers)||this;return o.selection=e,o.layoutAuthoring=t,o}return __extends(o,r),o.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.layoutAuthoring.mergeVisualContainerGroups(i.selectionUtils.getSelectedCanvasItems(this.selection)),[2]}))}))},o.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,o,n,a=this;return __generator(this,(function(s){switch(s.label){case 0:return e=i.selectionUtils.getSelectedCanvasItems(this.selection),o=!1,e.length>1&&(o=_.every(e,(function(e){if(t.contracts.isVisualContainer(e))return!1;var r=!1;return t.contracts.traverseVisualContainerGroups(e.children,(function(e){return r=r||i.selectionUtils.isCanvasItemSelected(e,a.selection)})),!r}))),n=!o,n?[3,2]:[4,r.prototype.isDisabled.call(this)];case 1:n=s.sent(),s.label=2;case 2:return[2,n]}}))}))},o})(i.VisualContainerMenuCommand);i.MergeVisualContainerGroupCommand=y;var m=(function(i){function r(e,t,r){var o=i.call(this,"Ungroup",void 0,void 0,r&&r.groupVisualContainers)||this;return o.container=e,o.layoutAuthoring=t,o}return __extends(r,i),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){return e=t.contracts.isVisualContainerGroup(this.container)?this.container:this.container.parentGroup,e&&this.layoutAuthoring.ungroupCanvasItems(e),[2]}))}))},r.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return e=t.contracts.isVisualContainerGroup(this.container)||!!this.container.parentGroup,[4,i.prototype.isDisabled.call(this)];case 1:return[2,r.sent()||!e]}}))}))},r})(i.VisualContainerMenuCommand);i.UngroupVisualContainerCommand=m;var C=(function(i){function r(e,t,r,o,n,a,s){void 0===n&&(n=!1);var l=i.call(this,"VisualTable_Show",void 0,n?"itemIcon glyphicon pbi-glyph-seedata glyph-small":void 0,s&&s.seeData)||this;return l.visualContainer=e,l.drill=t,l.visibility=r,l.pluginOps=o,l.viewModeState=a,l}return __extends(r,i),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=2,this.viewModeState&&this.viewModeState.getConfig().displayOptions.showVisualAccessibleData&&(e=8),this.visibility.set(this.visualContainer,e),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return[4,i.prototype.isVisible.call(this)];case 1:return r.sent()?(e=this.visualContainer&&2!==this.visualContainer.visibility&&this.drill.canSeeData(this.visualContainer)&&!this.pluginOps.isAnalysisVisual(t.util.VisualContainerUtils.getVisualType(this.visualContainer)),[2,e]):[2,!1]}}))}))},r})(i.VisualContainerMenuCommand);i.SeeDataCommand=C;var S=(function(t){function i(e,i,r,o,n,a,s,l){var c=t.call(this,"Group_Data_Action",i,void 0,l&&l.createGroup)||this;return c.visualContainer=e,c.conceptualSchemaProxy=r,c.dataSources=o,c.featureSwitchService=n,c.groupAuthoring=a,c.promiseFactory=s,c}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:if(this.pendingGroupOperation)return[2];this.pendingGroupOperation=!0,e=this.dataSources.get(),i.label=1;case 1:return i.trys.push([1,,4,5]),[4,this.conceptualSchemaProxy.get(e)];case 2:return t=i.sent(),[4,this.groupAuthoring.visual.group(this.visualContainer,this.selectors,!0,e,t)];case 3:return i.sent(),[3,5];case 4:return this.pendingGroupOperation=!1,[7];case 5:return[2]}}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a;return __generator(this,(function(s){switch(s.label){case 0:return e=!this.featureSwitchService.featureSwitches.enableGroupAuthoring,e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!s.sent(),s.label=2;case 2:return e?[2,!1]:(i=this.dataSources.get(),i?[4,this.conceptualSchemaProxy.get(i)]:[2,!1]);case 3:return r=s.sent(),o=r.schema(void 0),n=(o&&o.capabilities&&o.capabilities.supportsGrouping)!==!1,a=n&&this.groupAuthoring.visual.canGroup(this.visualContainer,this.selectors,r),[2,this.promiseFactory.resolve(a)]}}))}))},i})(i.VisualContainerMenuCommand);i.CreateGroupCommand=S;var w=(function(t){function i(e,i,r,o,n,a,s,l,c,u,p){var d=t.call(this,e,r,void 0,p&&p.includeExclude)||this;return d.visualContainer=i,d.filterCreationKind=o,d.conceptualSchemaProxy=n,d.dataSources=a,d.featureSwitchService=s,d.includeExcludeService=l,d.promiseFactory=c,d.dataView=u,d}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.includeExcludeService.setFilter(this.filterCreationKind,this.selectors,this.visualContainer,this.dataView),[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r;return __generator(this,(function(n){switch(n.label){case 0:return[4,t.prototype.isVisible.call(this)];case 1:return n.sent()&&o.hasIdentities(this.selectors)?(e=this.dataSources.get(),e?[4,this.conceptualSchemaProxy.get(e)]:[2,this.promiseFactory.resolve(!1)]):[2,this.promiseFactory.resolve(!1)];case 2:return i=n.sent(),null!=this.selectors[0].dataMap?(r=this.includeExcludeService.isIncludeExcludeSupported(this.visualContainer,i,this.featureSwitchService.featureSwitches.negatedTuplesFiltering,this.selectors),[2,this.promiseFactory.resolve(r)]):[2,this.promiseFactory.resolve(!1)]}}))}))},i})(i.VisualContainerMenuCommand);i.IncludeExcludeCommand=w;var b=(function(e){function t(t,i,r,o,n,a,s,l,c){return e.call(this,"VisualContainer_ContextMenu_Include",t,i,3,r,o,n,a,s,l,c)||this}return __extends(t,e),t})(w);i.IncludeCommand=b;var x=(function(e){function t(t,i,r,o,n,a,s,l,c){return e.call(this,"VisualContainer_ContextMenu_Exclude",t,i,4,r,o,n,a,s,l,c)||this}return __extends(t,e),t})(w);i.ExcludeCommand=x;var E=(function(t){function i(i,r,o,n,a,s,l,c){var u=t.call(this,"Copy",void 0,void 0,c&&c.copy)||this;return u.clipboard=r,u.childCommands=[],u.copyPasteService=e.CopyPasteService.create(),l.copyArgs&&(l.copyArgs.singleValue||l.copyArgs.grid)&&(u.childCommands.push(new F("Visual_CopyValue",i,u.copyPasteService,o,l.copyArgs.singleValue)),u.childCommands.push(new V("Visual_CopySelection",i,u.copyPasteService,o,l.copyArgs.grid))),a.get()||0!==s.getMode()&&u.childCommands.push(new P("Visual_CopyVisual",u.clipboard)),u}return __extends(i,t),Object.defineProperty(i.prototype,"commandsCount",{get:function(){return this.childCommands.length},enumerable:!0,configurable:!0}),i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.childCommands]}))}))},i})(i.VisualContainerMenuCommand);i.CopyCommandsCollection=E;var F=(function(i){function r(e,t,r,o,n,a){var s=i.call(this,e,void 0,void 0,a&&a.copy)||this;return s.visualContainer=t,s.copyPasteService=r,s.telemetryService=o,s.valueCallback=n,s}return __extends(r,i),r.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,i.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||null===this.valueCallback||!("string"==typeof this.valueCallback||"function"==typeof this.valueCallback)]}}))}))},r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){return e=t.util.VisualContainerUtils.getVisualType(this.visualContainer),this.copyPasteService.copyText(this.valueCallback,this.telemetryService,e),[2]}))}))},r})(i.VisualContainerMenuCommand);i.CopyValueCommand=F;var V=(function(i){function r(e,t,r,o,n,a){var s=i.call(this,e,void 0,void 0,a&&a.copy)||this;return s.visualContainer=t,s.copyPasteService=r,s.telemetryService=o,s.valueCallback=n,s}return __extends(r,i),r.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,i.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||null===this.valueCallback||"function"!=typeof this.valueCallback]}}))}))},r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){return e=t.util.VisualContainerUtils.getVisualType(this.visualContainer),this.copyPasteService.copyGrid(this.valueCallback,this.telemetryService,e),[2]}))}))},r})(i.VisualContainerMenuCommand);i.CopySelectionCommand=V;var P=(function(t){function i(e,i,r){var o=t.call(this,e,void 0,void 0,r&&r.copy)||this;return o.clipboard=i,o}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.clipboard.copy(),[2]}))}))},i})(i.VisualContainerMenuCommand);i.CopyVisualCommand=P;var M=(function(t){function i(e,i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.call(this,"VisualContainer_ContextMenu_Analyze",i,void 0,v&&v.insightsAnalysis)||this;return g.visualContainer=e,g.position=r,g.conceptualSchemaProxy=o,g.dataSources=n,g.dropdown=a,g.eventBridge=s,g.explorationCapabilities=l,g.explorationNavigation=c,g.featureSwitchService=u,g.lazyScoped=p,g.viewModeState=d,g.queryHandler=h,g.displayOverride=v,g}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:return e=!this.featureSwitchService.featureSwitches.insightsExplore,e?[3,2]:[4,t.prototype.isVisible.call(this)];case 1:e=!l.sent(),l.label=2;case 2:return e?[2,!1]:(i=this.dataSources.get())?(r=this.explorationCapabilities.getCapabilities(),r&&r.insights?[4,this.lazyScoped("userEmulationService")]:[2,!1]):[2,!1];case 3:return o=l.sent(),o.getState()?[2,!1]:[4,this.conceptualSchemaProxy.get(i)];case 4:return n=l.sent(),[4,this.getAnalysisOptions(n)];case 5:return a=l.sent(),s=!_.isEmpty(a),[2,s]}}))}))},i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:return e=this.dataSources.get(),e?[4,this.conceptualSchemaProxy.get(e)]:[2,null];case 1:return t=l.sent(),[4,this.getAnalysisOptions(t)];case 2:if(i=l.sent(),!_.isEmpty(i)){for(r=[],o=0,n=i;o<n.length;o++)a=n[o],s=new T(this.selectors,this.position,a,this.dataSources,this.dropdown,this.eventBridge,this.explorationNavigation,this.viewModeState,this.lazyScoped,this.featureSwitchService,this.displayOverride),r.push(s);return[2,r]}return[2,null]}}))}))},i.prototype.getAnalysisOptions=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return e=this.featureSwitchService.featureSwitches.insightsAngularMigration,e?[4,this.lazyScoped("insightsAnalysisModern")]:[3,2];case 1:return r=a.sent(),[3,4];case 2:return[4,this.lazyScoped("insightsAnalysisService")];case 3:r=a.sent(),a.label=4;case 4:return i=r,[4,this.queryHandler.getCachedQueryOrGenerate({contract:this.visualContainer})];case 5:return o=a.sent(),null==o?[2]:(n=i.getOptions(this.visualContainer,o.filterContext,this.selectors,t),[2,n])}}))}))},i})(i.VisualContainerMenuCommand);i.InsightsAnalysisCommandsCollection=M;var T=(function(t){function i(e,i,r,o,n,a,s,l,c,u,p){var d=t.call(this,null,e,void 0,p&&p.insightsAnalysis)||this;return d.position=i,d.insightsAnalysisData=r,d.dataSources=o,d.dropdown=n,d.eventBridge=a,d.explorationNavigation=s,d.viewModeState=l,d.lazyScoped=c,d.featureSwitchService=u,d}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,r,o=this;return __generator(this,(function(n){switch(n.label){case 0:return i={useModern:this.featureSwitchService.featureSwitches.insightsAngularMigration,exploration:this.explorationNavigation.getCurrentExploration(),analysisDefinition:this.insightsAnalysisData.analysisDefinition,insightQueryTransform:this.insightsAnalysisData.insightQueryTransform,description:this.insightsAnalysisData.description,dataSources:this.dataSources.get(),isReadOnly:0===this.viewModeState.getMode()},this.featureSwitchService.featureSwitches.insightsAngularMigration?(r=void 0,[3,3]):[3,1];case 1:return[4,this.lazyScoped("insightsTutorialService")];case 2:r=n.sent(),n.label=3;case 3:return i.insightsTutorialService=r,i.addVisual=function(t){o.eventBridge.publishToChannel(e.explore.services.events.addInsightContainer,{visualContainer:t})},i.lazyLoadConfig={name:"powerbi.insights",namespace:"powerbi.insights",dependency:{javascript:"insights",css:["insights"]}},t=i,this.dropdown.showMenu({args:t},"insightsExplore.html",{position:this.position,showInsideVisibleArea:!0,showIndicator:!0,hideExistingOverlays:!0}),[2]}}))}))},i.prototype.title=function(e){return this.insightsAnalysisData.question},i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){
return __generator(this,(function(e){return[2,null]}))}))},i})(i.VisualContainerMenuCommand);i.InsightsAnalysisCommand=T;var D=(function(i){function r(e,t,r,o,n,a,s,l,c,u,p){var d=i.call(this,u||"Drillthrough",t,"pbi-glyph-drillup",p&&p.drillthrough)||this;return d.visualContainer=e,d.drillthroughEntryPoint=r,d.drill=o,d.explorationNavigation=n,d.lazyScoped=a,d.pluginOps=s,d.queryHandler=l,d.telemetryService=c,d.displayOverride=p,d}return __extends(r,i),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return e=_.isEmpty(this.selectors),e?[3,2]:[4,i.prototype.isVisible.call(this)];case 1:e=!r.sent(),r.label=2;case 2:return e?[2,!1]:this.drill.canDrillthrough(this.visualContainer)?(t=this,[4,this.getChildren()]):[3,4];case 3:return t.children=r.sent(),[2,!_.isEmpty(this.children)];case 4:return[2,!1]}}))}))},r.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,l=this;return __generator(this,(function(c){switch(c.label){case 0:return void 0!==this.children?[2,this.children]:(e=this.drillthroughEntryPoint,i=this.explorationNavigation.getCurrentSection(),r=t.util.VisualContainerUtils.getVisualType(this.visualContainer),_.isEmpty(this.selectors)||_.isEmpty(i.name)||!this.pluginOps.isQueryVisual(r)?[2,[]]:[4,this.queryHandler.getCachedQueryOrGenerate({contract:this.visualContainer})]);case 1:return o=c.sent(),null==o?[2]:[4,this.lazyScoped("drillthrough")];case 2:return n=c.sent(),[4,n.getDrillthroughActions(i.name,this.visualContainer,this.selectors,o.filterContext)];case 3:return a=c.sent(),s=_.map(a,(function(t){return new A(t,e,l.lazyScoped,l.telemetryService,l.displayOverride)})),[2,s]}}))}))},r})(i.VisualContainerMenuCommand);i.DrillthroughCommandCollection=D;var A=(function(t){function i(e,i,r,o,n){var a=t.call(this,"Drillthrough",void 0,void 0,n&&n.drillthrough)||this;return a.drillthroughActionData=e,a.drillthroughEntryPoint=i,a.lazyScoped=r,a.telemetryService=o,a}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.lazyScoped("drillthrough")];case 1:return t=i.sent(),t.applyDrillthroughState(this.drillthroughActionData,!0),this.telemetryService.logEvent(e.telemetry.EXDrillthroughGotoTarget,this.drillthroughEntryPoint,!!this.drillthroughActionData.targetReportGuid),[2]}}))}))},i.prototype.title=function(e){return this.drillthroughActionData.reportDisplayName?this.drillthroughActionData.sectionDisplayName+" ["+this.drillthroughActionData.reportDisplayName+"]":this.drillthroughActionData.sectionDisplayName},i})(i.VisualContainerMenuCommand);i.DrillthroughCommand=A;var I=(function(t){function i(e,i,r,o,n,a,s,l,c){var u=t.call(this,null,i,void 0,c&&c.extensions,void 0,s)||this;return u.visualContainer=e,u.commandName=r,u.commandTitle=o,u.eventBridge=n,u.explorationExtensibilityService=a,u.visualContainerDataSelectionService=l,u}return __extends(i,t),i.prototype.title=function(e){return this.commandTitle},i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=this.getDataPointsDescriptions(),this.explorationExtensibilityService.executeCustomCommand(this.eventBridge,this.visualContainer,this.commandName,e),[2]}))}))},i.prototype.getDataPointsDescriptions=function(){var e=[];if(this.visualContainerDataSelectionService){var t=_.map(this.selectors,(function(e){return o.convertSelectorsByColumnToSelector(e)}));if(!_.isEmpty(t))for(var i=0,r=t;i<r.length;i++){var n=r[i],a=this.visualContainerDataSelectionService.getSelectedValues(n);e.push({selector:n,values:a})}}return e},i})(i.VisualContainerMenuCommand);i.ExtensionCommand=I})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(i){function r(e,t,r,o,n,a,s,l){var c=i.call(this,"Slicer_SearchBox_Text",void 0,"itemIcon glyphicon pbi-glyph-search glyph-small",l&&l.search)||this;return c.visualContainer=e,c.filterGenerator=t,c.overlayService=r,c.undoRedo=o,c.visualAuthoring=n,c.visualPlugin=a,c.menuOptions=s,c.selected=c.isSearchOn,c}return __extends(r,i),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.visualAuthoring.toggleSlicerVisualSearch(this.visualContainer.contract,this.filterGenerator,this.visualPlugin),this.overlayService.hideAllDropdowns(),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canSearch&&i.prototype.isVisible.call(this)]}))}))},Object.defineProperty(r.prototype,"isSearchOn",{get:function(){var i=this.visualContainer.contract.config.singleVisual;if(!i||!i.objects)return!1;var r=t.util.VisualContainerUtils.getVisualCapabilities(this.visualContainer.contract,this.visualPlugin);if(!r)return!1;var o=this.filterGenerator.tryGetSelfFilterEnabledProperty(r);if(!o)return!1;var n=e.data.DataViewObjectDefinitions.getValue(i.objects,o,null);return n&&n.value||!1},enumerable:!0,configurable:!0}),r})(i.VisualContainerMenuCommand);i.ToggleSearchCommand=r;var o=(function(t){function r(e,i,r,o,n,a,s,l,c,u){var p=t.call(this,"ExportData_MenuItem",void 0,"itemIcon glyphicon pbi-glyph-export glyph-small",u&&u.exportData)||this;return p.visualContainer=e,p.conceptualSchemaProxy=i,p.dataSources=r,p.eventBridge=o,p.featureSwitchService=n,p.filterGenerator=a,p.overlayService=s,p.menuOptions=l,p.explorationSettings=c,p}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r,o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:e=this.visualContainer.getRunningVisual(),t=this.visualContainer.contract.config.singleVisual,r=this.visualContainer.visualTitle,o=null!=r?r.text:"",n=this.dataSources.get(),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,this.conceptualSchemaProxy.get(n)];case 2:return a=l.sent(),this.eventBridge.publishToChannel(i.events.exportVisualData,{visualData:{data:e.getData(),dataTransforms:e.getDataTransforms()},visualConfig:t,visualTitle:o,additionalFilters:this.visualContainer.hostServices.getFilters(this.filterGenerator,a)}),[3,5];case 3:return s=l.sent(),[3,5];case 4:return this.overlayService.hideAllDropdowns(),[7];case 5:return[2]}}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canExport&&t.prototype.isVisible.call(this)]}))}))},r.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||this.explorationSettings&&this.explorationSettings.exportDataMode&&2===this.explorationSettings.exportDataMode||this.menuOptions.exportDataDenied||this.featureSwitchService.featureSwitches.disableExportDataOnVisualError&&this.visualHasError()]}}))}))},r.prototype.visualHasError=function(){return!!this.visualContainer.errorInfo},r.prototype.getToolTip=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.isDisabled()];case 1:return e=r.sent(),e?this.menuOptions.exportDataDenied?[2,t.get("ExportData_DeniedTooltip")]:(i=this.visualHasError(),i?[2,t.get("VisualContainer_ExportDataDisabled_VisualError_Tooltip")]:[2,t.get("VisualContainer_ExportDataDisabled_Tooltip")]):[2,null]}}))}))},r})(i.VisualContainerMenuCommand);i.ExportVisualDataCommand=o;var n=(function(t){function r(e,i,r,o){var n=t.call(this,"AddComment",void 0,"itemIcon glyphicon glyph-small pbi-glyph-comment",o&&o.addComment)||this;return n.visualContainer=e,n.eventBridge=i,n.menuOptions=r,n}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.eventBridge.publishToChannel(i.events.addCommentVisual,{visualContainerId:this.visualContainer.id}),[2]}))}))},r.prototype.isVisible=function(){return this.menuOptions.canAddComment&&t.prototype.isVisible.call(this)},r})(i.VisualContainerMenuCommand);i.AddCommentVisualCommand=n;var a=(function(t){function r(e,i,r,o,n){var a=t.call(this,"Edit_ToolTip",void 0,"itemIcon glyphicon pbi-glyph-edit glyph-mini",n&&n.enterAdvancedEditMode)||this;return a.visualContainer=e,a.eventBridge=i,a.overlayService=r,a.menuOptions=o,a}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.eventBridge.publishToChannel(i.events.editModeChanged,{editMode:1,visualContainer:this.visualContainer.contract}),this.overlayService.hideAllDropdowns(),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canEdit&&t.prototype.isVisible.call(this)]}))}))},r})(i.VisualContainerMenuCommand);i.EnterAdvancedEditModeCommand=a;var s=(function(t){function r(e,i,r,o,n){var a=t.call(this,"Remove_visual",void 0,"itemIcon glyphicon pbi-glyph-close glyph-mini",n&&n.removeVisual)||this;return a.visualContainer=e,a.eventBridge=i,a.undoRedo=r,a.menuOptions=o,a}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e=this;return __generator(this,(function(t){return this.undoRedo.register("DeleteVisualContainer",(function(){e.eventBridge.publishToChannel(i.events.deleteVisualContainer,e.visualContainer.contract)})),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canDelete&&t.prototype.isVisible.call(this)]}))}))},r})(i.VisualContainerMenuCommand);i.DeleteVisualContainerCommand=s;var l=(function(t){function r(e,i,r,o,n,a,s){var l=t.call(this,e,void 0,i,s&&s.clusters)||this;return l.visualContainer=r,l.eventBridge=o,l.isSpatialCluster=n,l.menuOptions=a,l}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.eventBridge.publishToChannel(i.events.getClusters,{useSpatialClustering:this.isSpatialCluster,visualContainer:this.visualContainer.contract}),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,(this.isSpatialCluster?this.menuOptions.canSpatialCluster:this.menuOptions.canCluster)&&t.prototype.isVisible.call(this)]}))}))},r})(i.VisualContainerMenuCommand);i.ClustersSpatialClustersCommand=l;var c=(function(e){function t(t,i,r,o){return e.call(this,"Visual_Cluster_FindGroups","itemIcon glyphicon pbi-glyph-scatter glyph-small",t,i,!1,r,o)||this}return __extends(t,e),t})(l);i.GetClustersCommand=c;var u=(function(e){function t(t,i,r,o){return e.call(this,"Visual_Cluster_FindGroups_Spatial",void 0,t,i,!0,r,o)||this}return __extends(t,e),t})(l);i.GetSpatialClustersCommand=u;var p=(function(t){function i(e,i,r,o){var n=t.call(this,"Spotlight",void 0,"itemIcon glyphicon pbi-glyph-flashlight glyph-small",o&&o.spotlight)||this;return n.visualContainer=e,n.visibility=i,n.menuOptions=r,n.selected=n.isSpotlightOn,n}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return 4===this.visualContainer.contract.visibility?this.visibility.clear():this.visibility.set(this.visualContainer.contract,4),[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canSpotlight&&t.prototype.isVisible.call(this)]}))}))},Object.defineProperty(i.prototype,"isSpotlightOn",{get:function(){return 4===this.visualContainer.contract.visibility},enumerable:!0,configurable:!0}),i})(i.VisualContainerMenuCommand);i.ToggleSpotlightCommand=p;var d=(function(t){function r(e,i,r,o,n,a,s,l){var c=t.call(this,e,void 0,i,l&&l.sort)||this;return c.sortDirection=r,c.visualContainer=o,c.eventBridge=n,c.overlayService=a,c.menuOptions=s,c.selected=c.isHighlighted,c}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(r){return this.overlayService.hideAllDropdowns(),e=this.getSortByField(),t={visualContainer:this.visualContainer.contract,sortableField:e,sortDirection:this.sortDirection,sortOnDemand:!0},this.eventBridge.publishToChannel(i.events.toggleSortVisualContainer,t),[2]}))}))},r.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.menuOptions.canSort&&t.prototype.isVisible.call(this)]}))}))},r.prototype.isDisabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,t.prototype.isDisabled.call(this)];case 1:return[2,e.sent()||void 0===this.getSortByField()]}}))}))},Object.defineProperty(r.prototype,"activeSortableField",{get:function(){return _.find(this.menuOptions.sortSetting.sortableFields,(function(e){return e.active}))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isHighlighted",{get:function(){return this.visualContainer.readOnlyState.actualSortDirection===this.sortDirection&&void 0!==this.activeSortableField},enumerable:!0,configurable:!0}),r.prototype.getSortByField=function(){if(this.menuOptions.sortSetting.sortableFields)return 1===_.size(this.menuOptions.sortSetting.sortableFields)?this.menuOptions.sortSetting.sortableFields[0]:this.activeSortableField},r})(i.VisualContainerMenuCommand);i.SortAscendingDescendingCommand=d;var h=(function(e){function t(t,i,r,o,n){return e.call(this,"Sort_Desc","itemIcon glyphicon pbi-glyph-ztoa glyph-small",2,t,i,r,o,n)||this}return __extends(t,e),t})(d);i.SortDescendingCommand=h;var v=(function(e){function t(t,i,r,o,n){return e.call(this,"Sort_Asc","itemIcon glyphicon pbi-glyph-atoz glyph-small",1,t,i,r,o,n)||this}return __extends(t,e),t})(d);i.SortAscendingCommand=v;var g=(function(t){function i(e,i,r,o,n){var a=t.call(this,"MobileFooter_SortBy",void 0,void 0,n&&n.sort)||this;return a.visualContainer=e,a.eventBridge=i,a.overlayService=r,a.menuOptions=o,a.displayOverride=n,a}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2]}))}))},i.prototype.isVisible=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return e=this.menuOptions.canSort,e?[4,t.prototype.isVisible.call(this)]:[3,2];case 1:e=i.sent(),i.label=2;case 2:return e?[2,_.size(this.menuOptions.sortSetting.sortableFields)>1]:[2,!1]}}))}))},i.prototype.getChildren=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o=this;return __generator(this,(function(n){return e=this.menuOptions.sortSetting.sortableFields,t=1===this.visualContainer.readOnlyState.actualSortDirection?"Sort_Asc":"Sort_Desc",i=_.some(this.menuOptions.sortSetting.sortableFields,(function(e){return e.active})),r=_.map(e,(function(e){return new f(o.visualContainer,e,i?t:void 0,o.eventBridge,o.overlayService,o.displayOverride)})),[2,r]}))}))},i})(i.VisualContainerMenuCommand);i.SortByCommandCollection=g;var f=(function(t){function r(e,i,r,o,n,a){var s=t.call(this,i.displayName,void 0,void 0,a&&a.sort)||this;return s.visualContainer=e,s.sortField=i,s.sortDirectionKey=r,s.eventBridge=o,s.overlayService=n,s.selected=s.sortField.active,s}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return this.overlayService.hideAllDropdowns(),e={sortableField:this.sortField,sortDirection:this.visualContainer.readOnlyState.actualSortDirection,sortOnDemand:!0,visualContainer:this.visualContainer.contract},this.eventBridge.publishToChannel(i.events.toggleSortVisualContainer,e),[2]}))}))},r.prototype.title=function(e){return this.sortField.displayName},r.prototype.getToolTip=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.sortDirectionKey?[2,this.sortField.displayName+", "+t.get(this.sortDirectionKey)]:[2,this.title(t)]}))}))},r})(i.VisualContainerMenuCommand);i.SortByCommand=f})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t,i,r,n,a,s,l,c,u){return new o(e,t,i,r,n,a,s,l,c,u)}var r=e.util.VisualContainerUtils;t.createVisualDataProxyExecutionService=i;var o=(function(){function e(e,i,r,o,n,a,s,l,c,u){this.promiseFactory=e,this.conceptualSchemaProxy=i,this.featureSwitchService=r,this.visualQueryGenerator=o,this.visualPlugin=n,this.visualPluginOps=a,this.dataProxy=s,this.visualDataProxyService=l,this.networkAvailability=c,this.visualContainerCacheStrategy=u,this.visualContainerCache=new t.VisualContainerCache(e,i,r,o,n,a,s,l,c,u)}return e.prototype.generateQuery=function(e){return this.visualDataProxyService.generateQuery(e)},e.prototype.runQuery=function(e){var t=this,i=this.featureSwitchService.featureSwitches.telemetryV2,r=this.promiseFactory.defer(i),o=this.promiseFactory.defer(i),n={previewPromise:r.promise,finalPromise:o.promise};return this.visualContainerCache.applyVisualCache(e,r,o).then((function(i){i&&t.runQueryImpl(e,o,e.canDefer?0:2)})),n},e.prototype.cancelQuery=function(e){this.visualDataProxyService.cancelQuery(e)},e.prototype.runQueryImpl=function(e,t,i){var r=this;void 0===i&&(i=0);var o=e.contract,n=e.dataSources,a=e.initialLoad&&!!e.useVisualContainerCache&&o&&!o.disableCacheOnServerForInitialLoad;return!o||!o.config||o.useInitialCachedQuery&&a||!this.visualQueryGenerator.shouldExecute(o.config.singleVisual,n)?void t.resolve(null):void this.conceptualSchemaProxy.get(n).then((function(s){var l={dataSources:n,schema:s,config:o.config.singleVisual,hostServices:e.hostServices,visualQueryGenerator:r.visualQueryGenerator,executionType:i,isInitialLoad:a,allowCache:e.allowCache,cacheResponseOnServer:e.cacheResponseOnServer,preferCurrentData:e.preferCurrentData,viewport:e.viewport,cacheOptions:e.cacheOptions,performanceActivity:e.performanceActivity,requestPriority:e.requestPriority,applicationContext:e.applicationContext};r.visualDataProxyService.runQuery(l).then((function(i){return r.loadData(i,s,o,a,e.useVisualContainerCache,t)}),(function(e){return t.reject(e)}))}),(function(e){t.reject(e?e.clientError:null)}))},e.prototype.canLoadMoreData=function(){return this.visualDataProxyService.canLoadMore()},e.prototype.loadMoreData=function(e){var t=this.promiseFactory.defer();return this.visualDataProxyService.canLoadMore()?this.runQueryImpl(e,t,1):t.reject(),t.promise},e.prototype.loadData=function(e,t,i,r,o,n){var a=this.visualDataProxyService.lastExecutedQuery(),s=r&&o&&(this.isMissingVisualQueryOrDataTransformsContract(i)||this.isGeneratedQueryDifferentToContainerQuery(i,a)),l=this.promiseFactory.defer();l.resolve(a.options),n.resolve({result:e,dataProxyQuery:{transforms:a.transforms,error:a.error,warnings:a.warnings,options:l.promise,compiledMappings:a.compiledMappings},schema:t,updateServerVisualContainerCache:s})},e.prototype.isMissingVisualQueryOrDataTransformsContract=function(e){var t=r.getVisualType(e);return!(!t||!this.visualPluginOps.isQueryVisual(t))&&(null==e.cachedData||null==e.cachedData.query&&null==e.cachedData.queryObject||!e.cachedData.transforms)},e.prototype.isGeneratedQueryDifferentToContainerQuery=function(e,t){var i=e.cachedData;if(i&&i.query){return JSON.stringify(t.options.query.command)!==i.query}return!1},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n){return void 0===n&&(n=!1),new u(e,t,i,r,o,n)}function r(e,t){return!(!e.query||!t.query)&&(e.type===t.type&&e.kinds===t.kinds&&e.perfId===t.perfId&&e.query.allowCache===t.query.allowCache&&e.query.allowClientSideFilters===t.query.allowClientSideFilters&&e.query.cacheResponseOnServer===t.query.cacheResponseOnServer&&e.query.ignoreViewportForCache===t.query.ignoreViewportForCache&&o.equals(e.query.cacheOptions,t.query.cacheOptions)&&o.equals(e.query.performanceActivity,t.query.performanceActivity)&&o.equals(e.query.command,t.query.command)&&o.equals(e.query.dataSources,t.query.dataSources))}var o=jsCommon.JsonComparer,n=jsCommon.PerfTimer,a=e.data.segmentation.DataViewMerger,s=e.data.WindowExpansionState,l=e.data.WindowExpansionStateBuilder,c=(function(){function e(e,t,i){this.index=e,this.restartToken=t,i&&(this.hierarchyLastNodeIndex=i)}return e.prototype.endsBeforeNode=function(e){for(var t=this.hierarchyLastNodeIndex,i=Math.min(t.length,e.length),r=0;r<i;r++){var o=t[r],n=e[r];if(o<n)return!0;if(o>n)return!1}return e.length>t.length},e})();t.DataSegment=c,t.createExploreVisualDataProxyService=i;var u=(function(){function t(e,t,i,r,o,n){this.hasExecutedQuery=!0,this.dataProxy=e,this.promiseFactory=i,this.filterGenerator=t,this.dataSegments=[],this.telemetryV2Enabled=n,this.visualPluginService=r,this.explorationCapabilitiesService=o}return t.prototype.generateQuery=function(e){var t=n.start("visualQueryGenerator("+e.config.visualType+")"),i=e.visualQueryGenerator.execute({config:e.config,dataSources:e.dataSources,schema:e.schema,additionalFilters:e.hostServices.getFilters(this.filterGenerator,e.schema),restartToken:this.getRestartToken(e),cacheResponseOnServer:!(!e.isInitialLoad&&!e.cacheResponseOnServer),allowCache:e.allowCache,dataWindow:e.viewport,cacheOptions:e.cacheOptions,dataSourceVariables:e.hostServices.getDataSourceVariables(),performanceActivity:e.performanceActivity,telemetryV2Enabled:this.telemetryV2Enabled,requestPriority:e.requestPriority,applicationContext:e.applicationContext,windowExpansion:this.getWindowExpansion(e),disableAnchorTime:this.explorationCapabilitiesService.getCapabilities().disableAnchorTime||e.hostServices.disableAnchorTime});return t(),i},t.prototype.getSegmentRestartToken=function(e){if(!(e<=0))return this.dataSegments[e-1].restartToken},t.prototype.runQuery=function(t){var i=this,o=this.promiseFactory.defer(this.telemetryV2Enabled),n=_.last(this.dataSegments),a=n&&n.restartToken;if(1!==t.executionType||a){var s=t.generatedQuery||this.generateQuery(t);if(s)if(t.additionalDataViewKinds&&(s.options.kinds|=t.additionalDataViewKinds),s.error)o.reject(s.error),this.generatedQuery=void 0;else{if(!(this.generatedQuery&&this.hasExecutedQuery&&t.preferCurrentData&&r(s.options,this.generatedQuery.options))){if(s=this.ensureRestartToken(t,s),this.shouldDelayExecution(t,s))return this.resolveEmptyResult(s,o),e.createRejectablePromise2(o);var l=this.dataProxy.execute(s.options);return l.then((function(e){return i.handleQueryResult(e,s,l,t.config.query)}),(function(e){throw i.generatedQuery=void 0,e}))}this.generatedQuery=s,o.resolve(null)}else this.generatedQuery=void 0,o.reject()}else o.reject();return e.createRejectablePromise2(o)},t.prototype.cancelQuery=function(e){this.dataProxy.cancelQuery(e)},t.prototype.ensureRestartToken=function(e,t){return 1!==e.executionType&&(this.dataSegments=[],e.preferCurrentData&&(t=this.generateQuery(e),e.additionalDataViewKinds&&(t.options.kinds|=e.additionalDataViewKinds))),t},t.prototype.getRestartToken=function(e){var t=this.dataSegments.length-1;return e.preferCurrentData?this.getSegmentRestartToken(t):1===e.executionType?this.getSegmentRestartToken(t+1):void 0},t.prototype.getWindowExpansion=function(e){if(e.config&&e.config.query&&e.config.query.expansionStates){var t=e.config.visualType,i=this.visualPluginService.capabilities(t);if(_.some(i.dataViewMappings,(function(e){return e&&e.matrix&&e.matrix.rows&&e.matrix.rows.dataReductionAlgorithm&&e.matrix.rows.dataReductionAlgorithm.topNPerLevel})))return 3===e.executionType?e.windowExpansion:s.mergeWithExpansionState(_.first(e.config.query.expansionStates),this.windowExpansionState)}},t.prototype.shouldDelayExecution=function(e,t){return!t.options.query.command||t.deferred&&1!==e.executionType&&2!==e.executionType},t.prototype.resolveEmptyResult=function(e,t){this.generatedQuery=e,this.hasExecutedQuery=!1,t.resolve({dataReaderResult:{dataView:{metadata:{columns:[]}}}})},t.prototype.handleQueryResult=function(e,t,i,r){return this.hasExecutedQuery=!0,this.generatedQuery=t,i.matchesLastExecuteQuery&&(e=this.rewriteQueryResultWithoutPerformanceActivities(e)),this.addNewDataSegment(e&&e.dataReaderResult),this.addWindowExpansionState(t,r,e&&e.dataReaderResult),e},t.prototype.addWindowExpansionState=function(e,t,i){1===_.size(e.compiledMappings)&&e.compiledMappings[0].matrix&&e.compiledMappings[0].matrix.rows&&e.compiledMappings[0].matrix.rows.dataReductionAlgorithm&&e.compiledMappings[0].matrix.rows.dataReductionAlgorithm.topNPerLevel?this.windowExpansionState=l.fromDataview(i.dataView,_.first(t.expansionStates)):this.windowExpansionState=null},t.prototype.addNewDataSegment=function(e){var t,i=e&&e.restartToken,r=e&&e.dataView,o=r&&r.matrix&&r.matrix.rows&&r.matrix.rows.root,n=this.dataSegments.length;if(_.isEmpty(o&&o.children))t=new c(n,i);else{var s=_.last(this.dataSegments),l=void 0;l=s?_.clone(s.hierarchyLastNodeIndex):[],a.updateTreeLastNodeIndex(o,l),t=new c(n,i,l)}this.dataSegments.push(t)},t.prototype.rewriteQueryResultWithoutPerformanceActivities=function(e){if(e&&e.dataReaderResult&&e.dataReaderResult.performanceActivities){var t=__assign({},e.dataReaderResult);delete t.performanceActivities;return __assign({},e,{dataReaderResult:t})}return e},t.prototype.canLoadMore=function(){var e=_.last(this.dataSegments);return null!=e&&null!=e.restartToken},t.prototype.lastExecutedQuery=function(){return this.generatedQuery},t.prototype.getNodeSegment=function(e){return _.find(this.dataSegments,(function(t){return!t.endsBeforeNode(e)}))},t.prototype.discardSegmentsFrom=function(e){this.dataSegments.length=e},t.prototype.getLastNodeIndex=function(){if(!_.isEmpty(this.dataSegments))return _.last(this.dataSegments).hierarchyLastNodeIndex},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new o(e,t,i,r)}var r={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},o=(function(){function t(e,t,i,r){this.promiseFactoryValue=e,this.moduleLoader=t,this.geolocationService=i,this.geocoderService=r,this.instanceId=void 0}return t.initialize=function(i){e.visuals.valueFormatter.setLocaleOptions(t.createLocaleOptions(i)),e.visuals.TooltipManager.setLocalizedStrings(t.createTooltipLocaleOptions(i)),e.data.DataViewTransform.setLocalizationOptions(t.createDataViewTransformLocalizationOptions(i))},t.createLocaleOptions=function(e){return{null:e.get("NullValue"),true:e.get("BooleanTrue"),false:e.get("BooleanFalse"),NaN:e.get("NaNValue"),infinity:e.get("InfinityValue"),negativeInfinity:e.get("NegativeInfinityValue"),beautify:function(i){return t.beautify(e,i)},describe:function(i){return t.describeUnit(e,i)},restatementComma:e.get("FilterRestatement_Comma"),restatementCompoundAnd:e.get("FilterRestatement_CompoundAnd"),restatementCompoundOr:e.get("Generic_Or")}},t.createTooltipLocaleOptions=function(t){return{highlightedValueDisplayName:t.get(e.visuals.ToolTipComponent.highlightedValueDisplayNameResorceKey)}},t.createDataViewTransformLocalizationOptions=function(t){return{quarterPrefix:t.get(e.visuals.ForecastHelper.quarterHierarchyLevelPrefixResorceKey)}},t.prototype.getLocalizedString=function(t){for(var i,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return(i=e.common.localize).format.apply(i,[t].concat(r))},t.prototype.requestFocus=function(e){jsCommon.FocusManager.focus(e)},t.prototype.onDragStart=function(){},t.prototype.getVisualLinkProperties=function(){},t.prototype.canSelect=function(){return!1},t.prototype.onSelecting=function(){},t.prototype.onSelect=function(){},t.prototype.onSwitchFocusModeState=function(){},t.prototype.canExpandCollapse=function(e){return!1},t.prototype.setNodeExpansionState=function(e){},t.prototype.onContextMenu=function(){},t.prototype.loadMoreData=function(){},t.prototype.setShouldDeferData=function(){},t.prototype.persistProperties=function(e){},t.prototype.onCustomSort=function(e){},t.prototype.getViewMode=function(){return 0},t.prototype.getEditMode=function(){return 0},t.prototype.setWarnings=function(e){},t.prototype.setToolbar=function(e){},t.prototype.shouldRetainSelection=function(){return!1},t.prototype.geocoder=function(){return this.geocoderService},t.prototype.geolocation=function(){return this.geolocationService},t.prototype.locale=function(){return e.common.unmappedCultureInfo},t.prototype.promiseFactory=function(){return this.promiseFactoryValue},t.prototype.ignoreDefaultFilter=function(){return!1},t.prototype.getIdentityDisplayNames=function(e){},t.prototype.setIdentityDisplayNames=function(e){},t.prototype.setFilterExpressionMetadata=function(){},t.prototype.getFilterExpressionMetadata=function(){},t.prototype.dropdown=function(){},t.prototype.tooltips=function(){},t.prototype.telemetry=function(){},t.prototype.authenticationService=function(){},t.prototype.localStorageService=function(){},t.prototype.eventService=function(){},t.prototype.loader=function(){return this.moduleLoader},t.prototype.getUIComponentFactory=function(){},t.prototype.applyJsonFilter=function(e,t,i,r){},t.prototype.launchUrl=function(e){},t.prototype.refreshHostData=function(){},t.prototype.getJSONFilter=function(e){return this.promiseFactory().reject()},t.prototype.onHyperlinkClick=function(e,t){},t.prototype.visualTimeSynchronization=function(){},t.prototype.isVisualEnabled=function(){return this.promiseFactory().resolve(!0)},t.prototype.dataMultiSelectMode=function(){return 0},t.beautify=function(e,t){var i=r[t];return i?e.getOptional(i)||t:t},t.describeUnit=function(e,t){var i=t===-1?"Auto":t.toString(),r=e.getOptional("DisplayUnitSystem_E"+i+"_Title"),o=t<=0?"{0}":e.getOptional("DisplayUnitSystem_E"+i+"_LabelFormat");if(r||o)return{title:r,format:o}},t})();t.VisualHostServices=o,t.createVisualHostServices=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,a){return new n(e,t,i,r,o,a)}var r=jsCommon.ArrayExtensions,o=e.data.SQExpr;t.createVisualSortHelper=i;var n=(function(){function e(e,t,i,r,o,n){this.setting=e,this.model=t,this.sort=i,this.undoRedo=r,this.timeout=o,this.visualAuthoringOperations=n,this.sortDelay=500}return e.prototype.resetSortSettings=function(e,t){this.setting.defaultSortBehavior=t,this.setting.sortableFields=e},e.prototype.toggleSort=function(e,t,i,r){var o=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.sortPromise=this.timeout((function(){o.undoRedo.register("VisualContainerToggleSort",(function(){var n=!1;return e?(t&&(e.sortDirection=t),o.toggleSortByField(e,i,r),n=!0):void 0!==o.model.readOnlyState.actualSortDirection&&(o.sortByOrder(),n=!0),o.sortPromise=void 0,n}))}),this.sortDelay)},e.prototype.toggleDirection=function(e){return 1===e?2:1},e.prototype.sortByOrder=function(){var e=this.model.contract.config.singleVisual.query.defn.orderBy();if(!_.isEmpty(e)){for(var t=0,i=e;t<i.length;t++){i[t].direction=this.toggleDirection(this.model.readOnlyState.actualSortDirection)}this.visualAuthoringOperations.setOrderBy(this.model.contract,e)}},e.prototype.toggleSortByField=function(e,t,i){var r=this,o=_.map(e.exprs,(function(t){return{direction:e.sortDirection||2,expr:t.expr}})),n=this.model.contract.config.singleVisual.query;
!e.active||i?(this.sort.resetSort(n),this.resetSortableFieldsStatus(!1,!1),this.visualAuthoringOperations.setOrderBy(this.model.contract,o)):this.visualAuthoringOperations.removeOrderBy(this.model.contract,o.map((function(e){return e.expr})),t);var a=_.find(this.setting.sortableFields,(function(t){return r.compareSortableFieldExprs(e,t)}));a&&(a.active=!e.active)},e.prototype.applySortByFields=function(e){var t=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.resetSortableFieldsStatus(!1,!0);var i=this.findMatchingSortableFields(e);return this.sortPromise=this.timeout((function(){t.undoRedo.register("VisualContainerApplySort",(function(){for(var e=[],r=0,o=i;r<o.length;r++)for(var n=o[r],a=0,s=n.exprs;a<s.length;a++){var l=s[a];e.push({expr:l.expr,direction:n.sortDirection})}var c=t.model.contract,u=c.config.singleVisual.query;return t.sort.resetSort(u),t.visualAuthoringOperations.setOrderBy(c,e),t.sortPromise=void 0,!0}))}),this.sortDelay),i},e.prototype.findMatchingSortableFields=function(e){var t=[],i=this.setting.sortableFields;if(_.isEmpty(i)||_.isEmpty(e))return[];for(var r=0,o=i;r<o.length;r++){for(var n=o[r],a=!1,s=null,l=function(t){var i=_.findIndex(e,(function(e){return e.queryName===t.name})),r=e[i];if(!r)return a=!1,"break";if(null==s)s=r.sortDirection;else if(s!==r.sortDirection)return a=!1,"break";a=!0,n.orderByIndex=i},c=0,u=n.exprs;c<u.length;c++){if("break"===l(u[c]))break}a&&(n.sortDirection=s,n.active=!0,t.push(n))}return t=_.sortBy(t,(function(e){return e.orderByIndex}))},e.prototype.areAllSortDescriptorsIncluded=function(e,t){for(var i=0,r=e;i<r.length;i++){for(var o=r[i],n=!1,a=0,s=t;a<s.length;a++){for(var l=s[a],c=0,u=l.exprs;c<u.length;c++){if(u[c].name===o.queryName){n=!0;break}}if(n)break}if(!n)return!1}return!0},e.prototype.resetSortableFieldsStatus=function(e,t){if(this.setting.sortableFields)for(var i=0,r=this.setting.sortableFields;i<r.length;i++){var o=r[i];o.active=e,t&&(o.sortDirection=void 0)}},e.prototype.compareSortableFieldExprs=function(e,t){var i=e.exprs,n=t.exprs;return r.sequenceEqual(i,n,(function(e,t){return o.equals(e.expr,t.expr)}))},e})();t.VisualSortHelper=n})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u){return new d(e,t,i,r,o,n,a,s,l,c,u)}function o(e,t){return _.size(e)===_.size(t)&&(!!_.isEmpty(e)||_.every(e,(function(e,i){return n(e,t[i])})))}function n(e,t){return e?t?e.isTransient===t.isTransient&&l.isSameFilter(e.filter,t.filter):!e:!t}var a=e.visuals.Units.FontSize,s=e.data.Selector,l=e.data.SemanticFilter,c=e.data.SQExpr,u=t.contracts.VisualTooltip;i.createVisualHostTooltipServiceFactory=r;var p,d=(function(){function e(e,t,i,r,o,n,a,s,l,c,u){this.dataSources=e,this.explorationCapabilities=t,this.explorationNavigation=i,this.featureSwitchService=r,this.hostTooltip=o,this.lazyScoped=n,this.localizationService=a,this.visualPlugin=s,this.viewModeState=l,this.eventBridge=c,this.visualPluginOps=u}return e.prototype.create=function(e,t,i){return new h(this.dataSources,this.explorationCapabilities,this.explorationNavigation,this.featureSwitchService,this.hostTooltip,this.lazyScoped,this.localizationService,this.visualPlugin,this.viewModeState,this.eventBridge,e,t,this.visualPluginOps)},e})(),h=(function(){function t(e,t,i,r,o,n,a,s,l,c,u,p,d){this.dataSources=e,this.explorationCapabilities=t,this.explorationNavigation=i,this.featureSwitchService=r,this.hostTooltip=o,this.lazyScoped=n,this.localizationService=a,this.visualPlugin=s,this.viewModeState=l,this.visualContainer=u,this.queryHandler=p,this.visualPluginOps=d;var h=t.getCapabilities();this.ignoreTooltipDisable=this.explorationCapabilities.getCapabilities().visualContainerOptions.ignoreTooltipDisable,this.disableCanvasTooltips=h&&h.disableCanvasTooltips,this.disableDrillthroughText=h&&h.disableDrillthroughText,this.visualTooltipData={sectionName:void 0,tooltipType:void 0,identities:void 0,filterContext:void 0,tooltipStyle:void 0},this.subscriptionManager=c.createChannelSubscriptionManager()}return t.handleEvents=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(r){switch(r.label){case 0:return[4,t];case 1:e=r.sent(),t=e.next,r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.handler()];case 3:return r.sent(),e.result.resolve(),[3,5];case 4:return i=r.sent(),e.result.reject(),[3,5];case 5:return[3,0];case 6:return[2]}}))}))},t.prototype.enqueue=function(i){this.tail||(this.tail=new e.Deferred,t.handleEvents(this.tail.promise));var r=new e.Deferred,o={next:r.promise,handler:i,result:new e.Deferred};return this.tail.resolve(o),this.tail=r,o.result.promise},t.prototype.show=function(t,r,o){var n=this;if(!this.enabled(o)){var a=new e.Deferred;return a.resolve(),a.promise}return this.enqueue((function(){return __awaiter(n,void 0,e.Promise,(function(){var e,n,a=this;return __generator(this,(function(s){switch(s.label){case 0:return this.enabled(o)?this.viewModeState.getConfig().displayOptions.enableTooltipActions?(e=this,n=this.visualHostActionsProvider,n?[3,2]:[4,this.lazyScoped("visualHostTooltipActionsProvider")]):[3,4]:[2];case 1:n=s.sent(),s.label=2;case 2:return e.visualHostActionsProvider=n,[4,this.visualHostActionsProvider.createTooltipCommands(t,this.visualContainer,this.queryHandler)];case 3:return s.sent(),[3,5];case 4:this.visualHostActionsProvider&&this.visualHostActionsProvider.resetTooltipActions(),s.label=5;case 5:return[4,this.buildData(t.identities,r)];case 6:return r=s.sent(),r=this.getCachedData(r),this.subscriptionManager.unsubscribeAll(),this.subscriptionManager.subscribe(i.events.canvasChanged,(function(){return a.hide({isTouchEvent:!1,immediately:!0})})).subscribe(i.events.visibilityChanged,(function(){return a.hide({isTouchEvent:!1,immediately:!0})})).subscribe(i.events.selectionChanged,(function(){return a.hide({isTouchEvent:!1,immediately:!0})})).subscribe(i.events.visualTypeChanged,(function(){return a.hide({isTouchEvent:!1,immediately:!0})})).subscribe(i.events.CanvasResized,(function(){return a.hide({isTouchEvent:!1,immediately:!0})})),this.hostTooltip.show({coordinates:t.coordinates,dataItems:t.dataItems,dataSources:this.dataSources.get(),explorationContract:this.explorationNavigation.getCurrentExploration(),explorationCapabilities:this.explorationCapabilities.getCapabilities(),identities:t.identities,isTouchEvent:t.isTouchEvent,visualTooltipData:r,visualHostTooltipActionsProvider:this.visualHostActionsProvider,showTooltipAboveClick:this.viewModeState.getConfig().displayOptions.showTooltipAboveClick}),[2]}}))}))}))},t.prototype.move=function(t){var i=this;if(!this.enabled()){var r=new e.Deferred;return r.resolve(),r.promise}return this.enqueue((function(){return __awaiter(i,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return this.enabled()?[4,this.buildData(t.identities)]:[2];case 1:return e=i.sent(),e=this.getCachedData(e),this.hostTooltip.move({coordinates:t.coordinates,dataItems:t.dataItems,dataSources:this.dataSources.get(),explorationContract:this.explorationNavigation.getCurrentExploration(),explorationCapabilities:this.explorationCapabilities.getCapabilities(),identities:t.identities,isTouchEvent:t.isTouchEvent,visualTooltipData:e}),[2]}}))}))}))},t.prototype.hide=function(t){var i=this;return this.enqueue((function(){return __awaiter(i,void 0,e.Promise,(function(){return __generator(this,(function(e){return this.hostTooltip.hide(t),this.subscriptionManager.unsubscribeAll(),[2]}))}))}))},t.prototype.visible=function(){return this.hostTooltip.visible()},t.prototype.container=function(){return this.hostTooltip.container()},t.prototype.enabled=function(e){var t,i=this.visualContainer&&this.visualContainer.config.singleVisual.getEvaluatedObject;if(i)if(e){var r=i("visualHeader");t=r&&r.showTooltipButton}else{var o=i("visualTooltip");t=o&&o.show}var n,a=this.getVisualCapabilities(),s=a&&a.tooltips,l=!s||void 0===s.showByDefault||s.showByDefault;return n=!!this.ignoreTooltipDisable||(void 0===t?l:t),!!n&&this.hostTooltip.enabled()},t.prototype.isTouchScreenOptimizedEnabled=function(){return this.hostTooltip.isTouchScreenOptimizedEnabled()},t.prototype.getCachedData=function(e){var t=this.visualTooltipData;return o(e.filterContext,t.filterContext)&&e.sectionName===t.sectionName&&e.tooltipType===t.tooltipType&&_.isEqual(t.tooltipStyle,e.tooltipStyle)&&s.equalsSelectorsByColumnArray(e.identities,t.identities)&&e.discoverabilityText===t.discoverabilityText||(this.visualTooltipData={filterContext:e.filterContext,identities:e.identities,sectionName:e.sectionName,tooltipType:e.tooltipType,tooltipStyle:e.tooltipStyle,discoverabilityText:e.discoverabilityText}),this.visualTooltipData},t.prototype.getVisualCapabilities=function(){return this.visualPlugin.capabilities(this.visualContainer.config.singleVisual.visualType)},t.prototype.hasDrillthrough=function(t,i,r){return __awaiter(this,void 0,e.PbiPromise,(function(){var e,o;return __generator(this,(function(n){switch(n.label){case 0:return e=this.explorationNavigation.getCurrentSection(),[4,t.getDrillthroughActions(e.name,this.visualContainer,i,r.filterContext)];case 1:return o=n.sent(),[2,!_.isEmpty(o)]}}))}))},t.prototype.buildData=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r,o,n,s,l,c,d,h,v,g,f,y,m,C;return __generator(this,(function(S){switch(S.label){case 0:return i?(i.tooltipType!==u.Canvas||p.isValidTooltipSection(i.sectionName,this.explorationNavigation)||(i=__assign({},i,{sectionName:void 0,tooltipType:u.Default})),[2,i]):(e=this.visualContainer&&this.visualContainer.config.singleVisual.getEvaluatedObject("visualTooltip"),r=p.getTooltipType(e,this.getVisualCapabilities(),this.disableCanvasTooltips,t),[4,this.lazyScoped("drillthrough")]);case 1:return c=S.sent(),this.queryHandler&&this.visualContainer?[4,this.queryHandler.getCachedQueryOrGenerate({contract:this.visualContainer})]:[3,3];case 2:l=S.sent(),S.label=3;case 3:return d=this.visualContainer.config.singleVisual.visualType,h=this.visualPluginOps.isAnalysisVisual(d),v=this.visualPluginOps.isQnaVisual(d),!this.featureSwitchService.featureSwitches.drillthroughText||this.disableDrillthroughText||h||v?[3,5]:[4,this.hasDrillthrough(c,t,l)];case 4:g=S.sent(),g&&(s=this.localizationService.get("Drillthrough_Discoverability")),S.label=5;case 5:return f=e&&e.fontSize&&a.createFromPt(+e.fontSize),y={titleFontProperties:{size:f,color:e&&e.titleFontColor&&e.titleFontColor.solid.color,family:e&&e.fontFamily},valueFontProperties:{size:f,color:e&&e.valueFontColor&&e.valueFontColor.solid.color,family:e&&e.fontFamily},background:e&&e.background,transparency:e&&null!=e.transparency?e.transparency:void 0},r!==u.Canvas?[3,7]:(m=void 0,C=void 0,m=l&&l.filterContext,[4,p.getSectionAndFilterActionInfo({drillthroughServices:c,explorationNavigation:this.explorationNavigation,identities:t,tooltipConfig:e,visualContainer:this.visualContainer,visualQueryFilterContext:m})]);case 6:C=S.sent(),null==C?(r=u.Default,C=void 0):(n=C.sectionName,o=C.getFilterContext(),y=void 0),S.label=7;case 7:return[2,{filterContext:o,identities:t,sectionName:n,tooltipType:r,tooltipStyle:y,discoverabilityText:s}]}}))}))},t})();!(function(t){function i(e,t,i,r){var o=t&&t.tooltips;if(!o||!o.supportedTypes||i||_.isEmpty(r))return u.Default;var n=e&&e.type||u.Canvas,a=!1,s=o.supportedTypes;switch(n){case u.Canvas:a=!!s.canvas;break;case u.Default:a=!!s.default;break;default:debug.assertNever(n)}return a||(n=u.Default),n}function r(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,a,s;return __generator(this,(function(l){switch(l.label){case 0:return e=t.tooltipConfig,i=e&&e.section||u.SectionAuto,r=i!==u.SectionAuto,r&&!o(i,t.explorationNavigation)?[2]:(a=__assign({},t,{specifiedTargetSectionName:r?i:void 0}),[4,n(a)]);case 1:return s=l.sent(),[2,s]}}))}))}function o(e,t){var i=t.getSectionByName(e);return null!=i&&!!(1&i.type)}function n(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,l,u;return __generator(this,(function(p){switch(p.label){case 0:return e=t.drillthroughServices,i=t.explorationNavigation,r=t.identities,o=t.visualContainer,_.isEmpty(r)?[2]:(n=i.getCurrentSection(),_.isEmpty(t.specifiedTargetSectionName)?[4,e.getMatchedSectionsInfo(1,n.name,o,r,t.visualQueryFilterContext)]:[3,2]);case 1:return a=p.sent(),_.isEmpty(a)?[2]:(s=_.chain(a).map((function(e){for(var t=0,i=0,r=0,o=e.matchedLinkFields;r<o.length;r++){var n=o[r],a=n.fieldExpr;n.asAggregation||!c.isColumn(a)&&!c.isHierarchyLevel(a)?(n.asAggregation||c.isMeasure(a))&&t++:i++}return{name:e.sectionName,matchedColumns:i,matchedMeasures:t,getFilterContext:e.getFilterContext}})).orderBy([function(e){return e.matchedMeasures},function(e){return e.matchedColumns},function(e){return e.name}],["desc","desc","asc"]).value(),l=_.head(s),[2,{sectionName:l.name,getFilterContext:l.getFilterContext}]);case 2:return[4,e.getForcedMatchSectionInfo(1,t.specifiedTargetSectionName,n.name,o,r,t.visualQueryFilterContext)];case 3:if(u=p.sent())return[2,{sectionName:u.sectionName,getFilterContext:u.getFilterContext}];p.label=4;case 4:return[2]}}))}))}t.getTooltipType=i,t.getSectionAndFilterActionInfo=r,t.isValidTooltipSection=o})(p=i.TooltipSelector||(i.TooltipSelector={}))})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new o(e,t,i)}var r=e.extensibility.convertVisualEventType;t.createVisualHostTelemetryService=i;var o=(function(){function t(e,t,i){this.telemetryService=e,this.visualType=t,this.instanceId=i}return t.prototype.trace=function(t,i){var o=r(t);if(o&&e.telemetry[o]){var n=e.telemetry[o];this.telemetryService.logEvent(n,this.visualType,this.instanceId,i)}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,l,c,u){return new s(e,t,i,r,o,n,a,l,c,u)}var o=e.visualHost.CustomVisualsUtils,n=t.util.VisualContainerUtils,a=e.visualHost;i.createVisualValidatorService=r;var s=(function(){function t(e,t,i,r,o,n,a,s,l,c){this.featureSwitchService=e,this.visualPlugin=t,this.scriptVisuals=i,this.shell=r,this.localizationService=o,this.trustedVisual=n,this.approvedResourceService=a,this.resourcePackageService=s,this.explorationCapabilities=l,this.customVisualsGalleryService=c}return t.prototype.validate=function(i,r,o){return __awaiter(this,void 0,e.Promise,(function(){var s,l,c,u,p,d,c,h,v,g,c,g,u,f,y,m,f,C,S,g,g,u,f,w,b;return __generator(this,(function(x){if(n.isScriptVisual(i,this.visualPlugin)){switch(s=n.getVisualType(i),l=e.explore.util.ScriptVisualsUtil.getScriptVisualType(s),c=void 0,u=void 0,l){case 0:c=this.scriptVisuals.getScriptVisualErrorDetails(0,o),u="ScriptVisualsNotEnabled";break;case 1:c=this.scriptVisuals.getScriptVisualErrorDetails(1,o),u="PythonVisualsNotEnabled"}if(c)return[2,{details:c,code:this.shell.areScriptVisualsApproved()?"ScriptVisualError":u}]}if(p=n.getVisualType(i),!p)return[2];if(d=this.visualPlugin.getPlugin(p),d&&d.apiVersion&&!e.extensibility.visualApiVersions.some((function(e){return e.version===d.apiVersion})))return c={message:this.localizationService.get("CustomVisualApiVersionNotSupported"),displayableErrorInfo:[]},[2,{details:c,code:"CvApiVersionNotSupported"}];if(p===a.PowerAppsVisual&&(h=this.explorationCapabilities.getCapabilities().disablePowerApps,v=this.featureSwitchService.featureSwitches.disablePowerAppsVisual,h||v))return[2,{details:t.buildErrorDetails(this.localizationService.get("LegacyVisualsAreNotSupported"),null,null),code:"UnsupportedVisual"}];if(this.trustedVisual.isTrustedVisual(p)){if(g=this.trustedVisual.validate(p))return[2,{details:g,code:"TrustedVisualError"}];if(this.visualPlugin.isCustomVisual(p))return[2,this.validateCustomVisual(p)]}else{if(this.visualPlugin.isCustomVisual(p))return[2,this.validateCustomVisual(p)];if(!this.visualPlugin.getPlugin(p))return c=t.buildErrorDetails(this.localizationService.get("VisualContainer_UnableToFindVisualMessage"),this.localizationService.get("VisualContainer_UnableToFindVisualKey"),this.localizationService.get("VisualContainer_UnableToFindVisualValue")),[2,{details:c,code:"UnsupportedVisual"}];if(p===e.visuals.plugins.keyDriversVisual.name){if(g=void 0,u=void 0,f=this.featureSwitchService.featureSwitches.keyDrivers,y=_.some(r.schemas,(function(e){return e.capabilities.insights&&e.capabilities.insights.supportsKeyDrivers})),m=this.explorationCapabilities.getCapabilities().analysisVisuals,f?y&&m||(g=t.buildErrorDetails(this.localizationService.get("VisualContainer_AnalysisVisual_NotSupportedMessage"),this.localizationService.get("VisualContainer_FailedToLoadVisual"),this.localizationService.get("VisualContainer_AnalysisVisual_NotSupportedValue")),u="AnalysisVisualNotSupported"):(g=t.buildErrorDetails(this.localizationService.get("VisualContainer_AnalysisVisual_NotSupportedFeatureSwitchMessage"),this.localizationService.get("VisualContainer_FailedToLoadVisual"),this.localizationService.get("VisualContainer_AnalysisVisual_NotSupportedFeatureSwitchMessage")),u="AnalysisVisualNotEnabled"),g)return g.source="User",[2,{details:g,code:u}]}else if(p===e.visuals.plugins.qnaVisual.name){if(f=this.featureSwitchService.featureSwitches.qnaVisual,C=_.some(r.schemas,(function(e){return e.capabilities&&e.capabilities.supportsQna})),S=this.explorationCapabilities.getCapabilities().qna,!f||!C||!S)return g=t.buildErrorDetails(this.localizationService.get("VisualContainer_QnaVisual_FailedToLoadMessage"),this.localizationService.get("VisualContainer_QnaVisual_NotSupportedTitle"),this.localizationService.get("VisualContainer_QnaVisual_NotSupportedMessage")),g.source="User",[2,{details:g,code:"QnaVisualNotSupported"}]}else if(p===e.visuals.plugins.decompositionTreeVisual.name&&(g=void 0,u=void 0,f=this.featureSwitchService.featureSwitches.decompositionTree,w=_.every(r.schemas,(function(e){return e.capabilities&&e.capabilities.supportsInstanceFilters})),b=_.some(r.schemas,(function(e){return e.isMultiDimensionalModel})),f?w&&!b||(g=t.buildErrorDetails(this.localizationService.get("VisualContainer_DecompositionTreeVisual_NotSupportedMessage"),this.localizationService.get("VisualContainer_FailedToLoadVisual"),this.localizationService.get("VisualContainer_DecompositionTreeVisual_NotSupportedValue")),u="DecompositionTreeVisualNotSupported"):(g=t.buildErrorDetails(this.localizationService.get("VisualContainer_DecompositionTreeVisual_NotSupportedFeatureSwitchMessage"),this.localizationService.get("VisualContainer_FailedToLoadVisual"),this.localizationService.get("VisualContainer_DecompositionTreeVisual_NotSupportedFeatureSwitchMessage")),u="DecompositionTreeVisualNotEnabled"),g))return g.source="User",[2,{details:g,code:u}]}return[2]}))}))},t.buildErrorDetails=function(e,t,i){return{message:e,displayableErrorInfo:[{errorInfoKey:t,errorInfoValue:i}]}},t.prototype.validateCustomVisual=function(i){return __awaiter(this,void 0,e.Promise,(function(){var e,r,n,a,s,l;return __generator(this,(function(c){switch(c.label){case 0:return this.featureSwitchService.featureSwitches.customVisuals?[3,1]:(n=t.buildErrorDetails(this.localizationService.get("VisualContainer_CustomVisualDisabledMessage"),this.localizationService.get("VisualContainer_CustomVisualDisabledKey"),this.localizationService.get("VisualContainer_CustomVisualDisabledValue")),r="UnsupportedVisual",[3,3]);case 1:return s=(a=o).isCustomVisualTypeDisabled,l=[this.featureSwitchService,i,this.approvedResourceService,!0],[4,this.customVisualsGalleryService.isPublicManagedVisual(i)];case 2:s.apply(a,l.concat([c.sent(),this.shell&&this.shell.areCustomVisualsDisabledByGroupPolicy(),this.shell&&this.shell.areUncertifiedVisualsDisabledByGroupPolicy()]))?(n=t.buildErrorDetails(this.localizationService.get("VisualContainer_CustomVisualDisabledValue"),null,null),n.errorType=1,n.helpLink="https://go.microsoft.com/fwlink/?LinkID=690865",r="CustomVisualsPermissionLocked"):o.isOrganizationalCustomVisual(i)&&!this.resourcePackageService.getPackage(i)?(n=t.buildErrorDetails(this.localizationService.get("CustomVisualsAreNotAvailable"),null,null),n.errorType=1,n.helpLink="https://go.microsoft.com/fwlink/?LinkID=690865",r="CustomVisualAreNotAvailable"):this.resourcePackageService.getPackage(i)||(n=t.buildErrorDetails(this.localizationService.format("VisualContainer_ToSeeCustomVisual",[i]),null,null),r="CustomVisualNotFound"),c.label=3;case 3:return r&&(e={code:r,details:n}),[2,e]}}))}))},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.sectionStatus.currentSectionNumber;return t<0&&e.exploration.sections.length>0&&(t=0),e.exploration.sections[t]}var o=e.ItemGroupingManager,n=e.explore.services.selectionUtils,a=e.visualHost.utils.ResourcePackageUtils,s=(function(){function s(){}return s.addSelectedVisualContainersIndex=function(e,t){for(var i=[],r=0,o=t;r<o.length;r++)for(var n=o[r],a=0;a<e.length;a++)if(n===e[a].contract){i.push(a);break}return i},s.createUndoRedoHandler=function(s,l,c,u,p,d,h,v,g,f,y,m,C){return{takeSnapshot:function(t){var i=r(s).contract.name,o=e.explore.services.selectionUtils.getSelectedCanvasItems(c),n=[],a=[];o&&(a=_.map(o,(function(e){return e.name})));var l,u={withVisibility:!0,withTransientPages:!0,withTransientFilters:!0},p=d.getContext();l=t&&null!=t.canvasLayout?t.canvasLayout:h&&h.getCurrentLayout();var y=v.serializeExploration(s.exploration.contract,u);return{contract:y,linguisticSchema:f.getSchema(s.exploration.contract.reportId),selectedSlide:i,selectedVisualsIndex:n,selectedCanvasItemsName:a,drillToDetailsState:p?p.toSnapshot(g):void 0,canvasLayout:l,getReferences:function(){var e=v.deserializeExploration(y,[],!0);return v.getReferencedStaticResources(e)}}},rollback:function(p){d.clearContext();var S=v.deserializeExploration(p.contract,[],!0),w=v.getReferencedStaticResources(S);C.restoreReferences(w).then((function(){var v=g.getCurrentExploration(),C=a.getStaticResources(v.resourcePackages),w=a.getStaticResources(S.resourcePackages);for(var b in C){var x=C[b];w[b]||i.ResourcePackageUtils.ensureResourcePackages(S).push(_.clone(x));a.findResourcePackage(S.resourcePackages,x.type,x.name).items=_.map(x.items,(function(e){return _.clone(e)}))}m.removeAllCustomVisuals();var E=_.filter(S.resourcePackages,(function(e){return a.isCustomVisualResourcePackage(e)}));m.ensurePlugins(E).finally((function(){y.publishToChannel(t.services.events.preparePersonalVisuals)}));var F=t.SectionUtils.findSectionIndexForSectionName(S,p.selectedSlide);s.sectionStatus.currentSectionNumber=F,s.exploration=t.viewModels.ViewModelFactory.convertExploration(S,p.canvasLayout,F),s.exploration.contract.themeCollection.highContrastTheme=v.themeCollection.highContrastTheme,s.exploration.contract.themeCollection.highContrastTheme||delete s.exploration.contract.themeCollection.highContrastTheme,f.setSchema(S.reportId,p.linguisticSchema);var V=g.getCurrentSection(),P=r(s);g.loadExploration(s.exploration.contract),g.goto(P.contract,{updateUrl:V.name!==P.contract.name}),u.updateCrossDrillOfSectionOperation(P.contract),l((function(){var t=(s.exploration.exploreCanvas.visualContainers,s.exploration.exploreCanvas.visualContainerGroups),i=[],r=p.selectedCanvasItemsName;if(r.length>0){for(var a=0,l=r;a<l.length;a++){var u=l[a],v=o.find(u,t);v&&i.push(v.contract)}n.selectCanvasItems(i,c),p.drillToDetailsState&&d.setContext(e.drillDetailsModuleFactory().snapshotToContext(p.drillToDetailsState,g))}else c.clearSelection();h.changeFormFactor(p.canvasLayout,s)}),0)}))}}},s})();i.ExploreUndoRedoHandlerUtility=s})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),angular.module("powerbi.explore").run(["$templateCache",function(e){e.put("components/advancedFilter/advancedFilter.html",'<li class="advanced" ng-style="{ \'font-size\': $ctrl.core.viewModel.fontSize }"><h3 class="description" tabindex="0" localize="AdvancedFilter_Description" localize-tooltip="AdvancedFilter_Description"></h3><div ng-repeat="condition in $ctrl.core.advFilterCard.conditions"><jq-select classes="comparisonOperator advancedControl" ng-model="condition.operator" ng-style="{ \'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                         \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                         \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor }" ng-change="$ctrl.core.markDirty()" ng-disabled="$ctrl.core.viewModel.readOnlyState.disabled" options="$ctrl.core.advFilterCard.operators" expression="operatorInfo.value as operatorInfo.label for operatorInfo in options" label="conditionOperator"></jq-select><div class="advancedControl conditionValue flex" ng-if="!$ctrl.core.advFilterCard.isDateTime" ng-show="condition.valueRequired" ng-style="{ \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor }"> <input type="text" class="item-fill" ng-model="condition.value.stringValue" ng-style="{ \'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor, \'color\': $ctrl.core.viewModel.inputBoxForegroundColor }" ng-disabled="$ctrl.core.viewModel.readOnlyState.disabled" ng-focus="$ctrl.core.handleFocusedInputChanged($event, condition)" ng-blur="$ctrl.core.handleInputBlur()" ng-change="$ctrl.core.validateFilterInput(condition); $ctrl.core.markDirty();" fast-keyup="$ctrl.core.onKeyUp($event)" aria-label="inputValue" placeholder="{{$ctrl.core.viewModel.getInputPlaceholder()}}"/><span class="errorIcon item-auto" ng-if="condition.isInvalid" tooltip tooltip-config="$ctrl.core.tooltipConfig"><svg-use-symbol sheet="filterPaneIcons" symbol-id="alert"></svg-use-symbol></span></div><section class="datetime datetimePicker" ng-if="$ctrl.core.advFilterCard.isDateTime" ng-show="condition.valueRequired" pbi-lazy-load-contents="$ctrl.core.moduleConfig" ng-class="$ctrl.core.viewModel.isInOutspacePane ? \'datetimePickerOutspace\' : \'datetimePickerClassic\'"><div class="datePicker flex"> <input type="text" class="calendarInput item-fill" ng-blur="$ctrl.dateTextUpdateComplete(condition)" ng-change="$ctrl.dateTextUpdated(condition); $ctrl.core.markDirty();" ng-model="condition.value.value" ng-style="{ \'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                                 \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                                 \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor }" ng-disabled="!condition.valueRequired || $ctrl.core.viewModel.readOnlyState.disabled" placeholder="{{::$ctrl.core.getLocalizedPlaceholder()}}" fast-keyup="$ctrl.core.onKeyUp($event)" aria-label="inputValue"/> <button type="button" class="filterPaneIcon calendar item-auto glyphicon glyph-mini pbi-glyph-calendar" ng-disabled="!condition.valueRequired || $ctrl.core.viewModel.readOnlyState.disabled" dropdown-overlay-invoke="{{$ctrl.core.getMenuId($index)}}"></button><dropdown-overlay class="datetime calendarDropDown" dropdown-overlay-name="{{$ctrl.core.getMenuId($index)}}"><datepicker class="calendar" ng-model="condition.value.dateValue" ng-disabled="!condition.valueRequired || $ctrl.core.viewModel.readOnlyState.disabled" ng-change="$ctrl.core.dateSelected(condition)" onclick="event.stopPropagation()" show-weeks="false"></datepicker></dropdown-overlay></div><timepicker class="timePicker" readonly-input="$ctrl.core.viewModel.readOnlyState.disabled" ng-model="condition.value.timePickerValue" ng-model-options="{ getterSetter: true }" ng-change="$ctrl.timeSelected(condition)" background-color="$ctrl.core.viewModel.inputBoxBackgroundColor" color="$ctrl.core.viewModel.inputBoxForegroundColor" border-color="$ctrl.core.viewModel.inputBoxBorderColor"></timepicker></section><section role="radiogroup" ng-keyDown="$ctrl.core.changeOperator($event)" class="logicalOperator advancedControl" ng-if="$index < ($ctrl.core.advFilterCard.conditions.length -1)"> <label role="radio" class="logicalOperatorField" ng-attr-tabindex="{{$ctrl.core.advFilterCard.logicalOperator === $ctrl.core.advFilterCard.logicalAndOperator ? 0 : -1}}" ng-attr-aria-checked="{{$ctrl.core.advFilterCard.logicalOperator === $ctrl.core.advFilterCard.logicalAndOperator ? \'true\' : \'false\'}}"><input type="radio" ng-model="$ctrl.core.advFilterCard.logicalOperator" ng-value="$ctrl.core.advFilterCard.logicalAndOperator" ng-disabled="$ctrl.core.viewModel.readOnlyState.disabled" ng-change="$ctrl.core.markDirty()" ng-checked="$ctrl.core.advFilterCard.logicalOperator === $ctrl.core.advFilterCard.logicalAndOperator"/><span class="glyphicon glyph-mini" ng-class="$ctrl.core.advFilterCard.logicalOperator === $ctrl.core.advFilterCard.logicalAndOperator ? \'pbi-glyph-radiobtnon\' : \'pbi-glyph-radiobtnoff\'"/><span localize="Logical_And_Operator"/></label> <label class="logicalOperatorField" role="radio" ng-attr-tabindex="{{$ctrl.core.advFilterCard.logicalOperator === $ctrl.core.advFilterCard.logicalOrOperator ? 0 : -1}}" ng-attr-aria-checked="{{$ctrl.core.advFilterCard.logicalOperator === $ctrl.core.advFilterCard.logicalOrOperator ? \'true\' : \'false\'}}"><input type="radio" ng-model="$ctrl.core.advFilterCard.logicalOperator" ng-value="$ctrl.core.advFilterCard.logicalOrOperator" ng-disabled="$ctrl.core.viewModel.readOnlyState.disabled" ng-change="$ctrl.core.markDirty()" ng-checked="$ctrl.core.advFilterCard.logicalOperator === $ctrl.core.advFilterCard.logicalOrOperator"/><span class="glyphicon glyph-mini" ng-class="$ctrl.core.advFilterCard.logicalOperator !== $ctrl.core.advFilterCard.logicalAndOperator ? \'pbi-glyph-radiobtnon\' : \'pbi-glyph-radiobtnoff\'"/><span localize="Logical_Or_Operator"/></label></section></div> <button class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-if="!$ctrl.core.isApplyAllEnabled()" ng-click="$ctrl.core.applyFilter()" ng-disabled="!$ctrl.core.canApplyFilter()"></button></li>'),e.put("components/dateTimePicker/dateTimePicker.html",'<div class="datetimePicker" pbi-lazy-load-contents="$ctrl.moduleConfig"> <input type="text" aria-labelledby="{{ $ctrl.labelId }}" class="inputFieldInSlice" ng-blur="$ctrl.dateTextUpdated()" ng-model="$ctrl.textVal" ng-class="{\'ng-invalid\': $ctrl.inputInvalid}" placeholder="{{::$ctrl.placeholder}}"/> <button class="calendar" type="button" ng-attr-title="{{$ctrl.calendarButtonText}}" dropdown-overlay-invoke="{{$ctrl.id}}"><svg-use-symbol sheet="filterPaneIcons" symbol-id="fieldListEntity"></svg-use-symbol></button><dropdown-overlay class="calendarDropDown" dropdown-overlay-name="{{$ctrl.id}}"><datepicker class="calendar" ng-model="$ctrl.dateVal" ng-change="$ctrl.dateSelected()" onclick="event.stopPropagation()" show-weeks="false" min-date="$ctrl.validators.min" max-date="$ctrl.validators.max"></datepicker></dropdown-overlay></div>'),e.put("components/detailVisual/detailVisual.html",'<div class="detailVisual" role="document" focus-nav-mode="Group" ng-switch="$ctrl.viewModel.hasData"><visual ng-if="!$ctrl.modernVisual" view-model="$ctrl.viewModel.visual" ng-switch-when="true"></visual><visual-modern ng-if="$ctrl.modernVisual" [view-model]="$ctrl.viewModel.visual" ng-switch-when="true"></visual-modern><div class="noDataOverlay" ng-switch-when="false"></div></div>'),e.put("components/explorationFooter/explorationFooter.html",'<div class="explorationNavigationContent unselectable {{$ctrl.getModeString()}}" tabindex="0" keyboard-shortcuts="ctrl-F6" focus-nav-mode="Group" focus-priority="1"><div class="background"></div><ul ng-if="!$ctrl.isBookmarkView()" class="pane sections" role="tablist"><carousel [auto-resize]="true" (on-see-all)="$ctrl.seeAllSections($event)" [is-reading-mode]="$ctrl.isReadingMode()"><li class="section static" ng-class="{\'selected\' : page.selected, \'hidden-in-view-mode\': $ctrl.isHiddenInViewMode(page)}" ng-repeat="page in $ctrl.viewModel.exploration.sections"><exploration-navigation-tab [view-model]="page" [display-name]="page.displayName" [is-editing]="$ctrl.isEditMode()" [tab-index]="$index" ng-style="page.style" [is-only-visible-tab]="$ctrl.isOnlySectionVisibleInViewMode(page)" [is-hidden-in-view-mode]="$ctrl.isHiddenInViewMode(page)"></exploration-navigation-tab></li></carousel><li ng-if="$ctrl.isEditMode()" class="section static create" accessible-click="$ctrl.createSection()" localize-tooltip="Carousel_NewPage" tabindex="0" focus-element role="button"><div class="thumbnail-container"><div class="thumbnail"><svg-use-symbol sheet="exploreCanvasIcons" symbol-id="slidethumb_addnew"></svg-use-symbol></div></div></li></ul><ul ng-if="$ctrl.isBookmarkView()" class="pane sections" pbi-lazy-load-contents="$ctrl.exploreUIShellConfig"><bookmark-play [selected-bookmark]="$ctrl.viewModel.exploration.contract.activeBookmark"></bookmark-play></ul></div>'),
e.put("components/exploreCanvas/exploreCanvas.html",'<div class="exploreCanvas themeableElement {{C.getExploreCanvasClass()}}" ng-keydown="C.onKeyDown($event)" pinchable="{ \'startHandler\' : \'C.canvasPinchStart(scale)\', \'endHandler\' : \'C.canvasPinchEnd(scale)\', \'scrollParentSelector\' : \'.exploration\', \'zoomDisabled\': \'C.shouldDisableZoom()\', \'childDisplaySelector\': \'.displayArea\' }" enable-pinch="{{C.canPinch()}}" swipeable="{ enabled: {{C.canSwipe()}}, ignoreFrom: \'.swipeable-blocked\' }" canvas-navigation="{{C.canSwipe()}}"><canvas-watermark></canvas-watermark><div class="backgroundContainer outspaceContainer" ng-class="C.outspaceBackground.imageFitClass" ng-style="C.outspaceBackground.backgroundStyle"><div ng-if="C.showOutspaceImage()" class="backgroundImageContainer outspaceImageContainer"> <img class="backgroundImage outspaceImage" ng-src="{{C.outspaceBackground.imageSource}}" ng-style="C.outspaceBackground.imageStyle"/></div></div><div ng-if="C.isCanvasBackdropVisible()" class="canvasBackdropContainer" ng-class="{\'canvasBackdropLegacy\': C.useCanvasBackdropLegacy()}"><div class="canvasBackdrop"><div ng-if="!C.useCanvasBackdropLegacy()" class="mobileLayoutNotch"></div><div ng-if="!C.useCanvasBackdropLegacy()" class="mobileLayoutHeaderMockup"><span class="backButtonMockup glyphicon pbi-glyph-arrowleft glyph-small"></span><span class="titleMockupWrapper"><span class="titleMockup"></span><span class="subtitleMockup"></span></span></div></div></div><div class="canvasFlexBox" ng-class="{\'backdropVisible\': C.isCanvasBackdropVisible() && !C.useCanvasBackdropLegacy()}"><div class="displayAreaContainer" canvas-scroll drop="C.dropConfig" drop-handler="C.drop(event, ui)" ng-click="C.clearSelection($event)" on-resize="C.canvasResized(width, height)"><div class="displayAreaViewport"></div><div class="displayArea" container-printer calculate-print-styles="C.calculatePrintStyles" print-container-selector="displayArea" disable-print="C.disablePrint" ng-style="C.canvasBackground.displayAreaStyle"><div class="backgroundContainer visualBackgroundContainer themableBackgroundColorSolid" ng-class="C.canvasBackground.imageFitClass" ng-style="C.canvasBackground.backgroundStyle"><div ng-if="C.showBackgroundImage()" class="backgroundImageContainer visualBackgroundImageContainer"> <img class="backgroundImage visualBackgroundImage" ng-src="{{C.canvasBackground.imageSource}}" ng-style="C.canvasBackground.imageStyle"/></div></div><div class="visualContainerHost" keyboard-shortcuts="ctrl-F6" focus-nav-mode="Group" tab-order-enabled focus-priority="0" ng-dblclick="C.showQna($event)"><dot-grid ng-if="C.showDotGrid() && C.dotGridViewModel" [view-model]="C.dotGridViewModel"></dot-grid><box-grid ng-if="C.showBoxGrid() && C.boxGridLayout" [view-model]="C.boxGridLayout"></box-grid><smart-guides ng-if="C.smartGuideViewModel" [view-model]="C.smartGuideViewModel"></smart-guides><div ng-if="!useModernVisual"><visual-container class="visual-container-component" ng-repeat="visualContainer in C.visibleVisualContainers()" view-model="visualContainer" canvas-layout="C.layout" transform-parent="\'div.visualContainerHost\'"></visual-container></div><div ng-if="useModernVisual && !C.useContainerRepeat()"><visual-container-modern ng-repeat="visualContainer in C.visibleVisualContainers()" [view-model]="visualContainer" [canvas-layout]="C.layout" [transform-parent]="\'div.visualContainerHost\'"></visual-container-modern></div><div ng-if="useModernVisual && C.useContainerRepeat()"><visual-container-repeat transform-parent="div.visualContainerHost" [explore-canvas]="C.viewModel" [canvas-item-containers]="C.viewModel.visualContainerGroups" [canvas-layout]="C.layout"></visual-container-repeat></div></div><pen-annotation ng-if="C.isPenAnnotationsEnabled()"></pen-annotation></div></div><outspace-pane ng-if="C.shouldShowOutspacePane()" [section-objects]="C.viewModel.contract.evaluatedObjects" [is-outspace-pane-visible]="C.isOutspacePaneVisible" [filter-pane-width]="C.filterPaneScaledWidth" [filter-pane-unscaled-height]="C.filterPaneUnscaledHeight"></outspace-pane></div></div>'),e.put("components/exploreModeFieldList/exploreModeFieldList.html",'<exploration-scoped-services-bridge><div class="exploreModeFieldList fieldListContainer explorationContainer" pbi-lazy-load-contents="$ctrl.exploreUIShellConfig"><field-list field-list-config="$ctrl.fieldListConfig"></field-list></div></exploration-scoped-services-bridge>'),e.put("components/exploreModeFieldWell/exploreModeFieldWell.html",'<exploration-scoped-services-bridge><div class="explorationContainer exploreModeFieldWell" pbi-lazy-load-contents="$ctrl.exploreUIShellConfig"><field-well></field-well></div></exploration-scoped-services-bridge>'),e.put("components/filter/filter.html",'<div class="card {{$ctrl.core.getFilterClass()}}" ng-if="!$ctrl.core.isFilterHidden" ng-style="{\'background-color\': $ctrl.core.viewModel.backgroundColor,\'border-color\': $ctrl.core.viewModel.borderColor, \'color\': $ctrl.core.viewModel.foregroundColor, \'font-family\': $ctrl.core.viewModel.fontFamily, \'font-size\': $ctrl.core.viewModel.fontSize}"><div class="filterCardTitleSection" custom-click single-click="$ctrl.core.toggle()" single-click-timeout="$ctrl.core.isEditMode ? 300 : 0" single-click-disabled="$ctrl.core.viewModel.isEditingLabel"><div class="cardHeader flex" ng-attr-tooltip="$ctrl.core.viewModel.readOnlyState.invalid" tooltip-config="$ctrl.core.tooltipConfigManager.getTooltipConfig()"><h2 class="title trimmedTextWithEllipsis unselectable" ng-bind-attr="{title: $ctrl.core.getTooltip()}" tabindex="0" aria-label="{{$ctrl.core.getAriaLabelString()}}" ng-class="{\'hasRestateHighlight\': $ctrl.core.isFilterApplied()}" ng-style="{\'font-size\': $ctrl.core.viewModel.fontSize}" ng-right-click="$ctrl.core.showContextMenu($event)" ng-keydown="$ctrl.core.onKeyDown($event)"><i ng-if="$ctrl.core.viewModel.readOnlyState.invalid" class="filterPaneIcon error"><svg-use-symbol sheet="filterPaneIcons" symbol-id="fieldListError"></svg-use-symbol></i><i ng-if="$ctrl.core.getIconClassName() != null" class="filterPaneIcon {{$ctrl.core.getIconClassName()}}"><svg-use-symbol sheet="filterPaneIcons" [symbol-id]="$ctrl.core.getIconClassName()"></svg-use-symbol></i><editable-label class="filterCardTitle" display-name="$ctrl.core.getDisplayName()" search-string="$ctrl.core.searchFiltersInput" on-blur="$ctrl.core.rename(newName)" editable="$ctrl.core.isEditMode && $ctrl.core.viewModel.isEditingLabel" disable-click="true" ng-dblclick="$ctrl.core.editLabel()" custom-tooltip="true"></editable-label></h2> <button ng-if="$ctrl.core.canExpand" class="glyphicon glyph-mini" type="button" ng-style="{\'visibility\': !$ctrl.core.isEditMode ? \'visible\' : \'\'}" ng-class="$ctrl.core.isFilterExpanded() ? \'expand\' : \'collapse\'" aria-expanded="{{$ctrl.core.isFilterExpanded()}}" ng-bind-attr="{title: $ctrl.core.isFilterExpanded() ?  $ctrl.core.viewModel.chevronCollapseDescription : $ctrl.core.viewModel.chevronExpandDescription}" aria-label="{{$ctrl.core.getDisplayName()}}"></button> <button class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="$ctrl.core.deleteFilter($event)" ng-style="{\'visibility\': !$ctrl.core.isEditMode ? \'visible\' : \'\'}" localize-tooltip="FilterPane_DeleteFilter" ng-if="$ctrl.core.showDeleteIcon" use-tooltip-as-aria-label></button> <button ng-if="$ctrl.core.showTopRowClearIcon" class="filterPaneIcon clear glyphicon glyph-mini pbi-glyph-eraser" ng-disabled="!$ctrl.core.viewModel.hasRestatement" ng-style="{\'color\': $ctrl.core.viewModel.foregroundColor }" ng-click="$ctrl.core.clearFilter($event)" localize-tooltip="{{::$ctrl.core.clearFilterTooltip}}" use-tooltip-as-aria-label></button> <button ng-if="$ctrl.core.showLockIcon" class="filterPaneIcon lock glyphicon glyph-mini" ng-class="{\'pbi-glyph-lock\': $ctrl.core.viewModel.isFilterLocked(), \'pbi-glyph-unlock\': !$ctrl.core.viewModel.isFilterLocked()}" ng-click="$ctrl.core.toggleFilterLockState($event)" ng-disabled="!$ctrl.core.isEditMode" ng-style="{visibility: $ctrl.core.viewModel.isFilterLocked() ? \'visible\' : \'\'}" localize-tooltip="{{$ctrl.core.getFilterLockTooltip()}}" use-tooltip-as-aria-label dynamic-tooltip-update></button></div><div ng-class="{\'cardExpanded\': $ctrl.core.isFilterExpanded()}" class="controlPanel flex"><h2 class="restatement {{$ctrl.core.restatementLineStyleRule}}" ng-bind-attr="{title: $ctrl.core.getRestatement()}" ng-bind="$ctrl.core.getRestatement()" ng-style="{\'font-size\': $ctrl.core.viewModel.fontSize}"></h2><div class="controlIcons"> <button ng-if="$ctrl.core.showBottomRowClearIcon" class="filterPaneIcon clear glyphicon glyph-mini pbi-glyph-eraser" ng-disabled="!$ctrl.core.viewModel.hasRestatement" ng-style="{\'color\': $ctrl.core.viewModel.foregroundColor }" ng-click="$ctrl.core.clearFilter($event)" localize-tooltip="{{::$ctrl.core.clearFilterTooltip}}" use-tooltip-as-aria-label></button> <button ng-if="$ctrl.core.showVisibilityIcon" class="filterPaneIcon hide glyphicon glyph-mini" ng-class="{\'pbi-glyph-view\':!$ctrl.core.viewModel.contract.isHiddenInViewMode, \'pbi-glyph-hide3\':$ctrl.core.viewModel.contract.isHiddenInViewMode}" ng-click="$ctrl.core.toggleFilterVisibility($event)" ng-style="{\'visibility\': $ctrl.core.isEditMode && $ctrl.core.viewModel.isFilterHidden() ? \'visible\' : \'\'}" localize-tooltip="{{$ctrl.core.viewModel.contract.isHiddenInViewMode ? \'FilterPane_ShowFilter\' : \'FilterPane_HideFilter\'}}" use-tooltip-as-aria-label dynamic-tooltip-update></button></div></div></div><div ng-if="$ctrl.core.showLinkFieldOptions()" class=\'linkFieldOptions\'><h2 localize="$ctrl.core.getResourceIdForAsAggregationDropdown()" localize-tooltip="{{$ctrl.core.getResourceIdForAsAggregationDropdown()}}" class="asAggregationTitle smallFontSize trimmedTextWithEllipsis"></h2> <select class="asAggregation" ng-model="$ctrl.core.viewModel.isLinkedAsAggregation" ng-options="$ctrl.core.getLabelForAsAggregationOption(!!item) for item in [true, false]" ng-change="$ctrl.core.updateLinkAsAggregation()" ng-disabled="$ctrl.core.viewModel.discourageAggregation"></select></div><div ng-show="$ctrl.core.canExpand && $ctrl.core.isFilterExpanded() && !($ctrl.core.viewModel.isLinkField && $ctrl.core.viewModel.isLinkedAsAggregation)" class=\'filterContent\'><div ng-if="$ctrl.core.showFilterTypeSelection()" class="filterTypeSelection"><div class="flex"><h2 class="typeSelectTitle trimmedTextWithEllipsis smallFontSize" localize="FilterCardTypeSwitchLabel" localize-tooltip="FilterCardTypeSwitchLabel" ng-style="{\'font-size\': $ctrl.core.viewModel.fontSize}" use-tooltip-as-aria-label></h2><span ng-if="$ctrl.core.isEditMode && $ctrl.core.isInOutspacePane" tabindex="0" class="filterPaneIcon pbi-glyph-info glyphicon glyph-mini" localize-tooltip="{{$ctrl.core.getFilterTypeTooltip()}}" use-tooltip-as-aria-label dynamic-tooltip-update></span></div><jq-select classes="typeSwitchOptions" aria-label="{{$ctrl.core.ariaLabelFilterType}}" ng-class="{ invalidType: $ctrl.core.viewModel.cardType.invalid }" options="$ctrl.core.viewModel.availableTypes" expression="cardType.label for cardType in options track by cardType.label" ng-init="$ctrl.core.viewModel.cardType" ng-model="$ctrl.core.viewModel.cardType" ng-change="$ctrl.core.switchCardType(cardType)" ng-style="{ \'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor, \'color\': $ctrl.core.viewModel.inputBoxForegroundColor, \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor }"></jq-select></div><div><advanced-filter view-model="$ctrl.core.viewModel" ng-if="$ctrl.core.viewModel.cardType.type === 2" on-filter-changed="$ctrl.core.onFilterChanged(args)"></advanced-filter><filter-visual view-model="$ctrl.core.viewModel" is-in-outspace-pane="$ctrl.core.isInOutspacePane" ng-if="($ctrl.core.viewModel.cardType.type === 0 || $ctrl.core.viewModel.cardType.type === 4)" expanded="$ctrl.core.viewModel.readOnlyState.expanded"></filter-visual><top-n-filter view-model="$ctrl.core.viewModel" ng-if="$ctrl.core.viewModel.cardType.type === 5" on-filter-changed="$ctrl.core.onFilterChanged(args)"></top-n-filter><relative-date-filter view-model="$ctrl.core.viewModel" ng-if="$ctrl.core.viewModel.cardType.type === 8" on-filter-changed="$ctrl.core.onFilterChanged(args)"></relative-date-filter><relative-filter [view-model]="$ctrl.core.viewModel" [filter-type]="$ctrl.core.viewModel.cardType.type" ng-if="$ctrl.core.viewModel.cardType.type === 10" (on-filter-changed)="$ctrl.core.onFilterChanged($event.args)"></relative-filter><include-exclude-filter ng-if="($ctrl.core.viewModel.readOnlyState.type === 6 || $ctrl.core.viewModel.readOnlyState.type === 7) && $ctrl.core.isFilterExpanded()" filter-view-model="$ctrl.core.viewModel" ng-class="{\'includeExcludeFilterOutspace\': $ctrl.core.isInOutspacePane}"></include-exclude-filter></div></div></div>'),e.put("components/filterPane/filterPane.html",'<section data-automation-type="filterPane" ng-class="{filterPaneOutspace: $ctrl.core.isInOutspacePane, filterPane: !$ctrl.core.isInOutspacePane}"><h3 id="noFiltersHeader" class="header caption mediumFontSize" ng-if="$ctrl.core.showNoFiltersHeader()" tabindex="0" localize="No_Filter_For_Visual_FilterPane" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }"></h3><div id="visualFilterContainer" class="bucket" ng-class="{\'bucket-padding\': $ctrl.core.isSearchTextNullOrEmpty() }" ng-if="$ctrl.core.isVisualFiltersVisible()"><div ng-if="$ctrl.core.isSearchTextNullOrEmpty()" class="header"><h3 id="visualFilterHeaderDescription" class="caption trimmedTextWithEllipsis" tabindex="0" localize="{{::$ctrl.core.filterPaneHeaderLocalization_Visual}}" localize-tooltip="FilterPane_VisualDescription" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }"></h3> <button id="visualFilterOptionsMenu" class="optionsMenu" aria-labelledby="visualFilterHeaderDescription visualFilterOptionsMenu" ng-if="$ctrl.core.isSinglePaneOutspacePaneEditMode()" ng-click="$ctrl.core.showSortOrderContextMenu($event, 0)" role="menu" tabindex="0" tooltip tooltip-config="$ctrl.core.getOptionsMenuTooltipConfig()"><span class="glyphicon pbi-glyph-more glyph-mini"></span></button></div><div class="cards"><div drop="$ctrl.core.getFilterPaneDropConfig()" drop-watch-config="true" drop-handler="$ctrl.core.dropVisualFilter(event, ui, dropAction)" drop-action="$ctrl.core.getDropAction(dropPosition)"><filter data-automation-type="filterCard" ng-repeat="filter in $ctrl.core.viewModel.visualFilters" ng-if="!$ctrl.core.isInOutspacePane" view-model="filter" is-in-outspace-pane="$ctrl.core.isInOutspacePane" search-filters-input="$ctrl.core.searchFiltersInput"></filter><filter data-automation-type="filterCard" ng-repeat="filter in $ctrl.core.viewModel.visualFilters" ng-if="$ctrl.core.isInOutspacePane" view-model="filter" is-in-outspace-pane="$ctrl.core.isInOutspacePane" index="$index" last-index="$ctrl.core.getSortableFiltersLength($ctrl.core.viewModel.visualFilters)" move-filter="$ctrl.core.moveFilter(startIndex, targetIndex, filterScopeType)" drop="$ctrl.core.getDropConfigForVisualFilters()" drop-watch-config="true" drag="filter" drag-disabled="$ctrl.core.filterCustomSortDisabled(filter) || !$ctrl.core.isSearchTextNullOrEmpty()" drag-context="$ctrl.core.getDragContext(filter, $index)" drop-action="$ctrl.core.getOutspaceFilterDropAction(dropPosition, filter)" drop-handler="$ctrl.core.dropFilterWithCustomOrder(event, ui, dropAction, $index, filter)" search-filters-input="$ctrl.core.searchFiltersInput"></filter></div><div ng-if="$ctrl.core.isEditMode() && $ctrl.core.isSearchTextNullOrEmpty()" role="heading" ng-attr-tabindex="{{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.visualFilters) ? 0 : -1}}" class="unselectable trimmedTextWithEllipsis" ng-class="$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.visualFilters) ? \'dropzone\' : \'end-dropzone\'" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }" title="{{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.visualFilters) ? $ctrl.core.viewModel.addFilterLabel : \'\'}}" drop="$ctrl.core.dropZoneDropConfig" drop-handler="$ctrl.core.appendVisualFilters(event, ui, dropAction)" drop-action="$ctrl.core.getDropAction(dropPosition)"> {{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.visualFilters) ? $ctrl.core.viewModel.addFilterLabel : \'\'}}</div></div></div><div id="pageFilterContainer" ng-class="{\'bucket-padding\': $ctrl.core.isSearchTextNullOrEmpty() }" class="bucket" ng-if="$ctrl.core.isPageFiltersVisible()"><div ng-if="$ctrl.core.isSearchTextNullOrEmpty()" class="header"><h3 id="pageFilterHeaderDescription" class="caption trimmedTextWithEllipsis" tabindex="0" localize="{{::$ctrl.core.filterPaneHeaderLocalization_Page}}" localize-tooltip="FilterPane_PageDescription" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }"></h3> <button id="pageFilterOptionsMenu" class="optionsMenu" aria-labelledby="pageFilterHeaderDescription pageFilterOptionsMenu" ng-if="$ctrl.core.isSinglePaneOutspacePaneEditMode()" ng-click="$ctrl.core.showSortOrderContextMenu($event, 1)" role="menu" tabindex="0" tooltip tooltip-config="$ctrl.core.getOptionsMenuTooltipConfig()"><span class="glyphicon pbi-glyph-more glyph-mini"></span></button></div><div class="cards"><div drop="$ctrl.core.getFilterPaneDropConfig()" drop-watch-config="true" drop-handler="$ctrl.core.dropPageFilter(event, ui, dropAction)" drop-action="$ctrl.core.getDropAction(dropPosition)"><filter data-automation-type="filterCard" ng-repeat="filter in $ctrl.core.viewModel.pageFilters" ng-if="$ctrl.core.isSortable(filter) && !$ctrl.core.isFilterHidden(filter)" view-model="filter" is-in-outspace-pane="$ctrl.core.isInOutspacePane" index="$index" last-index="$ctrl.core.getSortableFiltersLength($ctrl.core.viewModel.pageFilters)" move-filter="$ctrl.core.moveFilter(startIndex, targetIndex, filterScopeType)" drop="$ctrl.core.getFilterDropConfig()" drop-watch-config="true" drag="filter" drag-disabled="$ctrl.core.filterCustomSortDisabled(filter) || !$ctrl.core.isSearchTextNullOrEmpty()" drag-context="$ctrl.core.getDragContext(filter, $index)" drop-action="$ctrl.core.getOutspaceFilterDropAction(dropPosition, filter)" drop-handler="$ctrl.core.dropFilterWithCustomOrder(event, ui, dropAction, $index, filter)" search-filters-input="$ctrl.core.searchFiltersInput"></filter><filter data-automation-type="filterCard" ng-repeat="filter in $ctrl.core.viewModel.pageFilters" ng-if="!$ctrl.core.isSortable(filter) && !$ctrl.core.isFilterHidden(filter)" view-model="filter" is-in-outspace-pane="$ctrl.core.isInOutspacePane" search-filters-input="$ctrl.core.searchFiltersInput"></filter><filter data-automation-type="filterCard" ng-repeat="filter in $ctrl.core.viewModel.drillthroughFilters" ng-if="$ctrl.core.isNewFilterExperienceReadingMode()" view-model="filter" is-in-outspace-pane="$ctrl.core.isInOutspacePane" search-filters-input="$ctrl.core.searchFiltersInput"></filter></div><div ng-attr-tabindex="{{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.pageFilters) ? 0 : -1}}" role="heading" ng-if="$ctrl.core.isEditMode() && $ctrl.core.isSearchTextNullOrEmpty()" class="unselectable trimmedTextWithEllipsis" ng-class="$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.pageFilters) ? \'dropzone\' : \'end-dropzone\'" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }" title="{{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.pageFilters) ? $ctrl.core.viewModel.addFilterLabel : \'\'}}" drop="$ctrl.core.dropZoneDropConfig" drop-handler="$ctrl.core.appendPageFilters(event, ui, dropAction)" drop-action="$ctrl.core.getDropAction(dropPosition)"> {{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.pageFilters) ? $ctrl.core.viewModel.addFilterLabel : \'\'}}</div></div></div><div id="drillthroughFilterContainer" class="bucket" ng-if="$ctrl.core.isDrillthroughFiltersVisible()"><div class="header"><h3 class="caption trimmedTextWithEllipsis" tabindex="0" localize="FilterPane_Drillthrough" localize-tooltip="FilterPane_DrillthroughDescription" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }"></h3></div><div class="cards"><div drop="$ctrl.core.getFilterPaneDropConfig()" drop-watch-config="true" drop-handler="$ctrl.core.dropDrillthroughFilter(event, ui, dropAction)" drop-action="$ctrl.core.getDropAction(dropPosition)"><filter data-automation-type="filterCard" ng-repeat="filter in $ctrl.core.viewModel.drillthroughFilters" view-model="filter" is-in-outspace-pane="$ctrl.core.isInOutspacePane" search-filters-input="$ctrl.core.searchFiltersInput"></filter></div><div ng-if="$ctrl.core.showDrillthroughDropZone()" ng-attr-tabindex="{{$ctrl.core.viewModel.drillthroughFilters.length === 0 ? 0 : -1}}" class="unselectable trimmedTextWithEllipsis" ng-class="$ctrl.core.viewModel.drillthroughFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{$ctrl.core.viewModel.drillthroughFilters.length === 0 ? $ctrl.core.viewModel.addDrillthroughFilterLabel : \'\'}}" drop="$ctrl.core.dropZoneDropConfig" drop-handler="$ctrl.core.dropDrillthroughFilter(event, ui, dropAction)" drop-action="$ctrl.core.getDropAction(dropPosition)"> {{$ctrl.core.viewModel.drillthroughFilters.length === 0 ? $ctrl.core.viewModel.addDrillthroughFilterLabel : \'\'}}</div></div></div><div id="exploreFilterContainer" ng-class="{\'bucket-padding\': $ctrl.core.isSearchTextNullOrEmpty() }" class="bucket" ng-if="$ctrl.core.isReportFiltersVisible()"><div ng-if="$ctrl.core.isSearchTextNullOrEmpty()" class="header"><h3 class="caption trimmedTextWithEllipsis" id="reportFilterHeaderDescription" tabindex="0" localize="{{::$ctrl.core.filterPaneHeaderLocalization_Report}}" localize-tooltip="FilterPane_ReportDescription" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }"></h3> <button id="reportFilterOptionsMenu" class="optionsMenu" aria-labelledby="reportFilterHeaderDescription reportFilterOptionsMenu" ng-if="$ctrl.core.isSinglePaneOutspacePaneEditMode()" ng-click="$ctrl.core.showSortOrderContextMenu($event, 2)" role="menu" tabindex="0" tooltip tooltip-config="$ctrl.core.getOptionsMenuTooltipConfig()"><span class="glyphicon pbi-glyph-more glyph-mini"></span></button></div><div class="cards"><div drop="$ctrl.core.getFilterPaneDropConfig()" drop-watch-config="true" drop-handler="$ctrl.core.dropReportFilter(event, ui, dropAction)" drop-action="$ctrl.core.getDropAction(dropPosition)"><filter data-automation-type="filterCard" ng-repeat="filter in $ctrl.core.viewModel.reportFilters" ng-if="$ctrl.core.isSortable(filter) && !$ctrl.core.isFilterHidden(filter)" view-model="filter" is-in-outspace-pane="$ctrl.core.isInOutspacePane" index="$index" last-index="$ctrl.core.getSortableFiltersLength($ctrl.core.viewModel.reportFilters)" move-filter="$ctrl.core.moveFilter(startIndex, targetIndex, filterScopeType)" drop="$ctrl.core.getFilterDropConfig()" drop-watch-config="true" drag="filter" drag-disabled="$ctrl.core.filterCustomSortDisabled(filter) || !$ctrl.core.isSearchTextNullOrEmpty()" drag-context="$ctrl.core.getDragContext(filter, $index)" drop-action="$ctrl.core.getOutspaceFilterDropAction(dropPosition, filter)" drop-handler="$ctrl.core.dropFilterWithCustomOrder(event, ui, dropAction, $index, filter)" search-filters-input="$ctrl.core.searchFiltersInput"></filter><filter data-automation-type="filterCard" ng-repeat="filter in $ctrl.core.viewModel.reportFilters" ng-if="!$ctrl.core.isSortable(filter) && !$ctrl.core.isFilterHidden(filter)" view-model="filter" is-in-outspace-pane="$ctrl.core.isInOutspacePane" search-filters-input="$ctrl.core.searchFiltersInput"></filter></div><div ng-if="$ctrl.core.isEditMode() && $ctrl.core.isSearchTextNullOrEmpty()" role="heading" ng-attr-tabindex="{{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.reportFilters) ? 0 : -1}}" class="unselectable trimmedTextWithEllipsis" ng-class="$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.reportFilters) ? \'dropzone\' : \'end-dropzone\'" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }" title="{{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.reportFilters) ? $ctrl.core.viewModel.addFilterLabel : \'\'}}" drop="$ctrl.core.dropZoneDropConfig" drop-handler="$ctrl.core.appendReportFilters(event, ui, dropAction)" drop-action="$ctrl.core.getDropAction(dropPosition)"> {{$ctrl.core.shouldShowAddFilterLabelText($ctrl.core.viewModel.reportFilters) ? $ctrl.core.viewModel.addFilterLabel : \'\'}}</div></div></div> <button ng-if="$ctrl.core.showEditVariablesLink()" class="editVariablesButton trimmedTextWithEllipsis" ng-style="{ \'font-family\': $ctrl.core.headerFontFamily, \'font-size\': $ctrl.core.headerFontSize }" ng-click="$ctrl.core.editVariablesOnClick()" localize="EditVariables_OutspacePane" localize-tooltip="EditVariables_OutspacePane_Tooltip"></button><div id="paneApplyAll" ng-if="$ctrl.core.isInOutspacePane && $ctrl.core.isApplyAllEnabled"> <button id="buttonApplyAll" ng-click="$ctrl.core.onApplyAllClicked()" ng-keyup="$event.keyCode == 13 && $ctrl.core.onApplyAllClicked()" ng-disabled="!$ctrl.core.applyAllHasFiltersToApply()" ng-class="{\'errorState\': $ctrl.core.isApplyAllButtonInErrorState}" localize="FilterPane_ApplyAll" localize-tooltip="FilterPane_ApplyAll" tabindex="0"></button></div></section>'),e.put("components/filterVisual/filterVisual.html",'<div class="filterVisual"><visual ng-if="$ctrl.core.dataLoaded && !$ctrl.modernVisual" view-model="$ctrl.core.viewModel.readOnlyState.visual" current-zone="$ctrl.core.currentZone"></visual><visual-modern ng-if="$ctrl.core.dataLoaded && $ctrl.modernVisual" [view-model]="$ctrl.core.viewModel.readOnlyState.visual" [current-zone]="$ctrl.core.currentZone"></visual-modern><div class="filterSpinner" ng-if="$ctrl.core.viewModel.isLoading && !$ctrl.core.dataLoaded"><spinner></spinner><span class="message" localize="FilterCard_Loading"/></div><div class="filterError" ng-if="$ctrl.core.hasQueryError"><i class="icon filterPaneIcon error"><svg-use-symbol sheet="filterPaneIcons" symbol-id="fieldListError"></svg-use-symbol></i><span class="message" localize="FilterCard_ErrorMessage"/></div> <button class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-if="$ctrl.core.isApplyButtonVisible()" ng-disabled="!$ctrl.core.isApplyButtonEnabled()" ng-click="$ctrl.core.onApplyButtonClicked()"/></div><div class="cardFooter" ng-if="$ctrl.core.isFooterVisible()" ng-style="{ \'border-color\': $ctrl.core.viewModel.borderColor }"><pbi-context class="required flex vertiPad" context="compact"><pbi-checkbox ng-change="$ctrl.core.updateRequiredState()" label="PageFilter_SingleSelectionRequired" aria-label="{{::$ctrl.core.requireSingleSelectLabel}}" ng-disabled="$ctrl.core.viewModel.isSingleSelectDisabled()" ng-model="$ctrl.core.viewModel.isSingleSelectionRequired" localize-tooltip="PageFilter_SingleSelectionRequired_Tooltip"></pbi-checkbox></pbi-context></div>'),e.put("components/includeExcludeFilter/includeExcludeFilter.html",'<div class="include-exclude-filter-items"><ng-scrollbars ng-scrollbars-config="::$ctrl.core.scrollbarsConfig"><ul role="listbox"><li class="include-exclude-filter-item flex" ng-repeat="dataPoint in $ctrl.core.viewModel.points"><div class="caption smallFontSize trimmedTextWithEllipsis unselectable item-fill" tabindex="0" role="option" aria-setsize="{{$ctrl.core.viewModel.points.length}}" aria-posinset="{{$index+1}}" aria-selected="true" aria-label="{{dataPoint.text}}" ng-bind="dataPoint.text" ng-style="{\'font-size\': $ctrl.core.filterViewModel.fontSize}"></div> <button ng-if="!$ctrl.core.filterViewModel.isFilterLocked()" type="button" class="delete glyphicon pbi-glyph-close glyph-micro" localize-tooltip="Delete" ng-click="$ctrl.core.delete($event, $index)"></button></li></ul></ng-scrollbars></div>'),e.put("components/inlineExploreVisualTypesContainer/inlineExploreVisualTypesContainer.html",'<div pbi-lazy-load-contents="$ctrl.exploreUIShellConfig"><visual-types-container disable-context-menu="true"/></div>'),e.put("components/relativeFilter/relativeDateFilter/relativeDateFilter.html",'<form name="$ctrl.filterForm" class="relativeDateFilter" ng-submit="$ctrl.core.applyFilter()" ng-class="{ invalid: $ctrl.core.viewModel.cardType.invalid }" ng-style="{ \'font-size\': $ctrl.core.viewModel.fontSize }"><h3 class="description" tabindex="0" localize="RelativeDateFilter_ShowItems" localize-tooltip="RelativeDateFilter_ShowItems"></h3><div class="relativeDateFilterSettings"><jq-select classes="filterInput" ng-model="$ctrl.core.vm.relativeQualifier" ng-style="{ \'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                         \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                         \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor }" ng-change="$ctrl.core.vm.onRelativeQualifierChanged()" options="$ctrl.core.vm.relativeQualifiers" expression="qualifier.text for qualifier in options track by qualifier.value"></jq-select> <input class="filterInput" type="number" ng-if="$ctrl.core.vm.isDurationApplicable()" ng-model="$ctrl.core.vm.duration" ng-style="{ \'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                         \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                         \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor }" title="{{\'1-\'+$ctrl.core.vm.getDurationMax()}}" ng-min="1" ng-max="$ctrl.core.vm.getDurationMax()" placeholder="{{$ctrl.core.viewModel.getInputPlaceholder()}}"/><jq-select classes="filterInput" ng-if="$ctrl.core.vm.isDurationApplicable()" ng-model="$ctrl.core.vm.relativeUnit" ng-style="{ \'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                         \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                         \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor }" options="$ctrl.core.vm.relativeUnitsAll" expression="unit.text for unit in options track by unit.value"></jq-select><jq-select classes="filterInput" ng-if="!$ctrl.core.vm.isDurationApplicable()" ng-model="$ctrl.core.vm.relativeUnit" ng-style="{ \'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                         \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                         \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor }" options="$ctrl.core.vm.relativeUnitsCurrent" expression="unit.text for unit in options track by unit.value"></jq-select><div class="footerSection" ng-if="$ctrl.core.vm.isIncludeTodayApplicable()"><pbi-context context="{{$ctrl.core.viewModel.isInOutspacePane ? \'\' : \'compact\'}}"><pbi-checkbox label="RelativeDateFilter_IncludeToday" aria-label="{{::$ctrl.core.includeTodayLabel}}" ng-model="$ctrl.core.vm.includeToday" localize-tooltip="RelativeDateFilter_IncludeToday"></pbi-checkbox></pbi-context></div></div> <button type="submit" class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.core.canApplyFilter()"/></form>'),e.put("components/singleVisualHost/singleVisualHost.html",'<div class="visualSite"><visual ng-if="!$ctrl.modernVisual" view-model="$ctrl.visualDefinition" allow-deferred-rendering="true"></visual><visual-modern ng-if="$ctrl.modernVisual" [view-model]="$ctrl.visualDefinition" [allow-deferred-rendering]="true"></visual-modern></div>'),e.put("components/taskPane/taskPane.html",'<article modeling-context-changer><div class="paneHeader"> <button class="btn toggleBtn" aria-expanded="{{!!$ctrl.viewModel.isPaneExpanded}}" ng-class="{ isCollapsed: !$ctrl.viewModel.isPaneExpanded }" ng-click="$ctrl.toggleTaskPane()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><h2 class="sidePaneHorizontalTitle sidePaneTitle unselectable fieldsTab largeFontSize trimmedTextWithEllipsis" ng-if="$ctrl.viewModel.isPaneExpanded" localize="TaskPane_Fields"></h2><div class="verticalTitle"><h2 class="largeFontSize" localize="TaskPane_Fields"></h2></div></button></div><div class="paneContents" ng-if="$ctrl.viewModel.isPaneExpanded" pbi-lazy-load-contents="$ctrl.exploreUIShellConfig"><field-list field-list-config="::$ctrl.fieldListConfig"></field-list></div></article>'),
e.put("components/topNFilter/topNFilter.html",'<form name="$ctrl.filterForm" class="topNFilter" ng-submit="$ctrl.core.applyFilter()" ng-class="{ invalid: $ctrl.core.viewModel.cardType.invalid }" ng-style="{ \'font-size\': $ctrl.core.viewModel.fontSize }"><pbi-alert ng-if="$ctrl.core.viewModel.cardType.invalid" kind="\'warning\'" message-warning="\'TopNFilter_SingleTopNAllowedWarning\'"></pbi-alert><fieldset class="filterOptions" ng-disabled="$ctrl.core.viewModel.cardType.invalid"><legend localize="TopNFilter_ShowItems"></legend><div class="topNSelector topNInputArea flex"><jq-select ng-if="$ctrl.core.vm.targetType" ng-style="{\'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                                \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                                \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor}" classes="item-fill topNInputBox" options="$ctrl.core.vm.filterTypes" expression="filterType.text for filterType in options track by filterType.text" ng-model="$ctrl.core.vm.targetType"></jq-select> <input class="item-fill topNInputBox topNNumber" ng-style="{\'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                            \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                            \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor}" aria-label="{{::$ctrl.core.topNEditAriaLabel}}" aria-valuemin="{{::$ctrl.core.topNMinValue}}" aria-valuemax="{{::$ctrl.core.topNMaxValue}}" type="number" fast-keyup="$ctrl.core.onKeyUp($event)" ng-pattern="/^[1-9][0-9]{0,6}$/" ng-model="$ctrl.core.vm.itemCount" placeholder="{{$ctrl.core.viewModel.getInputPlaceholder()}}"/></div></fieldset><fieldset class="orderBy" ng-disabled="$ctrl.core.viewModel.cardType.invalid"><legend localize="TopNFilter_Value"></legend><div class="topNInputArea ui-droppable dropzone topNInputBox" ng-class="{filled: $ctrl.core.vm.orderByDisplayName}" ng-style="{\'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                        \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                        \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor}" drop="$ctrl.core.dropConfig" drop-handler="$ctrl.core.dropFilterTarget()" drop-action="$ctrl.core.getDropAction()"><div class="flex orderByPill" ng-style="{\'background-color\': $ctrl.core.viewModel.inputBoxBackgroundColor,                            \'color\': $ctrl.core.viewModel.inputBoxForegroundColor,                            \'border-color\': $ctrl.core.viewModel.inputBoxBorderColor}" ng-if="$ctrl.core.vm.orderByDisplayName"><span tabindex="0" class="displayName trimmedTextWithEllipsis item-fill" ng-bind="$ctrl.core.vm.orderByDisplayName"></span> <button ng-if="$ctrl.core.vm.availableAggregates.items.length > 0" class="fieldWellIcon dropDown item-auto glyphicon pbi-glyph-chevrondownsmall glyph-mini" type="button" ng-click="$ctrl.core.showContextMenu($event)"></button> <button ng-click="$ctrl.core.removeOrderBy()" localize-tooltip="FieldWell_Remove" class="delete glyphicon pbi-glyph-close glyph-micro item-auto" type="button"></button></div><div class="dragHereWatermark trimmedTextWithEllipsis" localize="FieldDropZone_AddFields" ng-if="!$ctrl.core.vm.orderByDisplayName"></div></div></fieldset> <button type="submit" class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-if="!$ctrl.core.isApplyAllButtonEnabled()" ng-disabled="!$ctrl.core.canApplyFilter()"/></form>'),e.put("components/visualContainer/visualContainer.html",'<transform [position]="$ctrl.core.viewModel.readOnlyState.position" [transform-options]="$ctrl.core.transformOptions" [restrict-draw]="$ctrl.core.shouldRestrictTransformDraw()" [attach-handlers]="!$ctrl.core.isInViewMode() && $ctrl.core.isDraggable" (position-change)="$ctrl.core.onPositionChanged()" drag-resize-disabled="{{$ctrl.core.viewModel.disableResize || $ctrl.core.services.viewModeState.getMode() === 0 || $ctrl.core.hasPositionOverride() || $ctrl.core.isLockObjects()}}" ng-click="$ctrl.core.toggleSelect($event, false)" double-click="$ctrl.core.onDoubleClick()" fast-touchend="$ctrl.core.onTouchend($event)" ng-class="{\'popOut\': $ctrl.core.viewModel.isPoppedOut, \'selected\': $ctrl.core.viewModel.isSelected}" preserve-aspect-ratio="{{$ctrl.core.viewModel.lockAspectRatio}}" class="visualContainerTransform"><div class="visualContainer unselectable" tab-order="{{$ctrl.core.viewModel.position.tabOrder}}" ng-attr-tabindex="{{$ctrl.core.getVisualContainerTabindex()}}" skip-children-focus drop="$ctrl.core.dropConfig" drop-handler="$ctrl.core.drop(event, ui)" ng-keydown="$ctrl.core.onKeydown($event)" ng-class="$ctrl.core.computeStyle()" toolbar-anchor tooltip tooltip-config="$ctrl.core.getVisualContainerTooltipConfig()" ng-attr-aria-label="{{$ctrl.core.getVisualContainerAriaLabel()}}" touch-action="{{$ctrl.core.getTouchActionState()}}" fast-focus="$ctrl.core.toggleSelect($event, true)"><div class="visualContainerBorder" ng-class="{themableBorderColor: !$ctrl.core.viewModel.isSelected}"></div><div class="visualContainerScreen"></div><spinner [size]="\'xsmall\'" [delay]="1000" localize-tooltip="Visual_Loading_AlertText" ng-if="$ctrl.core.viewModel.showProgressBar"></spinner><visual-container-header visual="$ctrl.core.viewModel" menu-options="$ctrl.core.menuOptions" disable-pin="$ctrl.core.disablePin" options-menu-factory="$ctrl.core.optionsMenuFactory" show-warning-details="$ctrl.core.errorManager.showWarningDetails()" show-transform-warning-details="$ctrl.core.errorManager.showTransformWarningDetails()" show-info-details="$ctrl.core.errorManager.showInfoDetails()" on-visual-container-changed="$ctrl.core.onVisualContainerChangedAsync()" on-header-destroy="$ctrl.core.onHeaderDestroy()" on-header-resize="$ctrl.core.onHeaderResize($width, $height)" on-visual-container-refresh="$ctrl.core.onVisualContainerRefresh()" on-show-tooltip="$ctrl.core.onShowHeaderTooltip(args, data)" on-hide-tooltip="$ctrl.core.onHideHeaderTooltip(args)" ng-if="$ctrl.core.isHeaderVisible()"></visual-container-header><i class="removeFromLayout itemIcon glyphicon pbi-glyph-close glyph-mini themableColor" ng-click="$ctrl.core.removeVisualFromLayout()" ng-if="$ctrl.core.canRemoveFromLayout()"></i><visual-container-pop-out-bar ng-if="$ctrl.core.isPopOutBarVisible()" [view-model]="$ctrl.core.viewModel" (on-close-pop-out)="$ctrl.core.onClosePopOut($event)"></visual-container-pop-out-bar><div class="vcBody themableBackgroundColor themableBorderColorSolid " ng-if="!$ctrl.core.viewModel.showWatermark" apply-style="::$ctrl.core.viewModel.readOnlyState.visualViewportStyle" ng-right-click="$ctrl.core.onRightClick($event)"><div class="visualTitle themableBackgroundColor themableColor" ng-if="$ctrl.core.viewModel.visualTitleVisible()" title="{{$ctrl.core.viewModel.visualTitle.text}}" apply-style="::$ctrl.core.viewModel.readOnlyState.titleStyle"><div ng-class="{ preTextWithEllipsis: $last }" ng-repeat="titleLine in $ctrl.core.viewModel.visualTitleWrapped" apply-style="titleLine.style">{{titleLine.text}}</div></div><visual aria-hidden="true" ng-if="!$ctrl.core.viewModel.supportsKeyboardNavigation() && !$ctrl.core.viewModel.isAnalysisVisual() && !$ctrl.core.viewModel.isQnaVisual()" view-model="$ctrl.core.viewModel.visual" ng-show="!$ctrl.core.isVisualHidden()" allow-deferred-rendering="::$ctrl.core.viewModel.allowDeferredRendering" current-zone="$ctrl.currentZone" visual-ready="$ctrl.core.onVisualReady()"></visual><visual keyboard-shortcuts="ctrl-ArrowRight scoped" focus-nav-mode="Group" ng-if="$ctrl.core.viewModel.supportsKeyboardNavigation() && !$ctrl.core.viewModel.isAnalysisVisual() && !$ctrl.core.viewModel.isQnaVisual()" view-model="$ctrl.core.viewModel.visual" ng-show="!$ctrl.core.isVisualHidden()" allow-deferred-rendering="::$ctrl.core.viewModel.allowDeferredRendering" current-zone="$ctrl.currentZone" visual-ready="$ctrl.core.onVisualReady()"></visual><detail-visual ng-if="$ctrl.core.viewModel.hasDetailVisual()" view-model="$ctrl.core.viewModel.readOnlyState.detailVisual"></detail-visual><analysis-visual-host-lazy ng-if="$ctrl.core.viewModel.isAnalysisVisual() && !$ctrl.core.viewModel.errorInfo" [visual-definition]="$ctrl.core.viewModel.visual" [visual-container]="$ctrl.core.viewModel.contract" ng-show="!$ctrl.core.isVisualHidden()" focus-nav-mode="Group" keyboard-shortcuts="ctrl-ArrowRight scoped" visual-ready="$ctrl.core.onVisualReady()"></analysis-visual-host-lazy><qna-visual-host-lazy ng-if="$ctrl.core.viewModel.isQnaVisual() && !$ctrl.core.viewModel.errorInfo" [visual-definition]="$ctrl.core.viewModel.visual" [visual-container]="$ctrl.core.viewModel.contract" ng-show="!$ctrl.core.isVisualHidden()" focus-nav-mode="Group" keyboard-shortcuts="ctrl-ArrowRight scoped" visual-ready="$ctrl.core.onVisualReady()"></qna-visual-host-lazy><canvas-visual-error-overlay ng-if="$ctrl.core.viewModel.errorInfo" [error-info]="$ctrl.core.viewModel.errorInfo" [view-mode]="$ctrl.core.services.viewModeState.getMode()" [viewport]="$ctrl.core.viewModel.position" (show-error-details)="$ctrl.core.errorManager.showErrorDetails()" (fix-errors)="$ctrl.core.errorManager.fixErrors()"></canvas-visual-error-overlay></div><div class="vcBody" ng-if="$ctrl.core.viewModel.showWatermark" apply-style="::$ctrl.core.viewModel.readOnlyState.visualViewportStyle" ng-class="vcBodyStyle" ng-attr-title="{{vcBodyTitle}}"><visual-watermark [visual-type]="$ctrl.core.viewModel.contract.config.singleVisual.visualType"></visual-watermark></div><div class="vcFooter" ng-if="$ctrl.core.viewModel.isFooterVisible()" apply-style="::$ctrl.core.viewModel.readOnlyState.footerStyle"> <button class="applyButton" localize="Apply" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.core.isApplyButtonEnabled()" ng-if="$ctrl.core.isApplyButtonVisible()" fast-click="$ctrl.core.onApplyButtonClicked()"/></div></div></transform>'),e.put("components/visualContainerHeader/visualContainerHeader.html",'<visual-container-header-modern [visual]="$ctrl.visual" [menu-options]="$ctrl.menuOptions" [disable-pin]="$ctrl.disablePin" [options-menu-factory]="$ctrl.optionsMenuFactory" (show-warning-details)="$ctrl.showWarningDetails()" (show-transform-warning-details)="$ctrl.showTransformWarningDetails()" (show-info-details)="$ctrl.showInfoDetails()" (on-visual-container-changed)="$ctrl.onVisualContainerChangedAsync()" (on-header-destroy)="$ctrl.onHeaderDestroy()" (on-header-resize)="$ctrl.onHeaderResize($event)" (on-visual-container-refresh)="$ctrl.onVisualContainerRefresh()" (on-show-tooltip)="$ctrl.onShowTooltip($event)" (on-hide-tooltip)="$ctrl.onHideTooltip($event)"></visual-container-header-modern>'),e.put("components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",'<visual-header-item-container [dynamic-style]="$ctrl.visual.readOnlyState.headerItemContainerStyle" ng-if="$ctrl.supportsVisualRelationshipFilterAction(1)"><button class="glyphicon glyph-small alwaysVisible" ng-class="{ \'pbi-glyph-crossfilterfilled\': $ctrl.filterAction === 1,  \'pbi-glyph-crossfilter\': $ctrl.filterAction !== 1}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 1)" aria-label="{{::$ctrl.filterTitle}}" tooltip tooltip-config="::$ctrl.filterTooltipConfig" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container><visual-header-item-container [dynamic-style]="$ctrl.visual.readOnlyState.headerItemContainerStyle" ng-if="$ctrl.supportsVisualRelationshipFilterAction(2)"><button class="glyphicon glyph-small alwaysVisible" ng-class="{ \'pbi-glyph-crosshighlightfilled\': $ctrl.filterAction === 2,  \'pbi-glyph-crosshighlight\': $ctrl.filterAction !== 2}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 2)" aria-label="{{::$ctrl.highlightTitle}}" tooltip tooltip-config="::$ctrl.highlightTooltipConfig" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container><visual-header-item-container [dynamic-style]="$ctrl.visual.readOnlyState.headerItemContainerStyle" ng-if="$ctrl.supportsVisualRelationshipFilterAction(3)"><button class="glyphicon glyph-small alwaysVisible" ng-class="{ \'pbi-glyph-disablefilled\': $ctrl.filterAction === 3, \'pbi-glyph-disable\': $ctrl.filterAction !== 3}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 3)" aria-label="{{::$ctrl.noneTitle}}" tooltip tooltip-config="::$ctrl.noneTooltipConfig" apply-style="::$ctrl.visual.readOnlyState.headerForegroundStyle"></button></visual-header-item-container>'),e.put("components/visualizationPane/visualizationPane.html",'<article modeling-context-changer><div class="paneHeader"> <button class="btn toggleBtn" aria-label="{{viewModel.header}}" aria-expanded="{{!!viewModel.isPaneExpanded}}" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggle()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><div class="sidePaneHorizontalTitle unselectable sidePaneTitle largeFontSize trimmedTextWithEllipsis" ng-bind="viewModel.header" ng-show="viewModel.isPaneExpanded"></div><div class="verticalTitle verticalText" ng-show="!viewModel.isPaneExpanded"><span class="collapsedVisualsTitle largeFontSize" ng-bind="viewModel.header" ng-show="populatePanes"></span><span class="collapsedFiltersTitle largeFontSize" localize="VisualizationPane_Filters" ng-if="showFieldWellOrFilters && showFilterPane()"></span></div></button></div><div class="paneContents flex" ng-if="viewModel.isPaneExpanded"><section ng-if="showVisualTypes" class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig"><visual-types-container visual-plugin-filter="viewModel.visualPluginFilter"></visual-types-container></section><section ng-if="showVisualTypes && showNonPersonalVisualizationPane()" class="lazy-load-wrapper nonPersonalVisualizationPane" pbi-lazy-load-contents="exploreUIShellConfig"><spinner ng-if="!personalVisualizationPanePrepared"></spinner><visual-types-container ng-if="personalVisualizationPanePrepared" visual-plugin-filter="viewModel.nonPersonalVisualizationPaneFilter" disable-more-options-icon="true"></visual-types-container></section><nav class="sectionHeader item-auto pivotNav visualizationPane" ng-if="viewModel.sections.length && !isNonQueryVisual && populatePanes"><ul role="tablist"><li role="tab" section-tab-key-handler tooltip section-length="viewModel.sections.length" current-section="section.sectionType" set-active-section-function="setActiveSection(nextSection)" aria-controls="section-{{section.sectionType}}" aria-label="{{::section.displayName}}" tabindex="{{section.sectionType === viewModel.activeSection ? 0 : -1}}" aria-posinset="{{$index+1}}" aria-setsize="{{viewModel.sections.length}}" aria-selected="{{section.sectionType === viewModel.activeSection}}" ng-repeat="section in viewModel.sections" ng-mouseover="toggleEffectClasses(section.cssClass, true, true)" ng-mouseleave="toggleEffectClasses(section.cssClass, false, true)" ng-focus="toggleEffectClasses(section.cssClass, true, false)" ng-blur="toggleEffectClasses(section.cssClass, false, false)" accessible-click="setActiveSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activeSection}"><svg-use-symbol class="sectionIcon" [sheet]="::sectionIconSheetName" [symbol-id]="getSectionIconSymbolId(section.cssClass)"></svg-use-symbol></li></ul><div class="navMarker visualizationPane"></div></nav><nav class="sectionHeader item-auto pivotNav visualizationPane" ng-if="viewModel.pagePaneSections.length && populatePanes"><ul role="tablist"><li role="tab" tooltip section-tab-key-handler section-length="viewModel.pagePaneSections.length" current-section="section.sectionType" set-active-section-function="setActivePagePaneSection(nextSection)" aria-controls="section-{{section.sectionType}}" aria-label="{{::section.displayName}}" tabindex="{{section.sectionType === viewModel.activePageSection ? 0 : -1}}" aria-posinset="{{$index+1}}" aria-setsize="{{viewModel.pagePaneSections.length}}" aria-selected="{{section.sectionType === viewModel.activePageSection}}" ng-keydown="onSectionKeyDown($event, section.sectionType, true)" ng-repeat="section in viewModel.pagePaneSections" ng-mouseover="toggleEffectClasses(section.cssClass, true, true)" ng-mouseleave="toggleEffectClasses(section.cssClass, false, true)" ng-focus="toggleEffectClasses(section.cssClass, true, false)" ng-blur="toggleEffectClasses(section.cssClass, false, false)" ng-click="setActivePagePaneSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activePageSection}"><svg-use-symbol class="sectionIcon" [sheet]="::sectionIconSheetName" [symbol-id]="getSectionIconSymbolId(section.cssClass)"></svg-use-symbol></li></ul><div class="navMarker visualizationPane"></div></nav><div class="sectionHost item-fill" id="section-0" role="tabpanel" ng-if="showFieldWellOrFilters" section-animation-slider view-model="viewModel" nav-marker-parent="visualizationPane" ng-class="{\'readOnly\' : !populatePanes}"><ng-scrollbars ng-scrollbars-config="::scrollbarsConfig"><section ng-if="showFieldWell" class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig"><field-well></field-well></section><h3 class="sectionHeader" ng-if="(showFieldWell || showVisualTypes) && showFilterPane()"><span class="sectionTitle sidePaneTitle unselectable largeFontSize" localize="VisualizationPane_Filters"></span> <button ng-if="useNewFilterPane && viewModeState.getMode() === 1" class="enableFilterPane glyphicon glyph-mini" ng-class="{\'pbi-glyph-view\':isOutspacePaneVisible, \'pbi-glyph-hide3\':!isOutspacePaneVisible}" ng-click="toggleOutspacePaneVisibility()" localize-tooltip="{{isOutspacePaneVisible ? \'FilterPane_HidePane\' : \'FilterPane_ShowPane\'}}" dynamic-tooltip-update></button></h3><filter-pane ng-if="showFilterPane() && !useModernFilterPane"></filter-pane><filter-pane-modern ng-if="showFilterPane() && useModernFilterPane"></filter-pane-modern><section class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig" ng-if="showDrillthroughPane"><drillthrough-pane></drillthrough-pane></section></ng-scrollbars></div><section ng-if="showPropertyPane" focus-nav-mode="Browser" id="section-1" role="tabpanel" section-animation-slider view-model="viewModel" nav-marker-parent="visualizationPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><property-pane role="application"></property-pane></section><section ng-if="showPagePropertyPane" focus-nav-mode="Browser" id="section-1" role="tabpanel" section-animation-slider view-model="viewModel" nav-marker-parent="visualizationPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><page-property-pane></page-property-pane></section><section ng-if="showAnalyticsPane" focus-nav-mode="Browser" id="section-2" role="tabpanel" section-animation-slider view-model="viewModel" nav-marker-parent="visualizationPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><analytics-pane class="propertyPaneContents"></analytics-pane></section></div></article>'),e.put("components/visualTooltip/visualTooltip.html",'<div class="visual-tooltip-container"><canvas-tooltip ng-if="::$ctrl.explorationContract" ng-show="$ctrl.showCanvasSection()" [tooltip-data-sources]="$ctrl.tooltipDataSources" [exploration-contract]="$ctrl.explorationContract" [exploration-capabilities]="$ctrl.explorationCapabilities" [identities]="$ctrl.identities" [filter-context]="$ctrl.filterContext" [section-name]="$ctrl.sectionName" [show-canvas-mask]="$ctrl.isLoading" [section-display-option]="$ctrl.sectionDisplayOption" (on-canvas-ready)="$ctrl.onCanvasReady()" (on-canvas-busy)="$ctrl.onCanvasBusy()"></canvas-tooltip><div ng-show="$ctrl.showDefaultSection()" class="data-item-tooltip-container"></div><tooltip-actions ng-if="$ctrl.showActionBar" (on-hide)="::$ctrl.onHide()" [tooltip-shown]="$ctrl.tooltipShown" [actions-provider]="$ctrl.actionsProvider" (show-child-menu)="::$ctrl.showChildMenu($event.show)" [identities]="$ctrl.identities"></tooltip-actions><div ng-if="$ctrl.showLoadingSection()" class="loading-message-container"><div class="loading-message"><spinner></spinner><span localize="Visual_Tooltip_Loading_Message"></span></div></div></div>'),e.put("views/canvasVisualHeaderIcon.html",'<button tooltip tooltip-config="$ctrl.tooltipConfigManager.getTooltipConfig()" ng-disabled="!$ctrl.isClickable()" ng-switch="$ctrl.iconType"><i class="infoIcon glyphicon {{$ctrl.useStylableHeader() ? \'pbi-glyph-info-nocircle\' : \'pbi-glyph-info\'}}" ng-switch-when="info"></i><i class="warningIcon pbi-glyph-warning glyphicon" ng-switch-when="warning"></i><i class="errorIcon pbi-glyph-error glyphicon" ng-switch-when="error"></i></button>'),e.put("views/deleteVisualWarningDialog.html",'<div><div class="warningMessage"> {{::deleteVisualWarningText}}</div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="deleteVisual()">{{::deleteVisualButtonText}}</button> <button class="btn button" ng-click="closeDialog()" localize="DeleteVisual_Cancel"></button></div></div>'),e.put("views/dropdowns/exploreModeVisualTypesOverlay.html",'<dropdown-overlay dropdown-overlay-name="exploreModeVisualTypesOverlay" focus-nav-mode="Group"><visual-types-container class="exploreVisualTypesContainer"></visual-types-container></dropdown-overlay>'),e.put("views/dropdowns/visualContainerExploreModeFieldListOverlay.html",'<dropdown-overlay dropdown-overlay-name="visualContainerExploreModeFieldListOverlay" focus-nav-mode="Group"><div class="exploreModeFieldList fieldListContainer explorationContainer"><field-list field-list-config="fieldListConfig" on-property-clicked="onSourceSelected(property, expr)"></field-list></div></dropdown-overlay>'),e.put("views/dropdowns/visualContainerExploreModeOverlay.html",'<dropdown-overlay dropdown-overlay-name="visualContainerExploreModeOverlay" focus-nav-mode="Group"><explore-mode [visual]="visual"></explore-mode></dropdown-overlay>'),e.put("views/dropdowns/visualContainerFilterRestatementOverlay.html",'<dropdown-overlay dropdown-overlay-name="visualContainerFilterRestatementOverlay" focus-nav-mode="Group"><filter-restatement [visual]="visual"></filter-restatement></dropdown-overlay>'),e.put("views/esriConsentDialog.html",'<div><div class="esriDialogTitle"><div class="EsriConsentDialog_Esri" localize="EsriConsentDialog_Esri"></div><div class="EsriConsentDialog_WelcomeTo" localize="EsriConsentDialog_WelcomeTo"></div><div class="EsriConsentDialog_ArcGISMaps" localize="ArcGISMapsForPowerBI"></div></div><div class="esriDialogBody"><div class="EsriConsentDialog_GetMore" localize="EsriConsentDialog_GetMore"></div><div class="EsriConsentDialog_ByClicking" ng-bind-html="::byClickingText"></div><div class="EsriConsentDialog_LearnMore"><a ng-href="{{::learnMoreLink}}" target="_blank" localize="EsriConsentDialog_LearnMore"></a></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="acceptTermsOfService()" localize="EsriConsentDialog_OK"></button> <button class="btn button" ng-click="rejectTermsOfService()" localize="EsriConsentDialog_Cancel"></button></div></div></div>'),e.put("views/inputFields/propertyPaneTextBox.html",'<form name="inputForm" novalidate> <input type="{{::inputType}}" class="inputFieldInSlice" pbi-validate="validators" autocomplete="off" ng-change="onChange()" ng-model="sliceValue" ng-model-options="{ debounce: 400 }" tooltip tooltip-config="getErrorMessage()" placeholder="{{::placeholder}}" maxlength="{{::maxLength}}" name="inputField" ng-keydown="onKeydown($event)" aria-labelledby="{{labelId}}" ng-disabled="isDisabled"/></form>'),e.put("views/jqSelect.html",'<select class="{{ classes }}" ng-options="{{ expression }}" aria-label="{{ label }}"></select>'),e.put("views/virtualList.html",'<div class="virtual-list-container"><ng-scrollbars class="virtual-list" ng-scrollbars-config="::scrollbarsConfig"><ng-transclude></ng-transclude></ng-scrollbars></div>')}]);var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.ExploreModeFieldList={templateUrl:"components/exploreModeFieldList/exploreModeFieldList.html",bindings:{fieldListConfig:"<"},controller:e.common.createController(e.explore.controllers.ExploreModeFieldListController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.ExploreModeFieldWell={controller:e.common.createController(e.explore.controllers.ExploreModeFieldWellController),templateUrl:"components/exploreModeFieldWell/exploreModeFieldWell.html"}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.data.RelativeDateRangeHelper,r=e.data.RelativeDateQualifier,o=(function(){function e(e,i,r,o){this.relativeFilterViewModelComponent=t.RelativeFilterViewModelUtil.createRelativeFilterViewModelComponent(o),r||(r=this.relativeFilterViewModelComponent.getDefaultOptions()),this.dateField=e,this.duration=r.duration,this.anchorDate=r.anchorDate,this.localizationService=i,this.includeToday=t.RelativeFilterViewModelUtil.calculateIncludeToday(o,r.includeToday),this.populateRelativeQualifiers(r.relativeQualifier),this.populateRelativeUnits(r.relativeUnit)}return e.prototype.populateRelativeQualifiers=function(e){this.relativeQualifiers=[{value:r.Last,text:this.localizationService.get("RelativeDateQualifier_Last")},{value:r.Current,text:this.localizationService.get("RelativeDateQualifier_Current")},{value:r.Next,text:this.localizationService.get("RelativeDateQualifier_Next")}],this.relativeQualifier=_.find(this.relativeQualifiers,(function(t){return t.value===e}))},e.prototype.populateRelativeUnits=function(e){this.relativeUnitsAll=this.relativeFilterViewModelComponent.getRelativeUnitsAll(this.localizationService),this.relativeUnitsCurrent=this.relativeFilterViewModelComponent.getCurrentRelativeUnits(this.localizationService),this.relativeUnit=_.find(this.relativeUnitsAll,(function(t){return t.value===e}))},e.prototype.isDurationApplicable=function(){return this.relativeQualifier.value!==r.Current},e.prototype.isIncludeTodayApplicable=function(){return this.relativeFilterViewModelComponent.isIncludeTodayApplicable(this.relativeQualifier,this.relativeUnit)},e.prototype.onRelativeQualifierChanged=function(){var e=this.relativeFilterViewModelComponent.onRelativeQualifierChanged(this.relativeQualifier,this.relativeUnit,this.relativeUnitsAll);e&&(this.relativeUnit=e)},e.prototype.getDurationMax=function(){return i.getDurationMax(this.relativeQualifier.value,this.relativeUnit.value)},e.prototype.getRestatement=function(e,t){var r=this,o=this.getRelativeDateRangeOptions(),n=function(e,t){return r.localizationService.format(e,t)};return i.getRestatement(o,e,n,t)},e.prototype.getRelativeDateRangeOptions=function(){return{duration:this.duration,includeToday:this.includeToday,relativeUnit:this.relativeUnit.value,relativeQualifier:this.relativeQualifier.value,anchorDate:this.anchorDate}},e})();t.RelativeFilterViewModel=o})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.data.RelativeDateFilterPattern,r=e.data.RelativeDateQualifier,o=e.data.RelativeDateUnit,n={relativeQualifier:r.Last,duration:null,relativeUnit:o.Day,includeToday:!0},a=(function(){function e(){}return e.prototype.getDefaultOptions=function(){return n},e.prototype.getRelativeUnitsAll=function(e){return[{value:o.Day,text:e.get("RelativeDateUnit_Days")},{value:o.Week,text:e.get("RelativeDateUnit_Weeks")},{value:o.CalendarWeek,text:e.get("RelativeDateUnit_CalendarWeeks")},{value:o.Month,text:e.get("RelativeDateUnit_Months")},{value:o.CalendarMonth,text:e.get("RelativeDateUnit_CalendarMonths")},{value:o.Year,text:e.get("RelativeDateUnit_Years")},{value:o.CalendarYear,text:e.get("RelativeDateUnit_CalendarYears")}]},e.prototype.getCurrentRelativeUnits=function(e){return[{value:o.Day,text:e.get("RelativeDateUnit_Day")},{value:o.Week,text:e.get("RelativeDateUnit_Week")},{value:o.Month,text:e.get("RelativeDateUnit_Month")},{value:o.Year,text:e.get("RelativeDateUnit_Year")}]},e.prototype.isIncludeTodayApplicable=function(e,t){return e.value!==r.Current&&!i.isCalendarPeriod(t.value)},e.prototype.onRelativeQualifierChanged=function(e,t,i){if(e.value===r.Current){var n=t.value;switch(t.value){case o.CalendarWeek:n=o.Week;break;case o.CalendarMonth:n=o.Month;break;case o.CalendarYear:n=o.Year}return _.find(i,(function(e){return e.value===n}))}},e})();t.RelativeDateFilterViewModelComponent=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.data.RelativeDateQualifier,r=e.data.RelativeDateUnit,o={relativeQualifier:i.Last,duration:null,relativeUnit:r.Hour,includeToday:!0},n=(function(){function e(){}return e.prototype.getDefaultOptions=function(){return o},e.prototype.getRelativeUnitsAll=function(e){return[{value:r.Minute,text:e.get("Insights_MinutesPlural")},{value:r.Hour,text:e.get("Insights_HoursPlural")}]},e.prototype.getCurrentRelativeUnits=function(e){return[{value:r.Minute,text:e.get("Insights_MinutesSingular")},{value:r.Hour,text:e.get("Insights_HoursSingular")}]},e.prototype.isIncludeTodayApplicable=function(){return!1},e.prototype.onRelativeQualifierChanged=function(e,t,r){if(e.value===i.Current){var o=t.value;t=_.find(r,(function(e){return e.value===o}))}},e})();t.RelativeTimeFilterViewModelComponent=n})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,r=e.visuals.valueFormatter,o=e.explore.components.TopNFilterType,n=jsCommon.StringExtensions;!(function(e){function t(e,t){if(null!=t.itemCount){var i=r.format(t.itemCount,"#,###"),a=t.orderByDisplayName,s=t.targetType.type===o.Top;return a?n.format(e.get(s?"FilterRestatement_TopNBy":"FilterRestatement_BottomNBy"),i,a):n.format(e.get(s?"FilterRestatement_TopN":"FilterRestatement_BottomN"),i)}}e.getRestatement=t})(i=t.TopNFilterHelper||(t.TopNFilterHelper={}))})(t=e.data||(e.data={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.FocusManager,i=(function(){function e(e,t){var i=this;this.services=t,this.$scope=e,this.$scope.isMasterFormFactor=function(){return 0===t.formFactor.getCurrentLayout()},this.$scope.isMobileLayoutAuthoring=function(){return 0!==t.formFactor.getCurrentLayout()&&1===t.viewModeState.getMode()},this.$scope.focusVisualContainer=function(){return i.focusVisualContainer()},this.useModernExploreCanvas=t.featureSwitchService.featureSwitches.useModernExploreCanvas}return e.createOptions=function(){return{additionalServices:["$element","featureSwitchService","focus"],scopedDependencies:["formFactor","viewModeState","focusNotificator"]}},e.prototype.focusVisualContainer=function(){var e=this;this.services.timeout((function(){t.focusChildInGroup(e.services.$element.get(0))}))},e.prototype.$onInit=function(){!this.$scope.shouldSetFocus||this.$scope.canvasOptions&&this.$scope.canvasOptions.disableFocusOnExploreCanvas||(this.services.$element.attr("tabindex","0"),this.services.$element.focus()),this.services.focus.startListening()},e.prototype.$onDestroy=function(){this.services.focus.stopListening()},e})();e.ExplorationController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i=function(i){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return t.run(i,e,r)};return{getLocalizedString:function(t){
for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return i.apply(void 0,[e.getLocalizedString,t].concat(r))},requestFocus:function(t){return i(e.requestFocus,t)},onDragStart:function(t){return i(e.onDragStart,t)},getVisualLinkProperties:function(){return i(e.getVisualLinkProperties)},canSelect:function(t){return i(e.canSelect,t)},onSelecting:function(t){return i(e.onSelecting,t)},onSelect:function(t){return i(e.onSelect,t)},onSwitchFocusModeState:function(t){return i(e.onSwitchFocusModeState,t)},canExpandCollapse:function(t){return i(e.canExpandCollapse,t)},setNodeExpansionState:function(t){return i(e.setNodeExpansionState,t)},onContextMenu:function(t){return i(e.onContextMenu,t)},loadMoreData:function(){return i(e.loadMoreData)},setShouldDeferData:function(t){return i(e.setShouldDeferData,t)},persistProperties:function(t,r){return i(e.persistProperties,t,r)},onCustomSort:function(t){return i(e.onCustomSort,t)},getViewMode:function(){return i(e.getViewMode)},getEditMode:function(){return i(e.getEditMode)},setWarnings:function(t){return i(e.setWarnings,t)},setToolbar:function(t,r){return i(e.setToolbar,t,r)},shouldRetainSelection:function(){return i(e.shouldRetainSelection)},geocoder:function(){return i(e.geocoder)},geolocation:function(){return i(e.geolocation)},locale:function(){return i(e.locale)},promiseFactory:function(){return i(e.promiseFactory)},ignoreDefaultFilter:function(){return i(e.ignoreDefaultFilter)},getIdentityDisplayNames:function(t){return i(e.getIdentityDisplayNames,t)},setIdentityDisplayNames:function(t){return i(e.setIdentityDisplayNames,t)},dropdown:function(){return i(e.dropdown)},tooltips:function(){return i(e.tooltips)},telemetry:function(){return i(e.telemetry)},authenticationService:function(){return i(e.authenticationService)},localStorageService:function(){return i(e.localStorageService)},eventService:function(){return i(e.eventService)},loader:function(){return i(e.loader)},getUIComponentFactory:function(){return i(e.getUIComponentFactory)},applyJsonFilter:function(t,r,o,n){return i(e.applyJsonFilter,t,r,o,n)},launchUrl:function(t){return i(e.launchUrl,t)},instanceId:e.instanceId,refreshHostData:function(){return i(e.refreshHostData)},decompositionService:function(){return i(e.decompositionService)},getJSONFilter:function(t){return i(e.getJSONFilter,t)},visualCapabilitiesChanged:function(){return i(e.visualCapabilitiesChanged)},onHyperlinkClick:function(t,r){return i(e.onHyperlinkClick,t,r)},visualTimeSynchronization:function(){return i(e.visualTimeSynchronization)},setFilterExpressionMetadata:function(t){return i(e.setFilterExpressionMetadata,t)},getFilterExpressionMetadata:function(){return i(e.getFilterExpressionMetadata)},isVisualEnabled:function(){return i(e.isVisualEnabled)},dataMultiSelectMode:function(){return i(e.dataMultiSelectMode)}}}e.wrapHostServices=t})(t=e.VisualHostInsideZoneAdapter||(e.VisualHostInsideZoneAdapter={}))})(t=e.helpers||(e.helpers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("ExploreUI/services/clustering",["require","exports"],(function(e,t){function i(e,t,i,r,o,n,a,s,l,c,u,p,d){return{isClusteringColumn:function(e){return!1},createClusters:function(e,t,i){},editClustering:function(e,t){return null},arePartitionNameToClusterIdsMappingsEqual:function(e,t){return!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i}));var powerbi;!(function(e){function t(){var t=e,i=t.common,r=(i.contracts,t.data),o=t.explore,n=(o.constants,o.contracts,o.services),a=n.events,s=o.util,l=jsCommon.ArrayExtensions,c=e.explore.FilterUtils,u=e.explore.services.selectionUtils,p=o.SectionUtils,d=r.SQExpr,h=jsCommon.Utility,v=s.VisualContainerUtils,g=(function(){function e(e,t,i,r,o){this.sourceSection=e,this.sourceVisualContainer=t,this.targetSection=i,this.targetVisualContainer=r,this.navigationState=o}return e.prototype.toSnapshot=function(e){var t=this;if(e.getCurrentSection()===this.targetSection){var i=e.getCurrentExploration(),r=p.findSectionIndexForSection(i,this.sourceSection),o=p.findSectionIndexForSection(i,this.targetSection);return{sourceSectionIndex:r,sourceVisualIndex:_.findIndex(this.sourceSection.visualContainers,(function(e){return e===t.sourceVisualContainer})),targetSectionIndex:o,targetVisualIndex:_.findIndex(this.targetSection.visualContainers,(function(e){return e===t.targetVisualContainer}))}}},e.fromSnapshot=function(t,i){if(t){var r=i.getCurrentExploration(),o=r.sections[t.sourceSectionIndex],n=o.visualContainers[t.sourceVisualIndex],a=r.sections[t.targetSectionIndex],s=a.visualContainers[t.targetVisualIndex];return new e(o,n,a,s,0)}},e})(),f=(function(){function e(e,t,i,r,o,n,s,l,c,u){var p=this;this.conceptualSchemaProxy=e,this.visualAuthoringOperations=t,this.undoRedo=i,this.selectionService=r,this.explorationNavigationService=o,this.explorationSerializer=n,this.visibility=s,this.eventBridge=l,this.filterGenerator=c,this.visualPluginService=u,this.eventBridge.createChannelSubscriptionManager().subscribe(a.canvasChanged,(function(){return p.onSectionChanged()})).subscribe(a.visibilityChanged,(function(){return p.onPopOutModeChanged()})).subscribe(a.explorationUnloaded,(function(e,t){return p.clearContext()}))}return e.prototype.drillToDetails=function(e,i,r){var o=this;if(!_.isEmpty(e)){var n=_.head(e);if(n&&!_.isEmpty(n.metadata)){var a=v.getVisualQuery(i);if(a&&a.defn){if(_.isEmpty(n.dataMap)){if(!a.projections)return;var s=v.getDataRolesForVisual(i,this.visualPluginService),l=_(s).filter((function(e){return e.kind!==t.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value();for(var c in a.projections)if(!_.isEmpty(a.projections[c])&&_.includes(l,c))return}var u=a.defn.select().withName(_.head(n.metadata));u&&d.isAggregation(u.expr)&&this.conceptualSchemaProxy.get(r).then((function(t){var r=o.visualAuthoringOperations.drillToDetails(h.generateGuid(),t,[u.expr],e,i);r&&(o.addCrossFilters(i,o.explorationNavigationService.getCurrentSection(),r,!1,t),o.drillToDetailsCore(e,i,r))}),(function(){return _.noop}))}}}},e.prototype.generateDetailsTable=function(e,t,i,r){var o=this.mockVisualContainer(e),n=this.visualAuthoringOperations.drillToDetails(h.generateGuid(),t,i,null,o,r);if(n)return n.config.singleVisual},e.prototype.clear=function(){if(this.drillToDetailsContext){this.drillToDetailsContext.navigationState=1;var e=p.findSectionIndexForSection(this.explorationNavigationService.getCurrentExploration(),this.drillToDetailsContext.sourceSection);this.eventBridge.publishToChannel(a.switchSection,{index:e})}},e.prototype.getContext=function(){return this.drillToDetailsContext},e.prototype.setContext=function(e){this.drillToDetailsContext=e},e.prototype.clearContext=function(){this.drillToDetailsContext=null},e.prototype.hasContext=function(){return!!this.drillToDetailsContext},e.prototype.getDetailsTableTargetMeasures=function(e){var i=this.mockVisualContainer(e),r=v.getVisualQuery(i);if(r&&r.defn){var o=v.getDataRolesForVisual(i,this.visualPluginService);if(!_.isEmpty(o)){for(var n=_(o).filter((function(e){return(e.kind===t.VisualDataRoleKind.Measure||e.kind===t.VisualDataRoleKind.GroupingOrMeasure)&&0!==e.joinPredicate})).map((function(e){return e.name})).value(),a=[],s=0,l=n;s<l.length;s++){var c=l[s],u=r.projections[c];if(!_.isEmpty(u))for(var p=u.all(),h=0,g=p;h<g.length;h++){var f=g[h],y=r.defn.select().withName(f.queryRef);if(y&&d.isAggregation(y.expr))return[y.expr];y&&d.isMeasure(y.expr)&&a.push(y.expr)}}return a}}},e.prototype.mockVisualContainer=function(e){var t={name:h.generateGuid(),config:{singleVisual:e},layouts:l.createWithId(),filters:[]};return t.layouts.push({id:0,position:{x:0,y:0,width:0,height:0}}),t},e.prototype.onSectionChanged=function(){var e=this;if(this.drillToDetailsContext){this.explorationNavigationService.getCurrentSection();switch(this.drillToDetailsContext.navigationState){case 0:window.setTimeout((function(){u.selectCanvasItem(e.drillToDetailsContext.targetVisualContainer,e.selectionService),e.visibility.set(e.drillToDetailsContext.targetVisualContainer,1)}),0);break;case 1:var t=this.explorationNavigationService.getCurrentExploration(),i=p.findSectionIndexForSection(t,this.drillToDetailsContext.targetSection),r=p.findSectionIndexForSection(t,this.drillToDetailsContext.sourceSection),o=this.drillToDetailsContext.sourceVisualContainer;this.drillToDetailsContext=null,this.eventBridge.publishToChannel(a.deleteSection,{targetSectionIndex:i}),window.setTimeout((function(){p.findSectionIndexForSection(e.explorationNavigationService.getCurrentExploration(),e.explorationNavigationService.getCurrentSection())===r&&u.selectCanvasItem(o,e.selectionService),e.undoRedo.clear()}),0)}}},e.prototype.onPopOutModeChanged=function(){if(this.drillToDetailsContext){var e=this.explorationNavigationService.getCurrentSection();if(e!==this.drillToDetailsContext.sourceSection){this.visibility.get()!==this.drillToDetailsContext.targetVisualContainer&&this.clear()}}},e.prototype.drillToDetailsCore=function(e,t,i){var r=this.explorationNavigationService.getCurrentSection();if(r){var o=this.explorationSerializer.serializePage(r,1),n=this.explorationSerializer.deserializePage(o),s={name:"Drill to Details",displayName:"Drill to Details",filters:n.filters,size:n.size,visualContainers:[i],visualContainerGroups:[i],transient:!0};this.drillToDetailsContext=new g(r,t,s,i,0),this.eventBridge.publishToChannel(a.insertSection,s)}},e.prototype.addCrossFilters=function(e,t,i,r,o){var n=this.filterGenerator.getVisualContainerCrossFilters(t,e,o);if(n.dataFilters)for(var a=0,s=n.dataFilters;a<s.length;a++){var l=s[a];this.addVisualFilters(i,l,o,!1)}if(r)for(var c=0,u=n.highlightFilters;c<u.length;c++){var l=u[c];this.addVisualFilters(i,l,o,!1)}},e.prototype.addVisualFilters=function(e,t,i,r){if(t&&t.filter){var o=c.convertFilterData(t,e.filters,0);c.add(e,o)}},e})();return{create:function(e,t,i,r,o,n,a,s,l,c){return new f(e,c,r,o,n,t,a,s,l,i)},createContext:function(e,t,i,r,o){return new g(e,t,i,r,o)},snapshotToContext:g.fromSnapshot}}e.drillDetailsModuleFactory=t})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o){return new a(e,t,i,r,o)}var o=e.common.utils.IdUtility,n={updateUrl:!0,action:i.SectionNavigationAction.Unknown};i.createExplorationNavigationService=r;var a=(function(){function r(e,t,i,r,o){this.eventBridge=e,this.selection=t,this.formFactor=i,this.telemetryService=r,this.explorationActivity=o,this.history=[],o.registerExplorationNavigationService(this)}return r.prototype.registerExplorationViewModel=function(e){this.getViewModel=e},r.prototype.updateActiveSection=function(i){var r=this,o=this.getViewModel(),n=o.exploration.contract;if(i.forceUpdate||n.activeSectionIndex!==i.targetSectionIndex){var a=null==i.clearSelection||i.clearSelection,s=i.targetSectionIndex>-1&&i.targetSectionIndex<n.sections.length;this.explorationActivity.changeSection((function(e){var l=r.getCurrentSection();if(i.suppressHistory||l&&!l.transient&&r.history.push({name:l.name}),s){r.selection&&a!==!1&&!_.isEmpty(r.selection.getSelectedElements())&&r.selection.clearSelection();var c=o.exploration.sections;if(!_.isEmpty(c))for(var u=c.length-1;u>=0;--u)c[u].selected=u===i.targetSectionIndex;o.sectionStatus.currentSectionNumber=i.targetSectionIndex;var p=n.sections[i.targetSectionIndex],d=null!==i.canvasLayout&&void 0!==i.canvasLayout?i.canvasLayout:r.formFactor.getCurrentLayout();o.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(n,p,d,i.currentZone);if((null==i.clearCrossFilter||i.clearCrossFilter)&&l&&l.crossFilterSource&&(l.crossFilterSource.highlight=void 0),e&&p){var h=e.event.info;h.width=p.size.width,h.height=p.size.height,h.displayOption=p.size.displayOption}r.goto(p,{action:i.navigationAction,newReport:i.newReport})}}),(function(t){return r.telemetryService.startActivity(t,e.telemetry.EXUpdateActiveSection,i.targetSectionIndex,i.forceUpdate,i.suppressHistory,i.canvasLayout,a,!1,void 0,void 0,void 0,s&&n.sections[i.targetSectionIndex].objectId)}))}},r.prototype.updateExplorationActiveSectionIndex=function(t){var i=t.exploration,r=e.explore.SectionUtils.findSectionIndexForSectionName(i,t.section);if(!(null!=r&&i&&i.sections&&i.sections[r].transient||(i.activeSectionIndex=r,t.suppressTelemetry))){var o=i.sections[r],n=o?o.objectId:void 0,a=i.report?i.report.originalReportObjectId:void 0,s=i.report&&i.report.ownerInfo?i.report.ownerInfo.groupObjectId:void 0;this.telemetryService.logEvent(e.telemetry.ExploreHostChangeReportPage,i.reportId,t.reportGUID,r,n,t.groupObjectId,t.isReadonlyGroup,t.reportPermissions,t.scrubUserInfo,t.newReport,a,s)}},r.prototype.goto=function(e,t){if(this.updateSectionViewSession(),t=t?_.merge({},n,t):n,this.currentSection=e,this.raiseEvent(),t.updateUrl){var r={name:e.name,displayName:e.displayName,action:t.action,newReport:t.newReport};this.eventBridge.publishToChannel(i.events.sectionChanged,r)}},r.prototype.back=function(){if(!_.isEmpty(this.history)){var e=this.history.pop(),t=_.findIndex(this.exploration.sections,(function(t){return t.name===e.name}));t<0||this.updateActiveSection({targetSectionIndex:t,forceUpdate:!1,suppressHistory:!0})}},r.prototype.loadExploration=function(e,t){this.telemetryData=void 0,this.exploration=e,this.currentZone=e&&t,e&&e.sections&&e.activeSectionIndex>=0&&(this.currentSection=e.sections[e.activeSectionIndex]),this.raiseExplorationLoadedEvent(e)},r.prototype.startExplorationSession=function(e){e&&void 0===e.exid&&(e.exid=o.generateShortId(5)),this.telemetryData=e},r.prototype.updateExplorationTelemetryData=function(e){this.telemetryData||(this.telemetryData={}),_.assign(this.telemetryData,e)},r.prototype.getExplorationTelemetryData=function(){return this.telemetryData},r.prototype.getCurrentSection=function(){if(this.currentSection)return this.currentSection;var e=this.exploration;return e&&_.inRange(e.activeSectionIndex,0,e.sections.length)?e.sections[e.activeSectionIndex]:void 0},r.prototype.getSectionByName=function(e){return _.find(this.exploration.sections,(function(t){return t.name===e}))},r.prototype.getAllSections=function(){return this.exploration&&this.exploration.sections},r.prototype.getCurrentExploration=function(){return this.exploration},r.prototype.getCurrentExploreCanvas=function(){return this.getViewModel().exploration.exploreCanvas},r.prototype.showExplorationMask=function(){this.getViewModel().showMask=!0},r.prototype.hideExplorationMask=function(){this.getViewModel().showMask=!1},r.prototype.getCurrentZone=function(){return this.currentZone},r.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(i.events.canvasChanged)},r.prototype.raiseExplorationLoadedEvent=function(e){this.eventBridge.publishToChannel(i.events.explorationLoaded,e)},r.prototype.updateSectionViewSession=function(){this.telemetryData&&(this.telemetryData.exsid=o.generateShortId(5))},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){function t(e,t,i,r,n){return new o(e,t,i,r,n)}var i=e.common.constants.dsrDataReaderType,r=e.explore.util.VisualContainerUtils,o=(function(){function e(e,t,i,r,o){this.dataProxy=e,this.explorationStateManager=t,this.navigation=i,this.featureSwitchService=r,this.visualSyncService=o}return e.prototype.applyDirty=function(e,t,o){if(e){o.stopDataQueries&&this.dataProxy.stopCommunication(i);try{var n=this.explorationStateManager.apply(e,t,o);if(this.syncFilterState(n),o.clearQueryCaches){var a=this.navigation.getCurrentExploration();r.clearExplorationQueryCaches(a)}return n}finally{o.stopDataQueries&&this.dataProxy.resumeCommunication(i)}}},e.prototype.syncFilterState=function(e){if(this.featureSwitchService.featureSwitches.slicerSyncing&&e)for(var t=0,i=e.visualContainers;t<i.length;t++){var r=i[t];r.config.singleVisual.syncGroup&&this.visualSyncService.syncFilterState(r)}},e})();return{create:t}}e.explorationStateApplierModuleFactory=t})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o){return new l(e,i,t,new c(e,r,o))}var r=e.visuals.PivotTableOptions,o=e.visualHost.utils.ResourcePackageUtils,n=e.visuals.TableExOptions,a=e.visuals.TooltipManager,s=e.visualHost.visualPluginServiceHelpers.VisualPluginStorage;t.createExplorationVisualPluginService=i;var l=(function(){function t(t,i,r,o){var n=this;this.asyncFeatureSwitchService=t,this.resourceLoader=i,this.promiseFactory=r,this.resourceLoader=i,this.promiseFactory=r,this.trustedConvertibleVisualTypes=[],this.customConvertibleVisualTypes=[],this.globalConvertibleVisualTypes=[],this.storage=new s,this.initBuiltInPlugins=this.asyncFeatureSwitchService.getFeatureSwitches().then((function(i){o=o||new c(t),n.globalConvertibleVisualTypes=n.getConvertibleCoreVisualTypeNames(i);for(var r in e.visuals.plugins)n.storage.loadPlugin(r,o.getPlugin(r))}))}return t.prototype.getConvertibleCoreVisualTypeNames=function(t){var i=[e.visuals.plugins.barChart.name,e.visuals.plugins.columnChart.name,e.visuals.plugins.clusteredBarChart.name,e.visuals.plugins.clusteredColumnChart.name,e.visuals.plugins.hundredPercentStackedBarChart.name,e.visuals.plugins.hundredPercentStackedColumnChart.name,e.visuals.plugins.lineChart.name,e.visuals.plugins.areaChart.name,e.visuals.plugins.stackedAreaChart.name,e.visuals.plugins.lineStackedColumnComboChart.name,e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.ribbonChart.name];return t&&t.dataDotChartEnabled&&i.push.apply(i,[e.visuals.plugins.dataDotClusteredColumnComboChart.name,e.visuals.plugins.dataDotStackedColumnComboChart.name]),t&&t.histogram&&i.push(e.visuals.plugins.histogram.name),i.push.apply(i,[e.visuals.plugins.waterfallChart.name,e.visuals.plugins.funnel.name,e.visuals.plugins.scatterChart.name,e.visuals.plugins.pieChart.name,e.visuals.plugins.donutChart.name]),t&&t.sunburstVisualEnabled&&i.push(e.visuals.plugins.sunburst.name),i.push.apply(i,[e.visuals.plugins.treemap.name,e.visuals.plugins.map.name,e.visuals.plugins.filledMap.name]),t&&t.shapeMapVisualEnabled&&i.push(e.visuals.plugins.shapeMap.name),t&&t.azureMapVisual&&i.push(e.visuals.plugins.azureMap.name),i.push.apply(i,[e.visuals.plugins.gauge.name,e.visuals.plugins.card.name,e.visuals.plugins.multiRowCard.name,e.visuals.plugins.kpi.name,e.visuals.plugins.slicer.name]),t&&t.pivotTableVisualEnabled?(i.push(e.visuals.plugins.tableEx.name),i.push(e.visuals.plugins.pivotTable.name)):(i.push(e.visuals.plugins.table.name),i.push(e.visuals.plugins.matrix.name)),t&&t.scriptVisualEnabled&&t.scriptVisualAuthoringEnabled&&i.push(e.visuals.plugins.scriptVisual.name),i.push(e.visuals.plugins.pythonVisual.name),t&&t.keyDrivers&&i.push(e.visuals.plugins.keyDriversVisual.name),t&&t.distributionFactorsVisual&&i.push(e.visuals.plugins.distributionFactorsVisual.name),t&&t.decompositionTree&&i.push(e.visuals.plugins.decompositionTreeVisual.name),t&&t.qnaVisual&&i.push(e.visuals.plugins.qnaVisual.name),t&&t.narrativeTextbox&&i.push(e.visuals.plugins.textbox.name),e.localStorageService.getData("VISUAL_DEVELOPER_MODE_ENABLED")&&i.push(e.visuals.plugins.debugVisual.name),i},t.prototype.getVisuals=function(){return this.storage.getLoadedPlugins()},t.prototype.getConvertibleVisuals=function(){for(var e=this,t=[],i=0,r=this.globalConvertibleVisualTypes;i<r.length;i++){var o=r[i];this.storage.hasPlugin(o)&&!_.includes(t,o)&&t.push(o)}for(var n=0,a=this.trustedConvertibleVisualTypes;n<a.length;n++){var s=a[n];this.storage.hasPlugin(s)&&!_.includes(t,s)&&t.push(s)}for(var l=0,c=this.customConvertibleVisualTypes;l<c.length;l++){var u=c[l];this.storage.hasPlugin(u)&&!_.includes(t,u)&&t.push(u)}return t.map((function(t){return e.storage.getLoadedPlugin(t)}))},t.prototype.ensureBuiltInPlugins=function(){return this.initBuiltInPlugins},t.prototype.ensureTrustedVisualPlugins=function(e){s.ensureTrustedVisualPlugins(this.storage,e);for(var t=0,i=e;t<i.length;t++){var r=i[t];this.addTrustedConvertibleVisualType(r.name)}},t.prototype.ensurePlugins=function(e,t){var i=this,r=[];if(e&&e.length)for(var n=function(e){if(o.isCustomVisualResourcePackage(e)){var n=a.ensurePlugin(e,t).then((function(){return i.addCustomConvertibleVisualType(e.name)}));r.push(n)}},a=this,s=0,l=e;s<l.length;s++){var c=l[s];n(c)}return this.promiseFactory.allSettled(r)},t.prototype.ensurePlugin=function(e,t){return s.ensurePlugin(this.storage,this.promiseFactory,this.resourceLoader,e,t)},t.prototype.addTrustedConvertibleVisualType=function(e){this.trustedConvertibleVisualTypes.indexOf(e)<0&&this.trustedConvertibleVisualTypes.push(e)},t.prototype.addCustomConvertibleVisualType=function(e){this.customConvertibleVisualTypes.indexOf(e)<0&&this.customConvertibleVisualTypes.push(e)},t.prototype.capabilities=function(e){var t=this.getPlugin(e);return t?t.capabilities:void 0},t.prototype.removeAllCustomVisuals=function(){for(var e=0,t=this.customConvertibleVisualTypes;e<t.length;e++){var i=t[e];this.storage.unloadPlugin(i)}this.customConvertibleVisualTypes=[]},t.prototype.removePlugin=function(e){this.getPlugin(e)&&(this.storage.unloadPlugin(e),_.remove(this.customConvertibleVisualTypes,(function(t){return t===e})))},t.prototype.getTelemetryHostInformation=function(){return{name:"Exploration"}},t.prototype.isCustomVisual=function(t){return e.visualHost.utils.isCustomVisual(this.getPlugin(t),t)},t.prototype.isScriptVisual=function(t){return e.visualHost.utils.isScriptVisual(this.getPlugin(t))},t.prototype.isScriptVisualQueryable=function(t){return e.visualHost.utils.isScriptVisualQueryable(t,this.asyncFeatureSwitchService.featureSwitches)},t.prototype.isLightWeightRenderingVisual=function(t){return e.visualHost.utils.isLightWeightRenderingVisual(this.getPlugin(t))},t.prototype.getInteractivityOptions=function(){return{overflow:"hidden",isVisualInteractive:!0}},t.prototype.loadPluginByNameIfAny=function(t){if(!this.getPlugin(t))return this.storage.hasPlugin(t)?void this.storage.loadPlugin(t):void(e.visuals.plugins[t]&&this.storage.loadPlugin(t,e.visuals.plugins[t]))},t.prototype.getPlugin=function(e){return this.storage.getLoadedPlugin(e)},t.prototype.getStorage=function(){return this.storage},t})();t.ExplorationVisualPluginService=l;var c=(function(){function t(e,t,i){this.featureSwitchService=e,this.mapControlFactory=t,this.visualSandbox=i;var r=this.featureSwitchService.featureSwitches;a.ShowTouchScreenOptimizedTooltips=r&&r.touchScreenOptimizedTooltips}return t.prototype.getPlugin=function(t){var i=this,o=this.featureSwitchService.featureSwitches?_.clone(this.featureSwitchService.featureSwitches):{},a=o.whatIf;switch(e.visuals.SlicerHelper.SingleValueSlicer=a,t){case e.visuals.plugins.barChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.barChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:6,isScrollable:!0,animator:t.createWebColumnChartAnimator(),tooltipsEnabled:!0,behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.card.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.card,(function(t){return t.module.createCard({isScrollable:!0,animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0,interactivityEnabled:!0,featureSwitches:o})}),o);case e.visuals.plugins.clusteredBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredBarChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:5,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.clusteredColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredColumnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:3,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.columnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.columnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:4,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.dataDotClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotClusteredColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:16,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createDataDotChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.dataDotStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotStackedColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:17,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createDataDotChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.donutChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.donutChart,(function(){return new e.visuals.DonutChart({animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,behavior:new e.visuals.DonutChartWebBehavior})}),o);case e.visuals.plugins.funnel.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.funnel,(function(){return new e.visuals.FunnelChart({animator:new e.visuals.WebFunnelAnimator,behavior:new e.visuals.FunnelWebBehavior,tooltipsEnabled:!0})}),o);case e.visuals.plugins.gauge.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.gauge,(function(t){return t.module.createGauge({animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0,behavior:new e.visuals.GaugeBehavior},o)}),o);case e.visuals.plugins.kpi.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.kpi,(function(){return new e.visuals.KPIStatusWithHistory({interactivityEnabled:!0},o)}),o);case e.visuals.plugins.hundredPercentStackedBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedBarChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:7,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.hundredPercentStackedColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedColumnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:8,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.lineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineChart,(function(t){var i=t.module;return i.createCartesianChart({chartType:0,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:i.createCartesianChartBehavior([i.createLineChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.areaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.areaChart,(function(t){var i=t.module;return i.createCartesianChart({chartType:1,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:i.createCartesianChartBehavior([i.createLineChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.stackedAreaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.stackedAreaChart,(function(t){var i=t.module;return i.createCartesianChart({chartType:2,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:i.createCartesianChartBehavior([i.createLineChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.lineClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineClusteredColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:14,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createLineChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.lineStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineStackedColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:15,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createLineChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.multiRowCard.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.multiRowCard,(function(){return new e.visuals.MultiRowCard({interactivityEnabled:!0})}),o);case e.visuals.plugins.pieChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pieChart,(function(){return new e.visuals.DonutChart({sliceWidthRatio:0,animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,behavior:new e.visuals.DonutChartWebBehavior})}),o);case e.visuals.plugins.ribbonChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.ribbonChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:9,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.scatterChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scatterChart,(function(t){var i=t.module;return i.createCartesianChart({chartType:10,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:i.createCartesianChartBehavior([i.createScatterChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.treemap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.treemap,(function(e){var t=e.module;return new t.Treemap({animator:t.webAnimator(),isScrollable:!0,behavior:t.webBehavior(),tooltipsEnabled:!0,cartesianConditionalFormatting:o.cartesianConditionalFormatting})}),o);case e.visuals.plugins.filterSlicer.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.filterSlicer,(function(){return new e.visuals.Slicer({lockKeyboardNavigation:!1})}),o);case e.visuals.plugins.accessibleTable.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.accessibleTable,(function(e){return new e.module.AccessibleTable}),o);case e.visuals.plugins.sunburst.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.sunburst,(function(e){var t=e.module;return new t.Sunburst({isScrollable:!0,behavior:t.behavior()})}),o);case e.visuals.plugins.waterfallChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.waterfallChart,(function(e){
var t=e.module;return t.createCartesianChart({chartType:13,isScrollable:!0,tooltipsEnabled:!0,behavior:t.createCartesianChartBehavior([t.createWaterfallChartWebBehavior()]),featureSwitches:o})}),o);case e.visuals.plugins.map.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.map,(function(){return new e.visuals.Map({behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,isLegendScrollable:!0,mapControlFactory:i.mapControlFactory})}),o);case e.visuals.plugins.filledMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.filledMap,(function(){return new e.visuals.Map({filledMap:!0,behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,filledMapDataLabelsEnabled:o&&o.filledMapDataLabelsEnabled,isLegendScrollable:!0,mapControlFactory:i.mapControlFactory})}),o);case e.visuals.plugins.azureMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.azureMap,(function(){return new e.visuals.AzureMap({behavior:new e.visuals.AzureMapBehavior,tooltipsEnabled:!0,isLegendScrollable:!0,mapControlFactory:i.mapControlFactory})}),o);case e.visuals.plugins.shapeMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.shapeMap,(function(e){var t=e.module;return new t.ShapeMap({behavior:new t.ShapeMapBehavior,tooltipsEnabled:!0})}),o);case e.visuals.plugins.slicer.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.slicer,(function(){return new e.visuals.Slicer({featureSwitches:o})}),o);case e.visuals.plugins.matrix.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.matrix,(function(){return new e.visuals.Matrix({})}),o);case e.visuals.plugins.table.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.table,(function(){return new e.visuals.Table({})}),o);case e.visuals.plugins.pivotTable.name:var s=r.createDefaultConstructorOptions();return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pivotTable,(function(){return new e.visuals.PivotTable(s,o)}),o);case e.visuals.plugins.tableEx.name:var l=n.createDefaultConstructorOptions();return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.tableEx,(function(){return new e.visuals.TableEx(l,o)}),o);case e.visuals.plugins.scriptVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scriptVisual,(function(e){return new e.module.ScriptVisual}),o);case e.visuals.plugins.pythonVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pythonVisual,(function(e){return new e.module.ScriptVisual}),o);case e.visuals.plugins.debugVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.debugVisual,(function(){return new e.visuals.system.DebugVisual(i.visualSandbox)}),o);case e.visuals.plugins.textbox.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.textbox,(function(e){return e.module.createTextbox({featureSwitches:o})}),o);case e.visuals.plugins.keyDriversVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.keyDriversVisual,(function(e){return e.module.createAnalysisVisual()}),o);case e.visuals.plugins.distributionFactorsVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.distributionFactorsVisual,(function(e){return e.module.createAnalysisVisual()}),o);case e.visuals.plugins.decompositionTreeVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.decompositionTreeVisual,(function(e){return e.module.createAnalysisVisual()}),o);case e.visuals.plugins.qnaVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.qnaVisual,(function(e){return e.module.createQnaVisual()}),o);case e.visuals.plugins.histogram.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.histogram,(function(e){var t=e.module;return t.createCartesianChart({chartType:19,isScrollable:!0,tooltipsEnabled:!0,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),featureSwitches:o})}),o);default:return e.Prototype.inherit(e.visuals.plugins[t])}},t})();t.ExplorationVisualPluginProvider=c})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new a(e,t)}var r=jsCommon.FocusManager,o=jsCommon.FocusGroupNavigation,n=e.explore.dialogs.HotkeyDialogBuilder;t.createFocusService=i;var a=(function(){function e(e,t){this.$element=e,this.modalDialogService=t,this.focusManager=r.getInstance(),this.focusManager.register(document.documentElement,!1,!1)}return e.prototype.setOnFocusGroupChangedHandler=function(e){this.focusManager.setOnFocusGroupChangedHandler(e)},e.prototype.startListening=function(){this.$element.on("keypress",$.proxy(this.onkeydown,this))},e.prototype.stopListening=function(){this.$element.off("keypress",this.onkeydown)},e.prototype.focusOnGroup=function(e,t,i,r,o){this.focusManager.focusOnGroupByIndex(e,t,i,r,o)},e.prototype.onkeydown=function(e){if("?"===String.fromCharCode(e.charCode)){var t=document.activeElement;if(o.canHandleKeyEvents(e.target))return;new n(this.modalDialogService).show().finally((function(){t&&t.nodeType===Node.ELEMENT_NODE&&t.focus()}))}},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("ExploreUI/services/userEmulationService",["require","exports"],(function(e,t){function i(e){return new o(e)}Object.defineProperty(t,"__esModule",{value:!0});var r=powerbi.explore.services.events;t.create=i;var o=(function(){function e(e){this.eventBridge=e,this.isEmulationOn=!1}return e.prototype.setState=function(e){this.isEmulationOn=e,this.eventBridge.publishToChannel(r.emulationChanged)},e.prototype.getState=function(){return this.isEmulationOn},e})()}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.services.DataViewTransformActionsSerializer,o=e.data.dsr,n=t.util.VisualContainerUtils,a=(function(){function t(e,t,i,r,o,n,a,s,l,c){this.promiseFactory=e,this.conceptualSchemaProxy=t,this.featureSwitchService=i,this.visualQueryGenerator=r,this.visualPlugin=o,this.visualPluginOps=n,this.dataProxy=a,this.visualDataProxyService=s,this.networkAvailability=l,this.visualContainerCacheStrategy=c}return t.prototype.applyVisualCache=function(e,t,i){var r=this,o=this.featureSwitchService.featureSwitches,n=o.telemetryV2,a=this.promiseFactory.defer(n),s=e.contract;return this.visualContainerCacheStrategy.shouldUseVisualContainerCache(e)?this.retrieveFromVisualContainerCache(e.dataSources,s,e.viewport,e.hostServices).then((function(o){o.isFinal||!r.networkAvailability.isNetworkAvailable()?(e.visualFirstLoadEvent&&(e.visualFirstLoadEvent.event.info.loadType="Cache"),t.reject(),i.resolve(o.result),a.resolve(!1)):(e.visualFirstLoadEvent&&(e.visualFirstLoadEvent.event.info.loadType="StaleCache"),t.resolve(o.result),a.resolve(!0))}),(function(i){t.reject(),s.useInitialCachedQuery=!1,e.visualFirstLoadEvent&&(e.visualFirstLoadEvent.event.info.loadTypeWarning=i),a.resolve(!0)})):(t.reject(),a.resolve(!0)),a.promise},t.prototype.retrieveFromVisualContainerCache=function(e,t,i,r){if(t.cachedData&&t.cachedData.data)return this.processVisualContainerCache(e,t,i,r);var o=this.featureSwitchService.featureSwitches.telemetryV2,n=this.promiseFactory.defer(o);return n.reject("CacheMissing"),n.promise},t.prototype.processVisualContainerCache=function(t,i,a,s){var l,c=this,u=this.promiseFactory.defer(),p=jsCommon.GzipUtility.uncompress(i.cachedData.data);try{l=JSON.parse(p)}catch(e){return u.reject("JsonParseFailed"),u.promise}var d=null,h=i.config.singleVisual,v=this.visualPluginOps.targetedDataViewKinds(h.visualType,h.query);try{d=o.read(v,l,e.common.utils.getDsrReaderSwitches(this.featureSwitchService.featureSwitches))}catch(e){return u.reject("DsrReadFailed"),u.promise}if(!d)return u.reject("DataObjectNull"),u.promise;var g={data:l},f=n.getVisualType(i),y=this.visualPlugin.capabilities(f),m=jsCommon.JsonExtensions.tryParseJSON(i.cachedData.transforms),C=m?r.deserializeDataViewTransformActions(m,y):void 0,S=this.promiseFactory.defer(),w={result:{dataViewSource:g,dataReaderResult:d},dataProxyQuery:{transforms:C,warnings:d.warnings?d.warnings:void 0,error:d.error,options:S.promise},schema:void 0,updateServerVisualContainerCache:!1};return d.error||!C?u.reject(d.error?"DsrHasOdataError":"DataTransformsMissing"):(u.resolve({isFinal:i.useInitialCachedQuery,result:w}),i.useInitialCachedQuery&&this.conceptualSchemaProxy.get(t).then((function(e){var i=c.visualDataProxyService.generateQuery({dataSources:t,schema:e,config:h,hostServices:s,visualQueryGenerator:c.visualQueryGenerator,executionType:0,isInitialLoad:!1,allowCache:!0,viewport:a,cacheOptions:void 0});c.dataProxy.setLocalCacheResult(i.options,l),S.resolve(i.options)}))),u.promise},t})();i.VisualContainerCache=a})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){function t(e,t,i,r,o,n,a,s,l){return new h(e,t,i,r,o,n,a,s,l)}var i=e,r=i.data,o=i.explore,n=o.contracts,a=r.DataViewObjectDefinitions,s=r.DataViewObjectDescriptors,l=o.services.ExplorationState,c=r.SemanticFilter,u=r.SQExpr,p=r.SQExprRewriter,d=(n.VisualContainer,e.explore.util.VisualContainerUtils),h=(function(){function t(e,t,i,r,o,n,a,s,l){this.explorationStateManager=e,this.explorationNavigation=t,this.explorationSerializer=i,this.featureSwitchService=r,this.visualPlugin=o,this.conceptualSchemaProxy=n,this.dataSources=a,this.displayNameService=s,this.visualAuthoringOperations=l}return t.prototype.generateUniqueGroupName=function(e,t,i){var r,o=this.getVisualSyncField(t);r=o?this.displayNameService.getDisplayName(o,e,this.visualPlugin.capabilities(t.visualType)):"Group";for(var n=r,a=1;n in i;)n=r+a++;return n},t.prototype.syncFilterState=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r,o,n,c,u,p,h,v,g,f,y,m,C,S,w,b,x,E;return __generator(this,(function(F){switch(F.label){case 0:return e=t.config.singleVisual,this.canSyncVisual(e)&&e.syncGroup?(r=this.getOtherSectionsInSyncGroup(e),_.isEmpty(r)?[2]:[4,this.conceptualSchemaProxy.get(this.dataSources.get())]):[2];case 1:for(o=F.sent(),n=this.explorationStateManager.captureFilterState(e),i=i&&e.syncGroup.filterChanges&&this.featureSwitchService.featureSwitches.visualLevelSlicerFilters,c=this.visualPlugin.capabilities(e.visualType),u={clearUnmatchedData:!1,suppressActiveSection:!0,suppressDisplay:!0,targetVisualNames:[]},p=s.findFilterOutput(c.objects),h=a.getValue(n.objects.merge,p,null),v=[],g=0,f=r;g<f.length;g++)for(y=f[g],d.clearSectionQueryCaches(y.section),m=0,C=y.visualContainers;m<C.length;m++){if(S=C[m],w=i&&this.syncFilters(S,t.filters),b=n,h){if(x=a.getValue(S.config.singleVisual.objects,p,null),E=this.replaceSemanticFilterField(t.config.singleVisual.query.defn,h,S.config.singleVisual.query.defn,x,o),h&&!E){w&&this.visualAuthoringOperations.notifyVisualContainers([S]);continue}E!==h&&(b=l.cloneSingleVisual(b,this.visualPlugin),b.cachedFilterDisplayItems=void 0,b.filterExpressionMetadata=void 0,a.setValue(b.objects.merge,p,null,E))}u.targetVisualNames.push(S.name),v.push({visual:S,state:b,impacted:w})}return _.isEmpty(v)||this.explorationStateManager.applyFilterState(v,o,u),[2]}}))}))},t.prototype.syncVisualFiltersState=function(e,t){void 0===t&&(t=!0);var i=e.config.singleVisual,r=[];if(this.canSyncVisual(i)&&i.syncGroup.filterChanges&&this.featureSwitchService.featureSwitches.visualLevelSlicerFilters){for(var o=this.getOtherSectionsInSyncGroup(i),n=0,a=o;n<a.length;n++){var s=a[n];if(!_.isEmpty(s.visualContainers))for(var l=0,c=s.visualContainers;l<c.length;l++){var u=c[l];this.syncFilters(u,e.filters)&&r.push(u)}}t&&this.visualAuthoringOperations.notifyVisualContainers(r)}},t.prototype.syncFilters=function(e,t){var i=_.isEmpty(t);if(e.config.singleVisual.syncGroup.filterChanges){if(i&&!_.isEmpty(e.filters))return e.filters=[],!0;if(!i){var r=this.explorationSerializer.deserializeFilterCollection(this.explorationSerializer.serializeFilterCollection(t),[],!0);return e.filters=r,!0}}return!1},t.prototype.getVisualsAffectByFieldChanges=function(e){var t=e.config.singleVisual;return this.canSyncVisual(t)&&t.syncGroup.fieldChanges?_.filter(this.getOtherVisualsInSyncGroup(t),(function(e){return e.config.singleVisual.syncGroup.fieldChanges})):[]},t.prototype.canSyncVisual=function(e){if(!this.featureSwitchService.featureSwitches.slicerSyncing||!e.syncGroup)return!1;var t=this.visualPlugin.capabilities(e.visualType),i=t&&t.supportsSynchronizingFilterState;return i},t.prototype.getOtherVisualsInSyncGroup=function(e){return this.getVisualsInSectionsSyncGroup(this.getOtherSectionsInSyncGroup(e))},t.prototype.getVisualsInSectionsSyncGroup=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];t.push.apply(t,o.visualContainers)}return t},t.prototype.getOtherSectionsInSyncGroup=function(e){if(!e.syncGroup)return[];if(!e.syncGroup.groupName)return[];for(var t=this.explorationNavigation.getCurrentExploration(),i=[],r=0,o=t.sections;r<o.length;r++){var n=o[r],a=_.filter(n.visualContainers,(function(t){var i=t.config.singleVisual;return i!==e&&i.syncGroup&&i.syncGroup.groupName===e.syncGroup.groupName&&i.visualType===e.visualType}));_.isEmpty(a)||i.push({section:n,visualContainers:a})}return i},t.prototype.getVisualSyncField=function(e){var t=e.query.defn.select();return 0===t.length?null:t[0].expr},t.prototype.replaceSemanticFilterField=function(e,t,i,r,o){if(!t)return t;var n=e.select(),a=i.select();if(n.length===a.length)if(n.length>1){var s=!_.differenceWith(n,a,(function(e,t){return u.equals(e.expr,t.expr)})).length;if(s)return t}else if(1===n.length){if(u.equals(n[0].expr,a[0].expr))return t;var l=v.extract(t);if(l){if(!r){var p=t.conditions();if(1!==p.length)return;var d=a[0].expr.getKeyColumns(o);if(1!==d.length)return;var h=g.replaceCondition(p[0],l,d[0]);return c.fromSQExpr(h)}var f=v.extract(r);if(f)return g.replace(t,l,f)}}},t})(),v=(function(e){function t(){return e.call(this)||this}return __extends(t,e),t.extract=function(e){var i=new t;return e.rewrite(i),i.foundSingleField&&i.fieldExpr},t.prototype.visitHierarchyLevel=function(e){return this.setFieldExpr(e),e},t.prototype.visitColumnRef=function(e){return this.setFieldExpr(e),e},t.prototype.setFieldExpr=function(e){return this.fieldExpr?void(u.equals(this.fieldExpr,e)||(this.foundSingleField=!1)):(this.fieldExpr=e,void(this.foundSingleField=!0))},t})(p),g=(function(e){function t(t,i){var r=e.call(this)||this;return r.before=t,r.after=i,r}return __extends(t,e),t.replace=function(e,i,r){if(u.equals(i,r))return e;var o=new t(i,r);return e.rewrite(o)},t.replaceCondition=function(e,i,r){if(u.equals(i,r))return e;var o=new t(i,r);return e.accept(o)},t.prototype.visitColumnRef=function(e){if(u.equals(e,this.before))return this.after},t})(r.SQExprRewriter);return{create:t}}e.visualSyncServiceModuleFactory=t})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.services.events,n=e.explore.util.ScriptVisualsUtil,a=t.services.selectionUtils;!(function(r){function s(r,o,n,a,s){return __awaiter(this,void 0,e.Promise,(function(){var e,l,p;return __generator(this,(function(h){switch(h.label){case 0:return 2===r.scope.scopeType&&i.VisualContainerUtils.clearExplorationQueryCaches(n),1===r.changeType||2===r.changeType&&!y(r.filter,o)?[4,c(a.dataSources,a.conceptualSchemaProxy)]:[3,2];case 1:return e=h.sent(),l=i.VisualContainerUtils.getVisualCapabilities(s,a.visualPlugin),p=t.viewModels.FilterViewModelFactory.convertFilterContainer(r.filter,e,a.displayNameService,r.scope,a.visualPlugin,a.aggrOps,a.localizationService,l,s&&s.config.singleVisual),d(p,a.explorationNavigation),0===r.scope.scopeType&&r.scope.container!==s||(o.push(p),u(o,e,a.dataSources,a.visualAuthoring)),[3,3];case 2:0===r.changeType&&_.remove(o,(function(e){return e.contract===r.filter})),h.label=3;case 3:return g(a,r),[2]}}))}))}function l(i,r){return __awaiter(this,void 0,e.Promise,(function(){var e,o,n,a;return __generator(this,(function(s){switch(s.label){case 0:return e=i.explorationNavigation.getCurrentSection(),o=i.explorationCapabilities.getCapabilities(),n=[],!e||o.shouldShowPageFilters&&!o.shouldShowPageFilters(e)?[2,n]:[4,c(i.dataSources,i.conceptualSchemaProxy)];case 1:return a=s.sent(),n=t.viewModels.ViewModelFactory.createFilters({scopeType:1,container:e},a,i.displayNameService,i.visualPlugin,i.aggrOps,i.localizationService,null,r),u(n,a,i.dataSources,i.visualAuthoring),p(n,i.explorationNavigation),[2,n]}}))}))}function c(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return e=t.get(),e?[4,i.get(e)]:[2];case 1:return[2,r.sent()]}}))}))}function u(e,t,i,r){if(!_.isEmpty(e)){var o=i.get();r.addConfigToCategoricalFilters(e,t,o)}}function p(e,t){if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i];d(o,t)}}function d(e,i){var r=i.getCurrentExploration(),o=i.getCurrentSection();if(o){var n=t.PodUtils.findPodForSectionName(r,o.name);if(n&&!_.isEmpty(n.parameters)){var a=_.find(n.parameters,(function(t){return t.boundFilter===e.contract.name}));a&&e.updateIsLinkedAsAggregation(!!a.asAggregation)}}}function h(e,t,i,r,o,n,a){var s=o.getDragContext();if(s&&s.field){var l={scopeType:e,container:t},c=r.get();i?n.addDrillthroughFilter(s.field,l,c):n.addFilter(s.field,l,c,a)}}function v(e,i,r,n){if(!_.isEmpty(r)&&(10===n.changeType||1===n.changeType||2===n.changeType||0===n.changeType))for(var a=f(n.scope.scopeType,5===n.filter.howCreated),s=0,l=r;s<l.length;s++){var c=l[s],u=f(i,5===c.howCreated);if(!(a<u)&&t.FilterUtils.isCategoricalFilter(c.contract.type)&&c.contract!==n.filter){var p={filter:c.contract,changeType:4,scope:c.getFilterContainerScope()};e.eventBridge.publishToChannel(o.filterContainerChanged,p)}}}function g(t,i){var r=t.explorationNavigation,o=r.getCurrentExploration(),s=r.getCurrentSection(),l=i.scope.scopeType,c=a.getSelectedVisual(t.selection),u=n.getScriptVisualIds(l,o,s,c,t.scriptVisuals);if(!_.isEmpty(u)){var p=i.changeType.toString();t.telemetryService.logEvent(e.telemetry.EXFilterScriptVisual,p,JSON.stringify(u))}}function f(e,t){return 0===e?0:1!==e||t?1===e?2:2===e?3:-1:1}function y(e,t){for(var i=0,r=t;i<r.length;i++){if(r[i].contract===e)return!0}return!1}r.onFilterContainerChanged=s,r.getPageScopeFilters=l,r.getConceptualSchema=c,r.addConfigToFilters=u,r.setDrillthroughMetadata=d,r.addFilterToScopeFromDrop=h,r.updateCategoricalFiltersIfNeeded=v})(r=i.FilterPaneUtil||(i.FilterPaneUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));